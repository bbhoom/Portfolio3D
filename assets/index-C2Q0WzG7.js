(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var kA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function C1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var KJ={exports:{}},NP={},QJ={exports:{}},Pi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qS=Symbol.for("react.element"),Dfe=Symbol.for("react.portal"),Rfe=Symbol.for("react.fragment"),Ife=Symbol.for("react.strict_mode"),Lfe=Symbol.for("react.profiler"),Ofe=Symbol.for("react.provider"),Bfe=Symbol.for("react.context"),Ffe=Symbol.for("react.forward_ref"),kfe=Symbol.for("react.suspense"),Nfe=Symbol.for("react.memo"),Ufe=Symbol.for("react.lazy"),L8=Symbol.iterator;function zfe(t){return t===null||typeof t!="object"?null:(t=L8&&t[L8]||t["@@iterator"],typeof t=="function"?t:null)}var $J={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},JJ=Object.assign,ZJ={};function P1(t,e,i){this.props=t,this.context=e,this.refs=ZJ,this.updater=i||$J}P1.prototype.isReactComponent={};P1.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};P1.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function eZ(){}eZ.prototype=P1.prototype;function mz(t,e,i){this.props=t,this.context=e,this.refs=ZJ,this.updater=i||$J}var gz=mz.prototype=new eZ;gz.constructor=mz;JJ(gz,P1.prototype);gz.isPureReactComponent=!0;var O8=Array.isArray,tZ=Object.prototype.hasOwnProperty,vz={current:null},iZ={key:!0,ref:!0,__self:!0,__source:!0};function rZ(t,e,i){var r,n={},s=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)tZ.call(e,r)&&!iZ.hasOwnProperty(r)&&(n[r]=e[r]);var o=arguments.length-2;if(o===1)n.children=i;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];n.children=l}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)n[r]===void 0&&(n[r]=o[r]);return{$$typeof:qS,type:t,key:s,ref:a,props:n,_owner:vz.current}}function Gfe(t,e){return{$$typeof:qS,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function yz(t){return typeof t=="object"&&t!==null&&t.$$typeof===qS}function Vfe(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(i){return e[i]})}var B8=/\/+/g;function cI(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Vfe(""+t.key):e.toString(36)}function LT(t,e,i,r,n){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case qS:case Dfe:a=!0}}if(a)return a=t,n=n(a),t=r===""?"."+cI(a,0):r,O8(n)?(i="",t!=null&&(i=t.replace(B8,"$&/")+"/"),LT(n,e,i,"",function(c){return c})):n!=null&&(yz(n)&&(n=Gfe(n,i+(!n.key||a&&a.key===n.key?"":(""+n.key).replace(B8,"$&/")+"/")+t)),e.push(n)),1;if(a=0,r=r===""?".":r+":",O8(t))for(var o=0;o<t.length;o++){s=t[o];var l=r+cI(s,o);a+=LT(s,e,i,l,n)}else if(l=zfe(t),typeof l=="function")for(t=l.call(t),o=0;!(s=t.next()).done;)s=s.value,l=r+cI(s,o++),a+=LT(s,e,i,l,n);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function NA(t,e,i){if(t==null)return t;var r=[],n=0;return LT(t,r,"","",function(s){return e.call(i,s,n++)}),r}function Hfe(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(i){(t._status===0||t._status===-1)&&(t._status=1,t._result=i)},function(i){(t._status===0||t._status===-1)&&(t._status=2,t._result=i)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Wa={current:null},OT={transition:null},jfe={ReactCurrentDispatcher:Wa,ReactCurrentBatchConfig:OT,ReactCurrentOwner:vz};function nZ(){throw Error("act(...) is not supported in production builds of React.")}Pi.Children={map:NA,forEach:function(t,e,i){NA(t,function(){e.apply(this,arguments)},i)},count:function(t){var e=0;return NA(t,function(){e++}),e},toArray:function(t){return NA(t,function(e){return e})||[]},only:function(t){if(!yz(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Pi.Component=P1;Pi.Fragment=Rfe;Pi.Profiler=Lfe;Pi.PureComponent=mz;Pi.StrictMode=Ife;Pi.Suspense=kfe;Pi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jfe;Pi.act=nZ;Pi.cloneElement=function(t,e,i){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=JJ({},t.props),n=t.key,s=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=vz.current),e.key!==void 0&&(n=""+e.key),t.type&&t.type.defaultProps)var o=t.type.defaultProps;for(l in e)tZ.call(e,l)&&!iZ.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=i;else if(1<l){o=Array(l);for(var c=0;c<l;c++)o[c]=arguments[c+2];r.children=o}return{$$typeof:qS,type:t.type,key:n,ref:s,props:r,_owner:a}};Pi.createContext=function(t){return t={$$typeof:Bfe,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Ofe,_context:t},t.Consumer=t};Pi.createElement=rZ;Pi.createFactory=function(t){var e=rZ.bind(null,t);return e.type=t,e};Pi.createRef=function(){return{current:null}};Pi.forwardRef=function(t){return{$$typeof:Ffe,render:t}};Pi.isValidElement=yz;Pi.lazy=function(t){return{$$typeof:Ufe,_payload:{_status:-1,_result:t},_init:Hfe}};Pi.memo=function(t,e){return{$$typeof:Nfe,type:t,compare:e===void 0?null:e}};Pi.startTransition=function(t){var e=OT.transition;OT.transition={};try{t()}finally{OT.transition=e}};Pi.unstable_act=nZ;Pi.useCallback=function(t,e){return Wa.current.useCallback(t,e)};Pi.useContext=function(t){return Wa.current.useContext(t)};Pi.useDebugValue=function(){};Pi.useDeferredValue=function(t){return Wa.current.useDeferredValue(t)};Pi.useEffect=function(t,e){return Wa.current.useEffect(t,e)};Pi.useId=function(){return Wa.current.useId()};Pi.useImperativeHandle=function(t,e,i){return Wa.current.useImperativeHandle(t,e,i)};Pi.useInsertionEffect=function(t,e){return Wa.current.useInsertionEffect(t,e)};Pi.useLayoutEffect=function(t,e){return Wa.current.useLayoutEffect(t,e)};Pi.useMemo=function(t,e){return Wa.current.useMemo(t,e)};Pi.useReducer=function(t,e,i){return Wa.current.useReducer(t,e,i)};Pi.useRef=function(t){return Wa.current.useRef(t)};Pi.useState=function(t){return Wa.current.useState(t)};Pi.useSyncExternalStore=function(t,e,i){return Wa.current.useSyncExternalStore(t,e,i)};Pi.useTransition=function(){return Wa.current.useTransition()};Pi.version="18.3.1";QJ.exports=Pi;var we=QJ.exports;const F8=C1(we);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wfe=we,Xfe=Symbol.for("react.element"),Yfe=Symbol.for("react.fragment"),qfe=Object.prototype.hasOwnProperty,Kfe=Wfe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Qfe={key:!0,ref:!0,__self:!0,__source:!0};function sZ(t,e,i){var r,n={},s=null,a=null;i!==void 0&&(s=""+i),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)qfe.call(e,r)&&!Qfe.hasOwnProperty(r)&&(n[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)n[r]===void 0&&(n[r]=e[r]);return{$$typeof:Xfe,type:t,key:s,ref:a,props:n,_owner:Kfe.current}}NP.Fragment=Yfe;NP.jsx=sZ;NP.jsxs=sZ;KJ.exports=NP;var Y=KJ.exports,aZ={exports:{}},Ko={},oZ={exports:{}},lZ={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(I,z){var U=I.length;I.push(z);e:for(;0<U;){var X=U-1>>>1,Q=I[X];if(0<n(Q,z))I[X]=z,I[U]=Q,U=X;else break e}}function i(I){return I.length===0?null:I[0]}function r(I){if(I.length===0)return null;var z=I[0],U=I.pop();if(U!==z){I[0]=U;e:for(var X=0,Q=I.length,re=Q>>>1;X<re;){var ie=2*(X+1)-1,ce=I[ie],Z=ie+1,Ae=I[Z];if(0>n(ce,U))Z<Q&&0>n(Ae,ce)?(I[X]=Ae,I[Z]=U,X=Z):(I[X]=ce,I[ie]=U,X=ie);else if(Z<Q&&0>n(Ae,U))I[X]=Ae,I[Z]=U,X=Z;else break e}}return z}function n(I,z){var U=I.sortIndex-z.sortIndex;return U!==0?U:I.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var l=[],c=[],h=1,u=null,d=3,f=!1,p=!1,m=!1,g=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(I){for(var z=i(c);z!==null;){if(z.callback===null)r(c);else if(z.startTime<=I)r(c),z.sortIndex=z.expirationTime,e(l,z);else break;z=i(c)}}function S(I){if(m=!1,x(I),!p)if(i(l)!==null)p=!0,q(A);else{var z=i(c);z!==null&&W(S,z.startTime-I)}}function A(I,z){p=!1,m&&(m=!1,v(E),E=-1),f=!0;var U=d;try{for(x(z),u=i(l);u!==null&&(!(u.expirationTime>z)||I&&!D());){var X=u.callback;if(typeof X=="function"){u.callback=null,d=u.priorityLevel;var Q=X(u.expirationTime<=z);z=t.unstable_now(),typeof Q=="function"?u.callback=Q:u===i(l)&&r(l),x(z)}else r(l);u=i(l)}if(u!==null)var re=!0;else{var ie=i(c);ie!==null&&W(S,ie.startTime-z),re=!1}return re}finally{u=null,d=U,f=!1}}var _=!1,M=null,E=-1,T=5,C=-1;function D(){return!(t.unstable_now()-C<T)}function B(){if(M!==null){var I=t.unstable_now();C=I;var z=!0;try{z=M(!0,I)}finally{z?O():(_=!1,M=null)}}else _=!1}var O;if(typeof y=="function")O=function(){y(B)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,H=L.port2;L.port1.onmessage=B,O=function(){H.postMessage(null)}}else O=function(){g(B,0)};function q(I){M=I,_||(_=!0,O())}function W(I,z){E=g(function(){I(t.unstable_now())},z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(I){I.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,q(A))},t.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<I?Math.floor(1e3/I):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(I){switch(d){case 1:case 2:case 3:var z=3;break;default:z=d}var U=d;d=z;try{return I()}finally{d=U}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(I,z){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var U=d;d=I;try{return z()}finally{d=U}},t.unstable_scheduleCallback=function(I,z,U){var X=t.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?X+U:X):U=X,I){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=U+Q,I={id:h++,callback:z,priorityLevel:I,startTime:U,expirationTime:Q,sortIndex:-1},U>X?(I.sortIndex=U,e(c,I),i(l)===null&&I===i(c)&&(m?(v(E),E=-1):m=!0,W(S,U-X))):(I.sortIndex=Q,e(l,I),p||f||(p=!0,q(A))),I},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(I){var z=d;return function(){var U=d;d=z;try{return I.apply(this,arguments)}finally{d=U}}}})(lZ);oZ.exports=lZ;var $fe=oZ.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jfe=we,Wo=$fe;function pt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var cZ=new Set,Iw={};function $g(t,e){Vy(t,e),Vy(t+"Capture",e)}function Vy(t,e){for(Iw[t]=e,t=0;t<e.length;t++)cZ.add(e[t])}var od=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),DB=Object.prototype.hasOwnProperty,Zfe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,k8={},N8={};function epe(t){return DB.call(N8,t)?!0:DB.call(k8,t)?!1:Zfe.test(t)?N8[t]=!0:(k8[t]=!0,!1)}function tpe(t,e,i,r){if(i!==null&&i.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:i!==null?!i.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function ipe(t,e,i,r){if(e===null||typeof e>"u"||tpe(t,e,i,r))return!0;if(r)return!1;if(i!==null)switch(i.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Xa(t,e,i,r,n,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=n,this.mustUseProperty=i,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var $s={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){$s[t]=new Xa(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];$s[e]=new Xa(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){$s[t]=new Xa(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){$s[t]=new Xa(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){$s[t]=new Xa(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){$s[t]=new Xa(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){$s[t]=new Xa(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){$s[t]=new Xa(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){$s[t]=new Xa(t,5,!1,t.toLowerCase(),null,!1,!1)});var xz=/[\-:]([a-z])/g;function bz(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(xz,bz);$s[e]=new Xa(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(xz,bz);$s[e]=new Xa(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(xz,bz);$s[e]=new Xa(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){$s[t]=new Xa(t,1,!1,t.toLowerCase(),null,!1,!1)});$s.xlinkHref=new Xa("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){$s[t]=new Xa(t,1,!1,t.toLowerCase(),null,!0,!0)});function wz(t,e,i,r){var n=$s.hasOwnProperty(e)?$s[e]:null;(n!==null?n.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(ipe(e,i,n,r)&&(i=null),r||n===null?epe(e)&&(i===null?t.removeAttribute(e):t.setAttribute(e,""+i)):n.mustUseProperty?t[n.propertyName]=i===null?n.type===3?!1:"":i:(e=n.attributeName,r=n.attributeNamespace,i===null?t.removeAttribute(e):(n=n.type,i=n===3||n===4&&i===!0?"":""+i,r?t.setAttributeNS(r,e,i):t.setAttribute(e,i))))}var Sd=Jfe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,UA=Symbol.for("react.element"),Nv=Symbol.for("react.portal"),Uv=Symbol.for("react.fragment"),Sz=Symbol.for("react.strict_mode"),RB=Symbol.for("react.profiler"),hZ=Symbol.for("react.provider"),uZ=Symbol.for("react.context"),_z=Symbol.for("react.forward_ref"),IB=Symbol.for("react.suspense"),LB=Symbol.for("react.suspense_list"),Az=Symbol.for("react.memo"),pf=Symbol.for("react.lazy"),dZ=Symbol.for("react.offscreen"),U8=Symbol.iterator;function Mx(t){return t===null||typeof t!="object"?null:(t=U8&&t[U8]||t["@@iterator"],typeof t=="function"?t:null)}var Qr=Object.assign,hI;function Mb(t){if(hI===void 0)try{throw Error()}catch(i){var e=i.stack.trim().match(/\n( *(at )?)/);hI=e&&e[1]||""}return`
`+hI+t}var uI=!1;function dI(t,e){if(!t||uI)return"";uI=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var n=c.stack.split(`
`),s=r.stack.split(`
`),a=n.length-1,o=s.length-1;1<=a&&0<=o&&n[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(n[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||n[a]!==s[o]){var l=`
`+n[a].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=a&&0<=o);break}}}finally{uI=!1,Error.prepareStackTrace=i}return(t=t?t.displayName||t.name:"")?Mb(t):""}function rpe(t){switch(t.tag){case 5:return Mb(t.type);case 16:return Mb("Lazy");case 13:return Mb("Suspense");case 19:return Mb("SuspenseList");case 0:case 2:case 15:return t=dI(t.type,!1),t;case 11:return t=dI(t.type.render,!1),t;case 1:return t=dI(t.type,!0),t;default:return""}}function OB(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Uv:return"Fragment";case Nv:return"Portal";case RB:return"Profiler";case Sz:return"StrictMode";case IB:return"Suspense";case LB:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case uZ:return(t.displayName||"Context")+".Consumer";case hZ:return(t._context.displayName||"Context")+".Provider";case _z:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Az:return e=t.displayName||null,e!==null?e:OB(t.type)||"Memo";case pf:e=t._payload,t=t._init;try{return OB(t(e))}catch{}}return null}function npe(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return OB(e);case 8:return e===Sz?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function op(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function fZ(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function spe(t){var e=fZ(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var n=i.get,s=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return n.call(this)},set:function(a){r=""+a,s.call(this,a)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function zA(t){t._valueTracker||(t._valueTracker=spe(t))}function pZ(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var i=e.getValue(),r="";return t&&(r=fZ(t)?t.checked?"true":"false":t.value),t=r,t!==i?(e.setValue(t),!0):!1}function IC(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function BB(t,e){var i=e.checked;return Qr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??t._wrapperState.initialChecked})}function z8(t,e){var i=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;i=op(e.value!=null?e.value:i),t._wrapperState={initialChecked:r,initialValue:i,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function mZ(t,e){e=e.checked,e!=null&&wz(t,"checked",e,!1)}function FB(t,e){mZ(t,e);var i=op(e.value),r=e.type;if(i!=null)r==="number"?(i===0&&t.value===""||t.value!=i)&&(t.value=""+i):t.value!==""+i&&(t.value=""+i);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?kB(t,e.type,i):e.hasOwnProperty("defaultValue")&&kB(t,e.type,op(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function G8(t,e,i){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,i||e===t.value||(t.value=e),t.defaultValue=e}i=t.name,i!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,i!==""&&(t.name=i)}function kB(t,e,i){(e!=="number"||IC(t.ownerDocument)!==t)&&(i==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+i&&(t.defaultValue=""+i))}var Tb=Array.isArray;function vy(t,e,i,r){if(t=t.options,e){e={};for(var n=0;n<i.length;n++)e["$"+i[n]]=!0;for(i=0;i<t.length;i++)n=e.hasOwnProperty("$"+t[i].value),t[i].selected!==n&&(t[i].selected=n),n&&r&&(t[i].defaultSelected=!0)}else{for(i=""+op(i),e=null,n=0;n<t.length;n++){if(t[n].value===i){t[n].selected=!0,r&&(t[n].defaultSelected=!0);return}e!==null||t[n].disabled||(e=t[n])}e!==null&&(e.selected=!0)}}function NB(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(pt(91));return Qr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function V8(t,e){var i=e.value;if(i==null){if(i=e.children,e=e.defaultValue,i!=null){if(e!=null)throw Error(pt(92));if(Tb(i)){if(1<i.length)throw Error(pt(93));i=i[0]}e=i}e==null&&(e=""),i=e}t._wrapperState={initialValue:op(i)}}function gZ(t,e){var i=op(e.value),r=op(e.defaultValue);i!=null&&(i=""+i,i!==t.value&&(t.value=i),e.defaultValue==null&&t.defaultValue!==i&&(t.defaultValue=i)),r!=null&&(t.defaultValue=""+r)}function H8(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function vZ(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function UB(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?vZ(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var GA,yZ=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,i,r,n){MSApp.execUnsafeLocalFunction(function(){return t(e,i,r,n)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(GA=GA||document.createElement("div"),GA.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=GA.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Lw(t,e){if(e){var i=t.firstChild;if(i&&i===t.lastChild&&i.nodeType===3){i.nodeValue=e;return}}t.textContent=e}var qb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ape=["Webkit","ms","Moz","O"];Object.keys(qb).forEach(function(t){ape.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),qb[e]=qb[t]})});function xZ(t,e,i){return e==null||typeof e=="boolean"||e===""?"":i||typeof e!="number"||e===0||qb.hasOwnProperty(t)&&qb[t]?(""+e).trim():e+"px"}function bZ(t,e){t=t.style;for(var i in e)if(e.hasOwnProperty(i)){var r=i.indexOf("--")===0,n=xZ(i,e[i],r);i==="float"&&(i="cssFloat"),r?t.setProperty(i,n):t[i]=n}}var ope=Qr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function zB(t,e){if(e){if(ope[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(pt(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(pt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(pt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(pt(62))}}function GB(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var VB=null;function Ez(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var HB=null,yy=null,xy=null;function j8(t){if(t=$S(t)){if(typeof HB!="function")throw Error(pt(280));var e=t.stateNode;e&&(e=HP(e),HB(t.stateNode,t.type,e))}}function wZ(t){yy?xy?xy.push(t):xy=[t]:yy=t}function SZ(){if(yy){var t=yy,e=xy;if(xy=yy=null,j8(t),e)for(t=0;t<e.length;t++)j8(e[t])}}function _Z(t,e){return t(e)}function AZ(){}var fI=!1;function EZ(t,e,i){if(fI)return t(e,i);fI=!0;try{return _Z(t,e,i)}finally{fI=!1,(yy!==null||xy!==null)&&(AZ(),SZ())}}function Ow(t,e){var i=t.stateNode;if(i===null)return null;var r=HP(i);if(r===null)return null;i=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(i&&typeof i!="function")throw Error(pt(231,e,typeof i));return i}var jB=!1;if(od)try{var Tx={};Object.defineProperty(Tx,"passive",{get:function(){jB=!0}}),window.addEventListener("test",Tx,Tx),window.removeEventListener("test",Tx,Tx)}catch{jB=!1}function lpe(t,e,i,r,n,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(i,c)}catch(h){this.onError(h)}}var Kb=!1,LC=null,OC=!1,WB=null,cpe={onError:function(t){Kb=!0,LC=t}};function hpe(t,e,i,r,n,s,a,o,l){Kb=!1,LC=null,lpe.apply(cpe,arguments)}function upe(t,e,i,r,n,s,a,o,l){if(hpe.apply(this,arguments),Kb){if(Kb){var c=LC;Kb=!1,LC=null}else throw Error(pt(198));OC||(OC=!0,WB=c)}}function Jg(t){var e=t,i=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(i=e.return),t=e.return;while(t)}return e.tag===3?i:null}function MZ(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function W8(t){if(Jg(t)!==t)throw Error(pt(188))}function dpe(t){var e=t.alternate;if(!e){if(e=Jg(t),e===null)throw Error(pt(188));return e!==t?null:t}for(var i=t,r=e;;){var n=i.return;if(n===null)break;var s=n.alternate;if(s===null){if(r=n.return,r!==null){i=r;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===i)return W8(n),t;if(s===r)return W8(n),e;s=s.sibling}throw Error(pt(188))}if(i.return!==r.return)i=n,r=s;else{for(var a=!1,o=n.child;o;){if(o===i){a=!0,i=n,r=s;break}if(o===r){a=!0,r=n,i=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===i){a=!0,i=s,r=n;break}if(o===r){a=!0,r=s,i=n;break}o=o.sibling}if(!a)throw Error(pt(189))}}if(i.alternate!==r)throw Error(pt(190))}if(i.tag!==3)throw Error(pt(188));return i.stateNode.current===i?t:e}function TZ(t){return t=dpe(t),t!==null?CZ(t):null}function CZ(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=CZ(t);if(e!==null)return e;t=t.sibling}return null}var PZ=Wo.unstable_scheduleCallback,X8=Wo.unstable_cancelCallback,fpe=Wo.unstable_shouldYield,ppe=Wo.unstable_requestPaint,yn=Wo.unstable_now,mpe=Wo.unstable_getCurrentPriorityLevel,Mz=Wo.unstable_ImmediatePriority,DZ=Wo.unstable_UserBlockingPriority,BC=Wo.unstable_NormalPriority,gpe=Wo.unstable_LowPriority,RZ=Wo.unstable_IdlePriority,UP=null,Ph=null;function vpe(t){if(Ph&&typeof Ph.onCommitFiberRoot=="function")try{Ph.onCommitFiberRoot(UP,t,void 0,(t.current.flags&128)===128)}catch{}}var Tc=Math.clz32?Math.clz32:bpe,ype=Math.log,xpe=Math.LN2;function bpe(t){return t>>>=0,t===0?32:31-(ype(t)/xpe|0)|0}var VA=64,HA=4194304;function Cb(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function FC(t,e){var i=t.pendingLanes;if(i===0)return 0;var r=0,n=t.suspendedLanes,s=t.pingedLanes,a=i&268435455;if(a!==0){var o=a&~n;o!==0?r=Cb(o):(s&=a,s!==0&&(r=Cb(s)))}else a=i&~n,a!==0?r=Cb(a):s!==0&&(r=Cb(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&n)&&(n=r&-r,s=e&-e,n>=s||n===16&&(s&4194240)!==0))return e;if(r&4&&(r|=i&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)i=31-Tc(e),n=1<<i,r|=t[i],e&=~n;return r}function wpe(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Spe(t,e){for(var i=t.suspendedLanes,r=t.pingedLanes,n=t.expirationTimes,s=t.pendingLanes;0<s;){var a=31-Tc(s),o=1<<a,l=n[a];l===-1?(!(o&i)||o&r)&&(n[a]=wpe(o,e)):l<=e&&(t.expiredLanes|=o),s&=~o}}function XB(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function IZ(){var t=VA;return VA<<=1,!(VA&4194240)&&(VA=64),t}function pI(t){for(var e=[],i=0;31>i;i++)e.push(t);return e}function KS(t,e,i){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Tc(e),t[e]=i}function _pe(t,e){var i=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<i;){var n=31-Tc(i),s=1<<n;e[n]=0,r[n]=-1,t[n]=-1,i&=~s}}function Tz(t,e){var i=t.entangledLanes|=e;for(t=t.entanglements;i;){var r=31-Tc(i),n=1<<r;n&e|t[r]&e&&(t[r]|=e),i&=~n}}var ar=0;function LZ(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var OZ,Cz,BZ,FZ,kZ,YB=!1,jA=[],jf=null,Wf=null,Xf=null,Bw=new Map,Fw=new Map,xf=[],Ape="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Y8(t,e){switch(t){case"focusin":case"focusout":jf=null;break;case"dragenter":case"dragleave":Wf=null;break;case"mouseover":case"mouseout":Xf=null;break;case"pointerover":case"pointerout":Bw.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fw.delete(e.pointerId)}}function Cx(t,e,i,r,n,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:i,eventSystemFlags:r,nativeEvent:s,targetContainers:[n]},e!==null&&(e=$S(e),e!==null&&Cz(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,n!==null&&e.indexOf(n)===-1&&e.push(n),t)}function Epe(t,e,i,r,n){switch(e){case"focusin":return jf=Cx(jf,t,e,i,r,n),!0;case"dragenter":return Wf=Cx(Wf,t,e,i,r,n),!0;case"mouseover":return Xf=Cx(Xf,t,e,i,r,n),!0;case"pointerover":var s=n.pointerId;return Bw.set(s,Cx(Bw.get(s)||null,t,e,i,r,n)),!0;case"gotpointercapture":return s=n.pointerId,Fw.set(s,Cx(Fw.get(s)||null,t,e,i,r,n)),!0}return!1}function NZ(t){var e=km(t.target);if(e!==null){var i=Jg(e);if(i!==null){if(e=i.tag,e===13){if(e=MZ(i),e!==null){t.blockedOn=e,kZ(t.priority,function(){BZ(i)});return}}else if(e===3&&i.stateNode.current.memoizedState.isDehydrated){t.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}t.blockedOn=null}function BT(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var i=qB(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(i===null){i=t.nativeEvent;var r=new i.constructor(i.type,i);VB=r,i.target.dispatchEvent(r),VB=null}else return e=$S(i),e!==null&&Cz(e),t.blockedOn=i,!1;e.shift()}return!0}function q8(t,e,i){BT(t)&&i.delete(e)}function Mpe(){YB=!1,jf!==null&&BT(jf)&&(jf=null),Wf!==null&&BT(Wf)&&(Wf=null),Xf!==null&&BT(Xf)&&(Xf=null),Bw.forEach(q8),Fw.forEach(q8)}function Px(t,e){t.blockedOn===e&&(t.blockedOn=null,YB||(YB=!0,Wo.unstable_scheduleCallback(Wo.unstable_NormalPriority,Mpe)))}function kw(t){function e(n){return Px(n,t)}if(0<jA.length){Px(jA[0],t);for(var i=1;i<jA.length;i++){var r=jA[i];r.blockedOn===t&&(r.blockedOn=null)}}for(jf!==null&&Px(jf,t),Wf!==null&&Px(Wf,t),Xf!==null&&Px(Xf,t),Bw.forEach(e),Fw.forEach(e),i=0;i<xf.length;i++)r=xf[i],r.blockedOn===t&&(r.blockedOn=null);for(;0<xf.length&&(i=xf[0],i.blockedOn===null);)NZ(i),i.blockedOn===null&&xf.shift()}var by=Sd.ReactCurrentBatchConfig,kC=!0;function Tpe(t,e,i,r){var n=ar,s=by.transition;by.transition=null;try{ar=1,Pz(t,e,i,r)}finally{ar=n,by.transition=s}}function Cpe(t,e,i,r){var n=ar,s=by.transition;by.transition=null;try{ar=4,Pz(t,e,i,r)}finally{ar=n,by.transition=s}}function Pz(t,e,i,r){if(kC){var n=qB(t,e,i,r);if(n===null)AI(t,e,r,NC,i),Y8(t,r);else if(Epe(n,t,e,i,r))r.stopPropagation();else if(Y8(t,r),e&4&&-1<Ape.indexOf(t)){for(;n!==null;){var s=$S(n);if(s!==null&&OZ(s),s=qB(t,e,i,r),s===null&&AI(t,e,r,NC,i),s===n)break;n=s}n!==null&&r.stopPropagation()}else AI(t,e,r,null,i)}}var NC=null;function qB(t,e,i,r){if(NC=null,t=Ez(r),t=km(t),t!==null)if(e=Jg(t),e===null)t=null;else if(i=e.tag,i===13){if(t=MZ(e),t!==null)return t;t=null}else if(i===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return NC=t,null}function UZ(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(mpe()){case Mz:return 1;case DZ:return 4;case BC:case gpe:return 16;case RZ:return 536870912;default:return 16}default:return 16}}var Tf=null,Dz=null,FT=null;function zZ(){if(FT)return FT;var t,e=Dz,i=e.length,r,n="value"in Tf?Tf.value:Tf.textContent,s=n.length;for(t=0;t<i&&e[t]===n[t];t++);var a=i-t;for(r=1;r<=a&&e[i-r]===n[s-r];r++);return FT=n.slice(t,1<r?1-r:void 0)}function kT(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function WA(){return!0}function K8(){return!1}function Qo(t){function e(i,r,n,s,a){this._reactName=i,this._targetInst=n,this.type=r,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(i=t[o],this[o]=i?i(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?WA:K8,this.isPropagationStopped=K8,this}return Qr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=WA)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=WA)},persist:function(){},isPersistent:WA}),e}var D1={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Rz=Qo(D1),QS=Qr({},D1,{view:0,detail:0}),Ppe=Qo(QS),mI,gI,Dx,zP=Qr({},QS,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Iz,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Dx&&(Dx&&t.type==="mousemove"?(mI=t.screenX-Dx.screenX,gI=t.screenY-Dx.screenY):gI=mI=0,Dx=t),mI)},movementY:function(t){return"movementY"in t?t.movementY:gI}}),Q8=Qo(zP),Dpe=Qr({},zP,{dataTransfer:0}),Rpe=Qo(Dpe),Ipe=Qr({},QS,{relatedTarget:0}),vI=Qo(Ipe),Lpe=Qr({},D1,{animationName:0,elapsedTime:0,pseudoElement:0}),Ope=Qo(Lpe),Bpe=Qr({},D1,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Fpe=Qo(Bpe),kpe=Qr({},D1,{data:0}),$8=Qo(kpe),Npe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Upe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zpe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Gpe(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=zpe[t])?!!e[t]:!1}function Iz(){return Gpe}var Vpe=Qr({},QS,{key:function(t){if(t.key){var e=Npe[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=kT(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Upe[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Iz,charCode:function(t){return t.type==="keypress"?kT(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?kT(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Hpe=Qo(Vpe),jpe=Qr({},zP,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),J8=Qo(jpe),Wpe=Qr({},QS,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Iz}),Xpe=Qo(Wpe),Ype=Qr({},D1,{propertyName:0,elapsedTime:0,pseudoElement:0}),qpe=Qo(Ype),Kpe=Qr({},zP,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Qpe=Qo(Kpe),$pe=[9,13,27,32],Lz=od&&"CompositionEvent"in window,Qb=null;od&&"documentMode"in document&&(Qb=document.documentMode);var Jpe=od&&"TextEvent"in window&&!Qb,GZ=od&&(!Lz||Qb&&8<Qb&&11>=Qb),Z8=" ",eH=!1;function VZ(t,e){switch(t){case"keyup":return $pe.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function HZ(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var zv=!1;function Zpe(t,e){switch(t){case"compositionend":return HZ(e);case"keypress":return e.which!==32?null:(eH=!0,Z8);case"textInput":return t=e.data,t===Z8&&eH?null:t;default:return null}}function eme(t,e){if(zv)return t==="compositionend"||!Lz&&VZ(t,e)?(t=zZ(),FT=Dz=Tf=null,zv=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return GZ&&e.locale!=="ko"?null:e.data;default:return null}}var tme={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tH(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!tme[t.type]:e==="textarea"}function jZ(t,e,i,r){wZ(r),e=UC(e,"onChange"),0<e.length&&(i=new Rz("onChange","change",null,i,r),t.push({event:i,listeners:e}))}var $b=null,Nw=null;function ime(t){tee(t,0)}function GP(t){var e=Hv(t);if(pZ(e))return t}function rme(t,e){if(t==="change")return e}var WZ=!1;if(od){var yI;if(od){var xI="oninput"in document;if(!xI){var iH=document.createElement("div");iH.setAttribute("oninput","return;"),xI=typeof iH.oninput=="function"}yI=xI}else yI=!1;WZ=yI&&(!document.documentMode||9<document.documentMode)}function rH(){$b&&($b.detachEvent("onpropertychange",XZ),Nw=$b=null)}function XZ(t){if(t.propertyName==="value"&&GP(Nw)){var e=[];jZ(e,Nw,t,Ez(t)),EZ(ime,e)}}function nme(t,e,i){t==="focusin"?(rH(),$b=e,Nw=i,$b.attachEvent("onpropertychange",XZ)):t==="focusout"&&rH()}function sme(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return GP(Nw)}function ame(t,e){if(t==="click")return GP(e)}function ome(t,e){if(t==="input"||t==="change")return GP(e)}function lme(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ic=typeof Object.is=="function"?Object.is:lme;function Uw(t,e){if(Ic(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++){var n=i[r];if(!DB.call(e,n)||!Ic(t[n],e[n]))return!1}return!0}function nH(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function sH(t,e){var i=nH(t);t=0;for(var r;i;){if(i.nodeType===3){if(r=t+i.textContent.length,t<=e&&r>=e)return{node:i,offset:e-t};t=r}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=nH(i)}}function YZ(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?YZ(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function qZ(){for(var t=window,e=IC();e instanceof t.HTMLIFrameElement;){try{var i=typeof e.contentWindow.location.href=="string"}catch{i=!1}if(i)t=e.contentWindow;else break;e=IC(t.document)}return e}function Oz(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function cme(t){var e=qZ(),i=t.focusedElem,r=t.selectionRange;if(e!==i&&i&&i.ownerDocument&&YZ(i.ownerDocument.documentElement,i)){if(r!==null&&Oz(i)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in i)i.selectionStart=e,i.selectionEnd=Math.min(t,i.value.length);else if(t=(e=i.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var n=i.textContent.length,s=Math.min(r.start,n);r=r.end===void 0?s:Math.min(r.end,n),!t.extend&&s>r&&(n=r,r=s,s=n),n=sH(i,s);var a=sH(i,r);n&&a&&(t.rangeCount!==1||t.anchorNode!==n.node||t.anchorOffset!==n.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(n.node,n.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=i;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<e.length;i++)t=e[i],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var hme=od&&"documentMode"in document&&11>=document.documentMode,Gv=null,KB=null,Jb=null,QB=!1;function aH(t,e,i){var r=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;QB||Gv==null||Gv!==IC(r)||(r=Gv,"selectionStart"in r&&Oz(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Jb&&Uw(Jb,r)||(Jb=r,r=UC(KB,"onSelect"),0<r.length&&(e=new Rz("onSelect","select",null,e,i),t.push({event:e,listeners:r}),e.target=Gv)))}function XA(t,e){var i={};return i[t.toLowerCase()]=e.toLowerCase(),i["Webkit"+t]="webkit"+e,i["Moz"+t]="moz"+e,i}var Vv={animationend:XA("Animation","AnimationEnd"),animationiteration:XA("Animation","AnimationIteration"),animationstart:XA("Animation","AnimationStart"),transitionend:XA("Transition","TransitionEnd")},bI={},KZ={};od&&(KZ=document.createElement("div").style,"AnimationEvent"in window||(delete Vv.animationend.animation,delete Vv.animationiteration.animation,delete Vv.animationstart.animation),"TransitionEvent"in window||delete Vv.transitionend.transition);function VP(t){if(bI[t])return bI[t];if(!Vv[t])return t;var e=Vv[t],i;for(i in e)if(e.hasOwnProperty(i)&&i in KZ)return bI[t]=e[i];return t}var QZ=VP("animationend"),$Z=VP("animationiteration"),JZ=VP("animationstart"),ZZ=VP("transitionend"),eee=new Map,oH="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ep(t,e){eee.set(t,e),$g(e,[t])}for(var wI=0;wI<oH.length;wI++){var SI=oH[wI],ume=SI.toLowerCase(),dme=SI[0].toUpperCase()+SI.slice(1);Ep(ume,"on"+dme)}Ep(QZ,"onAnimationEnd");Ep($Z,"onAnimationIteration");Ep(JZ,"onAnimationStart");Ep("dblclick","onDoubleClick");Ep("focusin","onFocus");Ep("focusout","onBlur");Ep(ZZ,"onTransitionEnd");Vy("onMouseEnter",["mouseout","mouseover"]);Vy("onMouseLeave",["mouseout","mouseover"]);Vy("onPointerEnter",["pointerout","pointerover"]);Vy("onPointerLeave",["pointerout","pointerover"]);$g("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));$g("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));$g("onBeforeInput",["compositionend","keypress","textInput","paste"]);$g("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));$g("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));$g("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pb="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fme=new Set("cancel close invalid load scroll toggle".split(" ").concat(Pb));function lH(t,e,i){var r=t.type||"unknown-event";t.currentTarget=i,upe(r,e,void 0,t),t.currentTarget=null}function tee(t,e){e=(e&4)!==0;for(var i=0;i<t.length;i++){var r=t[i],n=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&n.isPropagationStopped())break e;lH(n,o,c),s=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,c=o.currentTarget,o=o.listener,l!==s&&n.isPropagationStopped())break e;lH(n,o,c),s=l}}}if(OC)throw t=WB,OC=!1,WB=null,t}function Mr(t,e){var i=e[tF];i===void 0&&(i=e[tF]=new Set);var r=t+"__bubble";i.has(r)||(iee(e,t,2,!1),i.add(r))}function _I(t,e,i){var r=0;e&&(r|=4),iee(i,t,r,e)}var YA="_reactListening"+Math.random().toString(36).slice(2);function zw(t){if(!t[YA]){t[YA]=!0,cZ.forEach(function(i){i!=="selectionchange"&&(fme.has(i)||_I(i,!1,t),_I(i,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[YA]||(e[YA]=!0,_I("selectionchange",!1,e))}}function iee(t,e,i,r){switch(UZ(e)){case 1:var n=Tpe;break;case 4:n=Cpe;break;default:n=Pz}i=n.bind(null,e,i,t),n=void 0,!jB||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(n=!0),r?n!==void 0?t.addEventListener(e,i,{capture:!0,passive:n}):t.addEventListener(e,i,!0):n!==void 0?t.addEventListener(e,i,{passive:n}):t.addEventListener(e,i,!1)}function AI(t,e,i,r,n){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===n||o.nodeType===8&&o.parentNode===n)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;a=a.return}for(;o!==null;){if(a=km(o),a===null)return;if(l=a.tag,l===5||l===6){r=s=a;continue e}o=o.parentNode}}r=r.return}EZ(function(){var c=s,h=Ez(i),u=[];e:{var d=eee.get(t);if(d!==void 0){var f=Rz,p=t;switch(t){case"keypress":if(kT(i)===0)break e;case"keydown":case"keyup":f=Hpe;break;case"focusin":p="focus",f=vI;break;case"focusout":p="blur",f=vI;break;case"beforeblur":case"afterblur":f=vI;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Q8;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=Rpe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=Xpe;break;case QZ:case $Z:case JZ:f=Ope;break;case ZZ:f=qpe;break;case"scroll":f=Ppe;break;case"wheel":f=Qpe;break;case"copy":case"cut":case"paste":f=Fpe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=J8}var m=(e&4)!==0,g=!m&&t==="scroll",v=m?d!==null?d+"Capture":null:d;m=[];for(var y=c,x;y!==null;){x=y;var S=x.stateNode;if(x.tag===5&&S!==null&&(x=S,v!==null&&(S=Ow(y,v),S!=null&&m.push(Gw(y,S,x)))),g)break;y=y.return}0<m.length&&(d=new f(d,p,null,i,h),u.push({event:d,listeners:m}))}}if(!(e&7)){e:{if(d=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",d&&i!==VB&&(p=i.relatedTarget||i.fromElement)&&(km(p)||p[ld]))break e;if((f||d)&&(d=h.window===h?h:(d=h.ownerDocument)?d.defaultView||d.parentWindow:window,f?(p=i.relatedTarget||i.toElement,f=c,p=p?km(p):null,p!==null&&(g=Jg(p),p!==g||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=c),f!==p)){if(m=Q8,S="onMouseLeave",v="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(m=J8,S="onPointerLeave",v="onPointerEnter",y="pointer"),g=f==null?d:Hv(f),x=p==null?d:Hv(p),d=new m(S,y+"leave",f,i,h),d.target=g,d.relatedTarget=x,S=null,km(h)===c&&(m=new m(v,y+"enter",p,i,h),m.target=x,m.relatedTarget=g,S=m),g=S,f&&p)t:{for(m=f,v=p,y=0,x=m;x;x=A0(x))y++;for(x=0,S=v;S;S=A0(S))x++;for(;0<y-x;)m=A0(m),y--;for(;0<x-y;)v=A0(v),x--;for(;y--;){if(m===v||v!==null&&m===v.alternate)break t;m=A0(m),v=A0(v)}m=null}else m=null;f!==null&&cH(u,d,f,m,!1),p!==null&&g!==null&&cH(u,g,p,m,!0)}}e:{if(d=c?Hv(c):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var A=rme;else if(tH(d))if(WZ)A=ome;else{A=sme;var _=nme}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(A=ame);if(A&&(A=A(t,c))){jZ(u,A,i,h);break e}_&&_(t,d,c),t==="focusout"&&(_=d._wrapperState)&&_.controlled&&d.type==="number"&&kB(d,"number",d.value)}switch(_=c?Hv(c):window,t){case"focusin":(tH(_)||_.contentEditable==="true")&&(Gv=_,KB=c,Jb=null);break;case"focusout":Jb=KB=Gv=null;break;case"mousedown":QB=!0;break;case"contextmenu":case"mouseup":case"dragend":QB=!1,aH(u,i,h);break;case"selectionchange":if(hme)break;case"keydown":case"keyup":aH(u,i,h)}var M;if(Lz)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else zv?VZ(t,i)&&(E="onCompositionEnd"):t==="keydown"&&i.keyCode===229&&(E="onCompositionStart");E&&(GZ&&i.locale!=="ko"&&(zv||E!=="onCompositionStart"?E==="onCompositionEnd"&&zv&&(M=zZ()):(Tf=h,Dz="value"in Tf?Tf.value:Tf.textContent,zv=!0)),_=UC(c,E),0<_.length&&(E=new $8(E,t,null,i,h),u.push({event:E,listeners:_}),M?E.data=M:(M=HZ(i),M!==null&&(E.data=M)))),(M=Jpe?Zpe(t,i):eme(t,i))&&(c=UC(c,"onBeforeInput"),0<c.length&&(h=new $8("onBeforeInput","beforeinput",null,i,h),u.push({event:h,listeners:c}),h.data=M))}tee(u,e)})}function Gw(t,e,i){return{instance:t,listener:e,currentTarget:i}}function UC(t,e){for(var i=e+"Capture",r=[];t!==null;){var n=t,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=Ow(t,i),s!=null&&r.unshift(Gw(t,s,n)),s=Ow(t,e),s!=null&&r.push(Gw(t,s,n))),t=t.return}return r}function A0(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function cH(t,e,i,r,n){for(var s=e._reactName,a=[];i!==null&&i!==r;){var o=i,l=o.alternate,c=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&c!==null&&(o=c,n?(l=Ow(i,s),l!=null&&a.unshift(Gw(i,l,o))):n||(l=Ow(i,s),l!=null&&a.push(Gw(i,l,o)))),i=i.return}a.length!==0&&t.push({event:e,listeners:a})}var pme=/\r\n?/g,mme=/\u0000|\uFFFD/g;function hH(t){return(typeof t=="string"?t:""+t).replace(pme,`
`).replace(mme,"")}function qA(t,e,i){if(e=hH(e),hH(t)!==e&&i)throw Error(pt(425))}function zC(){}var $B=null,JB=null;function ZB(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var eF=typeof setTimeout=="function"?setTimeout:void 0,gme=typeof clearTimeout=="function"?clearTimeout:void 0,uH=typeof Promise=="function"?Promise:void 0,vme=typeof queueMicrotask=="function"?queueMicrotask:typeof uH<"u"?function(t){return uH.resolve(null).then(t).catch(yme)}:eF;function yme(t){setTimeout(function(){throw t})}function EI(t,e){var i=e,r=0;do{var n=i.nextSibling;if(t.removeChild(i),n&&n.nodeType===8)if(i=n.data,i==="/$"){if(r===0){t.removeChild(n),kw(e);return}r--}else i!=="$"&&i!=="$?"&&i!=="$!"||r++;i=n}while(i);kw(e)}function Yf(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function dH(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="$"||i==="$!"||i==="$?"){if(e===0)return t;e--}else i==="/$"&&e++}t=t.previousSibling}return null}var R1=Math.random().toString(36).slice(2),xh="__reactFiber$"+R1,Vw="__reactProps$"+R1,ld="__reactContainer$"+R1,tF="__reactEvents$"+R1,xme="__reactListeners$"+R1,bme="__reactHandles$"+R1;function km(t){var e=t[xh];if(e)return e;for(var i=t.parentNode;i;){if(e=i[ld]||i[xh]){if(i=e.alternate,e.child!==null||i!==null&&i.child!==null)for(t=dH(t);t!==null;){if(i=t[xh])return i;t=dH(t)}return e}t=i,i=t.parentNode}return null}function $S(t){return t=t[xh]||t[ld],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Hv(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(pt(33))}function HP(t){return t[Vw]||null}var iF=[],jv=-1;function Mp(t){return{current:t}}function Pr(t){0>jv||(t.current=iF[jv],iF[jv]=null,jv--)}function _r(t,e){jv++,iF[jv]=t.current,t.current=e}var lp={},xa=Mp(lp),fo=Mp(!1),Tg=lp;function Hy(t,e){var i=t.type.contextTypes;if(!i)return lp;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in i)n[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=n),n}function po(t){return t=t.childContextTypes,t!=null}function GC(){Pr(fo),Pr(xa)}function fH(t,e,i){if(xa.current!==lp)throw Error(pt(168));_r(xa,e),_r(fo,i)}function ree(t,e,i){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return i;r=r.getChildContext();for(var n in r)if(!(n in e))throw Error(pt(108,npe(t)||"Unknown",n));return Qr({},i,r)}function VC(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||lp,Tg=xa.current,_r(xa,t),_r(fo,fo.current),!0}function pH(t,e,i){var r=t.stateNode;if(!r)throw Error(pt(169));i?(t=ree(t,e,Tg),r.__reactInternalMemoizedMergedChildContext=t,Pr(fo),Pr(xa),_r(xa,t)):Pr(fo),_r(fo,i)}var Lu=null,jP=!1,MI=!1;function nee(t){Lu===null?Lu=[t]:Lu.push(t)}function wme(t){jP=!0,nee(t)}function Tp(){if(!MI&&Lu!==null){MI=!0;var t=0,e=ar;try{var i=Lu;for(ar=1;t<i.length;t++){var r=i[t];do r=r(!0);while(r!==null)}Lu=null,jP=!1}catch(n){throw Lu!==null&&(Lu=Lu.slice(t+1)),PZ(Mz,Tp),n}finally{ar=e,MI=!1}}return null}var Wv=[],Xv=0,HC=null,jC=0,Ml=[],Tl=0,Cg=null,Hu=1,ju="";function vm(t,e){Wv[Xv++]=jC,Wv[Xv++]=HC,HC=t,jC=e}function see(t,e,i){Ml[Tl++]=Hu,Ml[Tl++]=ju,Ml[Tl++]=Cg,Cg=t;var r=Hu;t=ju;var n=32-Tc(r)-1;r&=~(1<<n),i+=1;var s=32-Tc(e)+n;if(30<s){var a=n-n%5;s=(r&(1<<a)-1).toString(32),r>>=a,n-=a,Hu=1<<32-Tc(e)+n|i<<n|r,ju=s+t}else Hu=1<<s|i<<n|r,ju=t}function Bz(t){t.return!==null&&(vm(t,1),see(t,1,0))}function Fz(t){for(;t===HC;)HC=Wv[--Xv],Wv[Xv]=null,jC=Wv[--Xv],Wv[Xv]=null;for(;t===Cg;)Cg=Ml[--Tl],Ml[Tl]=null,ju=Ml[--Tl],Ml[Tl]=null,Hu=Ml[--Tl],Ml[Tl]=null}var zo=null,Fo=null,Lr=!1,xc=null;function aee(t,e){var i=Ll(5,null,null,0);i.elementType="DELETED",i.stateNode=e,i.return=t,e=t.deletions,e===null?(t.deletions=[i],t.flags|=16):e.push(i)}function mH(t,e){switch(t.tag){case 5:var i=t.type;return e=e.nodeType!==1||i.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,zo=t,Fo=Yf(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,zo=t,Fo=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(i=Cg!==null?{id:Hu,overflow:ju}:null,t.memoizedState={dehydrated:e,treeContext:i,retryLane:1073741824},i=Ll(18,null,null,0),i.stateNode=e,i.return=t,t.child=i,zo=t,Fo=null,!0):!1;default:return!1}}function rF(t){return(t.mode&1)!==0&&(t.flags&128)===0}function nF(t){if(Lr){var e=Fo;if(e){var i=e;if(!mH(t,e)){if(rF(t))throw Error(pt(418));e=Yf(i.nextSibling);var r=zo;e&&mH(t,e)?aee(r,i):(t.flags=t.flags&-4097|2,Lr=!1,zo=t)}}else{if(rF(t))throw Error(pt(418));t.flags=t.flags&-4097|2,Lr=!1,zo=t}}}function gH(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;zo=t}function KA(t){if(t!==zo)return!1;if(!Lr)return gH(t),Lr=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!ZB(t.type,t.memoizedProps)),e&&(e=Fo)){if(rF(t))throw oee(),Error(pt(418));for(;e;)aee(t,e),e=Yf(e.nextSibling)}if(gH(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(pt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="/$"){if(e===0){Fo=Yf(t.nextSibling);break e}e--}else i!=="$"&&i!=="$!"&&i!=="$?"||e++}t=t.nextSibling}Fo=null}}else Fo=zo?Yf(t.stateNode.nextSibling):null;return!0}function oee(){for(var t=Fo;t;)t=Yf(t.nextSibling)}function jy(){Fo=zo=null,Lr=!1}function kz(t){xc===null?xc=[t]:xc.push(t)}var Sme=Sd.ReactCurrentBatchConfig;function Rx(t,e,i){if(t=i.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(pt(309));var r=i.stateNode}if(!r)throw Error(pt(147,t));var n=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var o=n.refs;a===null?delete o[s]:o[s]=a},e._stringRef=s,e)}if(typeof t!="string")throw Error(pt(284));if(!i._owner)throw Error(pt(290,t))}return t}function QA(t,e){throw t=Object.prototype.toString.call(e),Error(pt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function vH(t){var e=t._init;return e(t._payload)}function lee(t){function e(v,y){if(t){var x=v.deletions;x===null?(v.deletions=[y],v.flags|=16):x.push(y)}}function i(v,y){if(!t)return null;for(;y!==null;)e(v,y),y=y.sibling;return null}function r(v,y){for(v=new Map;y!==null;)y.key!==null?v.set(y.key,y):v.set(y.index,y),y=y.sibling;return v}function n(v,y){return v=$f(v,y),v.index=0,v.sibling=null,v}function s(v,y,x){return v.index=x,t?(x=v.alternate,x!==null?(x=x.index,x<y?(v.flags|=2,y):x):(v.flags|=2,y)):(v.flags|=1048576,y)}function a(v){return t&&v.alternate===null&&(v.flags|=2),v}function o(v,y,x,S){return y===null||y.tag!==6?(y=LI(x,v.mode,S),y.return=v,y):(y=n(y,x),y.return=v,y)}function l(v,y,x,S){var A=x.type;return A===Uv?h(v,y,x.props.children,S,x.key):y!==null&&(y.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===pf&&vH(A)===y.type)?(S=n(y,x.props),S.ref=Rx(v,y,x),S.return=v,S):(S=jT(x.type,x.key,x.props,null,v.mode,S),S.ref=Rx(v,y,x),S.return=v,S)}function c(v,y,x,S){return y===null||y.tag!==4||y.stateNode.containerInfo!==x.containerInfo||y.stateNode.implementation!==x.implementation?(y=OI(x,v.mode,S),y.return=v,y):(y=n(y,x.children||[]),y.return=v,y)}function h(v,y,x,S,A){return y===null||y.tag!==7?(y=ag(x,v.mode,S,A),y.return=v,y):(y=n(y,x),y.return=v,y)}function u(v,y,x){if(typeof y=="string"&&y!==""||typeof y=="number")return y=LI(""+y,v.mode,x),y.return=v,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case UA:return x=jT(y.type,y.key,y.props,null,v.mode,x),x.ref=Rx(v,null,y),x.return=v,x;case Nv:return y=OI(y,v.mode,x),y.return=v,y;case pf:var S=y._init;return u(v,S(y._payload),x)}if(Tb(y)||Mx(y))return y=ag(y,v.mode,x,null),y.return=v,y;QA(v,y)}return null}function d(v,y,x,S){var A=y!==null?y.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return A!==null?null:o(v,y,""+x,S);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case UA:return x.key===A?l(v,y,x,S):null;case Nv:return x.key===A?c(v,y,x,S):null;case pf:return A=x._init,d(v,y,A(x._payload),S)}if(Tb(x)||Mx(x))return A!==null?null:h(v,y,x,S,null);QA(v,x)}return null}function f(v,y,x,S,A){if(typeof S=="string"&&S!==""||typeof S=="number")return v=v.get(x)||null,o(y,v,""+S,A);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case UA:return v=v.get(S.key===null?x:S.key)||null,l(y,v,S,A);case Nv:return v=v.get(S.key===null?x:S.key)||null,c(y,v,S,A);case pf:var _=S._init;return f(v,y,x,_(S._payload),A)}if(Tb(S)||Mx(S))return v=v.get(x)||null,h(y,v,S,A,null);QA(y,S)}return null}function p(v,y,x,S){for(var A=null,_=null,M=y,E=y=0,T=null;M!==null&&E<x.length;E++){M.index>E?(T=M,M=null):T=M.sibling;var C=d(v,M,x[E],S);if(C===null){M===null&&(M=T);break}t&&M&&C.alternate===null&&e(v,M),y=s(C,y,E),_===null?A=C:_.sibling=C,_=C,M=T}if(E===x.length)return i(v,M),Lr&&vm(v,E),A;if(M===null){for(;E<x.length;E++)M=u(v,x[E],S),M!==null&&(y=s(M,y,E),_===null?A=M:_.sibling=M,_=M);return Lr&&vm(v,E),A}for(M=r(v,M);E<x.length;E++)T=f(M,v,E,x[E],S),T!==null&&(t&&T.alternate!==null&&M.delete(T.key===null?E:T.key),y=s(T,y,E),_===null?A=T:_.sibling=T,_=T);return t&&M.forEach(function(D){return e(v,D)}),Lr&&vm(v,E),A}function m(v,y,x,S){var A=Mx(x);if(typeof A!="function")throw Error(pt(150));if(x=A.call(x),x==null)throw Error(pt(151));for(var _=A=null,M=y,E=y=0,T=null,C=x.next();M!==null&&!C.done;E++,C=x.next()){M.index>E?(T=M,M=null):T=M.sibling;var D=d(v,M,C.value,S);if(D===null){M===null&&(M=T);break}t&&M&&D.alternate===null&&e(v,M),y=s(D,y,E),_===null?A=D:_.sibling=D,_=D,M=T}if(C.done)return i(v,M),Lr&&vm(v,E),A;if(M===null){for(;!C.done;E++,C=x.next())C=u(v,C.value,S),C!==null&&(y=s(C,y,E),_===null?A=C:_.sibling=C,_=C);return Lr&&vm(v,E),A}for(M=r(v,M);!C.done;E++,C=x.next())C=f(M,v,E,C.value,S),C!==null&&(t&&C.alternate!==null&&M.delete(C.key===null?E:C.key),y=s(C,y,E),_===null?A=C:_.sibling=C,_=C);return t&&M.forEach(function(B){return e(v,B)}),Lr&&vm(v,E),A}function g(v,y,x,S){if(typeof x=="object"&&x!==null&&x.type===Uv&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case UA:e:{for(var A=x.key,_=y;_!==null;){if(_.key===A){if(A=x.type,A===Uv){if(_.tag===7){i(v,_.sibling),y=n(_,x.props.children),y.return=v,v=y;break e}}else if(_.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===pf&&vH(A)===_.type){i(v,_.sibling),y=n(_,x.props),y.ref=Rx(v,_,x),y.return=v,v=y;break e}i(v,_);break}else e(v,_);_=_.sibling}x.type===Uv?(y=ag(x.props.children,v.mode,S,x.key),y.return=v,v=y):(S=jT(x.type,x.key,x.props,null,v.mode,S),S.ref=Rx(v,y,x),S.return=v,v=S)}return a(v);case Nv:e:{for(_=x.key;y!==null;){if(y.key===_)if(y.tag===4&&y.stateNode.containerInfo===x.containerInfo&&y.stateNode.implementation===x.implementation){i(v,y.sibling),y=n(y,x.children||[]),y.return=v,v=y;break e}else{i(v,y);break}else e(v,y);y=y.sibling}y=OI(x,v.mode,S),y.return=v,v=y}return a(v);case pf:return _=x._init,g(v,y,_(x._payload),S)}if(Tb(x))return p(v,y,x,S);if(Mx(x))return m(v,y,x,S);QA(v,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,y!==null&&y.tag===6?(i(v,y.sibling),y=n(y,x),y.return=v,v=y):(i(v,y),y=LI(x,v.mode,S),y.return=v,v=y),a(v)):i(v,y)}return g}var Wy=lee(!0),cee=lee(!1),WC=Mp(null),XC=null,Yv=null,Nz=null;function Uz(){Nz=Yv=XC=null}function zz(t){var e=WC.current;Pr(WC),t._currentValue=e}function sF(t,e,i){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===i)break;t=t.return}}function wy(t,e){XC=t,Nz=Yv=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(lo=!0),t.firstContext=null)}function Gl(t){var e=t._currentValue;if(Nz!==t)if(t={context:t,memoizedValue:e,next:null},Yv===null){if(XC===null)throw Error(pt(308));Yv=t,XC.dependencies={lanes:0,firstContext:t}}else Yv=Yv.next=t;return e}var Nm=null;function Gz(t){Nm===null?Nm=[t]:Nm.push(t)}function hee(t,e,i,r){var n=e.interleaved;return n===null?(i.next=i,Gz(e)):(i.next=n.next,n.next=i),e.interleaved=i,cd(t,r)}function cd(t,e){t.lanes|=e;var i=t.alternate;for(i!==null&&(i.lanes|=e),i=t,t=t.return;t!==null;)t.childLanes|=e,i=t.alternate,i!==null&&(i.childLanes|=e),i=t,t=t.return;return i.tag===3?i.stateNode:null}var mf=!1;function Vz(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function uee(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ed(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function qf(t,e,i){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Gi&2){var n=r.pending;return n===null?e.next=e:(e.next=n.next,n.next=e),r.pending=e,cd(t,i)}return n=r.interleaved,n===null?(e.next=e,Gz(r)):(e.next=n.next,n.next=e),r.interleaved=e,cd(t,i)}function NT(t,e,i){if(e=e.updateQueue,e!==null&&(e=e.shared,(i&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,i|=r,e.lanes=i,Tz(t,i)}}function yH(t,e){var i=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,i===r)){var n=null,s=null;if(i=i.firstBaseUpdate,i!==null){do{var a={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};s===null?n=s=a:s=s.next=a,i=i.next}while(i!==null);s===null?n=s=e:s=s.next=e}else n=s=e;i={baseState:r.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=i;return}t=i.lastBaseUpdate,t===null?i.firstBaseUpdate=e:t.next=e,i.lastBaseUpdate=e}function YC(t,e,i,r){var n=t.updateQueue;mf=!1;var s=n.firstBaseUpdate,a=n.lastBaseUpdate,o=n.shared.pending;if(o!==null){n.shared.pending=null;var l=o,c=l.next;l.next=null,a===null?s=c:a.next=c,a=l;var h=t.alternate;h!==null&&(h=h.updateQueue,o=h.lastBaseUpdate,o!==a&&(o===null?h.firstBaseUpdate=c:o.next=c,h.lastBaseUpdate=l))}if(s!==null){var u=n.baseState;a=0,h=c=l=null,o=s;do{var d=o.lane,f=o.eventTime;if((r&d)===d){h!==null&&(h=h.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=t,m=o;switch(d=e,f=i,m.tag){case 1:if(p=m.payload,typeof p=="function"){u=p.call(f,u,d);break e}u=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,d=typeof p=="function"?p.call(f,u,d):p,d==null)break e;u=Qr({},u,d);break e;case 2:mf=!0}}o.callback!==null&&o.lane!==0&&(t.flags|=64,d=n.effects,d===null?n.effects=[o]:d.push(o))}else f={eventTime:f,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},h===null?(c=h=f,l=u):h=h.next=f,a|=d;if(o=o.next,o===null){if(o=n.shared.pending,o===null)break;d=o,o=d.next,d.next=null,n.lastBaseUpdate=d,n.shared.pending=null}}while(!0);if(h===null&&(l=u),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=h,e=n.shared.interleaved,e!==null){n=e;do a|=n.lane,n=n.next;while(n!==e)}else s===null&&(n.shared.lanes=0);Dg|=a,t.lanes=a,t.memoizedState=u}}function xH(t,e,i){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],n=r.callback;if(n!==null){if(r.callback=null,r=i,typeof n!="function")throw Error(pt(191,n));n.call(r)}}}var JS={},Dh=Mp(JS),Hw=Mp(JS),jw=Mp(JS);function Um(t){if(t===JS)throw Error(pt(174));return t}function Hz(t,e){switch(_r(jw,e),_r(Hw,t),_r(Dh,JS),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:UB(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=UB(e,t)}Pr(Dh),_r(Dh,e)}function Xy(){Pr(Dh),Pr(Hw),Pr(jw)}function dee(t){Um(jw.current);var e=Um(Dh.current),i=UB(e,t.type);e!==i&&(_r(Hw,t),_r(Dh,i))}function jz(t){Hw.current===t&&(Pr(Dh),Pr(Hw))}var Gr=Mp(0);function qC(t){for(var e=t;e!==null;){if(e.tag===13){var i=e.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var TI=[];function Wz(){for(var t=0;t<TI.length;t++)TI[t]._workInProgressVersionPrimary=null;TI.length=0}var UT=Sd.ReactCurrentDispatcher,CI=Sd.ReactCurrentBatchConfig,Pg=0,qr=null,$n=null,xs=null,KC=!1,Zb=!1,Ww=0,_me=0;function ra(){throw Error(pt(321))}function Xz(t,e){if(e===null)return!1;for(var i=0;i<e.length&&i<t.length;i++)if(!Ic(t[i],e[i]))return!1;return!0}function Yz(t,e,i,r,n,s){if(Pg=s,qr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,UT.current=t===null||t.memoizedState===null?Tme:Cme,t=i(r,n),Zb){s=0;do{if(Zb=!1,Ww=0,25<=s)throw Error(pt(301));s+=1,xs=$n=null,e.updateQueue=null,UT.current=Pme,t=i(r,n)}while(Zb)}if(UT.current=QC,e=$n!==null&&$n.next!==null,Pg=0,xs=$n=qr=null,KC=!1,e)throw Error(pt(300));return t}function qz(){var t=Ww!==0;return Ww=0,t}function hh(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return xs===null?qr.memoizedState=xs=t:xs=xs.next=t,xs}function Vl(){if($n===null){var t=qr.alternate;t=t!==null?t.memoizedState:null}else t=$n.next;var e=xs===null?qr.memoizedState:xs.next;if(e!==null)xs=e,$n=t;else{if(t===null)throw Error(pt(310));$n=t,t={memoizedState:$n.memoizedState,baseState:$n.baseState,baseQueue:$n.baseQueue,queue:$n.queue,next:null},xs===null?qr.memoizedState=xs=t:xs=xs.next=t}return xs}function Xw(t,e){return typeof e=="function"?e(t):e}function PI(t){var e=Vl(),i=e.queue;if(i===null)throw Error(pt(311));i.lastRenderedReducer=t;var r=$n,n=r.baseQueue,s=i.pending;if(s!==null){if(n!==null){var a=n.next;n.next=s.next,s.next=a}r.baseQueue=n=s,i.pending=null}if(n!==null){s=n.next,r=r.baseState;var o=a=null,l=null,c=s;do{var h=c.lane;if((Pg&h)===h)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:t(r,c.action);else{var u={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(o=l=u,a=r):l=l.next=u,qr.lanes|=h,Dg|=h}c=c.next}while(c!==null&&c!==s);l===null?a=r:l.next=o,Ic(r,e.memoizedState)||(lo=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=l,i.lastRenderedState=r}if(t=i.interleaved,t!==null){n=t;do s=n.lane,qr.lanes|=s,Dg|=s,n=n.next;while(n!==t)}else n===null&&(i.lanes=0);return[e.memoizedState,i.dispatch]}function DI(t){var e=Vl(),i=e.queue;if(i===null)throw Error(pt(311));i.lastRenderedReducer=t;var r=i.dispatch,n=i.pending,s=e.memoizedState;if(n!==null){i.pending=null;var a=n=n.next;do s=t(s,a.action),a=a.next;while(a!==n);Ic(s,e.memoizedState)||(lo=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),i.lastRenderedState=s}return[s,r]}function fee(){}function pee(t,e){var i=qr,r=Vl(),n=e(),s=!Ic(r.memoizedState,n);if(s&&(r.memoizedState=n,lo=!0),r=r.queue,Kz(vee.bind(null,i,r,t),[t]),r.getSnapshot!==e||s||xs!==null&&xs.memoizedState.tag&1){if(i.flags|=2048,Yw(9,gee.bind(null,i,r,n,e),void 0,null),Ps===null)throw Error(pt(349));Pg&30||mee(i,e,n)}return n}function mee(t,e,i){t.flags|=16384,t={getSnapshot:e,value:i},e=qr.updateQueue,e===null?(e={lastEffect:null,stores:null},qr.updateQueue=e,e.stores=[t]):(i=e.stores,i===null?e.stores=[t]:i.push(t))}function gee(t,e,i,r){e.value=i,e.getSnapshot=r,yee(e)&&xee(t)}function vee(t,e,i){return i(function(){yee(e)&&xee(t)})}function yee(t){var e=t.getSnapshot;t=t.value;try{var i=e();return!Ic(t,i)}catch{return!0}}function xee(t){var e=cd(t,1);e!==null&&Cc(e,t,1,-1)}function bH(t){var e=hh();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xw,lastRenderedState:t},e.queue=t,t=t.dispatch=Mme.bind(null,qr,t),[e.memoizedState,t]}function Yw(t,e,i,r){return t={tag:t,create:e,destroy:i,deps:r,next:null},e=qr.updateQueue,e===null?(e={lastEffect:null,stores:null},qr.updateQueue=e,e.lastEffect=t.next=t):(i=e.lastEffect,i===null?e.lastEffect=t.next=t:(r=i.next,i.next=t,t.next=r,e.lastEffect=t)),t}function bee(){return Vl().memoizedState}function zT(t,e,i,r){var n=hh();qr.flags|=t,n.memoizedState=Yw(1|e,i,void 0,r===void 0?null:r)}function WP(t,e,i,r){var n=Vl();r=r===void 0?null:r;var s=void 0;if($n!==null){var a=$n.memoizedState;if(s=a.destroy,r!==null&&Xz(r,a.deps)){n.memoizedState=Yw(e,i,s,r);return}}qr.flags|=t,n.memoizedState=Yw(1|e,i,s,r)}function wH(t,e){return zT(8390656,8,t,e)}function Kz(t,e){return WP(2048,8,t,e)}function wee(t,e){return WP(4,2,t,e)}function See(t,e){return WP(4,4,t,e)}function _ee(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Aee(t,e,i){return i=i!=null?i.concat([t]):null,WP(4,4,_ee.bind(null,e,t),i)}function Qz(){}function Eee(t,e){var i=Vl();e=e===void 0?null:e;var r=i.memoizedState;return r!==null&&e!==null&&Xz(e,r[1])?r[0]:(i.memoizedState=[t,e],t)}function Mee(t,e){var i=Vl();e=e===void 0?null:e;var r=i.memoizedState;return r!==null&&e!==null&&Xz(e,r[1])?r[0]:(t=t(),i.memoizedState=[t,e],t)}function Tee(t,e,i){return Pg&21?(Ic(i,e)||(i=IZ(),qr.lanes|=i,Dg|=i,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,lo=!0),t.memoizedState=i)}function Ame(t,e){var i=ar;ar=i!==0&&4>i?i:4,t(!0);var r=CI.transition;CI.transition={};try{t(!1),e()}finally{ar=i,CI.transition=r}}function Cee(){return Vl().memoizedState}function Eme(t,e,i){var r=Qf(t);if(i={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null},Pee(t))Dee(e,i);else if(i=hee(t,e,i,r),i!==null){var n=Va();Cc(i,t,r,n),Ree(i,e,r)}}function Mme(t,e,i){var r=Qf(t),n={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null};if(Pee(t))Dee(e,n);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,o=s(a,i);if(n.hasEagerState=!0,n.eagerState=o,Ic(o,a)){var l=e.interleaved;l===null?(n.next=n,Gz(e)):(n.next=l.next,l.next=n),e.interleaved=n;return}}catch{}finally{}i=hee(t,e,n,r),i!==null&&(n=Va(),Cc(i,t,r,n),Ree(i,e,r))}}function Pee(t){var e=t.alternate;return t===qr||e!==null&&e===qr}function Dee(t,e){Zb=KC=!0;var i=t.pending;i===null?e.next=e:(e.next=i.next,i.next=e),t.pending=e}function Ree(t,e,i){if(i&4194240){var r=e.lanes;r&=t.pendingLanes,i|=r,e.lanes=i,Tz(t,i)}}var QC={readContext:Gl,useCallback:ra,useContext:ra,useEffect:ra,useImperativeHandle:ra,useInsertionEffect:ra,useLayoutEffect:ra,useMemo:ra,useReducer:ra,useRef:ra,useState:ra,useDebugValue:ra,useDeferredValue:ra,useTransition:ra,useMutableSource:ra,useSyncExternalStore:ra,useId:ra,unstable_isNewReconciler:!1},Tme={readContext:Gl,useCallback:function(t,e){return hh().memoizedState=[t,e===void 0?null:e],t},useContext:Gl,useEffect:wH,useImperativeHandle:function(t,e,i){return i=i!=null?i.concat([t]):null,zT(4194308,4,_ee.bind(null,e,t),i)},useLayoutEffect:function(t,e){return zT(4194308,4,t,e)},useInsertionEffect:function(t,e){return zT(4,2,t,e)},useMemo:function(t,e){var i=hh();return e=e===void 0?null:e,t=t(),i.memoizedState=[t,e],t},useReducer:function(t,e,i){var r=hh();return e=i!==void 0?i(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=Eme.bind(null,qr,t),[r.memoizedState,t]},useRef:function(t){var e=hh();return t={current:t},e.memoizedState=t},useState:bH,useDebugValue:Qz,useDeferredValue:function(t){return hh().memoizedState=t},useTransition:function(){var t=bH(!1),e=t[0];return t=Ame.bind(null,t[1]),hh().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,i){var r=qr,n=hh();if(Lr){if(i===void 0)throw Error(pt(407));i=i()}else{if(i=e(),Ps===null)throw Error(pt(349));Pg&30||mee(r,e,i)}n.memoizedState=i;var s={value:i,getSnapshot:e};return n.queue=s,wH(vee.bind(null,r,s,t),[t]),r.flags|=2048,Yw(9,gee.bind(null,r,s,i,e),void 0,null),i},useId:function(){var t=hh(),e=Ps.identifierPrefix;if(Lr){var i=ju,r=Hu;i=(r&~(1<<32-Tc(r)-1)).toString(32)+i,e=":"+e+"R"+i,i=Ww++,0<i&&(e+="H"+i.toString(32)),e+=":"}else i=_me++,e=":"+e+"r"+i.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Cme={readContext:Gl,useCallback:Eee,useContext:Gl,useEffect:Kz,useImperativeHandle:Aee,useInsertionEffect:wee,useLayoutEffect:See,useMemo:Mee,useReducer:PI,useRef:bee,useState:function(){return PI(Xw)},useDebugValue:Qz,useDeferredValue:function(t){var e=Vl();return Tee(e,$n.memoizedState,t)},useTransition:function(){var t=PI(Xw)[0],e=Vl().memoizedState;return[t,e]},useMutableSource:fee,useSyncExternalStore:pee,useId:Cee,unstable_isNewReconciler:!1},Pme={readContext:Gl,useCallback:Eee,useContext:Gl,useEffect:Kz,useImperativeHandle:Aee,useInsertionEffect:wee,useLayoutEffect:See,useMemo:Mee,useReducer:DI,useRef:bee,useState:function(){return DI(Xw)},useDebugValue:Qz,useDeferredValue:function(t){var e=Vl();return $n===null?e.memoizedState=t:Tee(e,$n.memoizedState,t)},useTransition:function(){var t=DI(Xw)[0],e=Vl().memoizedState;return[t,e]},useMutableSource:fee,useSyncExternalStore:pee,useId:Cee,unstable_isNewReconciler:!1};function vc(t,e){if(t&&t.defaultProps){e=Qr({},e),t=t.defaultProps;for(var i in t)e[i]===void 0&&(e[i]=t[i]);return e}return e}function aF(t,e,i,r){e=t.memoizedState,i=i(r,e),i=i==null?e:Qr({},e,i),t.memoizedState=i,t.lanes===0&&(t.updateQueue.baseState=i)}var XP={isMounted:function(t){return(t=t._reactInternals)?Jg(t)===t:!1},enqueueSetState:function(t,e,i){t=t._reactInternals;var r=Va(),n=Qf(t),s=ed(r,n);s.payload=e,i!=null&&(s.callback=i),e=qf(t,s,n),e!==null&&(Cc(e,t,n,r),NT(e,t,n))},enqueueReplaceState:function(t,e,i){t=t._reactInternals;var r=Va(),n=Qf(t),s=ed(r,n);s.tag=1,s.payload=e,i!=null&&(s.callback=i),e=qf(t,s,n),e!==null&&(Cc(e,t,n,r),NT(e,t,n))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var i=Va(),r=Qf(t),n=ed(i,r);n.tag=2,e!=null&&(n.callback=e),e=qf(t,n,r),e!==null&&(Cc(e,t,r,i),NT(e,t,r))}};function SH(t,e,i,r,n,s,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,a):e.prototype&&e.prototype.isPureReactComponent?!Uw(i,r)||!Uw(n,s):!0}function Iee(t,e,i){var r=!1,n=lp,s=e.contextType;return typeof s=="object"&&s!==null?s=Gl(s):(n=po(e)?Tg:xa.current,r=e.contextTypes,s=(r=r!=null)?Hy(t,n):lp),e=new e(i,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=XP,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=n,t.__reactInternalMemoizedMaskedChildContext=s),e}function _H(t,e,i,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(i,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(i,r),e.state!==t&&XP.enqueueReplaceState(e,e.state,null)}function oF(t,e,i,r){var n=t.stateNode;n.props=i,n.state=t.memoizedState,n.refs={},Vz(t);var s=e.contextType;typeof s=="object"&&s!==null?n.context=Gl(s):(s=po(e)?Tg:xa.current,n.context=Hy(t,s)),n.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(aF(t,e,s,i),n.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(e=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),e!==n.state&&XP.enqueueReplaceState(n,n.state,null),YC(t,i,n,r),n.state=t.memoizedState),typeof n.componentDidMount=="function"&&(t.flags|=4194308)}function Yy(t,e){try{var i="",r=e;do i+=rpe(r),r=r.return;while(r);var n=i}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:n,digest:null}}function RI(t,e,i){return{value:t,source:null,stack:i??null,digest:e??null}}function lF(t,e){try{console.error(e.value)}catch(i){setTimeout(function(){throw i})}}var Dme=typeof WeakMap=="function"?WeakMap:Map;function Lee(t,e,i){i=ed(-1,i),i.tag=3,i.payload={element:null};var r=e.value;return i.callback=function(){JC||(JC=!0,yF=r),lF(t,e)},i}function Oee(t,e,i){i=ed(-1,i),i.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var n=e.value;i.payload=function(){return r(n)},i.callback=function(){lF(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(i.callback=function(){lF(t,e),typeof r!="function"&&(Kf===null?Kf=new Set([this]):Kf.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),i}function AH(t,e,i){var r=t.pingCache;if(r===null){r=t.pingCache=new Dme;var n=new Set;r.set(e,n)}else n=r.get(e),n===void 0&&(n=new Set,r.set(e,n));n.has(i)||(n.add(i),t=jme.bind(null,t,e,i),e.then(t,t))}function EH(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function MH(t,e,i,r,n){return t.mode&1?(t.flags|=65536,t.lanes=n,t):(t===e?t.flags|=65536:(t.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(e=ed(-1,1),e.tag=2,qf(i,e,1))),i.lanes|=1),t)}var Rme=Sd.ReactCurrentOwner,lo=!1;function La(t,e,i,r){e.child=t===null?cee(e,null,i,r):Wy(e,t.child,i,r)}function TH(t,e,i,r,n){i=i.render;var s=e.ref;return wy(e,n),r=Yz(t,e,i,r,s,n),i=qz(),t!==null&&!lo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,hd(t,e,n)):(Lr&&i&&Bz(e),e.flags|=1,La(t,e,r,n),e.child)}function CH(t,e,i,r,n){if(t===null){var s=i.type;return typeof s=="function"&&!n4(s)&&s.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(e.tag=15,e.type=s,Bee(t,e,s,r,n)):(t=jT(i.type,null,r,e,e.mode,n),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&n)){var a=s.memoizedProps;if(i=i.compare,i=i!==null?i:Uw,i(a,r)&&t.ref===e.ref)return hd(t,e,n)}return e.flags|=1,t=$f(s,r),t.ref=e.ref,t.return=e,e.child=t}function Bee(t,e,i,r,n){if(t!==null){var s=t.memoizedProps;if(Uw(s,r)&&t.ref===e.ref)if(lo=!1,e.pendingProps=r=s,(t.lanes&n)!==0)t.flags&131072&&(lo=!0);else return e.lanes=t.lanes,hd(t,e,n)}return cF(t,e,i,r,n)}function Fee(t,e,i){var r=e.pendingProps,n=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},_r(Kv,Io),Io|=i;else{if(!(i&1073741824))return t=s!==null?s.baseLanes|i:i,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,_r(Kv,Io),Io|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:i,_r(Kv,Io),Io|=r}else s!==null?(r=s.baseLanes|i,e.memoizedState=null):r=i,_r(Kv,Io),Io|=r;return La(t,e,n,i),e.child}function kee(t,e){var i=e.ref;(t===null&&i!==null||t!==null&&t.ref!==i)&&(e.flags|=512,e.flags|=2097152)}function cF(t,e,i,r,n){var s=po(i)?Tg:xa.current;return s=Hy(e,s),wy(e,n),i=Yz(t,e,i,r,s,n),r=qz(),t!==null&&!lo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,hd(t,e,n)):(Lr&&r&&Bz(e),e.flags|=1,La(t,e,i,n),e.child)}function PH(t,e,i,r,n){if(po(i)){var s=!0;VC(e)}else s=!1;if(wy(e,n),e.stateNode===null)GT(t,e),Iee(e,i,r),oF(e,i,r,n),r=!0;else if(t===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,c=i.contextType;typeof c=="object"&&c!==null?c=Gl(c):(c=po(i)?Tg:xa.current,c=Hy(e,c));var h=i.getDerivedStateFromProps,u=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";u||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==c)&&_H(e,a,r,c),mf=!1;var d=e.memoizedState;a.state=d,YC(e,r,a,n),l=e.memoizedState,o!==r||d!==l||fo.current||mf?(typeof h=="function"&&(aF(e,i,h,r),l=e.memoizedState),(o=mf||SH(e,i,o,r,d,l,c))?(u||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),a.props=r,a.state=l,a.context=c,r=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,uee(t,e),o=e.memoizedProps,c=e.type===e.elementType?o:vc(e.type,o),a.props=c,u=e.pendingProps,d=a.context,l=i.contextType,typeof l=="object"&&l!==null?l=Gl(l):(l=po(i)?Tg:xa.current,l=Hy(e,l));var f=i.getDerivedStateFromProps;(h=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==u||d!==l)&&_H(e,a,r,l),mf=!1,d=e.memoizedState,a.state=d,YC(e,r,a,n);var p=e.memoizedState;o!==u||d!==p||fo.current||mf?(typeof f=="function"&&(aF(e,i,f,r),p=e.memoizedState),(c=mf||SH(e,i,c,r,d,p,l)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,p,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,p,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),a.props=r,a.state=p,a.context=l,r=c):(typeof a.componentDidUpdate!="function"||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),r=!1)}return hF(t,e,i,r,s,n)}function hF(t,e,i,r,n,s){kee(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return n&&pH(e,i,!1),hd(t,e,s);r=e.stateNode,Rme.current=e;var o=a&&typeof i.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=Wy(e,t.child,null,s),e.child=Wy(e,null,o,s)):La(t,e,o,s),e.memoizedState=r.state,n&&pH(e,i,!0),e.child}function Nee(t){var e=t.stateNode;e.pendingContext?fH(t,e.pendingContext,e.pendingContext!==e.context):e.context&&fH(t,e.context,!1),Hz(t,e.containerInfo)}function DH(t,e,i,r,n){return jy(),kz(n),e.flags|=256,La(t,e,i,r),e.child}var uF={dehydrated:null,treeContext:null,retryLane:0};function dF(t){return{baseLanes:t,cachePool:null,transitions:null}}function Uee(t,e,i){var r=e.pendingProps,n=Gr.current,s=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=t!==null&&t.memoizedState===null?!1:(n&2)!==0),o?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(n|=1),_r(Gr,n&1),t===null)return nF(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,s?(r=e.mode,s=e.child,a={mode:"hidden",children:a},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=KP(a,r,0,null),t=ag(t,r,i,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=dF(i),e.memoizedState=uF,t):$z(e,a));if(n=t.memoizedState,n!==null&&(o=n.dehydrated,o!==null))return Ime(t,e,a,r,o,n,i);if(s){s=r.fallback,a=e.mode,n=t.child,o=n.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&e.child!==n?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=$f(n,l),r.subtreeFlags=n.subtreeFlags&14680064),o!==null?s=$f(o,s):(s=ag(s,a,i,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,a=t.child.memoizedState,a=a===null?dF(i):{baseLanes:a.baseLanes|i,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=t.childLanes&~i,e.memoizedState=uF,r}return s=t.child,t=s.sibling,r=$f(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=i),r.return=e,r.sibling=null,t!==null&&(i=e.deletions,i===null?(e.deletions=[t],e.flags|=16):i.push(t)),e.child=r,e.memoizedState=null,r}function $z(t,e){return e=KP({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function $A(t,e,i,r){return r!==null&&kz(r),Wy(e,t.child,null,i),t=$z(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Ime(t,e,i,r,n,s,a){if(i)return e.flags&256?(e.flags&=-257,r=RI(Error(pt(422))),$A(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,n=e.mode,r=KP({mode:"visible",children:r.children},n,0,null),s=ag(s,n,a,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Wy(e,t.child,null,a),e.child.memoizedState=dF(a),e.memoizedState=uF,s);if(!(e.mode&1))return $A(t,e,a,null);if(n.data==="$!"){if(r=n.nextSibling&&n.nextSibling.dataset,r)var o=r.dgst;return r=o,s=Error(pt(419)),r=RI(s,r,void 0),$A(t,e,a,r)}if(o=(a&t.childLanes)!==0,lo||o){if(r=Ps,r!==null){switch(a&-a){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(r.suspendedLanes|a)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,cd(t,n),Cc(r,t,n,-1))}return r4(),r=RI(Error(pt(421))),$A(t,e,a,r)}return n.data==="$?"?(e.flags|=128,e.child=t.child,e=Wme.bind(null,t),n._reactRetry=e,null):(t=s.treeContext,Fo=Yf(n.nextSibling),zo=e,Lr=!0,xc=null,t!==null&&(Ml[Tl++]=Hu,Ml[Tl++]=ju,Ml[Tl++]=Cg,Hu=t.id,ju=t.overflow,Cg=e),e=$z(e,r.children),e.flags|=4096,e)}function RH(t,e,i){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),sF(t.return,e,i)}function II(t,e,i,r,n){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:n}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=i,s.tailMode=n)}function zee(t,e,i){var r=e.pendingProps,n=r.revealOrder,s=r.tail;if(La(t,e,r.children,i),r=Gr.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&RH(t,i,e);else if(t.tag===19)RH(t,i,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(_r(Gr,r),!(e.mode&1))e.memoizedState=null;else switch(n){case"forwards":for(i=e.child,n=null;i!==null;)t=i.alternate,t!==null&&qC(t)===null&&(n=i),i=i.sibling;i=n,i===null?(n=e.child,e.child=null):(n=i.sibling,i.sibling=null),II(e,!1,n,i,s);break;case"backwards":for(i=null,n=e.child,e.child=null;n!==null;){if(t=n.alternate,t!==null&&qC(t)===null){e.child=n;break}t=n.sibling,n.sibling=i,i=n,n=t}II(e,!0,i,null,s);break;case"together":II(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function GT(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function hd(t,e,i){if(t!==null&&(e.dependencies=t.dependencies),Dg|=e.lanes,!(i&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(pt(153));if(e.child!==null){for(t=e.child,i=$f(t,t.pendingProps),e.child=i,i.return=e;t.sibling!==null;)t=t.sibling,i=i.sibling=$f(t,t.pendingProps),i.return=e;i.sibling=null}return e.child}function Lme(t,e,i){switch(e.tag){case 3:Nee(e),jy();break;case 5:dee(e);break;case 1:po(e.type)&&VC(e);break;case 4:Hz(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,n=e.memoizedProps.value;_r(WC,r._currentValue),r._currentValue=n;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(_r(Gr,Gr.current&1),e.flags|=128,null):i&e.child.childLanes?Uee(t,e,i):(_r(Gr,Gr.current&1),t=hd(t,e,i),t!==null?t.sibling:null);_r(Gr,Gr.current&1);break;case 19:if(r=(i&e.childLanes)!==0,t.flags&128){if(r)return zee(t,e,i);e.flags|=128}if(n=e.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),_r(Gr,Gr.current),r)break;return null;case 22:case 23:return e.lanes=0,Fee(t,e,i)}return hd(t,e,i)}var Gee,fF,Vee,Hee;Gee=function(t,e){for(var i=e.child;i!==null;){if(i.tag===5||i.tag===6)t.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};fF=function(){};Vee=function(t,e,i,r){var n=t.memoizedProps;if(n!==r){t=e.stateNode,Um(Dh.current);var s=null;switch(i){case"input":n=BB(t,n),r=BB(t,r),s=[];break;case"select":n=Qr({},n,{value:void 0}),r=Qr({},r,{value:void 0}),s=[];break;case"textarea":n=NB(t,n),r=NB(t,r),s=[];break;default:typeof n.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=zC)}zB(i,r);var a;i=null;for(c in n)if(!r.hasOwnProperty(c)&&n.hasOwnProperty(c)&&n[c]!=null)if(c==="style"){var o=n[c];for(a in o)o.hasOwnProperty(a)&&(i||(i={}),i[a]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Iw.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(o=n!=null?n[c]:void 0,r.hasOwnProperty(c)&&l!==o&&(l!=null||o!=null))if(c==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(i||(i={}),i[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(i||(i={}),i[a]=l[a])}else i||(s||(s=[]),s.push(c,i)),i=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Iw.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Mr("scroll",t),s||o===l||(s=[])):(s=s||[]).push(c,l))}i&&(s=s||[]).push("style",i);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};Hee=function(t,e,i,r){i!==r&&(e.flags|=4)};function Ix(t,e){if(!Lr)switch(t.tailMode){case"hidden":e=t.tail;for(var i=null;e!==null;)e.alternate!==null&&(i=e),e=e.sibling;i===null?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var r=null;i!==null;)i.alternate!==null&&(r=i),i=i.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function na(t){var e=t.alternate!==null&&t.alternate.child===t.child,i=0,r=0;if(e)for(var n=t.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags&14680064,r|=n.flags&14680064,n.return=t,n=n.sibling;else for(n=t.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags,r|=n.flags,n.return=t,n=n.sibling;return t.subtreeFlags|=r,t.childLanes=i,e}function Ome(t,e,i){var r=e.pendingProps;switch(Fz(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return na(e),null;case 1:return po(e.type)&&GC(),na(e),null;case 3:return r=e.stateNode,Xy(),Pr(fo),Pr(xa),Wz(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(KA(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,xc!==null&&(wF(xc),xc=null))),fF(t,e),na(e),null;case 5:jz(e);var n=Um(jw.current);if(i=e.type,t!==null&&e.stateNode!=null)Vee(t,e,i,r,n),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(pt(166));return na(e),null}if(t=Um(Dh.current),KA(e)){r=e.stateNode,i=e.type;var s=e.memoizedProps;switch(r[xh]=e,r[Vw]=s,t=(e.mode&1)!==0,i){case"dialog":Mr("cancel",r),Mr("close",r);break;case"iframe":case"object":case"embed":Mr("load",r);break;case"video":case"audio":for(n=0;n<Pb.length;n++)Mr(Pb[n],r);break;case"source":Mr("error",r);break;case"img":case"image":case"link":Mr("error",r),Mr("load",r);break;case"details":Mr("toggle",r);break;case"input":z8(r,s),Mr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Mr("invalid",r);break;case"textarea":V8(r,s),Mr("invalid",r)}zB(i,s),n=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?r.textContent!==o&&(s.suppressHydrationWarning!==!0&&qA(r.textContent,o,t),n=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&qA(r.textContent,o,t),n=["children",""+o]):Iw.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Mr("scroll",r)}switch(i){case"input":zA(r),G8(r,s,!0);break;case"textarea":zA(r),H8(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=zC)}r=n,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=n.nodeType===9?n:n.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=vZ(i)),t==="http://www.w3.org/1999/xhtml"?i==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(i,{is:r.is}):(t=a.createElement(i),i==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,i),t[xh]=e,t[Vw]=r,Gee(t,e,!1,!1),e.stateNode=t;e:{switch(a=GB(i,r),i){case"dialog":Mr("cancel",t),Mr("close",t),n=r;break;case"iframe":case"object":case"embed":Mr("load",t),n=r;break;case"video":case"audio":for(n=0;n<Pb.length;n++)Mr(Pb[n],t);n=r;break;case"source":Mr("error",t),n=r;break;case"img":case"image":case"link":Mr("error",t),Mr("load",t),n=r;break;case"details":Mr("toggle",t),n=r;break;case"input":z8(t,r),n=BB(t,r),Mr("invalid",t);break;case"option":n=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},n=Qr({},r,{value:void 0}),Mr("invalid",t);break;case"textarea":V8(t,r),n=NB(t,r),Mr("invalid",t);break;default:n=r}zB(i,n),o=n;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?bZ(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&yZ(t,l)):s==="children"?typeof l=="string"?(i!=="textarea"||l!=="")&&Lw(t,l):typeof l=="number"&&Lw(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Iw.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Mr("scroll",t):l!=null&&wz(t,s,l,a))}switch(i){case"input":zA(t),G8(t,r,!1);break;case"textarea":zA(t),H8(t);break;case"option":r.value!=null&&t.setAttribute("value",""+op(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?vy(t,!!r.multiple,s,!1):r.defaultValue!=null&&vy(t,!!r.multiple,r.defaultValue,!0);break;default:typeof n.onClick=="function"&&(t.onclick=zC)}switch(i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return na(e),null;case 6:if(t&&e.stateNode!=null)Hee(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(pt(166));if(i=Um(jw.current),Um(Dh.current),KA(e)){if(r=e.stateNode,i=e.memoizedProps,r[xh]=e,(s=r.nodeValue!==i)&&(t=zo,t!==null))switch(t.tag){case 3:qA(r.nodeValue,i,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&qA(r.nodeValue,i,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(i.nodeType===9?i:i.ownerDocument).createTextNode(r),r[xh]=e,e.stateNode=r}return na(e),null;case 13:if(Pr(Gr),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Lr&&Fo!==null&&e.mode&1&&!(e.flags&128))oee(),jy(),e.flags|=98560,s=!1;else if(s=KA(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(pt(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(pt(317));s[xh]=e}else jy(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;na(e),s=!1}else xc!==null&&(wF(xc),xc=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=i,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Gr.current&1?is===0&&(is=3):r4())),e.updateQueue!==null&&(e.flags|=4),na(e),null);case 4:return Xy(),fF(t,e),t===null&&zw(e.stateNode.containerInfo),na(e),null;case 10:return zz(e.type._context),na(e),null;case 17:return po(e.type)&&GC(),na(e),null;case 19:if(Pr(Gr),s=e.memoizedState,s===null)return na(e),null;if(r=(e.flags&128)!==0,a=s.rendering,a===null)if(r)Ix(s,!1);else{if(is!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=qC(t),a!==null){for(e.flags|=128,Ix(s,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=i,i=e.child;i!==null;)s=i,t=r,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,t=a.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),i=i.sibling;return _r(Gr,Gr.current&1|2),e.child}t=t.sibling}s.tail!==null&&yn()>qy&&(e.flags|=128,r=!0,Ix(s,!1),e.lanes=4194304)}else{if(!r)if(t=qC(a),t!==null){if(e.flags|=128,r=!0,i=t.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),Ix(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!Lr)return na(e),null}else 2*yn()-s.renderingStartTime>qy&&i!==1073741824&&(e.flags|=128,r=!0,Ix(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(i=s.last,i!==null?i.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=yn(),e.sibling=null,i=Gr.current,_r(Gr,r?i&1|2:i&1),e):(na(e),null);case 22:case 23:return i4(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Io&1073741824&&(na(e),e.subtreeFlags&6&&(e.flags|=8192)):na(e),null;case 24:return null;case 25:return null}throw Error(pt(156,e.tag))}function Bme(t,e){switch(Fz(e),e.tag){case 1:return po(e.type)&&GC(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Xy(),Pr(fo),Pr(xa),Wz(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return jz(e),null;case 13:if(Pr(Gr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(pt(340));jy()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Pr(Gr),null;case 4:return Xy(),null;case 10:return zz(e.type._context),null;case 22:case 23:return i4(),null;case 24:return null;default:return null}}var JA=!1,ha=!1,Fme=typeof WeakSet=="function"?WeakSet:Set,Ot=null;function qv(t,e){var i=t.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(r){nn(t,e,r)}else i.current=null}function pF(t,e,i){try{i()}catch(r){nn(t,e,r)}}var IH=!1;function kme(t,e){if($B=kC,t=qZ(),Oz(t)){if("selectionStart"in t)var i={start:t.selectionStart,end:t.selectionEnd};else e:{i=(i=t.ownerDocument)&&i.defaultView||window;var r=i.getSelection&&i.getSelection();if(r&&r.rangeCount!==0){i=r.anchorNode;var n=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{i.nodeType,s.nodeType}catch{i=null;break e}var a=0,o=-1,l=-1,c=0,h=0,u=t,d=null;t:for(;;){for(var f;u!==i||n!==0&&u.nodeType!==3||(o=a+n),u!==s||r!==0&&u.nodeType!==3||(l=a+r),u.nodeType===3&&(a+=u.nodeValue.length),(f=u.firstChild)!==null;)d=u,u=f;for(;;){if(u===t)break t;if(d===i&&++c===n&&(o=a),d===s&&++h===r&&(l=a),(f=u.nextSibling)!==null)break;u=d,d=u.parentNode}u=f}i=o===-1||l===-1?null:{start:o,end:l}}else i=null}i=i||{start:0,end:0}}else i=null;for(JB={focusedElem:t,selectionRange:i},kC=!1,Ot=e;Ot!==null;)if(e=Ot,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ot=t;else for(;Ot!==null;){e=Ot;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,g=p.memoizedState,v=e.stateNode,y=v.getSnapshotBeforeUpdate(e.elementType===e.type?m:vc(e.type,m),g);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var x=e.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(pt(163))}}catch(S){nn(e,e.return,S)}if(t=e.sibling,t!==null){t.return=e.return,Ot=t;break}Ot=e.return}return p=IH,IH=!1,p}function ew(t,e,i){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var n=r=r.next;do{if((n.tag&t)===t){var s=n.destroy;n.destroy=void 0,s!==void 0&&pF(e,i,s)}n=n.next}while(n!==r)}}function YP(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var i=e=e.next;do{if((i.tag&t)===t){var r=i.create;i.destroy=r()}i=i.next}while(i!==e)}}function mF(t){var e=t.ref;if(e!==null){var i=t.stateNode;switch(t.tag){case 5:t=i;break;default:t=i}typeof e=="function"?e(t):e.current=t}}function jee(t){var e=t.alternate;e!==null&&(t.alternate=null,jee(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[xh],delete e[Vw],delete e[tF],delete e[xme],delete e[bme])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Wee(t){return t.tag===5||t.tag===3||t.tag===4}function LH(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Wee(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function gF(t,e,i){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?i.nodeType===8?i.parentNode.insertBefore(t,e):i.insertBefore(t,e):(i.nodeType===8?(e=i.parentNode,e.insertBefore(t,i)):(e=i,e.appendChild(t)),i=i._reactRootContainer,i!=null||e.onclick!==null||(e.onclick=zC));else if(r!==4&&(t=t.child,t!==null))for(gF(t,e,i),t=t.sibling;t!==null;)gF(t,e,i),t=t.sibling}function vF(t,e,i){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?i.insertBefore(t,e):i.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(vF(t,e,i),t=t.sibling;t!==null;)vF(t,e,i),t=t.sibling}var Us=null,yc=!1;function zd(t,e,i){for(i=i.child;i!==null;)Xee(t,e,i),i=i.sibling}function Xee(t,e,i){if(Ph&&typeof Ph.onCommitFiberUnmount=="function")try{Ph.onCommitFiberUnmount(UP,i)}catch{}switch(i.tag){case 5:ha||qv(i,e);case 6:var r=Us,n=yc;Us=null,zd(t,e,i),Us=r,yc=n,Us!==null&&(yc?(t=Us,i=i.stateNode,t.nodeType===8?t.parentNode.removeChild(i):t.removeChild(i)):Us.removeChild(i.stateNode));break;case 18:Us!==null&&(yc?(t=Us,i=i.stateNode,t.nodeType===8?EI(t.parentNode,i):t.nodeType===1&&EI(t,i),kw(t)):EI(Us,i.stateNode));break;case 4:r=Us,n=yc,Us=i.stateNode.containerInfo,yc=!0,zd(t,e,i),Us=r,yc=n;break;case 0:case 11:case 14:case 15:if(!ha&&(r=i.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){n=r=r.next;do{var s=n,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&pF(i,e,a),n=n.next}while(n!==r)}zd(t,e,i);break;case 1:if(!ha&&(qv(i,e),r=i.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=i.memoizedProps,r.state=i.memoizedState,r.componentWillUnmount()}catch(o){nn(i,e,o)}zd(t,e,i);break;case 21:zd(t,e,i);break;case 22:i.mode&1?(ha=(r=ha)||i.memoizedState!==null,zd(t,e,i),ha=r):zd(t,e,i);break;default:zd(t,e,i)}}function OH(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var i=t.stateNode;i===null&&(i=t.stateNode=new Fme),e.forEach(function(r){var n=Xme.bind(null,t,r);i.has(r)||(i.add(r),r.then(n,n))})}}function ec(t,e){var i=e.deletions;if(i!==null)for(var r=0;r<i.length;r++){var n=i[r];try{var s=t,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:Us=o.stateNode,yc=!1;break e;case 3:Us=o.stateNode.containerInfo,yc=!0;break e;case 4:Us=o.stateNode.containerInfo,yc=!0;break e}o=o.return}if(Us===null)throw Error(pt(160));Xee(s,a,n),Us=null,yc=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(c){nn(n,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Yee(e,t),e=e.sibling}function Yee(t,e){var i=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ec(e,t),Kc(t),r&4){try{ew(3,t,t.return),YP(3,t)}catch(m){nn(t,t.return,m)}try{ew(5,t,t.return)}catch(m){nn(t,t.return,m)}}break;case 1:ec(e,t),Kc(t),r&512&&i!==null&&qv(i,i.return);break;case 5:if(ec(e,t),Kc(t),r&512&&i!==null&&qv(i,i.return),t.flags&32){var n=t.stateNode;try{Lw(n,"")}catch(m){nn(t,t.return,m)}}if(r&4&&(n=t.stateNode,n!=null)){var s=t.memoizedProps,a=i!==null?i.memoizedProps:s,o=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&mZ(n,s),GB(o,a);var c=GB(o,s);for(a=0;a<l.length;a+=2){var h=l[a],u=l[a+1];h==="style"?bZ(n,u):h==="dangerouslySetInnerHTML"?yZ(n,u):h==="children"?Lw(n,u):wz(n,h,u,c)}switch(o){case"input":FB(n,s);break;case"textarea":gZ(n,s);break;case"select":var d=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?vy(n,!!s.multiple,f,!1):d!==!!s.multiple&&(s.defaultValue!=null?vy(n,!!s.multiple,s.defaultValue,!0):vy(n,!!s.multiple,s.multiple?[]:"",!1))}n[Vw]=s}catch(m){nn(t,t.return,m)}}break;case 6:if(ec(e,t),Kc(t),r&4){if(t.stateNode===null)throw Error(pt(162));n=t.stateNode,s=t.memoizedProps;try{n.nodeValue=s}catch(m){nn(t,t.return,m)}}break;case 3:if(ec(e,t),Kc(t),r&4&&i!==null&&i.memoizedState.isDehydrated)try{kw(e.containerInfo)}catch(m){nn(t,t.return,m)}break;case 4:ec(e,t),Kc(t);break;case 13:ec(e,t),Kc(t),n=t.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(e4=yn())),r&4&&OH(t);break;case 22:if(h=i!==null&&i.memoizedState!==null,t.mode&1?(ha=(c=ha)||h,ec(e,t),ha=c):ec(e,t),Kc(t),r&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!h&&t.mode&1)for(Ot=t,h=t.child;h!==null;){for(u=Ot=h;Ot!==null;){switch(d=Ot,f=d.child,d.tag){case 0:case 11:case 14:case 15:ew(4,d,d.return);break;case 1:qv(d,d.return);var p=d.stateNode;if(typeof p.componentWillUnmount=="function"){r=d,i=d.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(m){nn(r,i,m)}}break;case 5:qv(d,d.return);break;case 22:if(d.memoizedState!==null){FH(u);continue}}f!==null?(f.return=d,Ot=f):FH(u)}h=h.sibling}e:for(h=null,u=t;;){if(u.tag===5){if(h===null){h=u;try{n=u.stateNode,c?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=u.stateNode,l=u.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=xZ("display",a))}catch(m){nn(t,t.return,m)}}}else if(u.tag===6){if(h===null)try{u.stateNode.nodeValue=c?"":u.memoizedProps}catch(m){nn(t,t.return,m)}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===t)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===t)break e;for(;u.sibling===null;){if(u.return===null||u.return===t)break e;h===u&&(h=null),u=u.return}h===u&&(h=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:ec(e,t),Kc(t),r&4&&OH(t);break;case 21:break;default:ec(e,t),Kc(t)}}function Kc(t){var e=t.flags;if(e&2){try{e:{for(var i=t.return;i!==null;){if(Wee(i)){var r=i;break e}i=i.return}throw Error(pt(160))}switch(r.tag){case 5:var n=r.stateNode;r.flags&32&&(Lw(n,""),r.flags&=-33);var s=LH(t);vF(t,s,n);break;case 3:case 4:var a=r.stateNode.containerInfo,o=LH(t);gF(t,o,a);break;default:throw Error(pt(161))}}catch(l){nn(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Nme(t,e,i){Ot=t,qee(t)}function qee(t,e,i){for(var r=(t.mode&1)!==0;Ot!==null;){var n=Ot,s=n.child;if(n.tag===22&&r){var a=n.memoizedState!==null||JA;if(!a){var o=n.alternate,l=o!==null&&o.memoizedState!==null||ha;o=JA;var c=ha;if(JA=a,(ha=l)&&!c)for(Ot=n;Ot!==null;)a=Ot,l=a.child,a.tag===22&&a.memoizedState!==null?kH(n):l!==null?(l.return=a,Ot=l):kH(n);for(;s!==null;)Ot=s,qee(s),s=s.sibling;Ot=n,JA=o,ha=c}BH(t)}else n.subtreeFlags&8772&&s!==null?(s.return=n,Ot=s):BH(t)}}function BH(t){for(;Ot!==null;){var e=Ot;if(e.flags&8772){var i=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ha||YP(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ha)if(i===null)r.componentDidMount();else{var n=e.elementType===e.type?i.memoizedProps:vc(e.type,i.memoizedProps);r.componentDidUpdate(n,i.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&xH(e,s,r);break;case 3:var a=e.updateQueue;if(a!==null){if(i=null,e.child!==null)switch(e.child.tag){case 5:i=e.child.stateNode;break;case 1:i=e.child.stateNode}xH(e,a,i)}break;case 5:var o=e.stateNode;if(i===null&&e.flags&4){i=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&i.focus();break;case"img":l.src&&(i.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var h=c.memoizedState;if(h!==null){var u=h.dehydrated;u!==null&&kw(u)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(pt(163))}ha||e.flags&512&&mF(e)}catch(d){nn(e,e.return,d)}}if(e===t){Ot=null;break}if(i=e.sibling,i!==null){i.return=e.return,Ot=i;break}Ot=e.return}}function FH(t){for(;Ot!==null;){var e=Ot;if(e===t){Ot=null;break}var i=e.sibling;if(i!==null){i.return=e.return,Ot=i;break}Ot=e.return}}function kH(t){for(;Ot!==null;){var e=Ot;try{switch(e.tag){case 0:case 11:case 15:var i=e.return;try{YP(4,e)}catch(l){nn(e,i,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var n=e.return;try{r.componentDidMount()}catch(l){nn(e,n,l)}}var s=e.return;try{mF(e)}catch(l){nn(e,s,l)}break;case 5:var a=e.return;try{mF(e)}catch(l){nn(e,a,l)}}}catch(l){nn(e,e.return,l)}if(e===t){Ot=null;break}var o=e.sibling;if(o!==null){o.return=e.return,Ot=o;break}Ot=e.return}}var Ume=Math.ceil,$C=Sd.ReactCurrentDispatcher,Jz=Sd.ReactCurrentOwner,kl=Sd.ReactCurrentBatchConfig,Gi=0,Ps=null,Ln=null,Ks=0,Io=0,Kv=Mp(0),is=0,qw=null,Dg=0,qP=0,Zz=0,tw=null,io=null,e4=0,qy=1/0,Mu=null,JC=!1,yF=null,Kf=null,ZA=!1,Cf=null,ZC=0,iw=0,xF=null,VT=-1,HT=0;function Va(){return Gi&6?yn():VT!==-1?VT:VT=yn()}function Qf(t){return t.mode&1?Gi&2&&Ks!==0?Ks&-Ks:Sme.transition!==null?(HT===0&&(HT=IZ()),HT):(t=ar,t!==0||(t=window.event,t=t===void 0?16:UZ(t.type)),t):1}function Cc(t,e,i,r){if(50<iw)throw iw=0,xF=null,Error(pt(185));KS(t,i,r),(!(Gi&2)||t!==Ps)&&(t===Ps&&(!(Gi&2)&&(qP|=i),is===4&&bf(t,Ks)),mo(t,r),i===1&&Gi===0&&!(e.mode&1)&&(qy=yn()+500,jP&&Tp()))}function mo(t,e){var i=t.callbackNode;Spe(t,e);var r=FC(t,t===Ps?Ks:0);if(r===0)i!==null&&X8(i),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(i!=null&&X8(i),e===1)t.tag===0?wme(NH.bind(null,t)):nee(NH.bind(null,t)),vme(function(){!(Gi&6)&&Tp()}),i=null;else{switch(LZ(r)){case 1:i=Mz;break;case 4:i=DZ;break;case 16:i=BC;break;case 536870912:i=RZ;break;default:i=BC}i=ite(i,Kee.bind(null,t))}t.callbackPriority=e,t.callbackNode=i}}function Kee(t,e){if(VT=-1,HT=0,Gi&6)throw Error(pt(327));var i=t.callbackNode;if(Sy()&&t.callbackNode!==i)return null;var r=FC(t,t===Ps?Ks:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=e2(t,r);else{e=r;var n=Gi;Gi|=2;var s=$ee();(Ps!==t||Ks!==e)&&(Mu=null,qy=yn()+500,sg(t,e));do try{Vme();break}catch(o){Qee(t,o)}while(!0);Uz(),$C.current=s,Gi=n,Ln!==null?e=0:(Ps=null,Ks=0,e=is)}if(e!==0){if(e===2&&(n=XB(t),n!==0&&(r=n,e=bF(t,n))),e===1)throw i=qw,sg(t,0),bf(t,r),mo(t,yn()),i;if(e===6)bf(t,r);else{if(n=t.current.alternate,!(r&30)&&!zme(n)&&(e=e2(t,r),e===2&&(s=XB(t),s!==0&&(r=s,e=bF(t,s))),e===1))throw i=qw,sg(t,0),bf(t,r),mo(t,yn()),i;switch(t.finishedWork=n,t.finishedLanes=r,e){case 0:case 1:throw Error(pt(345));case 2:ym(t,io,Mu);break;case 3:if(bf(t,r),(r&130023424)===r&&(e=e4+500-yn(),10<e)){if(FC(t,0)!==0)break;if(n=t.suspendedLanes,(n&r)!==r){Va(),t.pingedLanes|=t.suspendedLanes&n;break}t.timeoutHandle=eF(ym.bind(null,t,io,Mu),e);break}ym(t,io,Mu);break;case 4:if(bf(t,r),(r&4194240)===r)break;for(e=t.eventTimes,n=-1;0<r;){var a=31-Tc(r);s=1<<a,a=e[a],a>n&&(n=a),r&=~s}if(r=n,r=yn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Ume(r/1960))-r,10<r){t.timeoutHandle=eF(ym.bind(null,t,io,Mu),r);break}ym(t,io,Mu);break;case 5:ym(t,io,Mu);break;default:throw Error(pt(329))}}}return mo(t,yn()),t.callbackNode===i?Kee.bind(null,t):null}function bF(t,e){var i=tw;return t.current.memoizedState.isDehydrated&&(sg(t,e).flags|=256),t=e2(t,e),t!==2&&(e=io,io=i,e!==null&&wF(e)),t}function wF(t){io===null?io=t:io.push.apply(io,t)}function zme(t){for(var e=t;;){if(e.flags&16384){var i=e.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var r=0;r<i.length;r++){var n=i[r],s=n.getSnapshot;n=n.value;try{if(!Ic(s(),n))return!1}catch{return!1}}}if(i=e.child,e.subtreeFlags&16384&&i!==null)i.return=e,e=i;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function bf(t,e){for(e&=~Zz,e&=~qP,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var i=31-Tc(e),r=1<<i;t[i]=-1,e&=~r}}function NH(t){if(Gi&6)throw Error(pt(327));Sy();var e=FC(t,0);if(!(e&1))return mo(t,yn()),null;var i=e2(t,e);if(t.tag!==0&&i===2){var r=XB(t);r!==0&&(e=r,i=bF(t,r))}if(i===1)throw i=qw,sg(t,0),bf(t,e),mo(t,yn()),i;if(i===6)throw Error(pt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ym(t,io,Mu),mo(t,yn()),null}function t4(t,e){var i=Gi;Gi|=1;try{return t(e)}finally{Gi=i,Gi===0&&(qy=yn()+500,jP&&Tp())}}function Rg(t){Cf!==null&&Cf.tag===0&&!(Gi&6)&&Sy();var e=Gi;Gi|=1;var i=kl.transition,r=ar;try{if(kl.transition=null,ar=1,t)return t()}finally{ar=r,kl.transition=i,Gi=e,!(Gi&6)&&Tp()}}function i4(){Io=Kv.current,Pr(Kv)}function sg(t,e){t.finishedWork=null,t.finishedLanes=0;var i=t.timeoutHandle;if(i!==-1&&(t.timeoutHandle=-1,gme(i)),Ln!==null)for(i=Ln.return;i!==null;){var r=i;switch(Fz(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&GC();break;case 3:Xy(),Pr(fo),Pr(xa),Wz();break;case 5:jz(r);break;case 4:Xy();break;case 13:Pr(Gr);break;case 19:Pr(Gr);break;case 10:zz(r.type._context);break;case 22:case 23:i4()}i=i.return}if(Ps=t,Ln=t=$f(t.current,null),Ks=Io=e,is=0,qw=null,Zz=qP=Dg=0,io=tw=null,Nm!==null){for(e=0;e<Nm.length;e++)if(i=Nm[e],r=i.interleaved,r!==null){i.interleaved=null;var n=r.next,s=i.pending;if(s!==null){var a=s.next;s.next=n,r.next=a}i.pending=r}Nm=null}return t}function Qee(t,e){do{var i=Ln;try{if(Uz(),UT.current=QC,KC){for(var r=qr.memoizedState;r!==null;){var n=r.queue;n!==null&&(n.pending=null),r=r.next}KC=!1}if(Pg=0,xs=$n=qr=null,Zb=!1,Ww=0,Jz.current=null,i===null||i.return===null){is=1,qw=e,Ln=null;break}e:{var s=t,a=i.return,o=i,l=e;if(e=Ks,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,h=o,u=h.tag;if(!(h.mode&1)&&(u===0||u===11||u===15)){var d=h.alternate;d?(h.updateQueue=d.updateQueue,h.memoizedState=d.memoizedState,h.lanes=d.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=EH(a);if(f!==null){f.flags&=-257,MH(f,a,o,s,e),f.mode&1&&AH(s,c,e),e=f,l=c;var p=e.updateQueue;if(p===null){var m=new Set;m.add(l),e.updateQueue=m}else p.add(l);break e}else{if(!(e&1)){AH(s,c,e),r4();break e}l=Error(pt(426))}}else if(Lr&&o.mode&1){var g=EH(a);if(g!==null){!(g.flags&65536)&&(g.flags|=256),MH(g,a,o,s,e),kz(Yy(l,o));break e}}s=l=Yy(l,o),is!==4&&(is=2),tw===null?tw=[s]:tw.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var v=Lee(s,l,e);yH(s,v);break e;case 1:o=l;var y=s.type,x=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Kf===null||!Kf.has(x)))){s.flags|=65536,e&=-e,s.lanes|=e;var S=Oee(s,o,e);yH(s,S);break e}}s=s.return}while(s!==null)}Zee(i)}catch(A){e=A,Ln===i&&i!==null&&(Ln=i=i.return);continue}break}while(!0)}function $ee(){var t=$C.current;return $C.current=QC,t===null?QC:t}function r4(){(is===0||is===3||is===2)&&(is=4),Ps===null||!(Dg&268435455)&&!(qP&268435455)||bf(Ps,Ks)}function e2(t,e){var i=Gi;Gi|=2;var r=$ee();(Ps!==t||Ks!==e)&&(Mu=null,sg(t,e));do try{Gme();break}catch(n){Qee(t,n)}while(!0);if(Uz(),Gi=i,$C.current=r,Ln!==null)throw Error(pt(261));return Ps=null,Ks=0,is}function Gme(){for(;Ln!==null;)Jee(Ln)}function Vme(){for(;Ln!==null&&!fpe();)Jee(Ln)}function Jee(t){var e=tte(t.alternate,t,Io);t.memoizedProps=t.pendingProps,e===null?Zee(t):Ln=e,Jz.current=null}function Zee(t){var e=t;do{var i=e.alternate;if(t=e.return,e.flags&32768){if(i=Bme(i,e),i!==null){i.flags&=32767,Ln=i;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{is=6,Ln=null;return}}else if(i=Ome(i,e,Io),i!==null){Ln=i;return}if(e=e.sibling,e!==null){Ln=e;return}Ln=e=t}while(e!==null);is===0&&(is=5)}function ym(t,e,i){var r=ar,n=kl.transition;try{kl.transition=null,ar=1,Hme(t,e,i,r)}finally{kl.transition=n,ar=r}return null}function Hme(t,e,i,r){do Sy();while(Cf!==null);if(Gi&6)throw Error(pt(327));i=t.finishedWork;var n=t.finishedLanes;if(i===null)return null;if(t.finishedWork=null,t.finishedLanes=0,i===t.current)throw Error(pt(177));t.callbackNode=null,t.callbackPriority=0;var s=i.lanes|i.childLanes;if(_pe(t,s),t===Ps&&(Ln=Ps=null,Ks=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||ZA||(ZA=!0,ite(BC,function(){return Sy(),null})),s=(i.flags&15990)!==0,i.subtreeFlags&15990||s){s=kl.transition,kl.transition=null;var a=ar;ar=1;var o=Gi;Gi|=4,Jz.current=null,kme(t,i),Yee(i,t),cme(JB),kC=!!$B,JB=$B=null,t.current=i,Nme(i),ppe(),Gi=o,ar=a,kl.transition=s}else t.current=i;if(ZA&&(ZA=!1,Cf=t,ZC=n),s=t.pendingLanes,s===0&&(Kf=null),vpe(i.stateNode),mo(t,yn()),e!==null)for(r=t.onRecoverableError,i=0;i<e.length;i++)n=e[i],r(n.value,{componentStack:n.stack,digest:n.digest});if(JC)throw JC=!1,t=yF,yF=null,t;return ZC&1&&t.tag!==0&&Sy(),s=t.pendingLanes,s&1?t===xF?iw++:(iw=0,xF=t):iw=0,Tp(),null}function Sy(){if(Cf!==null){var t=LZ(ZC),e=kl.transition,i=ar;try{if(kl.transition=null,ar=16>t?16:t,Cf===null)var r=!1;else{if(t=Cf,Cf=null,ZC=0,Gi&6)throw Error(pt(331));var n=Gi;for(Gi|=4,Ot=t.current;Ot!==null;){var s=Ot,a=s.child;if(Ot.flags&16){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var c=o[l];for(Ot=c;Ot!==null;){var h=Ot;switch(h.tag){case 0:case 11:case 15:ew(8,h,s)}var u=h.child;if(u!==null)u.return=h,Ot=u;else for(;Ot!==null;){h=Ot;var d=h.sibling,f=h.return;if(jee(h),h===c){Ot=null;break}if(d!==null){d.return=f,Ot=d;break}Ot=f}}}var p=s.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(m!==null)}}Ot=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,Ot=a;else e:for(;Ot!==null;){if(s=Ot,s.flags&2048)switch(s.tag){case 0:case 11:case 15:ew(9,s,s.return)}var v=s.sibling;if(v!==null){v.return=s.return,Ot=v;break e}Ot=s.return}}var y=t.current;for(Ot=y;Ot!==null;){a=Ot;var x=a.child;if(a.subtreeFlags&2064&&x!==null)x.return=a,Ot=x;else e:for(a=y;Ot!==null;){if(o=Ot,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:YP(9,o)}}catch(A){nn(o,o.return,A)}if(o===a){Ot=null;break e}var S=o.sibling;if(S!==null){S.return=o.return,Ot=S;break e}Ot=o.return}}if(Gi=n,Tp(),Ph&&typeof Ph.onPostCommitFiberRoot=="function")try{Ph.onPostCommitFiberRoot(UP,t)}catch{}r=!0}return r}finally{ar=i,kl.transition=e}}return!1}function UH(t,e,i){e=Yy(i,e),e=Lee(t,e,1),t=qf(t,e,1),e=Va(),t!==null&&(KS(t,1,e),mo(t,e))}function nn(t,e,i){if(t.tag===3)UH(t,t,i);else for(;e!==null;){if(e.tag===3){UH(e,t,i);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Kf===null||!Kf.has(r))){t=Yy(i,t),t=Oee(e,t,1),e=qf(e,t,1),t=Va(),e!==null&&(KS(e,1,t),mo(e,t));break}}e=e.return}}function jme(t,e,i){var r=t.pingCache;r!==null&&r.delete(e),e=Va(),t.pingedLanes|=t.suspendedLanes&i,Ps===t&&(Ks&i)===i&&(is===4||is===3&&(Ks&130023424)===Ks&&500>yn()-e4?sg(t,0):Zz|=i),mo(t,e)}function ete(t,e){e===0&&(t.mode&1?(e=HA,HA<<=1,!(HA&130023424)&&(HA=4194304)):e=1);var i=Va();t=cd(t,e),t!==null&&(KS(t,e,i),mo(t,i))}function Wme(t){var e=t.memoizedState,i=0;e!==null&&(i=e.retryLane),ete(t,i)}function Xme(t,e){var i=0;switch(t.tag){case 13:var r=t.stateNode,n=t.memoizedState;n!==null&&(i=n.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(pt(314))}r!==null&&r.delete(e),ete(t,i)}var tte;tte=function(t,e,i){if(t!==null)if(t.memoizedProps!==e.pendingProps||fo.current)lo=!0;else{if(!(t.lanes&i)&&!(e.flags&128))return lo=!1,Lme(t,e,i);lo=!!(t.flags&131072)}else lo=!1,Lr&&e.flags&1048576&&see(e,jC,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;GT(t,e),t=e.pendingProps;var n=Hy(e,xa.current);wy(e,i),n=Yz(null,e,r,t,n,i);var s=qz();return e.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,po(r)?(s=!0,VC(e)):s=!1,e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,Vz(e),n.updater=XP,e.stateNode=n,n._reactInternals=e,oF(e,r,t,i),e=hF(null,e,r,!0,s,i)):(e.tag=0,Lr&&s&&Bz(e),La(null,e,n,i),e=e.child),e;case 16:r=e.elementType;e:{switch(GT(t,e),t=e.pendingProps,n=r._init,r=n(r._payload),e.type=r,n=e.tag=qme(r),t=vc(r,t),n){case 0:e=cF(null,e,r,t,i);break e;case 1:e=PH(null,e,r,t,i);break e;case 11:e=TH(null,e,r,t,i);break e;case 14:e=CH(null,e,r,vc(r.type,t),i);break e}throw Error(pt(306,r,""))}return e;case 0:return r=e.type,n=e.pendingProps,n=e.elementType===r?n:vc(r,n),cF(t,e,r,n,i);case 1:return r=e.type,n=e.pendingProps,n=e.elementType===r?n:vc(r,n),PH(t,e,r,n,i);case 3:e:{if(Nee(e),t===null)throw Error(pt(387));r=e.pendingProps,s=e.memoizedState,n=s.element,uee(t,e),YC(e,r,null,i);var a=e.memoizedState;if(r=a.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){n=Yy(Error(pt(423)),e),e=DH(t,e,r,i,n);break e}else if(r!==n){n=Yy(Error(pt(424)),e),e=DH(t,e,r,i,n);break e}else for(Fo=Yf(e.stateNode.containerInfo.firstChild),zo=e,Lr=!0,xc=null,i=cee(e,null,r,i),e.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(jy(),r===n){e=hd(t,e,i);break e}La(t,e,r,i)}e=e.child}return e;case 5:return dee(e),t===null&&nF(e),r=e.type,n=e.pendingProps,s=t!==null?t.memoizedProps:null,a=n.children,ZB(r,n)?a=null:s!==null&&ZB(r,s)&&(e.flags|=32),kee(t,e),La(t,e,a,i),e.child;case 6:return t===null&&nF(e),null;case 13:return Uee(t,e,i);case 4:return Hz(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Wy(e,null,r,i):La(t,e,r,i),e.child;case 11:return r=e.type,n=e.pendingProps,n=e.elementType===r?n:vc(r,n),TH(t,e,r,n,i);case 7:return La(t,e,e.pendingProps,i),e.child;case 8:return La(t,e,e.pendingProps.children,i),e.child;case 12:return La(t,e,e.pendingProps.children,i),e.child;case 10:e:{if(r=e.type._context,n=e.pendingProps,s=e.memoizedProps,a=n.value,_r(WC,r._currentValue),r._currentValue=a,s!==null)if(Ic(s.value,a)){if(s.children===n.children&&!fo.current){e=hd(t,e,i);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=ed(-1,i&-i),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var h=c.pending;h===null?l.next=l:(l.next=h.next,h.next=l),c.pending=l}}s.lanes|=i,l=s.alternate,l!==null&&(l.lanes|=i),sF(s.return,i,e),o.lanes|=i;break}l=l.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(pt(341));a.lanes|=i,o=a.alternate,o!==null&&(o.lanes|=i),sF(a,i,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}La(t,e,n.children,i),e=e.child}return e;case 9:return n=e.type,r=e.pendingProps.children,wy(e,i),n=Gl(n),r=r(n),e.flags|=1,La(t,e,r,i),e.child;case 14:return r=e.type,n=vc(r,e.pendingProps),n=vc(r.type,n),CH(t,e,r,n,i);case 15:return Bee(t,e,e.type,e.pendingProps,i);case 17:return r=e.type,n=e.pendingProps,n=e.elementType===r?n:vc(r,n),GT(t,e),e.tag=1,po(r)?(t=!0,VC(e)):t=!1,wy(e,i),Iee(e,r,n),oF(e,r,n,i),hF(null,e,r,!0,t,i);case 19:return zee(t,e,i);case 22:return Fee(t,e,i)}throw Error(pt(156,e.tag))};function ite(t,e){return PZ(t,e)}function Yme(t,e,i,r){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ll(t,e,i,r){return new Yme(t,e,i,r)}function n4(t){return t=t.prototype,!(!t||!t.isReactComponent)}function qme(t){if(typeof t=="function")return n4(t)?1:0;if(t!=null){if(t=t.$$typeof,t===_z)return 11;if(t===Az)return 14}return 2}function $f(t,e){var i=t.alternate;return i===null?(i=Ll(t.tag,e,t.key,t.mode),i.elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=e,i.type=t.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=t.flags&14680064,i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,e=t.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i}function jT(t,e,i,r,n,s){var a=2;if(r=t,typeof t=="function")n4(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case Uv:return ag(i.children,n,s,e);case Sz:a=8,n|=8;break;case RB:return t=Ll(12,i,e,n|2),t.elementType=RB,t.lanes=s,t;case IB:return t=Ll(13,i,e,n),t.elementType=IB,t.lanes=s,t;case LB:return t=Ll(19,i,e,n),t.elementType=LB,t.lanes=s,t;case dZ:return KP(i,n,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case hZ:a=10;break e;case uZ:a=9;break e;case _z:a=11;break e;case Az:a=14;break e;case pf:a=16,r=null;break e}throw Error(pt(130,t==null?t:typeof t,""))}return e=Ll(a,i,e,n),e.elementType=t,e.type=r,e.lanes=s,e}function ag(t,e,i,r){return t=Ll(7,t,r,e),t.lanes=i,t}function KP(t,e,i,r){return t=Ll(22,t,r,e),t.elementType=dZ,t.lanes=i,t.stateNode={isHidden:!1},t}function LI(t,e,i){return t=Ll(6,t,null,e),t.lanes=i,t}function OI(t,e,i){return e=Ll(4,t.children!==null?t.children:[],t.key,e),e.lanes=i,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Kme(t,e,i,r,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=pI(0),this.expirationTimes=pI(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pI(0),this.identifierPrefix=r,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function s4(t,e,i,r,n,s,a,o,l){return t=new Kme(t,e,i,o,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Ll(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},Vz(s),t}function Qme(t,e,i){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Nv,key:r==null?null:""+r,children:t,containerInfo:e,implementation:i}}function rte(t){if(!t)return lp;t=t._reactInternals;e:{if(Jg(t)!==t||t.tag!==1)throw Error(pt(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(po(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(pt(171))}if(t.tag===1){var i=t.type;if(po(i))return ree(t,i,e)}return e}function nte(t,e,i,r,n,s,a,o,l){return t=s4(i,r,!0,t,n,s,a,o,l),t.context=rte(null),i=t.current,r=Va(),n=Qf(i),s=ed(r,n),s.callback=e??null,qf(i,s,n),t.current.lanes=n,KS(t,n,r),mo(t,r),t}function QP(t,e,i,r){var n=e.current,s=Va(),a=Qf(n);return i=rte(i),e.context===null?e.context=i:e.pendingContext=i,e=ed(s,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=qf(n,e,a),t!==null&&(Cc(t,n,a,s),NT(t,n,a)),a}function t2(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function zH(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var i=t.retryLane;t.retryLane=i!==0&&i<e?i:e}}function a4(t,e){zH(t,e),(t=t.alternate)&&zH(t,e)}function $me(){return null}var ste=typeof reportError=="function"?reportError:function(t){console.error(t)};function o4(t){this._internalRoot=t}$P.prototype.render=o4.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(pt(409));QP(t,e,null,null)};$P.prototype.unmount=o4.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Rg(function(){QP(null,t,null,null)}),e[ld]=null}};function $P(t){this._internalRoot=t}$P.prototype.unstable_scheduleHydration=function(t){if(t){var e=FZ();t={blockedOn:null,target:t,priority:e};for(var i=0;i<xf.length&&e!==0&&e<xf[i].priority;i++);xf.splice(i,0,t),i===0&&NZ(t)}};function l4(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function JP(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function GH(){}function Jme(t,e,i,r,n){if(n){if(typeof r=="function"){var s=r;r=function(){var c=t2(a);s.call(c)}}var a=nte(e,r,t,0,null,!1,!1,"",GH);return t._reactRootContainer=a,t[ld]=a.current,zw(t.nodeType===8?t.parentNode:t),Rg(),a}for(;n=t.lastChild;)t.removeChild(n);if(typeof r=="function"){var o=r;r=function(){var c=t2(l);o.call(c)}}var l=s4(t,0,!1,null,null,!1,!1,"",GH);return t._reactRootContainer=l,t[ld]=l.current,zw(t.nodeType===8?t.parentNode:t),Rg(function(){QP(e,l,i,r)}),l}function ZP(t,e,i,r,n){var s=i._reactRootContainer;if(s){var a=s;if(typeof n=="function"){var o=n;n=function(){var l=t2(a);o.call(l)}}QP(e,a,t,n)}else a=Jme(i,e,t,n,r);return t2(a)}OZ=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var i=Cb(e.pendingLanes);i!==0&&(Tz(e,i|1),mo(e,yn()),!(Gi&6)&&(qy=yn()+500,Tp()))}break;case 13:Rg(function(){var r=cd(t,1);if(r!==null){var n=Va();Cc(r,t,1,n)}}),a4(t,1)}};Cz=function(t){if(t.tag===13){var e=cd(t,134217728);if(e!==null){var i=Va();Cc(e,t,134217728,i)}a4(t,134217728)}};BZ=function(t){if(t.tag===13){var e=Qf(t),i=cd(t,e);if(i!==null){var r=Va();Cc(i,t,e,r)}a4(t,e)}};FZ=function(){return ar};kZ=function(t,e){var i=ar;try{return ar=t,e()}finally{ar=i}};HB=function(t,e,i){switch(e){case"input":if(FB(t,i),e=i.name,i.type==="radio"&&e!=null){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<i.length;e++){var r=i[e];if(r!==t&&r.form===t.form){var n=HP(r);if(!n)throw Error(pt(90));pZ(r),FB(r,n)}}}break;case"textarea":gZ(t,i);break;case"select":e=i.value,e!=null&&vy(t,!!i.multiple,e,!1)}};_Z=t4;AZ=Rg;var Zme={usingClientEntryPoint:!1,Events:[$S,Hv,HP,wZ,SZ,t4]},Lx={findFiberByHostInstance:km,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ege={bundleType:Lx.bundleType,version:Lx.version,rendererPackageName:Lx.rendererPackageName,rendererConfig:Lx.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Sd.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=TZ(t),t===null?null:t.stateNode},findFiberByHostInstance:Lx.findFiberByHostInstance||$me,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var eE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!eE.isDisabled&&eE.supportsFiber)try{UP=eE.inject(ege),Ph=eE}catch{}}Ko.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zme;Ko.createPortal=function(t,e){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l4(e))throw Error(pt(200));return Qme(t,e,null,i)};Ko.createRoot=function(t,e){if(!l4(t))throw Error(pt(299));var i=!1,r="",n=ste;return e!=null&&(e.unstable_strictMode===!0&&(i=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(n=e.onRecoverableError)),e=s4(t,1,!1,null,null,i,!1,r,n),t[ld]=e.current,zw(t.nodeType===8?t.parentNode:t),new o4(e)};Ko.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(pt(188)):(t=Object.keys(t).join(","),Error(pt(268,t)));return t=TZ(e),t=t===null?null:t.stateNode,t};Ko.flushSync=function(t){return Rg(t)};Ko.hydrate=function(t,e,i){if(!JP(e))throw Error(pt(200));return ZP(null,t,e,!0,i)};Ko.hydrateRoot=function(t,e,i){if(!l4(t))throw Error(pt(405));var r=i!=null&&i.hydratedSources||null,n=!1,s="",a=ste;if(i!=null&&(i.unstable_strictMode===!0&&(n=!0),i.identifierPrefix!==void 0&&(s=i.identifierPrefix),i.onRecoverableError!==void 0&&(a=i.onRecoverableError)),e=nte(e,null,t,1,i??null,n,!1,s,a),t[ld]=e.current,zw(t),r)for(t=0;t<r.length;t++)i=r[t],n=i._getVersion,n=n(i._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[i,n]:e.mutableSourceEagerHydrationData.push(i,n);return new $P(e)};Ko.render=function(t,e,i){if(!JP(e))throw Error(pt(200));return ZP(null,t,e,!1,i)};Ko.unmountComponentAtNode=function(t){if(!JP(t))throw Error(pt(40));return t._reactRootContainer?(Rg(function(){ZP(null,null,t,!1,function(){t._reactRootContainer=null,t[ld]=null})}),!0):!1};Ko.unstable_batchedUpdates=t4;Ko.unstable_renderSubtreeIntoContainer=function(t,e,i,r){if(!JP(i))throw Error(pt(200));if(t==null||t._reactInternals===void 0)throw Error(pt(38));return ZP(t,e,i,!1,r)};Ko.version="18.3.1-next-f1338f8080-20240426";function ate(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ate)}catch(t){console.error(t)}}ate(),aZ.exports=Ko;var tge=aZ.exports,c4,VH=tge;c4=VH.createRoot,VH.hydrateRoot;const HH=[{id:1,name:"Home",href:"#home"},{id:2,name:"About",href:"#about"},{id:3,name:"Project",href:"#work"},{id:4,name:"Achievements",href:"#achievements"},{id:5,name:"Contact",href:"#contact"}],SF=[{title:"Codeleza-Your Cipher Vault",desc:"This project focuses on developing an application for encrypting and decrypting messages, allowing users to create custom keys for secure communication. Key features include user-defined languages, account creation with password protection, and the ability to save custom languages.",subdesc:"Built with Python and MySQL, The backend utilizes Python and MySQL with a database comprising three tables: Users, Languages, and Language-Keys. A simple, efficient interface ensures easy access to personalized encryption tools.",href:"https://github.com/bbhoom/codeleza-encryption-tool",texture:"/Portfolio3D/textures/project/project1.mp4",logo:"/Portfolio3D/assets/project-logo1.png",logoStyle:{backgroundColor:"#2A1816",border:"0.2px solid #36201D",boxShadow:"0px 0px 60px 0px #AA3C304D"},spotlight:"/Portfolio3D/assets/spotlight1.png",tags:[{id:1,name:"Python",path:"/Portfolio3D/assets/Python-logo.webp"},{id:2,name:"SQL",path:"/Portfolio3D/assets/sql.png"}]},{title:"BudgetApp-An React Implementation",desc:"BudgetApp is an intuitive budgeting app built with React and Bootstrap, designed to make managing personal finances simple and efficient. It empowers users to track expenses, set savings goals, and analyze spending patterns with ease.",subdesc:"With BudgetApp, users can enjoy a seamless, responsive interface that combines React's dynamic capabilities with Bootstrap's sleek design, making financial planning straightforward and accessible.",href:"https://github.com/bbhoom/BudgetApp",texture:"/Portfolio3D/textures/project/project2.mp4",logo:"/Portfolio3D/assets/project-logo2.png",logoStyle:{backgroundColor:"#13202F",border:"0.2px solid #17293E",boxShadow:"0px 0px 60px 0px #2F6DB54D"},spotlight:"/Portfolio3D/assets/spotlight2.png",tags:[{id:1,name:"React.js",path:"/Portfolio3D/assets/react.svg"},{id:2,name:"BootstrapCSS",path:"/Portfolio3D/assets/bootstrap.png"}]},{title:"Pacman-A Classic Game Recreation",desc:"A classic Pacman game recreated using Python, delivering a nostalgic arcade experience with modern enhancements. Navigate the maze, collect points, and evade ghosts in this engaging and visually captivating game.",subdesc:"Built with Pygame in python, this project showcases smooth animations, responsive controls, and a touch of retro charm, offering both entertainment and a demonstration of game development skills.",href:"https://github.com/bbhoom/Pac-man-Game",texture:"/Portfolio3D/textures/project/project3.mp4",logo:"/Portfolio3D/assets/project-logo3.png",logoStyle:{backgroundColor:"#60f5a1",background:"linear-gradient(0deg, #60F5A150, #60F5A150), linear-gradient(180deg, rgba(255, 255, 255, 0.9) 0%, rgba(208, 213, 221, 0.8) 100%)",border:"0.2px solid rgba(208, 213, 221, 1)",boxShadow:"0px 0px 60px 0px rgba(35, 131, 96, 0.3)"},spotlight:"/Portfolio3D/assets/spotlight3.png",tags:[{id:1,name:"Python",path:"/Portfolio3D/assets/Python-logo.webp"},,]},{title:"Donkey-Kong-A Unity Recreation",desc:"A modern reimagining of the iconic Donkey Kong game, developed with Unity and C#, bringing the classic platformer to life with enhanced graphics and dynamic gameplay. Climb, dodge, and conquer challenging levels in this timeless adventure.",subdesc:"Leveraging the power of Unity and C#, this project features immersive environments, fluid character movements, and a faithful recreation of the beloved arcade classic, showcasing advanced game development techniques.",href:"https://github.com/bbhoom/Donkey-Kong",texture:"/Portfolio3D/textures/project/project4.mp4",logo:"/Portfolio3D/assets/project-logo4.png",logoStyle:{backgroundColor:"#0E1F38",border:"0.2px solid #0E2D58",boxShadow:"0px 0px 60px 0px #2F67B64D"},spotlight:"/Portfolio3D/assets/spotlight4.png",tags:[{id:1,name:"C#",path:"/Portfolio3D/assets/c.png"},{id:2,name:"Unity",path:"/Portfolio3D/assets/unity.png"}]},{title:"PlagiarismPro - Advanced Plagiarism Detection Platform",desc:"PlagiarismPro is a powerful application designed to accurately detect and visualize plagiarism. It analyzes text input against online sources using advanced algorithms and presents results with clear, intuitive visualizations.",subdesc:"Built with a React frontend featuring react-gauge-chart for dynamic visual feedback, and a Django backend utilizing BeautifulSoup, Selenium, and Scikit-Learn for TF-IDF and cosine similarity calculations, PlagiarismPro leverages the Google Custom Search API to deliver precise and efficient plagiarism detection.",href:"https://github.com/bbhoom/Plagarism-Detector",texture:"/Portfolio3D/textures/project/project6.mp4",logo:"/Portfolio3D/assets/project-logo6.png",logoStyle:{backgroundColor:"#60f5a1",background:"linear-gradient(0deg, #60F5A150, #60F5A150), linear-gradient(180deg, rgba(255, 255, 255, 0.9) 0%, rgba(208, 213, 221, 0.8) 100%)",border:"0.2px solid rgba(208, 213, 221, 1)",boxShadow:"0px 0px 60px 0px rgba(35, 131, 96, 0.3)"},spotlight:"/Portfolio3D/assets/spotlight3.png",tags:[{id:1,name:"Python",path:"/Portfolio3D/assets/Python-logo.webp"},{id:2,name:"React.js",path:"/Portfolio3D/assets/react.svg"},{id:3,name:"Django",path:"/Portfolio3D/assets/django.png"}]},{title:"Talk-Tuah Therapist - Your AI Therapy Companion",desc:"Talk-Tuah Therapist is an AI-driven application designed to offer empathetic and personalized mental health support. It uses advanced AI to understand user emotions and provide thoughtful guidance for emotional well-being.",subdesc:"Developed with Python, Streamlit, and the GeminiAI API, Talk-Tuah Therapist delivers an accessible and user-friendly platform, bringing mental health support to your fingertips.",href:"https://github.com/cupnoodles7/talk_tuah_therapist",texture:"/Portfolio3D/textures/project/project5.mp4",logo:"/Portfolio3D/assets/project-logo5.png",logoStyle:{backgroundColor:"#1C1A43",border:"0.2px solid #252262",boxShadow:"0px 0px 60px 0px #635BFF4D"},spotlight:"/Portfolio3D/assets/spotlight5.png",tags:[{id:1,name:"Python",path:"/Portfolio3D/assets/Python-logo.webp"},{id:2,name:"TailwindCSS",path:"/Portfolio3D/assets/streamlit.png"}]},{title:"AI Resume Builder - Your Smart CV Friend",desc:"AI Resume Builder is an intelligent application designed to streamline resume creation with personalized content suggestions. It asks you questions to understand career goals and generate professional resume content tailored to specific job applications.",subdesc:"Developed with Python, Streamlit, and the Cohere API, AI Resume Builder delivers an accessible and user-friendly platform, bringing professional resume assistance to your fingertips.",href:"https://github.com/bbhoom/AI-Resume-Friend",texture:"/Portfolio3D/textures/project/project7.mp4",logo:"/Portfolio3D/assets/project-logo7.png",logoStyle:{backgroundColor:"#1C1A43",border:"0.2px solid #252262",boxShadow:"0px 0px 60px 0px #635BFF4D"},spotlight:"/Portfolio3D/assets/spotlight5.png",tags:[{id:1,name:"Python",path:"/Portfolio3D/assets/Python-logo.webp"},{id:2,name:"TailwindCSS",path:"/Portfolio3D/assets/streamlit.png"}]}],Ox=[{title:"Hackathon Winner",value:"1st Place",description:"Won 1st place in a 24-hour hackathon for AI Therapist project",icon:"",details:{event:"24-hour National Hackathon",project:"AI Therapist",techStack:["Python","Streamlit","Gemenai API"],impact:"Designed a mental health assistant capable of early detection of depression & anxiety using speech and text inputs, and other relaxation activities like breathing center or journaling center and many others.",recognition:"Selected as the top project among 120+ teams after 24 hours of continous dedication and team efforts",date:"November 2024"}},{title:"Patent Contributor",value:"Ambulance App",description:"Filed patent for On-Booking Ambulance Service concept",icon:"",details:{applicationNumber:"202441091901",project:"On-Booking Ambulance Service",concept:"The idea facilitates location-driven ambulance requests, optimizing dispatch through AI. By reducing communication bottlenecks, it aims to drastically decrease mortality rates associated with delayed emergency medical services.",contribution:"Contributed the core idea and helped address critical gaps in emergency healthcare logistics",status:"Patent filed and under review since Dec 2024"}},{title:"Patent Contributor",value:"Smart Mirror",description:"Filed patent for AI-powered Skincare Smart Mirror",icon:"",details:{applicationNumber:"202441088578",project:"Skin-care Smart Mirror",concept:"A smart mirror using AI and computer vision for real-time skincare analysis.This provides insights on how to keep your skin healthy and best practices on it,also provides routine reminders.",contribution:"Recognized as an inventor, helped improve Skincare Snalysis with reduced costs.",affiliation:"Filed by Dayananda Sagar College of Engineering",status:"Patent filed and under review since Nov 2024"}},{title:"Research Presenter",value:"ICCMDSAI 2025",description:"Presented research on AI-driven Braille translation at an international conference",icon:"",details:{event:"International Conference on Computational Mathematics in the Era of Data Science & AI (ICCMDSAI - 2025)",project:"Context-Aware Text-to-Braille Conversion",impact:"Improved contextual accuracy in Braille translation to enhance accessibility for visually impaired readers",recognition:"Presented in front of researchers and experts, with valuable feedback and discussions",date:"February 21-22, 2025"}}],ige=(t,e,i)=>({deskScale:t?.05:e?.06:.065,deskPosition:e?[.5,-4.5,0]:[.25,-5.5,0],cubePosition:t?[0,0,0]:e?[0,0,0]:i?[5,-5,0]:[7,-2.3,0],reactLogoPosition:t?[3,4,0]:e?[5,4,0]:i?[5,4,0]:[6,2,0],ringPosition:t?[-5,7,0]:e?[-10,8,0]:i?[-12,10,0]:[-29,9,0],targetPosition:t?[10,-10,-10]:e?[-9,-10,-10]:i?[-11,-7,-10]:[-17,-7,-10]}),rge=()=>{const[t,e]=we.useState(!1),i=()=>e(h=>!h),r=()=>e(!1),[n,s]=we.useState(()=>localStorage.getItem("theme")!=="light");we.useEffect(()=>{n?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))},[n]);const a=()=>{s(h=>!h)},[o,l]=we.useState(!1);we.useEffect(()=>{const h=()=>{window.scrollY>10?l(!0):l(!1)};return window.addEventListener("scroll",h),()=>window.removeEventListener("scroll",h)},[]),we.useEffect(()=>{const h=u=>{t&&!u.target.closest(".navbar-container")&&!u.target.closest(".mobile-menu")&&r()};return t?(document.addEventListener("click",h),document.body.style.overflow="hidden"):document.body.style.overflow="",()=>{document.removeEventListener("click",h),document.body.style.overflow=""}},[t]);const c=n?"shadow-[0_2px_10px_rgba(0,0,0,0.1)]":"shadow-[0_2px_10px_rgba(0,0,0,0.05)]";return Y.jsxs("header",{className:`fixed top-0 left-0 right-0 z-50 transition-all duration-300 
                ${n?"bg-black text-[#FAFAFA]":"bg-[#faedcd] text-[#333333]"}
                ${o?"shadow-lg py-2":`${c} py-4`}`,children:[Y.jsx("div",{className:"max-w-7xl mx-auto navbar-container",children:Y.jsxs("div",{className:"flex justify-between items-center mx-auto c-space px-4",children:[Y.jsx("a",{href:"#home",className:`font-bold text-xl ${n?"hover:text-[#A8E6CF]":"hover:text-[#f79d65]"} 
                            transition-colors duration-300 transform hover:scale-105`,onClick:r,children:"Bhoomika K S"}),Y.jsxs("label",{className:"switch transform hover:scale-105 transition-transform duration-200",children:[Y.jsx("input",{id:"input",type:"checkbox",checked:n,onChange:a}),Y.jsxs("div",{className:"slider round",children:[Y.jsxs("div",{className:"sun-moon",children:[Y.jsx("svg",{id:"moon-dot-1",className:"moon-dot",viewBox:"0 0 100 100",children:Y.jsx("circle",{cx:"50",cy:"50",r:"50"})}),Y.jsx("svg",{id:"moon-dot-2",className:"moon-dot",viewBox:"0 0 100 100",children:Y.jsx("circle",{cx:"50",cy:"50",r:"50"})}),Y.jsx("svg",{id:"moon-dot-3",className:"moon-dot",viewBox:"0 0 100 100",children:Y.jsx("circle",{cx:"50",cy:"50",r:"50"})}),Y.jsx("svg",{id:"light-ray-1",className:"light-ray",viewBox:"0 0 100 100",children:Y.jsx("circle",{cx:"50",cy:"50",r:"50"})}),Y.jsx("svg",{id:"light-ray-2",className:"light-ray",viewBox:"0 0 100 100",children:Y.jsx("circle",{cx:"50",cy:"50",r:"50"})}),Y.jsx("svg",{id:"light-ray-3",className:"light-ray",viewBox:"0 0 100 100",children:Y.jsx("circle",{cx:"50",cy:"50",r:"50"})})]}),Y.jsxs("div",{className:"stars",children:[Y.jsx("svg",{id:"star-1",className:"star",viewBox:"0 0 20 20",children:Y.jsx("path",{d:"M 0 10 C 10 10,10 10 ,0 10 C 10 10 , 10 10 , 10 20 C 10 10 , 10 10 , 20 10 C 10 10 , 10 10 , 10 0 C 10 10,10 10 ,0 10 Z"})}),Y.jsx("svg",{id:"star-2",className:"star",viewBox:"0 0 20 20",children:Y.jsx("path",{d:"M 0 10 C 10 10,10 10 ,0 10 C 10 10 , 10 10 , 10 20 C 10 10 , 10 10 , 20 10 C 10 10 , 10 10 , 10 0 C 10 10,10 10 ,0 10 Z"})})]})]})]}),Y.jsx("button",{onClick:i,className:"focus:outline-none sm:hidden flex z-50 transition-transform duration-200","aria-label":"Toggle menu","aria-expanded":t,children:Y.jsx("img",{src:t?"assets/close.svg":"assets/menu.svg",alt:t?"Close menu":"Open menu",className:"w-6 h-6"})}),Y.jsx("nav",{className:"sm:flex hidden",children:Y.jsx("ul",{className:"nav-ul flex space-x-6",children:HH.map(({id:h,href:u,name:d})=>Y.jsx("li",{className:"nav-li",children:Y.jsx("a",{href:u,className:`nav-li-a relative ${n?"text-[#FAFAFA]":"text-black"} 
                                            ${n?"hover:text-[#A8E6CF]":"hover:text-[#f79d65]"} 
                                            transition-all duration-300 ease-in-out 
                                            after:content-[''] after:absolute after:w-0 after:h-0.5 
                                            ${n?"after:bg-[#A8E6CF]":"after:bg-[#f79d65]"} 
                                            after:left-0 after:-bottom-1 
                                            after:transition-all after:duration-300 hover:after:w-full`,children:d})},h))})})]})}),t&&Y.jsxs("div",{className:"fixed inset-0 z-40 sm:hidden mobile-menu",children:[Y.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:r}),Y.jsx("div",{className:`absolute top-0 right-0 h-screen w-64 p-6 pt-20 shadow-lg
                            ${n?"bg-black text-white":"bg-[#faedcd] text-black"}`,children:Y.jsx("nav",{children:Y.jsx("ul",{className:"flex flex-col space-y-6",children:HH.map(({id:h,href:u,name:d})=>Y.jsx("li",{children:Y.jsx("a",{href:u,onClick:r,className:`text-lg block py-2 ${n?"text-white hover:text-[#A8E6CF]":"text-black hover:text-[#f79d65]"}`,children:d})},h))})})})]})]})};var h4={};h4.match=cge;h4.parse=ote;var nge=/(?:(only|not)?\s*([^\s\(\)]+)(?:\s*and)?\s*)?(.+)?/i,sge=/\(\s*([^\s\:\)]+)\s*(?:\:\s*([^\s\)]+))?\s*\)/,age=/^(?:(min|max)-)?(.+)/,oge=/(em|rem|px|cm|mm|in|pt|pc)?$/,lge=/(dpi|dpcm|dppx)?$/;function cge(t,e){return ote(t).some(function(i){var r=i.inverse,n=i.type==="all"||e.type===i.type;if(n&&r||!(n||r))return!1;var s=i.expressions.every(function(a){var o=a.feature,l=a.modifier,c=a.value,h=e[o];if(!h)return!1;switch(o){case"orientation":case"scan":return h.toLowerCase()===c.toLowerCase();case"width":case"height":case"device-width":case"device-height":c=XH(c),h=XH(h);break;case"resolution":c=WH(c),h=WH(h);break;case"aspect-ratio":case"device-aspect-ratio":case"device-pixel-ratio":c=jH(c),h=jH(h);break;case"grid":case"color":case"color-index":case"monochrome":c=parseInt(c,10)||1,h=parseInt(h,10)||0;break}switch(l){case"min":return h>=c;case"max":return h<=c;default:return h===c}});return s&&!r||!s&&r})}function ote(t){return t.split(",").map(function(e){e=e.trim();var i=e.match(nge),r=i[1],n=i[2],s=i[3]||"",a={};return a.inverse=!!r&&r.toLowerCase()==="not",a.type=n?n.toLowerCase():"all",s=s.match(/\([^\)]+\)/g)||[],a.expressions=s.map(function(o){var l=o.match(sge),c=l[1].toLowerCase().match(age);return{modifier:c[1],feature:c[2],value:l[2]}}),a})}function jH(t){var e=Number(t),i;return e||(i=t.match(/^(\d+)\s*\/\s*(\d+)$/),e=i[1]/i[2]),e}function WH(t){var e=parseFloat(t),i=String(t).match(lge)[1];switch(i){case"dpcm":return e/2.54;case"dppx":return e*96;default:return e}}function XH(t){var e=parseFloat(t),i=String(t).match(oge)[1];switch(i){case"em":return e*16;case"rem":return e*16;case"cm":return e*96/2.54;case"mm":return e*96/2.54/10;case"in":return e*96;case"pt":return e*72;case"pc":return e*72/12;default:return e}}var hge=h4.match,YH=typeof window<"u"?window.matchMedia:null;function uge(t,e,i){var r=this,n;YH&&!i&&(n=YH.call(window,t)),n?(this.matches=n.matches,this.media=n.media,n.addListener(o)):(this.matches=hge(t,e),this.media=t),this.addListener=s,this.removeListener=a,this.dispose=l;function s(c){n&&n.addListener(c)}function a(c){n&&n.removeListener(c)}function o(c){r.matches=c.matches,r.media=c.media}function l(){n&&n.removeListener(o)}}function dge(t,e,i){return new uge(t,e,i)}var fge=dge;const pge=C1(fge);var mge=/[A-Z]/g,gge=/^ms-/,BI={};function vge(t){return"-"+t.toLowerCase()}function lte(t){if(BI.hasOwnProperty(t))return BI[t];var e=t.replace(mge,vge);return BI[t]=gge.test(e)?"-"+e:e}function yge(t,e){if(t===e)return!0;if(!t||!e)return!1;const i=Object.keys(t),r=Object.keys(e),n=i.length;if(r.length!==n)return!1;for(let s=0;s<n;s++){const a=i[s];if(t[a]!==e[a]||!Object.prototype.hasOwnProperty.call(e,a))return!1}return!0}var cte={exports:{}},xge="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",bge=xge,wge=bge;function hte(){}function ute(){}ute.resetWarningCache=hte;var Sge=function(){function t(r,n,s,a,o,l){if(l!==wge){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}t.isRequired=t;function e(){return t}var i={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:ute,resetWarningCache:hte};return i.PropTypes=i,i};cte.exports=Sge();var _ge=cte.exports;const Ki=C1(_ge),Ia=Ki.oneOfType([Ki.string,Ki.number]),u4={all:Ki.bool,grid:Ki.bool,aural:Ki.bool,braille:Ki.bool,handheld:Ki.bool,print:Ki.bool,projection:Ki.bool,screen:Ki.bool,tty:Ki.bool,tv:Ki.bool,embossed:Ki.bool},dte={orientation:Ki.oneOf(["portrait","landscape"]),scan:Ki.oneOf(["progressive","interlace"]),aspectRatio:Ki.string,deviceAspectRatio:Ki.string,height:Ia,deviceHeight:Ia,width:Ia,deviceWidth:Ia,color:Ki.bool,colorIndex:Ki.bool,monochrome:Ki.bool,resolution:Ia,type:Object.keys(u4)},{type:pnt,...Age}=dte,fte={minAspectRatio:Ki.string,maxAspectRatio:Ki.string,minDeviceAspectRatio:Ki.string,maxDeviceAspectRatio:Ki.string,minHeight:Ia,maxHeight:Ia,minDeviceHeight:Ia,maxDeviceHeight:Ia,minWidth:Ia,maxWidth:Ia,minDeviceWidth:Ia,maxDeviceWidth:Ia,minColor:Ki.number,maxColor:Ki.number,minColorIndex:Ki.number,maxColorIndex:Ki.number,minMonochrome:Ki.number,maxMonochrome:Ki.number,minResolution:Ia,maxResolution:Ia,...Age},Ege={...u4,...fte};var Mge={all:Ege,types:u4,matchers:dte,features:fte};const Tge=t=>`not ${t}`,Cge=(t,e)=>{const i=lte(t);return typeof e=="number"&&(e=`${e}px`),e===!0?i:e===!1?Tge(i):`(${i}: ${e})`},Pge=t=>t.join(" and "),Dge=t=>{const e=[];return Object.keys(Mge.all).forEach(i=>{const r=t[i];r!=null&&e.push(Cge(i,r))}),Pge(e)},Rge=we.createContext(void 0),Ige=t=>t.query||Dge(t),qH=t=>t?Object.keys(t).reduce((i,r)=>(i[lte(r)]=t[r],i),{}):void 0,pte=()=>{const t=we.useRef(!1);return we.useEffect(()=>{t.current=!0},[]),t.current},Lge=t=>{const e=we.useContext(Rge),i=()=>qH(t)||qH(e),[r,n]=we.useState(i);return we.useEffect(()=>{const s=i();yge(r,s)||n(s)},[t,e]),r},Oge=t=>{const e=()=>Ige(t),[i,r]=we.useState(e);return we.useEffect(()=>{const n=e();i!==n&&r(n)},[t]),i},Bge=(t,e)=>{const i=()=>pge(t,e||{},!!e),[r,n]=we.useState(i),s=pte();return we.useEffect(()=>{if(s){const a=i();return n(a),()=>{a&&a.dispose()}}},[t,e]),r},Fge=t=>{const[e,i]=we.useState(t.matches);return we.useEffect(()=>{const r=n=>{i(n.matches)};return t.addListener(r),i(t.matches),()=>{t.removeListener(r)}},[t]),e},FI=(t,e,i)=>{const r=Lge(e),n=Oge(t);if(!n)throw new Error("Invalid or missing MediaQuery!");const s=Bge(n,r),a=Fge(s),o=pte();return we.useEffect(()=>{o&&i&&i(a)},[a]),we.useEffect(()=>()=>{s&&s.dispose()},[]),a};/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const ZS="146",xm={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},bm={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},mte=0,_F=1,gte=2,kge=3,vte=0,eD=1,rw=2,zm=3,cp=0,Go=1,_c=2,td=0,og=1,AF=2,EF=3,MF=4,yte=5,Pm=100,xte=101,bte=102,TF=103,CF=104,wte=200,Ste=201,_te=202,Ate=203,d4=204,f4=205,Ete=206,Mte=207,Tte=208,Cte=209,Pte=210,Dte=0,Rte=1,Ite=2,i2=3,Lte=4,Ote=5,Bte=6,Fte=7,e_=0,kte=1,Nte=2,Pc=0,Ute=1,zte=2,Gte=3,p4=4,Vte=5,tD=300,hp=301,up=302,Kw=303,Qw=304,I1=306,dp=1e3,js=1001,Ky=1002,xn=1003,$w=1004,Nge=1004,Jw=1005,Uge=1005,Hr=1006,iD=1007,zge=1007,_d=1008,Gge=1008,ud=1009,Hte=1010,jte=1011,m4=1012,Wte=1013,Pf=1014,Wu=1015,Qy=1016,Xte=1017,Yte=1018,lg=1020,qte=1021,Kte=1022,so=1023,Qte=1024,$te=1025,Jf=1026,Ig=1027,Jte=1028,Zte=1029,eie=1030,tie=1031,iie=1033,WT=33776,XT=33777,YT=33778,qT=33779,PF=35840,DF=35841,RF=35842,IF=35843,rie=36196,LF=37492,OF=37496,BF=37808,FF=37809,kF=37810,NF=37811,UF=37812,zF=37813,GF=37814,VF=37815,HF=37816,jF=37817,WF=37818,XF=37819,YF=37820,qF=37821,KF=36492,nie=2200,sie=2201,aie=2202,$y=2300,Lg=2301,KT=2302,Gm=2400,Vm=2401,Zw=2402,rD=2500,g4=2501,oie=0,v4=1,r2=2,fp=3e3,zr=3001,lie=3200,cie=3201,Cp=0,hie=1,Vge="",uh="srgb",Df="srgb-linear",Hge=0,QT=7680,jge=7681,Wge=7682,Xge=7683,Yge=34055,qge=34056,Kge=5386,Qge=512,$ge=513,Jge=514,Zge=515,e0e=516,t0e=517,i0e=518,uie=519,eS=35044,r0e=35048,n0e=35040,s0e=35045,a0e=35049,o0e=35041,l0e=35046,c0e=35050,h0e=35042,u0e="100",QF="300 es",n2=1035;class Yh{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(i)===-1&&r[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const n=r.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,e);e.target=null}}}const sa=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let KH=1234567;const cg=Math.PI/180,tS=180/Math.PI;function Vo(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(sa[t&255]+sa[t>>8&255]+sa[t>>16&255]+sa[t>>24&255]+"-"+sa[e&255]+sa[e>>8&255]+"-"+sa[e>>16&15|64]+sa[e>>24&255]+"-"+sa[i&63|128]+sa[i>>8&255]+"-"+sa[i>>16&255]+sa[i>>24&255]+sa[r&255]+sa[r>>8&255]+sa[r>>16&255]+sa[r>>24&255]).toLowerCase()}function bn(t,e,i){return Math.max(e,Math.min(i,t))}function y4(t,e){return(t%e+e)%e}function d0e(t,e,i,r,n){return r+(t-e)*(n-r)/(i-e)}function f0e(t,e,i){return t!==e?(i-t)/(e-t):0}function nw(t,e,i){return(1-i)*t+i*e}function p0e(t,e,i,r){return nw(t,e,1-Math.exp(-i*r))}function m0e(t,e=1){return e-Math.abs(y4(t,e*2)-e)}function g0e(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))}function v0e(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(t*6-15)+10))}function y0e(t,e){return t+Math.floor(Math.random()*(e-t+1))}function x0e(t,e){return t+Math.random()*(e-t)}function b0e(t){return t*(.5-Math.random())}function w0e(t){t!==void 0&&(KH=t);let e=KH+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function S0e(t){return t*cg}function _0e(t){return t*tS}function $F(t){return(t&t-1)===0&&t!==0}function die(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function s2(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function A0e(t,e,i,r,n){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((e+r)/2),h=a((e+r)/2),u=s((e-r)/2),d=a((e-r)/2),f=s((r-e)/2),p=a((r-e)/2);switch(n){case"XYX":t.set(o*h,l*u,l*d,o*c);break;case"YZY":t.set(l*d,o*h,l*u,o*c);break;case"ZXZ":t.set(l*u,l*d,o*h,o*c);break;case"XZX":t.set(o*h,l*p,l*f,o*c);break;case"YXY":t.set(l*f,o*h,l*p,o*c);break;case"ZYZ":t.set(l*p,l*f,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function Xu(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function pr(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}var x4=Object.freeze({__proto__:null,DEG2RAD:cg,RAD2DEG:tS,generateUUID:Vo,clamp:bn,euclideanModulo:y4,mapLinear:d0e,inverseLerp:f0e,lerp:nw,damp:p0e,pingpong:m0e,smoothstep:g0e,smootherstep:v0e,randInt:y0e,randFloat:x0e,randFloatSpread:b0e,seededRandom:w0e,degToRad:S0e,radToDeg:_0e,isPowerOfTwo:$F,ceilPowerOfTwo:die,floorPowerOfTwo:s2,setQuaternionFromProperEuler:A0e,normalize:pr,denormalize:Xu});class tt{constructor(e=0,i=0){tt.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,r=this.y,n=e.elements;return this.x=n[0]*i+n[3]*r+n[6],this.y=n[1]*i+n[4]*r+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,r=this.y-e.y;return i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const r=Math.cos(i),n=Math.sin(i),s=this.x-e.x,a=this.y-e.y;return this.x=s*r-a*n+e.x,this.y=s*n+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class co{constructor(){co.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,i,r,n,s,a,o,l,c){const h=this.elements;return h[0]=e,h[1]=n,h[2]=o,h[3]=i,h[4]=s,h[5]=l,h[6]=r,h[7]=a,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(e,i,r){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const r=e.elements,n=i.elements,s=this.elements,a=r[0],o=r[3],l=r[6],c=r[1],h=r[4],u=r[7],d=r[2],f=r[5],p=r[8],m=n[0],g=n[3],v=n[6],y=n[1],x=n[4],S=n[7],A=n[2],_=n[5],M=n[8];return s[0]=a*m+o*y+l*A,s[3]=a*g+o*x+l*_,s[6]=a*v+o*S+l*M,s[1]=c*m+h*y+u*A,s[4]=c*g+h*x+u*_,s[7]=c*v+h*S+u*M,s[2]=d*m+f*y+p*A,s[5]=d*g+f*x+p*_,s[8]=d*v+f*S+p*M,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8];return i*a*h-i*o*c-r*s*h+r*o*l+n*s*c-n*a*l}invert(){const e=this.elements,i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8],u=h*a-o*c,d=o*l-h*s,f=c*s-a*l,p=i*u+r*d+n*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=u*m,e[1]=(n*c-h*r)*m,e[2]=(o*r-n*a)*m,e[3]=d*m,e[4]=(h*i-n*l)*m,e[5]=(n*s-o*i)*m,e[6]=f*m,e[7]=(r*l-c*i)*m,e[8]=(a*i-r*s)*m,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,r,n,s,a,o){const l=Math.cos(s),c=Math.sin(s);return this.set(r*l,r*c,-r*(l*a+c*o)+a+e,-n*c,n*l,-n*(-c*a+l*o)+o+i,0,0,1),this}scale(e,i){const r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=i,r[4]*=i,r[7]*=i,this}rotate(e){const i=Math.cos(e),r=Math.sin(e),n=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],c=n[4],h=n[7];return n[0]=i*s+r*l,n[3]=i*a+r*c,n[6]=i*o+r*h,n[1]=-r*s+i*l,n[4]=-r*a+i*c,n[7]=-r*o+i*h,this}translate(e,i){const r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=i*r[2],r[4]+=i*r[5],r[7]+=i*r[8],this}equals(e){const i=this.elements,r=e.elements;for(let n=0;n<9;n++)if(i[n]!==r[n])return!1;return!0}fromArray(e,i=0){for(let r=0;r<9;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){const r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function fie(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const E0e={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Qv(t,e){return new E0e[t](e)}function iS(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function hg(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function $T(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const kI={[uh]:{[Df]:hg},[Df]:{[uh]:$T}},ml={legacyMode:!0,get workingColorSpace(){return Df},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(kI[e]&&kI[e][i]!==void 0){const r=kI[e][i];return t.r=r(t.r),t.g=r(t.g),t.b=r(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},pie={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},jn={r:0,g:0,b:0},tc={h:0,s:0,l:0},tE={h:0,s:0,l:0};function NI(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*6*(2/3-i):t}function iE(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}class Ct{constructor(e,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,i===void 0&&r===void 0?this.set(e):this.setRGB(e,i,r)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=uh){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ml.toWorkingColorSpace(this,i),this}setRGB(e,i,r,n=Df){return this.r=e,this.g=i,this.b=r,ml.toWorkingColorSpace(this,n),this}setHSL(e,i,r,n=Df){if(e=y4(e,1),i=bn(i,0,1),r=bn(r,0,1),i===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+i):r+i-r*i,a=2*r-s;this.r=NI(a,s,e+1/3),this.g=NI(a,s,e),this.b=NI(a,s,e-1/3)}return ml.toWorkingColorSpace(this,n),this}setStyle(e,i=uh){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let s;const a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,ml.toWorkingColorSpace(this,i),r(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,ml.toWorkingColorSpace(this,i),r(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const l=parseFloat(s[1])/360,c=parseFloat(s[2])/100,h=parseFloat(s[3])/100;return r(s[4]),this.setHSL(l,c,h,i)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=n[1],a=s.length;if(a===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,ml.toWorkingColorSpace(this,i),this;if(a===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,ml.toWorkingColorSpace(this,i),this}return e&&e.length>0?this.setColorName(e,i):this}setColorName(e,i=uh){const r=pie[e.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=hg(e.r),this.g=hg(e.g),this.b=hg(e.b),this}copyLinearToSRGB(e){return this.r=$T(e.r),this.g=$T(e.g),this.b=$T(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=uh){return ml.fromWorkingColorSpace(iE(this,jn),e),bn(jn.r*255,0,255)<<16^bn(jn.g*255,0,255)<<8^bn(jn.b*255,0,255)<<0}getHexString(e=uh){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=Df){ml.fromWorkingColorSpace(iE(this,jn),i);const r=jn.r,n=jn.g,s=jn.b,a=Math.max(r,n,s),o=Math.min(r,n,s);let l,c;const h=(o+a)/2;if(o===a)l=0,c=0;else{const u=a-o;switch(c=h<=.5?u/(a+o):u/(2-a-o),a){case r:l=(n-s)/u+(n<s?6:0);break;case n:l=(s-r)/u+2;break;case s:l=(r-n)/u+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,i=Df){return ml.fromWorkingColorSpace(iE(this,jn),i),e.r=jn.r,e.g=jn.g,e.b=jn.b,e}getStyle(e=uh){return ml.fromWorkingColorSpace(iE(this,jn),e),e!==uh?`color(${e} ${jn.r} ${jn.g} ${jn.b})`:`rgb(${jn.r*255|0},${jn.g*255|0},${jn.b*255|0})`}offsetHSL(e,i,r){return this.getHSL(tc),tc.h+=e,tc.s+=i,tc.l+=r,this.setHSL(tc.h,tc.s,tc.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,r){return this.r=e.r+(i.r-e.r)*r,this.g=e.g+(i.g-e.g)*r,this.b=e.b+(i.b-e.b)*r,this}lerpHSL(e,i){this.getHSL(tc),e.getHSL(tE);const r=nw(tc.h,tE.h,i),n=nw(tc.s,tE.s,i),s=nw(tc.l,tE.l,i);return this.setHSL(r,n,s),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}Ct.NAMES=pie;let E0;class b4{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{E0===void 0&&(E0=iS("canvas")),E0.width=e.width,E0.height=e.height;const r=E0.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),i=E0}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=iS("canvas");i.width=e.width,i.height=e.height;const r=i.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const n=r.getImageData(0,0,e.width,e.height),s=n.data;for(let a=0;a<s.length;a++)s[a]=hg(s[a]/255)*255;return r.putImageData(n,0,0),i}else if(e.data){const i=e.data.slice(0);for(let r=0;r<i.length;r++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[r]=Math.floor(hg(i[r]/255)*255):i[r]=hg(i[r]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class Hm{constructor(e=null){this.isSource=!0,this.uuid=Vo(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,o=n.length;a<o;a++)n[a].isDataTexture?s.push(UI(n[a].image)):s.push(UI(n[a]))}else s=UI(n);r.url=s}return i||(e.images[this.uuid]=r),r}}function UI(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?b4.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let M0e=0;class kr extends Yh{constructor(e=kr.DEFAULT_IMAGE,i=kr.DEFAULT_MAPPING,r=js,n=js,s=Hr,a=_d,o=so,l=ud,c=1,h=fp){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:M0e++}),this.uuid=Vo(),this.name="",this.source=new Hm(e),this.mipmaps=[],this.mapping=i,this.wrapS=r,this.wrapT=n,this.magFilter=s,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new tt(0,0),this.repeat=new tt(1,1),this.center=new tt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new co,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),i||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==tD)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case dp:e.x=e.x-Math.floor(e.x);break;case js:e.x=e.x<0?0:1;break;case Ky:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case dp:e.y=e.y-Math.floor(e.y);break;case js:e.y=e.y<0?0:1;break;case Ky:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}kr.DEFAULT_IMAGE=null;kr.DEFAULT_MAPPING=tD;class rr{constructor(e=0,i=0,r=0,n=1){rr.prototype.isVector4=!0,this.x=e,this.y=i,this.z=r,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,r,n){return this.x=e,this.y=i,this.z=r,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,r=this.y,n=this.z,s=this.w,a=e.elements;return this.x=a[0]*i+a[4]*r+a[8]*n+a[12]*s,this.y=a[1]*i+a[5]*r+a[9]*n+a[13]*s,this.z=a[2]*i+a[6]*r+a[10]*n+a[14]*s,this.w=a[3]*i+a[7]*r+a[11]*n+a[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,r,n,s;const l=e.elements,c=l[0],h=l[4],u=l[8],d=l[1],f=l[5],p=l[9],m=l[2],g=l[6],v=l[10];if(Math.abs(h-d)<.01&&Math.abs(u-m)<.01&&Math.abs(p-g)<.01){if(Math.abs(h+d)<.1&&Math.abs(u+m)<.1&&Math.abs(p+g)<.1&&Math.abs(c+f+v-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const x=(c+1)/2,S=(f+1)/2,A=(v+1)/2,_=(h+d)/4,M=(u+m)/4,E=(p+g)/4;return x>S&&x>A?x<.01?(r=0,n=.707106781,s=.707106781):(r=Math.sqrt(x),n=_/r,s=M/r):S>A?S<.01?(r=.707106781,n=0,s=.707106781):(n=Math.sqrt(S),r=_/n,s=E/n):A<.01?(r=.707106781,n=.707106781,s=0):(s=Math.sqrt(A),r=M/s,n=E/s),this.set(r,n,s,i),this}let y=Math.sqrt((g-p)*(g-p)+(u-m)*(u-m)+(d-h)*(d-h));return Math.abs(y)<.001&&(y=1),this.x=(g-p)/y,this.y=(u-m)/y,this.z=(d-h)/y,this.w=Math.acos((c+f+v-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this.w=e.w+(i.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Hl extends Yh{constructor(e=1,i=1,r={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=i,this.depth=1,this.scissor=new rr(0,0,e,i),this.scissorTest=!1,this.viewport=new rr(0,0,e,i);const n={width:e,height:i,depth:1};this.texture=new kr(n,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1,this.texture.internalFormat=r.internalFormat!==void 0?r.internalFormat:null,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:Hr,this.depthBuffer=r.depthBuffer!==void 0?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==void 0?r.stencilBuffer:!1,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null,this.samples=r.samples!==void 0?r.samples:0}setSize(e,i,r=1){(this.width!==e||this.height!==i||this.depth!==r)&&(this.width=e,this.height=i,this.depth=r,this.texture.image.width=e,this.texture.image.height=i,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const i=Object.assign({},e.texture.image);return this.texture.source=new Hm(i),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class t_ extends kr{constructor(e=null,i=1,r=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:r,depth:n},this.magFilter=xn,this.minFilter=xn,this.wrapR=js,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class T0e extends Hl{constructor(e=1,i=1,r=1){super(e,i),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new t_(null,e,i,r),this.texture.isRenderTargetTexture=!0}}class nD extends kr{constructor(e=null,i=1,r=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:r,depth:n},this.magFilter=xn,this.minFilter=xn,this.wrapR=js,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class C0e extends Hl{constructor(e=1,i=1,r=1){super(e,i),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new nD(null,e,i,r),this.texture.isRenderTargetTexture=!0}}class P0e extends Hl{constructor(e=1,i=1,r=1,n={}){super(e,i,n),this.isWebGLMultipleRenderTargets=!0;const s=this.texture;this.texture=[];for(let a=0;a<r;a++)this.texture[a]=s.clone(),this.texture[a].isRenderTargetTexture=!0}setSize(e,i,r=1){if(this.width!==e||this.height!==i||this.depth!==r){this.width=e,this.height=i,this.depth=r;for(let n=0,s=this.texture.length;n<s;n++)this.texture[n].image.width=e,this.texture[n].image.height=i,this.texture[n].image.depth=r;this.dispose()}return this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let i=0,r=e.texture.length;i<r;i++)this.texture[i]=e.texture[i].clone(),this.texture[i].isRenderTargetTexture=!0;return this}}class Ds{constructor(e=0,i=0,r=0,n=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=r,this._w=n}static slerpFlat(e,i,r,n,s,a,o){let l=r[n+0],c=r[n+1],h=r[n+2],u=r[n+3];const d=s[a+0],f=s[a+1],p=s[a+2],m=s[a+3];if(o===0){e[i+0]=l,e[i+1]=c,e[i+2]=h,e[i+3]=u;return}if(o===1){e[i+0]=d,e[i+1]=f,e[i+2]=p,e[i+3]=m;return}if(u!==m||l!==d||c!==f||h!==p){let g=1-o;const v=l*d+c*f+h*p+u*m,y=v>=0?1:-1,x=1-v*v;if(x>Number.EPSILON){const A=Math.sqrt(x),_=Math.atan2(A,v*y);g=Math.sin(g*_)/A,o=Math.sin(o*_)/A}const S=o*y;if(l=l*g+d*S,c=c*g+f*S,h=h*g+p*S,u=u*g+m*S,g===1-o){const A=1/Math.sqrt(l*l+c*c+h*h+u*u);l*=A,c*=A,h*=A,u*=A}}e[i]=l,e[i+1]=c,e[i+2]=h,e[i+3]=u}static multiplyQuaternionsFlat(e,i,r,n,s,a){const o=r[n],l=r[n+1],c=r[n+2],h=r[n+3],u=s[a],d=s[a+1],f=s[a+2],p=s[a+3];return e[i]=o*p+h*u+l*f-c*d,e[i+1]=l*p+h*d+c*u-o*f,e[i+2]=c*p+h*f+o*d-l*u,e[i+3]=h*p-o*u-l*d-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,r,n){return this._x=e,this._y=i,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i){const r=e._x,n=e._y,s=e._z,a=e._order,o=Math.cos,l=Math.sin,c=o(r/2),h=o(n/2),u=o(s/2),d=l(r/2),f=l(n/2),p=l(s/2);switch(a){case"XYZ":this._x=d*h*u+c*f*p,this._y=c*f*u-d*h*p,this._z=c*h*p+d*f*u,this._w=c*h*u-d*f*p;break;case"YXZ":this._x=d*h*u+c*f*p,this._y=c*f*u-d*h*p,this._z=c*h*p-d*f*u,this._w=c*h*u+d*f*p;break;case"ZXY":this._x=d*h*u-c*f*p,this._y=c*f*u+d*h*p,this._z=c*h*p+d*f*u,this._w=c*h*u-d*f*p;break;case"ZYX":this._x=d*h*u-c*f*p,this._y=c*f*u+d*h*p,this._z=c*h*p-d*f*u,this._w=c*h*u+d*f*p;break;case"YZX":this._x=d*h*u+c*f*p,this._y=c*f*u+d*h*p,this._z=c*h*p-d*f*u,this._w=c*h*u-d*f*p;break;case"XZY":this._x=d*h*u-c*f*p,this._y=c*f*u-d*h*p,this._z=c*h*p+d*f*u,this._w=c*h*u+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const r=i/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,r=i[0],n=i[4],s=i[8],a=i[1],o=i[5],l=i[9],c=i[2],h=i[6],u=i[10],d=r+o+u;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(h-l)*f,this._y=(s-c)*f,this._z=(a-n)*f}else if(r>o&&r>u){const f=2*Math.sqrt(1+r-o-u);this._w=(h-l)/f,this._x=.25*f,this._y=(n+a)/f,this._z=(s+c)/f}else if(o>u){const f=2*Math.sqrt(1+o-r-u);this._w=(s-c)/f,this._x=(n+a)/f,this._y=.25*f,this._z=(l+h)/f}else{const f=2*Math.sqrt(1+u-r-o);this._w=(a-n)/f,this._x=(s+c)/f,this._y=(l+h)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let r=e.dot(i)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(bn(this.dot(e),-1,1)))}rotateTowards(e,i){const r=this.angleTo(e);if(r===0)return this;const n=Math.min(1,i/r);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const r=e._x,n=e._y,s=e._z,a=e._w,o=i._x,l=i._y,c=i._z,h=i._w;return this._x=r*h+a*o+n*c-s*l,this._y=n*h+a*l+s*o-r*c,this._z=s*h+a*c+r*l-n*o,this._w=a*h-r*o-n*l-s*c,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);const r=this._x,n=this._y,s=this._z,a=this._w;let o=a*e._w+r*e._x+n*e._y+s*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=n,this._z=s,this;const l=1-o*o;if(l<=Number.EPSILON){const f=1-i;return this._w=f*a+i*this._w,this._x=f*r+i*this._x,this._y=f*n+i*this._y,this._z=f*s+i*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),h=Math.atan2(c,o),u=Math.sin((1-i)*h)/c,d=Math.sin(i*h)/c;return this._w=a*u+this._w*d,this._x=r*u+this._x*d,this._y=n*u+this._y*d,this._z=s*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,i,r){return this.copy(e).slerp(i,r)}random(){const e=Math.random(),i=Math.sqrt(1-e),r=Math.sqrt(e),n=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(i*Math.cos(n),r*Math.sin(s),r*Math.cos(s),i*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class le{constructor(e=0,i=0,r=0){le.prototype.isVector3=!0,this.x=e,this.y=i,this.z=r}set(e,i,r){return r===void 0&&(r=this.z),this.x=e,this.y=i,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(QH.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(QH.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,r=this.y,n=this.z,s=e.elements;return this.x=s[0]*i+s[3]*r+s[6]*n,this.y=s[1]*i+s[4]*r+s[7]*n,this.z=s[2]*i+s[5]*r+s[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,r=this.y,n=this.z,s=e.elements,a=1/(s[3]*i+s[7]*r+s[11]*n+s[15]);return this.x=(s[0]*i+s[4]*r+s[8]*n+s[12])*a,this.y=(s[1]*i+s[5]*r+s[9]*n+s[13])*a,this.z=(s[2]*i+s[6]*r+s[10]*n+s[14])*a,this}applyQuaternion(e){const i=this.x,r=this.y,n=this.z,s=e.x,a=e.y,o=e.z,l=e.w,c=l*i+a*n-o*r,h=l*r+o*i-s*n,u=l*n+s*r-a*i,d=-s*i-a*r-o*n;return this.x=c*l+d*-s+h*-o-u*-a,this.y=h*l+d*-a+u*-s-c*-o,this.z=u*l+d*-o+c*-a-h*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,r=this.y,n=this.z,s=e.elements;return this.x=s[0]*i+s[4]*r+s[8]*n,this.y=s[1]*i+s[5]*r+s[9]*n,this.z=s[2]*i+s[6]*r+s[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const r=e.x,n=e.y,s=e.z,a=i.x,o=i.y,l=i.z;return this.x=n*l-s*o,this.y=s*a-r*l,this.z=r*o-n*a,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const r=e.dot(this)/i;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return zI.copy(this).projectOnVector(e),this.sub(zI)}reflect(e){return this.sub(zI.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(e)/i;return Math.acos(bn(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return i*i+r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,r){const n=Math.sin(i)*e;return this.x=n*Math.sin(r),this.y=Math.cos(i)*e,this.z=n*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,r){return this.x=e*Math.sin(i),this.y=r,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=r,this.z=n,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,i=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(i),this.y=r*Math.sin(i),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const zI=new le,QH=new Ds;class Ad{constructor(e=new le(1/0,1/0,1/0),i=new le(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){let i=1/0,r=1/0,n=1/0,s=-1/0,a=-1/0,o=-1/0;for(let l=0,c=e.length;l<c;l+=3){const h=e[l],u=e[l+1],d=e[l+2];h<i&&(i=h),u<r&&(r=u),d<n&&(n=d),h>s&&(s=h),u>a&&(a=u),d>o&&(o=d)}return this.min.set(i,r,n),this.max.set(s,a,o),this}setFromBufferAttribute(e){let i=1/0,r=1/0,n=1/0,s=-1/0,a=-1/0,o=-1/0;for(let l=0,c=e.count;l<c;l++){const h=e.getX(l),u=e.getY(l),d=e.getZ(l);h<i&&(i=h),u<r&&(r=u),d<n&&(n=d),h>s&&(s=h),u>a&&(a=u),d>o&&(o=d)}return this.min.set(i,r,n),this.max.set(s,a,o),this}setFromPoints(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const r=Kp.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0)if(i&&r.attributes!=null&&r.attributes.position!==void 0){const s=r.attributes.position;for(let a=0,o=s.count;a<o;a++)Kp.fromBufferAttribute(s,a).applyMatrix4(e.matrixWorld),this.expandByPoint(Kp)}else r.boundingBox===null&&r.computeBoundingBox(),GI.copy(r.boundingBox),GI.applyMatrix4(e.matrixWorld),this.union(GI);const n=e.children;for(let s=0,a=n.length;s<a;s++)this.expandByObject(n[s],i);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Kp),Kp.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,r;return e.normal.x>0?(i=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),i<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Bx),rE.subVectors(this.max,Bx),M0.subVectors(e.a,Bx),T0.subVectors(e.b,Bx),C0.subVectors(e.c,Bx),Gd.subVectors(T0,M0),Vd.subVectors(C0,T0),Qp.subVectors(M0,C0);let i=[0,-Gd.z,Gd.y,0,-Vd.z,Vd.y,0,-Qp.z,Qp.y,Gd.z,0,-Gd.x,Vd.z,0,-Vd.x,Qp.z,0,-Qp.x,-Gd.y,Gd.x,0,-Vd.y,Vd.x,0,-Qp.y,Qp.x,0];return!VI(i,M0,T0,C0,rE)||(i=[1,0,0,0,1,0,0,0,1],!VI(i,M0,T0,C0,rE))?!1:(nE.crossVectors(Gd,Vd),i=[nE.x,nE.y,nE.z],VI(i,M0,T0,C0,rE))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Kp.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Kp).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(nu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),nu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),nu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),nu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),nu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),nu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),nu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),nu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(nu),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const nu=[new le,new le,new le,new le,new le,new le,new le,new le],Kp=new le,GI=new Ad,M0=new le,T0=new le,C0=new le,Gd=new le,Vd=new le,Qp=new le,Bx=new le,rE=new le,nE=new le,$p=new le;function VI(t,e,i,r,n){for(let s=0,a=t.length-3;s<=a;s+=3){$p.fromArray(t,s);const o=n.x*Math.abs($p.x)+n.y*Math.abs($p.y)+n.z*Math.abs($p.z),l=e.dot($p),c=i.dot($p),h=r.dot($p);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>o)return!1}return!0}const D0e=new Ad,Fx=new le,HI=new le;class Ed{constructor(e=new le,i=-1){this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){const r=this.center;i!==void 0?r.copy(i):D0e.setFromPoints(e).getCenter(r);let n=0;for(let s=0,a=e.length;s<a;s++)n=Math.max(n,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){const r=this.center.distanceToSquared(e);return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Fx.subVectors(e,this.center);const i=Fx.lengthSq();if(i>this.radius*this.radius){const r=Math.sqrt(i),n=(r-this.radius)*.5;this.center.addScaledVector(Fx,n/r),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(HI.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Fx.copy(e.center).add(HI)),this.expandByPoint(Fx.copy(e.center).sub(HI))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const su=new le,jI=new le,sE=new le,Hd=new le,WI=new le,aE=new le,XI=new le;class L1{constructor(e=new le,i=new le(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,su)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);const r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(r).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const i=su.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(su.copy(this.direction).multiplyScalar(i).add(this.origin),su.distanceToSquared(e))}distanceSqToSegment(e,i,r,n){jI.copy(e).add(i).multiplyScalar(.5),sE.copy(i).sub(e).normalize(),Hd.copy(this.origin).sub(jI);const s=e.distanceTo(i)*.5,a=-this.direction.dot(sE),o=Hd.dot(this.direction),l=-Hd.dot(sE),c=Hd.lengthSq(),h=Math.abs(1-a*a);let u,d,f,p;if(h>0)if(u=a*l-o,d=a*o-l,p=s*h,u>=0)if(d>=-p)if(d<=p){const m=1/h;u*=m,d*=m,f=u*(u+a*d+2*o)+d*(a*u+d+2*l)+c}else d=s,u=Math.max(0,-(a*d+o)),f=-u*u+d*(d+2*l)+c;else d=-s,u=Math.max(0,-(a*d+o)),f=-u*u+d*(d+2*l)+c;else d<=-p?(u=Math.max(0,-(-a*s+o)),d=u>0?-s:Math.min(Math.max(-s,-l),s),f=-u*u+d*(d+2*l)+c):d<=p?(u=0,d=Math.min(Math.max(-s,-l),s),f=d*(d+2*l)+c):(u=Math.max(0,-(a*s+o)),d=u>0?s:Math.min(Math.max(-s,-l),s),f=-u*u+d*(d+2*l)+c);else d=a>0?-s:s,u=Math.max(0,-(a*d+o)),f=-u*u+d*(d+2*l)+c;return r&&r.copy(this.direction).multiplyScalar(u).add(this.origin),n&&n.copy(sE).multiplyScalar(d).add(jI),f}intersectSphere(e,i){su.subVectors(e.center,this.origin);const r=su.dot(this.direction),n=su.dot(su)-r*r,s=e.radius*e.radius;if(n>s)return null;const a=Math.sqrt(s-n),o=r-a,l=r+a;return o<0&&l<0?null:o<0?this.at(l,i):this.at(o,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/i;return r>=0?r:null}intersectPlane(e,i){const r=this.distanceToPlane(e);return r===null?null:this.at(r,i)}intersectsPlane(e){const i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let r,n,s,a,o,l;const c=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,d=this.origin;return c>=0?(r=(e.min.x-d.x)*c,n=(e.max.x-d.x)*c):(r=(e.max.x-d.x)*c,n=(e.min.x-d.x)*c),h>=0?(s=(e.min.y-d.y)*h,a=(e.max.y-d.y)*h):(s=(e.max.y-d.y)*h,a=(e.min.y-d.y)*h),r>a||s>n||((s>r||isNaN(r))&&(r=s),(a<n||isNaN(n))&&(n=a),u>=0?(o=(e.min.z-d.z)*u,l=(e.max.z-d.z)*u):(o=(e.max.z-d.z)*u,l=(e.min.z-d.z)*u),r>l||o>n)||((o>r||r!==r)&&(r=o),(l<n||n!==n)&&(n=l),n<0)?null:this.at(r>=0?r:n,i)}intersectsBox(e){return this.intersectBox(e,su)!==null}intersectTriangle(e,i,r,n,s){WI.subVectors(i,e),aE.subVectors(r,e),XI.crossVectors(WI,aE);let a=this.direction.dot(XI),o;if(a>0){if(n)return null;o=1}else if(a<0)o=-1,a=-a;else return null;Hd.subVectors(this.origin,e);const l=o*this.direction.dot(aE.crossVectors(Hd,aE));if(l<0)return null;const c=o*this.direction.dot(WI.cross(Hd));if(c<0||l+c>a)return null;const h=-o*Hd.dot(XI);return h<0?null:this.at(h/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ui{constructor(){ui.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,i,r,n,s,a,o,l,c,h,u,d,f,p,m,g){const v=this.elements;return v[0]=e,v[4]=i,v[8]=r,v[12]=n,v[1]=s,v[5]=a,v[9]=o,v[13]=l,v[2]=c,v[6]=h,v[10]=u,v[14]=d,v[3]=f,v[7]=p,v[11]=m,v[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ui().fromArray(this.elements)}copy(e){const i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(e){const i=this.elements,r=e.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,r){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,i,r){return this.set(e.x,i.x,r.x,0,e.y,i.y,r.y,0,e.z,i.z,r.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,r=e.elements,n=1/P0.setFromMatrixColumn(e,0).length(),s=1/P0.setFromMatrixColumn(e,1).length(),a=1/P0.setFromMatrixColumn(e,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=0,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,r=e.x,n=e.y,s=e.z,a=Math.cos(r),o=Math.sin(r),l=Math.cos(n),c=Math.sin(n),h=Math.cos(s),u=Math.sin(s);if(e.order==="XYZ"){const d=a*h,f=a*u,p=o*h,m=o*u;i[0]=l*h,i[4]=-l*u,i[8]=c,i[1]=f+p*c,i[5]=d-m*c,i[9]=-o*l,i[2]=m-d*c,i[6]=p+f*c,i[10]=a*l}else if(e.order==="YXZ"){const d=l*h,f=l*u,p=c*h,m=c*u;i[0]=d+m*o,i[4]=p*o-f,i[8]=a*c,i[1]=a*u,i[5]=a*h,i[9]=-o,i[2]=f*o-p,i[6]=m+d*o,i[10]=a*l}else if(e.order==="ZXY"){const d=l*h,f=l*u,p=c*h,m=c*u;i[0]=d-m*o,i[4]=-a*u,i[8]=p+f*o,i[1]=f+p*o,i[5]=a*h,i[9]=m-d*o,i[2]=-a*c,i[6]=o,i[10]=a*l}else if(e.order==="ZYX"){const d=a*h,f=a*u,p=o*h,m=o*u;i[0]=l*h,i[4]=p*c-f,i[8]=d*c+m,i[1]=l*u,i[5]=m*c+d,i[9]=f*c-p,i[2]=-c,i[6]=o*l,i[10]=a*l}else if(e.order==="YZX"){const d=a*l,f=a*c,p=o*l,m=o*c;i[0]=l*h,i[4]=m-d*u,i[8]=p*u+f,i[1]=u,i[5]=a*h,i[9]=-o*h,i[2]=-c*h,i[6]=f*u+p,i[10]=d-m*u}else if(e.order==="XZY"){const d=a*l,f=a*c,p=o*l,m=o*c;i[0]=l*h,i[4]=-u,i[8]=c*h,i[1]=d*u+m,i[5]=a*h,i[9]=f*u-p,i[2]=p*u-f,i[6]=o*h,i[10]=m*u+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(R0e,e,I0e)}lookAt(e,i,r){const n=this.elements;return Co.subVectors(e,i),Co.lengthSq()===0&&(Co.z=1),Co.normalize(),jd.crossVectors(r,Co),jd.lengthSq()===0&&(Math.abs(r.z)===1?Co.x+=1e-4:Co.z+=1e-4,Co.normalize(),jd.crossVectors(r,Co)),jd.normalize(),oE.crossVectors(Co,jd),n[0]=jd.x,n[4]=oE.x,n[8]=Co.x,n[1]=jd.y,n[5]=oE.y,n[9]=Co.y,n[2]=jd.z,n[6]=oE.z,n[10]=Co.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const r=e.elements,n=i.elements,s=this.elements,a=r[0],o=r[4],l=r[8],c=r[12],h=r[1],u=r[5],d=r[9],f=r[13],p=r[2],m=r[6],g=r[10],v=r[14],y=r[3],x=r[7],S=r[11],A=r[15],_=n[0],M=n[4],E=n[8],T=n[12],C=n[1],D=n[5],B=n[9],O=n[13],L=n[2],H=n[6],q=n[10],W=n[14],I=n[3],z=n[7],U=n[11],X=n[15];return s[0]=a*_+o*C+l*L+c*I,s[4]=a*M+o*D+l*H+c*z,s[8]=a*E+o*B+l*q+c*U,s[12]=a*T+o*O+l*W+c*X,s[1]=h*_+u*C+d*L+f*I,s[5]=h*M+u*D+d*H+f*z,s[9]=h*E+u*B+d*q+f*U,s[13]=h*T+u*O+d*W+f*X,s[2]=p*_+m*C+g*L+v*I,s[6]=p*M+m*D+g*H+v*z,s[10]=p*E+m*B+g*q+v*U,s[14]=p*T+m*O+g*W+v*X,s[3]=y*_+x*C+S*L+A*I,s[7]=y*M+x*D+S*H+A*z,s[11]=y*E+x*B+S*q+A*U,s[15]=y*T+x*O+S*W+A*X,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],r=e[4],n=e[8],s=e[12],a=e[1],o=e[5],l=e[9],c=e[13],h=e[2],u=e[6],d=e[10],f=e[14],p=e[3],m=e[7],g=e[11],v=e[15];return p*(+s*l*u-n*c*u-s*o*d+r*c*d+n*o*f-r*l*f)+m*(+i*l*f-i*c*d+s*a*d-n*a*f+n*c*h-s*l*h)+g*(+i*c*u-i*o*f-s*a*u+r*a*f+s*o*h-r*c*h)+v*(-n*o*h-i*l*u+i*o*d+n*a*u-r*a*d+r*l*h)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,r){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=i,n[14]=r),this}invert(){const e=this.elements,i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8],u=e[9],d=e[10],f=e[11],p=e[12],m=e[13],g=e[14],v=e[15],y=u*g*c-m*d*c+m*l*f-o*g*f-u*l*v+o*d*v,x=p*d*c-h*g*c-p*l*f+a*g*f+h*l*v-a*d*v,S=h*m*c-p*u*c+p*o*f-a*m*f-h*o*v+a*u*v,A=p*u*l-h*m*l-p*o*d+a*m*d+h*o*g-a*u*g,_=i*y+r*x+n*S+s*A;if(_===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/_;return e[0]=y*M,e[1]=(m*d*s-u*g*s-m*n*f+r*g*f+u*n*v-r*d*v)*M,e[2]=(o*g*s-m*l*s+m*n*c-r*g*c-o*n*v+r*l*v)*M,e[3]=(u*l*s-o*d*s-u*n*c+r*d*c+o*n*f-r*l*f)*M,e[4]=x*M,e[5]=(h*g*s-p*d*s+p*n*f-i*g*f-h*n*v+i*d*v)*M,e[6]=(p*l*s-a*g*s-p*n*c+i*g*c+a*n*v-i*l*v)*M,e[7]=(a*d*s-h*l*s+h*n*c-i*d*c-a*n*f+i*l*f)*M,e[8]=S*M,e[9]=(p*u*s-h*m*s-p*r*f+i*m*f+h*r*v-i*u*v)*M,e[10]=(a*m*s-p*o*s+p*r*c-i*m*c-a*r*v+i*o*v)*M,e[11]=(h*o*s-a*u*s-h*r*c+i*u*c+a*r*f-i*o*f)*M,e[12]=A*M,e[13]=(h*m*n-p*u*n+p*r*d-i*m*d-h*r*g+i*u*g)*M,e[14]=(p*o*n-a*m*n-p*r*l+i*m*l+a*r*g-i*o*g)*M,e[15]=(a*u*n-h*o*n+h*r*l-i*u*l-a*r*d+i*o*d)*M,this}scale(e){const i=this.elements,r=e.x,n=e.y,s=e.z;return i[0]*=r,i[4]*=n,i[8]*=s,i[1]*=r,i[5]*=n,i[9]*=s,i[2]*=r,i[6]*=n,i[10]*=s,i[3]*=r,i[7]*=n,i[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,r,n))}makeTranslation(e,i,r){return this.set(1,0,0,e,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const r=Math.cos(i),n=Math.sin(i),s=1-r,a=e.x,o=e.y,l=e.z,c=s*a,h=s*o;return this.set(c*a+r,c*o-n*l,c*l+n*o,0,c*o+n*l,h*o+r,h*l-n*a,0,c*l-n*o,h*l+n*a,s*l*l+r,0,0,0,0,1),this}makeScale(e,i,r){return this.set(e,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,i,r,n,s,a){return this.set(1,r,s,0,e,1,a,0,i,n,1,0,0,0,0,1),this}compose(e,i,r){const n=this.elements,s=i._x,a=i._y,o=i._z,l=i._w,c=s+s,h=a+a,u=o+o,d=s*c,f=s*h,p=s*u,m=a*h,g=a*u,v=o*u,y=l*c,x=l*h,S=l*u,A=r.x,_=r.y,M=r.z;return n[0]=(1-(m+v))*A,n[1]=(f+S)*A,n[2]=(p-x)*A,n[3]=0,n[4]=(f-S)*_,n[5]=(1-(d+v))*_,n[6]=(g+y)*_,n[7]=0,n[8]=(p+x)*M,n[9]=(g-y)*M,n[10]=(1-(d+m))*M,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,i,r){const n=this.elements;let s=P0.set(n[0],n[1],n[2]).length();const a=P0.set(n[4],n[5],n[6]).length(),o=P0.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),e.x=n[12],e.y=n[13],e.z=n[14],ic.copy(this);const c=1/s,h=1/a,u=1/o;return ic.elements[0]*=c,ic.elements[1]*=c,ic.elements[2]*=c,ic.elements[4]*=h,ic.elements[5]*=h,ic.elements[6]*=h,ic.elements[8]*=u,ic.elements[9]*=u,ic.elements[10]*=u,i.setFromRotationMatrix(ic),r.x=s,r.y=a,r.z=o,this}makePerspective(e,i,r,n,s,a){const o=this.elements,l=2*s/(i-e),c=2*s/(r-n),h=(i+e)/(i-e),u=(r+n)/(r-n),d=-(a+s)/(a-s),f=-2*a*s/(a-s);return o[0]=l,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=c,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,i,r,n,s,a){const o=this.elements,l=1/(i-e),c=1/(r-n),h=1/(a-s),u=(i+e)*l,d=(r+n)*c,f=(a+s)*h;return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=-2*h,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const i=this.elements,r=e.elements;for(let n=0;n<16;n++)if(i[n]!==r[n])return!1;return!0}fromArray(e,i=0){for(let r=0;r<16;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){const r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e[i+9]=r[9],e[i+10]=r[10],e[i+11]=r[11],e[i+12]=r[12],e[i+13]=r[13],e[i+14]=r[14],e[i+15]=r[15],e}}const P0=new le,ic=new ui,R0e=new le(0,0,0),I0e=new le(1,1,1),jd=new le,oE=new le,Co=new le,$H=new ui,JH=new Ds;class Cl{constructor(e=0,i=0,r=0,n=Cl.DefaultOrder){this.isEuler=!0,this._x=e,this._y=i,this._z=r,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,r,n=this._order){return this._x=e,this._y=i,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,r=!0){const n=e.elements,s=n[0],a=n[4],o=n[8],l=n[1],c=n[5],h=n[9],u=n[2],d=n[6],f=n[10];switch(i){case"XYZ":this._y=Math.asin(bn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-bn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,s),this._z=0);break;case"ZXY":this._x=Math.asin(bn(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,f),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-bn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(bn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,s)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-bn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-h,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,r){return $H.makeRotationFromQuaternion(e),this.setFromRotationMatrix($H,i,r)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return JH.setFromEuler(this),this.setFromQuaternion(JH,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Cl.DefaultOrder="XYZ";Cl.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class ug{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let L0e=0;const ZH=new le,D0=new Ds,au=new ui,lE=new le,kx=new le,O0e=new le,B0e=new Ds,ej=new le(1,0,0),tj=new le(0,1,0),ij=new le(0,0,1),F0e={type:"added"},rj={type:"removed"};class zi extends Yh{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:L0e++}),this.uuid=Vo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=zi.DefaultUp.clone();const e=new le,i=new Cl,r=new Ds,n=new le(1,1,1);function s(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ui},normalMatrix:{value:new co}}),this.matrix=new ui,this.matrixWorld=new ui,this.matrixAutoUpdate=zi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=zi.DefaultMatrixWorldAutoUpdate,this.layers=new ug,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return D0.setFromAxisAngle(e,i),this.quaternion.multiply(D0),this}rotateOnWorldAxis(e,i){return D0.setFromAxisAngle(e,i),this.quaternion.premultiply(D0),this}rotateX(e){return this.rotateOnAxis(ej,e)}rotateY(e){return this.rotateOnAxis(tj,e)}rotateZ(e){return this.rotateOnAxis(ij,e)}translateOnAxis(e,i){return ZH.copy(e).applyQuaternion(this.quaternion),this.position.add(ZH.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(ej,e)}translateY(e){return this.translateOnAxis(tj,e)}translateZ(e){return this.translateOnAxis(ij,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(au.copy(this.matrixWorld).invert())}lookAt(e,i,r){e.isVector3?lE.copy(e):lE.set(e,i,r);const n=this.parent;this.updateWorldMatrix(!0,!1),kx.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?au.lookAt(kx,lE,this.up):au.lookAt(lE,kx,this.up),this.quaternion.setFromRotationMatrix(au),n&&(au.extractRotation(n.matrixWorld),D0.setFromRotationMatrix(au),this.quaternion.premultiply(D0.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(F0e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(rj)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const i=this.children[e];i.parent=null,i.dispatchEvent(rj)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),au.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),au.multiply(e.parent.matrixWorld)),e.applyMatrix4(au),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let r=0,n=this.children.length;r<n;r++){const a=this.children[r].getObjectByProperty(e,i);if(a!==void 0)return a}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(kx,e,O0e),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(kx,B0e,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let r=0,n=i.length;r<n;r++){const s=i[r];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,i){const r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const n=this.children;for(let s=0,a=n.length;s<a;s++){const o=n[s];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(e){const i=e===void 0||typeof e=="string",r={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON()));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const u=l[c];s(e.shapes,u)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(s(e.materials,this.material[l]));n.material=o}else n.material=s(e.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];n.animations.push(s(e.animations,l))}}if(i){const o=a(e.geometries),l=a(e.materials),c=a(e.textures),h=a(e.images),u=a(e.shapes),d=a(e.skeletons),f=a(e.animations),p=a(e.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),h.length>0&&(r.images=h),u.length>0&&(r.shapes=u),d.length>0&&(r.skeletons=d),f.length>0&&(r.animations=f),p.length>0&&(r.nodes=p)}return r.object=n,r;function a(o){const l=[];for(const c in o){const h=o[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let r=0;r<e.children.length;r++){const n=e.children[r];this.add(n.clone())}return this}}zi.DefaultUp=new le(0,1,0);zi.DefaultMatrixAutoUpdate=!0;zi.DefaultMatrixWorldAutoUpdate=!0;const rc=new le,ou=new le,YI=new le,lu=new le,R0=new le,I0=new le,nj=new le,qI=new le,KI=new le,QI=new le;class Il{constructor(e=new le,i=new le,r=new le){this.a=e,this.b=i,this.c=r}static getNormal(e,i,r,n){n.subVectors(r,i),rc.subVectors(e,i),n.cross(rc);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(e,i,r,n,s){rc.subVectors(n,i),ou.subVectors(r,i),YI.subVectors(e,i);const a=rc.dot(rc),o=rc.dot(ou),l=rc.dot(YI),c=ou.dot(ou),h=ou.dot(YI),u=a*c-o*o;if(u===0)return s.set(-2,-1,-1);const d=1/u,f=(c*l-o*h)*d,p=(a*h-o*l)*d;return s.set(1-f-p,p,f)}static containsPoint(e,i,r,n){return this.getBarycoord(e,i,r,n,lu),lu.x>=0&&lu.y>=0&&lu.x+lu.y<=1}static getUV(e,i,r,n,s,a,o,l){return this.getBarycoord(e,i,r,n,lu),l.set(0,0),l.addScaledVector(s,lu.x),l.addScaledVector(a,lu.y),l.addScaledVector(o,lu.z),l}static isFrontFacing(e,i,r,n){return rc.subVectors(r,i),ou.subVectors(e,i),rc.cross(ou).dot(n)<0}set(e,i,r){return this.a.copy(e),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(e,i,r,n){return this.a.copy(e[i]),this.b.copy(e[r]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,i,r,n){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return rc.subVectors(this.c,this.b),ou.subVectors(this.a,this.b),rc.cross(ou).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Il.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return Il.getBarycoord(e,this.a,this.b,this.c,i)}getUV(e,i,r,n,s){return Il.getUV(e,this.a,this.b,this.c,i,r,n,s)}containsPoint(e){return Il.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Il.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const r=this.a,n=this.b,s=this.c;let a,o;R0.subVectors(n,r),I0.subVectors(s,r),qI.subVectors(e,r);const l=R0.dot(qI),c=I0.dot(qI);if(l<=0&&c<=0)return i.copy(r);KI.subVectors(e,n);const h=R0.dot(KI),u=I0.dot(KI);if(h>=0&&u<=h)return i.copy(n);const d=l*u-h*c;if(d<=0&&l>=0&&h<=0)return a=l/(l-h),i.copy(r).addScaledVector(R0,a);QI.subVectors(e,s);const f=R0.dot(QI),p=I0.dot(QI);if(p>=0&&f<=p)return i.copy(s);const m=f*c-l*p;if(m<=0&&c>=0&&p<=0)return o=c/(c-p),i.copy(r).addScaledVector(I0,o);const g=h*p-f*u;if(g<=0&&u-h>=0&&f-p>=0)return nj.subVectors(s,n),o=(u-h)/(u-h+(f-p)),i.copy(n).addScaledVector(nj,o);const v=1/(g+m+d);return a=m*v,o=d*v,i.copy(r).addScaledVector(R0,a).addScaledVector(I0,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let k0e=0;class kn extends Yh{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:k0e++}),this.uuid=Vo(),this.name="",this.type="Material",this.blending=og,this.side=cp,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=d4,this.blendDst=f4,this.blendEquation=Pm,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=i2,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=uie,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=QT,this.stencilZFail=QT,this.stencilZPass=QT,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const i in e){const r=e[i];if(r===void 0){console.warn("THREE.Material: '"+i+"' parameter is undefined.");continue}const n=this[i];if(n===void 0){console.warn("THREE."+this.type+": '"+i+"' is not a property of this material.");continue}n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[i]=r}}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});const r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==og&&(r.blending=this.blending),this.side!==cp&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(r.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=this.flatShading),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData);function n(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(i){const s=n(e.textures),a=n(e.images);s.length>0&&(r.textures=s),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const i=e.clippingPlanes;let r=null;if(i!==null){const n=i.length;r=new Array(n);for(let s=0;s!==n;++s)r[s]=i[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class ko extends kn{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ct(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=e_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Cn=new le,cE=new tt;class Xi{constructor(e,i,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=r===!0,this.usage=eS,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,i,r){e*=this.itemSize,r*=i.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[e+n]=i.array[r+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)cE.fromBufferAttribute(this,i),cE.applyMatrix3(e),this.setXY(i,cE.x,cE.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)Cn.fromBufferAttribute(this,i),Cn.applyMatrix3(e),this.setXYZ(i,Cn.x,Cn.y,Cn.z);return this}applyMatrix4(e){for(let i=0,r=this.count;i<r;i++)Cn.fromBufferAttribute(this,i),Cn.applyMatrix4(e),this.setXYZ(i,Cn.x,Cn.y,Cn.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)Cn.fromBufferAttribute(this,i),Cn.applyNormalMatrix(e),this.setXYZ(i,Cn.x,Cn.y,Cn.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)Cn.fromBufferAttribute(this,i),Cn.transformDirection(e),this.setXYZ(i,Cn.x,Cn.y,Cn.z);return this}set(e,i=0){return this.array.set(e,i),this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=Xu(i,this.array)),i}setX(e,i){return this.normalized&&(i=pr(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=Xu(i,this.array)),i}setY(e,i){return this.normalized&&(i=pr(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=Xu(i,this.array)),i}setZ(e,i){return this.normalized&&(i=pr(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=Xu(i,this.array)),i}setW(e,i){return this.normalized&&(i=pr(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,r){return e*=this.itemSize,this.normalized&&(i=pr(i,this.array),r=pr(r,this.array)),this.array[e+0]=i,this.array[e+1]=r,this}setXYZ(e,i,r,n){return e*=this.itemSize,this.normalized&&(i=pr(i,this.array),r=pr(r,this.array),n=pr(n,this.array)),this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=n,this}setXYZW(e,i,r,n,s){return e*=this.itemSize,this.normalized&&(i=pr(i,this.array),r=pr(r,this.array),n=pr(n,this.array),s=pr(s,this.array)),this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==eS&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class N0e extends Xi{constructor(e,i,r){super(new Int8Array(e),i,r)}}class U0e extends Xi{constructor(e,i,r){super(new Uint8Array(e),i,r)}}class z0e extends Xi{constructor(e,i,r){super(new Uint8ClampedArray(e),i,r)}}class G0e extends Xi{constructor(e,i,r){super(new Int16Array(e),i,r)}}class w4 extends Xi{constructor(e,i,r){super(new Uint16Array(e),i,r)}}class V0e extends Xi{constructor(e,i,r){super(new Int32Array(e),i,r)}}class S4 extends Xi{constructor(e,i,r){super(new Uint32Array(e),i,r)}}class H0e extends Xi{constructor(e,i,r){super(new Uint16Array(e),i,r),this.isFloat16BufferAttribute=!0}}class zt extends Xi{constructor(e,i,r){super(new Float32Array(e),i,r)}}class j0e extends Xi{constructor(e,i,r){super(new Float64Array(e),i,r)}}let W0e=0;const al=new ui,$I=new zi,L0=new le,Po=new Ad,Nx=new Ad,fs=new le;class xi extends Yh{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:W0e++}),this.uuid=Vo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(fie(e)?S4:w4)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,r=0){this.groups.push({start:e,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new co().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return al.makeRotationFromQuaternion(e),this.applyMatrix4(al),this}rotateX(e){return al.makeRotationX(e),this.applyMatrix4(al),this}rotateY(e){return al.makeRotationY(e),this.applyMatrix4(al),this}rotateZ(e){return al.makeRotationZ(e),this.applyMatrix4(al),this}translate(e,i,r){return al.makeTranslation(e,i,r),this.applyMatrix4(al),this}scale(e,i,r){return al.makeScale(e,i,r),this.applyMatrix4(al),this}lookAt(e){return $I.lookAt(e),$I.updateMatrix(),this.applyMatrix4($I.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(L0).negate(),this.translate(L0.x,L0.y,L0.z),this}setFromPoints(e){const i=[];for(let r=0,n=e.length;r<n;r++){const s=e[r];i.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new zt(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ad);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new le(-1/0,-1/0,-1/0),new le(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let r=0,n=i.length;r<n;r++){const s=i[r];Po.setFromBufferAttribute(s),this.morphTargetsRelative?(fs.addVectors(this.boundingBox.min,Po.min),this.boundingBox.expandByPoint(fs),fs.addVectors(this.boundingBox.max,Po.max),this.boundingBox.expandByPoint(fs)):(this.boundingBox.expandByPoint(Po.min),this.boundingBox.expandByPoint(Po.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ed);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new le,1/0);return}if(e){const r=this.boundingSphere.center;if(Po.setFromBufferAttribute(e),i)for(let s=0,a=i.length;s<a;s++){const o=i[s];Nx.setFromBufferAttribute(o),this.morphTargetsRelative?(fs.addVectors(Po.min,Nx.min),Po.expandByPoint(fs),fs.addVectors(Po.max,Nx.max),Po.expandByPoint(fs)):(Po.expandByPoint(Nx.min),Po.expandByPoint(Nx.max))}Po.getCenter(r);let n=0;for(let s=0,a=e.count;s<a;s++)fs.fromBufferAttribute(e,s),n=Math.max(n,r.distanceToSquared(fs));if(i)for(let s=0,a=i.length;s<a;s++){const o=i[s],l=this.morphTargetsRelative;for(let c=0,h=o.count;c<h;c++)fs.fromBufferAttribute(o,c),l&&(L0.fromBufferAttribute(e,c),fs.add(L0)),n=Math.max(n,r.distanceToSquared(fs))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=e.array,n=i.position.array,s=i.normal.array,a=i.uv.array,o=n.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Xi(new Float32Array(4*o),4));const l=this.getAttribute("tangent").array,c=[],h=[];for(let C=0;C<o;C++)c[C]=new le,h[C]=new le;const u=new le,d=new le,f=new le,p=new tt,m=new tt,g=new tt,v=new le,y=new le;function x(C,D,B){u.fromArray(n,C*3),d.fromArray(n,D*3),f.fromArray(n,B*3),p.fromArray(a,C*2),m.fromArray(a,D*2),g.fromArray(a,B*2),d.sub(u),f.sub(u),m.sub(p),g.sub(p);const O=1/(m.x*g.y-g.x*m.y);isFinite(O)&&(v.copy(d).multiplyScalar(g.y).addScaledVector(f,-m.y).multiplyScalar(O),y.copy(f).multiplyScalar(m.x).addScaledVector(d,-g.x).multiplyScalar(O),c[C].add(v),c[D].add(v),c[B].add(v),h[C].add(y),h[D].add(y),h[B].add(y))}let S=this.groups;S.length===0&&(S=[{start:0,count:r.length}]);for(let C=0,D=S.length;C<D;++C){const B=S[C],O=B.start,L=B.count;for(let H=O,q=O+L;H<q;H+=3)x(r[H+0],r[H+1],r[H+2])}const A=new le,_=new le,M=new le,E=new le;function T(C){M.fromArray(s,C*3),E.copy(M);const D=c[C];A.copy(D),A.sub(M.multiplyScalar(M.dot(D))).normalize(),_.crossVectors(E,D);const O=_.dot(h[C])<0?-1:1;l[C*4]=A.x,l[C*4+1]=A.y,l[C*4+2]=A.z,l[C*4+3]=O}for(let C=0,D=S.length;C<D;++C){const B=S[C],O=B.start,L=B.count;for(let H=O,q=O+L;H<q;H+=3)T(r[H+0]),T(r[H+1]),T(r[H+2])}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Xi(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let d=0,f=r.count;d<f;d++)r.setXYZ(d,0,0,0);const n=new le,s=new le,a=new le,o=new le,l=new le,c=new le,h=new le,u=new le;if(e)for(let d=0,f=e.count;d<f;d+=3){const p=e.getX(d+0),m=e.getX(d+1),g=e.getX(d+2);n.fromBufferAttribute(i,p),s.fromBufferAttribute(i,m),a.fromBufferAttribute(i,g),h.subVectors(a,s),u.subVectors(n,s),h.cross(u),o.fromBufferAttribute(r,p),l.fromBufferAttribute(r,m),c.fromBufferAttribute(r,g),o.add(h),l.add(h),c.add(h),r.setXYZ(p,o.x,o.y,o.z),r.setXYZ(m,l.x,l.y,l.z),r.setXYZ(g,c.x,c.y,c.z)}else for(let d=0,f=i.count;d<f;d+=3)n.fromBufferAttribute(i,d+0),s.fromBufferAttribute(i,d+1),a.fromBufferAttribute(i,d+2),h.subVectors(a,s),u.subVectors(n,s),h.cross(u),r.setXYZ(d+0,h.x,h.y,h.z),r.setXYZ(d+1,h.x,h.y,h.z),r.setXYZ(d+2,h.x,h.y,h.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let i=0,r=e.count;i<r;i++)fs.fromBufferAttribute(e,i),fs.normalize(),e.setXYZ(i,fs.x,fs.y,fs.z)}toNonIndexed(){function e(o,l){const c=o.array,h=o.itemSize,u=o.normalized,d=new c.constructor(l.length*h);let f=0,p=0;for(let m=0,g=l.length;m<g;m++){o.isInterleavedBufferAttribute?f=l[m]*o.data.stride+o.offset:f=l[m]*h;for(let v=0;v<h;v++)d[p++]=c[f++]}return new Xi(d,h,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new xi,r=this.index.array,n=this.attributes;for(const o in n){const l=n[o],c=e(l,r);i.setAttribute(o,c)}const s=this.morphAttributes;for(const o in s){const l=[],c=s[o];for(let h=0,u=c.length;h<u;h++){const d=c[h],f=e(d,r);l.push(f)}i.morphAttributes[o]=l}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];i.addGroup(c.start,c.count,c.materialIndex)}return i}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const r=this.attributes;for(const l in r){const c=r[l];e.data.attributes[l]=c.toJSON(e.data)}const n={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let u=0,d=c.length;u<d;u++){const f=c[u];h.push(f.toJSON(e.data))}h.length>0&&(n[l]=h,s=!0)}s&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(i));const n=e.attributes;for(const c in n){const h=n[c];this.setAttribute(c,h.clone(i))}const s=e.morphAttributes;for(const c in s){const h=[],u=s[c];for(let d=0,f=u.length;d<f;d++)h.push(u[d].clone(i));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let c=0,h=a.length;c<h;c++){const u=a[c];this.addGroup(u.start,u.count,u.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const sj=new ui,O0=new L1,JI=new Ed,Wd=new le,Xd=new le,Yd=new le,ZI=new le,eL=new le,tL=new le,hE=new le,uE=new le,dE=new le,fE=new tt,pE=new tt,mE=new tt,iL=new le,gE=new le;class Ms extends zi{constructor(e=new xi,i=new ko){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}raycast(e,i){const r=this.geometry,n=this.material,s=this.matrixWorld;if(n===void 0||(r.boundingSphere===null&&r.computeBoundingSphere(),JI.copy(r.boundingSphere),JI.applyMatrix4(s),e.ray.intersectsSphere(JI)===!1)||(sj.copy(s).invert(),O0.copy(e.ray).applyMatrix4(sj),r.boundingBox!==null&&O0.intersectsBox(r.boundingBox)===!1))return;let a;const o=r.index,l=r.attributes.position,c=r.morphAttributes.position,h=r.morphTargetsRelative,u=r.attributes.uv,d=r.attributes.uv2,f=r.groups,p=r.drawRange;if(o!==null)if(Array.isArray(n))for(let m=0,g=f.length;m<g;m++){const v=f[m],y=n[v.materialIndex],x=Math.max(v.start,p.start),S=Math.min(o.count,Math.min(v.start+v.count,p.start+p.count));for(let A=x,_=S;A<_;A+=3){const M=o.getX(A),E=o.getX(A+1),T=o.getX(A+2);a=vE(this,y,e,O0,l,c,h,u,d,M,E,T),a&&(a.faceIndex=Math.floor(A/3),a.face.materialIndex=v.materialIndex,i.push(a))}}else{const m=Math.max(0,p.start),g=Math.min(o.count,p.start+p.count);for(let v=m,y=g;v<y;v+=3){const x=o.getX(v),S=o.getX(v+1),A=o.getX(v+2);a=vE(this,n,e,O0,l,c,h,u,d,x,S,A),a&&(a.faceIndex=Math.floor(v/3),i.push(a))}}else if(l!==void 0)if(Array.isArray(n))for(let m=0,g=f.length;m<g;m++){const v=f[m],y=n[v.materialIndex],x=Math.max(v.start,p.start),S=Math.min(l.count,Math.min(v.start+v.count,p.start+p.count));for(let A=x,_=S;A<_;A+=3){const M=A,E=A+1,T=A+2;a=vE(this,y,e,O0,l,c,h,u,d,M,E,T),a&&(a.faceIndex=Math.floor(A/3),a.face.materialIndex=v.materialIndex,i.push(a))}}else{const m=Math.max(0,p.start),g=Math.min(l.count,p.start+p.count);for(let v=m,y=g;v<y;v+=3){const x=v,S=v+1,A=v+2;a=vE(this,n,e,O0,l,c,h,u,d,x,S,A),a&&(a.faceIndex=Math.floor(v/3),i.push(a))}}}}function X0e(t,e,i,r,n,s,a,o){let l;if(e.side===Go?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,e.side!==_c,o),l===null)return null;gE.copy(o),gE.applyMatrix4(t.matrixWorld);const c=i.ray.origin.distanceTo(gE);return c<i.near||c>i.far?null:{distance:c,point:gE.clone(),object:t}}function vE(t,e,i,r,n,s,a,o,l,c,h,u){Wd.fromBufferAttribute(n,c),Xd.fromBufferAttribute(n,h),Yd.fromBufferAttribute(n,u);const d=t.morphTargetInfluences;if(s&&d){hE.set(0,0,0),uE.set(0,0,0),dE.set(0,0,0);for(let p=0,m=s.length;p<m;p++){const g=d[p],v=s[p];g!==0&&(ZI.fromBufferAttribute(v,c),eL.fromBufferAttribute(v,h),tL.fromBufferAttribute(v,u),a?(hE.addScaledVector(ZI,g),uE.addScaledVector(eL,g),dE.addScaledVector(tL,g)):(hE.addScaledVector(ZI.sub(Wd),g),uE.addScaledVector(eL.sub(Xd),g),dE.addScaledVector(tL.sub(Yd),g)))}Wd.add(hE),Xd.add(uE),Yd.add(dE)}t.isSkinnedMesh&&(t.boneTransform(c,Wd),t.boneTransform(h,Xd),t.boneTransform(u,Yd));const f=X0e(t,e,i,r,Wd,Xd,Yd,iL);if(f){o&&(fE.fromBufferAttribute(o,c),pE.fromBufferAttribute(o,h),mE.fromBufferAttribute(o,u),f.uv=Il.getUV(iL,Wd,Xd,Yd,fE,pE,mE,new tt)),l&&(fE.fromBufferAttribute(l,c),pE.fromBufferAttribute(l,h),mE.fromBufferAttribute(l,u),f.uv2=Il.getUV(iL,Wd,Xd,Yd,fE,pE,mE,new tt));const p={a:c,b:h,c:u,normal:new le,materialIndex:0};Il.getNormal(Wd,Xd,Yd,p.normal),f.face=p}return f}class Pp extends xi{constructor(e=1,i=1,r=1,n=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a};const o=this;n=Math.floor(n),s=Math.floor(s),a=Math.floor(a);const l=[],c=[],h=[],u=[];let d=0,f=0;p("z","y","x",-1,-1,r,i,e,a,s,0),p("z","y","x",1,-1,r,i,-e,a,s,1),p("x","z","y",1,1,e,r,i,n,a,2),p("x","z","y",1,-1,e,r,-i,n,a,3),p("x","y","z",1,-1,e,i,r,n,s,4),p("x","y","z",-1,-1,e,i,-r,n,s,5),this.setIndex(l),this.setAttribute("position",new zt(c,3)),this.setAttribute("normal",new zt(h,3)),this.setAttribute("uv",new zt(u,2));function p(m,g,v,y,x,S,A,_,M,E,T){const C=S/M,D=A/E,B=S/2,O=A/2,L=_/2,H=M+1,q=E+1;let W=0,I=0;const z=new le;for(let U=0;U<q;U++){const X=U*D-O;for(let Q=0;Q<H;Q++){const re=Q*C-B;z[m]=re*y,z[g]=X*x,z[v]=L,c.push(z.x,z.y,z.z),z[m]=0,z[g]=0,z[v]=_>0?1:-1,h.push(z.x,z.y,z.z),u.push(Q/M),u.push(1-U/E),W+=1}}for(let U=0;U<E;U++)for(let X=0;X<M;X++){const Q=d+X+H*U,re=d+X+H*(U+1),ie=d+(X+1)+H*(U+1),ce=d+(X+1)+H*U;l.push(Q,re,ce),l.push(re,ie,ce),I+=6}o.addGroup(f,I,T),f+=I,d+=W}}static fromJSON(e){return new Pp(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Jy(t){const e={};for(const i in t){e[i]={};for(const r in t[i]){const n=t[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?e[i][r]=n.clone():Array.isArray(n)?e[i][r]=n.slice():e[i][r]=n}}return e}function Da(t){const e={};for(let i=0;i<t.length;i++){const r=Jy(t[i]);for(const n in r)e[n]=r[n]}return e}function Y0e(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}const mie={clone:Jy,merge:Da};var q0e=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,K0e=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class zh extends kn{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=q0e,this.fragmentShader=K0e,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Jy(e.uniforms),this.uniformsGroups=Y0e(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(const n in this.uniforms){const a=this.uniforms[n].value;a&&a.isTexture?i.uniforms[n]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?i.uniforms[n]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[n]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[n]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[n]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[n]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[n]={type:"m4",value:a.toArray()}:i.uniforms[n]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader;const r={};for(const n in this.extensions)this.extensions[n]===!0&&(r[n]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}}class i_ extends zi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ui,this.projectionMatrix=new ui,this.projectionMatrixInverse=new ui}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(-i[8],-i[9],-i[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Or extends i_{constructor(e=50,i=1,r=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const i=.5*this.getFilmHeight()/e;this.fov=tS*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(cg*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return tS*2*Math.atan(Math.tan(cg*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,i,r,n,s,a){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let i=e*Math.tan(cg*.5*this.fov)/this.zoom,r=2*i,n=this.aspect*r,s=-.5*n;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;s+=a.offsetX*n/l,i-=a.offsetY*r/c,n*=a.width/l,r*=a.height/c}const o=this.filmOffset;o!==0&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,i,i-r,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const B0=90,F0=1;class _4 extends zi{constructor(e,i,r){super(),this.type="CubeCamera",this.renderTarget=r;const n=new Or(B0,F0,e,i);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new le(1,0,0)),this.add(n);const s=new Or(B0,F0,e,i);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new le(-1,0,0)),this.add(s);const a=new Or(B0,F0,e,i);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new le(0,1,0)),this.add(a);const o=new Or(B0,F0,e,i);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new le(0,-1,0)),this.add(o);const l=new Or(B0,F0,e,i);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new le(0,0,1)),this.add(l);const c=new Or(B0,F0,e,i);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new le(0,0,-1)),this.add(c)}update(e,i){this.parent===null&&this.updateMatrixWorld();const r=this.renderTarget,[n,s,a,o,l,c]=this.children,h=e.getRenderTarget(),u=e.toneMapping,d=e.xr.enabled;e.toneMapping=Pc,e.xr.enabled=!1;const f=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(i,n),e.setRenderTarget(r,1),e.render(i,s),e.setRenderTarget(r,2),e.render(i,a),e.setRenderTarget(r,3),e.render(i,o),e.setRenderTarget(r,4),e.render(i,l),r.texture.generateMipmaps=f,e.setRenderTarget(r,5),e.render(i,c),e.setRenderTarget(h),e.toneMapping=u,e.xr.enabled=d,r.texture.needsPMREMUpdate=!0}}class r_ extends kr{constructor(e,i,r,n,s,a,o,l,c,h){e=e!==void 0?e:[],i=i!==void 0?i:hp,super(e,i,r,n,s,a,o,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class A4 extends Hl{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},n=[r,r,r,r,r,r];this.texture=new r_(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Hr}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.encoding=i.encoding,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new Pp(5,5,5),s=new zh({name:"CubemapFromEquirect",uniforms:Jy(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Go,blending:td});s.uniforms.tEquirect.value=i;const a=new Ms(n,s),o=i.minFilter;return i.minFilter===_d&&(i.minFilter=Hr),new _4(1,10,this).update(e,a),i.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,i,r,n){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(i,r,n);e.setRenderTarget(s)}}const rL=new le,Q0e=new le,$0e=new co;class Ou{constructor(e=new le(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,r,n){return this.normal.set(e,i,r),this.constant=n,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,r){const n=rL.subVectors(r,i).cross(Q0e.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,i){const r=e.delta(rL),n=this.normal.dot(r);if(n===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:i.copy(r).multiplyScalar(s).add(e.start)}intersectsLine(e){const i=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return i<0&&r>0||r<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){const r=i||$0e.getNormalMatrix(e),n=this.coplanarPoint(rL).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const k0=new Ed,yE=new le;class sD{constructor(e=new Ou,i=new Ou,r=new Ou,n=new Ou,s=new Ou,a=new Ou){this.planes=[e,i,r,n,s,a]}set(e,i,r,n,s,a){const o=this.planes;return o[0].copy(e),o[1].copy(i),o[2].copy(r),o[3].copy(n),o[4].copy(s),o[5].copy(a),this}copy(e){const i=this.planes;for(let r=0;r<6;r++)i[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e){const i=this.planes,r=e.elements,n=r[0],s=r[1],a=r[2],o=r[3],l=r[4],c=r[5],h=r[6],u=r[7],d=r[8],f=r[9],p=r[10],m=r[11],g=r[12],v=r[13],y=r[14],x=r[15];return i[0].setComponents(o-n,u-l,m-d,x-g).normalize(),i[1].setComponents(o+n,u+l,m+d,x+g).normalize(),i[2].setComponents(o+s,u+c,m+f,x+v).normalize(),i[3].setComponents(o-s,u-c,m-f,x-v).normalize(),i[4].setComponents(o-a,u-h,m-p,x-y).normalize(),i[5].setComponents(o+a,u+h,m+p,x+y).normalize(),this}intersectsObject(e){const i=e.geometry;return i.boundingSphere===null&&i.computeBoundingSphere(),k0.copy(i.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(k0)}intersectsSprite(e){return k0.center.set(0,0,0),k0.radius=.7071067811865476,k0.applyMatrix4(e.matrixWorld),this.intersectsSphere(k0)}intersectsSphere(e){const i=this.planes,r=e.center,n=-e.radius;for(let s=0;s<6;s++)if(i[s].distanceToPoint(r)<n)return!1;return!0}intersectsBox(e){const i=this.planes;for(let r=0;r<6;r++){const n=i[r];if(yE.x=n.normal.x>0?e.max.x:e.min.x,yE.y=n.normal.y>0?e.max.y:e.min.y,yE.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(yE)<0)return!1}return!0}containsPoint(e){const i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function gie(){let t=null,e=!1,i=null,r=null;function n(s,a){i(s,a),r=t.requestAnimationFrame(n)}return{start:function(){e!==!0&&i!==null&&(r=t.requestAnimationFrame(n),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){i=s},setContext:function(s){t=s}}}function J0e(t,e){const i=e.isWebGL2,r=new WeakMap;function n(c,h){const u=c.array,d=c.usage,f=t.createBuffer();t.bindBuffer(h,f),t.bufferData(h,u,d),c.onUploadCallback();let p;if(u instanceof Float32Array)p=5126;else if(u instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(i)p=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else p=5123;else if(u instanceof Int16Array)p=5122;else if(u instanceof Uint32Array)p=5125;else if(u instanceof Int32Array)p=5124;else if(u instanceof Int8Array)p=5120;else if(u instanceof Uint8Array)p=5121;else if(u instanceof Uint8ClampedArray)p=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:f,type:p,bytesPerElement:u.BYTES_PER_ELEMENT,version:c.version}}function s(c,h,u){const d=h.array,f=h.updateRange;t.bindBuffer(u,c),f.count===-1?t.bufferSubData(u,0,d):(i?t.bufferSubData(u,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):t.bufferSubData(u,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1)}function a(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);const h=r.get(c);h&&(t.deleteBuffer(h.buffer),r.delete(c))}function l(c,h){if(c.isGLBufferAttribute){const d=r.get(c);(!d||d.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const u=r.get(c);u===void 0?r.set(c,n(c,h)):u.version<c.version&&(s(u.buffer,c,h),u.version=c.version)}return{get:a,remove:o,update:l}}class O1 extends xi{constructor(e=1,i=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:r,heightSegments:n};const s=e/2,a=i/2,o=Math.floor(r),l=Math.floor(n),c=o+1,h=l+1,u=e/o,d=i/l,f=[],p=[],m=[],g=[];for(let v=0;v<h;v++){const y=v*d-a;for(let x=0;x<c;x++){const S=x*u-s;p.push(S,-y,0),m.push(0,0,1),g.push(x/o),g.push(1-v/l)}}for(let v=0;v<l;v++)for(let y=0;y<o;y++){const x=y+c*v,S=y+c*(v+1),A=y+1+c*(v+1),_=y+1+c*v;f.push(x,S,_),f.push(S,A,_)}this.setIndex(f),this.setAttribute("position",new zt(p,3)),this.setAttribute("normal",new zt(m,3)),this.setAttribute("uv",new zt(g,2))}static fromJSON(e){return new O1(e.width,e.height,e.widthSegments,e.heightSegments)}}var Z0e=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,eve=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,tve=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,ive=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,rve=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,nve=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,sve="vec3 transformed = vec3( position );",ave=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,ove=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,lve=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,cve=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,hve=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,uve=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,dve=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,fve=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,pve=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,mve=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,gve=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,vve=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,yve=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,xve=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,bve=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,wve=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Sve=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,_ve=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Ave=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Eve="gl_FragColor = linearToOutputTexel( gl_FragColor );",Mve=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Tve=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Cve=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Pve=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Dve=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Rve=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Ive=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Lve=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Ove=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Bve=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Fve=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,kve=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Nve=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Uve=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,zve=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,Gve=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Vve=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Hve=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,jve=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,Wve=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Xve=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,Yve=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,qve=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Kve=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Qve=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,$ve=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Jve=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Zve=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,eye=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,tye=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,iye=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,rye=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,nye=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,sye=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,aye=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,oye=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,lye=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,cye=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,hye=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,uye=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,dye=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,fye=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,pye=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,mye=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,gye=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,vye=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,yye=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,xye=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,bye=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,wye=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Sye=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,_ye=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,Aye=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Eye=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Mye=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Tye=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Cye=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Pye=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Dye=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Rye=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Iye=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,Lye=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Oye=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Bye=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Fye=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,kye=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Nye=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Uye=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,zye=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Gye=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Vye=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,Hye=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,jye=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,Wye=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Xye=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,Yye=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,qye=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,Kye=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,Qye=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const $ye=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Jye=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Zye=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,e1e=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,t1e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,i1e=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,r1e=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,n1e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,s1e=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,a1e=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,o1e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,l1e=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,c1e=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,h1e=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,u1e=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,d1e=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,f1e=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,p1e=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,m1e=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,g1e=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,v1e=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,y1e=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,x1e=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,b1e=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,w1e=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,S1e=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_1e=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,A1e=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,E1e=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,M1e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,T1e=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,C1e=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,P1e=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,D1e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Si={alphamap_fragment:Z0e,alphamap_pars_fragment:eve,alphatest_fragment:tve,alphatest_pars_fragment:ive,aomap_fragment:rve,aomap_pars_fragment:nve,begin_vertex:sve,beginnormal_vertex:ave,bsdfs:ove,iridescence_fragment:lve,bumpmap_pars_fragment:cve,clipping_planes_fragment:hve,clipping_planes_pars_fragment:uve,clipping_planes_pars_vertex:dve,clipping_planes_vertex:fve,color_fragment:pve,color_pars_fragment:mve,color_pars_vertex:gve,color_vertex:vve,common:yve,cube_uv_reflection_fragment:xve,defaultnormal_vertex:bve,displacementmap_pars_vertex:wve,displacementmap_vertex:Sve,emissivemap_fragment:_ve,emissivemap_pars_fragment:Ave,encodings_fragment:Eve,encodings_pars_fragment:Mve,envmap_fragment:Tve,envmap_common_pars_fragment:Cve,envmap_pars_fragment:Pve,envmap_pars_vertex:Dve,envmap_physical_pars_fragment:Vve,envmap_vertex:Rve,fog_vertex:Ive,fog_pars_vertex:Lve,fog_fragment:Ove,fog_pars_fragment:Bve,gradientmap_pars_fragment:Fve,lightmap_fragment:kve,lightmap_pars_fragment:Nve,lights_lambert_fragment:Uve,lights_lambert_pars_fragment:zve,lights_pars_begin:Gve,lights_toon_fragment:Hve,lights_toon_pars_fragment:jve,lights_phong_fragment:Wve,lights_phong_pars_fragment:Xve,lights_physical_fragment:Yve,lights_physical_pars_fragment:qve,lights_fragment_begin:Kve,lights_fragment_maps:Qve,lights_fragment_end:$ve,logdepthbuf_fragment:Jve,logdepthbuf_pars_fragment:Zve,logdepthbuf_pars_vertex:eye,logdepthbuf_vertex:tye,map_fragment:iye,map_pars_fragment:rye,map_particle_fragment:nye,map_particle_pars_fragment:sye,metalnessmap_fragment:aye,metalnessmap_pars_fragment:oye,morphcolor_vertex:lye,morphnormal_vertex:cye,morphtarget_pars_vertex:hye,morphtarget_vertex:uye,normal_fragment_begin:dye,normal_fragment_maps:fye,normal_pars_fragment:pye,normal_pars_vertex:mye,normal_vertex:gye,normalmap_pars_fragment:vye,clearcoat_normal_fragment_begin:yye,clearcoat_normal_fragment_maps:xye,clearcoat_pars_fragment:bye,iridescence_pars_fragment:wye,output_fragment:Sye,packing:_ye,premultiplied_alpha_fragment:Aye,project_vertex:Eye,dithering_fragment:Mye,dithering_pars_fragment:Tye,roughnessmap_fragment:Cye,roughnessmap_pars_fragment:Pye,shadowmap_pars_fragment:Dye,shadowmap_pars_vertex:Rye,shadowmap_vertex:Iye,shadowmask_pars_fragment:Lye,skinbase_vertex:Oye,skinning_pars_vertex:Bye,skinning_vertex:Fye,skinnormal_vertex:kye,specularmap_fragment:Nye,specularmap_pars_fragment:Uye,tonemapping_fragment:zye,tonemapping_pars_fragment:Gye,transmission_fragment:Vye,transmission_pars_fragment:Hye,uv_pars_fragment:jye,uv_pars_vertex:Wye,uv_vertex:Xye,uv2_pars_fragment:Yye,uv2_pars_vertex:qye,uv2_vertex:Kye,worldpos_vertex:Qye,background_vert:$ye,background_frag:Jye,backgroundCube_vert:Zye,backgroundCube_frag:e1e,cube_vert:t1e,cube_frag:i1e,depth_vert:r1e,depth_frag:n1e,distanceRGBA_vert:s1e,distanceRGBA_frag:a1e,equirect_vert:o1e,equirect_frag:l1e,linedashed_vert:c1e,linedashed_frag:h1e,meshbasic_vert:u1e,meshbasic_frag:d1e,meshlambert_vert:f1e,meshlambert_frag:p1e,meshmatcap_vert:m1e,meshmatcap_frag:g1e,meshnormal_vert:v1e,meshnormal_frag:y1e,meshphong_vert:x1e,meshphong_frag:b1e,meshphysical_vert:w1e,meshphysical_frag:S1e,meshtoon_vert:_1e,meshtoon_frag:A1e,points_vert:E1e,points_frag:M1e,shadow_vert:T1e,shadow_frag:C1e,sprite_vert:P1e,sprite_frag:D1e},St={common:{diffuse:{value:new Ct(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new co},uv2Transform:{value:new co},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new tt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ct(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ct(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new co}},sprite:{diffuse:{value:new Ct(16777215)},opacity:{value:1},center:{value:new tt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new co}}},bc={basic:{uniforms:Da([St.common,St.specularmap,St.envmap,St.aomap,St.lightmap,St.fog]),vertexShader:Si.meshbasic_vert,fragmentShader:Si.meshbasic_frag},lambert:{uniforms:Da([St.common,St.specularmap,St.envmap,St.aomap,St.lightmap,St.emissivemap,St.bumpmap,St.normalmap,St.displacementmap,St.fog,St.lights,{emissive:{value:new Ct(0)}}]),vertexShader:Si.meshlambert_vert,fragmentShader:Si.meshlambert_frag},phong:{uniforms:Da([St.common,St.specularmap,St.envmap,St.aomap,St.lightmap,St.emissivemap,St.bumpmap,St.normalmap,St.displacementmap,St.fog,St.lights,{emissive:{value:new Ct(0)},specular:{value:new Ct(1118481)},shininess:{value:30}}]),vertexShader:Si.meshphong_vert,fragmentShader:Si.meshphong_frag},standard:{uniforms:Da([St.common,St.envmap,St.aomap,St.lightmap,St.emissivemap,St.bumpmap,St.normalmap,St.displacementmap,St.roughnessmap,St.metalnessmap,St.fog,St.lights,{emissive:{value:new Ct(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Si.meshphysical_vert,fragmentShader:Si.meshphysical_frag},toon:{uniforms:Da([St.common,St.aomap,St.lightmap,St.emissivemap,St.bumpmap,St.normalmap,St.displacementmap,St.gradientmap,St.fog,St.lights,{emissive:{value:new Ct(0)}}]),vertexShader:Si.meshtoon_vert,fragmentShader:Si.meshtoon_frag},matcap:{uniforms:Da([St.common,St.bumpmap,St.normalmap,St.displacementmap,St.fog,{matcap:{value:null}}]),vertexShader:Si.meshmatcap_vert,fragmentShader:Si.meshmatcap_frag},points:{uniforms:Da([St.points,St.fog]),vertexShader:Si.points_vert,fragmentShader:Si.points_frag},dashed:{uniforms:Da([St.common,St.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Si.linedashed_vert,fragmentShader:Si.linedashed_frag},depth:{uniforms:Da([St.common,St.displacementmap]),vertexShader:Si.depth_vert,fragmentShader:Si.depth_frag},normal:{uniforms:Da([St.common,St.bumpmap,St.normalmap,St.displacementmap,{opacity:{value:1}}]),vertexShader:Si.meshnormal_vert,fragmentShader:Si.meshnormal_frag},sprite:{uniforms:Da([St.sprite,St.fog]),vertexShader:Si.sprite_vert,fragmentShader:Si.sprite_frag},background:{uniforms:{uvTransform:{value:new co},t2D:{value:null}},vertexShader:Si.background_vert,fragmentShader:Si.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0}},vertexShader:Si.backgroundCube_vert,fragmentShader:Si.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Si.cube_vert,fragmentShader:Si.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Si.equirect_vert,fragmentShader:Si.equirect_frag},distanceRGBA:{uniforms:Da([St.common,St.displacementmap,{referencePosition:{value:new le},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Si.distanceRGBA_vert,fragmentShader:Si.distanceRGBA_frag},shadow:{uniforms:Da([St.lights,St.fog,{color:{value:new Ct(0)},opacity:{value:1}}]),vertexShader:Si.shadow_vert,fragmentShader:Si.shadow_frag}};bc.physical={uniforms:Da([bc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new tt(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Ct(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new tt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ct(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ct(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Si.meshphysical_vert,fragmentShader:Si.meshphysical_frag};function R1e(t,e,i,r,n,s,a){const o=new Ct(0);let l=s===!0?0:1,c,h,u=null,d=0,f=null;function p(g,v){let y=!1,x=v.isScene===!0?v.background:null;x&&x.isTexture&&(x=(v.backgroundBlurriness>0?i:e).get(x));const S=t.xr,A=S.getSession&&S.getSession();A&&A.environmentBlendMode==="additive"&&(x=null),x===null?m(o,l):x&&x.isColor&&(m(x,1),y=!0),(t.autoClear||y)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),x&&(x.isCubeTexture||x.mapping===I1)?(h===void 0&&(h=new Ms(new Pp(1,1,1),new zh({name:"BackgroundCubeMaterial",uniforms:Jy(bc.backgroundCube.uniforms),vertexShader:bc.backgroundCube.vertexShader,fragmentShader:bc.backgroundCube.fragmentShader,side:Go,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(_,M,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h)),h.material.uniforms.envMap.value=x,h.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,(u!==x||d!==x.version||f!==t.toneMapping)&&(h.material.needsUpdate=!0,u=x,d=x.version,f=t.toneMapping),h.layers.enableAll(),g.unshift(h,h.geometry,h.material,0,0,null)):x&&x.isTexture&&(c===void 0&&(c=new Ms(new O1(2,2),new zh({name:"BackgroundMaterial",uniforms:Jy(bc.background.uniforms),vertexShader:bc.background.vertexShader,fragmentShader:bc.background.fragmentShader,side:cp,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=x,x.matrixAutoUpdate===!0&&x.updateMatrix(),c.material.uniforms.uvTransform.value.copy(x.matrix),(u!==x||d!==x.version||f!==t.toneMapping)&&(c.material.needsUpdate=!0,u=x,d=x.version,f=t.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null))}function m(g,v){r.buffers.color.setClear(g.r,g.g,g.b,v,a)}return{getClearColor:function(){return o},setClearColor:function(g,v=1){o.set(g),l=v,m(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,m(o,l)},render:p}}function I1e(t,e,i,r){const n=t.getParameter(34921),s=r.isWebGL2?null:e.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=g(null);let c=l,h=!1;function u(L,H,q,W,I){let z=!1;if(a){const U=m(W,q,H);c!==U&&(c=U,f(c.object)),z=v(L,W,q,I),z&&y(L,W,q,I)}else{const U=H.wireframe===!0;(c.geometry!==W.id||c.program!==q.id||c.wireframe!==U)&&(c.geometry=W.id,c.program=q.id,c.wireframe=U,z=!0)}I!==null&&i.update(I,34963),(z||h)&&(h=!1,E(L,H,q,W),I!==null&&t.bindBuffer(34963,i.get(I).buffer))}function d(){return r.isWebGL2?t.createVertexArray():s.createVertexArrayOES()}function f(L){return r.isWebGL2?t.bindVertexArray(L):s.bindVertexArrayOES(L)}function p(L){return r.isWebGL2?t.deleteVertexArray(L):s.deleteVertexArrayOES(L)}function m(L,H,q){const W=q.wireframe===!0;let I=o[L.id];I===void 0&&(I={},o[L.id]=I);let z=I[H.id];z===void 0&&(z={},I[H.id]=z);let U=z[W];return U===void 0&&(U=g(d()),z[W]=U),U}function g(L){const H=[],q=[],W=[];for(let I=0;I<n;I++)H[I]=0,q[I]=0,W[I]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:H,enabledAttributes:q,attributeDivisors:W,object:L,attributes:{},index:null}}function v(L,H,q,W){const I=c.attributes,z=H.attributes;let U=0;const X=q.getAttributes();for(const Q in X)if(X[Q].location>=0){const ie=I[Q];let ce=z[Q];if(ce===void 0&&(Q==="instanceMatrix"&&L.instanceMatrix&&(ce=L.instanceMatrix),Q==="instanceColor"&&L.instanceColor&&(ce=L.instanceColor)),ie===void 0||ie.attribute!==ce||ce&&ie.data!==ce.data)return!0;U++}return c.attributesNum!==U||c.index!==W}function y(L,H,q,W){const I={},z=H.attributes;let U=0;const X=q.getAttributes();for(const Q in X)if(X[Q].location>=0){let ie=z[Q];ie===void 0&&(Q==="instanceMatrix"&&L.instanceMatrix&&(ie=L.instanceMatrix),Q==="instanceColor"&&L.instanceColor&&(ie=L.instanceColor));const ce={};ce.attribute=ie,ie&&ie.data&&(ce.data=ie.data),I[Q]=ce,U++}c.attributes=I,c.attributesNum=U,c.index=W}function x(){const L=c.newAttributes;for(let H=0,q=L.length;H<q;H++)L[H]=0}function S(L){A(L,0)}function A(L,H){const q=c.newAttributes,W=c.enabledAttributes,I=c.attributeDivisors;q[L]=1,W[L]===0&&(t.enableVertexAttribArray(L),W[L]=1),I[L]!==H&&((r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](L,H),I[L]=H)}function _(){const L=c.newAttributes,H=c.enabledAttributes;for(let q=0,W=H.length;q<W;q++)H[q]!==L[q]&&(t.disableVertexAttribArray(q),H[q]=0)}function M(L,H,q,W,I,z){r.isWebGL2===!0&&(q===5124||q===5125)?t.vertexAttribIPointer(L,H,q,I,z):t.vertexAttribPointer(L,H,q,W,I,z)}function E(L,H,q,W){if(r.isWebGL2===!1&&(L.isInstancedMesh||W.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;x();const I=W.attributes,z=q.getAttributes(),U=H.defaultAttributeValues;for(const X in z){const Q=z[X];if(Q.location>=0){let re=I[X];if(re===void 0&&(X==="instanceMatrix"&&L.instanceMatrix&&(re=L.instanceMatrix),X==="instanceColor"&&L.instanceColor&&(re=L.instanceColor)),re!==void 0){const ie=re.normalized,ce=re.itemSize,Z=i.get(re);if(Z===void 0)continue;const Ae=Z.buffer,Se=Z.type,_e=Z.bytesPerElement;if(re.isInterleavedBufferAttribute){const ve=re.data,Ee=ve.stride,fe=re.offset;if(ve.isInstancedInterleavedBuffer){for(let pe=0;pe<Q.locationSize;pe++)A(Q.location+pe,ve.meshPerAttribute);L.isInstancedMesh!==!0&&W._maxInstanceCount===void 0&&(W._maxInstanceCount=ve.meshPerAttribute*ve.count)}else for(let pe=0;pe<Q.locationSize;pe++)S(Q.location+pe);t.bindBuffer(34962,Ae);for(let pe=0;pe<Q.locationSize;pe++)M(Q.location+pe,ce/Q.locationSize,Se,ie,Ee*_e,(fe+ce/Q.locationSize*pe)*_e)}else{if(re.isInstancedBufferAttribute){for(let ve=0;ve<Q.locationSize;ve++)A(Q.location+ve,re.meshPerAttribute);L.isInstancedMesh!==!0&&W._maxInstanceCount===void 0&&(W._maxInstanceCount=re.meshPerAttribute*re.count)}else for(let ve=0;ve<Q.locationSize;ve++)S(Q.location+ve);t.bindBuffer(34962,Ae);for(let ve=0;ve<Q.locationSize;ve++)M(Q.location+ve,ce/Q.locationSize,Se,ie,ce*_e,ce/Q.locationSize*ve*_e)}}else if(U!==void 0){const ie=U[X];if(ie!==void 0)switch(ie.length){case 2:t.vertexAttrib2fv(Q.location,ie);break;case 3:t.vertexAttrib3fv(Q.location,ie);break;case 4:t.vertexAttrib4fv(Q.location,ie);break;default:t.vertexAttrib1fv(Q.location,ie)}}}}_()}function T(){B();for(const L in o){const H=o[L];for(const q in H){const W=H[q];for(const I in W)p(W[I].object),delete W[I];delete H[q]}delete o[L]}}function C(L){if(o[L.id]===void 0)return;const H=o[L.id];for(const q in H){const W=H[q];for(const I in W)p(W[I].object),delete W[I];delete H[q]}delete o[L.id]}function D(L){for(const H in o){const q=o[H];if(q[L.id]===void 0)continue;const W=q[L.id];for(const I in W)p(W[I].object),delete W[I];delete q[L.id]}}function B(){O(),h=!0,c!==l&&(c=l,f(c.object))}function O(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:B,resetDefaultState:O,dispose:T,releaseStatesOfGeometry:C,releaseStatesOfProgram:D,initAttributes:x,enableAttribute:S,disableUnusedAttributes:_}}function L1e(t,e,i,r){const n=r.isWebGL2;let s;function a(c){s=c}function o(c,h){t.drawArrays(s,c,h),i.update(h,s,1)}function l(c,h,u){if(u===0)return;let d,f;if(n)d=t,f="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[f](s,c,h,u),i.update(h,s,u)}this.setMode=a,this.render=o,this.renderInstances=l}function O1e(t,e,i){let r;function n(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(M){if(M==="highp"){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";M="mediump"}return M==="mediump"&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&t instanceof WebGL2ComputeRenderingContext;let o=i.precision!==void 0?i.precision:"highp";const l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);const c=a||e.has("WEBGL_draw_buffers"),h=i.logarithmicDepthBuffer===!0,u=t.getParameter(34930),d=t.getParameter(35660),f=t.getParameter(3379),p=t.getParameter(34076),m=t.getParameter(34921),g=t.getParameter(36347),v=t.getParameter(36348),y=t.getParameter(36349),x=d>0,S=a||e.has("OES_texture_float"),A=x&&S,_=a?t.getParameter(36183):0;return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:h,maxTextures:u,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:g,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:x,floatFragmentTextures:S,floatVertexTextures:A,maxSamples:_}}function B1e(t){const e=this;let i=null,r=0,n=!1,s=!1;const a=new Ou,o=new co,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d,f){const p=u.length!==0||d||r!==0||n;return n=d,i=h(u,f,0),r=u.length,p},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1,c()},this.setState=function(u,d,f){const p=u.clippingPlanes,m=u.clipIntersection,g=u.clipShadows,v=t.get(u);if(!n||p===null||p.length===0||s&&!g)s?h(null):c();else{const y=s?0:r,x=y*4;let S=v.clippingState||null;l.value=S,S=h(p,d,x,f);for(let A=0;A!==x;++A)S[A]=i[A];v.clippingState=S,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=y}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function h(u,d,f,p){const m=u!==null?u.length:0;let g=null;if(m!==0){if(g=l.value,p!==!0||g===null){const v=f+m*4,y=d.matrixWorldInverse;o.getNormalMatrix(y),(g===null||g.length<v)&&(g=new Float32Array(v));for(let x=0,S=f;x!==m;++x,S+=4)a.copy(u[x]).applyMatrix4(y,o),a.normal.toArray(g,S),g[S+3]=a.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,g}}function F1e(t){let e=new WeakMap;function i(a,o){return o===Kw?a.mapping=hp:o===Qw&&(a.mapping=up),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){const o=a.mapping;if(o===Kw||o===Qw)if(e.has(a)){const l=e.get(a).texture;return i(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new A4(l.height/2);return c.fromEquirectangularTexture(t,a),e.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){const o=a.target;o.removeEventListener("dispose",n);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}class Dc extends i_{constructor(e=-1,i=1,r=1,n=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=r,this.bottom=n,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,r,n,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=r-e,a=r+e,o=n+i,l=n-i;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,a=s+c*this.view.width,o-=h*this.view.offsetY,l=o-h*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}const $v=4,aj=[.125,.215,.35,.446,.526,.582],Dm=20,nL=new Dc,oj=new Ct;let sL=null;const wm=(1+Math.sqrt(5))/2,N0=1/wm,lj=[new le(1,1,1),new le(-1,1,1),new le(1,1,-1),new le(-1,1,-1),new le(0,wm,N0),new le(0,wm,-N0),new le(N0,0,wm),new le(-N0,0,wm),new le(wm,N0,0),new le(-wm,N0,0)];class JF{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,i=0,r=.1,n=100){sL=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,r,n,s),i>0&&this._blur(s,0,0,i),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=uj(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=hj(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(sL),e.scissorTest=!1,xE(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===hp||e.mapping===up?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),sL=this._renderer.getRenderTarget();const r=i||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,r={magFilter:Hr,minFilter:Hr,generateMipmaps:!1,type:Qy,format:so,encoding:fp,depthBuffer:!1},n=cj(e,i,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=cj(e,i,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=k1e(s)),this._blurMaterial=N1e(s,e,i)}return n}_compileMaterial(e){const i=new Ms(this._lodPlanes[0],e);this._renderer.compile(i,nL)}_sceneToCubeUV(e,i,r,n){const o=new Or(90,1,i,r),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,u=h.autoClear,d=h.toneMapping;h.getClearColor(oj),h.toneMapping=Pc,h.autoClear=!1;const f=new ko({name:"PMREM.Background",side:Go,depthWrite:!1,depthTest:!1}),p=new Ms(new Pp,f);let m=!1;const g=e.background;g?g.isColor&&(f.color.copy(g),e.background=null,m=!0):(f.color.copy(oj),m=!0);for(let v=0;v<6;v++){const y=v%3;y===0?(o.up.set(0,l[v],0),o.lookAt(c[v],0,0)):y===1?(o.up.set(0,0,l[v]),o.lookAt(0,c[v],0)):(o.up.set(0,l[v],0),o.lookAt(0,0,c[v]));const x=this._cubeSize;xE(n,y*x,v>2?x:0,x,x),h.setRenderTarget(n),m&&h.render(p,o),h.render(e,o)}p.geometry.dispose(),p.material.dispose(),h.toneMapping=d,h.autoClear=u,e.background=g}_textureToCubeUV(e,i){const r=this._renderer,n=e.mapping===hp||e.mapping===up;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=uj()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=hj());const s=n?this._cubemapMaterial:this._equirectMaterial,a=new Ms(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=e;const l=this._cubeSize;xE(i,0,0,3*l,2*l),r.setRenderTarget(i),r.render(a,nL)}_applyPMREM(e){const i=this._renderer,r=i.autoClear;i.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){const s=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),a=lj[(n-1)%lj.length];this._blur(e,n-1,n,s,a)}i.autoClear=r}_blur(e,i,r,n,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,i,r,n,"latitudinal",s),this._halfBlur(a,e,r,r,n,"longitudinal",s)}_halfBlur(e,i,r,n,s,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,u=new Ms(this._lodPlanes[n],c),d=c.uniforms,f=this._sizeLods[r]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*Dm-1),m=s/p,g=isFinite(s)?1+Math.floor(h*m):Dm;g>Dm&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${Dm}`);const v=[];let y=0;for(let M=0;M<Dm;++M){const E=M/m,T=Math.exp(-E*E/2);v.push(T),M===0?y+=T:M<g&&(y+=2*T)}for(let M=0;M<v.length;M++)v[M]=v[M]/y;d.envMap.value=e.texture,d.samples.value=g,d.weights.value=v,d.latitudinal.value=a==="latitudinal",o&&(d.poleAxis.value=o);const{_lodMax:x}=this;d.dTheta.value=p,d.mipInt.value=x-r;const S=this._sizeLods[n],A=3*S*(n>x-$v?n-x+$v:0),_=4*(this._cubeSize-S);xE(i,A,_,3*S,2*S),l.setRenderTarget(i),l.render(u,nL)}}function k1e(t){const e=[],i=[],r=[];let n=t;const s=t-$v+1+aj.length;for(let a=0;a<s;a++){const o=Math.pow(2,n);i.push(o);let l=1/o;a>t-$v?l=aj[a-t+$v-1]:a===0&&(l=0),r.push(l);const c=1/(o-2),h=-c,u=1+c,d=[h,h,u,h,u,u,h,h,u,u,h,u],f=6,p=6,m=3,g=2,v=1,y=new Float32Array(m*p*f),x=new Float32Array(g*p*f),S=new Float32Array(v*p*f);for(let _=0;_<f;_++){const M=_%3*2/3-1,E=_>2?0:-1,T=[M,E,0,M+2/3,E,0,M+2/3,E+1,0,M,E,0,M+2/3,E+1,0,M,E+1,0];y.set(T,m*p*_),x.set(d,g*p*_);const C=[_,_,_,_,_,_];S.set(C,v*p*_)}const A=new xi;A.setAttribute("position",new Xi(y,m)),A.setAttribute("uv",new Xi(x,g)),A.setAttribute("faceIndex",new Xi(S,v)),e.push(A),n>$v&&n--}return{lodPlanes:e,sizeLods:i,sigmas:r}}function cj(t,e,i){const r=new Hl(t,e,i);return r.texture.mapping=I1,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function xE(t,e,i,r,n){t.viewport.set(e,i,r,n),t.scissor.set(e,i,r,n)}function N1e(t,e,i){const r=new Float32Array(Dm),n=new le(0,1,0);return new zh({name:"SphericalGaussianBlur",defines:{n:Dm,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:E4(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:td,depthTest:!1,depthWrite:!1})}function hj(){return new zh({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:E4(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:td,depthTest:!1,depthWrite:!1})}function uj(){return new zh({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:E4(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:td,depthTest:!1,depthWrite:!1})}function E4(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function U1e(t){let e=new WeakMap,i=null;function r(o){if(o&&o.isTexture){const l=o.mapping,c=l===Kw||l===Qw,h=l===hp||l===up;if(c||h)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let u=e.get(o);return i===null&&(i=new JF(t)),u=c?i.fromEquirectangular(o,u):i.fromCubemap(o,u),e.set(o,u),u.texture}else{if(e.has(o))return e.get(o).texture;{const u=o.image;if(c&&u&&u.height>0||h&&u&&n(u)){i===null&&(i=new JF(t));const d=c?i.fromEquirectangular(o):i.fromCubemap(o);return e.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0;const c=6;for(let h=0;h<c;h++)o[h]!==void 0&&l++;return l===c}function s(o){const l=o.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function a(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function z1e(t){const e={};function i(r){if(e[r]!==void 0)return e[r];let n;switch(r){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(r)}return e[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){const n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function G1e(t,e,i,r){const n={},s=new WeakMap;function a(u){const d=u.target;d.index!==null&&e.remove(d.index);for(const p in d.attributes)e.remove(d.attributes[p]);d.removeEventListener("dispose",a),delete n[d.id];const f=s.get(d);f&&(e.remove(f),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(u,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(u){const d=u.attributes;for(const p in d)e.update(d[p],34962);const f=u.morphAttributes;for(const p in f){const m=f[p];for(let g=0,v=m.length;g<v;g++)e.update(m[g],34962)}}function c(u){const d=[],f=u.index,p=u.attributes.position;let m=0;if(f!==null){const y=f.array;m=f.version;for(let x=0,S=y.length;x<S;x+=3){const A=y[x+0],_=y[x+1],M=y[x+2];d.push(A,_,_,M,M,A)}}else{const y=p.array;m=p.version;for(let x=0,S=y.length/3-1;x<S;x+=3){const A=x+0,_=x+1,M=x+2;d.push(A,_,_,M,M,A)}}const g=new(fie(d)?S4:w4)(d,1);g.version=m;const v=s.get(u);v&&e.remove(v),s.set(u,g)}function h(u){const d=s.get(u);if(d){const f=u.index;f!==null&&d.version<f.version&&c(u)}else c(u);return s.get(u)}return{get:o,update:l,getWireframeAttribute:h}}function V1e(t,e,i,r){const n=r.isWebGL2;let s;function a(d){s=d}let o,l;function c(d){o=d.type,l=d.bytesPerElement}function h(d,f){t.drawElements(s,f,o,d*l),i.update(f,s,1)}function u(d,f,p){if(p===0)return;let m,g;if(n)m=t,g="drawElementsInstanced";else if(m=e.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",m===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[g](s,f,o,d*l,p),i.update(f,s,p)}this.setMode=a,this.setIndex=c,this.render=h,this.renderInstances=u}function H1e(t){const e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case 4:i.triangles+=o*(s/3);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:n,update:r}}function j1e(t,e){return t[0]-e[0]}function W1e(t,e){return Math.abs(e[1])-Math.abs(t[1])}function X1e(t,e,i){const r={},n=new Float32Array(8),s=new WeakMap,a=new rr,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,h,u,d){const f=c.morphTargetInfluences;if(e.isWebGL2===!0){const p=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,m=p!==void 0?p.length:0;let g=s.get(h);if(g===void 0||g.count!==m){let H=function(){O.dispose(),s.delete(h),h.removeEventListener("dispose",H)};g!==void 0&&g.texture.dispose();const x=h.morphAttributes.position!==void 0,S=h.morphAttributes.normal!==void 0,A=h.morphAttributes.color!==void 0,_=h.morphAttributes.position||[],M=h.morphAttributes.normal||[],E=h.morphAttributes.color||[];let T=0;x===!0&&(T=1),S===!0&&(T=2),A===!0&&(T=3);let C=h.attributes.position.count*T,D=1;C>e.maxTextureSize&&(D=Math.ceil(C/e.maxTextureSize),C=e.maxTextureSize);const B=new Float32Array(C*D*4*m),O=new t_(B,C,D,m);O.type=Wu,O.needsUpdate=!0;const L=T*4;for(let q=0;q<m;q++){const W=_[q],I=M[q],z=E[q],U=C*D*4*q;for(let X=0;X<W.count;X++){const Q=X*L;x===!0&&(a.fromBufferAttribute(W,X),B[U+Q+0]=a.x,B[U+Q+1]=a.y,B[U+Q+2]=a.z,B[U+Q+3]=0),S===!0&&(a.fromBufferAttribute(I,X),B[U+Q+4]=a.x,B[U+Q+5]=a.y,B[U+Q+6]=a.z,B[U+Q+7]=0),A===!0&&(a.fromBufferAttribute(z,X),B[U+Q+8]=a.x,B[U+Q+9]=a.y,B[U+Q+10]=a.z,B[U+Q+11]=z.itemSize===4?a.w:1)}}g={count:m,texture:O,size:new tt(C,D)},s.set(h,g),h.addEventListener("dispose",H)}let v=0;for(let x=0;x<f.length;x++)v+=f[x];const y=h.morphTargetsRelative?1:1-v;d.getUniforms().setValue(t,"morphTargetBaseInfluence",y),d.getUniforms().setValue(t,"morphTargetInfluences",f),d.getUniforms().setValue(t,"morphTargetsTexture",g.texture,i),d.getUniforms().setValue(t,"morphTargetsTextureSize",g.size)}else{const p=f===void 0?0:f.length;let m=r[h.id];if(m===void 0||m.length!==p){m=[];for(let S=0;S<p;S++)m[S]=[S,0];r[h.id]=m}for(let S=0;S<p;S++){const A=m[S];A[0]=S,A[1]=f[S]}m.sort(W1e);for(let S=0;S<8;S++)S<p&&m[S][1]?(o[S][0]=m[S][0],o[S][1]=m[S][1]):(o[S][0]=Number.MAX_SAFE_INTEGER,o[S][1]=0);o.sort(j1e);const g=h.morphAttributes.position,v=h.morphAttributes.normal;let y=0;for(let S=0;S<8;S++){const A=o[S],_=A[0],M=A[1];_!==Number.MAX_SAFE_INTEGER&&M?(g&&h.getAttribute("morphTarget"+S)!==g[_]&&h.setAttribute("morphTarget"+S,g[_]),v&&h.getAttribute("morphNormal"+S)!==v[_]&&h.setAttribute("morphNormal"+S,v[_]),n[S]=M,y+=M):(g&&h.hasAttribute("morphTarget"+S)===!0&&h.deleteAttribute("morphTarget"+S),v&&h.hasAttribute("morphNormal"+S)===!0&&h.deleteAttribute("morphNormal"+S),n[S]=0)}const x=h.morphTargetsRelative?1:1-y;d.getUniforms().setValue(t,"morphTargetBaseInfluence",x),d.getUniforms().setValue(t,"morphTargetInfluences",n)}}return{update:l}}function Y1e(t,e,i,r){let n=new WeakMap;function s(l){const c=r.render.frame,h=l.geometry,u=e.get(l,h);return n.get(u)!==c&&(e.update(u),n.set(u,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),u}function a(){n=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}const vie=new kr,yie=new t_,xie=new nD,bie=new r_,dj=[],fj=[],pj=new Float32Array(16),mj=new Float32Array(9),gj=new Float32Array(4);function B1(t,e,i){const r=t[0];if(r<=0||r>0)return t;const n=e*i;let s=dj[n];if(s===void 0&&(s=new Float32Array(n),dj[n]=s),e!==0){r.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=i,t[a].toArray(s,o)}return s}function rs(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function ns(t,e){for(let i=0,r=e.length;i<r;i++)t[i]=e[i]}function aD(t,e){let i=fj[e];i===void 0&&(i=new Int32Array(e),fj[e]=i);for(let r=0;r!==e;++r)i[r]=t.allocateTextureUnit();return i}function q1e(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function K1e(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(rs(i,e))return;t.uniform2fv(this.addr,e),ns(i,e)}}function Q1e(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(rs(i,e))return;t.uniform3fv(this.addr,e),ns(i,e)}}function $1e(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(rs(i,e))return;t.uniform4fv(this.addr,e),ns(i,e)}}function J1e(t,e){const i=this.cache,r=e.elements;if(r===void 0){if(rs(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),ns(i,e)}else{if(rs(i,r))return;gj.set(r),t.uniformMatrix2fv(this.addr,!1,gj),ns(i,r)}}function Z1e(t,e){const i=this.cache,r=e.elements;if(r===void 0){if(rs(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),ns(i,e)}else{if(rs(i,r))return;mj.set(r),t.uniformMatrix3fv(this.addr,!1,mj),ns(i,r)}}function exe(t,e){const i=this.cache,r=e.elements;if(r===void 0){if(rs(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),ns(i,e)}else{if(rs(i,r))return;pj.set(r),t.uniformMatrix4fv(this.addr,!1,pj),ns(i,r)}}function txe(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function ixe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(rs(i,e))return;t.uniform2iv(this.addr,e),ns(i,e)}}function rxe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(rs(i,e))return;t.uniform3iv(this.addr,e),ns(i,e)}}function nxe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(rs(i,e))return;t.uniform4iv(this.addr,e),ns(i,e)}}function sxe(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function axe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(rs(i,e))return;t.uniform2uiv(this.addr,e),ns(i,e)}}function oxe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(rs(i,e))return;t.uniform3uiv(this.addr,e),ns(i,e)}}function lxe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(rs(i,e))return;t.uniform4uiv(this.addr,e),ns(i,e)}}function cxe(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(e||vie,n)}function hxe(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(e||xie,n)}function uxe(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(e||bie,n)}function dxe(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(e||yie,n)}function fxe(t){switch(t){case 5126:return q1e;case 35664:return K1e;case 35665:return Q1e;case 35666:return $1e;case 35674:return J1e;case 35675:return Z1e;case 35676:return exe;case 5124:case 35670:return txe;case 35667:case 35671:return ixe;case 35668:case 35672:return rxe;case 35669:case 35673:return nxe;case 5125:return sxe;case 36294:return axe;case 36295:return oxe;case 36296:return lxe;case 35678:case 36198:case 36298:case 36306:case 35682:return cxe;case 35679:case 36299:case 36307:return hxe;case 35680:case 36300:case 36308:case 36293:return uxe;case 36289:case 36303:case 36311:case 36292:return dxe}}function pxe(t,e){t.uniform1fv(this.addr,e)}function mxe(t,e){const i=B1(e,this.size,2);t.uniform2fv(this.addr,i)}function gxe(t,e){const i=B1(e,this.size,3);t.uniform3fv(this.addr,i)}function vxe(t,e){const i=B1(e,this.size,4);t.uniform4fv(this.addr,i)}function yxe(t,e){const i=B1(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function xxe(t,e){const i=B1(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function bxe(t,e){const i=B1(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function wxe(t,e){t.uniform1iv(this.addr,e)}function Sxe(t,e){t.uniform2iv(this.addr,e)}function _xe(t,e){t.uniform3iv(this.addr,e)}function Axe(t,e){t.uniform4iv(this.addr,e)}function Exe(t,e){t.uniform1uiv(this.addr,e)}function Mxe(t,e){t.uniform2uiv(this.addr,e)}function Txe(t,e){t.uniform3uiv(this.addr,e)}function Cxe(t,e){t.uniform4uiv(this.addr,e)}function Pxe(t,e,i){const r=this.cache,n=e.length,s=aD(i,n);rs(r,s)||(t.uniform1iv(this.addr,s),ns(r,s));for(let a=0;a!==n;++a)i.setTexture2D(e[a]||vie,s[a])}function Dxe(t,e,i){const r=this.cache,n=e.length,s=aD(i,n);rs(r,s)||(t.uniform1iv(this.addr,s),ns(r,s));for(let a=0;a!==n;++a)i.setTexture3D(e[a]||xie,s[a])}function Rxe(t,e,i){const r=this.cache,n=e.length,s=aD(i,n);rs(r,s)||(t.uniform1iv(this.addr,s),ns(r,s));for(let a=0;a!==n;++a)i.setTextureCube(e[a]||bie,s[a])}function Ixe(t,e,i){const r=this.cache,n=e.length,s=aD(i,n);rs(r,s)||(t.uniform1iv(this.addr,s),ns(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(e[a]||yie,s[a])}function Lxe(t){switch(t){case 5126:return pxe;case 35664:return mxe;case 35665:return gxe;case 35666:return vxe;case 35674:return yxe;case 35675:return xxe;case 35676:return bxe;case 5124:case 35670:return wxe;case 35667:case 35671:return Sxe;case 35668:case 35672:return _xe;case 35669:case 35673:return Axe;case 5125:return Exe;case 36294:return Mxe;case 36295:return Txe;case 36296:return Cxe;case 35678:case 36198:case 36298:case 36306:case 35682:return Pxe;case 35679:case 36299:case 36307:return Dxe;case 35680:case 36300:case 36308:case 36293:return Rxe;case 36289:case 36303:case 36311:case 36292:return Ixe}}class Oxe{constructor(e,i,r){this.id=e,this.addr=r,this.cache=[],this.setValue=fxe(i.type)}}class Bxe{constructor(e,i,r){this.id=e,this.addr=r,this.cache=[],this.size=i.size,this.setValue=Lxe(i.type)}}class Fxe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,r){const n=this.seq;for(let s=0,a=n.length;s!==a;++s){const o=n[s];o.setValue(e,i[o.id],r)}}}const aL=/(\w+)(\])?(\[|\.)?/g;function vj(t,e){t.seq.push(e),t.map[e.id]=e}function kxe(t,e,i){const r=t.name,n=r.length;for(aL.lastIndex=0;;){const s=aL.exec(r),a=aL.lastIndex;let o=s[1];const l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){vj(i,c===void 0?new Oxe(o,t,e):new Bxe(o,t,e));break}else{let u=i.map[o];u===void 0&&(u=new Fxe(o),vj(i,u)),i=u}}}class JT{constructor(e,i){this.seq=[],this.map={};const r=e.getProgramParameter(i,35718);for(let n=0;n<r;++n){const s=e.getActiveUniform(i,n),a=e.getUniformLocation(i,s.name);kxe(s,a,this)}}setValue(e,i,r,n){const s=this.map[i];s!==void 0&&s.setValue(e,r,n)}setOptional(e,i,r){const n=i[r];n!==void 0&&this.setValue(e,r,n)}static upload(e,i,r,n){for(let s=0,a=i.length;s!==a;++s){const o=i[s],l=r[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,n)}}static seqWithValue(e,i){const r=[];for(let n=0,s=e.length;n!==s;++n){const a=e[n];a.id in i&&r.push(a)}return r}}function yj(t,e,i){const r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}let Nxe=0;function Uxe(t,e){const i=t.split(`
`),r=[],n=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let a=n;a<s;a++){const o=a+1;r.push(`${o===e?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function zxe(t){switch(t){case fp:return["Linear","( value )"];case zr:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function xj(t,e,i){const r=t.getShaderParameter(e,35713),n=t.getShaderInfoLog(e).trim();if(r&&n==="")return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+Uxe(t.getShaderSource(e),a)}else return n}function Gxe(t,e){const i=zxe(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Vxe(t,e){let i;switch(e){case Ute:i="Linear";break;case zte:i="Reinhard";break;case Gte:i="OptimizedCineon";break;case p4:i="ACESFilmic";break;case Vte:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Hxe(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||t.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Db).join(`
`)}function jxe(t){const e=[];for(const i in t){const r=t[i];r!==!1&&e.push("#define "+i+" "+r)}return e.join(`
`)}function Wxe(t,e){const i={},r=t.getProgramParameter(e,35721);for(let n=0;n<r;n++){const s=t.getActiveAttrib(e,n),a=s.name;let o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),i[a]={type:s.type,location:t.getAttribLocation(e,a),locationSize:o}}return i}function Db(t){return t!==""}function bj(t,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function wj(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Xxe=/^[ \t]*#include +<([\w\d./]+)>/gm;function ZF(t){return t.replace(Xxe,Yxe)}function Yxe(t,e){const i=Si[e];if(i===void 0)throw new Error("Can not resolve #include <"+e+">");return ZF(i)}const qxe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Sj(t){return t.replace(qxe,Kxe)}function Kxe(t,e,i,r){let n="";for(let s=parseInt(e);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function _j(t){let e="precision "+t.precision+` float;
precision `+t.precision+" int;";return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Qxe(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===eD?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===rw?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===zm&&(e="SHADOWMAP_TYPE_VSM"),e}function $xe(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case hp:case up:e="ENVMAP_TYPE_CUBE";break;case I1:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Jxe(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case up:e="ENVMAP_MODE_REFRACTION";break}return e}function Zxe(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case e_:e="ENVMAP_BLENDING_MULTIPLY";break;case kte:e="ENVMAP_BLENDING_MIX";break;case Nte:e="ENVMAP_BLENDING_ADD";break}return e}function ebe(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const i=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function tbe(t,e,i,r){const n=t.getContext(),s=i.defines;let a=i.vertexShader,o=i.fragmentShader;const l=Qxe(i),c=$xe(i),h=Jxe(i),u=Zxe(i),d=ebe(i),f=i.isWebGL2?"":Hxe(i),p=jxe(s),m=n.createProgram();let g,v,y=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(g=[p].filter(Db).join(`
`),g.length>0&&(g+=`
`),v=[f,p].filter(Db).join(`
`),v.length>0&&(v+=`
`)):(g=[_j(i),"#define SHADER_NAME "+i.shaderName,p,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Db).join(`
`),v=[f,_j(i),"#define SHADER_NAME "+i.shaderName,p,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Pc?"#define TONE_MAPPING":"",i.toneMapping!==Pc?Si.tonemapping_pars_fragment:"",i.toneMapping!==Pc?Vxe("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Si.encodings_pars_fragment,Gxe("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Db).join(`
`)),a=ZF(a),a=bj(a,i),a=wj(a,i),o=ZF(o),o=bj(o,i),o=wj(o,i),a=Sj(a),o=Sj(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,v=["#define varying in",i.glslVersion===QF?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===QF?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const x=y+g+a,S=y+v+o,A=yj(n,35633,x),_=yj(n,35632,S);if(n.attachShader(m,A),n.attachShader(m,_),i.index0AttributeName!==void 0?n.bindAttribLocation(m,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(m,0,"position"),n.linkProgram(m),t.debug.checkShaderErrors){const T=n.getProgramInfoLog(m).trim(),C=n.getShaderInfoLog(A).trim(),D=n.getShaderInfoLog(_).trim();let B=!0,O=!0;if(n.getProgramParameter(m,35714)===!1){B=!1;const L=xj(n,A,"vertex"),H=xj(n,_,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(m,35715)+`

Program Info Log: `+T+`
`+L+`
`+H)}else T!==""?console.warn("THREE.WebGLProgram: Program Info Log:",T):(C===""||D==="")&&(O=!1);O&&(this.diagnostics={runnable:B,programLog:T,vertexShader:{log:C,prefix:g},fragmentShader:{log:D,prefix:v}})}n.deleteShader(A),n.deleteShader(_);let M;this.getUniforms=function(){return M===void 0&&(M=new JT(n,m)),M};let E;return this.getAttributes=function(){return E===void 0&&(E=Wxe(n,m)),E},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(m),this.program=void 0},this.name=i.shaderName,this.id=Nxe++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=A,this.fragmentShader=_,this}let ibe=0;class rbe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.vertexShader,r=e.fragmentShader,n=this._getShaderStage(i),s=this._getShaderStage(r),a=this._getShaderCacheForMaterial(e);return a.has(n)===!1&&(a.add(n),n.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const i=this.materialCache.get(e);for(const r of i)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const i=this.materialCache;let r=i.get(e);return r===void 0&&(r=new Set,i.set(e,r)),r}_getShaderStage(e){const i=this.shaderCache;let r=i.get(e);return r===void 0&&(r=new nbe(e),i.set(e,r)),r}}class nbe{constructor(e){this.id=ibe++,this.code=e,this.usedTimes=0}}function sbe(t,e,i,r,n,s,a){const o=new ug,l=new rbe,c=[],h=n.isWebGL2,u=n.logarithmicDepthBuffer,d=n.vertexTextures;let f=n.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(E,T,C,D,B){const O=D.fog,L=B.geometry,H=E.isMeshStandardMaterial?D.environment:null,q=(E.isMeshStandardMaterial?i:e).get(E.envMap||H),W=q&&q.mapping===I1?q.image.height:null,I=p[E.type];E.precision!==null&&(f=n.getMaxPrecision(E.precision),f!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",f,"instead."));const z=L.morphAttributes.position||L.morphAttributes.normal||L.morphAttributes.color,U=z!==void 0?z.length:0;let X=0;L.morphAttributes.position!==void 0&&(X=1),L.morphAttributes.normal!==void 0&&(X=2),L.morphAttributes.color!==void 0&&(X=3);let Q,re,ie,ce;if(I){const Ee=bc[I];Q=Ee.vertexShader,re=Ee.fragmentShader}else Q=E.vertexShader,re=E.fragmentShader,l.update(E),ie=l.getVertexShaderID(E),ce=l.getFragmentShaderID(E);const Z=t.getRenderTarget(),Ae=E.alphaTest>0,Se=E.clearcoat>0,_e=E.iridescence>0;return{isWebGL2:h,shaderID:I,shaderName:E.type,vertexShader:Q,fragmentShader:re,defines:E.defines,customVertexShaderID:ie,customFragmentShaderID:ce,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:f,instancing:B.isInstancedMesh===!0,instancingColor:B.isInstancedMesh===!0&&B.instanceColor!==null,supportsVertexTextures:d,outputEncoding:Z===null?t.outputEncoding:Z.isXRRenderTarget===!0?Z.texture.encoding:fp,map:!!E.map,matcap:!!E.matcap,envMap:!!q,envMapMode:q&&q.mapping,envMapCubeUVHeight:W,lightMap:!!E.lightMap,aoMap:!!E.aoMap,emissiveMap:!!E.emissiveMap,bumpMap:!!E.bumpMap,normalMap:!!E.normalMap,objectSpaceNormalMap:E.normalMapType===hie,tangentSpaceNormalMap:E.normalMapType===Cp,decodeVideoTexture:!!E.map&&E.map.isVideoTexture===!0&&E.map.encoding===zr,clearcoat:Se,clearcoatMap:Se&&!!E.clearcoatMap,clearcoatRoughnessMap:Se&&!!E.clearcoatRoughnessMap,clearcoatNormalMap:Se&&!!E.clearcoatNormalMap,iridescence:_e,iridescenceMap:_e&&!!E.iridescenceMap,iridescenceThicknessMap:_e&&!!E.iridescenceThicknessMap,displacementMap:!!E.displacementMap,roughnessMap:!!E.roughnessMap,metalnessMap:!!E.metalnessMap,specularMap:!!E.specularMap,specularIntensityMap:!!E.specularIntensityMap,specularColorMap:!!E.specularColorMap,opaque:E.transparent===!1&&E.blending===og,alphaMap:!!E.alphaMap,alphaTest:Ae,gradientMap:!!E.gradientMap,sheen:E.sheen>0,sheenColorMap:!!E.sheenColorMap,sheenRoughnessMap:!!E.sheenRoughnessMap,transmission:E.transmission>0,transmissionMap:!!E.transmissionMap,thicknessMap:!!E.thicknessMap,combine:E.combine,vertexTangents:!!E.normalMap&&!!L.attributes.tangent,vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!L.attributes.color&&L.attributes.color.itemSize===4,vertexUvs:!!E.map||!!E.bumpMap||!!E.normalMap||!!E.specularMap||!!E.alphaMap||!!E.emissiveMap||!!E.roughnessMap||!!E.metalnessMap||!!E.clearcoatMap||!!E.clearcoatRoughnessMap||!!E.clearcoatNormalMap||!!E.iridescenceMap||!!E.iridescenceThicknessMap||!!E.displacementMap||!!E.transmissionMap||!!E.thicknessMap||!!E.specularIntensityMap||!!E.specularColorMap||!!E.sheenColorMap||!!E.sheenRoughnessMap,uvsVertexOnly:!(E.map||E.bumpMap||E.normalMap||E.specularMap||E.alphaMap||E.emissiveMap||E.roughnessMap||E.metalnessMap||E.clearcoatNormalMap||E.iridescenceMap||E.iridescenceThicknessMap||E.transmission>0||E.transmissionMap||E.thicknessMap||E.specularIntensityMap||E.specularColorMap||E.sheen>0||E.sheenColorMap||E.sheenRoughnessMap)&&!!E.displacementMap,fog:!!O,useFog:E.fog===!0,fogExp2:O&&O.isFogExp2,flatShading:!!E.flatShading,sizeAttenuation:E.sizeAttenuation,logarithmicDepthBuffer:u,skinning:B.isSkinnedMesh===!0,morphTargets:L.morphAttributes.position!==void 0,morphNormals:L.morphAttributes.normal!==void 0,morphColors:L.morphAttributes.color!==void 0,morphTargetsCount:U,morphTextureStride:X,numDirLights:T.directional.length,numPointLights:T.point.length,numSpotLights:T.spot.length,numSpotLightMaps:T.spotLightMap.length,numRectAreaLights:T.rectArea.length,numHemiLights:T.hemi.length,numDirLightShadows:T.directionalShadowMap.length,numPointLightShadows:T.pointShadowMap.length,numSpotLightShadows:T.spotShadowMap.length,numSpotLightShadowsWithMaps:T.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:E.dithering,shadowMapEnabled:t.shadowMap.enabled&&C.length>0,shadowMapType:t.shadowMap.type,toneMapping:E.toneMapped?t.toneMapping:Pc,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===_c,flipSided:E.side===Go,useDepthPacking:!!E.depthPacking,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionDerivatives:E.extensions&&E.extensions.derivatives,extensionFragDepth:E.extensions&&E.extensions.fragDepth,extensionDrawBuffers:E.extensions&&E.extensions.drawBuffers,extensionShaderTextureLOD:E.extensions&&E.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||r.has("EXT_shader_texture_lod"),customProgramCacheKey:E.customProgramCacheKey()}}function g(E){const T=[];if(E.shaderID?T.push(E.shaderID):(T.push(E.customVertexShaderID),T.push(E.customFragmentShaderID)),E.defines!==void 0)for(const C in E.defines)T.push(C),T.push(E.defines[C]);return E.isRawShaderMaterial===!1&&(v(T,E),y(T,E),T.push(t.outputEncoding)),T.push(E.customProgramCacheKey),T.join()}function v(E,T){E.push(T.precision),E.push(T.outputEncoding),E.push(T.envMapMode),E.push(T.envMapCubeUVHeight),E.push(T.combine),E.push(T.vertexUvs),E.push(T.fogExp2),E.push(T.sizeAttenuation),E.push(T.morphTargetsCount),E.push(T.morphAttributeCount),E.push(T.numDirLights),E.push(T.numPointLights),E.push(T.numSpotLights),E.push(T.numSpotLightMaps),E.push(T.numHemiLights),E.push(T.numRectAreaLights),E.push(T.numDirLightShadows),E.push(T.numPointLightShadows),E.push(T.numSpotLightShadows),E.push(T.numSpotLightShadowsWithMaps),E.push(T.shadowMapType),E.push(T.toneMapping),E.push(T.numClippingPlanes),E.push(T.numClipIntersection),E.push(T.depthPacking)}function y(E,T){o.disableAll(),T.isWebGL2&&o.enable(0),T.supportsVertexTextures&&o.enable(1),T.instancing&&o.enable(2),T.instancingColor&&o.enable(3),T.map&&o.enable(4),T.matcap&&o.enable(5),T.envMap&&o.enable(6),T.lightMap&&o.enable(7),T.aoMap&&o.enable(8),T.emissiveMap&&o.enable(9),T.bumpMap&&o.enable(10),T.normalMap&&o.enable(11),T.objectSpaceNormalMap&&o.enable(12),T.tangentSpaceNormalMap&&o.enable(13),T.clearcoat&&o.enable(14),T.clearcoatMap&&o.enable(15),T.clearcoatRoughnessMap&&o.enable(16),T.clearcoatNormalMap&&o.enable(17),T.iridescence&&o.enable(18),T.iridescenceMap&&o.enable(19),T.iridescenceThicknessMap&&o.enable(20),T.displacementMap&&o.enable(21),T.specularMap&&o.enable(22),T.roughnessMap&&o.enable(23),T.metalnessMap&&o.enable(24),T.gradientMap&&o.enable(25),T.alphaMap&&o.enable(26),T.alphaTest&&o.enable(27),T.vertexColors&&o.enable(28),T.vertexAlphas&&o.enable(29),T.vertexUvs&&o.enable(30),T.vertexTangents&&o.enable(31),T.uvsVertexOnly&&o.enable(32),E.push(o.mask),o.disableAll(),T.fog&&o.enable(0),T.useFog&&o.enable(1),T.flatShading&&o.enable(2),T.logarithmicDepthBuffer&&o.enable(3),T.skinning&&o.enable(4),T.morphTargets&&o.enable(5),T.morphNormals&&o.enable(6),T.morphColors&&o.enable(7),T.premultipliedAlpha&&o.enable(8),T.shadowMapEnabled&&o.enable(9),T.physicallyCorrectLights&&o.enable(10),T.doubleSided&&o.enable(11),T.flipSided&&o.enable(12),T.useDepthPacking&&o.enable(13),T.dithering&&o.enable(14),T.specularIntensityMap&&o.enable(15),T.specularColorMap&&o.enable(16),T.transmission&&o.enable(17),T.transmissionMap&&o.enable(18),T.thicknessMap&&o.enable(19),T.sheen&&o.enable(20),T.sheenColorMap&&o.enable(21),T.sheenRoughnessMap&&o.enable(22),T.decodeVideoTexture&&o.enable(23),T.opaque&&o.enable(24),E.push(o.mask)}function x(E){const T=p[E.type];let C;if(T){const D=bc[T];C=mie.clone(D.uniforms)}else C=E.uniforms;return C}function S(E,T){let C;for(let D=0,B=c.length;D<B;D++){const O=c[D];if(O.cacheKey===T){C=O,++C.usedTimes;break}}return C===void 0&&(C=new tbe(t,T,E,s),c.push(C)),C}function A(E){if(--E.usedTimes===0){const T=c.indexOf(E);c[T]=c[c.length-1],c.pop(),E.destroy()}}function _(E){l.remove(E)}function M(){l.dispose()}return{getParameters:m,getProgramCacheKey:g,getUniforms:x,acquireProgram:S,releaseProgram:A,releaseShaderCache:_,programs:c,dispose:M}}function abe(){let t=new WeakMap;function e(s){let a=t.get(s);return a===void 0&&(a={},t.set(s,a)),a}function i(s){t.delete(s)}function r(s,a,o){t.get(s)[a]=o}function n(){t=new WeakMap}return{get:e,remove:i,update:r,dispose:n}}function obe(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Aj(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Ej(){const t=[];let e=0;const i=[],r=[],n=[];function s(){e=0,i.length=0,r.length=0,n.length=0}function a(u,d,f,p,m,g){let v=t[e];return v===void 0?(v={id:u.id,object:u,geometry:d,material:f,groupOrder:p,renderOrder:u.renderOrder,z:m,group:g},t[e]=v):(v.id=u.id,v.object=u,v.geometry=d,v.material=f,v.groupOrder=p,v.renderOrder=u.renderOrder,v.z=m,v.group=g),e++,v}function o(u,d,f,p,m,g){const v=a(u,d,f,p,m,g);f.transmission>0?r.push(v):f.transparent===!0?n.push(v):i.push(v)}function l(u,d,f,p,m,g){const v=a(u,d,f,p,m,g);f.transmission>0?r.unshift(v):f.transparent===!0?n.unshift(v):i.unshift(v)}function c(u,d){i.length>1&&i.sort(u||obe),r.length>1&&r.sort(d||Aj),n.length>1&&n.sort(d||Aj)}function h(){for(let u=e,d=t.length;u<d;u++){const f=t[u];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:h,sort:c}}function lbe(){let t=new WeakMap;function e(r,n){const s=t.get(r);let a;return s===void 0?(a=new Ej,t.set(r,[a])):n>=s.length?(a=new Ej,s.push(a)):a=s[n],a}function i(){t=new WeakMap}return{get:e,dispose:i}}function cbe(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new le,color:new Ct};break;case"SpotLight":i={position:new le,direction:new le,color:new Ct,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new le,color:new Ct,distance:0,decay:0};break;case"HemisphereLight":i={direction:new le,skyColor:new Ct,groundColor:new Ct};break;case"RectAreaLight":i={color:new Ct,position:new le,halfWidth:new le,halfHeight:new le};break}return t[e.id]=i,i}}}function hbe(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new tt};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new tt};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new tt,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=i,i}}}let ube=0;function dbe(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function fbe(t,e){const i=new cbe,r=hbe(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let h=0;h<9;h++)n.probe.push(new le);const s=new le,a=new ui,o=new ui;function l(h,u){let d=0,f=0,p=0;for(let D=0;D<9;D++)n.probe[D].set(0,0,0);let m=0,g=0,v=0,y=0,x=0,S=0,A=0,_=0,M=0,E=0;h.sort(dbe);const T=u!==!0?Math.PI:1;for(let D=0,B=h.length;D<B;D++){const O=h[D],L=O.color,H=O.intensity,q=O.distance,W=O.shadow&&O.shadow.map?O.shadow.map.texture:null;if(O.isAmbientLight)d+=L.r*H*T,f+=L.g*H*T,p+=L.b*H*T;else if(O.isLightProbe)for(let I=0;I<9;I++)n.probe[I].addScaledVector(O.sh.coefficients[I],H);else if(O.isDirectionalLight){const I=i.get(O);if(I.color.copy(O.color).multiplyScalar(O.intensity*T),O.castShadow){const z=O.shadow,U=r.get(O);U.shadowBias=z.bias,U.shadowNormalBias=z.normalBias,U.shadowRadius=z.radius,U.shadowMapSize=z.mapSize,n.directionalShadow[m]=U,n.directionalShadowMap[m]=W,n.directionalShadowMatrix[m]=O.shadow.matrix,S++}n.directional[m]=I,m++}else if(O.isSpotLight){const I=i.get(O);I.position.setFromMatrixPosition(O.matrixWorld),I.color.copy(L).multiplyScalar(H*T),I.distance=q,I.coneCos=Math.cos(O.angle),I.penumbraCos=Math.cos(O.angle*(1-O.penumbra)),I.decay=O.decay,n.spot[v]=I;const z=O.shadow;if(O.map&&(n.spotLightMap[M]=O.map,M++,z.updateMatrices(O),O.castShadow&&E++),n.spotLightMatrix[v]=z.matrix,O.castShadow){const U=r.get(O);U.shadowBias=z.bias,U.shadowNormalBias=z.normalBias,U.shadowRadius=z.radius,U.shadowMapSize=z.mapSize,n.spotShadow[v]=U,n.spotShadowMap[v]=W,_++}v++}else if(O.isRectAreaLight){const I=i.get(O);I.color.copy(L).multiplyScalar(H),I.halfWidth.set(O.width*.5,0,0),I.halfHeight.set(0,O.height*.5,0),n.rectArea[y]=I,y++}else if(O.isPointLight){const I=i.get(O);if(I.color.copy(O.color).multiplyScalar(O.intensity*T),I.distance=O.distance,I.decay=O.decay,O.castShadow){const z=O.shadow,U=r.get(O);U.shadowBias=z.bias,U.shadowNormalBias=z.normalBias,U.shadowRadius=z.radius,U.shadowMapSize=z.mapSize,U.shadowCameraNear=z.camera.near,U.shadowCameraFar=z.camera.far,n.pointShadow[g]=U,n.pointShadowMap[g]=W,n.pointShadowMatrix[g]=O.shadow.matrix,A++}n.point[g]=I,g++}else if(O.isHemisphereLight){const I=i.get(O);I.skyColor.copy(O.color).multiplyScalar(H*T),I.groundColor.copy(O.groundColor).multiplyScalar(H*T),n.hemi[x]=I,x++}}y>0&&(e.isWebGL2||t.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=St.LTC_FLOAT_1,n.rectAreaLTC2=St.LTC_FLOAT_2):t.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=St.LTC_HALF_1,n.rectAreaLTC2=St.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=f,n.ambient[2]=p;const C=n.hash;(C.directionalLength!==m||C.pointLength!==g||C.spotLength!==v||C.rectAreaLength!==y||C.hemiLength!==x||C.numDirectionalShadows!==S||C.numPointShadows!==A||C.numSpotShadows!==_||C.numSpotMaps!==M)&&(n.directional.length=m,n.spot.length=v,n.rectArea.length=y,n.point.length=g,n.hemi.length=x,n.directionalShadow.length=S,n.directionalShadowMap.length=S,n.pointShadow.length=A,n.pointShadowMap.length=A,n.spotShadow.length=_,n.spotShadowMap.length=_,n.directionalShadowMatrix.length=S,n.pointShadowMatrix.length=A,n.spotLightMatrix.length=_+M-E,n.spotLightMap.length=M,n.numSpotLightShadowsWithMaps=E,C.directionalLength=m,C.pointLength=g,C.spotLength=v,C.rectAreaLength=y,C.hemiLength=x,C.numDirectionalShadows=S,C.numPointShadows=A,C.numSpotShadows=_,C.numSpotMaps=M,n.version=ube++)}function c(h,u){let d=0,f=0,p=0,m=0,g=0;const v=u.matrixWorldInverse;for(let y=0,x=h.length;y<x;y++){const S=h[y];if(S.isDirectionalLight){const A=n.directional[d];A.direction.setFromMatrixPosition(S.matrixWorld),s.setFromMatrixPosition(S.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(v),d++}else if(S.isSpotLight){const A=n.spot[p];A.position.setFromMatrixPosition(S.matrixWorld),A.position.applyMatrix4(v),A.direction.setFromMatrixPosition(S.matrixWorld),s.setFromMatrixPosition(S.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(v),p++}else if(S.isRectAreaLight){const A=n.rectArea[m];A.position.setFromMatrixPosition(S.matrixWorld),A.position.applyMatrix4(v),o.identity(),a.copy(S.matrixWorld),a.premultiply(v),o.extractRotation(a),A.halfWidth.set(S.width*.5,0,0),A.halfHeight.set(0,S.height*.5,0),A.halfWidth.applyMatrix4(o),A.halfHeight.applyMatrix4(o),m++}else if(S.isPointLight){const A=n.point[f];A.position.setFromMatrixPosition(S.matrixWorld),A.position.applyMatrix4(v),f++}else if(S.isHemisphereLight){const A=n.hemi[g];A.direction.setFromMatrixPosition(S.matrixWorld),A.direction.transformDirection(v),g++}}}return{setup:l,setupView:c,state:n}}function Mj(t,e){const i=new fbe(t,e),r=[],n=[];function s(){r.length=0,n.length=0}function a(u){r.push(u)}function o(u){n.push(u)}function l(u){i.setup(r,u)}function c(u){i.setupView(r,u)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:c,pushLight:a,pushShadow:o}}function pbe(t,e){let i=new WeakMap;function r(s,a=0){const o=i.get(s);let l;return o===void 0?(l=new Mj(t,e),i.set(s,[l])):a>=o.length?(l=new Mj(t,e),o.push(l)):l=o[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}class M4 extends kn{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=lie,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class T4 extends kn{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new le,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const mbe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,gbe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function vbe(t,e,i){let r=new sD;const n=new tt,s=new tt,a=new rr,o=new M4({depthPacking:cie}),l=new T4,c={},h=i.maxTextureSize,u={0:Go,1:cp,2:_c},d=new zh({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new tt},radius:{value:4}},vertexShader:mbe,fragmentShader:gbe}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new xi;p.setAttribute("position",new Xi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Ms(p,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=eD,this.render=function(S,A,_){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||S.length===0)return;const M=t.getRenderTarget(),E=t.getActiveCubeFace(),T=t.getActiveMipmapLevel(),C=t.state;C.setBlending(td),C.buffers.color.setClear(1,1,1,1),C.buffers.depth.setTest(!0),C.setScissorTest(!1);for(let D=0,B=S.length;D<B;D++){const O=S[D],L=O.shadow;if(L===void 0){console.warn("THREE.WebGLShadowMap:",O,"has no shadow.");continue}if(L.autoUpdate===!1&&L.needsUpdate===!1)continue;n.copy(L.mapSize);const H=L.getFrameExtents();if(n.multiply(H),s.copy(L.mapSize),(n.x>h||n.y>h)&&(n.x>h&&(s.x=Math.floor(h/H.x),n.x=s.x*H.x,L.mapSize.x=s.x),n.y>h&&(s.y=Math.floor(h/H.y),n.y=s.y*H.y,L.mapSize.y=s.y)),L.map===null){const W=this.type!==zm?{minFilter:xn,magFilter:xn}:{};L.map=new Hl(n.x,n.y,W),L.map.texture.name=O.name+".shadowMap",L.camera.updateProjectionMatrix()}t.setRenderTarget(L.map),t.clear();const q=L.getViewportCount();for(let W=0;W<q;W++){const I=L.getViewport(W);a.set(s.x*I.x,s.y*I.y,s.x*I.z,s.y*I.w),C.viewport(a),L.updateMatrices(O,W),r=L.getFrustum(),x(A,_,L.camera,O,this.type)}L.isPointLightShadow!==!0&&this.type===zm&&v(L,_),L.needsUpdate=!1}g.needsUpdate=!1,t.setRenderTarget(M,E,T)};function v(S,A){const _=e.update(m);d.defines.VSM_SAMPLES!==S.blurSamples&&(d.defines.VSM_SAMPLES=S.blurSamples,f.defines.VSM_SAMPLES=S.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),S.mapPass===null&&(S.mapPass=new Hl(n.x,n.y)),d.uniforms.shadow_pass.value=S.map.texture,d.uniforms.resolution.value=S.mapSize,d.uniforms.radius.value=S.radius,t.setRenderTarget(S.mapPass),t.clear(),t.renderBufferDirect(A,null,_,d,m,null),f.uniforms.shadow_pass.value=S.mapPass.texture,f.uniforms.resolution.value=S.mapSize,f.uniforms.radius.value=S.radius,t.setRenderTarget(S.map),t.clear(),t.renderBufferDirect(A,null,_,f,m,null)}function y(S,A,_,M,E,T){let C=null;const D=_.isPointLight===!0?S.customDistanceMaterial:S.customDepthMaterial;if(D!==void 0?C=D:C=_.isPointLight===!0?l:o,t.localClippingEnabled&&A.clipShadows===!0&&Array.isArray(A.clippingPlanes)&&A.clippingPlanes.length!==0||A.displacementMap&&A.displacementScale!==0||A.alphaMap&&A.alphaTest>0){const B=C.uuid,O=A.uuid;let L=c[B];L===void 0&&(L={},c[B]=L);let H=L[O];H===void 0&&(H=C.clone(),L[O]=H),C=H}return C.visible=A.visible,C.wireframe=A.wireframe,T===zm?C.side=A.shadowSide!==null?A.shadowSide:A.side:C.side=A.shadowSide!==null?A.shadowSide:u[A.side],C.alphaMap=A.alphaMap,C.alphaTest=A.alphaTest,C.clipShadows=A.clipShadows,C.clippingPlanes=A.clippingPlanes,C.clipIntersection=A.clipIntersection,C.displacementMap=A.displacementMap,C.displacementScale=A.displacementScale,C.displacementBias=A.displacementBias,C.wireframeLinewidth=A.wireframeLinewidth,C.linewidth=A.linewidth,_.isPointLight===!0&&C.isMeshDistanceMaterial===!0&&(C.referencePosition.setFromMatrixPosition(_.matrixWorld),C.nearDistance=M,C.farDistance=E),C}function x(S,A,_,M,E){if(S.visible===!1)return;if(S.layers.test(A.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&E===zm)&&(!S.frustumCulled||r.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(_.matrixWorldInverse,S.matrixWorld);const D=e.update(S),B=S.material;if(Array.isArray(B)){const O=D.groups;for(let L=0,H=O.length;L<H;L++){const q=O[L],W=B[q.materialIndex];if(W&&W.visible){const I=y(S,W,M,_.near,_.far,E);t.renderBufferDirect(_,null,D,I,S,q)}}}else if(B.visible){const O=y(S,B,M,_.near,_.far,E);t.renderBufferDirect(_,null,D,O,S,null)}}const C=S.children;for(let D=0,B=C.length;D<B;D++)x(C[D],A,_,M,E)}}function ybe(t,e,i){const r=i.isWebGL2;function n(){let J=!1;const he=new rr;let Me=null;const Ue=new rr(0,0,0,0);return{setMask:function(at){Me!==at&&!J&&(t.colorMask(at,at,at,at),Me=at)},setLocked:function(at){J=at},setClear:function(at,Mt,Qt,ci,ur){ur===!0&&(at*=ci,Mt*=ci,Qt*=ci),he.set(at,Mt,Qt,ci),Ue.equals(he)===!1&&(t.clearColor(at,Mt,Qt,ci),Ue.copy(he))},reset:function(){J=!1,Me=null,Ue.set(-1,0,0,0)}}}function s(){let J=!1,he=null,Me=null,Ue=null;return{setTest:function(at){at?Ae(2929):Se(2929)},setMask:function(at){he!==at&&!J&&(t.depthMask(at),he=at)},setFunc:function(at){if(Me!==at){switch(at){case Dte:t.depthFunc(512);break;case Rte:t.depthFunc(519);break;case Ite:t.depthFunc(513);break;case i2:t.depthFunc(515);break;case Lte:t.depthFunc(514);break;case Ote:t.depthFunc(518);break;case Bte:t.depthFunc(516);break;case Fte:t.depthFunc(517);break;default:t.depthFunc(515)}Me=at}},setLocked:function(at){J=at},setClear:function(at){Ue!==at&&(t.clearDepth(at),Ue=at)},reset:function(){J=!1,he=null,Me=null,Ue=null}}}function a(){let J=!1,he=null,Me=null,Ue=null,at=null,Mt=null,Qt=null,ci=null,ur=null;return{setTest:function(Gt){J||(Gt?Ae(2960):Se(2960))},setMask:function(Gt){he!==Gt&&!J&&(t.stencilMask(Gt),he=Gt)},setFunc:function(Gt,Qi,Bi){(Me!==Gt||Ue!==Qi||at!==Bi)&&(t.stencilFunc(Gt,Qi,Bi),Me=Gt,Ue=Qi,at=Bi)},setOp:function(Gt,Qi,Bi){(Mt!==Gt||Qt!==Qi||ci!==Bi)&&(t.stencilOp(Gt,Qi,Bi),Mt=Gt,Qt=Qi,ci=Bi)},setLocked:function(Gt){J=Gt},setClear:function(Gt){ur!==Gt&&(t.clearStencil(Gt),ur=Gt)},reset:function(){J=!1,he=null,Me=null,Ue=null,at=null,Mt=null,Qt=null,ci=null,ur=null}}}const o=new n,l=new s,c=new a,h=new WeakMap,u=new WeakMap;let d={},f={},p=new WeakMap,m=[],g=null,v=!1,y=null,x=null,S=null,A=null,_=null,M=null,E=null,T=!1,C=null,D=null,B=null,O=null,L=null;const H=t.getParameter(35661);let q=!1,W=0;const I=t.getParameter(7938);I.indexOf("WebGL")!==-1?(W=parseFloat(/^WebGL (\d)/.exec(I)[1]),q=W>=1):I.indexOf("OpenGL ES")!==-1&&(W=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),q=W>=2);let z=null,U={};const X=t.getParameter(3088),Q=t.getParameter(2978),re=new rr().fromArray(X),ie=new rr().fromArray(Q);function ce(J,he,Me){const Ue=new Uint8Array(4),at=t.createTexture();t.bindTexture(J,at),t.texParameteri(J,10241,9728),t.texParameteri(J,10240,9728);for(let Mt=0;Mt<Me;Mt++)t.texImage2D(he+Mt,0,6408,1,1,0,6408,5121,Ue);return at}const Z={};Z[3553]=ce(3553,3553,1),Z[34067]=ce(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),Ae(2929),l.setFunc(i2),Ge(!1),Ke(_F),Ae(2884),Ie(td);function Ae(J){d[J]!==!0&&(t.enable(J),d[J]=!0)}function Se(J){d[J]!==!1&&(t.disable(J),d[J]=!1)}function _e(J,he){return f[J]!==he?(t.bindFramebuffer(J,he),f[J]=he,r&&(J===36009&&(f[36160]=he),J===36160&&(f[36009]=he)),!0):!1}function ve(J,he){let Me=m,Ue=!1;if(J)if(Me=p.get(he),Me===void 0&&(Me=[],p.set(he,Me)),J.isWebGLMultipleRenderTargets){const at=J.texture;if(Me.length!==at.length||Me[0]!==36064){for(let Mt=0,Qt=at.length;Mt<Qt;Mt++)Me[Mt]=36064+Mt;Me.length=at.length,Ue=!0}}else Me[0]!==36064&&(Me[0]=36064,Ue=!0);else Me[0]!==1029&&(Me[0]=1029,Ue=!0);Ue&&(i.isWebGL2?t.drawBuffers(Me):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Me))}function Ee(J){return g!==J?(t.useProgram(J),g=J,!0):!1}const fe={[Pm]:32774,[xte]:32778,[bte]:32779};if(r)fe[TF]=32775,fe[CF]=32776;else{const J=e.get("EXT_blend_minmax");J!==null&&(fe[TF]=J.MIN_EXT,fe[CF]=J.MAX_EXT)}const pe={[wte]:0,[Ste]:1,[_te]:768,[d4]:770,[Pte]:776,[Tte]:774,[Ete]:772,[Ate]:769,[f4]:771,[Cte]:775,[Mte]:773};function Ie(J,he,Me,Ue,at,Mt,Qt,ci){if(J===td){v===!0&&(Se(3042),v=!1);return}if(v===!1&&(Ae(3042),v=!0),J!==yte){if(J!==y||ci!==T){if((x!==Pm||_!==Pm)&&(t.blendEquation(32774),x=Pm,_=Pm),ci)switch(J){case og:t.blendFuncSeparate(1,771,1,771);break;case AF:t.blendFunc(1,1);break;case EF:t.blendFuncSeparate(0,769,0,1);break;case MF:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}else switch(J){case og:t.blendFuncSeparate(770,771,1,771);break;case AF:t.blendFunc(770,1);break;case EF:t.blendFuncSeparate(0,769,0,1);break;case MF:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}S=null,A=null,M=null,E=null,y=J,T=ci}return}at=at||he,Mt=Mt||Me,Qt=Qt||Ue,(he!==x||at!==_)&&(t.blendEquationSeparate(fe[he],fe[at]),x=he,_=at),(Me!==S||Ue!==A||Mt!==M||Qt!==E)&&(t.blendFuncSeparate(pe[Me],pe[Ue],pe[Mt],pe[Qt]),S=Me,A=Ue,M=Mt,E=Qt),y=J,T=null}function Le(J,he){J.side===_c?Se(2884):Ae(2884);let Me=J.side===Go;he&&(Me=!Me),Ge(Me),J.blending===og&&J.transparent===!1?Ie(td):Ie(J.blending,J.blendEquation,J.blendSrc,J.blendDst,J.blendEquationAlpha,J.blendSrcAlpha,J.blendDstAlpha,J.premultipliedAlpha),l.setFunc(J.depthFunc),l.setTest(J.depthTest),l.setMask(J.depthWrite),o.setMask(J.colorWrite);const Ue=J.stencilWrite;c.setTest(Ue),Ue&&(c.setMask(J.stencilWriteMask),c.setFunc(J.stencilFunc,J.stencilRef,J.stencilFuncMask),c.setOp(J.stencilFail,J.stencilZFail,J.stencilZPass)),ke(J.polygonOffset,J.polygonOffsetFactor,J.polygonOffsetUnits),J.alphaToCoverage===!0?Ae(32926):Se(32926)}function Ge(J){C!==J&&(J?t.frontFace(2304):t.frontFace(2305),C=J)}function Ke(J){J!==mte?(Ae(2884),J!==D&&(J===_F?t.cullFace(1029):J===gte?t.cullFace(1028):t.cullFace(1032))):Se(2884),D=J}function Ve(J){J!==B&&(q&&t.lineWidth(J),B=J)}function ke(J,he,Me){J?(Ae(32823),(O!==he||L!==Me)&&(t.polygonOffset(he,Me),O=he,L=Me)):Se(32823)}function ut(J){J?Ae(3089):Se(3089)}function dt(J){J===void 0&&(J=33984+H-1),z!==J&&(t.activeTexture(J),z=J)}function V(J,he,Me){Me===void 0&&(z===null?Me=33984+H-1:Me=z);let Ue=U[Me];Ue===void 0&&(Ue={type:void 0,texture:void 0},U[Me]=Ue),(Ue.type!==J||Ue.texture!==he)&&(z!==Me&&(t.activeTexture(Me),z=Me),t.bindTexture(J,he||Z[J]),Ue.type=J,Ue.texture=he)}function F(){const J=U[z];J!==void 0&&J.type!==void 0&&(t.bindTexture(J.type,null),J.type=void 0,J.texture=void 0)}function oe(){try{t.compressedTexImage2D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ce(){try{t.compressedTexImage3D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function K(){try{t.texSubImage2D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Re(){try{t.texSubImage3D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ze(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ne(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function me(){try{t.texStorage2D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function $e(){try{t.texStorage3D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Qe(){try{t.texImage2D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Je(){try{t.texImage3D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function ot(J){re.equals(J)===!1&&(t.scissor(J.x,J.y,J.z,J.w),re.copy(J))}function nt(J){ie.equals(J)===!1&&(t.viewport(J.x,J.y,J.z,J.w),ie.copy(J))}function de(J,he){let Me=u.get(he);Me===void 0&&(Me=new WeakMap,u.set(he,Me));let Ue=Me.get(J);Ue===void 0&&(Ue=t.getUniformBlockIndex(he,J.name),Me.set(J,Ue))}function Xe(J,he){const Ue=u.get(he).get(J);h.get(J)!==Ue&&(t.uniformBlockBinding(he,Ue,J.__bindingPointIndex),h.set(J,Ue))}function mt(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),r===!0&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),d={},z=null,U={},f={},p=new WeakMap,m=[],g=null,v=!1,y=null,x=null,S=null,A=null,_=null,M=null,E=null,T=!1,C=null,D=null,B=null,O=null,L=null,re.set(0,0,t.canvas.width,t.canvas.height),ie.set(0,0,t.canvas.width,t.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:Ae,disable:Se,bindFramebuffer:_e,drawBuffers:ve,useProgram:Ee,setBlending:Ie,setMaterial:Le,setFlipSided:Ge,setCullFace:Ke,setLineWidth:Ve,setPolygonOffset:ke,setScissorTest:ut,activeTexture:dt,bindTexture:V,unbindTexture:F,compressedTexImage2D:oe,compressedTexImage3D:Ce,texImage2D:Qe,texImage3D:Je,updateUBOMapping:de,uniformBlockBinding:Xe,texStorage2D:me,texStorage3D:$e,texSubImage2D:K,texSubImage3D:Re,compressedTexSubImage2D:Ze,compressedTexSubImage3D:Ne,scissor:ot,viewport:nt,reset:mt}}function xbe(t,e,i,r,n,s,a){const o=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,h=n.maxTextureSize,u=n.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=/OculusBrowser/g.test(typeof navigator>"u"?"":navigator.userAgent),p=new WeakMap;let m;const g=new WeakMap;let v=!1;try{v=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(V,F){return v?new OffscreenCanvas(V,F):iS("canvas")}function x(V,F,oe,Ce){let K=1;if((V.width>Ce||V.height>Ce)&&(K=Ce/Math.max(V.width,V.height)),K<1||F===!0)if(typeof HTMLImageElement<"u"&&V instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&V instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&V instanceof ImageBitmap){const Re=F?s2:Math.floor,Ze=Re(K*V.width),Ne=Re(K*V.height);m===void 0&&(m=y(Ze,Ne));const me=oe?y(Ze,Ne):m;return me.width=Ze,me.height=Ne,me.getContext("2d").drawImage(V,0,0,Ze,Ne),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+V.width+"x"+V.height+") to ("+Ze+"x"+Ne+")."),me}else return"data"in V&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+V.width+"x"+V.height+")."),V;return V}function S(V){return $F(V.width)&&$F(V.height)}function A(V){return o?!1:V.wrapS!==js||V.wrapT!==js||V.minFilter!==xn&&V.minFilter!==Hr}function _(V,F){return V.generateMipmaps&&F&&V.minFilter!==xn&&V.minFilter!==Hr}function M(V){t.generateMipmap(V)}function E(V,F,oe,Ce,K=!1){if(o===!1)return F;if(V!==null){if(t[V]!==void 0)return t[V];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+V+"'")}let Re=F;return F===6403&&(oe===5126&&(Re=33326),oe===5131&&(Re=33325),oe===5121&&(Re=33321)),F===33319&&(oe===5126&&(Re=33328),oe===5131&&(Re=33327),oe===5121&&(Re=33323)),F===6408&&(oe===5126&&(Re=34836),oe===5131&&(Re=34842),oe===5121&&(Re=Ce===zr&&K===!1?35907:32856),oe===32819&&(Re=32854),oe===32820&&(Re=32855)),(Re===33325||Re===33326||Re===33327||Re===33328||Re===34842||Re===34836)&&e.get("EXT_color_buffer_float"),Re}function T(V,F,oe){return _(V,oe)===!0||V.isFramebufferTexture&&V.minFilter!==xn&&V.minFilter!==Hr?Math.log2(Math.max(F.width,F.height))+1:V.mipmaps!==void 0&&V.mipmaps.length>0?V.mipmaps.length:V.isCompressedTexture&&Array.isArray(V.image)?F.mipmaps.length:1}function C(V){return V===xn||V===$w||V===Jw?9728:9729}function D(V){const F=V.target;F.removeEventListener("dispose",D),O(F),F.isVideoTexture&&p.delete(F)}function B(V){const F=V.target;F.removeEventListener("dispose",B),H(F)}function O(V){const F=r.get(V);if(F.__webglInit===void 0)return;const oe=V.source,Ce=g.get(oe);if(Ce){const K=Ce[F.__cacheKey];K.usedTimes--,K.usedTimes===0&&L(V),Object.keys(Ce).length===0&&g.delete(oe)}r.remove(V)}function L(V){const F=r.get(V);t.deleteTexture(F.__webglTexture);const oe=V.source,Ce=g.get(oe);delete Ce[F.__cacheKey],a.memory.textures--}function H(V){const F=V.texture,oe=r.get(V),Ce=r.get(F);if(Ce.__webglTexture!==void 0&&(t.deleteTexture(Ce.__webglTexture),a.memory.textures--),V.depthTexture&&V.depthTexture.dispose(),V.isWebGLCubeRenderTarget)for(let K=0;K<6;K++)t.deleteFramebuffer(oe.__webglFramebuffer[K]),oe.__webglDepthbuffer&&t.deleteRenderbuffer(oe.__webglDepthbuffer[K]);else{if(t.deleteFramebuffer(oe.__webglFramebuffer),oe.__webglDepthbuffer&&t.deleteRenderbuffer(oe.__webglDepthbuffer),oe.__webglMultisampledFramebuffer&&t.deleteFramebuffer(oe.__webglMultisampledFramebuffer),oe.__webglColorRenderbuffer)for(let K=0;K<oe.__webglColorRenderbuffer.length;K++)oe.__webglColorRenderbuffer[K]&&t.deleteRenderbuffer(oe.__webglColorRenderbuffer[K]);oe.__webglDepthRenderbuffer&&t.deleteRenderbuffer(oe.__webglDepthRenderbuffer)}if(V.isWebGLMultipleRenderTargets)for(let K=0,Re=F.length;K<Re;K++){const Ze=r.get(F[K]);Ze.__webglTexture&&(t.deleteTexture(Ze.__webglTexture),a.memory.textures--),r.remove(F[K])}r.remove(F),r.remove(V)}let q=0;function W(){q=0}function I(){const V=q;return V>=l&&console.warn("THREE.WebGLTextures: Trying to use "+V+" texture units while this GPU supports only "+l),q+=1,V}function z(V){const F=[];return F.push(V.wrapS),F.push(V.wrapT),F.push(V.wrapR||0),F.push(V.magFilter),F.push(V.minFilter),F.push(V.anisotropy),F.push(V.internalFormat),F.push(V.format),F.push(V.type),F.push(V.generateMipmaps),F.push(V.premultiplyAlpha),F.push(V.flipY),F.push(V.unpackAlignment),F.push(V.encoding),F.join()}function U(V,F){const oe=r.get(V);if(V.isVideoTexture&&ut(V),V.isRenderTargetTexture===!1&&V.version>0&&oe.__version!==V.version){const Ce=V.image;if(Ce===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ce.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Se(oe,V,F);return}}i.bindTexture(3553,oe.__webglTexture,33984+F)}function X(V,F){const oe=r.get(V);if(V.version>0&&oe.__version!==V.version){Se(oe,V,F);return}i.bindTexture(35866,oe.__webglTexture,33984+F)}function Q(V,F){const oe=r.get(V);if(V.version>0&&oe.__version!==V.version){Se(oe,V,F);return}i.bindTexture(32879,oe.__webglTexture,33984+F)}function re(V,F){const oe=r.get(V);if(V.version>0&&oe.__version!==V.version){_e(oe,V,F);return}i.bindTexture(34067,oe.__webglTexture,33984+F)}const ie={[dp]:10497,[js]:33071,[Ky]:33648},ce={[xn]:9728,[$w]:9984,[Jw]:9986,[Hr]:9729,[iD]:9985,[_d]:9987};function Z(V,F,oe){if(oe?(t.texParameteri(V,10242,ie[F.wrapS]),t.texParameteri(V,10243,ie[F.wrapT]),(V===32879||V===35866)&&t.texParameteri(V,32882,ie[F.wrapR]),t.texParameteri(V,10240,ce[F.magFilter]),t.texParameteri(V,10241,ce[F.minFilter])):(t.texParameteri(V,10242,33071),t.texParameteri(V,10243,33071),(V===32879||V===35866)&&t.texParameteri(V,32882,33071),(F.wrapS!==js||F.wrapT!==js)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(V,10240,C(F.magFilter)),t.texParameteri(V,10241,C(F.minFilter)),F.minFilter!==xn&&F.minFilter!==Hr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const Ce=e.get("EXT_texture_filter_anisotropic");if(F.type===Wu&&e.has("OES_texture_float_linear")===!1||o===!1&&F.type===Qy&&e.has("OES_texture_half_float_linear")===!1)return;(F.anisotropy>1||r.get(F).__currentAnisotropy)&&(t.texParameterf(V,Ce.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(F.anisotropy,n.getMaxAnisotropy())),r.get(F).__currentAnisotropy=F.anisotropy)}}function Ae(V,F){let oe=!1;V.__webglInit===void 0&&(V.__webglInit=!0,F.addEventListener("dispose",D));const Ce=F.source;let K=g.get(Ce);K===void 0&&(K={},g.set(Ce,K));const Re=z(F);if(Re!==V.__cacheKey){K[Re]===void 0&&(K[Re]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,oe=!0),K[Re].usedTimes++;const Ze=K[V.__cacheKey];Ze!==void 0&&(K[V.__cacheKey].usedTimes--,Ze.usedTimes===0&&L(F)),V.__cacheKey=Re,V.__webglTexture=K[Re].texture}return oe}function Se(V,F,oe){let Ce=3553;(F.isDataArrayTexture||F.isCompressedArrayTexture)&&(Ce=35866),F.isData3DTexture&&(Ce=32879);const K=Ae(V,F),Re=F.source;i.bindTexture(Ce,V.__webglTexture,33984+oe);const Ze=r.get(Re);if(Re.version!==Ze.__version||K===!0){i.activeTexture(33984+oe),t.pixelStorei(37440,F.flipY),t.pixelStorei(37441,F.premultiplyAlpha),t.pixelStorei(3317,F.unpackAlignment),t.pixelStorei(37443,0);const Ne=A(F)&&S(F.image)===!1;let me=x(F.image,Ne,!1,h);me=dt(F,me);const $e=S(me)||o,Qe=s.convert(F.format,F.encoding);let Je=s.convert(F.type),ot=E(F.internalFormat,Qe,Je,F.encoding,F.isVideoTexture);Z(Ce,F,$e);let nt;const de=F.mipmaps,Xe=o&&F.isVideoTexture!==!0,mt=Ze.__version===void 0||K===!0,J=T(F,me,$e);if(F.isDepthTexture)ot=6402,o?F.type===Wu?ot=36012:F.type===Pf?ot=33190:F.type===lg?ot=35056:ot=33189:F.type===Wu&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),F.format===Jf&&ot===6402&&F.type!==m4&&F.type!==Pf&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),F.type=Pf,Je=s.convert(F.type)),F.format===Ig&&ot===6402&&(ot=34041,F.type!==lg&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),F.type=lg,Je=s.convert(F.type))),mt&&(Xe?i.texStorage2D(3553,1,ot,me.width,me.height):i.texImage2D(3553,0,ot,me.width,me.height,0,Qe,Je,null));else if(F.isDataTexture)if(de.length>0&&$e){Xe&&mt&&i.texStorage2D(3553,J,ot,de[0].width,de[0].height);for(let he=0,Me=de.length;he<Me;he++)nt=de[he],Xe?i.texSubImage2D(3553,he,0,0,nt.width,nt.height,Qe,Je,nt.data):i.texImage2D(3553,he,ot,nt.width,nt.height,0,Qe,Je,nt.data);F.generateMipmaps=!1}else Xe?(mt&&i.texStorage2D(3553,J,ot,me.width,me.height),i.texSubImage2D(3553,0,0,0,me.width,me.height,Qe,Je,me.data)):i.texImage2D(3553,0,ot,me.width,me.height,0,Qe,Je,me.data);else if(F.isCompressedTexture)if(F.isCompressedArrayTexture){Xe&&mt&&i.texStorage3D(35866,J,ot,de[0].width,de[0].height,me.depth);for(let he=0,Me=de.length;he<Me;he++)nt=de[he],F.format!==so?Qe!==null?Xe?i.compressedTexSubImage3D(35866,he,0,0,0,nt.width,nt.height,me.depth,Qe,nt.data,0,0):i.compressedTexImage3D(35866,he,ot,nt.width,nt.height,me.depth,0,nt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Xe?i.texSubImage3D(35866,he,0,0,0,nt.width,nt.height,me.depth,Qe,Je,nt.data):i.texImage3D(35866,he,ot,nt.width,nt.height,me.depth,0,Qe,Je,nt.data)}else{Xe&&mt&&i.texStorage2D(3553,J,ot,de[0].width,de[0].height);for(let he=0,Me=de.length;he<Me;he++)nt=de[he],F.format!==so?Qe!==null?Xe?i.compressedTexSubImage2D(3553,he,0,0,nt.width,nt.height,Qe,nt.data):i.compressedTexImage2D(3553,he,ot,nt.width,nt.height,0,nt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Xe?i.texSubImage2D(3553,he,0,0,nt.width,nt.height,Qe,Je,nt.data):i.texImage2D(3553,he,ot,nt.width,nt.height,0,Qe,Je,nt.data)}else if(F.isDataArrayTexture)Xe?(mt&&i.texStorage3D(35866,J,ot,me.width,me.height,me.depth),i.texSubImage3D(35866,0,0,0,0,me.width,me.height,me.depth,Qe,Je,me.data)):i.texImage3D(35866,0,ot,me.width,me.height,me.depth,0,Qe,Je,me.data);else if(F.isData3DTexture)Xe?(mt&&i.texStorage3D(32879,J,ot,me.width,me.height,me.depth),i.texSubImage3D(32879,0,0,0,0,me.width,me.height,me.depth,Qe,Je,me.data)):i.texImage3D(32879,0,ot,me.width,me.height,me.depth,0,Qe,Je,me.data);else if(F.isFramebufferTexture){if(mt)if(Xe)i.texStorage2D(3553,J,ot,me.width,me.height);else{let he=me.width,Me=me.height;for(let Ue=0;Ue<J;Ue++)i.texImage2D(3553,Ue,ot,he,Me,0,Qe,Je,null),he>>=1,Me>>=1}}else if(de.length>0&&$e){Xe&&mt&&i.texStorage2D(3553,J,ot,de[0].width,de[0].height);for(let he=0,Me=de.length;he<Me;he++)nt=de[he],Xe?i.texSubImage2D(3553,he,0,0,Qe,Je,nt):i.texImage2D(3553,he,ot,Qe,Je,nt);F.generateMipmaps=!1}else Xe?(mt&&i.texStorage2D(3553,J,ot,me.width,me.height),i.texSubImage2D(3553,0,0,0,Qe,Je,me)):i.texImage2D(3553,0,ot,Qe,Je,me);_(F,$e)&&M(Ce),Ze.__version=Re.version,F.onUpdate&&F.onUpdate(F)}V.__version=F.version}function _e(V,F,oe){if(F.image.length!==6)return;const Ce=Ae(V,F),K=F.source;i.bindTexture(34067,V.__webglTexture,33984+oe);const Re=r.get(K);if(K.version!==Re.__version||Ce===!0){i.activeTexture(33984+oe),t.pixelStorei(37440,F.flipY),t.pixelStorei(37441,F.premultiplyAlpha),t.pixelStorei(3317,F.unpackAlignment),t.pixelStorei(37443,0);const Ze=F.isCompressedTexture||F.image[0].isCompressedTexture,Ne=F.image[0]&&F.image[0].isDataTexture,me=[];for(let he=0;he<6;he++)!Ze&&!Ne?me[he]=x(F.image[he],!1,!0,c):me[he]=Ne?F.image[he].image:F.image[he],me[he]=dt(F,me[he]);const $e=me[0],Qe=S($e)||o,Je=s.convert(F.format,F.encoding),ot=s.convert(F.type),nt=E(F.internalFormat,Je,ot,F.encoding),de=o&&F.isVideoTexture!==!0,Xe=Re.__version===void 0||Ce===!0;let mt=T(F,$e,Qe);Z(34067,F,Qe);let J;if(Ze){de&&Xe&&i.texStorage2D(34067,mt,nt,$e.width,$e.height);for(let he=0;he<6;he++){J=me[he].mipmaps;for(let Me=0;Me<J.length;Me++){const Ue=J[Me];F.format!==so?Je!==null?de?i.compressedTexSubImage2D(34069+he,Me,0,0,Ue.width,Ue.height,Je,Ue.data):i.compressedTexImage2D(34069+he,Me,nt,Ue.width,Ue.height,0,Ue.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):de?i.texSubImage2D(34069+he,Me,0,0,Ue.width,Ue.height,Je,ot,Ue.data):i.texImage2D(34069+he,Me,nt,Ue.width,Ue.height,0,Je,ot,Ue.data)}}}else{J=F.mipmaps,de&&Xe&&(J.length>0&&mt++,i.texStorage2D(34067,mt,nt,me[0].width,me[0].height));for(let he=0;he<6;he++)if(Ne){de?i.texSubImage2D(34069+he,0,0,0,me[he].width,me[he].height,Je,ot,me[he].data):i.texImage2D(34069+he,0,nt,me[he].width,me[he].height,0,Je,ot,me[he].data);for(let Me=0;Me<J.length;Me++){const at=J[Me].image[he].image;de?i.texSubImage2D(34069+he,Me+1,0,0,at.width,at.height,Je,ot,at.data):i.texImage2D(34069+he,Me+1,nt,at.width,at.height,0,Je,ot,at.data)}}else{de?i.texSubImage2D(34069+he,0,0,0,Je,ot,me[he]):i.texImage2D(34069+he,0,nt,Je,ot,me[he]);for(let Me=0;Me<J.length;Me++){const Ue=J[Me];de?i.texSubImage2D(34069+he,Me+1,0,0,Je,ot,Ue.image[he]):i.texImage2D(34069+he,Me+1,nt,Je,ot,Ue.image[he])}}}_(F,Qe)&&M(34067),Re.__version=K.version,F.onUpdate&&F.onUpdate(F)}V.__version=F.version}function ve(V,F,oe,Ce,K){const Re=s.convert(oe.format,oe.encoding),Ze=s.convert(oe.type),Ne=E(oe.internalFormat,Re,Ze,oe.encoding);r.get(F).__hasExternalTextures||(K===32879||K===35866?i.texImage3D(K,0,Ne,F.width,F.height,F.depth,0,Re,Ze,null):i.texImage2D(K,0,Ne,F.width,F.height,0,Re,Ze,null)),i.bindFramebuffer(36160,V),ke(F)?d.framebufferTexture2DMultisampleEXT(36160,Ce,K,r.get(oe).__webglTexture,0,Ve(F)):(K===3553||K>=34069&&K<=34074)&&t.framebufferTexture2D(36160,Ce,K,r.get(oe).__webglTexture,0),i.bindFramebuffer(36160,null)}function Ee(V,F,oe){if(t.bindRenderbuffer(36161,V),F.depthBuffer&&!F.stencilBuffer){let Ce=33189;if(oe||ke(F)){const K=F.depthTexture;K&&K.isDepthTexture&&(K.type===Wu?Ce=36012:K.type===Pf&&(Ce=33190));const Re=Ve(F);ke(F)?d.renderbufferStorageMultisampleEXT(36161,Re,Ce,F.width,F.height):t.renderbufferStorageMultisample(36161,Re,Ce,F.width,F.height)}else t.renderbufferStorage(36161,Ce,F.width,F.height);t.framebufferRenderbuffer(36160,36096,36161,V)}else if(F.depthBuffer&&F.stencilBuffer){const Ce=Ve(F);oe&&ke(F)===!1?t.renderbufferStorageMultisample(36161,Ce,35056,F.width,F.height):ke(F)?d.renderbufferStorageMultisampleEXT(36161,Ce,35056,F.width,F.height):t.renderbufferStorage(36161,34041,F.width,F.height),t.framebufferRenderbuffer(36160,33306,36161,V)}else{const Ce=F.isWebGLMultipleRenderTargets===!0?F.texture:[F.texture];for(let K=0;K<Ce.length;K++){const Re=Ce[K],Ze=s.convert(Re.format,Re.encoding),Ne=s.convert(Re.type),me=E(Re.internalFormat,Ze,Ne,Re.encoding),$e=Ve(F);oe&&ke(F)===!1?t.renderbufferStorageMultisample(36161,$e,me,F.width,F.height):ke(F)?d.renderbufferStorageMultisampleEXT(36161,$e,me,F.width,F.height):t.renderbufferStorage(36161,me,F.width,F.height)}}t.bindRenderbuffer(36161,null)}function fe(V,F){if(F&&F.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,V),!(F.depthTexture&&F.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(F.depthTexture).__webglTexture||F.depthTexture.image.width!==F.width||F.depthTexture.image.height!==F.height)&&(F.depthTexture.image.width=F.width,F.depthTexture.image.height=F.height,F.depthTexture.needsUpdate=!0),U(F.depthTexture,0);const Ce=r.get(F.depthTexture).__webglTexture,K=Ve(F);if(F.depthTexture.format===Jf)ke(F)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,Ce,0,K):t.framebufferTexture2D(36160,36096,3553,Ce,0);else if(F.depthTexture.format===Ig)ke(F)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,Ce,0,K):t.framebufferTexture2D(36160,33306,3553,Ce,0);else throw new Error("Unknown depthTexture format")}function pe(V){const F=r.get(V),oe=V.isWebGLCubeRenderTarget===!0;if(V.depthTexture&&!F.__autoAllocateDepthBuffer){if(oe)throw new Error("target.depthTexture not supported in Cube render targets");fe(F.__webglFramebuffer,V)}else if(oe){F.__webglDepthbuffer=[];for(let Ce=0;Ce<6;Ce++)i.bindFramebuffer(36160,F.__webglFramebuffer[Ce]),F.__webglDepthbuffer[Ce]=t.createRenderbuffer(),Ee(F.__webglDepthbuffer[Ce],V,!1)}else i.bindFramebuffer(36160,F.__webglFramebuffer),F.__webglDepthbuffer=t.createRenderbuffer(),Ee(F.__webglDepthbuffer,V,!1);i.bindFramebuffer(36160,null)}function Ie(V,F,oe){const Ce=r.get(V);F!==void 0&&ve(Ce.__webglFramebuffer,V,V.texture,36064,3553),oe!==void 0&&pe(V)}function Le(V){const F=V.texture,oe=r.get(V),Ce=r.get(F);V.addEventListener("dispose",B),V.isWebGLMultipleRenderTargets!==!0&&(Ce.__webglTexture===void 0&&(Ce.__webglTexture=t.createTexture()),Ce.__version=F.version,a.memory.textures++);const K=V.isWebGLCubeRenderTarget===!0,Re=V.isWebGLMultipleRenderTargets===!0,Ze=S(V)||o;if(K){oe.__webglFramebuffer=[];for(let Ne=0;Ne<6;Ne++)oe.__webglFramebuffer[Ne]=t.createFramebuffer()}else{if(oe.__webglFramebuffer=t.createFramebuffer(),Re)if(n.drawBuffers){const Ne=V.texture;for(let me=0,$e=Ne.length;me<$e;me++){const Qe=r.get(Ne[me]);Qe.__webglTexture===void 0&&(Qe.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&V.samples>0&&ke(V)===!1){const Ne=Re?F:[F];oe.__webglMultisampledFramebuffer=t.createFramebuffer(),oe.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,oe.__webglMultisampledFramebuffer);for(let me=0;me<Ne.length;me++){const $e=Ne[me];oe.__webglColorRenderbuffer[me]=t.createRenderbuffer(),t.bindRenderbuffer(36161,oe.__webglColorRenderbuffer[me]);const Qe=s.convert($e.format,$e.encoding),Je=s.convert($e.type),ot=E($e.internalFormat,Qe,Je,$e.encoding,V.isXRRenderTarget===!0),nt=Ve(V);t.renderbufferStorageMultisample(36161,nt,ot,V.width,V.height),t.framebufferRenderbuffer(36160,36064+me,36161,oe.__webglColorRenderbuffer[me])}t.bindRenderbuffer(36161,null),V.depthBuffer&&(oe.__webglDepthRenderbuffer=t.createRenderbuffer(),Ee(oe.__webglDepthRenderbuffer,V,!0)),i.bindFramebuffer(36160,null)}}if(K){i.bindTexture(34067,Ce.__webglTexture),Z(34067,F,Ze);for(let Ne=0;Ne<6;Ne++)ve(oe.__webglFramebuffer[Ne],V,F,36064,34069+Ne);_(F,Ze)&&M(34067),i.unbindTexture()}else if(Re){const Ne=V.texture;for(let me=0,$e=Ne.length;me<$e;me++){const Qe=Ne[me],Je=r.get(Qe);i.bindTexture(3553,Je.__webglTexture),Z(3553,Qe,Ze),ve(oe.__webglFramebuffer,V,Qe,36064+me,3553),_(Qe,Ze)&&M(3553)}i.unbindTexture()}else{let Ne=3553;(V.isWebGL3DRenderTarget||V.isWebGLArrayRenderTarget)&&(o?Ne=V.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Ne,Ce.__webglTexture),Z(Ne,F,Ze),ve(oe.__webglFramebuffer,V,F,36064,Ne),_(F,Ze)&&M(Ne),i.unbindTexture()}V.depthBuffer&&pe(V)}function Ge(V){const F=S(V)||o,oe=V.isWebGLMultipleRenderTargets===!0?V.texture:[V.texture];for(let Ce=0,K=oe.length;Ce<K;Ce++){const Re=oe[Ce];if(_(Re,F)){const Ze=V.isWebGLCubeRenderTarget?34067:3553,Ne=r.get(Re).__webglTexture;i.bindTexture(Ze,Ne),M(Ze),i.unbindTexture()}}}function Ke(V){if(o&&V.samples>0&&ke(V)===!1){const F=V.isWebGLMultipleRenderTargets?V.texture:[V.texture],oe=V.width,Ce=V.height;let K=16384;const Re=[],Ze=V.stencilBuffer?33306:36096,Ne=r.get(V),me=V.isWebGLMultipleRenderTargets===!0;if(me)for(let $e=0;$e<F.length;$e++)i.bindFramebuffer(36160,Ne.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+$e,36161,null),i.bindFramebuffer(36160,Ne.__webglFramebuffer),t.framebufferTexture2D(36009,36064+$e,3553,null,0);i.bindFramebuffer(36008,Ne.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Ne.__webglFramebuffer);for(let $e=0;$e<F.length;$e++){Re.push(36064+$e),V.depthBuffer&&Re.push(Ze);const Qe=Ne.__ignoreDepthValues!==void 0?Ne.__ignoreDepthValues:!1;if(Qe===!1&&(V.depthBuffer&&(K|=256),V.stencilBuffer&&(K|=1024)),me&&t.framebufferRenderbuffer(36008,36064,36161,Ne.__webglColorRenderbuffer[$e]),Qe===!0&&(t.invalidateFramebuffer(36008,[Ze]),t.invalidateFramebuffer(36009,[Ze])),me){const Je=r.get(F[$e]).__webglTexture;t.framebufferTexture2D(36009,36064,3553,Je,0)}t.blitFramebuffer(0,0,oe,Ce,0,0,oe,Ce,K,9728),f&&t.invalidateFramebuffer(36008,Re)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),me)for(let $e=0;$e<F.length;$e++){i.bindFramebuffer(36160,Ne.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+$e,36161,Ne.__webglColorRenderbuffer[$e]);const Qe=r.get(F[$e]).__webglTexture;i.bindFramebuffer(36160,Ne.__webglFramebuffer),t.framebufferTexture2D(36009,36064+$e,3553,Qe,0)}i.bindFramebuffer(36009,Ne.__webglMultisampledFramebuffer)}}function Ve(V){return Math.min(u,V.samples)}function ke(V){const F=r.get(V);return o&&V.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&F.__useRenderToTexture!==!1}function ut(V){const F=a.render.frame;p.get(V)!==F&&(p.set(V,F),V.update())}function dt(V,F){const oe=V.encoding,Ce=V.format,K=V.type;return V.isCompressedTexture===!0||V.isVideoTexture===!0||V.format===n2||oe!==fp&&(oe===zr?o===!1?e.has("EXT_sRGB")===!0&&Ce===so?(V.format=n2,V.minFilter=Hr,V.generateMipmaps=!1):F=b4.sRGBToLinear(F):(Ce!==so||K!==ud)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",oe)),F}this.allocateTextureUnit=I,this.resetTextureUnits=W,this.setTexture2D=U,this.setTexture2DArray=X,this.setTexture3D=Q,this.setTextureCube=re,this.rebindTextures=Ie,this.setupRenderTarget=Le,this.updateRenderTargetMipmap=Ge,this.updateMultisampleRenderTarget=Ke,this.setupDepthRenderbuffer=pe,this.setupFrameBufferTexture=ve,this.useMultisampledRTT=ke}function wie(t,e,i){const r=i.isWebGL2;function n(s,a=null){let o;if(s===ud)return 5121;if(s===Xte)return 32819;if(s===Yte)return 32820;if(s===Hte)return 5120;if(s===jte)return 5122;if(s===m4)return 5123;if(s===Wte)return 5124;if(s===Pf)return 5125;if(s===Wu)return 5126;if(s===Qy)return r?5131:(o=e.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===qte)return 6406;if(s===so)return 6408;if(s===Qte)return 6409;if(s===$te)return 6410;if(s===Jf)return 6402;if(s===Ig)return 34041;if(s===Jte)return 6403;if(s===Kte)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(s===n2)return o=e.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===Zte)return 36244;if(s===eie)return 33319;if(s===tie)return 33320;if(s===iie)return 36249;if(s===WT||s===XT||s===YT||s===qT)if(a===zr)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===WT)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===XT)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===YT)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===qT)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===WT)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===XT)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===YT)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===qT)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===PF||s===DF||s===RF||s===IF)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===PF)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===DF)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===RF)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===IF)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===rie)return o=e.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===LF||s===OF)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(s===LF)return a===zr?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===OF)return a===zr?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===BF||s===FF||s===kF||s===NF||s===UF||s===zF||s===GF||s===VF||s===HF||s===jF||s===WF||s===XF||s===YF||s===qF)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(s===BF)return a===zr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===FF)return a===zr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===kF)return a===zr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===NF)return a===zr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===UF)return a===zr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===zF)return a===zr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===GF)return a===zr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===VF)return a===zr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===HF)return a===zr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===jF)return a===zr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===WF)return a===zr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===XF)return a===zr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===YF)return a===zr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===qF)return a===zr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===KF)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(s===KF)return a===zr?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return s===lg?r?34042:(o=e.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):t[s]!==void 0?t[s]:null}return{convert:n}}class Sie extends Or{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Yu extends zi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const bbe={type:"move"};class oL{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Yu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Yu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new le,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new le),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Yu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new le,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new le),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,r){let n=null,s=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(e&&i.session.visibilityState!=="visible-blurred"){if(c&&e.hand){a=!0;for(const m of e.hand.values()){const g=i.getJointPose(m,r);if(c.joints[m.jointName]===void 0){const y=new Yu;y.matrixAutoUpdate=!1,y.visible=!1,c.joints[m.jointName]=y,c.add(y)}const v=c.joints[m.jointName];g!==null&&(v.matrix.fromArray(g.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.jointRadius=g.radius),v.visible=g!==null}const h=c.joints["index-finger-tip"],u=c.joints["thumb-tip"],d=h.position.distanceTo(u.position),f=.02,p=.005;c.inputState.pinching&&d>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=i.getPose(e.gripSpace,r),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(n=i.getPose(e.targetRaySpace,r),n===null&&s!==null&&(n=s),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(bbe)))}return o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=a!==null),this}}class _ie extends kr{constructor(e,i,r,n,s,a,o,l,c,h){if(h=h!==void 0?h:Jf,h!==Jf&&h!==Ig)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&h===Jf&&(r=Pf),r===void 0&&h===Ig&&(r=lg),super(null,n,s,a,o,l,h,r,c),this.isDepthTexture=!0,this.image={width:e,height:i},this.magFilter=o!==void 0?o:xn,this.minFilter=l!==void 0?l:xn,this.flipY=!1,this.generateMipmaps=!1}}class wbe extends Yh{constructor(e,i){super();const r=this;let n=null,s=1,a=null,o="local-floor",l=null,c=null,h=null,u=null,d=null,f=null;const p=i.getContextAttributes();let m=null,g=null;const v=[],y=[],x=new Or;x.layers.enable(1),x.viewport=new rr;const S=new Or;S.layers.enable(2),S.viewport=new rr;const A=[x,S],_=new Sie;_.layers.enable(1),_.layers.enable(2);let M=null,E=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(z){let U=v[z];return U===void 0&&(U=new oL,v[z]=U),U.getTargetRaySpace()},this.getControllerGrip=function(z){let U=v[z];return U===void 0&&(U=new oL,v[z]=U),U.getGripSpace()},this.getHand=function(z){let U=v[z];return U===void 0&&(U=new oL,v[z]=U),U.getHandSpace()};function T(z){const U=y.indexOf(z.inputSource);if(U===-1)return;const X=v[U];X!==void 0&&X.dispatchEvent({type:z.type,data:z.inputSource})}function C(){n.removeEventListener("select",T),n.removeEventListener("selectstart",T),n.removeEventListener("selectend",T),n.removeEventListener("squeeze",T),n.removeEventListener("squeezestart",T),n.removeEventListener("squeezeend",T),n.removeEventListener("end",C),n.removeEventListener("inputsourceschange",D);for(let z=0;z<v.length;z++){const U=y[z];U!==null&&(y[z]=null,v[z].disconnect(U))}M=null,E=null,e.setRenderTarget(m),d=null,u=null,h=null,n=null,g=null,I.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(z){s=z,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(z){o=z,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(z){l=z},this.getBaseLayer=function(){return u!==null?u:d},this.getBinding=function(){return h},this.getFrame=function(){return f},this.getSession=function(){return n},this.setSession=async function(z){if(n=z,n!==null){if(m=e.getRenderTarget(),n.addEventListener("select",T),n.addEventListener("selectstart",T),n.addEventListener("selectend",T),n.addEventListener("squeeze",T),n.addEventListener("squeezestart",T),n.addEventListener("squeezeend",T),n.addEventListener("end",C),n.addEventListener("inputsourceschange",D),p.xrCompatible!==!0&&await i.makeXRCompatible(),n.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const U={antialias:n.renderState.layers===void 0?p.antialias:!0,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(n,i,U),n.updateRenderState({baseLayer:d}),g=new Hl(d.framebufferWidth,d.framebufferHeight,{format:so,type:ud,encoding:e.outputEncoding,stencilBuffer:p.stencil})}else{let U=null,X=null,Q=null;p.depth&&(Q=p.stencil?35056:33190,U=p.stencil?Ig:Jf,X=p.stencil?lg:Pf);const re={colorFormat:32856,depthFormat:Q,scaleFactor:s};h=new XRWebGLBinding(n,i),u=h.createProjectionLayer(re),n.updateRenderState({layers:[u]}),g=new Hl(u.textureWidth,u.textureHeight,{format:so,type:ud,depthTexture:new _ie(u.textureWidth,u.textureHeight,X,void 0,void 0,void 0,void 0,void 0,void 0,U),stencilBuffer:p.stencil,encoding:e.outputEncoding,samples:p.antialias?4:0});const ie=e.properties.get(g);ie.__ignoreDepthValues=u.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(1),l=null,a=await n.requestReferenceSpace(o),I.setContext(n),I.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}};function D(z){for(let U=0;U<z.removed.length;U++){const X=z.removed[U],Q=y.indexOf(X);Q>=0&&(y[Q]=null,v[Q].dispatchEvent({type:"disconnected",data:X}))}for(let U=0;U<z.added.length;U++){const X=z.added[U];let Q=y.indexOf(X);if(Q===-1){for(let ie=0;ie<v.length;ie++)if(ie>=y.length){y.push(X),Q=ie;break}else if(y[ie]===null){y[ie]=X,Q=ie;break}if(Q===-1)break}const re=v[Q];re&&re.dispatchEvent({type:"connected",data:X})}}const B=new le,O=new le;function L(z,U,X){B.setFromMatrixPosition(U.matrixWorld),O.setFromMatrixPosition(X.matrixWorld);const Q=B.distanceTo(O),re=U.projectionMatrix.elements,ie=X.projectionMatrix.elements,ce=re[14]/(re[10]-1),Z=re[14]/(re[10]+1),Ae=(re[9]+1)/re[5],Se=(re[9]-1)/re[5],_e=(re[8]-1)/re[0],ve=(ie[8]+1)/ie[0],Ee=ce*_e,fe=ce*ve,pe=Q/(-_e+ve),Ie=pe*-_e;U.matrixWorld.decompose(z.position,z.quaternion,z.scale),z.translateX(Ie),z.translateZ(pe),z.matrixWorld.compose(z.position,z.quaternion,z.scale),z.matrixWorldInverse.copy(z.matrixWorld).invert();const Le=ce+pe,Ge=Z+pe,Ke=Ee-Ie,Ve=fe+(Q-Ie),ke=Ae*Z/Ge*Le,ut=Se*Z/Ge*Le;z.projectionMatrix.makePerspective(Ke,Ve,ke,ut,Le,Ge)}function H(z,U){U===null?z.matrixWorld.copy(z.matrix):z.matrixWorld.multiplyMatrices(U.matrixWorld,z.matrix),z.matrixWorldInverse.copy(z.matrixWorld).invert()}this.updateCamera=function(z){if(n===null)return;_.near=S.near=x.near=z.near,_.far=S.far=x.far=z.far,(M!==_.near||E!==_.far)&&(n.updateRenderState({depthNear:_.near,depthFar:_.far}),M=_.near,E=_.far);const U=z.parent,X=_.cameras;H(_,U);for(let re=0;re<X.length;re++)H(X[re],U);_.matrixWorld.decompose(_.position,_.quaternion,_.scale),z.matrix.copy(_.matrix),z.matrix.decompose(z.position,z.quaternion,z.scale);const Q=z.children;for(let re=0,ie=Q.length;re<ie;re++)Q[re].updateMatrixWorld(!0);X.length===2?L(_,x,S):_.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return _},this.getFoveation=function(){if(u!==null)return u.fixedFoveation;if(d!==null)return d.fixedFoveation},this.setFoveation=function(z){u!==null&&(u.fixedFoveation=z),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=z)};let q=null;function W(z,U){if(c=U.getViewerPose(l||a),f=U,c!==null){const X=c.views;d!==null&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let Q=!1;X.length!==_.cameras.length&&(_.cameras.length=0,Q=!0);for(let re=0;re<X.length;re++){const ie=X[re];let ce=null;if(d!==null)ce=d.getViewport(ie);else{const Ae=h.getViewSubImage(u,ie);ce=Ae.viewport,re===0&&(e.setRenderTargetTextures(g,Ae.colorTexture,u.ignoreDepthValues?void 0:Ae.depthStencilTexture),e.setRenderTarget(g))}let Z=A[re];Z===void 0&&(Z=new Or,Z.layers.enable(re),Z.viewport=new rr,A[re]=Z),Z.matrix.fromArray(ie.transform.matrix),Z.projectionMatrix.fromArray(ie.projectionMatrix),Z.viewport.set(ce.x,ce.y,ce.width,ce.height),re===0&&_.matrix.copy(Z.matrix),Q===!0&&_.cameras.push(Z)}}for(let X=0;X<v.length;X++){const Q=y[X],re=v[X];Q!==null&&re!==void 0&&re.update(Q,U,l||a)}q&&q(z,U),f=null}const I=new gie;I.setAnimationLoop(W),this.setAnimationLoop=function(z){q=z},this.dispose=function(){}}}function Sbe(t,e){function i(m,g){m.fogColor.value.copy(g.color),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)}function r(m,g,v,y,x){g.isMeshBasicMaterial||g.isMeshLambertMaterial?n(m,g):g.isMeshToonMaterial?(n(m,g),h(m,g)):g.isMeshPhongMaterial?(n(m,g),c(m,g)):g.isMeshStandardMaterial?(n(m,g),u(m,g),g.isMeshPhysicalMaterial&&d(m,g,x)):g.isMeshMatcapMaterial?(n(m,g),f(m,g)):g.isMeshDepthMaterial?n(m,g):g.isMeshDistanceMaterial?(n(m,g),p(m,g)):g.isMeshNormalMaterial?n(m,g):g.isLineBasicMaterial?(s(m,g),g.isLineDashedMaterial&&a(m,g)):g.isPointsMaterial?o(m,g,v,y):g.isSpriteMaterial?l(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function n(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,g.side===Go&&(m.bumpScale.value*=-1)),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),g.side===Go&&m.normalScale.value.negate()),g.specularMap&&(m.specularMap.value=g.specularMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);const v=e.get(g).envMap;if(v&&(m.envMap.value=v,m.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio),g.lightMap){m.lightMap.value=g.lightMap;const S=t.physicallyCorrectLights!==!0?Math.PI:1;m.lightMapIntensity.value=g.lightMapIntensity*S}g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity);let y;g.map?y=g.map:g.specularMap?y=g.specularMap:g.displacementMap?y=g.displacementMap:g.normalMap?y=g.normalMap:g.bumpMap?y=g.bumpMap:g.roughnessMap?y=g.roughnessMap:g.metalnessMap?y=g.metalnessMap:g.alphaMap?y=g.alphaMap:g.emissiveMap?y=g.emissiveMap:g.clearcoatMap?y=g.clearcoatMap:g.clearcoatNormalMap?y=g.clearcoatNormalMap:g.clearcoatRoughnessMap?y=g.clearcoatRoughnessMap:g.iridescenceMap?y=g.iridescenceMap:g.iridescenceThicknessMap?y=g.iridescenceThicknessMap:g.specularIntensityMap?y=g.specularIntensityMap:g.specularColorMap?y=g.specularColorMap:g.transmissionMap?y=g.transmissionMap:g.thicknessMap?y=g.thicknessMap:g.sheenColorMap?y=g.sheenColorMap:g.sheenRoughnessMap&&(y=g.sheenRoughnessMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix));let x;g.aoMap?x=g.aoMap:g.lightMap&&(x=g.lightMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),m.uv2Transform.value.copy(x.matrix))}function s(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity}function a(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}function o(m,g,v,y){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*v,m.scale.value=y*.5,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let x;g.map?x=g.map:g.alphaMap&&(x=g.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),m.uvTransform.value.copy(x.matrix))}function l(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let v;g.map?v=g.map:g.alphaMap&&(v=g.alphaMap),v!==void 0&&(v.matrixAutoUpdate===!0&&v.updateMatrix(),m.uvTransform.value.copy(v.matrix))}function c(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4)}function h(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap)}function u(m,g){m.roughness.value=g.roughness,m.metalness.value=g.metalness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap),e.get(g).envMap&&(m.envMapIntensity.value=g.envMapIntensity)}function d(m,g,v){m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),m.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===Go&&m.clearcoatNormalScale.value.negate())),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap)),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=v.texture,m.transmissionSamplerSize.value.set(v.width,v.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap)}function f(m,g){g.matcap&&(m.matcap.value=g.matcap)}function p(m,g){m.referencePosition.value.copy(g.referencePosition),m.nearDistance.value=g.nearDistance,m.farDistance.value=g.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function _be(t,e,i,r){let n={},s={},a=[];const o=i.isWebGL2?t.getParameter(35375):0;function l(y,x){const S=x.program;r.uniformBlockBinding(y,S)}function c(y,x){let S=n[y.id];S===void 0&&(p(y),S=h(y),n[y.id]=S,y.addEventListener("dispose",g));const A=x.program;r.updateUBOMapping(y,A);const _=e.render.frame;s[y.id]!==_&&(d(y),s[y.id]=_)}function h(y){const x=u();y.__bindingPointIndex=x;const S=t.createBuffer(),A=y.__size,_=y.usage;return t.bindBuffer(35345,S),t.bufferData(35345,A,_),t.bindBuffer(35345,null),t.bindBufferBase(35345,x,S),S}function u(){for(let y=0;y<o;y++)if(a.indexOf(y)===-1)return a.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){const x=n[y.id],S=y.uniforms,A=y.__cache;t.bindBuffer(35345,x);for(let _=0,M=S.length;_<M;_++){const E=S[_];if(f(E,_,A)===!0){const T=E.value,C=E.__offset;typeof T=="number"?(E.__data[0]=T,t.bufferSubData(35345,C,E.__data)):(E.value.isMatrix3?(E.__data[0]=E.value.elements[0],E.__data[1]=E.value.elements[1],E.__data[2]=E.value.elements[2],E.__data[3]=E.value.elements[0],E.__data[4]=E.value.elements[3],E.__data[5]=E.value.elements[4],E.__data[6]=E.value.elements[5],E.__data[7]=E.value.elements[0],E.__data[8]=E.value.elements[6],E.__data[9]=E.value.elements[7],E.__data[10]=E.value.elements[8],E.__data[11]=E.value.elements[0]):T.toArray(E.__data),t.bufferSubData(35345,C,E.__data))}}t.bindBuffer(35345,null)}function f(y,x,S){const A=y.value;if(S[x]===void 0)return typeof A=="number"?S[x]=A:S[x]=A.clone(),!0;if(typeof A=="number"){if(S[x]!==A)return S[x]=A,!0}else{const _=S[x];if(_.equals(A)===!1)return _.copy(A),!0}return!1}function p(y){const x=y.uniforms;let S=0;const A=16;let _=0;for(let M=0,E=x.length;M<E;M++){const T=x[M],C=m(T);if(T.__data=new Float32Array(C.storage/Float32Array.BYTES_PER_ELEMENT),T.__offset=S,M>0){_=S%A;const D=A-_;_!==0&&D-C.boundary<0&&(S+=A-_,T.__offset=S)}S+=C.storage}return _=S%A,_>0&&(S+=A-_),y.__size=S,y.__cache={},this}function m(y){const x=y.value,S={boundary:0,storage:0};return typeof x=="number"?(S.boundary=4,S.storage=4):x.isVector2?(S.boundary=8,S.storage=8):x.isVector3||x.isColor?(S.boundary=16,S.storage=12):x.isVector4?(S.boundary=16,S.storage=16):x.isMatrix3?(S.boundary=48,S.storage=48):x.isMatrix4?(S.boundary=64,S.storage=64):x.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",x),S}function g(y){const x=y.target;x.removeEventListener("dispose",g);const S=a.indexOf(x.__bindingPointIndex);a.splice(S,1),t.deleteBuffer(n[x.id]),delete n[x.id],delete s[x.id]}function v(){for(const y in n)t.deleteBuffer(n[y]);a=[],n={},s={}}return{bind:l,update:c,dispose:v}}function Abe(){const t=iS("canvas");return t.style.display="block",t}function C4(t={}){this.isWebGLRenderer=!0;const e=t.canvas!==void 0?t.canvas:Abe(),i=t.context!==void 0?t.context:null,r=t.depth!==void 0?t.depth:!0,n=t.stencil!==void 0?t.stencil:!0,s=t.antialias!==void 0?t.antialias:!1,a=t.premultipliedAlpha!==void 0?t.premultipliedAlpha:!0,o=t.preserveDrawingBuffer!==void 0?t.preserveDrawingBuffer:!1,l=t.powerPreference!==void 0?t.powerPreference:"default",c=t.failIfMajorPerformanceCaveat!==void 0?t.failIfMajorPerformanceCaveat:!1;let h;i!==null?h=i.getContextAttributes().alpha:h=t.alpha!==void 0?t.alpha:!1;let u=null,d=null;const f=[],p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=fp,this.physicallyCorrectLights=!1,this.toneMapping=Pc,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const m=this;let g=!1,v=0,y=0,x=null,S=-1,A=null;const _=new rr,M=new rr;let E=null,T=e.width,C=e.height,D=1,B=null,O=null;const L=new rr(0,0,T,C),H=new rr(0,0,T,C);let q=!1;const W=new sD;let I=!1,z=!1,U=null;const X=new ui,Q=new tt,re=new le,ie={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ce(){return x===null?D:1}let Z=i;function Ae(G,ae){for(let ge=0;ge<G.length;ge++){const se=G[ge],xe=e.getContext(se,ae);if(xe!==null)return xe}return null}try{const G={alpha:!0,depth:r,stencil:n,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${ZS}`),e.addEventListener("webglcontextlost",ot,!1),e.addEventListener("webglcontextrestored",nt,!1),e.addEventListener("webglcontextcreationerror",de,!1),Z===null){const ae=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&ae.shift(),Z=Ae(ae,G),Z===null)throw Ae(ae)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Z.getShaderPrecisionFormat===void 0&&(Z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(G){throw console.error("THREE.WebGLRenderer: "+G.message),G}let Se,_e,ve,Ee,fe,pe,Ie,Le,Ge,Ke,Ve,ke,ut,dt,V,F,oe,Ce,K,Re,Ze,Ne,me,$e;function Qe(){Se=new z1e(Z),_e=new O1e(Z,Se,t),Se.init(_e),Ne=new wie(Z,Se,_e),ve=new ybe(Z,Se,_e),Ee=new H1e,fe=new abe,pe=new xbe(Z,Se,ve,fe,_e,Ne,Ee),Ie=new F1e(m),Le=new U1e(m),Ge=new J0e(Z,_e),me=new I1e(Z,Se,Ge,_e),Ke=new G1e(Z,Ge,Ee,me),Ve=new Y1e(Z,Ke,Ge,Ee),K=new X1e(Z,_e,pe),F=new B1e(fe),ke=new sbe(m,Ie,Le,Se,_e,me,F),ut=new Sbe(m,fe),dt=new lbe,V=new pbe(Se,_e),Ce=new R1e(m,Ie,Le,ve,Ve,h,a),oe=new vbe(m,Ve,_e),$e=new _be(Z,Ee,_e,ve),Re=new L1e(Z,Se,Ee,_e),Ze=new V1e(Z,Se,Ee,_e),Ee.programs=ke.programs,m.capabilities=_e,m.extensions=Se,m.properties=fe,m.renderLists=dt,m.shadowMap=oe,m.state=ve,m.info=Ee}Qe();const Je=new wbe(m,Z);this.xr=Je,this.getContext=function(){return Z},this.getContextAttributes=function(){return Z.getContextAttributes()},this.forceContextLoss=function(){const G=Se.get("WEBGL_lose_context");G&&G.loseContext()},this.forceContextRestore=function(){const G=Se.get("WEBGL_lose_context");G&&G.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(G){G!==void 0&&(D=G,this.setSize(T,C,!1))},this.getSize=function(G){return G.set(T,C)},this.setSize=function(G,ae,ge){if(Je.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}T=G,C=ae,e.width=Math.floor(G*D),e.height=Math.floor(ae*D),ge!==!1&&(e.style.width=G+"px",e.style.height=ae+"px"),this.setViewport(0,0,G,ae)},this.getDrawingBufferSize=function(G){return G.set(T*D,C*D).floor()},this.setDrawingBufferSize=function(G,ae,ge){T=G,C=ae,D=ge,e.width=Math.floor(G*ge),e.height=Math.floor(ae*ge),this.setViewport(0,0,G,ae)},this.getCurrentViewport=function(G){return G.copy(_)},this.getViewport=function(G){return G.copy(L)},this.setViewport=function(G,ae,ge,se){G.isVector4?L.set(G.x,G.y,G.z,G.w):L.set(G,ae,ge,se),ve.viewport(_.copy(L).multiplyScalar(D).floor())},this.getScissor=function(G){return G.copy(H)},this.setScissor=function(G,ae,ge,se){G.isVector4?H.set(G.x,G.y,G.z,G.w):H.set(G,ae,ge,se),ve.scissor(M.copy(H).multiplyScalar(D).floor())},this.getScissorTest=function(){return q},this.setScissorTest=function(G){ve.setScissorTest(q=G)},this.setOpaqueSort=function(G){B=G},this.setTransparentSort=function(G){O=G},this.getClearColor=function(G){return G.copy(Ce.getClearColor())},this.setClearColor=function(){Ce.setClearColor.apply(Ce,arguments)},this.getClearAlpha=function(){return Ce.getClearAlpha()},this.setClearAlpha=function(){Ce.setClearAlpha.apply(Ce,arguments)},this.clear=function(G=!0,ae=!0,ge=!0){let se=0;G&&(se|=16384),ae&&(se|=256),ge&&(se|=1024),Z.clear(se)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",ot,!1),e.removeEventListener("webglcontextrestored",nt,!1),e.removeEventListener("webglcontextcreationerror",de,!1),dt.dispose(),V.dispose(),fe.dispose(),Ie.dispose(),Le.dispose(),Ve.dispose(),me.dispose(),$e.dispose(),ke.dispose(),Je.dispose(),Je.removeEventListener("sessionstart",Ue),Je.removeEventListener("sessionend",at),U&&(U.dispose(),U=null),Mt.stop()};function ot(G){G.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function nt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const G=Ee.autoReset,ae=oe.enabled,ge=oe.autoUpdate,se=oe.needsUpdate,xe=oe.type;Qe(),Ee.autoReset=G,oe.enabled=ae,oe.autoUpdate=ge,oe.needsUpdate=se,oe.type=xe}function de(G){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",G.statusMessage)}function Xe(G){const ae=G.target;ae.removeEventListener("dispose",Xe),mt(ae)}function mt(G){J(G),fe.remove(G)}function J(G){const ae=fe.get(G).programs;ae!==void 0&&(ae.forEach(function(ge){ke.releaseProgram(ge)}),G.isShaderMaterial&&ke.releaseShaderCache(G))}this.renderBufferDirect=function(G,ae,ge,se,xe,rt){ae===null&&(ae=ie);const ft=xe.isMesh&&xe.matrixWorld.determinant()<0,gt=Np(G,ae,ge,se,xe);ve.setMaterial(se,ft);let ht=ge.index;const Lt=ge.attributes.position;if(ht===null){if(Lt===void 0||Lt.count===0)return}else if(ht.count===0)return;let wt=1;se.wireframe===!0&&(ht=Ke.getWireframeAttribute(ge),wt=2),me.setup(xe,se,gt,ge,ht);let _t,It=Re;ht!==null&&(_t=Ge.get(ht),It=Ze,It.setIndex(_t));const Zi=ht!==null?ht.count:Lt.count,cn=ge.drawRange.start*wt,ls=ge.drawRange.count*wt,Ai=rt!==null?rt.start*wt:0,At=rt!==null?rt.count*wt:1/0,$r=Math.max(cn,Ai),Ft=Math.min(Zi,cn+ls,Ai+At)-1,Dr=Math.max(0,Ft-$r+1);if(Dr!==0){if(xe.isMesh)se.wireframe===!0?(ve.setLineWidth(se.wireframeLinewidth*ce()),It.setMode(1)):It.setMode(4);else if(xe.isLine){let En=se.linewidth;En===void 0&&(En=1),ve.setLineWidth(En*ce()),xe.isLineSegments?It.setMode(1):xe.isLineLoop?It.setMode(2):It.setMode(3)}else xe.isPoints?It.setMode(0):xe.isSprite&&It.setMode(4);if(xe.isInstancedMesh)It.renderInstances($r,Dr,xe.count);else if(ge.isInstancedBufferGeometry){const En=Math.min(ge.instanceCount,ge._maxInstanceCount);It.renderInstances($r,Dr,En)}else It.render($r,Dr)}},this.compile=function(G,ae){function ge(se,xe,rt){se.transparent===!0&&se.side===_c?(se.side=Go,se.needsUpdate=!0,Bi(se,xe,rt),se.side=cp,se.needsUpdate=!0,Bi(se,xe,rt),se.side=_c):Bi(se,xe,rt)}d=V.get(G),d.init(),p.push(d),G.traverseVisible(function(se){se.isLight&&se.layers.test(ae.layers)&&(d.pushLight(se),se.castShadow&&d.pushShadow(se))}),d.setupLights(m.physicallyCorrectLights),G.traverse(function(se){const xe=se.material;if(xe)if(Array.isArray(xe))for(let rt=0;rt<xe.length;rt++){const ft=xe[rt];ge(ft,G,se)}else ge(xe,G,se)}),p.pop(),d=null};let he=null;function Me(G){he&&he(G)}function Ue(){Mt.stop()}function at(){Mt.start()}const Mt=new gie;Mt.setAnimationLoop(Me),typeof self<"u"&&Mt.setContext(self),this.setAnimationLoop=function(G){he=G,Je.setAnimationLoop(G),G===null?Mt.stop():Mt.start()},Je.addEventListener("sessionstart",Ue),Je.addEventListener("sessionend",at),this.render=function(G,ae){if(ae!==void 0&&ae.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(g===!0)return;G.matrixWorldAutoUpdate===!0&&G.updateMatrixWorld(),ae.parent===null&&ae.matrixWorldAutoUpdate===!0&&ae.updateMatrixWorld(),Je.enabled===!0&&Je.isPresenting===!0&&(Je.cameraAutoUpdate===!0&&Je.updateCamera(ae),ae=Je.getCamera()),G.isScene===!0&&G.onBeforeRender(m,G,ae,x),d=V.get(G,p.length),d.init(),p.push(d),X.multiplyMatrices(ae.projectionMatrix,ae.matrixWorldInverse),W.setFromProjectionMatrix(X),z=this.localClippingEnabled,I=F.init(this.clippingPlanes,z,ae),u=dt.get(G,f.length),u.init(),f.push(u),Qt(G,ae,0,m.sortObjects),u.finish(),m.sortObjects===!0&&u.sort(B,O),I===!0&&F.beginShadows();const ge=d.state.shadowsArray;if(oe.render(ge,G,ae),I===!0&&F.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ce.render(u,G),d.setupLights(m.physicallyCorrectLights),ae.isArrayCamera){const se=ae.cameras;for(let xe=0,rt=se.length;xe<rt;xe++){const ft=se[xe];ci(u,G,ft,ft.viewport)}}else ci(u,G,ae);x!==null&&(pe.updateMultisampleRenderTarget(x),pe.updateRenderTargetMipmap(x)),G.isScene===!0&&G.onAfterRender(m,G,ae),me.resetDefaultState(),S=-1,A=null,p.pop(),p.length>0?d=p[p.length-1]:d=null,f.pop(),f.length>0?u=f[f.length-1]:u=null};function Qt(G,ae,ge,se){if(G.visible===!1)return;if(G.layers.test(ae.layers)){if(G.isGroup)ge=G.renderOrder;else if(G.isLOD)G.autoUpdate===!0&&G.update(ae);else if(G.isLight)d.pushLight(G),G.castShadow&&d.pushShadow(G);else if(G.isSprite){if(!G.frustumCulled||W.intersectsSprite(G)){se&&re.setFromMatrixPosition(G.matrixWorld).applyMatrix4(X);const ft=Ve.update(G),gt=G.material;gt.visible&&u.push(G,ft,gt,ge,re.z,null)}}else if((G.isMesh||G.isLine||G.isPoints)&&(G.isSkinnedMesh&&G.skeleton.frame!==Ee.render.frame&&(G.skeleton.update(),G.skeleton.frame=Ee.render.frame),!G.frustumCulled||W.intersectsObject(G))){se&&re.setFromMatrixPosition(G.matrixWorld).applyMatrix4(X);const ft=Ve.update(G),gt=G.material;if(Array.isArray(gt)){const ht=ft.groups;for(let Lt=0,wt=ht.length;Lt<wt;Lt++){const _t=ht[Lt],It=gt[_t.materialIndex];It&&It.visible&&u.push(G,ft,It,ge,re.z,_t)}}else gt.visible&&u.push(G,ft,gt,ge,re.z,null)}}const rt=G.children;for(let ft=0,gt=rt.length;ft<gt;ft++)Qt(rt[ft],ae,ge,se)}function ci(G,ae,ge,se){const xe=G.opaque,rt=G.transmissive,ft=G.transparent;d.setupLightsView(ge),rt.length>0&&ur(xe,ae,ge),se&&ve.viewport(_.copy(se)),xe.length>0&&Gt(xe,ae,ge),rt.length>0&&Gt(rt,ae,ge),ft.length>0&&Gt(ft,ae,ge),ve.buffers.depth.setTest(!0),ve.buffers.depth.setMask(!0),ve.buffers.color.setMask(!0),ve.setPolygonOffset(!1)}function ur(G,ae,ge){const se=_e.isWebGL2;U===null&&(U=new Hl(1,1,{generateMipmaps:!0,type:Se.has("EXT_color_buffer_half_float")?Qy:ud,minFilter:_d,samples:se&&s===!0?4:0})),m.getDrawingBufferSize(Q),se?U.setSize(Q.x,Q.y):U.setSize(s2(Q.x),s2(Q.y));const xe=m.getRenderTarget();m.setRenderTarget(U),m.clear();const rt=m.toneMapping;m.toneMapping=Pc,Gt(G,ae,ge),m.toneMapping=rt,pe.updateMultisampleRenderTarget(U),pe.updateRenderTargetMipmap(U),m.setRenderTarget(xe)}function Gt(G,ae,ge){const se=ae.isScene===!0?ae.overrideMaterial:null;for(let xe=0,rt=G.length;xe<rt;xe++){const ft=G[xe],gt=ft.object,ht=ft.geometry,Lt=se===null?ft.material:se,wt=ft.group;gt.layers.test(ge.layers)&&Qi(gt,ae,ge,ht,Lt,wt)}}function Qi(G,ae,ge,se,xe,rt){G.onBeforeRender(m,ae,ge,se,xe,rt),G.modelViewMatrix.multiplyMatrices(ge.matrixWorldInverse,G.matrixWorld),G.normalMatrix.getNormalMatrix(G.modelViewMatrix),xe.onBeforeRender(m,ae,ge,se,G,rt),xe.transparent===!0&&xe.side===_c?(xe.side=Go,xe.needsUpdate=!0,m.renderBufferDirect(ge,ae,se,xe,G,rt),xe.side=cp,xe.needsUpdate=!0,m.renderBufferDirect(ge,ae,se,xe,G,rt),xe.side=_c):m.renderBufferDirect(ge,ae,se,xe,G,rt),G.onAfterRender(m,ae,ge,se,xe,rt)}function Bi(G,ae,ge){ae.isScene!==!0&&(ae=ie);const se=fe.get(G),xe=d.state.lights,rt=d.state.shadowsArray,ft=xe.state.version,gt=ke.getParameters(G,xe.state,rt,ae,ge),ht=ke.getProgramCacheKey(gt);let Lt=se.programs;se.environment=G.isMeshStandardMaterial?ae.environment:null,se.fog=ae.fog,se.envMap=(G.isMeshStandardMaterial?Le:Ie).get(G.envMap||se.environment),Lt===void 0&&(G.addEventListener("dispose",Xe),Lt=new Map,se.programs=Lt);let wt=Lt.get(ht);if(wt!==void 0){if(se.currentProgram===wt&&se.lightsStateVersion===ft)return Kl(G,gt),wt}else gt.uniforms=ke.getUniforms(G),G.onBuild(ge,gt,m),G.onBeforeCompile(gt,m),wt=ke.acquireProgram(gt,ht),Lt.set(ht,wt),se.uniforms=gt.uniforms;const _t=se.uniforms;(!G.isShaderMaterial&&!G.isRawShaderMaterial||G.clipping===!0)&&(_t.clippingPlanes=F.uniform),Kl(G,gt),se.needsLights=Ql(G),se.lightsStateVersion=ft,se.needsLights&&(_t.ambientLightColor.value=xe.state.ambient,_t.lightProbe.value=xe.state.probe,_t.directionalLights.value=xe.state.directional,_t.directionalLightShadows.value=xe.state.directionalShadow,_t.spotLights.value=xe.state.spot,_t.spotLightShadows.value=xe.state.spotShadow,_t.rectAreaLights.value=xe.state.rectArea,_t.ltc_1.value=xe.state.rectAreaLTC1,_t.ltc_2.value=xe.state.rectAreaLTC2,_t.pointLights.value=xe.state.point,_t.pointLightShadows.value=xe.state.pointShadow,_t.hemisphereLights.value=xe.state.hemi,_t.directionalShadowMap.value=xe.state.directionalShadowMap,_t.directionalShadowMatrix.value=xe.state.directionalShadowMatrix,_t.spotShadowMap.value=xe.state.spotShadowMap,_t.spotLightMatrix.value=xe.state.spotLightMatrix,_t.spotLightMap.value=xe.state.spotLightMap,_t.pointShadowMap.value=xe.state.pointShadowMap,_t.pointShadowMatrix.value=xe.state.pointShadowMatrix);const It=wt.getUniforms(),Zi=JT.seqWithValue(It.seq,_t);return se.currentProgram=wt,se.uniformsList=Zi,wt}function Kl(G,ae){const ge=fe.get(G);ge.outputEncoding=ae.outputEncoding,ge.instancing=ae.instancing,ge.skinning=ae.skinning,ge.morphTargets=ae.morphTargets,ge.morphNormals=ae.morphNormals,ge.morphColors=ae.morphColors,ge.morphTargetsCount=ae.morphTargetsCount,ge.numClippingPlanes=ae.numClippingPlanes,ge.numIntersection=ae.numClipIntersection,ge.vertexAlphas=ae.vertexAlphas,ge.vertexTangents=ae.vertexTangents,ge.toneMapping=ae.toneMapping}function Np(G,ae,ge,se,xe){ae.isScene!==!0&&(ae=ie),pe.resetTextureUnits();const rt=ae.fog,ft=se.isMeshStandardMaterial?ae.environment:null,gt=x===null?m.outputEncoding:x.isXRRenderTarget===!0?x.texture.encoding:fp,ht=(se.isMeshStandardMaterial?Le:Ie).get(se.envMap||ft),Lt=se.vertexColors===!0&&!!ge.attributes.color&&ge.attributes.color.itemSize===4,wt=!!se.normalMap&&!!ge.attributes.tangent,_t=!!ge.morphAttributes.position,It=!!ge.morphAttributes.normal,Zi=!!ge.morphAttributes.color,cn=se.toneMapped?m.toneMapping:Pc,ls=ge.morphAttributes.position||ge.morphAttributes.normal||ge.morphAttributes.color,Ai=ls!==void 0?ls.length:0,At=fe.get(se),$r=d.state.lights;if(I===!0&&(z===!0||G!==A)){const ne=G===A&&se.id===S;F.setState(se,G,ne)}let Ft=!1;se.version===At.__version?(At.needsLights&&At.lightsStateVersion!==$r.state.version||At.outputEncoding!==gt||xe.isInstancedMesh&&At.instancing===!1||!xe.isInstancedMesh&&At.instancing===!0||xe.isSkinnedMesh&&At.skinning===!1||!xe.isSkinnedMesh&&At.skinning===!0||At.envMap!==ht||se.fog===!0&&At.fog!==rt||At.numClippingPlanes!==void 0&&(At.numClippingPlanes!==F.numPlanes||At.numIntersection!==F.numIntersection)||At.vertexAlphas!==Lt||At.vertexTangents!==wt||At.morphTargets!==_t||At.morphNormals!==It||At.morphColors!==Zi||At.toneMapping!==cn||_e.isWebGL2===!0&&At.morphTargetsCount!==Ai)&&(Ft=!0):(Ft=!0,At.__version=se.version);let Dr=At.currentProgram;Ft===!0&&(Dr=Bi(se,ae,xe));let En=!1,hn=!1,Nr=!1;const $=Dr.getUniforms(),te=At.uniforms;if(ve.useProgram(Dr.program)&&(En=!0,hn=!0,Nr=!0),se.id!==S&&(S=se.id,hn=!0),En||A!==G){if($.setValue(Z,"projectionMatrix",G.projectionMatrix),_e.logarithmicDepthBuffer&&$.setValue(Z,"logDepthBufFC",2/(Math.log(G.far+1)/Math.LN2)),A!==G&&(A=G,hn=!0,Nr=!0),se.isShaderMaterial||se.isMeshPhongMaterial||se.isMeshToonMaterial||se.isMeshStandardMaterial||se.envMap){const ne=$.map.cameraPosition;ne!==void 0&&ne.setValue(Z,re.setFromMatrixPosition(G.matrixWorld))}(se.isMeshPhongMaterial||se.isMeshToonMaterial||se.isMeshLambertMaterial||se.isMeshBasicMaterial||se.isMeshStandardMaterial||se.isShaderMaterial)&&$.setValue(Z,"isOrthographic",G.isOrthographicCamera===!0),(se.isMeshPhongMaterial||se.isMeshToonMaterial||se.isMeshLambertMaterial||se.isMeshBasicMaterial||se.isMeshStandardMaterial||se.isShaderMaterial||se.isShadowMaterial||xe.isSkinnedMesh)&&$.setValue(Z,"viewMatrix",G.matrixWorldInverse)}if(xe.isSkinnedMesh){$.setOptional(Z,xe,"bindMatrix"),$.setOptional(Z,xe,"bindMatrixInverse");const ne=xe.skeleton;ne&&(_e.floatVertexTextures?(ne.boneTexture===null&&ne.computeBoneTexture(),$.setValue(Z,"boneTexture",ne.boneTexture,pe),$.setValue(Z,"boneTextureSize",ne.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const be=ge.morphAttributes;if((be.position!==void 0||be.normal!==void 0||be.color!==void 0&&_e.isWebGL2===!0)&&K.update(xe,ge,se,Dr),(hn||At.receiveShadow!==xe.receiveShadow)&&(At.receiveShadow=xe.receiveShadow,$.setValue(Z,"receiveShadow",xe.receiveShadow)),se.isMeshGouraudMaterial&&se.envMap!==null&&(te.envMap.value=ht,te.flipEnvMap.value=ht.isCubeTexture&&ht.isRenderTargetTexture===!1?-1:1),hn&&($.setValue(Z,"toneMappingExposure",m.toneMappingExposure),At.needsLights&&Dd(te,Nr),rt&&se.fog===!0&&ut.refreshFogUniforms(te,rt),ut.refreshMaterialUniforms(te,se,D,C,U),JT.upload(Z,At.uniformsList,te,pe)),se.isShaderMaterial&&se.uniformsNeedUpdate===!0&&(JT.upload(Z,At.uniformsList,te,pe),se.uniformsNeedUpdate=!1),se.isSpriteMaterial&&$.setValue(Z,"center",xe.center),$.setValue(Z,"modelViewMatrix",xe.modelViewMatrix),$.setValue(Z,"normalMatrix",xe.normalMatrix),$.setValue(Z,"modelMatrix",xe.matrixWorld),se.isShaderMaterial||se.isRawShaderMaterial){const ne=se.uniformsGroups;for(let Te=0,lt=ne.length;Te<lt;Te++)if(_e.isWebGL2){const Vn=ne[Te];$e.update(Vn,Dr),$e.bind(Vn,Dr)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Dr}function Dd(G,ae){G.ambientLightColor.needsUpdate=ae,G.lightProbe.needsUpdate=ae,G.directionalLights.needsUpdate=ae,G.directionalLightShadows.needsUpdate=ae,G.pointLights.needsUpdate=ae,G.pointLightShadows.needsUpdate=ae,G.spotLights.needsUpdate=ae,G.spotLightShadows.needsUpdate=ae,G.rectAreaLights.needsUpdate=ae,G.hemisphereLights.needsUpdate=ae}function Ql(G){return G.isMeshLambertMaterial||G.isMeshToonMaterial||G.isMeshPhongMaterial||G.isMeshStandardMaterial||G.isShadowMaterial||G.isShaderMaterial&&G.lights===!0}this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(G,ae,ge){fe.get(G.texture).__webglTexture=ae,fe.get(G.depthTexture).__webglTexture=ge;const se=fe.get(G);se.__hasExternalTextures=!0,se.__hasExternalTextures&&(se.__autoAllocateDepthBuffer=ge===void 0,se.__autoAllocateDepthBuffer||Se.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),se.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(G,ae){const ge=fe.get(G);ge.__webglFramebuffer=ae,ge.__useDefaultFramebuffer=ae===void 0},this.setRenderTarget=function(G,ae=0,ge=0){x=G,v=ae,y=ge;let se=!0,xe=null,rt=!1,ft=!1;if(G){const ht=fe.get(G);ht.__useDefaultFramebuffer!==void 0?(ve.bindFramebuffer(36160,null),se=!1):ht.__webglFramebuffer===void 0?pe.setupRenderTarget(G):ht.__hasExternalTextures&&pe.rebindTextures(G,fe.get(G.texture).__webglTexture,fe.get(G.depthTexture).__webglTexture);const Lt=G.texture;(Lt.isData3DTexture||Lt.isDataArrayTexture||Lt.isCompressedArrayTexture)&&(ft=!0);const wt=fe.get(G).__webglFramebuffer;G.isWebGLCubeRenderTarget?(xe=wt[ae],rt=!0):_e.isWebGL2&&G.samples>0&&pe.useMultisampledRTT(G)===!1?xe=fe.get(G).__webglMultisampledFramebuffer:xe=wt,_.copy(G.viewport),M.copy(G.scissor),E=G.scissorTest}else _.copy(L).multiplyScalar(D).floor(),M.copy(H).multiplyScalar(D).floor(),E=q;if(ve.bindFramebuffer(36160,xe)&&_e.drawBuffers&&se&&ve.drawBuffers(G,xe),ve.viewport(_),ve.scissor(M),ve.setScissorTest(E),rt){const ht=fe.get(G.texture);Z.framebufferTexture2D(36160,36064,34069+ae,ht.__webglTexture,ge)}else if(ft){const ht=fe.get(G.texture),Lt=ae||0;Z.framebufferTextureLayer(36160,36064,ht.__webglTexture,ge||0,Lt)}S=-1},this.readRenderTargetPixels=function(G,ae,ge,se,xe,rt,ft){if(!(G&&G.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let gt=fe.get(G).__webglFramebuffer;if(G.isWebGLCubeRenderTarget&&ft!==void 0&&(gt=gt[ft]),gt){ve.bindFramebuffer(36160,gt);try{const ht=G.texture,Lt=ht.format,wt=ht.type;if(Lt!==so&&Ne.convert(Lt)!==Z.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const _t=wt===Qy&&(Se.has("EXT_color_buffer_half_float")||_e.isWebGL2&&Se.has("EXT_color_buffer_float"));if(wt!==ud&&Ne.convert(wt)!==Z.getParameter(35738)&&!(wt===Wu&&(_e.isWebGL2||Se.has("OES_texture_float")||Se.has("WEBGL_color_buffer_float")))&&!_t){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ae>=0&&ae<=G.width-se&&ge>=0&&ge<=G.height-xe&&Z.readPixels(ae,ge,se,xe,Ne.convert(Lt),Ne.convert(wt),rt)}finally{const ht=x!==null?fe.get(x).__webglFramebuffer:null;ve.bindFramebuffer(36160,ht)}}},this.copyFramebufferToTexture=function(G,ae,ge=0){const se=Math.pow(2,-ge),xe=Math.floor(ae.image.width*se),rt=Math.floor(ae.image.height*se);pe.setTexture2D(ae,0),Z.copyTexSubImage2D(3553,ge,0,0,G.x,G.y,xe,rt),ve.unbindTexture()},this.copyTextureToTexture=function(G,ae,ge,se=0){const xe=ae.image.width,rt=ae.image.height,ft=Ne.convert(ge.format),gt=Ne.convert(ge.type);pe.setTexture2D(ge,0),Z.pixelStorei(37440,ge.flipY),Z.pixelStorei(37441,ge.premultiplyAlpha),Z.pixelStorei(3317,ge.unpackAlignment),ae.isDataTexture?Z.texSubImage2D(3553,se,G.x,G.y,xe,rt,ft,gt,ae.image.data):ae.isCompressedTexture?Z.compressedTexSubImage2D(3553,se,G.x,G.y,ae.mipmaps[0].width,ae.mipmaps[0].height,ft,ae.mipmaps[0].data):Z.texSubImage2D(3553,se,G.x,G.y,ft,gt,ae.image),se===0&&ge.generateMipmaps&&Z.generateMipmap(3553),ve.unbindTexture()},this.copyTextureToTexture3D=function(G,ae,ge,se,xe=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const rt=G.max.x-G.min.x+1,ft=G.max.y-G.min.y+1,gt=G.max.z-G.min.z+1,ht=Ne.convert(se.format),Lt=Ne.convert(se.type);let wt;if(se.isData3DTexture)pe.setTexture3D(se,0),wt=32879;else if(se.isDataArrayTexture)pe.setTexture2DArray(se,0),wt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Z.pixelStorei(37440,se.flipY),Z.pixelStorei(37441,se.premultiplyAlpha),Z.pixelStorei(3317,se.unpackAlignment);const _t=Z.getParameter(3314),It=Z.getParameter(32878),Zi=Z.getParameter(3316),cn=Z.getParameter(3315),ls=Z.getParameter(32877),Ai=ge.isCompressedTexture?ge.mipmaps[0]:ge.image;Z.pixelStorei(3314,Ai.width),Z.pixelStorei(32878,Ai.height),Z.pixelStorei(3316,G.min.x),Z.pixelStorei(3315,G.min.y),Z.pixelStorei(32877,G.min.z),ge.isDataTexture||ge.isData3DTexture?Z.texSubImage3D(wt,xe,ae.x,ae.y,ae.z,rt,ft,gt,ht,Lt,Ai.data):ge.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Z.compressedTexSubImage3D(wt,xe,ae.x,ae.y,ae.z,rt,ft,gt,ht,Ai.data)):Z.texSubImage3D(wt,xe,ae.x,ae.y,ae.z,rt,ft,gt,ht,Lt,Ai),Z.pixelStorei(3314,_t),Z.pixelStorei(32878,It),Z.pixelStorei(3316,Zi),Z.pixelStorei(3315,cn),Z.pixelStorei(32877,ls),xe===0&&se.generateMipmaps&&Z.generateMipmap(wt),ve.unbindTexture()},this.initTexture=function(G){G.isCubeTexture?pe.setTextureCube(G,0):G.isData3DTexture?pe.setTexture3D(G,0):G.isDataArrayTexture||G.isCompressedArrayTexture?pe.setTexture2DArray(G,0):pe.setTexture2D(G,0),ve.unbindTexture()},this.resetState=function(){v=0,y=0,x=null,ve.reset(),me.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Aie extends C4{}Aie.prototype.isWebGL1Renderer=!0;class oD{constructor(e,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new Ct(e),this.density=i}clone(){return new oD(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class lD{constructor(e,i=1,r=1e3){this.isFog=!0,this.name="",this.color=new Ct(e),this.near=i,this.far=r}clone(){return new lD(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class a2 extends zi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.backgroundBlurriness=this.backgroundBlurriness),i}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class n_{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=e!==void 0?e.length/i:0,this.usage=eS,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Vo()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,r){e*=this.stride,r*=i.stride;for(let n=0,s=this.stride;n<s;n++)this.array[e+n]=i.array[r+n];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Vo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(i,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Vo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ea=new le;class pp{constructor(e,i,r,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=r,this.normalized=n===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,r=this.data.count;i<r;i++)Ea.fromBufferAttribute(this,i),Ea.applyMatrix4(e),this.setXYZ(i,Ea.x,Ea.y,Ea.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)Ea.fromBufferAttribute(this,i),Ea.applyNormalMatrix(e),this.setXYZ(i,Ea.x,Ea.y,Ea.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)Ea.fromBufferAttribute(this,i),Ea.transformDirection(e),this.setXYZ(i,Ea.x,Ea.y,Ea.z);return this}setX(e,i){return this.normalized&&(i=pr(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=pr(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=pr(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=pr(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=Xu(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=Xu(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=Xu(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=Xu(i,this.array)),i}setXY(e,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(i=pr(i,this.array),r=pr(r,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this}setXYZ(e,i,r,n){return e=e*this.data.stride+this.offset,this.normalized&&(i=pr(i,this.array),r=pr(r,this.array),n=pr(n,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=n,this}setXYZW(e,i,r,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=pr(i,this.array),r=pr(r,this.array),n=pr(n,this.array),s=pr(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return new Xi(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new pp(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class P4 extends kn{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ct(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let U0;const Ux=new le,z0=new le,G0=new le,V0=new tt,zx=new tt,Eie=new ui,bE=new le,Gx=new le,wE=new le,Tj=new tt,lL=new tt,Cj=new tt;class Mie extends zi{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",U0===void 0){U0=new xi;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new n_(i,5);U0.setIndex([0,1,2,0,2,3]),U0.setAttribute("position",new pp(r,3,0,!1)),U0.setAttribute("uv",new pp(r,2,3,!1))}this.geometry=U0,this.material=e!==void 0?e:new P4,this.center=new tt(.5,.5)}raycast(e,i){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),z0.setFromMatrixScale(this.matrixWorld),Eie.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),G0.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&z0.multiplyScalar(-G0.z);const r=this.material.rotation;let n,s;r!==0&&(s=Math.cos(r),n=Math.sin(r));const a=this.center;SE(bE.set(-.5,-.5,0),G0,a,z0,n,s),SE(Gx.set(.5,-.5,0),G0,a,z0,n,s),SE(wE.set(.5,.5,0),G0,a,z0,n,s),Tj.set(0,0),lL.set(1,0),Cj.set(1,1);let o=e.ray.intersectTriangle(bE,Gx,wE,!1,Ux);if(o===null&&(SE(Gx.set(-.5,.5,0),G0,a,z0,n,s),lL.set(0,1),o=e.ray.intersectTriangle(bE,wE,Gx,!1,Ux),o===null))return;const l=e.ray.origin.distanceTo(Ux);l<e.near||l>e.far||i.push({distance:l,point:Ux.clone(),uv:Il.getUV(Ux,bE,Gx,wE,Tj,lL,Cj,new tt),face:null,object:this})}copy(e,i){return super.copy(e,i),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function SE(t,e,i,r,n,s){V0.subVectors(t,i).addScalar(.5).multiply(r),n!==void 0?(zx.x=s*V0.x-n*V0.y,zx.y=n*V0.x+s*V0.y):zx.copy(V0),t.copy(e),t.x+=zx.x,t.y+=zx.y,t.applyMatrix4(Eie)}const _E=new le,Pj=new le;class Tie extends zi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const i=e.levels;for(let r=0,n=i.length;r<n;r++){const s=i[r];this.addLevel(s.object.clone(),s.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,i=0){i=Math.abs(i);const r=this.levels;let n;for(n=0;n<r.length&&!(i<r[n].distance);n++);return r.splice(n,0,{distance:i,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const i=this.levels;if(i.length>0){let r,n;for(r=1,n=i.length;r<n&&!(e<i[r].distance);r++);return i[r-1].object}return null}raycast(e,i){if(this.levels.length>0){_E.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(_E);this.getObjectForDistance(n).raycast(e,i)}}update(e){const i=this.levels;if(i.length>1){_E.setFromMatrixPosition(e.matrixWorld),Pj.setFromMatrixPosition(this.matrixWorld);const r=_E.distanceTo(Pj)/e.zoom;i[0].object.visible=!0;let n,s;for(n=1,s=i.length;n<s&&r>=i[n].distance;n++)i[n-1].object.visible=!1,i[n].object.visible=!0;for(this._currentLevel=n-1;n<s;n++)i[n].object.visible=!1}}toJSON(e){const i=super.toJSON(e);this.autoUpdate===!1&&(i.object.autoUpdate=!1),i.object.levels=[];const r=this.levels;for(let n=0,s=r.length;n<s;n++){const a=r[n];i.object.levels.push({object:a.object.uuid,distance:a.distance})}return i}}const Dj=new le,Rj=new rr,Ij=new rr,Ebe=new le,Lj=new ui;class D4 extends Ms{constructor(e,i){super(e,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ui,this.bindMatrixInverse=new ui}copy(e,i){return super.copy(e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,i){this.skeleton=e,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new rr,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){e.fromBufferAttribute(i,r);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),i.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,i){const r=this.skeleton,n=this.geometry;Rj.fromBufferAttribute(n.attributes.skinIndex,e),Ij.fromBufferAttribute(n.attributes.skinWeight,e),Dj.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let s=0;s<4;s++){const a=Ij.getComponent(s);if(a!==0){const o=Rj.getComponent(s);Lj.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),i.addScaledVector(Ebe.copy(Dj).applyMatrix4(Lj),a)}}return i.applyMatrix4(this.bindMatrixInverse)}}class cD extends zi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class _y extends kr{constructor(e=null,i=1,r=1,n,s,a,o,l,c=xn,h=xn,u,d){super(null,a,o,l,c,h,n,s,u,d),this.isDataTexture=!0,this.image={data:e,width:i,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Oj=new ui,Mbe=new ui;class s_{constructor(e=[],i=[]){this.uuid=Vo(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new ui)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){const r=new ui;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,i=this.boneInverses,r=this.boneMatrices,n=this.boneTexture;for(let s=0,a=e.length;s<a;s++){const o=e[s]?e[s].matrixWorld:Mbe;Oj.multiplyMatrices(o,i[s]),Oj.toArray(r,s*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new s_(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=die(e),e=Math.max(e,4);const i=new Float32Array(e*e*4);i.set(this.boneMatrices);const r=new _y(i,e,e,so,Wu);return r.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=r,this.boneTextureSize=e,this}getBoneByName(e){for(let i=0,r=this.bones.length;i<r;i++){const n=this.bones[i];if(n.name===e)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let r=0,n=e.bones.length;r<n;r++){const s=e.bones[r];let a=i[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new cD),this.bones.push(a),this.boneInverses.push(new ui().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const i=this.bones,r=this.boneInverses;for(let n=0,s=i.length;n<s;n++){const a=i[n];e.bones.push(a.uuid);const o=r[n];e.boneInverses.push(o.toArray())}return e}}class Og extends Xi{constructor(e,i,r,n=1){super(e,i,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Bj=new ui,Fj=new ui,AE=[],Tbe=new ui,Vx=new Ms;class R4 extends Ms{constructor(e,i,r){super(e,i),this.isInstancedMesh=!0,this.instanceMatrix=new Og(new Float32Array(r*16),16),this.instanceColor=null,this.count=r,this.frustumCulled=!1;for(let n=0;n<r;n++)this.setMatrixAt(n,Tbe)}copy(e,i){return super.copy(e,i),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,i){i.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,i){i.fromArray(this.instanceMatrix.array,e*16)}raycast(e,i){const r=this.matrixWorld,n=this.count;if(Vx.geometry=this.geometry,Vx.material=this.material,Vx.material!==void 0)for(let s=0;s<n;s++){this.getMatrixAt(s,Bj),Fj.multiplyMatrices(r,Bj),Vx.matrixWorld=Fj,Vx.raycast(e,AE);for(let a=0,o=AE.length;a<o;a++){const l=AE[a];l.instanceId=s,l.object=this,i.push(l)}AE.length=0}}setColorAt(e,i){this.instanceColor===null&&(this.instanceColor=new Og(new Float32Array(this.instanceMatrix.count*3),3)),i.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,i){i.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class wa extends kn{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ct(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const kj=new le,Nj=new le,Uj=new ui,cL=new L1,EE=new Ed;class dd extends zi{constructor(e=new xi,i=new wa){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,r=[0];for(let n=1,s=i.count;n<s;n++)kj.fromBufferAttribute(i,n-1),Nj.fromBufferAttribute(i,n),r[n]=r[n-1],r[n]+=kj.distanceTo(Nj);e.setAttribute("lineDistance",new zt(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){const r=this.geometry,n=this.matrixWorld,s=e.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),EE.copy(r.boundingSphere),EE.applyMatrix4(n),EE.radius+=s,e.ray.intersectsSphere(EE)===!1)return;Uj.copy(n).invert(),cL.copy(e.ray).applyMatrix4(Uj);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=new le,h=new le,u=new le,d=new le,f=this.isLineSegments?2:1,p=r.index,g=r.attributes.position;if(p!==null){const v=Math.max(0,a.start),y=Math.min(p.count,a.start+a.count);for(let x=v,S=y-1;x<S;x+=f){const A=p.getX(x),_=p.getX(x+1);if(c.fromBufferAttribute(g,A),h.fromBufferAttribute(g,_),cL.distanceSqToSegment(c,h,d,u)>l)continue;d.applyMatrix4(this.matrixWorld);const E=e.ray.origin.distanceTo(d);E<e.near||E>e.far||i.push({distance:E,point:u.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else{const v=Math.max(0,a.start),y=Math.min(g.count,a.start+a.count);for(let x=v,S=y-1;x<S;x+=f){if(c.fromBufferAttribute(g,x),h.fromBufferAttribute(g,x+1),cL.distanceSqToSegment(c,h,d,u)>l)continue;d.applyMatrix4(this.matrixWorld);const _=e.ray.origin.distanceTo(d);_<e.near||_>e.far||i.push({distance:_,point:u.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}const zj=new le,Gj=new le;class kc extends dd{constructor(e,i){super(e,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,r=[];for(let n=0,s=i.count;n<s;n+=2)zj.fromBufferAttribute(i,n),Gj.fromBufferAttribute(i,n+1),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+zj.distanceTo(Gj);e.setAttribute("lineDistance",new zt(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class I4 extends dd{constructor(e,i){super(e,i),this.isLineLoop=!0,this.type="LineLoop"}}class hD extends kn{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ct(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Vj=new ui,ek=new L1,ME=new Ed,TE=new le;class L4 extends zi{constructor(e=new xi,i=new hD){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=e.material,this.geometry=e.geometry,this}raycast(e,i){const r=this.geometry,n=this.matrixWorld,s=e.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),ME.copy(r.boundingSphere),ME.applyMatrix4(n),ME.radius+=s,e.ray.intersectsSphere(ME)===!1)return;Vj.copy(n).invert(),ek.copy(e.ray).applyMatrix4(Vj);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=r.index,u=r.attributes.position;if(c!==null){const d=Math.max(0,a.start),f=Math.min(c.count,a.start+a.count);for(let p=d,m=f;p<m;p++){const g=c.getX(p);TE.fromBufferAttribute(u,g),Hj(TE,g,l,n,e,i,this)}}else{const d=Math.max(0,a.start),f=Math.min(u.count,a.start+a.count);for(let p=d,m=f;p<m;p++)TE.fromBufferAttribute(u,p),Hj(TE,p,l,n,e,i,this)}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function Hj(t,e,i,r,n,s,a){const o=ek.distanceSqToPoint(t);if(o<i){const l=new le;ek.closestPointToPoint(t,l),l.applyMatrix4(r);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;s.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,object:a})}}class Cie extends kr{constructor(e,i,r,n,s,a,o,l,c){super(e,i,r,n,s,a,o,l,c),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:Hr,this.magFilter=s!==void 0?s:Hr,this.generateMipmaps=!1;const h=this;function u(){h.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Cbe extends kr{constructor(e,i,r){super({width:e,height:i}),this.isFramebufferTexture=!0,this.format=r,this.magFilter=xn,this.minFilter=xn,this.generateMipmaps=!1,this.needsUpdate=!0}}class O4 extends kr{constructor(e,i,r,n,s,a,o,l,c,h,u,d){super(null,a,o,l,c,h,n,s,u,d),this.isCompressedTexture=!0,this.image={width:i,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class Pbe extends O4{constructor(e,i,r,n,s,a){super(e,i,r,s,a),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=js}}class Dbe extends kr{constructor(e,i,r,n,s,a,o,l,c){super(e,i,r,n,s,a,o,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Nc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,i){const r=this.getUtoTmapping(e);return this.getPoint(r,i)}getPoints(e=5){const i=[];for(let r=0;r<=e;r++)i.push(this.getPoint(r/e));return i}getSpacedPoints(e=5){const i=[];for(let r=0;r<=e;r++)i.push(this.getPointAt(r/e));return i}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let r,n=this.getPoint(0),s=0;i.push(0);for(let a=1;a<=e;a++)r=this.getPoint(a/e),s+=r.distanceTo(n),i.push(s),n=r;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i){const r=this.getLengths();let n=0;const s=r.length;let a;i?a=i:a=e*r[s-1];let o=0,l=s-1,c;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),c=r[n]-a,c<0)o=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,r[n]===a)return n/(s-1);const h=r[n],d=r[n+1]-h,f=(a-h)/d;return(n+f)/(s-1)}getTangent(e,i){let n=e-1e-4,s=e+1e-4;n<0&&(n=0),s>1&&(s=1);const a=this.getPoint(n),o=this.getPoint(s),l=i||(a.isVector2?new tt:new le);return l.copy(o).sub(a).normalize(),l}getTangentAt(e,i){const r=this.getUtoTmapping(e);return this.getTangent(r,i)}computeFrenetFrames(e,i){const r=new le,n=[],s=[],a=[],o=new le,l=new ui;for(let f=0;f<=e;f++){const p=f/e;n[f]=this.getTangentAt(p,new le)}s[0]=new le,a[0]=new le;let c=Number.MAX_VALUE;const h=Math.abs(n[0].x),u=Math.abs(n[0].y),d=Math.abs(n[0].z);h<=c&&(c=h,r.set(1,0,0)),u<=c&&(c=u,r.set(0,1,0)),d<=c&&r.set(0,0,1),o.crossVectors(n[0],r).normalize(),s[0].crossVectors(n[0],o),a[0].crossVectors(n[0],s[0]);for(let f=1;f<=e;f++){if(s[f]=s[f-1].clone(),a[f]=a[f-1].clone(),o.crossVectors(n[f-1],n[f]),o.length()>Number.EPSILON){o.normalize();const p=Math.acos(bn(n[f-1].dot(n[f]),-1,1));s[f].applyMatrix4(l.makeRotationAxis(o,p))}a[f].crossVectors(n[f],s[f])}if(i===!0){let f=Math.acos(bn(s[0].dot(s[e]),-1,1));f/=e,n[0].dot(o.crossVectors(s[0],s[e]))>0&&(f=-f);for(let p=1;p<=e;p++)s[p].applyMatrix4(l.makeRotationAxis(n[p],f*p)),a[p].crossVectors(n[p],s[p])}return{tangents:n,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class uD extends Nc{constructor(e=0,i=0,r=1,n=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=r,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(e,i){const r=i||new tt,n=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(a?s=0:s=n),this.aClockwise===!0&&!a&&(s===n?s=-n:s=s-n);const o=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const h=Math.cos(this.aRotation),u=Math.sin(this.aRotation),d=l-this.aX,f=c-this.aY;l=d*h-f*u+this.aX,c=d*u+f*h+this.aY}return r.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Pie extends uD{constructor(e,i,r,n,s,a){super(e,i,r,r,n,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function B4(){let t=0,e=0,i=0,r=0;function n(s,a,o,l){t=s,e=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,h,u){let d=(a-s)/c-(o-s)/(c+h)+(o-a)/h,f=(o-a)/h-(l-a)/(h+u)+(l-o)/u;d*=h,f*=h,n(a,o,d,f)},calc:function(s){const a=s*s,o=a*s;return t+e*s+i*a+r*o}}}const CE=new le,hL=new B4,uL=new B4,dL=new B4;class Die extends Nc{constructor(e=[],i=!1,r="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=r,this.tension=n}getPoint(e,i=new le){const r=i,n=this.points,s=n.length,a=(s-(this.closed?0:1))*e;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let c,h;this.closed||o>0?c=n[(o-1)%s]:(CE.subVectors(n[0],n[1]).add(n[0]),c=CE);const u=n[o%s],d=n[(o+1)%s];if(this.closed||o+2<s?h=n[(o+2)%s]:(CE.subVectors(n[s-1],n[s-2]).add(n[s-1]),h=CE),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let p=Math.pow(c.distanceToSquared(u),f),m=Math.pow(u.distanceToSquared(d),f),g=Math.pow(d.distanceToSquared(h),f);m<1e-4&&(m=1),p<1e-4&&(p=m),g<1e-4&&(g=m),hL.initNonuniformCatmullRom(c.x,u.x,d.x,h.x,p,m,g),uL.initNonuniformCatmullRom(c.y,u.y,d.y,h.y,p,m,g),dL.initNonuniformCatmullRom(c.z,u.z,d.z,h.z,p,m,g)}else this.curveType==="catmullrom"&&(hL.initCatmullRom(c.x,u.x,d.x,h.x,this.tension),uL.initCatmullRom(c.y,u.y,d.y,h.y,this.tension),dL.initCatmullRom(c.z,u.z,d.z,h.z,this.tension));return r.set(hL.calc(l),uL.calc(l),dL.calc(l)),r}copy(e){super.copy(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const n=e.points[i];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const n=e.points[i];this.points.push(new le().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function jj(t,e,i,r,n){const s=(r-e)*.5,a=(n-i)*.5,o=t*t,l=t*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*t+i}function Rbe(t,e){const i=1-t;return i*i*e}function Ibe(t,e){return 2*(1-t)*t*e}function Lbe(t,e){return t*t*e}function sw(t,e,i,r){return Rbe(t,e)+Ibe(t,i)+Lbe(t,r)}function Obe(t,e){const i=1-t;return i*i*i*e}function Bbe(t,e){const i=1-t;return 3*i*i*t*e}function Fbe(t,e){return 3*(1-t)*t*t*e}function kbe(t,e){return t*t*t*e}function aw(t,e,i,r,n){return Obe(t,e)+Bbe(t,i)+Fbe(t,r)+kbe(t,n)}class F4 extends Nc{constructor(e=new tt,i=new tt,r=new tt,n=new tt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=i,this.v2=r,this.v3=n}getPoint(e,i=new tt){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(aw(e,n.x,s.x,a.x,o.x),aw(e,n.y,s.y,a.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Rie extends Nc{constructor(e=new le,i=new le,r=new le,n=new le){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=r,this.v3=n}getPoint(e,i=new le){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(aw(e,n.x,s.x,a.x,o.x),aw(e,n.y,s.y,a.y,o.y),aw(e,n.z,s.z,a.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class dD extends Nc{constructor(e=new tt,i=new tt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new tt){const r=i;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i){const r=i||new tt;return r.copy(this.v2).sub(this.v1).normalize(),r}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Iie extends Nc{constructor(e=new le,i=new le){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new le){const r=i;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,i){return this.getPoint(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class k4 extends Nc{constructor(e=new tt,i=new tt,r=new tt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=r}getPoint(e,i=new tt){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(sw(e,n.x,s.x,a.x),sw(e,n.y,s.y,a.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class N4 extends Nc{constructor(e=new le,i=new le,r=new le){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=r}getPoint(e,i=new le){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(sw(e,n.x,s.x,a.x),sw(e,n.y,s.y,a.y),sw(e,n.z,s.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class U4 extends Nc{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new tt){const r=i,n=this.points,s=(n.length-1)*e,a=Math.floor(s),o=s-a,l=n[a===0?a:a-1],c=n[a],h=n[a>n.length-2?n.length-1:a+1],u=n[a>n.length-3?n.length-1:a+2];return r.set(jj(o,l.x,c.x,h.x,u.x),jj(o,l.y,c.y,h.y,u.y)),r}copy(e){super.copy(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const n=e.points[i];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const n=e.points[i];this.points.push(new tt().fromArray(n))}return this}}var z4=Object.freeze({__proto__:null,ArcCurve:Pie,CatmullRomCurve3:Die,CubicBezierCurve:F4,CubicBezierCurve3:Rie,EllipseCurve:uD,LineCurve:dD,LineCurve3:Iie,QuadraticBezierCurve:k4,QuadraticBezierCurve3:N4,SplineCurve:U4});class Lie extends Nc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);e.equals(i)||this.curves.push(new dD(i,e))}getPoint(e,i){const r=e*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=r){const a=n[s]-r,o=this.curves[s],l=o.getLength(),c=l===0?0:1-a/l;return o.getPointAt(c,i)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let i=0;for(let r=0,n=this.curves.length;r<n;r++)i+=this.curves[r].getLength(),e.push(i);return this.cacheLengths=e,e}getSpacedPoints(e=40){const i=[];for(let r=0;r<=e;r++)i.push(this.getPoint(r/e));return this.autoClose&&i.push(i[0]),i}getPoints(e=12){const i=[];let r;for(let n=0,s=this.curves;n<s.length;n++){const a=s[n],o=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,l=a.getPoints(o);for(let c=0;c<l.length;c++){const h=l[c];r&&r.equals(h)||(i.push(h),r=h)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(e){super.copy(e),this.curves=[];for(let i=0,r=e.curves.length;i<r;i++){const n=e.curves[i];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let i=0,r=this.curves.length;i<r;i++){const n=this.curves[i];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let i=0,r=e.curves.length;i<r;i++){const n=e.curves[i];this.curves.push(new z4[n.type]().fromJSON(n))}return this}}class rS extends Lie{constructor(e){super(),this.type="Path",this.currentPoint=new tt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let i=1,r=e.length;i<r;i++)this.lineTo(e[i].x,e[i].y);return this}moveTo(e,i){return this.currentPoint.set(e,i),this}lineTo(e,i){const r=new dD(this.currentPoint.clone(),new tt(e,i));return this.curves.push(r),this.currentPoint.set(e,i),this}quadraticCurveTo(e,i,r,n){const s=new k4(this.currentPoint.clone(),new tt(e,i),new tt(r,n));return this.curves.push(s),this.currentPoint.set(r,n),this}bezierCurveTo(e,i,r,n,s,a){const o=new F4(this.currentPoint.clone(),new tt(e,i),new tt(r,n),new tt(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(e){const i=[this.currentPoint.clone()].concat(e),r=new U4(i);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,i,r,n,s,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,i+l,r,n,s,a),this}absarc(e,i,r,n,s,a){return this.absellipse(e,i,r,r,n,s,a),this}ellipse(e,i,r,n,s,a,o,l){const c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+c,i+h,r,n,s,a,o,l),this}absellipse(e,i,r,n,s,a,o,l){const c=new uD(e,i,r,n,s,a,o,l);if(this.curves.length>0){const u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class F1 extends xi{constructor(e=[new tt(0,-.5),new tt(.5,0),new tt(0,.5)],i=12,r=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:i,phiStart:r,phiLength:n},i=Math.floor(i),n=bn(n,0,Math.PI*2);const s=[],a=[],o=[],l=[],c=[],h=1/i,u=new le,d=new tt,f=new le,p=new le,m=new le;let g=0,v=0;for(let y=0;y<=e.length-1;y++)switch(y){case 0:g=e[y+1].x-e[y].x,v=e[y+1].y-e[y].y,f.x=v*1,f.y=-g,f.z=v*0,m.copy(f),f.normalize(),l.push(f.x,f.y,f.z);break;case e.length-1:l.push(m.x,m.y,m.z);break;default:g=e[y+1].x-e[y].x,v=e[y+1].y-e[y].y,f.x=v*1,f.y=-g,f.z=v*0,p.copy(f),f.x+=m.x,f.y+=m.y,f.z+=m.z,f.normalize(),l.push(f.x,f.y,f.z),m.copy(p)}for(let y=0;y<=i;y++){const x=r+y*h*n,S=Math.sin(x),A=Math.cos(x);for(let _=0;_<=e.length-1;_++){u.x=e[_].x*S,u.y=e[_].y,u.z=e[_].x*A,a.push(u.x,u.y,u.z),d.x=y/i,d.y=_/(e.length-1),o.push(d.x,d.y);const M=l[3*_+0]*S,E=l[3*_+1],T=l[3*_+0]*A;c.push(M,E,T)}}for(let y=0;y<i;y++)for(let x=0;x<e.length-1;x++){const S=x+y*e.length,A=S,_=S+e.length,M=S+e.length+1,E=S+1;s.push(A,_,E),s.push(M,E,_)}this.setIndex(s),this.setAttribute("position",new zt(a,3)),this.setAttribute("uv",new zt(o,2)),this.setAttribute("normal",new zt(c,3))}static fromJSON(e){return new F1(e.points,e.segments,e.phiStart,e.phiLength)}}class a_ extends F1{constructor(e=1,i=1,r=4,n=8){const s=new rS;s.absarc(0,-i/2,e,Math.PI*1.5,0),s.absarc(0,i/2,e,0,Math.PI*.5),super(s.getPoints(r),n),this.type="CapsuleGeometry",this.parameters={radius:e,height:i,capSegments:r,radialSegments:n}}static fromJSON(e){return new a_(e.radius,e.length,e.capSegments,e.radialSegments)}}class o_ extends xi{constructor(e=1,i=8,r=0,n=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:i,thetaStart:r,thetaLength:n},i=Math.max(3,i);const s=[],a=[],o=[],l=[],c=new le,h=new tt;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let u=0,d=3;u<=i;u++,d+=3){const f=r+u/i*n;c.x=e*Math.cos(f),c.y=e*Math.sin(f),a.push(c.x,c.y,c.z),o.push(0,0,1),h.x=(a[d]/e+1)/2,h.y=(a[d+1]/e+1)/2,l.push(h.x,h.y)}for(let u=1;u<=i;u++)s.push(u,u+1,0);this.setIndex(s),this.setAttribute("position",new zt(a,3)),this.setAttribute("normal",new zt(o,3)),this.setAttribute("uv",new zt(l,2))}static fromJSON(e){return new o_(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Zg extends xi{constructor(e=1,i=1,r=1,n=8,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const c=this;n=Math.floor(n),s=Math.floor(s);const h=[],u=[],d=[],f=[];let p=0;const m=[],g=r/2;let v=0;y(),a===!1&&(e>0&&x(!0),i>0&&x(!1)),this.setIndex(h),this.setAttribute("position",new zt(u,3)),this.setAttribute("normal",new zt(d,3)),this.setAttribute("uv",new zt(f,2));function y(){const S=new le,A=new le;let _=0;const M=(i-e)/r;for(let E=0;E<=s;E++){const T=[],C=E/s,D=C*(i-e)+e;for(let B=0;B<=n;B++){const O=B/n,L=O*l+o,H=Math.sin(L),q=Math.cos(L);A.x=D*H,A.y=-C*r+g,A.z=D*q,u.push(A.x,A.y,A.z),S.set(H,M,q).normalize(),d.push(S.x,S.y,S.z),f.push(O,1-C),T.push(p++)}m.push(T)}for(let E=0;E<n;E++)for(let T=0;T<s;T++){const C=m[T][E],D=m[T+1][E],B=m[T+1][E+1],O=m[T][E+1];h.push(C,D,O),h.push(D,B,O),_+=6}c.addGroup(v,_,0),v+=_}function x(S){const A=p,_=new tt,M=new le;let E=0;const T=S===!0?e:i,C=S===!0?1:-1;for(let B=1;B<=n;B++)u.push(0,g*C,0),d.push(0,C,0),f.push(.5,.5),p++;const D=p;for(let B=0;B<=n;B++){const L=B/n*l+o,H=Math.cos(L),q=Math.sin(L);M.x=T*q,M.y=g*C,M.z=T*H,u.push(M.x,M.y,M.z),d.push(0,C,0),_.x=H*.5+.5,_.y=q*.5*C+.5,f.push(_.x,_.y),p++}for(let B=0;B<n;B++){const O=A+B,L=D+B;S===!0?h.push(L,L+1,O):h.push(L+1,L,O),E+=3}c.addGroup(v,E,S===!0?1:2),v+=E}}static fromJSON(e){return new Zg(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class l_ extends Zg{constructor(e=1,i=1,r=8,n=1,s=!1,a=0,o=Math.PI*2){super(0,e,i,r,n,s,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(e){return new l_(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Md extends xi{constructor(e=[],i=[],r=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:i,radius:r,detail:n};const s=[],a=[];o(n),c(r),h(),this.setAttribute("position",new zt(s,3)),this.setAttribute("normal",new zt(s.slice(),3)),this.setAttribute("uv",new zt(a,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function o(y){const x=new le,S=new le,A=new le;for(let _=0;_<i.length;_+=3)f(i[_+0],x),f(i[_+1],S),f(i[_+2],A),l(x,S,A,y)}function l(y,x,S,A){const _=A+1,M=[];for(let E=0;E<=_;E++){M[E]=[];const T=y.clone().lerp(S,E/_),C=x.clone().lerp(S,E/_),D=_-E;for(let B=0;B<=D;B++)B===0&&E===_?M[E][B]=T:M[E][B]=T.clone().lerp(C,B/D)}for(let E=0;E<_;E++)for(let T=0;T<2*(_-E)-1;T++){const C=Math.floor(T/2);T%2===0?(d(M[E][C+1]),d(M[E+1][C]),d(M[E][C])):(d(M[E][C+1]),d(M[E+1][C+1]),d(M[E+1][C]))}}function c(y){const x=new le;for(let S=0;S<s.length;S+=3)x.x=s[S+0],x.y=s[S+1],x.z=s[S+2],x.normalize().multiplyScalar(y),s[S+0]=x.x,s[S+1]=x.y,s[S+2]=x.z}function h(){const y=new le;for(let x=0;x<s.length;x+=3){y.x=s[x+0],y.y=s[x+1],y.z=s[x+2];const S=g(y)/2/Math.PI+.5,A=v(y)/Math.PI+.5;a.push(S,1-A)}p(),u()}function u(){for(let y=0;y<a.length;y+=6){const x=a[y+0],S=a[y+2],A=a[y+4],_=Math.max(x,S,A),M=Math.min(x,S,A);_>.9&&M<.1&&(x<.2&&(a[y+0]+=1),S<.2&&(a[y+2]+=1),A<.2&&(a[y+4]+=1))}}function d(y){s.push(y.x,y.y,y.z)}function f(y,x){const S=y*3;x.x=e[S+0],x.y=e[S+1],x.z=e[S+2]}function p(){const y=new le,x=new le,S=new le,A=new le,_=new tt,M=new tt,E=new tt;for(let T=0,C=0;T<s.length;T+=9,C+=6){y.set(s[T+0],s[T+1],s[T+2]),x.set(s[T+3],s[T+4],s[T+5]),S.set(s[T+6],s[T+7],s[T+8]),_.set(a[C+0],a[C+1]),M.set(a[C+2],a[C+3]),E.set(a[C+4],a[C+5]),A.copy(y).add(x).add(S).divideScalar(3);const D=g(A);m(_,C+0,y,D),m(M,C+2,x,D),m(E,C+4,S,D)}}function m(y,x,S,A){A<0&&y.x===1&&(a[x]=y.x-1),S.x===0&&S.z===0&&(a[x]=A/2/Math.PI+.5)}function g(y){return Math.atan2(y.z,-y.x)}function v(y){return Math.atan2(-y.y,Math.sqrt(y.x*y.x+y.z*y.z))}}static fromJSON(e){return new Md(e.vertices,e.indices,e.radius,e.details)}}class c_ extends Md{constructor(e=1,i=0){const r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,e,i),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new c_(e.radius,e.detail)}}const PE=new le,DE=new le,fL=new le,RE=new Il;class Oie extends xi{constructor(e=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:i},e!==null){const n=Math.pow(10,4),s=Math.cos(cg*i),a=e.getIndex(),o=e.getAttribute("position"),l=a?a.count:o.count,c=[0,0,0],h=["a","b","c"],u=new Array(3),d={},f=[];for(let p=0;p<l;p+=3){a?(c[0]=a.getX(p),c[1]=a.getX(p+1),c[2]=a.getX(p+2)):(c[0]=p,c[1]=p+1,c[2]=p+2);const{a:m,b:g,c:v}=RE;if(m.fromBufferAttribute(o,c[0]),g.fromBufferAttribute(o,c[1]),v.fromBufferAttribute(o,c[2]),RE.getNormal(fL),u[0]=`${Math.round(m.x*n)},${Math.round(m.y*n)},${Math.round(m.z*n)}`,u[1]=`${Math.round(g.x*n)},${Math.round(g.y*n)},${Math.round(g.z*n)}`,u[2]=`${Math.round(v.x*n)},${Math.round(v.y*n)},${Math.round(v.z*n)}`,!(u[0]===u[1]||u[1]===u[2]||u[2]===u[0]))for(let y=0;y<3;y++){const x=(y+1)%3,S=u[y],A=u[x],_=RE[h[y]],M=RE[h[x]],E=`${S}_${A}`,T=`${A}_${S}`;T in d&&d[T]?(fL.dot(d[T].normal)<=s&&(f.push(_.x,_.y,_.z),f.push(M.x,M.y,M.z)),d[T]=null):E in d||(d[E]={index0:c[y],index1:c[x],normal:fL.clone()})}}for(const p in d)if(d[p]){const{index0:m,index1:g}=d[p];PE.fromBufferAttribute(o,m),DE.fromBufferAttribute(o,g),f.push(PE.x,PE.y,PE.z),f.push(DE.x,DE.y,DE.z)}this.setAttribute("position",new zt(f,3))}}}class dg extends rS{constructor(e){super(e),this.uuid=Vo(),this.type="Shape",this.holes=[]}getPointsHoles(e){const i=[];for(let r=0,n=this.holes.length;r<n;r++)i[r]=this.holes[r].getPoints(e);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let i=0,r=e.holes.length;i<r;i++){const n=e.holes[i];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let i=0,r=this.holes.length;i<r;i++){const n=this.holes[i];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let i=0,r=e.holes.length;i<r;i++){const n=e.holes[i];this.holes.push(new rS().fromJSON(n))}return this}}const Nbe={triangulate:function(t,e,i=2){const r=e&&e.length,n=r?e[0]*i:t.length;let s=Bie(t,0,n,i,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,h,u,d,f;if(r&&(s=Hbe(t,e,s,i)),t.length>80*i){o=c=t[0],l=h=t[1];for(let p=i;p<n;p+=i)u=t[p],d=t[p+1],u<o&&(o=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);f=Math.max(c-o,h-l),f=f!==0?32767/f:0}return nS(s,a,i,o,l,f,0),a}};function Bie(t,e,i,r,n){let s,a;if(n===ewe(t,e,i,r)>0)for(s=e;s<i;s+=r)a=Wj(s,t[s],t[s+1],a);else for(s=i-r;s>=e;s-=r)a=Wj(s,t[s],t[s+1],a);return a&&fD(a,a.next)&&(aS(a),a=a.next),a}function Bg(t,e){if(!t)return t;e||(e=t);let i=t,r;do if(r=!1,!i.steiner&&(fD(i,i.next)||jr(i.prev,i,i.next)===0)){if(aS(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function nS(t,e,i,r,n,s,a){if(!t)return;!a&&s&&qbe(t,r,n,s);let o=t,l,c;for(;t.prev!==t.next;){if(l=t.prev,c=t.next,s?zbe(t,r,n,s):Ube(t)){e.push(l.i/i|0),e.push(t.i/i|0),e.push(c.i/i|0),aS(t),t=c.next,o=c.next;continue}if(t=c,t===o){a?a===1?(t=Gbe(Bg(t),e,i),nS(t,e,i,r,n,s,2)):a===2&&Vbe(t,e,i,r,n,s):nS(Bg(t),e,i,r,n,s,1);break}}}function Ube(t){const e=t.prev,i=t,r=t.next;if(jr(e,i,r)>=0)return!1;const n=e.x,s=i.x,a=r.x,o=e.y,l=i.y,c=r.y,h=n<s?n<a?n:a:s<a?s:a,u=o<l?o<c?o:c:l<c?l:c,d=n>s?n>a?n:a:s>a?s:a,f=o>l?o>c?o:c:l>c?l:c;let p=r.next;for(;p!==e;){if(p.x>=h&&p.x<=d&&p.y>=u&&p.y<=f&&Jv(n,o,s,l,a,c,p.x,p.y)&&jr(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function zbe(t,e,i,r){const n=t.prev,s=t,a=t.next;if(jr(n,s,a)>=0)return!1;const o=n.x,l=s.x,c=a.x,h=n.y,u=s.y,d=a.y,f=o<l?o<c?o:c:l<c?l:c,p=h<u?h<d?h:d:u<d?u:d,m=o>l?o>c?o:c:l>c?l:c,g=h>u?h>d?h:d:u>d?u:d,v=tk(f,p,e,i,r),y=tk(m,g,e,i,r);let x=t.prevZ,S=t.nextZ;for(;x&&x.z>=v&&S&&S.z<=y;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==n&&x!==a&&Jv(o,h,l,u,c,d,x.x,x.y)&&jr(x.prev,x,x.next)>=0||(x=x.prevZ,S.x>=f&&S.x<=m&&S.y>=p&&S.y<=g&&S!==n&&S!==a&&Jv(o,h,l,u,c,d,S.x,S.y)&&jr(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;x&&x.z>=v;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==n&&x!==a&&Jv(o,h,l,u,c,d,x.x,x.y)&&jr(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;S&&S.z<=y;){if(S.x>=f&&S.x<=m&&S.y>=p&&S.y<=g&&S!==n&&S!==a&&Jv(o,h,l,u,c,d,S.x,S.y)&&jr(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function Gbe(t,e,i){let r=t;do{const n=r.prev,s=r.next.next;!fD(n,s)&&Fie(n,r,r.next,s)&&sS(n,s)&&sS(s,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(s.i/i|0),aS(r),aS(r.next),r=t=s),r=r.next}while(r!==t);return Bg(r)}function Vbe(t,e,i,r,n,s){let a=t;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&$be(a,o)){let l=kie(a,o);a=Bg(a,a.next),l=Bg(l,l.next),nS(a,e,i,r,n,s,0),nS(l,e,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==t)}function Hbe(t,e,i,r){const n=[];let s,a,o,l,c;for(s=0,a=e.length;s<a;s++)o=e[s]*r,l=s<a-1?e[s+1]*r:t.length,c=Bie(t,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(Qbe(c));for(n.sort(jbe),s=0;s<n.length;s++)i=Wbe(n[s],i);return i}function jbe(t,e){return t.x-e.x}function Wbe(t,e){const i=Xbe(t,e);if(!i)return e;const r=kie(i,t);return Bg(r,r.next),Bg(i,i.next)}function Xbe(t,e){let i=e,r=-1/0,n;const s=t.x,a=t.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==e);if(!n)return null;const o=n,l=n.x,c=n.y;let h=1/0,u;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&Jv(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(u=Math.abs(a-i.y)/(s-i.x),sS(i,t)&&(u<h||u===h&&(i.x>n.x||i.x===n.x&&Ybe(n,i)))&&(n=i,h=u)),i=i.next;while(i!==o);return n}function Ybe(t,e){return jr(t.prev,t,e.prev)<0&&jr(e.next,t,t.next)<0}function qbe(t,e,i,r){let n=t;do n.z===0&&(n.z=tk(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,Kbe(n)}function Kbe(t){let e,i,r,n,s,a,o,l,c=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,r=i,o=0,e=0;e<c&&(o++,r=r.nextZ,!!r);e++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return t}function tk(t,e,i,r,n){return t=(t-i)*n|0,e=(e-r)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Qbe(t){let e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Jv(t,e,i,r,n,s,a,o){return(n-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(r-o)>=(i-a)*(e-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function $be(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Jbe(t,e)&&(sS(t,e)&&sS(e,t)&&Zbe(t,e)&&(jr(t.prev,t,e.prev)||jr(t,e.prev,e))||fD(t,e)&&jr(t.prev,t,t.next)>0&&jr(e.prev,e,e.next)>0)}function jr(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function fD(t,e){return t.x===e.x&&t.y===e.y}function Fie(t,e,i,r){const n=LE(jr(t,e,i)),s=LE(jr(t,e,r)),a=LE(jr(i,r,t)),o=LE(jr(i,r,e));return!!(n!==s&&a!==o||n===0&&IE(t,i,e)||s===0&&IE(t,r,e)||a===0&&IE(i,t,r)||o===0&&IE(i,e,r))}function IE(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function LE(t){return t>0?1:t<0?-1:0}function Jbe(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Fie(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function sS(t,e){return jr(t.prev,t,t.next)<0?jr(t,e,t.next)>=0&&jr(t,t.prev,e)>=0:jr(t,e,t.prev)<0||jr(t,t.next,e)<0}function Zbe(t,e){let i=t,r=!1;const n=(t.x+e.x)/2,s=(t.y+e.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function kie(t,e){const i=new ik(t.i,t.x,t.y),r=new ik(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function Wj(t,e,i,r){const n=new ik(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function aS(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ik(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ewe(t,e,i,r){let n=0;for(let s=e,a=i-r;s<i;s+=r)n+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return n}class Rh{static area(e){const i=e.length;let r=0;for(let n=i-1,s=0;s<i;n=s++)r+=e[n].x*e[s].y-e[s].x*e[n].y;return r*.5}static isClockWise(e){return Rh.area(e)<0}static triangulateShape(e,i){const r=[],n=[],s=[];Xj(e),Yj(r,e);let a=e.length;i.forEach(Xj);for(let l=0;l<i.length;l++)n.push(a),a+=i[l].length,Yj(r,i[l]);const o=Nbe.triangulate(r,n);for(let l=0;l<o.length;l+=3)s.push(o.slice(l,l+3));return s}}function Xj(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Yj(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class h_ extends xi{constructor(e=new dg([new tt(.5,.5),new tt(-.5,.5),new tt(-.5,-.5),new tt(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:i},e=Array.isArray(e)?e:[e];const r=this,n=[],s=[];for(let o=0,l=e.length;o<l;o++){const c=e[o];a(c)}this.setAttribute("position",new zt(n,3)),this.setAttribute("uv",new zt(s,2)),this.computeVertexNormals();function a(o){const l=[],c=i.curveSegments!==void 0?i.curveSegments:12,h=i.steps!==void 0?i.steps:1,u=i.depth!==void 0?i.depth:1;let d=i.bevelEnabled!==void 0?i.bevelEnabled:!0,f=i.bevelThickness!==void 0?i.bevelThickness:.2,p=i.bevelSize!==void 0?i.bevelSize:f-.1,m=i.bevelOffset!==void 0?i.bevelOffset:0,g=i.bevelSegments!==void 0?i.bevelSegments:3;const v=i.extrudePath,y=i.UVGenerator!==void 0?i.UVGenerator:twe;let x,S=!1,A,_,M,E;v&&(x=v.getSpacedPoints(h),S=!0,d=!1,A=v.computeFrenetFrames(h,!1),_=new le,M=new le,E=new le),d||(g=0,f=0,p=0,m=0);const T=o.extractPoints(c);let C=T.shape;const D=T.holes;if(!Rh.isClockWise(C)){C=C.reverse();for(let fe=0,pe=D.length;fe<pe;fe++){const Ie=D[fe];Rh.isClockWise(Ie)&&(D[fe]=Ie.reverse())}}const O=Rh.triangulateShape(C,D),L=C;for(let fe=0,pe=D.length;fe<pe;fe++){const Ie=D[fe];C=C.concat(Ie)}function H(fe,pe,Ie){return pe||console.error("THREE.ExtrudeGeometry: vec does not exist"),pe.clone().multiplyScalar(Ie).add(fe)}const q=C.length,W=O.length;function I(fe,pe,Ie){let Le,Ge,Ke;const Ve=fe.x-pe.x,ke=fe.y-pe.y,ut=Ie.x-fe.x,dt=Ie.y-fe.y,V=Ve*Ve+ke*ke,F=Ve*dt-ke*ut;if(Math.abs(F)>Number.EPSILON){const oe=Math.sqrt(V),Ce=Math.sqrt(ut*ut+dt*dt),K=pe.x-ke/oe,Re=pe.y+Ve/oe,Ze=Ie.x-dt/Ce,Ne=Ie.y+ut/Ce,me=((Ze-K)*dt-(Ne-Re)*ut)/(Ve*dt-ke*ut);Le=K+Ve*me-fe.x,Ge=Re+ke*me-fe.y;const $e=Le*Le+Ge*Ge;if($e<=2)return new tt(Le,Ge);Ke=Math.sqrt($e/2)}else{let oe=!1;Ve>Number.EPSILON?ut>Number.EPSILON&&(oe=!0):Ve<-Number.EPSILON?ut<-Number.EPSILON&&(oe=!0):Math.sign(ke)===Math.sign(dt)&&(oe=!0),oe?(Le=-ke,Ge=Ve,Ke=Math.sqrt(V)):(Le=Ve,Ge=ke,Ke=Math.sqrt(V/2))}return new tt(Le/Ke,Ge/Ke)}const z=[];for(let fe=0,pe=L.length,Ie=pe-1,Le=fe+1;fe<pe;fe++,Ie++,Le++)Ie===pe&&(Ie=0),Le===pe&&(Le=0),z[fe]=I(L[fe],L[Ie],L[Le]);const U=[];let X,Q=z.concat();for(let fe=0,pe=D.length;fe<pe;fe++){const Ie=D[fe];X=[];for(let Le=0,Ge=Ie.length,Ke=Ge-1,Ve=Le+1;Le<Ge;Le++,Ke++,Ve++)Ke===Ge&&(Ke=0),Ve===Ge&&(Ve=0),X[Le]=I(Ie[Le],Ie[Ke],Ie[Ve]);U.push(X),Q=Q.concat(X)}for(let fe=0;fe<g;fe++){const pe=fe/g,Ie=f*Math.cos(pe*Math.PI/2),Le=p*Math.sin(pe*Math.PI/2)+m;for(let Ge=0,Ke=L.length;Ge<Ke;Ge++){const Ve=H(L[Ge],z[Ge],Le);Ae(Ve.x,Ve.y,-Ie)}for(let Ge=0,Ke=D.length;Ge<Ke;Ge++){const Ve=D[Ge];X=U[Ge];for(let ke=0,ut=Ve.length;ke<ut;ke++){const dt=H(Ve[ke],X[ke],Le);Ae(dt.x,dt.y,-Ie)}}}const re=p+m;for(let fe=0;fe<q;fe++){const pe=d?H(C[fe],Q[fe],re):C[fe];S?(M.copy(A.normals[0]).multiplyScalar(pe.x),_.copy(A.binormals[0]).multiplyScalar(pe.y),E.copy(x[0]).add(M).add(_),Ae(E.x,E.y,E.z)):Ae(pe.x,pe.y,0)}for(let fe=1;fe<=h;fe++)for(let pe=0;pe<q;pe++){const Ie=d?H(C[pe],Q[pe],re):C[pe];S?(M.copy(A.normals[fe]).multiplyScalar(Ie.x),_.copy(A.binormals[fe]).multiplyScalar(Ie.y),E.copy(x[fe]).add(M).add(_),Ae(E.x,E.y,E.z)):Ae(Ie.x,Ie.y,u/h*fe)}for(let fe=g-1;fe>=0;fe--){const pe=fe/g,Ie=f*Math.cos(pe*Math.PI/2),Le=p*Math.sin(pe*Math.PI/2)+m;for(let Ge=0,Ke=L.length;Ge<Ke;Ge++){const Ve=H(L[Ge],z[Ge],Le);Ae(Ve.x,Ve.y,u+Ie)}for(let Ge=0,Ke=D.length;Ge<Ke;Ge++){const Ve=D[Ge];X=U[Ge];for(let ke=0,ut=Ve.length;ke<ut;ke++){const dt=H(Ve[ke],X[ke],Le);S?Ae(dt.x,dt.y+x[h-1].y,x[h-1].x+Ie):Ae(dt.x,dt.y,u+Ie)}}}ie(),ce();function ie(){const fe=n.length/3;if(d){let pe=0,Ie=q*pe;for(let Le=0;Le<W;Le++){const Ge=O[Le];Se(Ge[2]+Ie,Ge[1]+Ie,Ge[0]+Ie)}pe=h+g*2,Ie=q*pe;for(let Le=0;Le<W;Le++){const Ge=O[Le];Se(Ge[0]+Ie,Ge[1]+Ie,Ge[2]+Ie)}}else{for(let pe=0;pe<W;pe++){const Ie=O[pe];Se(Ie[2],Ie[1],Ie[0])}for(let pe=0;pe<W;pe++){const Ie=O[pe];Se(Ie[0]+q*h,Ie[1]+q*h,Ie[2]+q*h)}}r.addGroup(fe,n.length/3-fe,0)}function ce(){const fe=n.length/3;let pe=0;Z(L,pe),pe+=L.length;for(let Ie=0,Le=D.length;Ie<Le;Ie++){const Ge=D[Ie];Z(Ge,pe),pe+=Ge.length}r.addGroup(fe,n.length/3-fe,1)}function Z(fe,pe){let Ie=fe.length;for(;--Ie>=0;){const Le=Ie;let Ge=Ie-1;Ge<0&&(Ge=fe.length-1);for(let Ke=0,Ve=h+g*2;Ke<Ve;Ke++){const ke=q*Ke,ut=q*(Ke+1),dt=pe+Le+ke,V=pe+Ge+ke,F=pe+Ge+ut,oe=pe+Le+ut;_e(dt,V,F,oe)}}}function Ae(fe,pe,Ie){l.push(fe),l.push(pe),l.push(Ie)}function Se(fe,pe,Ie){ve(fe),ve(pe),ve(Ie);const Le=n.length/3,Ge=y.generateTopUV(r,n,Le-3,Le-2,Le-1);Ee(Ge[0]),Ee(Ge[1]),Ee(Ge[2])}function _e(fe,pe,Ie,Le){ve(fe),ve(pe),ve(Le),ve(pe),ve(Ie),ve(Le);const Ge=n.length/3,Ke=y.generateSideWallUV(r,n,Ge-6,Ge-3,Ge-2,Ge-1);Ee(Ke[0]),Ee(Ke[1]),Ee(Ke[3]),Ee(Ke[1]),Ee(Ke[2]),Ee(Ke[3])}function ve(fe){n.push(l[fe*3+0]),n.push(l[fe*3+1]),n.push(l[fe*3+2])}function Ee(fe){s.push(fe.x),s.push(fe.y)}}}toJSON(){const e=super.toJSON(),i=this.parameters.shapes,r=this.parameters.options;return iwe(i,r,e)}static fromJSON(e,i){const r=[];for(let s=0,a=e.shapes.length;s<a;s++){const o=i[e.shapes[s]];r.push(o)}const n=e.options.extrudePath;return n!==void 0&&(e.options.extrudePath=new z4[n.type]().fromJSON(n)),new h_(r,e.options)}}const twe={generateTopUV:function(t,e,i,r,n){const s=e[i*3],a=e[i*3+1],o=e[r*3],l=e[r*3+1],c=e[n*3],h=e[n*3+1];return[new tt(s,a),new tt(o,l),new tt(c,h)]},generateSideWallUV:function(t,e,i,r,n,s){const a=e[i*3],o=e[i*3+1],l=e[i*3+2],c=e[r*3],h=e[r*3+1],u=e[r*3+2],d=e[n*3],f=e[n*3+1],p=e[n*3+2],m=e[s*3],g=e[s*3+1],v=e[s*3+2];return Math.abs(o-h)<Math.abs(a-c)?[new tt(a,1-l),new tt(c,1-u),new tt(d,1-p),new tt(m,1-v)]:[new tt(o,1-l),new tt(h,1-u),new tt(f,1-p),new tt(g,1-v)]}};function iwe(t,e,i){if(i.shapes=[],Array.isArray(t))for(let r=0,n=t.length;r<n;r++){const s=t[r];i.shapes.push(s.uuid)}else i.shapes.push(t.uuid);return i.options=Object.assign({},e),e.extrudePath!==void 0&&(i.options.extrudePath=e.extrudePath.toJSON()),i}class u_ extends Md{constructor(e=1,i=0){const r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(n,s,e,i),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new u_(e.radius,e.detail)}}class k1 extends Md{constructor(e=1,i=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,n,e,i),this.type="OctahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new k1(e.radius,e.detail)}}class d_ extends xi{constructor(e=.5,i=1,r=8,n=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:i,thetaSegments:r,phiSegments:n,thetaStart:s,thetaLength:a},r=Math.max(3,r),n=Math.max(1,n);const o=[],l=[],c=[],h=[];let u=e;const d=(i-e)/n,f=new le,p=new tt;for(let m=0;m<=n;m++){for(let g=0;g<=r;g++){const v=s+g/r*a;f.x=u*Math.cos(v),f.y=u*Math.sin(v),l.push(f.x,f.y,f.z),c.push(0,0,1),p.x=(f.x/i+1)/2,p.y=(f.y/i+1)/2,h.push(p.x,p.y)}u+=d}for(let m=0;m<n;m++){const g=m*(r+1);for(let v=0;v<r;v++){const y=v+g,x=y,S=y+r+1,A=y+r+2,_=y+1;o.push(x,S,_),o.push(S,A,_)}}this.setIndex(o),this.setAttribute("position",new zt(l,3)),this.setAttribute("normal",new zt(c,3)),this.setAttribute("uv",new zt(h,2))}static fromJSON(e){return new d_(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class f_ extends xi{constructor(e=new dg([new tt(0,.5),new tt(-.5,-.5),new tt(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:i};const r=[],n=[],s=[],a=[];let o=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let h=0;h<e.length;h++)c(e[h]),this.addGroup(o,l,h),o+=l,l=0;this.setIndex(r),this.setAttribute("position",new zt(n,3)),this.setAttribute("normal",new zt(s,3)),this.setAttribute("uv",new zt(a,2));function c(h){const u=n.length/3,d=h.extractPoints(i);let f=d.shape;const p=d.holes;Rh.isClockWise(f)===!1&&(f=f.reverse());for(let g=0,v=p.length;g<v;g++){const y=p[g];Rh.isClockWise(y)===!0&&(p[g]=y.reverse())}const m=Rh.triangulateShape(f,p);for(let g=0,v=p.length;g<v;g++){const y=p[g];f=f.concat(y)}for(let g=0,v=f.length;g<v;g++){const y=f[g];n.push(y.x,y.y,0),s.push(0,0,1),a.push(y.x,y.y)}for(let g=0,v=m.length;g<v;g++){const y=m[g],x=y[0]+u,S=y[1]+u,A=y[2]+u;r.push(x,S,A),l+=3}}}toJSON(){const e=super.toJSON(),i=this.parameters.shapes;return rwe(i,e)}static fromJSON(e,i){const r=[];for(let n=0,s=e.shapes.length;n<s;n++){const a=i[e.shapes[n]];r.push(a)}return new f_(r,e.curveSegments)}}function rwe(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,r=t.length;i<r;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}class N1 extends xi{constructor(e=1,i=32,r=16,n=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:r,phiStart:n,phiLength:s,thetaStart:a,thetaLength:o},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));const l=Math.min(a+o,Math.PI);let c=0;const h=[],u=new le,d=new le,f=[],p=[],m=[],g=[];for(let v=0;v<=r;v++){const y=[],x=v/r;let S=0;v==0&&a==0?S=.5/i:v==r&&l==Math.PI&&(S=-.5/i);for(let A=0;A<=i;A++){const _=A/i;u.x=-e*Math.cos(n+_*s)*Math.sin(a+x*o),u.y=e*Math.cos(a+x*o),u.z=e*Math.sin(n+_*s)*Math.sin(a+x*o),p.push(u.x,u.y,u.z),d.copy(u).normalize(),m.push(d.x,d.y,d.z),g.push(_+S,1-x),y.push(c++)}h.push(y)}for(let v=0;v<r;v++)for(let y=0;y<i;y++){const x=h[v][y+1],S=h[v][y],A=h[v+1][y],_=h[v+1][y+1];(v!==0||a>0)&&f.push(x,S,_),(v!==r-1||l<Math.PI)&&f.push(S,A,_)}this.setIndex(f),this.setAttribute("position",new zt(p,3)),this.setAttribute("normal",new zt(m,3)),this.setAttribute("uv",new zt(g,2))}static fromJSON(e){return new N1(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class p_ extends Md{constructor(e=1,i=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,n,e,i),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new p_(e.radius,e.detail)}}class m_ extends xi{constructor(e=1,i=.4,r=8,n=6,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:i,radialSegments:r,tubularSegments:n,arc:s},r=Math.floor(r),n=Math.floor(n);const a=[],o=[],l=[],c=[],h=new le,u=new le,d=new le;for(let f=0;f<=r;f++)for(let p=0;p<=n;p++){const m=p/n*s,g=f/r*Math.PI*2;u.x=(e+i*Math.cos(g))*Math.cos(m),u.y=(e+i*Math.cos(g))*Math.sin(m),u.z=i*Math.sin(g),o.push(u.x,u.y,u.z),h.x=e*Math.cos(m),h.y=e*Math.sin(m),d.subVectors(u,h).normalize(),l.push(d.x,d.y,d.z),c.push(p/n),c.push(f/r)}for(let f=1;f<=r;f++)for(let p=1;p<=n;p++){const m=(n+1)*f+p-1,g=(n+1)*(f-1)+p-1,v=(n+1)*(f-1)+p,y=(n+1)*f+p;a.push(m,g,y),a.push(g,v,y)}this.setIndex(a),this.setAttribute("position",new zt(o,3)),this.setAttribute("normal",new zt(l,3)),this.setAttribute("uv",new zt(c,2))}static fromJSON(e){return new m_(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class g_ extends xi{constructor(e=1,i=.4,r=64,n=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a},r=Math.floor(r),n=Math.floor(n);const o=[],l=[],c=[],h=[],u=new le,d=new le,f=new le,p=new le,m=new le,g=new le,v=new le;for(let x=0;x<=r;++x){const S=x/r*s*Math.PI*2;y(S,s,a,e,f),y(S+.01,s,a,e,p),g.subVectors(p,f),v.addVectors(p,f),m.crossVectors(g,v),v.crossVectors(m,g),m.normalize(),v.normalize();for(let A=0;A<=n;++A){const _=A/n*Math.PI*2,M=-i*Math.cos(_),E=i*Math.sin(_);u.x=f.x+(M*v.x+E*m.x),u.y=f.y+(M*v.y+E*m.y),u.z=f.z+(M*v.z+E*m.z),l.push(u.x,u.y,u.z),d.subVectors(u,f).normalize(),c.push(d.x,d.y,d.z),h.push(x/r),h.push(A/n)}}for(let x=1;x<=r;x++)for(let S=1;S<=n;S++){const A=(n+1)*(x-1)+(S-1),_=(n+1)*x+(S-1),M=(n+1)*x+S,E=(n+1)*(x-1)+S;o.push(A,_,E),o.push(_,M,E)}this.setIndex(o),this.setAttribute("position",new zt(l,3)),this.setAttribute("normal",new zt(c,3)),this.setAttribute("uv",new zt(h,2));function y(x,S,A,_,M){const E=Math.cos(x),T=Math.sin(x),C=A/S*x,D=Math.cos(C);M.x=_*(2+D)*.5*E,M.y=_*(2+D)*T*.5,M.z=_*Math.sin(C)*.5}}static fromJSON(e){return new g_(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class v_ extends xi{constructor(e=new N4(new le(-1,-1,0),new le(-1,1,0),new le(1,1,0)),i=64,r=1,n=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:i,radius:r,radialSegments:n,closed:s};const a=e.computeFrenetFrames(i,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new le,l=new le,c=new tt;let h=new le;const u=[],d=[],f=[],p=[];m(),this.setIndex(p),this.setAttribute("position",new zt(u,3)),this.setAttribute("normal",new zt(d,3)),this.setAttribute("uv",new zt(f,2));function m(){for(let x=0;x<i;x++)g(x);g(s===!1?i:0),y(),v()}function g(x){h=e.getPointAt(x/i,h);const S=a.normals[x],A=a.binormals[x];for(let _=0;_<=n;_++){const M=_/n*Math.PI*2,E=Math.sin(M),T=-Math.cos(M);l.x=T*S.x+E*A.x,l.y=T*S.y+E*A.y,l.z=T*S.z+E*A.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=h.x+r*l.x,o.y=h.y+r*l.y,o.z=h.z+r*l.z,u.push(o.x,o.y,o.z)}}function v(){for(let x=1;x<=i;x++)for(let S=1;S<=n;S++){const A=(n+1)*(x-1)+(S-1),_=(n+1)*x+(S-1),M=(n+1)*x+S,E=(n+1)*(x-1)+S;p.push(A,_,E),p.push(_,M,E)}}function y(){for(let x=0;x<=i;x++)for(let S=0;S<=n;S++)c.x=x/i,c.y=S/n,f.push(c.x,c.y)}}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new v_(new z4[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Nie extends xi{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const i=[],r=new Set,n=new le,s=new le;if(e.index!==null){const a=e.attributes.position,o=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,h=l.length;c<h;++c){const u=l[c],d=u.start,f=u.count;for(let p=d,m=d+f;p<m;p+=3)for(let g=0;g<3;g++){const v=o.getX(p+g),y=o.getX(p+(g+1)%3);n.fromBufferAttribute(a,v),s.fromBufferAttribute(a,y),qj(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}}else{const a=e.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let c=0;c<3;c++){const h=3*o+c,u=3*o+(c+1)%3;n.fromBufferAttribute(a,h),s.fromBufferAttribute(a,u),qj(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}this.setAttribute("position",new zt(i,3))}}}function qj(t,e,i){const r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,n=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return i.has(r)===!0||i.has(n)===!0?!1:(i.add(r),i.add(n),!0)}var Kj=Object.freeze({__proto__:null,BoxGeometry:Pp,CapsuleGeometry:a_,CircleGeometry:o_,ConeGeometry:l_,CylinderGeometry:Zg,DodecahedronGeometry:c_,EdgesGeometry:Oie,ExtrudeGeometry:h_,IcosahedronGeometry:u_,LatheGeometry:F1,OctahedronGeometry:k1,PlaneGeometry:O1,PolyhedronGeometry:Md,RingGeometry:d_,ShapeGeometry:f_,SphereGeometry:N1,TetrahedronGeometry:p_,TorusGeometry:m_,TorusKnotGeometry:g_,TubeGeometry:v_,WireframeGeometry:Nie});class Uie extends kn{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ct(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class zie extends zh{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class y_ extends kn{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ct(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cp,this.normalScale=new tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ql extends y_{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new tt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return bn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ct(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ct(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ct(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Gie extends kn{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ct(16777215),this.specular=new Ct(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cp,this.normalScale=new tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=e_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Vie extends kn{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ct(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cp,this.normalScale=new tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Hie extends kn{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cp,this.normalScale=new tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class jie extends kn{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ct(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cp,this.normalScale=new tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=e_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Wie extends kn{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ct(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cp,this.normalScale=new tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Xie extends wa{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function wl(t,e,i){return G4(t)?new t.constructor(t.subarray(e,i!==void 0?i:t.length)):t.slice(e,i)}function jm(t,e,i){return!t||!i&&t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function G4(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Yie(t){function e(n,s){return t[n]-t[s]}const i=t.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(e),r}function rk(t,e,i){const r=t.length,n=new t.constructor(r);for(let s=0,a=0;a!==r;++s){const o=i[s]*e;for(let l=0;l!==e;++l)n[a++]=t[o+l]}return n}function V4(t,e,i,r){let n=1,s=t[0];for(;s!==void 0&&s[r]===void 0;)s=t[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(e.push(s.time),i.push.apply(i,a)),s=t[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(e.push(s.time),a.toArray(i,i.length)),s=t[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(e.push(s.time),i.push(a)),s=t[n++];while(s!==void 0)}function nwe(t,e,i,r,n=30){const s=t.clone();s.name=e;const a=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],h=c.getValueSize(),u=[],d=[];for(let f=0;f<c.times.length;++f){const p=c.times[f]*n;if(!(p<i||p>=r)){u.push(c.times[f]);for(let m=0;m<h;++m)d.push(c.values[f*h+m])}}u.length!==0&&(c.times=jm(u,c.times.constructor),c.values=jm(d,c.values.constructor),a.push(c))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s}function swe(t,e=0,i=t,r=30){r<=0&&(r=30);const n=i.tracks.length,s=e/r;for(let a=0;a<n;++a){const o=i.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=t.tracks.find(function(v){return v.name===o.name&&v.ValueTypeName===l});if(c===void 0)continue;let h=0;const u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=u/3);let d=0;const f=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=f/3);const p=o.times.length-1;let m;if(s<=o.times[0]){const v=h,y=u-h;m=wl(o.values,v,y)}else if(s>=o.times[p]){const v=p*u+h,y=v+u-h;m=wl(o.values,v,y)}else{const v=o.createInterpolant(),y=h,x=u-h;v.evaluate(s),m=wl(v.resultBuffer,y,x)}l==="quaternion"&&new Ds().fromArray(m).normalize().conjugate().toArray(m);const g=c.times.length;for(let v=0;v<g;++v){const y=v*f+d;if(l==="quaternion")Ds.multiplyQuaternionsFlat(c.values,y,m,0,c.values,y);else{const x=f-d*2;for(let S=0;S<x;++S)c.values[y+S]-=m[S]}}}return t.blendMode=g4,t}var awe=Object.freeze({__proto__:null,arraySlice:wl,convertArray:jm,isTypedArray:G4,getKeyframeOrder:Yie,sortedArray:rk,flattenJSON:V4,subclip:nwe,makeClipAdditive:swe});class U1{constructor(e,i,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new i.constructor(r),this.sampleValues=i,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const i=this.parameterPositions;let r=this._cachedIndex,n=i[r],s=i[r-1];e:{t:{let a;i:{r:if(!(e<n)){for(let o=r+2;;){if(n===void 0){if(e<s)break r;return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(s=n,n=i[++r],e<n)break t}a=i.length;break i}if(!(e>=s)){const o=i[1];e<o&&(r=2,s=o);for(let l=r-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(n=s,s=i[--r-1],e>=s)break t}a=r,r=0;break i}break e}for(;r<a;){const o=r+a>>>1;e<i[o]?a=o:r=o+1}if(n=i[r],s=i[r-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,s,n)}return this.interpolate_(r,s,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const i=this.resultBuffer,r=this.sampleValues,n=this.valueSize,s=e*n;for(let a=0;a!==n;++a)i[a]=r[s+a];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class qie extends U1{constructor(e,i,r,n){super(e,i,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Gm,endingEnd:Gm}}intervalChanged_(e,i,r){const n=this.parameterPositions;let s=e-2,a=e+1,o=n[s],l=n[a];if(o===void 0)switch(this.getSettings_().endingStart){case Vm:s=e,o=2*i-r;break;case Zw:s=n.length-2,o=i+n[s]-n[s+1];break;default:s=e,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case Vm:a=e,l=2*r-i;break;case Zw:a=1,l=r+n[1]-n[0];break;default:a=e-1,l=i}const c=(r-i)*.5,h=this.valueSize;this._weightPrev=c/(i-o),this._weightNext=c/(l-r),this._offsetPrev=s*h,this._offsetNext=a*h}interpolate_(e,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,h=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,f=this._weightNext,p=(r-i)/(n-i),m=p*p,g=m*p,v=-d*g+2*d*m-d*p,y=(1+d)*g+(-1.5-2*d)*m+(-.5+d)*p+1,x=(-1-f)*g+(1.5+f)*m+.5*p,S=f*g-f*m;for(let A=0;A!==o;++A)s[A]=v*a[h+A]+y*a[c+A]+x*a[l+A]+S*a[u+A];return s}}class H4 extends U1{constructor(e,i,r,n){super(e,i,r,n)}interpolate_(e,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,h=(r-i)/(n-i),u=1-h;for(let d=0;d!==o;++d)s[d]=a[c+d]*u+a[l+d]*h;return s}}class Kie extends U1{constructor(e,i,r,n){super(e,i,r,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class Uc{constructor(e,i,r,n){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=jm(i,this.TimeBufferType),this.values=jm(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const i=e.constructor;let r;if(i.toJSON!==this.toJSON)r=i.toJSON(e);else{r={name:e.name,times:jm(e.times,Array),values:jm(e.values,Array)};const n=e.getInterpolation();n!==e.DefaultInterpolation&&(r.interpolation=n)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new Kie(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new H4(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new qie(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case $y:i=this.InterpolantFactoryMethodDiscrete;break;case Lg:i=this.InterpolantFactoryMethodLinear;break;case KT:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return $y;case this.InterpolantFactoryMethodLinear:return Lg;case this.InterpolantFactoryMethodSmooth:return KT}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]+=e}return this}scale(e){if(e!==1){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]*=e}return this}trim(e,i){const r=this.times,n=r.length;let s=0,a=n-1;for(;s!==n&&r[s]<e;)++s;for(;a!==-1&&r[a]>i;)--a;if(++a,s!==0||a!==n){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=wl(r,s,a),this.values=wl(this.values,s*o,a*o)}return this}validate(){let e=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,n=this.values,s=r.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==s;o++){const l=r[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(a!==null&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,a),e=!1;break}a=l}if(n!==void 0&&G4(n))for(let o=0,l=n.length;o!==l;++o){const c=n[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e}optimize(){const e=wl(this.times),i=wl(this.values),r=this.getValueSize(),n=this.getInterpolation()===KT,s=e.length-1;let a=1;for(let o=1;o<s;++o){let l=!1;const c=e[o],h=e[o+1];if(c!==h&&(o!==1||c!==e[0]))if(n)l=!0;else{const u=o*r,d=u-r,f=u+r;for(let p=0;p!==r;++p){const m=i[u+p];if(m!==i[d+p]||m!==i[f+p]){l=!0;break}}}if(l){if(o!==a){e[a]=e[o];const u=o*r,d=a*r;for(let f=0;f!==r;++f)i[d+f]=i[u+f]}++a}}if(s>0){e[a]=e[s];for(let o=s*r,l=a*r,c=0;c!==r;++c)i[l+c]=i[o+c];++a}return a!==e.length?(this.times=wl(e,0,a),this.values=wl(i,0,a*r)):(this.times=e,this.values=i),this}clone(){const e=wl(this.times,0),i=wl(this.values,0),r=this.constructor,n=new r(this.name,e,i);return n.createInterpolant=this.createInterpolant,n}}Uc.prototype.TimeBufferType=Float32Array;Uc.prototype.ValueBufferType=Float32Array;Uc.prototype.DefaultInterpolation=Lg;class e0 extends Uc{}e0.prototype.ValueTypeName="bool";e0.prototype.ValueBufferType=Array;e0.prototype.DefaultInterpolation=$y;e0.prototype.InterpolantFactoryMethodLinear=void 0;e0.prototype.InterpolantFactoryMethodSmooth=void 0;class j4 extends Uc{}j4.prototype.ValueTypeName="color";class Fg extends Uc{}Fg.prototype.ValueTypeName="number";class Qie extends U1{constructor(e,i,r,n){super(e,i,r,n)}interpolate_(e,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(r-i)/(n-i);let c=e*o;for(let h=c+o;c!==h;c+=4)Ds.slerpFlat(s,0,a,c-o,a,c,l);return s}}class mp extends Uc{InterpolantFactoryMethodLinear(e){return new Qie(this.times,this.values,this.getValueSize(),e)}}mp.prototype.ValueTypeName="quaternion";mp.prototype.DefaultInterpolation=Lg;mp.prototype.InterpolantFactoryMethodSmooth=void 0;class t0 extends Uc{}t0.prototype.ValueTypeName="string";t0.prototype.ValueBufferType=Array;t0.prototype.DefaultInterpolation=$y;t0.prototype.InterpolantFactoryMethodLinear=void 0;t0.prototype.InterpolantFactoryMethodSmooth=void 0;class kg extends Uc{}kg.prototype.ValueTypeName="vector";class Zy{constructor(e,i=-1,r,n=rD){this.name=e,this.tracks=r,this.duration=i,this.blendMode=n,this.uuid=Vo(),this.duration<0&&this.resetDuration()}static parse(e){const i=[],r=e.tracks,n=1/(e.fps||1);for(let a=0,o=r.length;a!==o;++a)i.push(lwe(r[a]).scale(n));const s=new this(e.name,e.duration,i,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const i=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,a=r.length;s!==a;++s)i.push(Uc.toJSON(r[s]));return n}static CreateFromMorphTargetSequence(e,i,r,n){const s=i.length,a=[];for(let o=0;o<s;o++){let l=[],c=[];l.push((o+s-1)%s,o,(o+1)%s),c.push(0,1,0);const h=Yie(l);l=rk(l,1,h),c=rk(c,1,h),!n&&l[0]===0&&(l.push(s),c.push(c[0])),a.push(new Fg(".morphTargetInfluences["+i[o].name+"]",l,c).scale(1/r))}return new this(e,-1,a)}static findByName(e,i){let r=e;if(!Array.isArray(e)){const n=e;r=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<r.length;n++)if(r[n].name===i)return r[n];return null}static CreateClipsFromMorphTargetSequences(e,i,r){const n={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const c=e[o],h=c.name.match(s);if(h&&h.length>1){const u=h[1];let d=n[u];d||(n[u]=d=[]),d.push(c)}}const a=[];for(const o in n)a.push(this.CreateFromMorphTargetSequence(o,n[o],i,r));return a}static parseAnimation(e,i){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(u,d,f,p,m){if(f.length!==0){const g=[],v=[];V4(f,g,v,p),g.length!==0&&m.push(new u(d,g,v))}},n=[],s=e.name||"default",a=e.fps||30,o=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let u=0;u<c.length;u++){const d=c[u].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const f={};let p;for(p=0;p<d.length;p++)if(d[p].morphTargets)for(let m=0;m<d[p].morphTargets.length;m++)f[d[p].morphTargets[m]]=-1;for(const m in f){const g=[],v=[];for(let y=0;y!==d[p].morphTargets.length;++y){const x=d[p];g.push(x.time),v.push(x.morphTarget===m?1:0)}n.push(new Fg(".morphTargetInfluence["+m+"]",g,v))}l=f.length*a}else{const f=".bones["+i[u].name+"]";r(kg,f+".position",d,"pos",n),r(mp,f+".quaternion",d,"rot",n),r(kg,f+".scale",d,"scl",n)}}return n.length===0?null:new this(s,l,n,o)}resetDuration(){const e=this.tracks;let i=0;for(let r=0,n=e.length;r!==n;++r){const s=this.tracks[r];i=Math.max(i,s.times[s.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function owe(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Fg;case"vector":case"vector2":case"vector3":case"vector4":return kg;case"color":return j4;case"quaternion":return mp;case"bool":case"boolean":return e0;case"string":return t0}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function lwe(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=owe(t.type);if(t.times===void 0){const i=[],r=[];V4(t.keys,i,r,"value"),t.times=i,t.values=r}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Ng={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class W4{constructor(e,i,r){const n=this;let s=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=r,this.itemStart=function(h){o++,s===!1&&n.onStart!==void 0&&n.onStart(h,a,o),s=!0},this.itemEnd=function(h){a++,n.onProgress!==void 0&&n.onProgress(h,a,o),a===o&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(h){n.onError!==void 0&&n.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,u){return c.push(h,u),this},this.removeHandler=function(h){const u=c.indexOf(h);return u!==-1&&c.splice(u,2),this},this.getHandler=function(h){for(let u=0,d=c.length;u<d;u+=2){const f=c[u],p=c[u+1];if(f.global&&(f.lastIndex=0),f.test(h))return p}return null}}}const Zv=new W4;class Ya{constructor(e){this.manager=e!==void 0?e:Zv,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){const r=this;return new Promise(function(n,s){r.load(e,n,i,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const cu={};class cwe extends Error{constructor(e,i){super(e),this.response=i}}class Xo extends Ya{constructor(e){super(e)}load(e,i,r,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Ng.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{i&&i(s),this.manager.itemEnd(e)},0),s;if(cu[e]!==void 0){cu[e].push({onLoad:i,onProgress:r,onError:n});return}cu[e]=[],cu[e].push({onLoad:i,onProgress:r,onError:n});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=cu[e],u=c.body.getReader(),d=c.headers.get("Content-Length"),f=d?parseInt(d):0,p=f!==0;let m=0;const g=new ReadableStream({start(v){y();function y(){u.read().then(({done:x,value:S})=>{if(x)v.close();else{m+=S.byteLength;const A=new ProgressEvent("progress",{lengthComputable:p,loaded:m,total:f});for(let _=0,M=h.length;_<M;_++){const E=h[_];E.onProgress&&E.onProgress(A)}v.enqueue(S),y()}})}}});return new Response(g)}else throw new cwe(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,o));case"json":return c.json();default:if(o===void 0)return c.text();{const u=/charset="?([^;"\s]*)"?/i.exec(o),d=u&&u[1]?u[1].toLowerCase():void 0,f=new TextDecoder(d);return c.arrayBuffer().then(p=>f.decode(p))}}}).then(c=>{Ng.add(e,c);const h=cu[e];delete cu[e];for(let u=0,d=h.length;u<d;u++){const f=h[u];f.onLoad&&f.onLoad(c)}}).catch(c=>{const h=cu[e];if(h===void 0)throw this.manager.itemError(e),c;delete cu[e];for(let u=0,d=h.length;u<d;u++){const f=h[u];f.onError&&f.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class hwe extends Ya{constructor(e){super(e)}load(e,i,r,n){const s=this,a=new Xo(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},r,n)}parse(e){const i=[];for(let r=0;r<e.length;r++){const n=Zy.parse(e[r]);i.push(n)}return i}}class uwe extends Ya{constructor(e){super(e)}load(e,i,r,n){const s=this,a=[],o=new O4,l=new Xo(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function h(u){l.load(e[u],function(d){const f=s.parse(d,!0);a[u]={width:f.width,height:f.height,format:f.format,mipmaps:f.mipmaps},c+=1,c===6&&(f.mipmapCount===1&&(o.minFilter=Hr),o.image=a,o.format=f.format,o.needsUpdate=!0,i&&i(o))},r,n)}if(Array.isArray(e))for(let u=0,d=e.length;u<d;++u)h(u);else l.load(e,function(u){const d=s.parse(u,!0);if(d.isCubemap){const f=d.mipmaps.length/d.mipmapCount;for(let p=0;p<f;p++){a[p]={mipmaps:[]};for(let m=0;m<d.mipmapCount;m++)a[p].mipmaps.push(d.mipmaps[p*d.mipmapCount+m]),a[p].format=d.format,a[p].width=d.width,a[p].height=d.height}o.image=a}else o.image.width=d.width,o.image.height=d.height,o.mipmaps=d.mipmaps;d.mipmapCount===1&&(o.minFilter=Hr),o.format=d.format,o.needsUpdate=!0,i&&i(o)},r,n);return o}}class oS extends Ya{constructor(e){super(e)}load(e,i,r,n){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Ng.get(e);if(a!==void 0)return s.manager.itemStart(e),setTimeout(function(){i&&i(a),s.manager.itemEnd(e)},0),a;const o=iS("img");function l(){h(),Ng.add(e,this),i&&i(this),s.manager.itemEnd(e)}function c(u){h(),n&&n(u),s.manager.itemError(e),s.manager.itemEnd(e)}function h(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(e),o.src=e,o}}class dwe extends Ya{constructor(e){super(e)}load(e,i,r,n){const s=new r_,a=new oS(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(c){a.load(e[c],function(h){s.images[c]=h,o++,o===6&&(s.needsUpdate=!0,i&&i(s))},void 0,n)}for(let c=0;c<e.length;++c)l(c);return s}}class fwe extends Ya{constructor(e){super(e)}load(e,i,r,n){const s=this,a=new _y,o=new Xo(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(e,function(l){const c=s.parse(l);c&&(c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:js,a.wrapT=c.wrapT!==void 0?c.wrapT:js,a.magFilter=c.magFilter!==void 0?c.magFilter:Hr,a.minFilter=c.minFilter!==void 0?c.minFilter:Hr,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.encoding!==void 0&&(a.encoding=c.encoding),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=_d),c.mipmapCount===1&&(a.minFilter=Hr),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,i&&i(a,c))},r,n),a}}class x_ extends Ya{constructor(e){super(e)}load(e,i,r,n){const s=new kr,a=new oS(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){s.image=o,s.needsUpdate=!0,i!==void 0&&i(s)},r,n),s}}class Dp extends zi{constructor(e,i=1){super(),this.isLight=!0,this.type="Light",this.color=new Ct(e),this.intensity=i}dispose(){}copy(e,i){return super.copy(e,i),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),i}}class $ie extends Dp{constructor(e,i,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(zi.DefaultUp),this.updateMatrix(),this.groundColor=new Ct(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}}const pL=new ui,Qj=new le,$j=new le;class X4{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new tt(512,512),this.map=null,this.mapPass=null,this.matrix=new ui,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new sD,this._frameExtents=new tt(1,1),this._viewportCount=1,this._viewports=[new rr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const i=this.camera,r=this.matrix;Qj.setFromMatrixPosition(e.matrixWorld),i.position.copy(Qj),$j.setFromMatrixPosition(e.target.matrixWorld),i.lookAt($j),i.updateMatrixWorld(),pL.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(pL),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(pL)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class pwe extends X4{constructor(){super(new Or(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const i=this.camera,r=tS*2*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=e.distance||i.far;(r!==i.fov||n!==i.aspect||s!==i.far)&&(i.fov=r,i.aspect=n,i.far=s,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Y4 extends Dp{constructor(e,i,r=0,n=Math.PI/3,s=0,a=1){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(zi.DefaultUp),this.updateMatrix(),this.target=new zi,this.distance=r,this.angle=n,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new pwe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Jj=new ui,Hx=new le,mL=new le;class mwe extends X4{constructor(){super(new Or(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new tt(4,2),this._viewportCount=6,this._viewports=[new rr(2,1,1,1),new rr(0,1,1,1),new rr(3,1,1,1),new rr(1,1,1,1),new rr(3,0,1,1),new rr(1,0,1,1)],this._cubeDirections=[new le(1,0,0),new le(-1,0,0),new le(0,0,1),new le(0,0,-1),new le(0,1,0),new le(0,-1,0)],this._cubeUps=[new le(0,1,0),new le(0,1,0),new le(0,1,0),new le(0,1,0),new le(0,0,1),new le(0,0,-1)]}updateMatrices(e,i=0){const r=this.camera,n=this.matrix,s=e.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),Hx.setFromMatrixPosition(e.matrixWorld),r.position.copy(Hx),mL.copy(r.position),mL.add(this._cubeDirections[i]),r.up.copy(this._cubeUps[i]),r.lookAt(mL),r.updateMatrixWorld(),n.makeTranslation(-Hx.x,-Hx.y,-Hx.z),Jj.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jj)}}class q4 extends Dp{constructor(e,i,r=0,n=1){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=n,this.shadow=new mwe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class gwe extends X4{constructor(){super(new Dc(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class K4 extends Dp{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(zi.DefaultUp),this.updateMatrix(),this.target=new zi,this.shadow=new gwe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Jie extends Dp{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class Zie extends Dp{constructor(e,i,r=10,n=10){super(e,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const i=super.toJSON(e);return i.object.width=this.width,i.object.height=this.height,i}}class ere{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new le)}set(e){for(let i=0;i<9;i++)this.coefficients[i].copy(e[i]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,i){const r=e.x,n=e.y,s=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*n),i.addScaledVector(a[2],.488603*s),i.addScaledVector(a[3],.488603*r),i.addScaledVector(a[4],1.092548*(r*n)),i.addScaledVector(a[5],1.092548*(n*s)),i.addScaledVector(a[6],.315392*(3*s*s-1)),i.addScaledVector(a[7],1.092548*(r*s)),i.addScaledVector(a[8],.546274*(r*r-n*n)),i}getIrradianceAt(e,i){const r=e.x,n=e.y,s=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],2*.511664*n),i.addScaledVector(a[2],2*.511664*s),i.addScaledVector(a[3],2*.511664*r),i.addScaledVector(a[4],2*.429043*r*n),i.addScaledVector(a[5],2*.429043*n*s),i.addScaledVector(a[6],.743125*s*s-.247708),i.addScaledVector(a[7],2*.429043*r*s),i.addScaledVector(a[8],.429043*(r*r-n*n)),i}add(e){for(let i=0;i<9;i++)this.coefficients[i].add(e.coefficients[i]);return this}addScaledSH(e,i){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],i);return this}scale(e){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(e);return this}lerp(e,i){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],i);return this}equals(e){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(e.coefficients[i]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].fromArray(e,i+n*3);return this}toArray(e=[],i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].toArray(e,i+n*3);return e}static getBasisAt(e,i){const r=e.x,n=e.y,s=e.z;i[0]=.282095,i[1]=.488603*n,i[2]=.488603*s,i[3]=.488603*r,i[4]=1.092548*r*n,i[5]=1.092548*n*s,i[6]=.315392*(3*s*s-1),i[7]=1.092548*r*s,i[8]=.546274*(r*r-n*n)}}class pD extends Dp{constructor(e=new ere,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const i=super.toJSON(e);return i.object.sh=this.sh.toArray(),i}}class mD extends Ya{constructor(e){super(e),this.textures={}}load(e,i,r,n){const s=this,a=new Xo(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},r,n)}parse(e){const i=this.textures;function r(s){return i[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),i[s]}const n=mD.createMaterialFromType(e.type);if(e.uuid!==void 0&&(n.uuid=e.uuid),e.name!==void 0&&(n.name=e.name),e.color!==void 0&&n.color!==void 0&&n.color.setHex(e.color),e.roughness!==void 0&&(n.roughness=e.roughness),e.metalness!==void 0&&(n.metalness=e.metalness),e.sheen!==void 0&&(n.sheen=e.sheen),e.sheenColor!==void 0&&(n.sheenColor=new Ct().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(n.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&n.emissive!==void 0&&n.emissive.setHex(e.emissive),e.specular!==void 0&&n.specular!==void 0&&n.specular.setHex(e.specular),e.specularIntensity!==void 0&&(n.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&n.specularColor!==void 0&&n.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(n.shininess=e.shininess),e.clearcoat!==void 0&&(n.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(n.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(n.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(n.transmission=e.transmission),e.thickness!==void 0&&(n.thickness=e.thickness),e.attenuationDistance!==void 0&&(n.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&n.attenuationColor!==void 0&&n.attenuationColor.setHex(e.attenuationColor),e.fog!==void 0&&(n.fog=e.fog),e.flatShading!==void 0&&(n.flatShading=e.flatShading),e.blending!==void 0&&(n.blending=e.blending),e.combine!==void 0&&(n.combine=e.combine),e.side!==void 0&&(n.side=e.side),e.shadowSide!==void 0&&(n.shadowSide=e.shadowSide),e.opacity!==void 0&&(n.opacity=e.opacity),e.transparent!==void 0&&(n.transparent=e.transparent),e.alphaTest!==void 0&&(n.alphaTest=e.alphaTest),e.depthTest!==void 0&&(n.depthTest=e.depthTest),e.depthWrite!==void 0&&(n.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(n.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(n.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(n.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(n.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(n.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(n.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(n.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(n.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(n.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(n.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(n.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(n.rotation=e.rotation),e.linewidth!==1&&(n.linewidth=e.linewidth),e.dashSize!==void 0&&(n.dashSize=e.dashSize),e.gapSize!==void 0&&(n.gapSize=e.gapSize),e.scale!==void 0&&(n.scale=e.scale),e.polygonOffset!==void 0&&(n.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(n.dithering=e.dithering),e.alphaToCoverage!==void 0&&(n.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=e.premultipliedAlpha),e.visible!==void 0&&(n.visible=e.visible),e.toneMapped!==void 0&&(n.toneMapped=e.toneMapped),e.userData!==void 0&&(n.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const a=e.uniforms[s];switch(n.uniforms[s]={},a.type){case"t":n.uniforms[s].value=r(a.value);break;case"c":n.uniforms[s].value=new Ct().setHex(a.value);break;case"v2":n.uniforms[s].value=new tt().fromArray(a.value);break;case"v3":n.uniforms[s].value=new le().fromArray(a.value);break;case"v4":n.uniforms[s].value=new rr().fromArray(a.value);break;case"m3":n.uniforms[s].value=new co().fromArray(a.value);break;case"m4":n.uniforms[s].value=new ui().fromArray(a.value);break;default:n.uniforms[s].value=a.value}}if(e.defines!==void 0&&(n.defines=e.defines),e.vertexShader!==void 0&&(n.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(n.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(n.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)n.extensions[s]=e.extensions[s];if(e.size!==void 0&&(n.size=e.size),e.sizeAttenuation!==void 0&&(n.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(n.map=r(e.map)),e.matcap!==void 0&&(n.matcap=r(e.matcap)),e.alphaMap!==void 0&&(n.alphaMap=r(e.alphaMap)),e.bumpMap!==void 0&&(n.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(n.bumpScale=e.bumpScale),e.normalMap!==void 0&&(n.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(n.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),n.normalScale=new tt().fromArray(s)}return e.displacementMap!==void 0&&(n.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(n.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(n.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(n.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(n.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(n.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(n.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(n.specularMap=r(e.specularMap)),e.specularIntensityMap!==void 0&&(n.specularIntensityMap=r(e.specularIntensityMap)),e.specularColorMap!==void 0&&(n.specularColorMap=r(e.specularColorMap)),e.envMap!==void 0&&(n.envMap=r(e.envMap)),e.envMapIntensity!==void 0&&(n.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(n.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(n.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(n.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(n.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(n.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(n.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(n.gradientMap=r(e.gradientMap)),e.clearcoatMap!==void 0&&(n.clearcoatMap=r(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(n.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(n.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(n.clearcoatNormalScale=new tt().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(n.iridescenceMap=r(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(n.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(n.transmissionMap=r(e.transmissionMap)),e.thicknessMap!==void 0&&(n.thicknessMap=r(e.thicknessMap)),e.sheenColorMap!==void 0&&(n.sheenColorMap=r(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(n.sheenRoughnessMap=r(e.sheenRoughnessMap)),n}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const i={ShadowMaterial:Uie,SpriteMaterial:P4,RawShaderMaterial:zie,ShaderMaterial:zh,PointsMaterial:hD,MeshPhysicalMaterial:ql,MeshStandardMaterial:y_,MeshPhongMaterial:Gie,MeshToonMaterial:Vie,MeshNormalMaterial:Hie,MeshLambertMaterial:jie,MeshDepthMaterial:M4,MeshDistanceMaterial:T4,MeshBasicMaterial:ko,MeshMatcapMaterial:Wie,LineDashedMaterial:Xie,LineBasicMaterial:wa,Material:kn};return new i[e]}}class Zf{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let i="";for(let r=0,n=e.length;r<n;r++)i+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(e){const i=e.lastIndexOf("/");return i===-1?"./":e.slice(0,i+1)}static resolveURL(e,i){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(e)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:i+e)}}class tre extends xi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class ire extends Ya{constructor(e){super(e)}load(e,i,r,n){const s=this,a=new Xo(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},r,n)}parse(e){const i={},r={};function n(f,p){if(i[p]!==void 0)return i[p];const g=f.interleavedBuffers[p],v=s(f,g.buffer),y=Qv(g.type,v),x=new n_(y,g.stride);return x.uuid=g.uuid,i[p]=x,x}function s(f,p){if(r[p]!==void 0)return r[p];const g=f.arrayBuffers[p],v=new Uint32Array(g).buffer;return r[p]=v,v}const a=e.isInstancedBufferGeometry?new tre:new xi,o=e.data.index;if(o!==void 0){const f=Qv(o.type,o.array);a.setIndex(new Xi(f,1))}const l=e.data.attributes;for(const f in l){const p=l[f];let m;if(p.isInterleavedBufferAttribute){const g=n(e.data,p.data);m=new pp(g,p.itemSize,p.offset,p.normalized)}else{const g=Qv(p.type,p.array),v=p.isInstancedBufferAttribute?Og:Xi;m=new v(g,p.itemSize,p.normalized)}p.name!==void 0&&(m.name=p.name),p.usage!==void 0&&m.setUsage(p.usage),p.updateRange!==void 0&&(m.updateRange.offset=p.updateRange.offset,m.updateRange.count=p.updateRange.count),a.setAttribute(f,m)}const c=e.data.morphAttributes;if(c)for(const f in c){const p=c[f],m=[];for(let g=0,v=p.length;g<v;g++){const y=p[g];let x;if(y.isInterleavedBufferAttribute){const S=n(e.data,y.data);x=new pp(S,y.itemSize,y.offset,y.normalized)}else{const S=Qv(y.type,y.array);x=new Xi(S,y.itemSize,y.normalized)}y.name!==void 0&&(x.name=y.name),m.push(x)}a.morphAttributes[f]=m}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==void 0)for(let f=0,p=u.length;f!==p;++f){const m=u[f];a.addGroup(m.start,m.count,m.materialIndex)}const d=e.data.boundingSphere;if(d!==void 0){const f=new le;d.center!==void 0&&f.fromArray(d.center),a.boundingSphere=new Ed(f,d.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class vwe extends Ya{constructor(e){super(e)}load(e,i,r,n){const s=this,a=this.path===""?Zf.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new Xo(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(u){n!==void 0&&n(u),console.error("THREE:ObjectLoader: Can't parse "+e+".",u.message);return}const h=c.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(c,i)},r,n)}async loadAsync(e,i){const r=this,n=this.path===""?Zf.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const s=new Xo(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(e,i),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await r.parseAsync(o)}parse(e,i){const r=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,n),a=this.parseImages(e.images,function(){i!==void 0&&i(c)}),o=this.parseTextures(e.textures,a),l=this.parseMaterials(e.materials,o),c=this.parseObject(e.object,s,l,o,r),h=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,h),i!==void 0){let u=!1;for(const d in a)if(a[d].data instanceof HTMLImageElement){u=!0;break}u===!1&&i(c)}return c}async parseAsync(e){const i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,r),s=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,n,o,a,i),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(e){const i={};if(e!==void 0)for(let r=0,n=e.length;r<n;r++){const s=new dg().fromJSON(e[r]);i[s.uuid]=s}return i}parseSkeletons(e,i){const r={},n={};if(i.traverse(function(s){s.isBone&&(n[s.uuid]=s)}),e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=new s_().fromJSON(e[s],n);r[o.uuid]=o}return r}parseGeometries(e,i){const r={};if(e!==void 0){const n=new ire;for(let s=0,a=e.length;s<a;s++){let o;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(l);break;default:l.type in Kj?o=Kj[l.type].fromJSON(l,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),o.isBufferGeometry===!0&&l.userData!==void 0&&(o.userData=l.userData),r[l.uuid]=o}}return r}parseMaterials(e,i){const r={},n={};if(e!==void 0){const s=new mD;s.setTextures(i);for(let a=0,o=e.length;a<o;a++){const l=e[a];r[l.uuid]===void 0&&(r[l.uuid]=s.parse(l)),n[l.uuid]=r[l.uuid]}}return n}parseAnimations(e){const i={};if(e!==void 0)for(let r=0;r<e.length;r++){const n=e[r],s=Zy.parse(n);i[s.uuid]=s}return i}parseImages(e,i){const r=this,n={};let s;function a(l){return r.manager.itemStart(l),s.load(l,function(){r.manager.itemEnd(l)},void 0,function(){r.manager.itemError(l),r.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const c=l,h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:r.resourcePath+c;return a(h)}else return l.data?{data:Qv(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new W4(i);s=new oS(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,h=e.length;c<h;c++){const u=e[c],d=u.url;if(Array.isArray(d)){const f=[];for(let p=0,m=d.length;p<m;p++){const g=d[p],v=o(g);v!==null&&(v instanceof HTMLImageElement?f.push(v):f.push(new _y(v.data,v.width,v.height)))}n[u.uuid]=new Hm(f)}else{const f=o(u.url);n[u.uuid]=new Hm(f)}}}return n}async parseImagesAsync(e){const i=this,r={};let n;async function s(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:i.resourcePath+o;return await n.loadAsync(l)}else return a.data?{data:Qv(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){n=new oS(this.manager),n.setCrossOrigin(this.crossOrigin);for(let a=0,o=e.length;a<o;a++){const l=e[a],c=l.url;if(Array.isArray(c)){const h=[];for(let u=0,d=c.length;u<d;u++){const f=c[u],p=await s(f);p!==null&&(p instanceof HTMLImageElement?h.push(p):h.push(new _y(p.data,p.width,p.height)))}r[l.uuid]=new Hm(h)}else{const h=await s(l.url);r[l.uuid]=new Hm(h)}}}return r}parseTextures(e,i){function r(s,a){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const n={};if(e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=e[s];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),i[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const l=i[o.image],c=l.data;let h;Array.isArray(c)?(h=new r_,c.length===6&&(h.needsUpdate=!0)):(c&&c.data?h=new _y:h=new kr,c&&(h.needsUpdate=!0)),h.source=l,h.uuid=o.uuid,o.name!==void 0&&(h.name=o.name),o.mapping!==void 0&&(h.mapping=r(o.mapping,ywe)),o.offset!==void 0&&h.offset.fromArray(o.offset),o.repeat!==void 0&&h.repeat.fromArray(o.repeat),o.center!==void 0&&h.center.fromArray(o.center),o.rotation!==void 0&&(h.rotation=o.rotation),o.wrap!==void 0&&(h.wrapS=r(o.wrap[0],Zj),h.wrapT=r(o.wrap[1],Zj)),o.format!==void 0&&(h.format=o.format),o.type!==void 0&&(h.type=o.type),o.encoding!==void 0&&(h.encoding=o.encoding),o.minFilter!==void 0&&(h.minFilter=r(o.minFilter,eW)),o.magFilter!==void 0&&(h.magFilter=r(o.magFilter,eW)),o.anisotropy!==void 0&&(h.anisotropy=o.anisotropy),o.flipY!==void 0&&(h.flipY=o.flipY),o.premultiplyAlpha!==void 0&&(h.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(h.unpackAlignment=o.unpackAlignment),o.userData!==void 0&&(h.userData=o.userData),n[o.uuid]=h}return n}parseObject(e,i,r,n,s){let a;function o(d){return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),i[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const f=[];for(let p=0,m=d.length;p<m;p++){const g=d[p];r[g]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",g),f.push(r[g])}return f}return r[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),r[d]}}function c(d){return n[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),n[d]}let h,u;switch(e.type){case"Scene":a=new a2,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new Ct(e.background):a.background=c(e.background)),e.environment!==void 0&&(a.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new lD(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new oD(e.fog.color,e.fog.density))),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness);break;case"PerspectiveCamera":a=new Or(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new Dc(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new Jie(e.color,e.intensity);break;case"DirectionalLight":a=new K4(e.color,e.intensity);break;case"PointLight":a=new q4(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new Zie(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new Y4(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":a=new $ie(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new pD().fromJSON(e);break;case"SkinnedMesh":h=o(e.geometry),u=l(e.material),a=new D4(h,u),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":h=o(e.geometry),u=l(e.material),a=new Ms(h,u);break;case"InstancedMesh":h=o(e.geometry),u=l(e.material);const d=e.count,f=e.instanceMatrix,p=e.instanceColor;a=new R4(h,u,d),a.instanceMatrix=new Og(new Float32Array(f.array),16),p!==void 0&&(a.instanceColor=new Og(new Float32Array(p.array),p.itemSize));break;case"LOD":a=new Tie;break;case"Line":a=new dd(o(e.geometry),l(e.material));break;case"LineLoop":a=new I4(o(e.geometry),l(e.material));break;case"LineSegments":a=new kc(o(e.geometry),l(e.material));break;case"PointCloud":case"Points":a=new L4(o(e.geometry),l(e.material));break;case"Sprite":a=new Mie(l(e.material));break;case"Group":a=new Yu;break;case"Bone":a=new cD;break;default:a=new zi}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const d=e.children;for(let f=0;f<d.length;f++)a.add(this.parseObject(d[f],i,r,n,s))}if(e.animations!==void 0){const d=e.animations;for(let f=0;f<d.length;f++){const p=d[f];a.animations.push(s[p])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const d=e.levels;for(let f=0;f<d.length;f++){const p=d[f],m=a.getObjectByProperty("uuid",p.object);m!==void 0&&a.addLevel(m,p.distance)}}return a}bindSkeletons(e,i){Object.keys(i).length!==0&&e.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const n=i[r.skeleton];n===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(n,r.bindMatrix)}})}}const ywe={UVMapping:tD,CubeReflectionMapping:hp,CubeRefractionMapping:up,EquirectangularReflectionMapping:Kw,EquirectangularRefractionMapping:Qw,CubeUVReflectionMapping:I1},Zj={RepeatWrapping:dp,ClampToEdgeWrapping:js,MirroredRepeatWrapping:Ky},eW={NearestFilter:xn,NearestMipmapNearestFilter:$w,NearestMipmapLinearFilter:Jw,LinearFilter:Hr,LinearMipmapNearestFilter:iD,LinearMipmapLinearFilter:_d};class rre extends Ya{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,i,r,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Ng.get(e);if(a!==void 0)return s.manager.itemStart(e),setTimeout(function(){i&&i(a),s.manager.itemEnd(e)},0),a;const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){Ng.add(e,l),i&&i(l),s.manager.itemEnd(e)}).catch(function(l){n&&n(l),s.manager.itemError(e),s.manager.itemEnd(e)}),s.manager.itemStart(e)}}let OE,Q4=class{static getContext(){return OE===void 0&&(OE=new(window.AudioContext||window.webkitAudioContext)),OE}static setContext(e){OE=e}};class xwe extends Ya{constructor(e){super(e)}load(e,i,r,n){const s=this,a=new Xo(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{const l=o.slice(0);Q4.getContext().decodeAudioData(l,function(h){i(h)})}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},r,n)}}class bwe extends pD{constructor(e,i,r=1){super(void 0,r),this.isHemisphereLightProbe=!0;const n=new Ct().set(e),s=new Ct().set(i),a=new le(n.r,n.g,n.b),o=new le(s.r,s.g,s.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(l),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(c)}}class wwe extends pD{constructor(e,i=1){super(void 0,i),this.isAmbientLightProbe=!0;const r=new Ct().set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const tW=new ui,iW=new ui,Jp=new ui;class Swe{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Or,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Or,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const i=this._cache;if(i.focus!==e.focus||i.fov!==e.fov||i.aspect!==e.aspect*this.aspect||i.near!==e.near||i.far!==e.far||i.zoom!==e.zoom||i.eyeSep!==this.eyeSep){i.focus=e.focus,i.fov=e.fov,i.aspect=e.aspect*this.aspect,i.near=e.near,i.far=e.far,i.zoom=e.zoom,i.eyeSep=this.eyeSep,Jp.copy(e.projectionMatrix);const n=i.eyeSep/2,s=n*i.near/i.focus,a=i.near*Math.tan(cg*i.fov*.5)/i.zoom;let o,l;iW.elements[12]=-n,tW.elements[12]=n,o=-a*i.aspect+s,l=a*i.aspect+s,Jp.elements[0]=2*i.near/(l-o),Jp.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(Jp),o=-a*i.aspect-s,l=a*i.aspect-s,Jp.elements[0]=2*i.near/(l-o),Jp.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(Jp)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(iW),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(tW)}}class $4{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=rW(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=rW();e=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=e}return e}}function rW(){return(typeof performance>"u"?Date:performance).now()}const Zp=new le,nW=new Ds,_we=new le,em=new le;class Awe extends zi{constructor(){super(),this.type="AudioListener",this.context=Q4.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new $4}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const i=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Zp,nW,_we),em.set(0,0,-1).applyQuaternion(nW),i.positionX){const n=this.context.currentTime+this.timeDelta;i.positionX.linearRampToValueAtTime(Zp.x,n),i.positionY.linearRampToValueAtTime(Zp.y,n),i.positionZ.linearRampToValueAtTime(Zp.z,n),i.forwardX.linearRampToValueAtTime(em.x,n),i.forwardY.linearRampToValueAtTime(em.y,n),i.forwardZ.linearRampToValueAtTime(em.z,n),i.upX.linearRampToValueAtTime(r.x,n),i.upY.linearRampToValueAtTime(r.y,n),i.upZ.linearRampToValueAtTime(r.z,n)}else i.setPosition(Zp.x,Zp.y,Zp.z),i.setOrientation(em.x,em.y,em.z,r.x,r.y,r.z)}}class nre extends zi{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const i=this.context.createBufferSource();return i.buffer=this.buffer,i.loop=this.loop,i.loopStart=this.loopStart,i.loopEnd=this.loopEnd,i.onended=this.onEnded.bind(this),i.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=i,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,i=this.filters.length;e<i;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,i=this.filters.length;e<i;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const tm=new le,sW=new Ds,Ewe=new le,im=new le;class Mwe extends nre{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,i,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(tm,sW,Ewe),im.set(0,0,1).applyQuaternion(sW);const i=this.panner;if(i.positionX){const r=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(tm.x,r),i.positionY.linearRampToValueAtTime(tm.y,r),i.positionZ.linearRampToValueAtTime(tm.z,r),i.orientationX.linearRampToValueAtTime(im.x,r),i.orientationY.linearRampToValueAtTime(im.y,r),i.orientationZ.linearRampToValueAtTime(im.z,r)}else i.setPosition(tm.x,tm.y,tm.z),i.setOrientation(im.x,im.y,im.z)}}class Twe{constructor(e,i=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const i=this.getFrequencyData();for(let r=0;r<i.length;r++)e+=i[r];return e/i.length}}class sre{constructor(e,i,r){this.binding=e,this.valueSize=r;let n,s,a;switch(i){case"quaternion":n=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:n=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,i){const r=this.buffer,n=this.valueSize,s=e*n+n;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==n;++o)r[s+o]=r[o];a=i}else{a+=i;const o=i/a;this._mixBufferRegion(r,s,0,o,n)}this.cumulativeWeight=a}accumulateAdditive(e){const i=this.buffer,r=this.valueSize,n=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,n,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const i=this.valueSize,r=this.buffer,n=e*i+i,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=i*this._origIndex;this._mixBufferRegion(r,n,l,1-s,i)}a>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*i,1,i);for(let l=i,c=i+i;l!==c;++l)if(r[l]!==r[l+i]){o.setValue(r,n);break}}saveOriginalState(){const e=this.binding,i=this.buffer,r=this.valueSize,n=r*this._origIndex;e.getValue(i,n);for(let s=r,a=n;s!==a;++s)i[s]=i[n+s%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,i=e+this.valueSize;for(let r=e;r<i;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[i+r]=this.buffer[e+r]}_select(e,i,r,n,s){if(n>=.5)for(let a=0;a!==s;++a)e[i+a]=e[r+a]}_slerp(e,i,r,n){Ds.slerpFlat(e,i,e,i,e,r,n)}_slerpAdditive(e,i,r,n,s){const a=this._workIndex*s;Ds.multiplyQuaternionsFlat(e,a,e,i,e,r),Ds.slerpFlat(e,i,e,i,e,a,n)}_lerp(e,i,r,n,s){const a=1-n;for(let o=0;o!==s;++o){const l=i+o;e[l]=e[l]*a+e[r+o]*n}}_lerpAdditive(e,i,r,n,s){for(let a=0;a!==s;++a){const o=i+a;e[o]=e[o]+e[r+a]*n}}}const J4="\\[\\]\\.:\\/",Cwe=new RegExp("["+J4+"]","g"),Z4="[^"+J4+"]",Pwe="[^"+J4.replace("\\.","")+"]",Dwe=/((?:WC+[\/:])*)/.source.replace("WC",Z4),Rwe=/(WCOD+)?/.source.replace("WCOD",Pwe),Iwe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Z4),Lwe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Z4),Owe=new RegExp("^"+Dwe+Rwe+Iwe+Lwe+"$"),Bwe=["material","materials","bones","map"];class Fwe{constructor(e,i,r){const n=r||Ui.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,n)}getValue(e,i){this.bind();const r=this._targetGroup.nCachedObjects_,n=this._bindings[r];n!==void 0&&n.getValue(e,i)}setValue(e,i){const r=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=r.length;n!==s;++n)r[n].setValue(e,i)}bind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=e.length;i!==r;++i)e[i].bind()}unbind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=e.length;i!==r;++i)e[i].unbind()}}class Ui{constructor(e,i,r){this.path=i,this.parsedPath=r||Ui.parseTrackName(i),this.node=Ui.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,r){return e&&e.isAnimationObjectGroup?new Ui.Composite(e,i,r):new Ui(e,i,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Cwe,"")}static parseTrackName(e){const i=Owe.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const s=r.nodeName.substring(n+1);Bwe.indexOf(s)!==-1&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=s)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(i);if(r!==void 0)return r}if(e.children){const r=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===i||o.uuid===i)return o;const l=r(o.children);if(l)return l}return null},n=r(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)e[i++]=r[n]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,r=i.objectName,n=i.propertyName;let s=i.propertyIndex;if(e||(e=Ui.findNode(this.rootNode,i.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){let c=i.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const a=e[n];if(a===void 0){const c=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ui.Composite=Fwe;Ui.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ui.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ui.prototype.GetterByBindingType=[Ui.prototype._getValue_direct,Ui.prototype._getValue_array,Ui.prototype._getValue_arrayElement,Ui.prototype._getValue_toArray];Ui.prototype.SetterByBindingTypeAndVersioning=[[Ui.prototype._setValue_direct,Ui.prototype._setValue_direct_setNeedsUpdate,Ui.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ui.prototype._setValue_array,Ui.prototype._setValue_array_setNeedsUpdate,Ui.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ui.prototype._setValue_arrayElement,Ui.prototype._setValue_arrayElement_setNeedsUpdate,Ui.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ui.prototype._setValue_fromArray,Ui.prototype._setValue_fromArray_setNeedsUpdate,Ui.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class kwe{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Vo(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let r=0,n=arguments.length;r!==n;++r)e[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const e=this._objects,i=this._indicesByUUID,r=this._paths,n=this._parsedPaths,s=this._bindings,a=s.length;let o,l=e.length,c=this.nCachedObjects_;for(let h=0,u=arguments.length;h!==u;++h){const d=arguments[h],f=d.uuid;let p=i[f];if(p===void 0){p=l++,i[f]=p,e.push(d);for(let m=0,g=a;m!==g;++m)s[m].push(new Ui(d,r[m],n[m]))}else if(p<c){o=e[p];const m=--c,g=e[m];i[g.uuid]=p,e[p]=g,i[f]=m,e[m]=d;for(let v=0,y=a;v!==y;++v){const x=s[v],S=x[m];let A=x[p];x[p]=S,A===void 0&&(A=new Ui(d,r[v],n[v])),x[m]=A}}else e[p]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],c=l.uuid,h=i[c];if(h!==void 0&&h>=s){const u=s++,d=e[u];i[d.uuid]=h,e[h]=d,i[c]=u,e[u]=l;for(let f=0,p=n;f!==p;++f){const m=r[f],g=m[u],v=m[h];m[h]=g,m[u]=v}}}this.nCachedObjects_=s}uncache(){const e=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_,a=e.length;for(let o=0,l=arguments.length;o!==l;++o){const c=arguments[o],h=c.uuid,u=i[h];if(u!==void 0)if(delete i[h],u<s){const d=--s,f=e[d],p=--a,m=e[p];i[f.uuid]=u,e[u]=f,i[m.uuid]=d,e[d]=m,e.pop();for(let g=0,v=n;g!==v;++g){const y=r[g],x=y[d],S=y[p];y[u]=x,y[d]=S,y.pop()}}else{const d=--a,f=e[d];d>0&&(i[f.uuid]=u),e[u]=f,e.pop();for(let p=0,m=n;p!==m;++p){const g=r[p];g[u]=g[d],g.pop()}}}this.nCachedObjects_=s}subscribe_(e,i){const r=this._bindingsIndicesByPath;let n=r[e];const s=this._bindings;if(n!==void 0)return s[n];const a=this._paths,o=this._parsedPaths,l=this._objects,c=l.length,h=this.nCachedObjects_,u=new Array(c);n=s.length,r[e]=n,a.push(e),o.push(i),s.push(u);for(let d=h,f=l.length;d!==f;++d){const p=l[d];u[d]=new Ui(p,e,i)}return u}unsubscribe_(e){const i=this._bindingsIndicesByPath,r=i[e];if(r!==void 0){const n=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],c=e[o];i[c]=r,a[r]=l,a.pop(),s[r]=s[o],s.pop(),n[r]=n[o],n.pop()}}}class Nwe{constructor(e,i,r=null,n=i.blendMode){this._mixer=e,this._clip=i,this._localRoot=r,this.blendMode=n;const s=i.tracks,a=s.length,o=new Array(a),l={endingStart:Gm,endingEnd:Gm};for(let c=0;c!==a;++c){const h=s[c].createInterpolant(null);o[c]=h,h.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=sie,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,i){return this.loop=e,this.repetitions=i,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,i,r){if(e.fadeOut(i),this.fadeIn(i),r){const n=this._clip.duration,s=e._clip.duration,a=s/n,o=n/s;e.warp(1,a,i),this.warp(o,1,i)}return this}crossFadeTo(e,i,r){return e.crossFadeFrom(this,i,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,i,r){const n=this._mixer,s=n.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=s,l[1]=s+r,c[0]=e/a,c[1]=i/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,i,r,n){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*r;l<0||r===0?i=0:(this._startTime=null,i=r*l)}i*=this._updateTimeScale(e);const a=this._updateTime(i),o=this._updateWeight(e);if(o>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case g4:for(let h=0,u=l.length;h!==u;++h)l[h].evaluate(a),c[h].accumulateAdditive(o);break;case rD:default:for(let h=0,u=l.length;h!==u;++h)l[h].evaluate(a),c[h].accumulate(n,o)}}}_updateWeight(e){let i=0;if(this.enabled){i=this.weight;const r=this._weightInterpolant;if(r!==null){const n=r.evaluate(e)[0];i*=n,e>r.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(e){let i=0;if(!this.paused){i=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const n=r.evaluate(e)[0];i*=n,e>r.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(e){const i=this._clip.duration,r=this.loop;let n=this.time+e,s=this._loopCount;const a=r===aie;if(e===0)return s===-1?n:a&&(s&1)===1?i-n:n;if(r===nie){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=i)n=i;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=i||n<0){const o=Math.floor(n/i);n-=i*o,s+=Math.abs(o);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?i:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return i-n}return n}_setEndings(e,i,r){const n=this._interpolantSettings;r?(n.endingStart=Vm,n.endingEnd=Vm):(e?n.endingStart=this.zeroSlopeAtStart?Vm:Gm:n.endingStart=Zw,i?n.endingEnd=this.zeroSlopeAtEnd?Vm:Gm:n.endingEnd=Zw)}_scheduleFading(e,i,r){const n=this._mixer,s=n.time;let a=this._weightInterpolant;a===null&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,l[0]=i,o[1]=s+e,l[1]=r,this}}const Uwe=new Float32Array(1);class zwe extends Yh{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,i){const r=e._localRoot||this._root,n=e._clip.tracks,s=n.length,a=e._propertyBindings,o=e._interpolants,l=r.uuid,c=this._bindingsByRootAndName;let h=c[l];h===void 0&&(h={},c[l]=h);for(let u=0;u!==s;++u){const d=n[u],f=d.name;let p=h[f];if(p!==void 0)++p.referenceCount,a[u]=p;else{if(p=a[u],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,l,f));continue}const m=i&&i._propertyBindings[u].binding.parsedPath;p=new sre(Ui.create(r,f,m),d.ValueTypeName,d.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,l,f),a[u]=p}o[u].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,n=e._clip.uuid,s=this._actionsByClip[n];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,n,r)}const i=e._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const i=e._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const i=e._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(e,i,r){const n=this._actions,s=this._actionsByClip;let a=s[i];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[i]=a;else{const o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=n.length,n.push(e),a.actionByRoot[r]=e}_removeInactiveAction(e){const i=this._actions,r=i[i.length-1],n=e._cacheIndex;r._cacheIndex=n,i[n]=r,i.pop(),e._cacheIndex=null;const s=e._clip.uuid,a=this._actionsByClip,o=a[s],l=o.knownActions,c=l[l.length-1],h=e._byClipCacheIndex;c._byClipCacheIndex=h,l[h]=c,l.pop(),e._byClipCacheIndex=null;const u=o.actionByRoot,d=(e._localRoot||this._root).uuid;delete u[d],l.length===0&&delete a[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const i=e._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const i=this._actions,r=e._cacheIndex,n=this._nActiveActions++,s=i[n];e._cacheIndex=n,i[n]=e,s._cacheIndex=r,i[r]=s}_takeBackAction(e){const i=this._actions,r=e._cacheIndex,n=--this._nActiveActions,s=i[n];e._cacheIndex=n,i[n]=e,s._cacheIndex=r,i[r]=s}_addInactiveBinding(e,i,r){const n=this._bindingsByRootAndName,s=this._bindings;let a=n[i];a===void 0&&(a={},n[i]=a),a[r]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const i=this._bindings,r=e.binding,n=r.rootNode.uuid,s=r.path,a=this._bindingsByRootAndName,o=a[n],l=i[i.length-1],c=e._cacheIndex;l._cacheIndex=c,i[c]=l,i.pop(),delete o[s],Object.keys(o).length===0&&delete a[n]}_lendBinding(e){const i=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,s=i[n];e._cacheIndex=n,i[n]=e,s._cacheIndex=r,i[r]=s}_takeBackBinding(e){const i=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,s=i[n];e._cacheIndex=n,i[n]=e,s._cacheIndex=r,i[r]=s}_lendControlInterpolant(){const e=this._controlInterpolants,i=this._nActiveControlInterpolants++;let r=e[i];return r===void 0&&(r=new H4(new Float32Array(2),new Float32Array(2),1,Uwe),r.__cacheIndex=i,e[i]=r),r}_takeBackControlInterpolant(e){const i=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,s=i[n];e.__cacheIndex=n,i[n]=e,s.__cacheIndex=r,i[r]=s}clipAction(e,i,r){const n=i||this._root,s=n.uuid;let a=typeof e=="string"?Zy.findByName(n,e):e;const o=a!==null?a.uuid:e,l=this._actionsByClip[o];let c=null;if(r===void 0&&(a!==null?r=a.blendMode:r=rD),l!==void 0){const u=l.actionByRoot[s];if(u!==void 0&&u.blendMode===r)return u;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const h=new Nwe(this,a,i,r);return this._bindAction(h,c),this._addInactiveAction(h,o,s),h}existingAction(e,i){const r=i||this._root,n=r.uuid,s=typeof e=="string"?Zy.findByName(r,e):e,a=s?s.uuid:e,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[n]||null}stopAllAction(){const e=this._actions,i=this._nActiveActions;for(let r=i-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;const i=this._actions,r=this._nActiveActions,n=this.time+=e,s=Math.sign(e),a=this._accuIndex^=1;for(let c=0;c!==r;++c)i[c]._update(n,e,s,a);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(a);return this}setTime(e){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const i=this._actions,r=e.uuid,n=this._actionsByClip,s=n[r];if(s!==void 0){const a=s.knownActions;for(let o=0,l=a.length;o!==l;++o){const c=a[o];this._deactivateAction(c);const h=c._cacheIndex,u=i[i.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,u._cacheIndex=h,i[h]=u,i.pop(),this._removeInactiveBindingsForAction(c)}delete n[r]}}uncacheRoot(e){const i=e.uuid,r=this._actionsByClip;for(const a in r){const o=r[a].actionByRoot,l=o[i];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const n=this._bindingsByRootAndName,s=n[i];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,i){const r=this.existingAction(e,i);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class e5{constructor(e){this.value=e}clone(){return new e5(this.value.clone===void 0?this.value:this.value.clone())}}let Gwe=0;class Vwe extends Yh{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Gwe++}),this.name="",this.usage=eS,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const i=this.uniforms.indexOf(e);return i!==-1&&this.uniforms.splice(i,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const i=e.uniforms;this.uniforms.length=0;for(let r=0,n=i.length;r<n;r++)this.uniforms.push(i[r].clone());return this}clone(){return new this.constructor().copy(this)}}class Hwe extends n_{constructor(e,i,r=1){super(e,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const i=super.clone(e);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(e){const i=super.toJSON(e);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class jwe{constructor(e,i,r,n,s){this.isGLBufferAttribute=!0,this.buffer=e,this.type=i,this.itemSize=r,this.elementSize=n,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,i){return this.type=e,this.elementSize=i,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class are{constructor(e,i,r=0,n=1/0){this.ray=new L1(e,i),this.near=r,this.far=n,this.camera=null,this.layers=new ug,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,i){this.ray.set(e,i)}setFromCamera(e,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}intersectObject(e,i=!0,r=[]){return nk(e,this,r,i),r.sort(aW),r}intersectObjects(e,i=!0,r=[]){for(let n=0,s=e.length;n<s;n++)nk(e[n],this,r,i);return r.sort(aW),r}}function aW(t,e){return t.distance-e.distance}function nk(t,e,i,r){if(t.layers.test(e.layers)&&t.raycast(e,i),r===!0){const n=t.children;for(let s=0,a=n.length;s<a;s++)nk(n[s],e,i,!0)}}class sk{constructor(e=1,i=0,r=0){return this.radius=e,this.phi=i,this.theta=r,this}set(e,i,r){return this.radius=e,this.phi=i,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,r){return this.radius=Math.sqrt(e*e+i*i+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(bn(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Wwe{constructor(e=1,i=0,r=0){return this.radius=e,this.theta=i,this.y=r,this}set(e,i,r){return this.radius=e,this.theta=i,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=i,this}clone(){return new this.constructor().copy(this)}}const oW=new tt;class Xwe{constructor(e=new tt(1/0,1/0),i=new tt(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromPoints(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const r=oW.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return oW.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const lW=new le,BE=new le;class Ywe{constructor(e=new le,i=new le){this.start=e,this.end=i}set(e,i){return this.start.copy(e),this.end.copy(i),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,i){return this.delta(i).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,i){lW.subVectors(e,this.start),BE.subVectors(this.end,this.start);const r=BE.dot(BE);let s=BE.dot(lW)/r;return i&&(s=bn(s,0,1)),s}closestPointToPoint(e,i,r){const n=this.closestPointToPointParameter(e,i);return this.delta(r).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const cW=new le;class qwe extends zi{constructor(e,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const r=new xi,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const c=a/l*Math.PI*2,h=o/l*Math.PI*2;n.push(Math.cos(c),Math.sin(c),1,Math.cos(h),Math.sin(h),1)}r.setAttribute("position",new zt(n,3));const s=new wa({fog:!1,toneMapped:!1});this.cone=new kc(r,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,i=e*Math.tan(this.light.angle);this.cone.scale.set(i,i,e),cW.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(cW),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const qd=new le,FE=new ui,gL=new ui;class Kwe extends kc{constructor(e){const i=ore(e),r=new xi,n=[],s=[],a=new Ct(0,0,1),o=new Ct(0,1,0);for(let c=0;c<i.length;c++){const h=i[c];h.parent&&h.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(a.r,a.g,a.b),s.push(o.r,o.g,o.b))}r.setAttribute("position",new zt(n,3)),r.setAttribute("color",new zt(s,3));const l=new wa({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=i,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const i=this.bones,r=this.geometry,n=r.getAttribute("position");gL.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<i.length;s++){const o=i[s];o.parent&&o.parent.isBone&&(FE.multiplyMatrices(gL,o.matrixWorld),qd.setFromMatrixPosition(FE),n.setXYZ(a,qd.x,qd.y,qd.z),FE.multiplyMatrices(gL,o.parent.matrixWorld),qd.setFromMatrixPosition(FE),n.setXYZ(a+1,qd.x,qd.y,qd.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function ore(t){const e=[];t.isBone===!0&&e.push(t);for(let i=0;i<t.children.length;i++)e.push.apply(e,ore(t.children[i]));return e}class Qwe extends Ms{constructor(e,i,r){const n=new N1(i,4,2),s=new ko({wireframe:!0,fog:!1,toneMapped:!1});super(n,s),this.light=e,this.light.updateMatrixWorld(),this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const $we=new le,hW=new Ct,uW=new Ct;class Jwe extends zi{constructor(e,i,r){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;const n=new k1(i);n.rotateY(Math.PI*.5),this.material=new ko({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=n.getAttribute("position"),a=new Float32Array(s.count*3);n.setAttribute("color",new Xi(a,3)),this.add(new Ms(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=e.geometry.getAttribute("color");hW.copy(this.light.color),uW.copy(this.light.groundColor);for(let r=0,n=i.count;r<n;r++){const s=r<n/2?hW:uW;i.setXYZ(r,s.r,s.g,s.b)}i.needsUpdate=!0}e.lookAt($we.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Zwe extends kc{constructor(e=10,i=10,r=4473924,n=8947848){r=new Ct(r),n=new Ct(n);const s=i/2,a=e/i,o=e/2,l=[],c=[];for(let d=0,f=0,p=-o;d<=i;d++,p+=a){l.push(-o,0,p,o,0,p),l.push(p,0,-o,p,0,o);const m=d===s?r:n;m.toArray(c,f),f+=3,m.toArray(c,f),f+=3,m.toArray(c,f),f+=3,m.toArray(c,f),f+=3}const h=new xi;h.setAttribute("position",new zt(l,3)),h.setAttribute("color",new zt(c,3));const u=new wa({vertexColors:!0,toneMapped:!1});super(h,u),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class eSe extends kc{constructor(e=10,i=16,r=8,n=64,s=4473924,a=8947848){s=new Ct(s),a=new Ct(a);const o=[],l=[];if(i>1)for(let u=0;u<i;u++){const d=u/i*(Math.PI*2),f=Math.sin(d)*e,p=Math.cos(d)*e;o.push(0,0,0),o.push(f,0,p);const m=u&1?s:a;l.push(m.r,m.g,m.b),l.push(m.r,m.g,m.b)}for(let u=0;u<r;u++){const d=u&1?s:a,f=e-e/r*u;for(let p=0;p<n;p++){let m=p/n*(Math.PI*2),g=Math.sin(m)*f,v=Math.cos(m)*f;o.push(g,0,v),l.push(d.r,d.g,d.b),m=(p+1)/n*(Math.PI*2),g=Math.sin(m)*f,v=Math.cos(m)*f,o.push(g,0,v),l.push(d.r,d.g,d.b)}}const c=new xi;c.setAttribute("position",new zt(o,3)),c.setAttribute("color",new zt(l,3));const h=new wa({vertexColors:!0,toneMapped:!1});super(c,h),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const dW=new le,kE=new le,fW=new le;class tSe extends zi{constructor(e,i,r){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,i===void 0&&(i=1);let n=new xi;n.setAttribute("position",new zt([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const s=new wa({fog:!1,toneMapped:!1});this.lightPlane=new dd(n,s),this.add(this.lightPlane),n=new xi,n.setAttribute("position",new zt([0,0,0,0,0,1],3)),this.targetLine=new dd(n,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){dW.setFromMatrixPosition(this.light.matrixWorld),kE.setFromMatrixPosition(this.light.target.matrixWorld),fW.subVectors(kE,dW),this.lightPlane.lookAt(kE),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(kE),this.targetLine.scale.z=fW.length()}}const NE=new le,Zr=new i_;class iSe extends kc{constructor(e){const i=new xi,r=new wa({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(p,m){l(p),l(m)}function l(p){n.push(0,0,0),s.push(0,0,0),a[p]===void 0&&(a[p]=[]),a[p].push(n.length/3-1)}i.setAttribute("position",new zt(n,3)),i.setAttribute("color",new zt(s,3)),super(i,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new Ct(16755200),h=new Ct(16711680),u=new Ct(43775),d=new Ct(16777215),f=new Ct(3355443);this.setColors(c,h,u,d,f)}setColors(e,i,r,n,s){const o=this.geometry.getAttribute("color");o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,i.r,i.g,i.b),o.setXYZ(25,i.r,i.g,i.b),o.setXYZ(26,i.r,i.g,i.b),o.setXYZ(27,i.r,i.g,i.b),o.setXYZ(28,i.r,i.g,i.b),o.setXYZ(29,i.r,i.g,i.b),o.setXYZ(30,i.r,i.g,i.b),o.setXYZ(31,i.r,i.g,i.b),o.setXYZ(32,r.r,r.g,r.b),o.setXYZ(33,r.r,r.g,r.b),o.setXYZ(34,r.r,r.g,r.b),o.setXYZ(35,r.r,r.g,r.b),o.setXYZ(36,r.r,r.g,r.b),o.setXYZ(37,r.r,r.g,r.b),o.setXYZ(38,n.r,n.g,n.b),o.setXYZ(39,n.r,n.g,n.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0}update(){const e=this.geometry,i=this.pointMap,r=1,n=1;Zr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),dn("c",i,e,Zr,0,0,-1),dn("t",i,e,Zr,0,0,1),dn("n1",i,e,Zr,-r,-n,-1),dn("n2",i,e,Zr,r,-n,-1),dn("n3",i,e,Zr,-r,n,-1),dn("n4",i,e,Zr,r,n,-1),dn("f1",i,e,Zr,-r,-n,1),dn("f2",i,e,Zr,r,-n,1),dn("f3",i,e,Zr,-r,n,1),dn("f4",i,e,Zr,r,n,1),dn("u1",i,e,Zr,r*.7,n*1.1,-1),dn("u2",i,e,Zr,-r*.7,n*1.1,-1),dn("u3",i,e,Zr,0,n*2,-1),dn("cf1",i,e,Zr,-r,0,1),dn("cf2",i,e,Zr,r,0,1),dn("cf3",i,e,Zr,0,-n,1),dn("cf4",i,e,Zr,0,n,1),dn("cn1",i,e,Zr,-r,0,-1),dn("cn2",i,e,Zr,r,0,-1),dn("cn3",i,e,Zr,0,-n,-1),dn("cn4",i,e,Zr,0,n,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function dn(t,e,i,r,n,s,a){NE.set(n,s,a).unproject(r);const o=e[t];if(o!==void 0){const l=i.getAttribute("position");for(let c=0,h=o.length;c<h;c++)l.setXYZ(o[c],NE.x,NE.y,NE.z)}}const UE=new Ad;class rSe extends kc{constructor(e,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(8*3),s=new xi;s.setIndex(new Xi(r,1)),s.setAttribute("position",new Xi(n,3)),super(s,new wa({color:i,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&UE.setFromObject(this.object),UE.isEmpty())return;const i=UE.min,r=UE.max,n=this.geometry.attributes.position,s=n.array;s[0]=r.x,s[1]=r.y,s[2]=r.z,s[3]=i.x,s[4]=r.y,s[5]=r.z,s[6]=i.x,s[7]=i.y,s[8]=r.z,s[9]=r.x,s[10]=i.y,s[11]=r.z,s[12]=r.x,s[13]=r.y,s[14]=i.z,s[15]=i.x,s[16]=r.y,s[17]=i.z,s[18]=i.x,s[19]=i.y,s[20]=i.z,s[21]=r.x,s[22]=i.y,s[23]=i.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,i){return super.copy(e,i),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class nSe extends kc{constructor(e,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new xi;s.setIndex(new Xi(r,1)),s.setAttribute("position",new zt(n,3)),super(s,new wa({color:i,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class sSe extends dd{constructor(e,i=1,r=16776960){const n=r,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new xi;a.setAttribute("position",new zt(s,3)),a.computeBoundingSphere(),super(a,new wa({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=i;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new xi;l.setAttribute("position",new zt(o,3)),l.computeBoundingSphere(),this.add(new Ms(l,new ko({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const pW=new le;let zE,vL;class aSe extends zi{constructor(e=new le(0,0,1),i=new le(0,0,0),r=1,n=16776960,s=r*.2,a=s*.2){super(),this.type="ArrowHelper",zE===void 0&&(zE=new xi,zE.setAttribute("position",new zt([0,0,0,0,1,0],3)),vL=new Zg(0,.5,1,5,1),vL.translate(0,-.5,0)),this.position.copy(i),this.line=new dd(zE,new wa({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ms(vL,new ko({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,s,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{pW.set(e.z,0,-e.x).normalize();const i=Math.acos(e.y);this.quaternion.setFromAxisAngle(pW,i)}}setLength(e,i=e*.2,r=i*.2){this.line.scale.set(1,Math.max(1e-4,e-i),1),this.line.updateMatrix(),this.cone.scale.set(r,i,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class oSe extends kc{constructor(e=1){const i=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new xi;n.setAttribute("position",new zt(i,3)),n.setAttribute("color",new zt(r,3));const s=new wa({vertexColors:!0,toneMapped:!1});super(n,s),this.type="AxesHelper"}setColors(e,i,r){const n=new Ct,s=this.geometry.attributes.color.array;return n.set(e),n.toArray(s,0),n.toArray(s,3),n.set(i),n.toArray(s,6),n.toArray(s,9),n.set(r),n.toArray(s,12),n.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class lSe{constructor(){this.type="ShapePath",this.color=new Ct,this.subPaths=[],this.currentPath=null}moveTo(e,i){return this.currentPath=new rS,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,i),this}lineTo(e,i){return this.currentPath.lineTo(e,i),this}quadraticCurveTo(e,i,r,n){return this.currentPath.quadraticCurveTo(e,i,r,n),this}bezierCurveTo(e,i,r,n,s,a){return this.currentPath.bezierCurveTo(e,i,r,n,s,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function i(v){const y=[];for(let x=0,S=v.length;x<S;x++){const A=v[x],_=new dg;_.curves=A.curves,y.push(_)}return y}function r(v,y){const x=y.length;let S=!1;for(let A=x-1,_=0;_<x;A=_++){let M=y[A],E=y[_],T=E.x-M.x,C=E.y-M.y;if(Math.abs(C)>Number.EPSILON){if(C<0&&(M=y[_],T=-T,E=y[A],C=-C),v.y<M.y||v.y>E.y)continue;if(v.y===M.y){if(v.x===M.x)return!0}else{const D=C*(v.x-M.x)-T*(v.y-M.y);if(D===0)return!0;if(D<0)continue;S=!S}}else{if(v.y!==M.y)continue;if(E.x<=v.x&&v.x<=M.x||M.x<=v.x&&v.x<=E.x)return!0}}return S}const n=Rh.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,l;const c=[];if(s.length===1)return o=s[0],l=new dg,l.curves=o.curves,c.push(l),c;let h=!n(s[0].getPoints());h=e?!h:h;const u=[],d=[];let f=[],p=0,m;d[p]=void 0,f[p]=[];for(let v=0,y=s.length;v<y;v++)o=s[v],m=o.getPoints(),a=n(m),a=e?!a:a,a?(!h&&d[p]&&p++,d[p]={s:new dg,p:m},d[p].s.curves=o.curves,h&&p++,f[p]=[]):f[p].push({h:o,p:m[0]});if(!d[0])return i(s);if(d.length>1){let v=!1,y=0;for(let x=0,S=d.length;x<S;x++)u[x]=[];for(let x=0,S=d.length;x<S;x++){const A=f[x];for(let _=0;_<A.length;_++){const M=A[_];let E=!0;for(let T=0;T<d.length;T++)r(M.p,d[T].p)&&(x!==T&&y++,E?(E=!1,u[T].push(M)):v=!0);E&&u[x].push(M)}}y>0&&v===!1&&(f=u)}let g;for(let v=0,y=d.length;v<y;v++){l=d[v].s,c.push(l),g=f[v];for(let x=0,S=g.length;x<S;x++)l.holes.push(g[x].h)}return c}}const zu=cSe();function cSe(){const t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,h=0;for(;!(c&8388608);)c<<=1,h-=8388608;c&=-8388609,h+=947912704,s[l]=c|h}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function hSe(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=bn(t,-65504,65504),zu.floatView[0]=t;const e=zu.uint32View[0],i=e>>23&511;return zu.baseTable[i]+((e&8388607)>>zu.shiftTable[i])}function uSe(t){const e=t>>10;return zu.uint32View[0]=zu.mantissaTable[zu.offsetTable[e]+(t&1023)]+zu.exponentTable[e],zu.floatView[0]}var dSe=Object.freeze({__proto__:null,toHalfFloat:hSe,fromHalfFloat:uSe});function fSe(){console.error("THREE.ImmediateRenderObject has been removed.")}class pSe extends Hl{constructor(e,i,r){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(e,i,r),this.samples=4}}class mSe extends t_{constructor(e,i,r,n){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(e,i,r,n)}}class gSe extends nD{constructor(e,i,r,n){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(e,i,r,n)}}class vSe extends Pp{constructor(e,i,r,n,s,a){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,i,r,n,s,a)}}class ySe extends a_{constructor(e,i,r,n){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,i,r,n)}}class xSe extends o_{constructor(e,i,r,n){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,i,r,n)}}class bSe extends l_{constructor(e,i,r,n,s,a,o){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,i,r,n,s,a,o)}}class wSe extends Zg{constructor(e,i,r,n,s,a,o,l){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,i,r,n,s,a,o,l)}}class SSe extends c_{constructor(e,i){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,i)}}class _Se extends h_{constructor(e,i){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,i)}}class ASe extends u_{constructor(e,i){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,i)}}class ESe extends F1{constructor(e,i,r,n){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,i,r,n)}}class MSe extends k1{constructor(e,i){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,i)}}class TSe extends O1{constructor(e,i,r,n){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,i,r,n)}}class CSe extends Md{constructor(e,i,r,n){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,i,r,n)}}class PSe extends d_{constructor(e,i,r,n,s,a){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,i,r,n,s,a)}}class DSe extends f_{constructor(e,i){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,i)}}class RSe extends N1{constructor(e,i,r,n,s,a,o){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,i,r,n,s,a,o)}}class ISe extends p_{constructor(e,i){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,i)}}class LSe extends m_{constructor(e,i,r,n,s){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,i,r,n,s)}}class OSe extends g_{constructor(e,i,r,n,s,a){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,i,r,n,s,a)}}class BSe extends v_{constructor(e,i,r,n,s){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,i,r,n,s)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ZS}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ZS);const FSe=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:p4,AddEquation:Pm,AddOperation:Nte,AdditiveAnimationBlendMode:g4,AdditiveBlending:AF,AlphaFormat:qte,AlwaysDepth:Rte,AlwaysStencilFunc:uie,AmbientLight:Jie,AmbientLightProbe:wwe,AnimationClip:Zy,AnimationLoader:hwe,AnimationMixer:zwe,AnimationObjectGroup:kwe,AnimationUtils:awe,ArcCurve:Pie,ArrayCamera:Sie,ArrowHelper:aSe,Audio:nre,AudioAnalyser:Twe,AudioContext:Q4,AudioListener:Awe,AudioLoader:xwe,AxesHelper:oSe,BackSide:Go,BasicDepthPacking:lie,BasicShadowMap:vte,Bone:cD,BooleanKeyframeTrack:e0,Box2:Xwe,Box3:Ad,Box3Helper:nSe,BoxBufferGeometry:vSe,BoxGeometry:Pp,BoxHelper:rSe,BufferAttribute:Xi,BufferGeometry:xi,BufferGeometryLoader:ire,ByteType:Hte,Cache:Ng,Camera:i_,CameraHelper:iSe,CanvasTexture:Dbe,CapsuleBufferGeometry:ySe,CapsuleGeometry:a_,CatmullRomCurve3:Die,CineonToneMapping:Gte,CircleBufferGeometry:xSe,CircleGeometry:o_,ClampToEdgeWrapping:js,Clock:$4,Color:Ct,ColorKeyframeTrack:j4,ColorManagement:ml,CompressedArrayTexture:Pbe,CompressedTexture:O4,CompressedTextureLoader:uwe,ConeBufferGeometry:bSe,ConeGeometry:l_,CubeCamera:_4,CubeReflectionMapping:hp,CubeRefractionMapping:up,CubeTexture:r_,CubeTextureLoader:dwe,CubeUVReflectionMapping:I1,CubicBezierCurve:F4,CubicBezierCurve3:Rie,CubicInterpolant:qie,CullFaceBack:_F,CullFaceFront:gte,CullFaceFrontBack:kge,CullFaceNone:mte,Curve:Nc,CurvePath:Lie,CustomBlending:yte,CustomToneMapping:Vte,CylinderBufferGeometry:wSe,CylinderGeometry:Zg,Cylindrical:Wwe,Data3DTexture:nD,DataArrayTexture:t_,DataTexture:_y,DataTexture2DArray:mSe,DataTexture3D:gSe,DataTextureLoader:fwe,DataUtils:dSe,DecrementStencilOp:Xge,DecrementWrapStencilOp:qge,DefaultLoadingManager:Zv,DepthFormat:Jf,DepthStencilFormat:Ig,DepthTexture:_ie,DirectionalLight:K4,DirectionalLightHelper:tSe,DiscreteInterpolant:Kie,DodecahedronBufferGeometry:SSe,DodecahedronGeometry:c_,DoubleSide:_c,DstAlphaFactor:Ete,DstColorFactor:Tte,DynamicCopyUsage:c0e,DynamicDrawUsage:r0e,DynamicReadUsage:a0e,EdgesGeometry:Oie,EllipseCurve:uD,EqualDepth:Lte,EqualStencilFunc:Jge,EquirectangularReflectionMapping:Kw,EquirectangularRefractionMapping:Qw,Euler:Cl,EventDispatcher:Yh,ExtrudeBufferGeometry:_Se,ExtrudeGeometry:h_,FileLoader:Xo,Float16BufferAttribute:H0e,Float32BufferAttribute:zt,Float64BufferAttribute:j0e,FloatType:Wu,Fog:lD,FogExp2:oD,FramebufferTexture:Cbe,FrontSide:cp,Frustum:sD,GLBufferAttribute:jwe,GLSL1:u0e,GLSL3:QF,GreaterDepth:Bte,GreaterEqualDepth:Ote,GreaterEqualStencilFunc:i0e,GreaterStencilFunc:e0e,GridHelper:Zwe,Group:Yu,HalfFloatType:Qy,HemisphereLight:$ie,HemisphereLightHelper:Jwe,HemisphereLightProbe:bwe,IcosahedronBufferGeometry:ASe,IcosahedronGeometry:u_,ImageBitmapLoader:rre,ImageLoader:oS,ImageUtils:b4,ImmediateRenderObject:fSe,IncrementStencilOp:Wge,IncrementWrapStencilOp:Yge,InstancedBufferAttribute:Og,InstancedBufferGeometry:tre,InstancedInterleavedBuffer:Hwe,InstancedMesh:R4,Int16BufferAttribute:G0e,Int32BufferAttribute:V0e,Int8BufferAttribute:N0e,IntType:Wte,InterleavedBuffer:n_,InterleavedBufferAttribute:pp,Interpolant:U1,InterpolateDiscrete:$y,InterpolateLinear:Lg,InterpolateSmooth:KT,InvertStencilOp:Kge,KeepStencilOp:QT,KeyframeTrack:Uc,LOD:Tie,LatheBufferGeometry:ESe,LatheGeometry:F1,Layers:ug,LessDepth:Ite,LessEqualDepth:i2,LessEqualStencilFunc:Zge,LessStencilFunc:$ge,Light:Dp,LightProbe:pD,Line:dd,Line3:Ywe,LineBasicMaterial:wa,LineCurve:dD,LineCurve3:Iie,LineDashedMaterial:Xie,LineLoop:I4,LineSegments:kc,LinearEncoding:fp,LinearFilter:Hr,LinearInterpolant:H4,LinearMipMapLinearFilter:Gge,LinearMipMapNearestFilter:zge,LinearMipmapLinearFilter:_d,LinearMipmapNearestFilter:iD,LinearSRGBColorSpace:Df,LinearToneMapping:Ute,Loader:Ya,LoaderUtils:Zf,LoadingManager:W4,LoopOnce:nie,LoopPingPong:aie,LoopRepeat:sie,LuminanceAlphaFormat:$te,LuminanceFormat:Qte,MOUSE:xm,Material:kn,MaterialLoader:mD,MathUtils:x4,Matrix3:co,Matrix4:ui,MaxEquation:CF,Mesh:Ms,MeshBasicMaterial:ko,MeshDepthMaterial:M4,MeshDistanceMaterial:T4,MeshLambertMaterial:jie,MeshMatcapMaterial:Wie,MeshNormalMaterial:Hie,MeshPhongMaterial:Gie,MeshPhysicalMaterial:ql,MeshStandardMaterial:y_,MeshToonMaterial:Vie,MinEquation:TF,MirroredRepeatWrapping:Ky,MixOperation:kte,MultiplyBlending:MF,MultiplyOperation:e_,NearestFilter:xn,NearestMipMapLinearFilter:Uge,NearestMipMapNearestFilter:Nge,NearestMipmapLinearFilter:Jw,NearestMipmapNearestFilter:$w,NeverDepth:Dte,NeverStencilFunc:Qge,NoBlending:td,NoColorSpace:Vge,NoToneMapping:Pc,NormalAnimationBlendMode:rD,NormalBlending:og,NotEqualDepth:Fte,NotEqualStencilFunc:t0e,NumberKeyframeTrack:Fg,Object3D:zi,ObjectLoader:vwe,ObjectSpaceNormalMap:hie,OctahedronBufferGeometry:MSe,OctahedronGeometry:k1,OneFactor:Ste,OneMinusDstAlphaFactor:Mte,OneMinusDstColorFactor:Cte,OneMinusSrcAlphaFactor:f4,OneMinusSrcColorFactor:Ate,OrthographicCamera:Dc,PCFShadowMap:eD,PCFSoftShadowMap:rw,PMREMGenerator:JF,Path:rS,PerspectiveCamera:Or,Plane:Ou,PlaneBufferGeometry:TSe,PlaneGeometry:O1,PlaneHelper:sSe,PointLight:q4,PointLightHelper:Qwe,Points:L4,PointsMaterial:hD,PolarGridHelper:eSe,PolyhedronBufferGeometry:CSe,PolyhedronGeometry:Md,PositionalAudio:Mwe,PropertyBinding:Ui,PropertyMixer:sre,QuadraticBezierCurve:k4,QuadraticBezierCurve3:N4,Quaternion:Ds,QuaternionKeyframeTrack:mp,QuaternionLinearInterpolant:Qie,REVISION:ZS,RGBADepthPacking:cie,RGBAFormat:so,RGBAIntegerFormat:iie,RGBA_ASTC_10x10_Format:XF,RGBA_ASTC_10x5_Format:HF,RGBA_ASTC_10x6_Format:jF,RGBA_ASTC_10x8_Format:WF,RGBA_ASTC_12x10_Format:YF,RGBA_ASTC_12x12_Format:qF,RGBA_ASTC_4x4_Format:BF,RGBA_ASTC_5x4_Format:FF,RGBA_ASTC_5x5_Format:kF,RGBA_ASTC_6x5_Format:NF,RGBA_ASTC_6x6_Format:UF,RGBA_ASTC_8x5_Format:zF,RGBA_ASTC_8x6_Format:GF,RGBA_ASTC_8x8_Format:VF,RGBA_BPTC_Format:KF,RGBA_ETC2_EAC_Format:OF,RGBA_PVRTC_2BPPV1_Format:IF,RGBA_PVRTC_4BPPV1_Format:RF,RGBA_S3TC_DXT1_Format:XT,RGBA_S3TC_DXT3_Format:YT,RGBA_S3TC_DXT5_Format:qT,RGBFormat:Kte,RGB_ETC1_Format:rie,RGB_ETC2_Format:LF,RGB_PVRTC_2BPPV1_Format:DF,RGB_PVRTC_4BPPV1_Format:PF,RGB_S3TC_DXT1_Format:WT,RGFormat:eie,RGIntegerFormat:tie,RawShaderMaterial:zie,Ray:L1,Raycaster:are,RectAreaLight:Zie,RedFormat:Jte,RedIntegerFormat:Zte,ReinhardToneMapping:zte,RepeatWrapping:dp,ReplaceStencilOp:jge,ReverseSubtractEquation:bte,RingBufferGeometry:PSe,RingGeometry:d_,SRGBColorSpace:uh,Scene:a2,ShaderChunk:Si,ShaderLib:bc,ShaderMaterial:zh,ShadowMaterial:Uie,Shape:dg,ShapeBufferGeometry:DSe,ShapeGeometry:f_,ShapePath:lSe,ShapeUtils:Rh,ShortType:jte,Skeleton:s_,SkeletonHelper:Kwe,SkinnedMesh:D4,Source:Hm,Sphere:Ed,SphereBufferGeometry:RSe,SphereGeometry:N1,Spherical:sk,SphericalHarmonics3:ere,SplineCurve:U4,SpotLight:Y4,SpotLightHelper:qwe,Sprite:Mie,SpriteMaterial:P4,SrcAlphaFactor:d4,SrcAlphaSaturateFactor:Pte,SrcColorFactor:_te,StaticCopyUsage:l0e,StaticDrawUsage:eS,StaticReadUsage:s0e,StereoCamera:Swe,StreamCopyUsage:h0e,StreamDrawUsage:n0e,StreamReadUsage:o0e,StringKeyframeTrack:t0,SubtractEquation:xte,SubtractiveBlending:EF,TOUCH:bm,TangentSpaceNormalMap:Cp,TetrahedronBufferGeometry:ISe,TetrahedronGeometry:p_,Texture:kr,TextureLoader:x_,TorusBufferGeometry:LSe,TorusGeometry:m_,TorusKnotBufferGeometry:OSe,TorusKnotGeometry:g_,Triangle:Il,TriangleFanDrawMode:r2,TriangleStripDrawMode:v4,TrianglesDrawMode:oie,TubeBufferGeometry:BSe,TubeGeometry:v_,UVMapping:tD,Uint16BufferAttribute:w4,Uint32BufferAttribute:S4,Uint8BufferAttribute:U0e,Uint8ClampedBufferAttribute:z0e,Uniform:e5,UniformsGroup:Vwe,UniformsLib:St,UniformsUtils:mie,UnsignedByteType:ud,UnsignedInt248Type:lg,UnsignedIntType:Pf,UnsignedShort4444Type:Xte,UnsignedShort5551Type:Yte,UnsignedShortType:m4,VSMShadowMap:zm,Vector2:tt,Vector3:le,Vector4:rr,VectorKeyframeTrack:kg,VideoTexture:Cie,WebGL1Renderer:Aie,WebGL3DRenderTarget:C0e,WebGLArrayRenderTarget:T0e,WebGLCubeRenderTarget:A4,WebGLMultipleRenderTargets:P0e,WebGLMultisampleRenderTarget:pSe,WebGLRenderTarget:Hl,WebGLRenderer:C4,WebGLUtils:wie,WireframeGeometry:Nie,WrapAroundEnding:Zw,ZeroCurvatureEnding:Gm,ZeroFactor:wte,ZeroSlopeEnding:Vm,ZeroStencilOp:Hge,_SRGBAFormat:n2,sRGBEncoding:zr},Symbol.toStringTag,{value:"Module"}));var lre={exports:{}},i0={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */i0.ConcurrentRoot=1;i0.ContinuousEventPriority=4;i0.DefaultEventPriority=16;i0.DiscreteEventPriority=1;i0.IdleEventPriority=536870912;i0.LegacyRoot=0;lre.exports=i0;var ey=lre.exports;function kSe(t){let e;const i=new Set,r=(c,h)=>{const u=typeof c=="function"?c(e):c;if(u!==e){const d=e;e=h?u:Object.assign({},e,u),i.forEach(f=>f(e,d))}},n=()=>e,s=(c,h=n,u=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=h(e);function f(){const p=h(e);if(!u(d,p)){const m=d;c(d=p,m)}}return i.add(f),()=>i.delete(f)},l={setState:r,getState:n,subscribe:(c,h,u)=>h||u?s(c,h,u):(i.add(c),()=>i.delete(c)),destroy:()=>i.clear()};return e=t(r,n,l),l}const NSe=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),mW=NSe?we.useEffect:we.useLayoutEffect;function USe(t){const e=typeof t=="function"?kSe(t):t,i=(r=e.getState,n=Object.is)=>{const[,s]=we.useReducer(g=>g+1,0),a=e.getState(),o=we.useRef(a),l=we.useRef(r),c=we.useRef(n),h=we.useRef(!1),u=we.useRef();u.current===void 0&&(u.current=r(a));let d,f=!1;(o.current!==a||l.current!==r||c.current!==n||h.current)&&(d=r(a),f=!n(u.current,d)),mW(()=>{f&&(u.current=d),o.current=a,l.current=r,c.current=n,h.current=!1});const p=we.useRef(a);mW(()=>{const g=()=>{try{const y=e.getState(),x=l.current(y);c.current(u.current,x)||(o.current=y,u.current=x,s())}catch{h.current=!0,s()}},v=e.subscribe(g);return e.getState()!==p.current&&g(),v},[]);const m=f?d:u.current;return we.useDebugValue(m),m};return Object.assign(i,e),i[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[i,e];return{next(){const n=r.length<=0;return{value:r.shift(),done:n}}}},i}const zSe=t=>typeof t=="object"&&typeof t.then=="function",Wm=[];function cre(t,e,i=(r,n)=>r===n){if(t===e)return!0;if(!t||!e)return!1;const r=t.length;if(e.length!==r)return!1;for(let n=0;n<r;n++)if(!i(t[n],e[n]))return!1;return!0}function hre(t,e=null,i=!1,r={}){e===null&&(e=[t]);for(const s of Wm)if(cre(e,s.keys,s.equal)){if(i)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!i)throw s.promise}const n={keys:e,equal:r.equal,remove:()=>{const s=Wm.indexOf(n);s!==-1&&Wm.splice(s,1)},promise:(zSe(t)?t:t(...e)).then(s=>{n.response=s,r.lifespan&&r.lifespan>0&&(n.timeout=setTimeout(n.remove,r.lifespan))}).catch(s=>n.error=s)};if(Wm.push(n),!i)throw n.promise}const ure=(t,e,i)=>hre(t,e,!1,i),GSe=(t,e,i)=>void hre(t,e,!0,i),VSe=t=>{if(t===void 0||t.length===0)Wm.splice(0,Wm.length);else{const e=Wm.find(i=>cre(t,i.keys,i.equal));e&&e.remove()}};var dre={exports:{}},yL={exports:{}},xL={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gW;function HSe(){return gW||(gW=1,function(t){function e(I,z){var U=I.length;I.push(z);e:for(;0<U;){var X=U-1>>>1,Q=I[X];if(0<n(Q,z))I[X]=z,I[U]=Q,U=X;else break e}}function i(I){return I.length===0?null:I[0]}function r(I){if(I.length===0)return null;var z=I[0],U=I.pop();if(U!==z){I[0]=U;e:for(var X=0,Q=I.length,re=Q>>>1;X<re;){var ie=2*(X+1)-1,ce=I[ie],Z=ie+1,Ae=I[Z];if(0>n(ce,U))Z<Q&&0>n(Ae,ce)?(I[X]=Ae,I[Z]=U,X=Z):(I[X]=ce,I[ie]=U,X=ie);else if(Z<Q&&0>n(Ae,U))I[X]=Ae,I[Z]=U,X=Z;else break e}}return z}function n(I,z){var U=I.sortIndex-z.sortIndex;return U!==0?U:I.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var l=[],c=[],h=1,u=null,d=3,f=!1,p=!1,m=!1,g=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(I){for(var z=i(c);z!==null;){if(z.callback===null)r(c);else if(z.startTime<=I)r(c),z.sortIndex=z.expirationTime,e(l,z);else break;z=i(c)}}function S(I){if(m=!1,x(I),!p)if(i(l)!==null)p=!0,q(A);else{var z=i(c);z!==null&&W(S,z.startTime-I)}}function A(I,z){p=!1,m&&(m=!1,v(E),E=-1),f=!0;var U=d;try{for(x(z),u=i(l);u!==null&&(!(u.expirationTime>z)||I&&!D());){var X=u.callback;if(typeof X=="function"){u.callback=null,d=u.priorityLevel;var Q=X(u.expirationTime<=z);z=t.unstable_now(),typeof Q=="function"?u.callback=Q:u===i(l)&&r(l),x(z)}else r(l);u=i(l)}if(u!==null)var re=!0;else{var ie=i(c);ie!==null&&W(S,ie.startTime-z),re=!1}return re}finally{u=null,d=U,f=!1}}var _=!1,M=null,E=-1,T=5,C=-1;function D(){return!(t.unstable_now()-C<T)}function B(){if(M!==null){var I=t.unstable_now();C=I;var z=!0;try{z=M(!0,I)}finally{z?O():(_=!1,M=null)}}else _=!1}var O;if(typeof y=="function")O=function(){y(B)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,H=L.port2;L.port1.onmessage=B,O=function(){H.postMessage(null)}}else O=function(){g(B,0)};function q(I){M=I,_||(_=!0,O())}function W(I,z){E=g(function(){I(t.unstable_now())},z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(I){I.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,q(A))},t.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<I?Math.floor(1e3/I):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(I){switch(d){case 1:case 2:case 3:var z=3;break;default:z=d}var U=d;d=z;try{return I()}finally{d=U}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(I,z){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var U=d;d=I;try{return z()}finally{d=U}},t.unstable_scheduleCallback=function(I,z,U){var X=t.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?X+U:X):U=X,I){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=U+Q,I={id:h++,callback:z,priorityLevel:I,startTime:U,expirationTime:Q,sortIndex:-1},U>X?(I.sortIndex=U,e(c,I),i(l)===null&&I===i(c)&&(m?(v(E),E=-1):m=!0,W(S,U-X))):(I.sortIndex=Q,e(l,I),p||f||(p=!0,q(A))),I},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(I){var z=d;return function(){var U=d;d=z;try{return I.apply(this,arguments)}finally{d=U}}}}(xL)),xL}var vW;function jSe(){return vW||(vW=1,yL.exports=HSe()),yL.exports}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WSe=function(e){var i={},r=we,n=jSe(),s=Object.assign;function a(b){for(var w="https://reactjs.org/docs/error-decoder.html?invariant="+b,P=1;P<arguments.length;P++)w+="&args[]="+encodeURIComponent(arguments[P]);return"Minified React error #"+b+"; visit "+w+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),h=Symbol.for("react.fragment"),u=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),p=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),v=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),S=Symbol.for("react.offscreen"),A=Symbol.iterator;function _(b){return b===null||typeof b!="object"?null:(b=A&&b[A]||b["@@iterator"],typeof b=="function"?b:null)}function M(b){if(b==null)return null;if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b;switch(b){case h:return"Fragment";case c:return"Portal";case d:return"Profiler";case u:return"StrictMode";case g:return"Suspense";case v:return"SuspenseList"}if(typeof b=="object")switch(b.$$typeof){case p:return(b.displayName||"Context")+".Consumer";case f:return(b._context.displayName||"Context")+".Provider";case m:var w=b.render;return b=b.displayName,b||(b=w.displayName||w.name||"",b=b!==""?"ForwardRef("+b+")":"ForwardRef"),b;case y:return w=b.displayName||null,w!==null?w:M(b.type)||"Memo";case x:w=b._payload,b=b._init;try{return M(b(w))}catch{}}return null}function E(b){var w=b.type;switch(b.tag){case 24:return"Cache";case 9:return(w.displayName||"Context")+".Consumer";case 10:return(w._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return b=w.render,b=b.displayName||b.name||"",w.displayName||(b!==""?"ForwardRef("+b+")":"ForwardRef");case 7:return"Fragment";case 5:return w;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return M(w);case 8:return w===u?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof w=="function")return w.displayName||w.name||null;if(typeof w=="string")return w}return null}function T(b){var w=b,P=b;if(b.alternate)for(;w.return;)w=w.return;else{b=w;do w=b,w.flags&4098&&(P=w.return),b=w.return;while(b)}return w.tag===3?P:null}function C(b){if(T(b)!==b)throw Error(a(188))}function D(b){var w=b.alternate;if(!w){if(w=T(b),w===null)throw Error(a(188));return w!==b?null:b}for(var P=b,R=w;;){var k=P.return;if(k===null)break;var j=k.alternate;if(j===null){if(R=k.return,R!==null){P=R;continue}break}if(k.child===j.child){for(j=k.child;j;){if(j===P)return C(k),b;if(j===R)return C(k),w;j=j.sibling}throw Error(a(188))}if(P.return!==R.return)P=k,R=j;else{for(var ue=!1,Pe=k.child;Pe;){if(Pe===P){ue=!0,P=k,R=j;break}if(Pe===R){ue=!0,R=k,P=j;break}Pe=Pe.sibling}if(!ue){for(Pe=j.child;Pe;){if(Pe===P){ue=!0,P=j,R=k;break}if(Pe===R){ue=!0,R=j,P=k;break}Pe=Pe.sibling}if(!ue)throw Error(a(189))}}if(P.alternate!==R)throw Error(a(190))}if(P.tag!==3)throw Error(a(188));return P.stateNode.current===P?b:w}function B(b){return b=D(b),b!==null?O(b):null}function O(b){if(b.tag===5||b.tag===6)return b;for(b=b.child;b!==null;){var w=O(b);if(w!==null)return w;b=b.sibling}return null}function L(b){if(b.tag===5||b.tag===6)return b;for(b=b.child;b!==null;){if(b.tag!==4){var w=L(b);if(w!==null)return w}b=b.sibling}return null}var H=Array.isArray,q=e.getPublicInstance,W=e.getRootHostContext,I=e.getChildHostContext,z=e.prepareForCommit,U=e.resetAfterCommit,X=e.createInstance,Q=e.appendInitialChild,re=e.finalizeInitialChildren,ie=e.prepareUpdate,ce=e.shouldSetTextContent,Z=e.createTextInstance,Ae=e.scheduleTimeout,Se=e.cancelTimeout,_e=e.noTimeout,ve=e.isPrimaryRenderer,Ee=e.supportsMutation,fe=e.supportsPersistence,pe=e.supportsHydration,Ie=e.getInstanceFromNode,Le=e.preparePortalMount,Ge=e.getCurrentEventPriority,Ke=e.detachDeletedInstance,Ve=e.supportsMicrotasks,ke=e.scheduleMicrotask,ut=e.supportsTestSelectors,dt=e.findFiberRoot,V=e.getBoundingRect,F=e.getTextContent,oe=e.isHiddenSubtree,Ce=e.matchAccessibilityRole,K=e.setFocusIfFocusable,Re=e.setupIntersectionObserver,Ze=e.appendChild,Ne=e.appendChildToContainer,me=e.commitTextUpdate,$e=e.commitMount,Qe=e.commitUpdate,Je=e.insertBefore,ot=e.insertInContainerBefore,nt=e.removeChild,de=e.removeChildFromContainer,Xe=e.resetTextContent,mt=e.hideInstance,J=e.hideTextInstance,he=e.unhideInstance,Me=e.unhideTextInstance,Ue=e.clearContainer,at=e.cloneInstance,Mt=e.createContainerChildSet,Qt=e.appendChildToContainerChildSet,ci=e.finalizeContainerChildren,ur=e.replaceContainerChildren,Gt=e.cloneHiddenInstance,Qi=e.cloneHiddenTextInstance,Bi=e.canHydrateInstance,Kl=e.canHydrateTextInstance,Np=e.canHydrateSuspenseInstance,Dd=e.isSuspenseInstancePending,Ql=e.isSuspenseInstanceFallback,G=e.registerSuspenseInstanceRetry,ae=e.getNextHydratableSibling,ge=e.getFirstHydratableChild,se=e.getFirstHydratableChildWithinContainer,xe=e.getFirstHydratableChildWithinSuspenseInstance,rt=e.hydrateInstance,ft=e.hydrateTextInstance,gt=e.hydrateSuspenseInstance,ht=e.getNextHydratableInstanceAfterSuspenseInstance,Lt=e.commitHydratedContainer,wt=e.commitHydratedSuspenseInstance,_t=e.clearSuspenseBoundary,It=e.clearSuspenseBoundaryFromContainer,Zi=e.shouldDeleteUnhydratedTailInstances,cn=e.didNotMatchHydratedContainerTextInstance,ls=e.didNotMatchHydratedTextInstance,Ai;function At(b){if(Ai===void 0)try{throw Error()}catch(P){var w=P.stack.trim().match(/\n( *(at )?)/);Ai=w&&w[1]||""}return`
`+Ai+b}var $r=!1;function Ft(b,w){if(!b||$r)return"";$r=!0;var P=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(w)if(w=function(){throw Error()},Object.defineProperty(w.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(w,[])}catch(vt){var R=vt}Reflect.construct(b,[],w)}else{try{w.call()}catch(vt){R=vt}b.call(w.prototype)}else{try{throw Error()}catch(vt){R=vt}b()}}catch(vt){if(vt&&R&&typeof vt.stack=="string"){for(var k=vt.stack.split(`
`),j=R.stack.split(`
`),ue=k.length-1,Pe=j.length-1;1<=ue&&0<=Pe&&k[ue]!==j[Pe];)Pe--;for(;1<=ue&&0<=Pe;ue--,Pe--)if(k[ue]!==j[Pe]){if(ue!==1||Pe!==1)do if(ue--,Pe--,0>Pe||k[ue]!==j[Pe]){var qe=`
`+k[ue].replace(" at new "," at ");return b.displayName&&qe.includes("<anonymous>")&&(qe=qe.replace("<anonymous>",b.displayName)),qe}while(1<=ue&&0<=Pe);break}}}finally{$r=!1,Error.prepareStackTrace=P}return(b=b?b.displayName||b.name:"")?At(b):""}var Dr=Object.prototype.hasOwnProperty,En=[],hn=-1;function Nr(b){return{current:b}}function $(b){0>hn||(b.current=En[hn],En[hn]=null,hn--)}function te(b,w){hn++,En[hn]=b.current,b.current=w}var be={},ne=Nr(be),Te=Nr(!1),lt=be;function Vn(b,w){var P=b.type.contextTypes;if(!P)return be;var R=b.stateNode;if(R&&R.__reactInternalMemoizedUnmaskedChildContext===w)return R.__reactInternalMemoizedMaskedChildContext;var k={},j;for(j in P)k[j]=w[j];return R&&(b=b.stateNode,b.__reactInternalMemoizedUnmaskedChildContext=w,b.__reactInternalMemoizedMaskedChildContext=k),k}function cs(b){return b=b.childContextTypes,b!=null}function $h(){$(Te),$(ne)}function u0(b,w,P){if(ne.current!==be)throw Error(a(168));te(ne,w),te(Te,P)}function Up(b,w,P){var R=b.stateNode;if(w=w.childContextTypes,typeof R.getChildContext!="function")return P;R=R.getChildContext();for(var k in R)if(!(k in w))throw Error(a(108,E(b)||"Unknown",k));return s({},P,R)}function Rd(b){return b=(b=b.stateNode)&&b.__reactInternalMemoizedMergedChildContext||be,lt=ne.current,te(ne,b),te(Te,Te.current),!0}function t6(b,w,P){var R=b.stateNode;if(!R)throw Error(a(169));P?(b=Up(b,w,lt),R.__reactInternalMemoizedMergedChildContext=b,$(Te),$(ne),te(ne,b)):$(Te),te(Te,P)}var $l=Math.clz32?Math.clz32:Gde,Ude=Math.log,zde=Math.LN2;function Gde(b){return b>>>=0,b===0?32:31-(Ude(b)/zde|0)|0}var W_=64,X_=4194304;function ox(b){switch(b&-b){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return b&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return b}}function Y_(b,w){var P=b.pendingLanes;if(P===0)return 0;var R=0,k=b.suspendedLanes,j=b.pingedLanes,ue=P&268435455;if(ue!==0){var Pe=ue&~k;Pe!==0?R=ox(Pe):(j&=ue,j!==0&&(R=ox(j)))}else ue=P&~k,ue!==0?R=ox(ue):j!==0&&(R=ox(j));if(R===0)return 0;if(w!==0&&w!==R&&!(w&k)&&(k=R&-R,j=w&-w,k>=j||k===16&&(j&4194240)!==0))return w;if(R&4&&(R|=P&16),w=b.entangledLanes,w!==0)for(b=b.entanglements,w&=R;0<w;)P=31-$l(w),k=1<<P,R|=b[P],w&=~k;return R}function Vde(b,w){switch(b){case 1:case 2:case 4:return w+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return w+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Hde(b,w){for(var P=b.suspendedLanes,R=b.pingedLanes,k=b.expirationTimes,j=b.pendingLanes;0<j;){var ue=31-$l(j),Pe=1<<ue,qe=k[ue];qe===-1?(!(Pe&P)||Pe&R)&&(k[ue]=Vde(Pe,w)):qe<=w&&(b.expiredLanes|=Pe),j&=~Pe}}function sR(b){return b=b.pendingLanes&-1073741825,b!==0?b:b&1073741824?1073741824:0}function aR(b){for(var w=[],P=0;31>P;P++)w.push(b);return w}function lx(b,w,P){b.pendingLanes|=w,w!==536870912&&(b.suspendedLanes=0,b.pingedLanes=0),b=b.eventTimes,w=31-$l(w),b[w]=P}function jde(b,w){var P=b.pendingLanes&~w;b.pendingLanes=w,b.suspendedLanes=0,b.pingedLanes=0,b.expiredLanes&=w,b.mutableReadLanes&=w,b.entangledLanes&=w,w=b.entanglements;var R=b.eventTimes;for(b=b.expirationTimes;0<P;){var k=31-$l(P),j=1<<k;w[k]=0,R[k]=-1,b[k]=-1,P&=~j}}function oR(b,w){var P=b.entangledLanes|=w;for(b=b.entanglements;P;){var R=31-$l(P),k=1<<R;k&w|b[R]&w&&(b[R]|=w),P&=~k}}var Vi=0;function i6(b){return b&=-b,1<b?4<b?b&268435455?16:536870912:4:1}var lR=n.unstable_scheduleCallback,r6=n.unstable_cancelCallback,Wde=n.unstable_shouldYield,Xde=n.unstable_requestPaint,hs=n.unstable_now,cR=n.unstable_ImmediatePriority,Yde=n.unstable_UserBlockingPriority,hR=n.unstable_NormalPriority,qde=n.unstable_IdlePriority,q_=null,Vc=null;function Kde(b){if(Vc&&typeof Vc.onCommitFiberRoot=="function")try{Vc.onCommitFiberRoot(q_,b,void 0,(b.current.flags&128)===128)}catch{}}function Qde(b,w){return b===w&&(b!==0||1/b===1/w)||b!==b&&w!==w}var Hc=typeof Object.is=="function"?Object.is:Qde,Jh=null,K_=!1,uR=!1;function n6(b){Jh===null?Jh=[b]:Jh.push(b)}function $de(b){K_=!0,n6(b)}function jc(){if(!uR&&Jh!==null){uR=!0;var b=0,w=Vi;try{var P=Jh;for(Vi=1;b<P.length;b++){var R=P[b];do R=R(!0);while(R!==null)}Jh=null,K_=!1}catch(k){throw Jh!==null&&(Jh=Jh.slice(b+1)),lR(cR,jc),k}finally{Vi=w,uR=!1}}return null}var Jde=o.ReactCurrentBatchConfig;function Q_(b,w){if(Hc(b,w))return!0;if(typeof b!="object"||b===null||typeof w!="object"||w===null)return!1;var P=Object.keys(b),R=Object.keys(w);if(P.length!==R.length)return!1;for(R=0;R<P.length;R++){var k=P[R];if(!Dr.call(w,k)||!Hc(b[k],w[k]))return!1}return!0}function Zde(b){switch(b.tag){case 5:return At(b.type);case 16:return At("Lazy");case 13:return At("Suspense");case 19:return At("SuspenseList");case 0:case 2:case 15:return b=Ft(b.type,!1),b;case 11:return b=Ft(b.type.render,!1),b;case 1:return b=Ft(b.type,!0),b;default:return""}}function Jl(b,w){if(b&&b.defaultProps){w=s({},w),b=b.defaultProps;for(var P in b)w[P]===void 0&&(w[P]=b[P]);return w}return w}var $_=Nr(null),J_=null,d0=null,dR=null;function fR(){dR=d0=J_=null}function s6(b,w,P){ve?(te($_,w._currentValue),w._currentValue=P):(te($_,w._currentValue2),w._currentValue2=P)}function pR(b){var w=$_.current;$($_),ve?b._currentValue=w:b._currentValue2=w}function mR(b,w,P){for(;b!==null;){var R=b.alternate;if((b.childLanes&w)!==w?(b.childLanes|=w,R!==null&&(R.childLanes|=w)):R!==null&&(R.childLanes&w)!==w&&(R.childLanes|=w),b===P)break;b=b.return}}function f0(b,w){J_=b,dR=d0=null,b=b.dependencies,b!==null&&b.firstContext!==null&&(b.lanes&w&&(Mo=!0),b.firstContext=null)}function Jo(b){var w=ve?b._currentValue:b._currentValue2;if(dR!==b)if(b={context:b,memoizedValue:w,next:null},d0===null){if(J_===null)throw Error(a(308));d0=b,J_.dependencies={lanes:0,firstContext:b}}else d0=d0.next=b;return w}var Wc=null,Id=!1;function gR(b){b.updateQueue={baseState:b.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function a6(b,w){b=b.updateQueue,w.updateQueue===b&&(w.updateQueue={baseState:b.baseState,firstBaseUpdate:b.firstBaseUpdate,lastBaseUpdate:b.lastBaseUpdate,shared:b.shared,effects:b.effects})}function Zh(b,w){return{eventTime:b,lane:w,tag:0,payload:null,callback:null,next:null}}function Ld(b,w){var P=b.updateQueue;P!==null&&(P=P.shared,Mn!==null&&b.mode&1&&!(_i&2)?(b=P.interleaved,b===null?(w.next=w,Wc===null?Wc=[P]:Wc.push(P)):(w.next=b.next,b.next=w),P.interleaved=w):(b=P.pending,b===null?w.next=w:(w.next=b.next,b.next=w),P.pending=w))}function Z_(b,w,P){if(w=w.updateQueue,w!==null&&(w=w.shared,(P&4194240)!==0)){var R=w.lanes;R&=b.pendingLanes,P|=R,w.lanes=P,oR(b,P)}}function o6(b,w){var P=b.updateQueue,R=b.alternate;if(R!==null&&(R=R.updateQueue,P===R)){var k=null,j=null;if(P=P.firstBaseUpdate,P!==null){do{var ue={eventTime:P.eventTime,lane:P.lane,tag:P.tag,payload:P.payload,callback:P.callback,next:null};j===null?k=j=ue:j=j.next=ue,P=P.next}while(P!==null);j===null?k=j=w:j=j.next=w}else k=j=w;P={baseState:R.baseState,firstBaseUpdate:k,lastBaseUpdate:j,shared:R.shared,effects:R.effects},b.updateQueue=P;return}b=P.lastBaseUpdate,b===null?P.firstBaseUpdate=w:b.next=w,P.lastBaseUpdate=w}function eA(b,w,P,R){var k=b.updateQueue;Id=!1;var j=k.firstBaseUpdate,ue=k.lastBaseUpdate,Pe=k.shared.pending;if(Pe!==null){k.shared.pending=null;var qe=Pe,vt=qe.next;qe.next=null,ue===null?j=vt:ue.next=vt,ue=qe;var kt=b.alternate;kt!==null&&(kt=kt.updateQueue,Pe=kt.lastBaseUpdate,Pe!==ue&&(Pe===null?kt.firstBaseUpdate=vt:Pe.next=vt,kt.lastBaseUpdate=qe))}if(j!==null){var gi=k.baseState;ue=0,kt=vt=qe=null,Pe=j;do{var Zt=Pe.lane,dr=Pe.eventTime;if((R&Zt)===Zt){kt!==null&&(kt=kt.next={eventTime:dr,lane:0,tag:Pe.tag,payload:Pe.payload,callback:Pe.callback,next:null});e:{var Ht=b,ia=Pe;switch(Zt=w,dr=P,ia.tag){case 1:if(Ht=ia.payload,typeof Ht=="function"){gi=Ht.call(dr,gi,Zt);break e}gi=Ht;break e;case 3:Ht.flags=Ht.flags&-65537|128;case 0:if(Ht=ia.payload,Zt=typeof Ht=="function"?Ht.call(dr,gi,Zt):Ht,Zt==null)break e;gi=s({},gi,Zt);break e;case 2:Id=!0}}Pe.callback!==null&&Pe.lane!==0&&(b.flags|=64,Zt=k.effects,Zt===null?k.effects=[Pe]:Zt.push(Pe))}else dr={eventTime:dr,lane:Zt,tag:Pe.tag,payload:Pe.payload,callback:Pe.callback,next:null},kt===null?(vt=kt=dr,qe=gi):kt=kt.next=dr,ue|=Zt;if(Pe=Pe.next,Pe===null){if(Pe=k.shared.pending,Pe===null)break;Zt=Pe,Pe=Zt.next,Zt.next=null,k.lastBaseUpdate=Zt,k.shared.pending=null}}while(!0);if(kt===null&&(qe=gi),k.baseState=qe,k.firstBaseUpdate=vt,k.lastBaseUpdate=kt,w=k.shared.interleaved,w!==null){k=w;do ue|=k.lane,k=k.next;while(k!==w)}else j===null&&(k.shared.lanes=0);S0|=ue,b.lanes=ue,b.memoizedState=gi}}function l6(b,w,P){if(b=w.effects,w.effects=null,b!==null)for(w=0;w<b.length;w++){var R=b[w],k=R.callback;if(k!==null){if(R.callback=null,R=P,typeof k!="function")throw Error(a(191,k));k.call(R)}}}var c6=new r.Component().refs;function vR(b,w,P,R){w=b.memoizedState,P=P(R,w),P=P==null?w:s({},w,P),b.memoizedState=P,b.lanes===0&&(b.updateQueue.baseState=P)}var tA={isMounted:function(b){return(b=b._reactInternals)?T(b)===b:!1},enqueueSetState:function(b,w,P){b=b._reactInternals;var R=Aa(),k=Fd(b),j=Zh(R,k);j.payload=w,P!=null&&(j.callback=P),Ld(b,j),w=rl(b,k,R),w!==null&&Z_(w,b,k)},enqueueReplaceState:function(b,w,P){b=b._reactInternals;var R=Aa(),k=Fd(b),j=Zh(R,k);j.tag=1,j.payload=w,P!=null&&(j.callback=P),Ld(b,j),w=rl(b,k,R),w!==null&&Z_(w,b,k)},enqueueForceUpdate:function(b,w){b=b._reactInternals;var P=Aa(),R=Fd(b),k=Zh(P,R);k.tag=2,w!=null&&(k.callback=w),Ld(b,k),w=rl(b,R,P),w!==null&&Z_(w,b,R)}};function h6(b,w,P,R,k,j,ue){return b=b.stateNode,typeof b.shouldComponentUpdate=="function"?b.shouldComponentUpdate(R,j,ue):w.prototype&&w.prototype.isPureReactComponent?!Q_(P,R)||!Q_(k,j):!0}function u6(b,w,P){var R=!1,k=be,j=w.contextType;return typeof j=="object"&&j!==null?j=Jo(j):(k=cs(w)?lt:ne.current,R=w.contextTypes,j=(R=R!=null)?Vn(b,k):be),w=new w(P,j),b.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=tA,b.stateNode=w,w._reactInternals=b,R&&(b=b.stateNode,b.__reactInternalMemoizedUnmaskedChildContext=k,b.__reactInternalMemoizedMaskedChildContext=j),w}function d6(b,w,P,R){b=w.state,typeof w.componentWillReceiveProps=="function"&&w.componentWillReceiveProps(P,R),typeof w.UNSAFE_componentWillReceiveProps=="function"&&w.UNSAFE_componentWillReceiveProps(P,R),w.state!==b&&tA.enqueueReplaceState(w,w.state,null)}function yR(b,w,P,R){var k=b.stateNode;k.props=P,k.state=b.memoizedState,k.refs=c6,gR(b);var j=w.contextType;typeof j=="object"&&j!==null?k.context=Jo(j):(j=cs(w)?lt:ne.current,k.context=Vn(b,j)),k.state=b.memoizedState,j=w.getDerivedStateFromProps,typeof j=="function"&&(vR(b,w,j,P),k.state=b.memoizedState),typeof w.getDerivedStateFromProps=="function"||typeof k.getSnapshotBeforeUpdate=="function"||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(w=k.state,typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount(),w!==k.state&&tA.enqueueReplaceState(k,k.state,null),eA(b,P,k,R),k.state=b.memoizedState),typeof k.componentDidMount=="function"&&(b.flags|=4194308)}var p0=[],m0=0,iA=null,rA=0,Zo=[],el=0,zp=null,eu=1,tu="";function Gp(b,w){p0[m0++]=rA,p0[m0++]=iA,iA=b,rA=w}function f6(b,w,P){Zo[el++]=eu,Zo[el++]=tu,Zo[el++]=zp,zp=b;var R=eu;b=tu;var k=32-$l(R)-1;R&=~(1<<k),P+=1;var j=32-$l(w)+k;if(30<j){var ue=k-k%5;j=(R&(1<<ue)-1).toString(32),R>>=ue,k-=ue,eu=1<<32-$l(w)+k|P<<k|R,tu=j+b}else eu=1<<j|P<<k|R,tu=b}function xR(b){b.return!==null&&(Gp(b,1),f6(b,1,0))}function bR(b){for(;b===iA;)iA=p0[--m0],p0[m0]=null,rA=p0[--m0],p0[m0]=null;for(;b===zp;)zp=Zo[--el],Zo[el]=null,tu=Zo[--el],Zo[el]=null,eu=Zo[--el],Zo[el]=null}var Ao=null,Eo=null,Rr=!1,cx=!1,Zl=null;function p6(b,w){var P=nl(5,null,null,0);P.elementType="DELETED",P.stateNode=w,P.return=b,w=b.deletions,w===null?(b.deletions=[P],b.flags|=16):w.push(P)}function m6(b,w){switch(b.tag){case 5:return w=Bi(w,b.type,b.pendingProps),w!==null?(b.stateNode=w,Ao=b,Eo=ge(w),!0):!1;case 6:return w=Kl(w,b.pendingProps),w!==null?(b.stateNode=w,Ao=b,Eo=null,!0):!1;case 13:if(w=Np(w),w!==null){var P=zp!==null?{id:eu,overflow:tu}:null;return b.memoizedState={dehydrated:w,treeContext:P,retryLane:1073741824},P=nl(18,null,null,0),P.stateNode=w,P.return=b,b.child=P,Ao=b,Eo=null,!0}return!1;default:return!1}}function wR(b){return(b.mode&1)!==0&&(b.flags&128)===0}function SR(b){if(Rr){var w=Eo;if(w){var P=w;if(!m6(b,w)){if(wR(b))throw Error(a(418));w=ae(P);var R=Ao;w&&m6(b,w)?p6(R,P):(b.flags=b.flags&-4097|2,Rr=!1,Ao=b)}}else{if(wR(b))throw Error(a(418));b.flags=b.flags&-4097|2,Rr=!1,Ao=b}}}function g6(b){for(b=b.return;b!==null&&b.tag!==5&&b.tag!==3&&b.tag!==13;)b=b.return;Ao=b}function hx(b){if(!pe||b!==Ao)return!1;if(!Rr)return g6(b),Rr=!0,!1;if(b.tag!==3&&(b.tag!==5||Zi(b.type)&&!ce(b.type,b.memoizedProps))){var w=Eo;if(w){if(wR(b)){for(b=Eo;b;)b=ae(b);throw Error(a(418))}for(;w;)p6(b,w),w=ae(w)}}if(g6(b),b.tag===13){if(!pe)throw Error(a(316));if(b=b.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(a(317));Eo=ht(b)}else Eo=Ao?ae(b.stateNode):null;return!0}function g0(){pe&&(Eo=Ao=null,cx=Rr=!1)}function _R(b){Zl===null?Zl=[b]:Zl.push(b)}function ux(b,w,P){if(b=P.ref,b!==null&&typeof b!="function"&&typeof b!="object"){if(P._owner){if(P=P._owner,P){if(P.tag!==1)throw Error(a(309));var R=P.stateNode}if(!R)throw Error(a(147,b));var k=R,j=""+b;return w!==null&&w.ref!==null&&typeof w.ref=="function"&&w.ref._stringRef===j?w.ref:(w=function(ue){var Pe=k.refs;Pe===c6&&(Pe=k.refs={}),ue===null?delete Pe[j]:Pe[j]=ue},w._stringRef=j,w)}if(typeof b!="string")throw Error(a(284));if(!P._owner)throw Error(a(290,b))}return b}function nA(b,w){throw b=Object.prototype.toString.call(w),Error(a(31,b==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":b))}function v6(b){var w=b._init;return w(b._payload)}function y6(b){function w(ze,De){if(b){var We=ze.deletions;We===null?(ze.deletions=[De],ze.flags|=16):We.push(De)}}function P(ze,De){if(!b)return null;for(;De!==null;)w(ze,De),De=De.sibling;return null}function R(ze,De){for(ze=new Map;De!==null;)De.key!==null?ze.set(De.key,De):ze.set(De.index,De),De=De.sibling;return ze}function k(ze,De){return ze=Nd(ze,De),ze.index=0,ze.sibling=null,ze}function j(ze,De,We){return ze.index=We,b?(We=ze.alternate,We!==null?(We=We.index,We<De?(ze.flags|=2,De):We):(ze.flags|=2,De)):(ze.flags|=1048576,De)}function ue(ze){return b&&ze.alternate===null&&(ze.flags|=2),ze}function Pe(ze,De,We,Dt){return De===null||De.tag!==6?(De=aI(We,ze.mode,Dt),De.return=ze,De):(De=k(De,We),De.return=ze,De)}function qe(ze,De,We,Dt){var Vt=We.type;return Vt===h?kt(ze,De,We.props.children,Dt,We.key):De!==null&&(De.elementType===Vt||typeof Vt=="object"&&Vt!==null&&Vt.$$typeof===x&&v6(Vt)===De.type)?(Dt=k(De,We.props),Dt.ref=ux(ze,De,We),Dt.return=ze,Dt):(Dt=BA(We.type,We.key,We.props,null,ze.mode,Dt),Dt.ref=ux(ze,De,We),Dt.return=ze,Dt)}function vt(ze,De,We,Dt){return De===null||De.tag!==4||De.stateNode.containerInfo!==We.containerInfo||De.stateNode.implementation!==We.implementation?(De=oI(We,ze.mode,Dt),De.return=ze,De):(De=k(De,We.children||[]),De.return=ze,De)}function kt(ze,De,We,Dt,Vt){return De===null||De.tag!==7?(De=qp(We,ze.mode,Dt,Vt),De.return=ze,De):(De=k(De,We),De.return=ze,De)}function gi(ze,De,We){if(typeof De=="string"&&De!==""||typeof De=="number")return De=aI(""+De,ze.mode,We),De.return=ze,De;if(typeof De=="object"&&De!==null){switch(De.$$typeof){case l:return We=BA(De.type,De.key,De.props,null,ze.mode,We),We.ref=ux(ze,null,De),We.return=ze,We;case c:return De=oI(De,ze.mode,We),De.return=ze,De;case x:var Dt=De._init;return gi(ze,Dt(De._payload),We)}if(H(De)||_(De))return De=qp(De,ze.mode,We,null),De.return=ze,De;nA(ze,De)}return null}function Zt(ze,De,We,Dt){var Vt=De!==null?De.key:null;if(typeof We=="string"&&We!==""||typeof We=="number")return Vt!==null?null:Pe(ze,De,""+We,Dt);if(typeof We=="object"&&We!==null){switch(We.$$typeof){case l:return We.key===Vt?qe(ze,De,We,Dt):null;case c:return We.key===Vt?vt(ze,De,We,Dt):null;case x:return Vt=We._init,Zt(ze,De,Vt(We._payload),Dt)}if(H(We)||_(We))return Vt!==null?null:kt(ze,De,We,Dt,null);nA(ze,We)}return null}function dr(ze,De,We,Dt,Vt){if(typeof Dt=="string"&&Dt!==""||typeof Dt=="number")return ze=ze.get(We)||null,Pe(De,ze,""+Dt,Vt);if(typeof Dt=="object"&&Dt!==null){switch(Dt.$$typeof){case l:return ze=ze.get(Dt.key===null?We:Dt.key)||null,qe(De,ze,Dt,Vt);case c:return ze=ze.get(Dt.key===null?We:Dt.key)||null,vt(De,ze,Dt,Vt);case x:var wi=Dt._init;return dr(ze,De,We,wi(Dt._payload),Vt)}if(H(Dt)||_(Dt))return ze=ze.get(We)||null,kt(De,ze,Dt,Vt,null);nA(De,Dt)}return null}function Ht(ze,De,We,Dt){for(var Vt=null,wi=null,vi=De,Hi=De=0,ds=null;vi!==null&&Hi<We.length;Hi++){vi.index>Hi?(ds=vi,vi=null):ds=vi.sibling;var ji=Zt(ze,vi,We[Hi],Dt);if(ji===null){vi===null&&(vi=ds);break}b&&vi&&ji.alternate===null&&w(ze,vi),De=j(ji,De,Hi),wi===null?Vt=ji:wi.sibling=ji,wi=ji,vi=ds}if(Hi===We.length)return P(ze,vi),Rr&&Gp(ze,Hi),Vt;if(vi===null){for(;Hi<We.length;Hi++)vi=gi(ze,We[Hi],Dt),vi!==null&&(De=j(vi,De,Hi),wi===null?Vt=vi:wi.sibling=vi,wi=vi);return Rr&&Gp(ze,Hi),Vt}for(vi=R(ze,vi);Hi<We.length;Hi++)ds=dr(vi,ze,Hi,We[Hi],Dt),ds!==null&&(b&&ds.alternate!==null&&vi.delete(ds.key===null?Hi:ds.key),De=j(ds,De,Hi),wi===null?Vt=ds:wi.sibling=ds,wi=ds);return b&&vi.forEach(function(Ud){return w(ze,Ud)}),Rr&&Gp(ze,Hi),Vt}function ia(ze,De,We,Dt){var Vt=_(We);if(typeof Vt!="function")throw Error(a(150));if(We=Vt.call(We),We==null)throw Error(a(151));for(var wi=Vt=null,vi=De,Hi=De=0,ds=null,ji=We.next();vi!==null&&!ji.done;Hi++,ji=We.next()){vi.index>Hi?(ds=vi,vi=null):ds=vi.sibling;var Ud=Zt(ze,vi,ji.value,Dt);if(Ud===null){vi===null&&(vi=ds);break}b&&vi&&Ud.alternate===null&&w(ze,vi),De=j(Ud,De,Hi),wi===null?Vt=Ud:wi.sibling=Ud,wi=Ud,vi=ds}if(ji.done)return P(ze,vi),Rr&&Gp(ze,Hi),Vt;if(vi===null){for(;!ji.done;Hi++,ji=We.next())ji=gi(ze,ji.value,Dt),ji!==null&&(De=j(ji,De,Hi),wi===null?Vt=ji:wi.sibling=ji,wi=ji);return Rr&&Gp(ze,Hi),Vt}for(vi=R(ze,vi);!ji.done;Hi++,ji=We.next())ji=dr(vi,ze,Hi,ji.value,Dt),ji!==null&&(b&&ji.alternate!==null&&vi.delete(ji.key===null?Hi:ji.key),De=j(ji,De,Hi),wi===null?Vt=ji:wi.sibling=ji,wi=ji);return b&&vi.forEach(function(Pfe){return w(ze,Pfe)}),Rr&&Gp(ze,Hi),Vt}function sl(ze,De,We,Dt){if(typeof We=="object"&&We!==null&&We.type===h&&We.key===null&&(We=We.props.children),typeof We=="object"&&We!==null){switch(We.$$typeof){case l:e:{for(var Vt=We.key,wi=De;wi!==null;){if(wi.key===Vt){if(Vt=We.type,Vt===h){if(wi.tag===7){P(ze,wi.sibling),De=k(wi,We.props.children),De.return=ze,ze=De;break e}}else if(wi.elementType===Vt||typeof Vt=="object"&&Vt!==null&&Vt.$$typeof===x&&v6(Vt)===wi.type){P(ze,wi.sibling),De=k(wi,We.props),De.ref=ux(ze,wi,We),De.return=ze,ze=De;break e}P(ze,wi);break}else w(ze,wi);wi=wi.sibling}We.type===h?(De=qp(We.props.children,ze.mode,Dt,We.key),De.return=ze,ze=De):(Dt=BA(We.type,We.key,We.props,null,ze.mode,Dt),Dt.ref=ux(ze,De,We),Dt.return=ze,ze=Dt)}return ue(ze);case c:e:{for(wi=We.key;De!==null;){if(De.key===wi)if(De.tag===4&&De.stateNode.containerInfo===We.containerInfo&&De.stateNode.implementation===We.implementation){P(ze,De.sibling),De=k(De,We.children||[]),De.return=ze,ze=De;break e}else{P(ze,De);break}else w(ze,De);De=De.sibling}De=oI(We,ze.mode,Dt),De.return=ze,ze=De}return ue(ze);case x:return wi=We._init,sl(ze,De,wi(We._payload),Dt)}if(H(We))return Ht(ze,De,We,Dt);if(_(We))return ia(ze,De,We,Dt);nA(ze,We)}return typeof We=="string"&&We!==""||typeof We=="number"?(We=""+We,De!==null&&De.tag===6?(P(ze,De.sibling),De=k(De,We),De.return=ze,ze=De):(P(ze,De),De=aI(We,ze.mode,Dt),De.return=ze,ze=De),ue(ze)):P(ze,De)}return sl}var v0=y6(!0),x6=y6(!1),dx={},tl=Nr(dx),fx=Nr(dx),y0=Nr(dx);function Xc(b){if(b===dx)throw Error(a(174));return b}function AR(b,w){te(y0,w),te(fx,b),te(tl,dx),b=W(w),$(tl),te(tl,b)}function x0(){$(tl),$(fx),$(y0)}function b6(b){var w=Xc(y0.current),P=Xc(tl.current);w=I(P,b.type,w),P!==w&&(te(fx,b),te(tl,w))}function ER(b){fx.current===b&&($(tl),$(fx))}var Ur=Nr(0);function sA(b){for(var w=b;w!==null;){if(w.tag===13){var P=w.memoizedState;if(P!==null&&(P=P.dehydrated,P===null||Dd(P)||Ql(P)))return w}else if(w.tag===19&&w.memoizedProps.revealOrder!==void 0){if(w.flags&128)return w}else if(w.child!==null){w.child.return=w,w=w.child;continue}if(w===b)break;for(;w.sibling===null;){if(w.return===null||w.return===b)return null;w=w.return}w.sibling.return=w.return,w=w.sibling}return null}var MR=[];function TR(){for(var b=0;b<MR.length;b++){var w=MR[b];ve?w._workInProgressVersionPrimary=null:w._workInProgressVersionSecondary=null}MR.length=0}var aA=o.ReactCurrentDispatcher,il=o.ReactCurrentBatchConfig,b0=0,Jr=null,Zs=null,us=null,oA=!1,px=!1,mx=0,efe=0;function ea(){throw Error(a(321))}function CR(b,w){if(w===null)return!1;for(var P=0;P<w.length&&P<b.length;P++)if(!Hc(b[P],w[P]))return!1;return!0}function PR(b,w,P,R,k,j){if(b0=j,Jr=w,w.memoizedState=null,w.updateQueue=null,w.lanes=0,aA.current=b===null||b.memoizedState===null?nfe:sfe,b=P(R,k),px){j=0;do{if(px=!1,mx=0,25<=j)throw Error(a(301));j+=1,us=Zs=null,w.updateQueue=null,aA.current=afe,b=P(R,k)}while(px)}if(aA.current=dA,w=Zs!==null&&Zs.next!==null,b0=0,us=Zs=Jr=null,oA=!1,w)throw Error(a(300));return b}function DR(){var b=mx!==0;return mx=0,b}function iu(){var b={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return us===null?Jr.memoizedState=us=b:us=us.next=b,us}function Yc(){if(Zs===null){var b=Jr.alternate;b=b!==null?b.memoizedState:null}else b=Zs.next;var w=us===null?Jr.memoizedState:us.next;if(w!==null)us=w,Zs=b;else{if(b===null)throw Error(a(310));Zs=b,b={memoizedState:Zs.memoizedState,baseState:Zs.baseState,baseQueue:Zs.baseQueue,queue:Zs.queue,next:null},us===null?Jr.memoizedState=us=b:us=us.next=b}return us}function Vp(b,w){return typeof w=="function"?w(b):w}function lA(b){var w=Yc(),P=w.queue;if(P===null)throw Error(a(311));P.lastRenderedReducer=b;var R=Zs,k=R.baseQueue,j=P.pending;if(j!==null){if(k!==null){var ue=k.next;k.next=j.next,j.next=ue}R.baseQueue=k=j,P.pending=null}if(k!==null){j=k.next,R=R.baseState;var Pe=ue=null,qe=null,vt=j;do{var kt=vt.lane;if((b0&kt)===kt)qe!==null&&(qe=qe.next={lane:0,action:vt.action,hasEagerState:vt.hasEagerState,eagerState:vt.eagerState,next:null}),R=vt.hasEagerState?vt.eagerState:b(R,vt.action);else{var gi={lane:kt,action:vt.action,hasEagerState:vt.hasEagerState,eagerState:vt.eagerState,next:null};qe===null?(Pe=qe=gi,ue=R):qe=qe.next=gi,Jr.lanes|=kt,S0|=kt}vt=vt.next}while(vt!==null&&vt!==j);qe===null?ue=R:qe.next=Pe,Hc(R,w.memoizedState)||(Mo=!0),w.memoizedState=R,w.baseState=ue,w.baseQueue=qe,P.lastRenderedState=R}if(b=P.interleaved,b!==null){k=b;do j=k.lane,Jr.lanes|=j,S0|=j,k=k.next;while(k!==b)}else k===null&&(P.lanes=0);return[w.memoizedState,P.dispatch]}function cA(b){var w=Yc(),P=w.queue;if(P===null)throw Error(a(311));P.lastRenderedReducer=b;var R=P.dispatch,k=P.pending,j=w.memoizedState;if(k!==null){P.pending=null;var ue=k=k.next;do j=b(j,ue.action),ue=ue.next;while(ue!==k);Hc(j,w.memoizedState)||(Mo=!0),w.memoizedState=j,w.baseQueue===null&&(w.baseState=j),P.lastRenderedState=j}return[j,R]}function w6(){}function S6(b,w){var P=Jr,R=Yc(),k=w(),j=!Hc(R.memoizedState,k);if(j&&(R.memoizedState=k,Mo=!0),R=R.queue,vx(E6.bind(null,P,R,b),[b]),R.getSnapshot!==w||j||us!==null&&us.memoizedState.tag&1){if(P.flags|=2048,gx(9,A6.bind(null,P,R,k,w),void 0,null),Mn===null)throw Error(a(349));b0&30||_6(P,w,k)}return k}function _6(b,w,P){b.flags|=16384,b={getSnapshot:w,value:P},w=Jr.updateQueue,w===null?(w={lastEffect:null,stores:null},Jr.updateQueue=w,w.stores=[b]):(P=w.stores,P===null?w.stores=[b]:P.push(b))}function A6(b,w,P,R){w.value=P,w.getSnapshot=R,M6(w)&&rl(b,1,-1)}function E6(b,w,P){return P(function(){M6(w)&&rl(b,1,-1)})}function M6(b){var w=b.getSnapshot;b=b.value;try{var P=w();return!Hc(b,P)}catch{return!0}}function RR(b){var w=iu();return typeof b=="function"&&(b=b()),w.memoizedState=w.baseState=b,b={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vp,lastRenderedState:b},w.queue=b,b=b.dispatch=rfe.bind(null,Jr,b),[w.memoizedState,b]}function gx(b,w,P,R){return b={tag:b,create:w,destroy:P,deps:R,next:null},w=Jr.updateQueue,w===null?(w={lastEffect:null,stores:null},Jr.updateQueue=w,w.lastEffect=b.next=b):(P=w.lastEffect,P===null?w.lastEffect=b.next=b:(R=P.next,P.next=b,b.next=R,w.lastEffect=b)),b}function T6(){return Yc().memoizedState}function hA(b,w,P,R){var k=iu();Jr.flags|=b,k.memoizedState=gx(1|w,P,void 0,R===void 0?null:R)}function uA(b,w,P,R){var k=Yc();R=R===void 0?null:R;var j=void 0;if(Zs!==null){var ue=Zs.memoizedState;if(j=ue.destroy,R!==null&&CR(R,ue.deps)){k.memoizedState=gx(w,P,j,R);return}}Jr.flags|=b,k.memoizedState=gx(1|w,P,j,R)}function IR(b,w){return hA(8390656,8,b,w)}function vx(b,w){return uA(2048,8,b,w)}function C6(b,w){return uA(4,2,b,w)}function P6(b,w){return uA(4,4,b,w)}function D6(b,w){if(typeof w=="function")return b=b(),w(b),function(){w(null)};if(w!=null)return b=b(),w.current=b,function(){w.current=null}}function R6(b,w,P){return P=P!=null?P.concat([b]):null,uA(4,4,D6.bind(null,w,b),P)}function LR(){}function I6(b,w){var P=Yc();w=w===void 0?null:w;var R=P.memoizedState;return R!==null&&w!==null&&CR(w,R[1])?R[0]:(P.memoizedState=[b,w],b)}function L6(b,w){var P=Yc();w=w===void 0?null:w;var R=P.memoizedState;return R!==null&&w!==null&&CR(w,R[1])?R[0]:(b=b(),P.memoizedState=[b,w],b)}function tfe(b,w){var P=Vi;Vi=P!==0&&4>P?P:4,b(!0);var R=il.transition;il.transition={};try{b(!1),w()}finally{Vi=P,il.transition=R}}function O6(){return Yc().memoizedState}function ife(b,w,P){var R=Fd(b);P={lane:R,action:P,hasEagerState:!1,eagerState:null,next:null},B6(b)?F6(w,P):(k6(b,w,P),P=Aa(),b=rl(b,R,P),b!==null&&N6(b,w,R))}function rfe(b,w,P){var R=Fd(b),k={lane:R,action:P,hasEagerState:!1,eagerState:null,next:null};if(B6(b))F6(w,k);else{k6(b,w,k);var j=b.alternate;if(b.lanes===0&&(j===null||j.lanes===0)&&(j=w.lastRenderedReducer,j!==null))try{var ue=w.lastRenderedState,Pe=j(ue,P);if(k.hasEagerState=!0,k.eagerState=Pe,Hc(Pe,ue))return}catch{}finally{}P=Aa(),b=rl(b,R,P),b!==null&&N6(b,w,R)}}function B6(b){var w=b.alternate;return b===Jr||w!==null&&w===Jr}function F6(b,w){px=oA=!0;var P=b.pending;P===null?w.next=w:(w.next=P.next,P.next=w),b.pending=w}function k6(b,w,P){Mn!==null&&b.mode&1&&!(_i&2)?(b=w.interleaved,b===null?(P.next=P,Wc===null?Wc=[w]:Wc.push(w)):(P.next=b.next,b.next=P),w.interleaved=P):(b=w.pending,b===null?P.next=P:(P.next=b.next,b.next=P),w.pending=P)}function N6(b,w,P){if(P&4194240){var R=w.lanes;R&=b.pendingLanes,P|=R,w.lanes=P,oR(b,P)}}var dA={readContext:Jo,useCallback:ea,useContext:ea,useEffect:ea,useImperativeHandle:ea,useInsertionEffect:ea,useLayoutEffect:ea,useMemo:ea,useReducer:ea,useRef:ea,useState:ea,useDebugValue:ea,useDeferredValue:ea,useTransition:ea,useMutableSource:ea,useSyncExternalStore:ea,useId:ea,unstable_isNewReconciler:!1},nfe={readContext:Jo,useCallback:function(b,w){return iu().memoizedState=[b,w===void 0?null:w],b},useContext:Jo,useEffect:IR,useImperativeHandle:function(b,w,P){return P=P!=null?P.concat([b]):null,hA(4194308,4,D6.bind(null,w,b),P)},useLayoutEffect:function(b,w){return hA(4194308,4,b,w)},useInsertionEffect:function(b,w){return hA(4,2,b,w)},useMemo:function(b,w){var P=iu();return w=w===void 0?null:w,b=b(),P.memoizedState=[b,w],b},useReducer:function(b,w,P){var R=iu();return w=P!==void 0?P(w):w,R.memoizedState=R.baseState=w,b={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:b,lastRenderedState:w},R.queue=b,b=b.dispatch=ife.bind(null,Jr,b),[R.memoizedState,b]},useRef:function(b){var w=iu();return b={current:b},w.memoizedState=b},useState:RR,useDebugValue:LR,useDeferredValue:function(b){var w=RR(b),P=w[0],R=w[1];return IR(function(){var k=il.transition;il.transition={};try{R(b)}finally{il.transition=k}},[b]),P},useTransition:function(){var b=RR(!1),w=b[0];return b=tfe.bind(null,b[1]),iu().memoizedState=b,[w,b]},useMutableSource:function(){},useSyncExternalStore:function(b,w,P){var R=Jr,k=iu();if(Rr){if(P===void 0)throw Error(a(407));P=P()}else{if(P=w(),Mn===null)throw Error(a(349));b0&30||_6(R,w,P)}k.memoizedState=P;var j={value:P,getSnapshot:w};return k.queue=j,IR(E6.bind(null,R,j,b),[b]),R.flags|=2048,gx(9,A6.bind(null,R,j,P,w),void 0,null),P},useId:function(){var b=iu(),w=Mn.identifierPrefix;if(Rr){var P=tu,R=eu;P=(R&~(1<<32-$l(R)-1)).toString(32)+P,w=":"+w+"R"+P,P=mx++,0<P&&(w+="H"+P.toString(32)),w+=":"}else P=efe++,w=":"+w+"r"+P.toString(32)+":";return b.memoizedState=w},unstable_isNewReconciler:!1},sfe={readContext:Jo,useCallback:I6,useContext:Jo,useEffect:vx,useImperativeHandle:R6,useInsertionEffect:C6,useLayoutEffect:P6,useMemo:L6,useReducer:lA,useRef:T6,useState:function(){return lA(Vp)},useDebugValue:LR,useDeferredValue:function(b){var w=lA(Vp),P=w[0],R=w[1];return vx(function(){var k=il.transition;il.transition={};try{R(b)}finally{il.transition=k}},[b]),P},useTransition:function(){var b=lA(Vp)[0],w=Yc().memoizedState;return[b,w]},useMutableSource:w6,useSyncExternalStore:S6,useId:O6,unstable_isNewReconciler:!1},afe={readContext:Jo,useCallback:I6,useContext:Jo,useEffect:vx,useImperativeHandle:R6,useInsertionEffect:C6,useLayoutEffect:P6,useMemo:L6,useReducer:cA,useRef:T6,useState:function(){return cA(Vp)},useDebugValue:LR,useDeferredValue:function(b){var w=cA(Vp),P=w[0],R=w[1];return vx(function(){var k=il.transition;il.transition={};try{R(b)}finally{il.transition=k}},[b]),P},useTransition:function(){var b=cA(Vp)[0],w=Yc().memoizedState;return[b,w]},useMutableSource:w6,useSyncExternalStore:S6,useId:O6,unstable_isNewReconciler:!1};function OR(b,w){try{var P="",R=w;do P+=Zde(R),R=R.return;while(R);var k=P}catch(j){k=`
Error generating stack: `+j.message+`
`+j.stack}return{value:b,source:w,stack:k}}function BR(b,w){try{console.error(w.value)}catch(P){setTimeout(function(){throw P})}}var ofe=typeof WeakMap=="function"?WeakMap:Map;function U6(b,w,P){P=Zh(-1,P),P.tag=3,P.payload={element:null};var R=w.value;return P.callback=function(){CA||(CA=!0,ZR=R),BR(b,w)},P}function z6(b,w,P){P=Zh(-1,P),P.tag=3;var R=b.type.getDerivedStateFromError;if(typeof R=="function"){var k=w.value;P.payload=function(){return R(k)},P.callback=function(){BR(b,w)}}var j=b.stateNode;return j!==null&&typeof j.componentDidCatch=="function"&&(P.callback=function(){BR(b,w),typeof R!="function"&&(Od===null?Od=new Set([this]):Od.add(this));var ue=w.stack;this.componentDidCatch(w.value,{componentStack:ue!==null?ue:""})}),P}function G6(b,w,P){var R=b.pingCache;if(R===null){R=b.pingCache=new ofe;var k=new Set;R.set(w,k)}else k=R.get(w),k===void 0&&(k=new Set,R.set(w,k));k.has(P)||(k.add(P),b=wfe.bind(null,b,w,P),w.then(b,b))}function V6(b){do{var w;if((w=b.tag===13)&&(w=b.memoizedState,w=w!==null?w.dehydrated!==null:!0),w)return b;b=b.return}while(b!==null);return null}function H6(b,w,P,R,k){return b.mode&1?(b.flags|=65536,b.lanes=k,b):(b===w?b.flags|=65536:(b.flags|=128,P.flags|=131072,P.flags&=-52805,P.tag===1&&(P.alternate===null?P.tag=17:(w=Zh(-1,1),w.tag=2,Ld(P,w))),P.lanes|=1),b)}function qc(b){b.flags|=4}function j6(b,w){if(b!==null&&b.child===w.child)return!0;if(w.flags&16)return!1;for(b=w.child;b!==null;){if(b.flags&12854||b.subtreeFlags&12854)return!1;b=b.sibling}return!0}var yx,xx,fA,pA;if(Ee)yx=function(b,w){for(var P=w.child;P!==null;){if(P.tag===5||P.tag===6)Q(b,P.stateNode);else if(P.tag!==4&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===w)break;for(;P.sibling===null;){if(P.return===null||P.return===w)return;P=P.return}P.sibling.return=P.return,P=P.sibling}},xx=function(){},fA=function(b,w,P,R,k){if(b=b.memoizedProps,b!==R){var j=w.stateNode,ue=Xc(tl.current);P=ie(j,P,b,R,k,ue),(w.updateQueue=P)&&qc(w)}},pA=function(b,w,P,R){P!==R&&qc(w)};else if(fe){yx=function(b,w,P,R){for(var k=w.child;k!==null;){if(k.tag===5){var j=k.stateNode;P&&R&&(j=Gt(j,k.type,k.memoizedProps,k)),Q(b,j)}else if(k.tag===6)j=k.stateNode,P&&R&&(j=Qi(j,k.memoizedProps,k)),Q(b,j);else if(k.tag!==4){if(k.tag===22&&k.memoizedState!==null)j=k.child,j!==null&&(j.return=k),yx(b,k,!0,!0);else if(k.child!==null){k.child.return=k,k=k.child;continue}}if(k===w)break;for(;k.sibling===null;){if(k.return===null||k.return===w)return;k=k.return}k.sibling.return=k.return,k=k.sibling}};var W6=function(b,w,P,R){for(var k=w.child;k!==null;){if(k.tag===5){var j=k.stateNode;P&&R&&(j=Gt(j,k.type,k.memoizedProps,k)),Qt(b,j)}else if(k.tag===6)j=k.stateNode,P&&R&&(j=Qi(j,k.memoizedProps,k)),Qt(b,j);else if(k.tag!==4){if(k.tag===22&&k.memoizedState!==null)j=k.child,j!==null&&(j.return=k),W6(b,k,!0,!0);else if(k.child!==null){k.child.return=k,k=k.child;continue}}if(k===w)break;for(;k.sibling===null;){if(k.return===null||k.return===w)return;k=k.return}k.sibling.return=k.return,k=k.sibling}};xx=function(b,w){var P=w.stateNode;if(!j6(b,w)){b=P.containerInfo;var R=Mt(b);W6(R,w,!1,!1),P.pendingChildren=R,qc(w),ci(b,R)}},fA=function(b,w,P,R,k){var j=b.stateNode,ue=b.memoizedProps;if((b=j6(b,w))&&ue===R)w.stateNode=j;else{var Pe=w.stateNode,qe=Xc(tl.current),vt=null;ue!==R&&(vt=ie(Pe,P,ue,R,k,qe)),b&&vt===null?w.stateNode=j:(j=at(j,vt,P,ue,R,w,b,Pe),re(j,P,R,k,qe)&&qc(w),w.stateNode=j,b?qc(w):yx(j,w,!1,!1))}},pA=function(b,w,P,R){P!==R?(b=Xc(y0.current),P=Xc(tl.current),w.stateNode=Z(R,b,P,w),qc(w)):w.stateNode=b.stateNode}}else xx=function(){},fA=function(){},pA=function(){};function bx(b,w){if(!Rr)switch(b.tailMode){case"hidden":w=b.tail;for(var P=null;w!==null;)w.alternate!==null&&(P=w),w=w.sibling;P===null?b.tail=null:P.sibling=null;break;case"collapsed":P=b.tail;for(var R=null;P!==null;)P.alternate!==null&&(R=P),P=P.sibling;R===null?w||b.tail===null?b.tail=null:b.tail.sibling=null:R.sibling=null}}function ta(b){var w=b.alternate!==null&&b.alternate.child===b.child,P=0,R=0;if(w)for(var k=b.child;k!==null;)P|=k.lanes|k.childLanes,R|=k.subtreeFlags&14680064,R|=k.flags&14680064,k.return=b,k=k.sibling;else for(k=b.child;k!==null;)P|=k.lanes|k.childLanes,R|=k.subtreeFlags,R|=k.flags,k.return=b,k=k.sibling;return b.subtreeFlags|=R,b.childLanes=P,w}function lfe(b,w,P){var R=w.pendingProps;switch(bR(w),w.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ta(w),null;case 1:return cs(w.type)&&$h(),ta(w),null;case 3:return R=w.stateNode,x0(),$(Te),$(ne),TR(),R.pendingContext&&(R.context=R.pendingContext,R.pendingContext=null),(b===null||b.child===null)&&(hx(w)?qc(w):b===null||b.memoizedState.isDehydrated&&!(w.flags&256)||(w.flags|=1024,Zl!==null&&(iI(Zl),Zl=null))),xx(b,w),ta(w),null;case 5:ER(w),P=Xc(y0.current);var k=w.type;if(b!==null&&w.stateNode!=null)fA(b,w,k,R,P),b.ref!==w.ref&&(w.flags|=512,w.flags|=2097152);else{if(!R){if(w.stateNode===null)throw Error(a(166));return ta(w),null}if(b=Xc(tl.current),hx(w)){if(!pe)throw Error(a(175));b=rt(w.stateNode,w.type,w.memoizedProps,P,b,w,!cx),w.updateQueue=b,b!==null&&qc(w)}else{var j=X(k,R,P,b,w);yx(j,w,!1,!1),w.stateNode=j,re(j,k,R,P,b)&&qc(w)}w.ref!==null&&(w.flags|=512,w.flags|=2097152)}return ta(w),null;case 6:if(b&&w.stateNode!=null)pA(b,w,b.memoizedProps,R);else{if(typeof R!="string"&&w.stateNode===null)throw Error(a(166));if(b=Xc(y0.current),P=Xc(tl.current),hx(w)){if(!pe)throw Error(a(176));if(b=w.stateNode,R=w.memoizedProps,(P=ft(b,R,w,!cx))&&(k=Ao,k!==null))switch(j=(k.mode&1)!==0,k.tag){case 3:cn(k.stateNode.containerInfo,b,R,j);break;case 5:ls(k.type,k.memoizedProps,k.stateNode,b,R,j)}P&&qc(w)}else w.stateNode=Z(R,b,P,w)}return ta(w),null;case 13:if($(Ur),R=w.memoizedState,Rr&&Eo!==null&&w.mode&1&&!(w.flags&128)){for(b=Eo;b;)b=ae(b);return g0(),w.flags|=98560,w}if(R!==null&&R.dehydrated!==null){if(R=hx(w),b===null){if(!R)throw Error(a(318));if(!pe)throw Error(a(344));if(b=w.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(a(317));gt(b,w)}else g0(),!(w.flags&128)&&(w.memoizedState=null),w.flags|=4;return ta(w),null}return Zl!==null&&(iI(Zl),Zl=null),w.flags&128?(w.lanes=P,w):(R=R!==null,P=!1,b===null?hx(w):P=b.memoizedState!==null,R&&!P&&(w.child.flags|=8192,w.mode&1&&(b===null||Ur.current&1?Hn===0&&(Hn=3):nI())),w.updateQueue!==null&&(w.flags|=4),ta(w),null);case 4:return x0(),xx(b,w),b===null&&Le(w.stateNode.containerInfo),ta(w),null;case 10:return pR(w.type._context),ta(w),null;case 17:return cs(w.type)&&$h(),ta(w),null;case 19:if($(Ur),k=w.memoizedState,k===null)return ta(w),null;if(R=(w.flags&128)!==0,j=k.rendering,j===null)if(R)bx(k,!1);else{if(Hn!==0||b!==null&&b.flags&128)for(b=w.child;b!==null;){if(j=sA(b),j!==null){for(w.flags|=128,bx(k,!1),b=j.updateQueue,b!==null&&(w.updateQueue=b,w.flags|=4),w.subtreeFlags=0,b=P,R=w.child;R!==null;)P=R,k=b,P.flags&=14680066,j=P.alternate,j===null?(P.childLanes=0,P.lanes=k,P.child=null,P.subtreeFlags=0,P.memoizedProps=null,P.memoizedState=null,P.updateQueue=null,P.dependencies=null,P.stateNode=null):(P.childLanes=j.childLanes,P.lanes=j.lanes,P.child=j.child,P.subtreeFlags=0,P.deletions=null,P.memoizedProps=j.memoizedProps,P.memoizedState=j.memoizedState,P.updateQueue=j.updateQueue,P.type=j.type,k=j.dependencies,P.dependencies=k===null?null:{lanes:k.lanes,firstContext:k.firstContext}),R=R.sibling;return te(Ur,Ur.current&1|2),w.child}b=b.sibling}k.tail!==null&&hs()>JR&&(w.flags|=128,R=!0,bx(k,!1),w.lanes=4194304)}else{if(!R)if(b=sA(j),b!==null){if(w.flags|=128,R=!0,b=b.updateQueue,b!==null&&(w.updateQueue=b,w.flags|=4),bx(k,!0),k.tail===null&&k.tailMode==="hidden"&&!j.alternate&&!Rr)return ta(w),null}else 2*hs()-k.renderingStartTime>JR&&P!==1073741824&&(w.flags|=128,R=!0,bx(k,!1),w.lanes=4194304);k.isBackwards?(j.sibling=w.child,w.child=j):(b=k.last,b!==null?b.sibling=j:w.child=j,k.last=j)}return k.tail!==null?(w=k.tail,k.rendering=w,k.tail=w.sibling,k.renderingStartTime=hs(),w.sibling=null,b=Ur.current,te(Ur,R?b&1|2:b&1),w):(ta(w),null);case 22:case 23:return rI(),R=w.memoizedState!==null,b!==null&&b.memoizedState!==null!==R&&(w.flags|=8192),R&&w.mode&1?To&1073741824&&(ta(w),Ee&&w.subtreeFlags&6&&(w.flags|=8192)):ta(w),null;case 24:return null;case 25:return null}throw Error(a(156,w.tag))}var cfe=o.ReactCurrentOwner,Mo=!1;function _a(b,w,P,R){w.child=b===null?x6(w,null,P,R):v0(w,b.child,P,R)}function X6(b,w,P,R,k){P=P.render;var j=w.ref;return f0(w,k),R=PR(b,w,P,R,j,k),P=DR(),b!==null&&!Mo?(w.updateQueue=b.updateQueue,w.flags&=-2053,b.lanes&=~k,ru(b,w,k)):(Rr&&P&&xR(w),w.flags|=1,_a(b,w,R,k),w.child)}function Y6(b,w,P,R,k){if(b===null){var j=P.type;return typeof j=="function"&&!sI(j)&&j.defaultProps===void 0&&P.compare===null&&P.defaultProps===void 0?(w.tag=15,w.type=j,q6(b,w,j,R,k)):(b=BA(P.type,null,R,w,w.mode,k),b.ref=w.ref,b.return=w,w.child=b)}if(j=b.child,!(b.lanes&k)){var ue=j.memoizedProps;if(P=P.compare,P=P!==null?P:Q_,P(ue,R)&&b.ref===w.ref)return ru(b,w,k)}return w.flags|=1,b=Nd(j,R),b.ref=w.ref,b.return=w,w.child=b}function q6(b,w,P,R,k){if(b!==null&&Q_(b.memoizedProps,R)&&b.ref===w.ref)if(Mo=!1,(b.lanes&k)!==0)b.flags&131072&&(Mo=!0);else return w.lanes=b.lanes,ru(b,w,k);return FR(b,w,P,R,k)}function K6(b,w,P){var R=w.pendingProps,k=R.children,j=b!==null?b.memoizedState:null;if(R.mode==="hidden")if(!(w.mode&1))w.memoizedState={baseLanes:0,cachePool:null},te(w0,To),To|=P;else if(P&1073741824)w.memoizedState={baseLanes:0,cachePool:null},R=j!==null?j.baseLanes:P,te(w0,To),To|=R;else return b=j!==null?j.baseLanes|P:P,w.lanes=w.childLanes=1073741824,w.memoizedState={baseLanes:b,cachePool:null},w.updateQueue=null,te(w0,To),To|=b,null;else j!==null?(R=j.baseLanes|P,w.memoizedState=null):R=P,te(w0,To),To|=R;return _a(b,w,k,P),w.child}function Q6(b,w){var P=w.ref;(b===null&&P!==null||b!==null&&b.ref!==P)&&(w.flags|=512,w.flags|=2097152)}function FR(b,w,P,R,k){var j=cs(P)?lt:ne.current;return j=Vn(w,j),f0(w,k),P=PR(b,w,P,R,j,k),R=DR(),b!==null&&!Mo?(w.updateQueue=b.updateQueue,w.flags&=-2053,b.lanes&=~k,ru(b,w,k)):(Rr&&R&&xR(w),w.flags|=1,_a(b,w,P,k),w.child)}function $6(b,w,P,R,k){if(cs(P)){var j=!0;Rd(w)}else j=!1;if(f0(w,k),w.stateNode===null)b!==null&&(b.alternate=null,w.alternate=null,w.flags|=2),u6(w,P,R),yR(w,P,R,k),R=!0;else if(b===null){var ue=w.stateNode,Pe=w.memoizedProps;ue.props=Pe;var qe=ue.context,vt=P.contextType;typeof vt=="object"&&vt!==null?vt=Jo(vt):(vt=cs(P)?lt:ne.current,vt=Vn(w,vt));var kt=P.getDerivedStateFromProps,gi=typeof kt=="function"||typeof ue.getSnapshotBeforeUpdate=="function";gi||typeof ue.UNSAFE_componentWillReceiveProps!="function"&&typeof ue.componentWillReceiveProps!="function"||(Pe!==R||qe!==vt)&&d6(w,ue,R,vt),Id=!1;var Zt=w.memoizedState;ue.state=Zt,eA(w,R,ue,k),qe=w.memoizedState,Pe!==R||Zt!==qe||Te.current||Id?(typeof kt=="function"&&(vR(w,P,kt,R),qe=w.memoizedState),(Pe=Id||h6(w,P,Pe,R,Zt,qe,vt))?(gi||typeof ue.UNSAFE_componentWillMount!="function"&&typeof ue.componentWillMount!="function"||(typeof ue.componentWillMount=="function"&&ue.componentWillMount(),typeof ue.UNSAFE_componentWillMount=="function"&&ue.UNSAFE_componentWillMount()),typeof ue.componentDidMount=="function"&&(w.flags|=4194308)):(typeof ue.componentDidMount=="function"&&(w.flags|=4194308),w.memoizedProps=R,w.memoizedState=qe),ue.props=R,ue.state=qe,ue.context=vt,R=Pe):(typeof ue.componentDidMount=="function"&&(w.flags|=4194308),R=!1)}else{ue=w.stateNode,a6(b,w),Pe=w.memoizedProps,vt=w.type===w.elementType?Pe:Jl(w.type,Pe),ue.props=vt,gi=w.pendingProps,Zt=ue.context,qe=P.contextType,typeof qe=="object"&&qe!==null?qe=Jo(qe):(qe=cs(P)?lt:ne.current,qe=Vn(w,qe));var dr=P.getDerivedStateFromProps;(kt=typeof dr=="function"||typeof ue.getSnapshotBeforeUpdate=="function")||typeof ue.UNSAFE_componentWillReceiveProps!="function"&&typeof ue.componentWillReceiveProps!="function"||(Pe!==gi||Zt!==qe)&&d6(w,ue,R,qe),Id=!1,Zt=w.memoizedState,ue.state=Zt,eA(w,R,ue,k);var Ht=w.memoizedState;Pe!==gi||Zt!==Ht||Te.current||Id?(typeof dr=="function"&&(vR(w,P,dr,R),Ht=w.memoizedState),(vt=Id||h6(w,P,vt,R,Zt,Ht,qe)||!1)?(kt||typeof ue.UNSAFE_componentWillUpdate!="function"&&typeof ue.componentWillUpdate!="function"||(typeof ue.componentWillUpdate=="function"&&ue.componentWillUpdate(R,Ht,qe),typeof ue.UNSAFE_componentWillUpdate=="function"&&ue.UNSAFE_componentWillUpdate(R,Ht,qe)),typeof ue.componentDidUpdate=="function"&&(w.flags|=4),typeof ue.getSnapshotBeforeUpdate=="function"&&(w.flags|=1024)):(typeof ue.componentDidUpdate!="function"||Pe===b.memoizedProps&&Zt===b.memoizedState||(w.flags|=4),typeof ue.getSnapshotBeforeUpdate!="function"||Pe===b.memoizedProps&&Zt===b.memoizedState||(w.flags|=1024),w.memoizedProps=R,w.memoizedState=Ht),ue.props=R,ue.state=Ht,ue.context=qe,R=vt):(typeof ue.componentDidUpdate!="function"||Pe===b.memoizedProps&&Zt===b.memoizedState||(w.flags|=4),typeof ue.getSnapshotBeforeUpdate!="function"||Pe===b.memoizedProps&&Zt===b.memoizedState||(w.flags|=1024),R=!1)}return kR(b,w,P,R,j,k)}function kR(b,w,P,R,k,j){Q6(b,w);var ue=(w.flags&128)!==0;if(!R&&!ue)return k&&t6(w,P,!1),ru(b,w,j);R=w.stateNode,cfe.current=w;var Pe=ue&&typeof P.getDerivedStateFromError!="function"?null:R.render();return w.flags|=1,b!==null&&ue?(w.child=v0(w,b.child,null,j),w.child=v0(w,null,Pe,j)):_a(b,w,Pe,j),w.memoizedState=R.state,k&&t6(w,P,!0),w.child}function J6(b){var w=b.stateNode;w.pendingContext?u0(b,w.pendingContext,w.pendingContext!==w.context):w.context&&u0(b,w.context,!1),AR(b,w.containerInfo)}function Z6(b,w,P,R,k){return g0(),_R(k),w.flags|=256,_a(b,w,P,R),w.child}var mA={dehydrated:null,treeContext:null,retryLane:0};function gA(b){return{baseLanes:b,cachePool:null}}function e8(b,w,P){var R=w.pendingProps,k=Ur.current,j=!1,ue=(w.flags&128)!==0,Pe;if((Pe=ue)||(Pe=b!==null&&b.memoizedState===null?!1:(k&2)!==0),Pe?(j=!0,w.flags&=-129):(b===null||b.memoizedState!==null)&&(k|=1),te(Ur,k&1),b===null)return SR(w),b=w.memoizedState,b!==null&&(b=b.dehydrated,b!==null)?(w.mode&1?Ql(b)?w.lanes=8:w.lanes=1073741824:w.lanes=1,null):(k=R.children,b=R.fallback,j?(R=w.mode,j=w.child,k={mode:"hidden",children:k},!(R&1)&&j!==null?(j.childLanes=0,j.pendingProps=k):j=FA(k,R,0,null),b=qp(b,R,P,null),j.return=w,b.return=w,j.sibling=b,w.child=j,w.child.memoizedState=gA(P),w.memoizedState=mA,b):NR(w,k));if(k=b.memoizedState,k!==null){if(Pe=k.dehydrated,Pe!==null){if(ue)return w.flags&256?(w.flags&=-257,vA(b,w,P,Error(a(422)))):w.memoizedState!==null?(w.child=b.child,w.flags|=128,null):(j=R.fallback,k=w.mode,R=FA({mode:"visible",children:R.children},k,0,null),j=qp(j,k,P,null),j.flags|=2,R.return=w,j.return=w,R.sibling=j,w.child=R,w.mode&1&&v0(w,b.child,null,P),w.child.memoizedState=gA(P),w.memoizedState=mA,j);if(!(w.mode&1))w=vA(b,w,P,null);else if(Ql(Pe))w=vA(b,w,P,Error(a(419)));else if(R=(P&b.childLanes)!==0,Mo||R){if(R=Mn,R!==null){switch(P&-P){case 4:j=2;break;case 16:j=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:j=32;break;case 536870912:j=268435456;break;default:j=0}R=j&(R.suspendedLanes|P)?0:j,R!==0&&R!==k.retryLane&&(k.retryLane=R,rl(b,R,-1))}nI(),w=vA(b,w,P,Error(a(421)))}else Dd(Pe)?(w.flags|=128,w.child=b.child,w=Sfe.bind(null,b),G(Pe,w),w=null):(P=k.treeContext,pe&&(Eo=xe(Pe),Ao=w,Rr=!0,Zl=null,cx=!1,P!==null&&(Zo[el++]=eu,Zo[el++]=tu,Zo[el++]=zp,eu=P.id,tu=P.overflow,zp=w)),w=NR(w,w.pendingProps.children),w.flags|=4096);return w}return j?(R=i8(b,w,R.children,R.fallback,P),j=w.child,k=b.child.memoizedState,j.memoizedState=k===null?gA(P):{baseLanes:k.baseLanes|P,cachePool:null},j.childLanes=b.childLanes&~P,w.memoizedState=mA,R):(P=t8(b,w,R.children,P),w.memoizedState=null,P)}return j?(R=i8(b,w,R.children,R.fallback,P),j=w.child,k=b.child.memoizedState,j.memoizedState=k===null?gA(P):{baseLanes:k.baseLanes|P,cachePool:null},j.childLanes=b.childLanes&~P,w.memoizedState=mA,R):(P=t8(b,w,R.children,P),w.memoizedState=null,P)}function NR(b,w){return w=FA({mode:"visible",children:w},b.mode,0,null),w.return=b,b.child=w}function t8(b,w,P,R){var k=b.child;return b=k.sibling,P=Nd(k,{mode:"visible",children:P}),!(w.mode&1)&&(P.lanes=R),P.return=w,P.sibling=null,b!==null&&(R=w.deletions,R===null?(w.deletions=[b],w.flags|=16):R.push(b)),w.child=P}function i8(b,w,P,R,k){var j=w.mode;b=b.child;var ue=b.sibling,Pe={mode:"hidden",children:P};return!(j&1)&&w.child!==b?(P=w.child,P.childLanes=0,P.pendingProps=Pe,w.deletions=null):(P=Nd(b,Pe),P.subtreeFlags=b.subtreeFlags&14680064),ue!==null?R=Nd(ue,R):(R=qp(R,j,k,null),R.flags|=2),R.return=w,P.return=w,P.sibling=R,w.child=P,R}function vA(b,w,P,R){return R!==null&&_R(R),v0(w,b.child,null,P),b=NR(w,w.pendingProps.children),b.flags|=2,w.memoizedState=null,b}function r8(b,w,P){b.lanes|=w;var R=b.alternate;R!==null&&(R.lanes|=w),mR(b.return,w,P)}function UR(b,w,P,R,k){var j=b.memoizedState;j===null?b.memoizedState={isBackwards:w,rendering:null,renderingStartTime:0,last:R,tail:P,tailMode:k}:(j.isBackwards=w,j.rendering=null,j.renderingStartTime=0,j.last=R,j.tail=P,j.tailMode=k)}function n8(b,w,P){var R=w.pendingProps,k=R.revealOrder,j=R.tail;if(_a(b,w,R.children,P),R=Ur.current,R&2)R=R&1|2,w.flags|=128;else{if(b!==null&&b.flags&128)e:for(b=w.child;b!==null;){if(b.tag===13)b.memoizedState!==null&&r8(b,P,w);else if(b.tag===19)r8(b,P,w);else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===w)break e;for(;b.sibling===null;){if(b.return===null||b.return===w)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}R&=1}if(te(Ur,R),!(w.mode&1))w.memoizedState=null;else switch(k){case"forwards":for(P=w.child,k=null;P!==null;)b=P.alternate,b!==null&&sA(b)===null&&(k=P),P=P.sibling;P=k,P===null?(k=w.child,w.child=null):(k=P.sibling,P.sibling=null),UR(w,!1,k,P,j);break;case"backwards":for(P=null,k=w.child,w.child=null;k!==null;){if(b=k.alternate,b!==null&&sA(b)===null){w.child=k;break}b=k.sibling,k.sibling=P,P=k,k=b}UR(w,!0,P,null,j);break;case"together":UR(w,!1,null,null,void 0);break;default:w.memoizedState=null}return w.child}function ru(b,w,P){if(b!==null&&(w.dependencies=b.dependencies),S0|=w.lanes,!(P&w.childLanes))return null;if(b!==null&&w.child!==b.child)throw Error(a(153));if(w.child!==null){for(b=w.child,P=Nd(b,b.pendingProps),w.child=P,P.return=w;b.sibling!==null;)b=b.sibling,P=P.sibling=Nd(b,b.pendingProps),P.return=w;P.sibling=null}return w.child}function hfe(b,w,P){switch(w.tag){case 3:J6(w),g0();break;case 5:b6(w);break;case 1:cs(w.type)&&Rd(w);break;case 4:AR(w,w.stateNode.containerInfo);break;case 10:s6(w,w.type._context,w.memoizedProps.value);break;case 13:var R=w.memoizedState;if(R!==null)return R.dehydrated!==null?(te(Ur,Ur.current&1),w.flags|=128,null):P&w.child.childLanes?e8(b,w,P):(te(Ur,Ur.current&1),b=ru(b,w,P),b!==null?b.sibling:null);te(Ur,Ur.current&1);break;case 19:if(R=(P&w.childLanes)!==0,b.flags&128){if(R)return n8(b,w,P);w.flags|=128}var k=w.memoizedState;if(k!==null&&(k.rendering=null,k.tail=null,k.lastEffect=null),te(Ur,Ur.current),R)break;return null;case 22:case 23:return w.lanes=0,K6(b,w,P)}return ru(b,w,P)}function ufe(b,w){switch(bR(w),w.tag){case 1:return cs(w.type)&&$h(),b=w.flags,b&65536?(w.flags=b&-65537|128,w):null;case 3:return x0(),$(Te),$(ne),TR(),b=w.flags,b&65536&&!(b&128)?(w.flags=b&-65537|128,w):null;case 5:return ER(w),null;case 13:if($(Ur),b=w.memoizedState,b!==null&&b.dehydrated!==null){if(w.alternate===null)throw Error(a(340));g0()}return b=w.flags,b&65536?(w.flags=b&-65537|128,w):null;case 19:return $(Ur),null;case 4:return x0(),null;case 10:return pR(w.type._context),null;case 22:case 23:return rI(),null;case 24:return null;default:return null}}var yA=!1,Hp=!1,dfe=typeof WeakSet=="function"?WeakSet:Set,Tt=null;function xA(b,w){var P=b.ref;if(P!==null)if(typeof P=="function")try{P(null)}catch(R){$a(b,w,R)}else P.current=null}function zR(b,w,P){try{P()}catch(R){$a(b,w,R)}}var s8=!1;function ffe(b,w){for(z(b.containerInfo),Tt=w;Tt!==null;)if(b=Tt,w=b.child,(b.subtreeFlags&1028)!==0&&w!==null)w.return=b,Tt=w;else for(;Tt!==null;){b=Tt;try{var P=b.alternate;if(b.flags&1024)switch(b.tag){case 0:case 11:case 15:break;case 1:if(P!==null){var R=P.memoizedProps,k=P.memoizedState,j=b.stateNode,ue=j.getSnapshotBeforeUpdate(b.elementType===b.type?R:Jl(b.type,R),k);j.__reactInternalSnapshotBeforeUpdate=ue}break;case 3:Ee&&Ue(b.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(Pe){$a(b,b.return,Pe)}if(w=b.sibling,w!==null){w.return=b.return,Tt=w;break}Tt=b.return}return P=s8,s8=!1,P}function jp(b,w,P){var R=w.updateQueue;if(R=R!==null?R.lastEffect:null,R!==null){var k=R=R.next;do{if((k.tag&b)===b){var j=k.destroy;k.destroy=void 0,j!==void 0&&zR(w,P,j)}k=k.next}while(k!==R)}}function wx(b,w){if(w=w.updateQueue,w=w!==null?w.lastEffect:null,w!==null){var P=w=w.next;do{if((P.tag&b)===b){var R=P.create;P.destroy=R()}P=P.next}while(P!==w)}}function GR(b){var w=b.ref;if(w!==null){var P=b.stateNode;switch(b.tag){case 5:b=q(P);break;default:b=P}typeof w=="function"?w(b):w.current=b}}function a8(b,w,P){if(Vc&&typeof Vc.onCommitFiberUnmount=="function")try{Vc.onCommitFiberUnmount(q_,w)}catch{}switch(w.tag){case 0:case 11:case 14:case 15:if(b=w.updateQueue,b!==null&&(b=b.lastEffect,b!==null)){var R=b=b.next;do{var k=R,j=k.destroy;k=k.tag,j!==void 0&&(k&2||k&4)&&zR(w,P,j),R=R.next}while(R!==b)}break;case 1:if(xA(w,P),b=w.stateNode,typeof b.componentWillUnmount=="function")try{b.props=w.memoizedProps,b.state=w.memoizedState,b.componentWillUnmount()}catch(ue){$a(w,P,ue)}break;case 5:xA(w,P);break;case 4:Ee?d8(b,w,P):fe&&fe&&(w=w.stateNode.containerInfo,P=Mt(w),ur(w,P))}}function o8(b,w,P){for(var R=w;;)if(a8(b,R,P),R.child===null||Ee&&R.tag===4){if(R===w)break;for(;R.sibling===null;){if(R.return===null||R.return===w)return;R=R.return}R.sibling.return=R.return,R=R.sibling}else R.child.return=R,R=R.child}function l8(b){var w=b.alternate;w!==null&&(b.alternate=null,l8(w)),b.child=null,b.deletions=null,b.sibling=null,b.tag===5&&(w=b.stateNode,w!==null&&Ke(w)),b.stateNode=null,b.return=null,b.dependencies=null,b.memoizedProps=null,b.memoizedState=null,b.pendingProps=null,b.stateNode=null,b.updateQueue=null}function c8(b){return b.tag===5||b.tag===3||b.tag===4}function h8(b){e:for(;;){for(;b.sibling===null;){if(b.return===null||c8(b.return))return null;b=b.return}for(b.sibling.return=b.return,b=b.sibling;b.tag!==5&&b.tag!==6&&b.tag!==18;){if(b.flags&2||b.child===null||b.tag===4)continue e;b.child.return=b,b=b.child}if(!(b.flags&2))return b.stateNode}}function u8(b){if(Ee){e:{for(var w=b.return;w!==null;){if(c8(w))break e;w=w.return}throw Error(a(160))}var P=w;switch(P.tag){case 5:w=P.stateNode,P.flags&32&&(Xe(w),P.flags&=-33),P=h8(b),HR(b,P,w);break;case 3:case 4:w=P.stateNode.containerInfo,P=h8(b),VR(b,P,w);break;default:throw Error(a(161))}}}function VR(b,w,P){var R=b.tag;if(R===5||R===6)b=b.stateNode,w?ot(P,b,w):Ne(P,b);else if(R!==4&&(b=b.child,b!==null))for(VR(b,w,P),b=b.sibling;b!==null;)VR(b,w,P),b=b.sibling}function HR(b,w,P){var R=b.tag;if(R===5||R===6)b=b.stateNode,w?Je(P,b,w):Ze(P,b);else if(R!==4&&(b=b.child,b!==null))for(HR(b,w,P),b=b.sibling;b!==null;)HR(b,w,P),b=b.sibling}function d8(b,w,P){for(var R=w,k=!1,j,ue;;){if(!k){k=R.return;e:for(;;){if(k===null)throw Error(a(160));switch(j=k.stateNode,k.tag){case 5:ue=!1;break e;case 3:j=j.containerInfo,ue=!0;break e;case 4:j=j.containerInfo,ue=!0;break e}k=k.return}k=!0}if(R.tag===5||R.tag===6)o8(b,R,P),ue?de(j,R.stateNode):nt(j,R.stateNode);else if(R.tag===18)ue?It(j,R.stateNode):_t(j,R.stateNode);else if(R.tag===4){if(R.child!==null){j=R.stateNode.containerInfo,ue=!0,R.child.return=R,R=R.child;continue}}else if(a8(b,R,P),R.child!==null){R.child.return=R,R=R.child;continue}if(R===w)break;for(;R.sibling===null;){if(R.return===null||R.return===w)return;R=R.return,R.tag===4&&(k=!1)}R.sibling.return=R.return,R=R.sibling}}function jR(b,w){if(Ee){switch(w.tag){case 0:case 11:case 14:case 15:jp(3,w,w.return),wx(3,w),jp(5,w,w.return);return;case 1:return;case 5:var P=w.stateNode;if(P!=null){var R=w.memoizedProps;b=b!==null?b.memoizedProps:R;var k=w.type,j=w.updateQueue;w.updateQueue=null,j!==null&&Qe(P,j,k,b,R,w)}return;case 6:if(w.stateNode===null)throw Error(a(162));P=w.memoizedProps,me(w.stateNode,b!==null?b.memoizedProps:P,P);return;case 3:pe&&b!==null&&b.memoizedState.isDehydrated&&Lt(w.stateNode.containerInfo);return;case 12:return;case 13:bA(w);return;case 19:bA(w);return;case 17:return}throw Error(a(163))}switch(w.tag){case 0:case 11:case 14:case 15:jp(3,w,w.return),wx(3,w),jp(5,w,w.return);return;case 12:return;case 13:bA(w);return;case 19:bA(w);return;case 3:pe&&b!==null&&b.memoizedState.isDehydrated&&Lt(w.stateNode.containerInfo);break;case 22:case 23:return}e:if(fe){switch(w.tag){case 1:case 5:case 6:break e;case 3:case 4:w=w.stateNode,ur(w.containerInfo,w.pendingChildren);break e}throw Error(a(163))}}function bA(b){var w=b.updateQueue;if(w!==null){b.updateQueue=null;var P=b.stateNode;P===null&&(P=b.stateNode=new dfe),w.forEach(function(R){var k=_fe.bind(null,b,R);P.has(R)||(P.add(R),R.then(k,k))})}}function pfe(b,w){for(Tt=w;Tt!==null;){w=Tt;var P=w.deletions;if(P!==null)for(var R=0;R<P.length;R++){var k=P[R];try{var j=b;Ee?d8(j,k,w):o8(j,k,w);var ue=k.alternate;ue!==null&&(ue.return=null),k.return=null}catch(Vt){$a(k,w,Vt)}}if(P=w.child,w.subtreeFlags&12854&&P!==null)P.return=w,Tt=P;else for(;Tt!==null;){w=Tt;try{var Pe=w.flags;if(Pe&32&&Ee&&Xe(w.stateNode),Pe&512){var qe=w.alternate;if(qe!==null){var vt=qe.ref;vt!==null&&(typeof vt=="function"?vt(null):vt.current=null)}}if(Pe&8192)switch(w.tag){case 13:if(w.memoizedState!==null){var kt=w.alternate;(kt===null||kt.memoizedState===null)&&($R=hs())}break;case 22:var gi=w.memoizedState!==null,Zt=w.alternate,dr=Zt!==null&&Zt.memoizedState!==null;if(P=w,Ee){e:if(R=P,k=gi,j=null,Ee)for(var Ht=R;;){if(Ht.tag===5){if(j===null){j=Ht;var ia=Ht.stateNode;k?mt(ia):he(Ht.stateNode,Ht.memoizedProps)}}else if(Ht.tag===6){if(j===null){var sl=Ht.stateNode;k?J(sl):Me(sl,Ht.memoizedProps)}}else if((Ht.tag!==22&&Ht.tag!==23||Ht.memoizedState===null||Ht===R)&&Ht.child!==null){Ht.child.return=Ht,Ht=Ht.child;continue}if(Ht===R)break;for(;Ht.sibling===null;){if(Ht.return===null||Ht.return===R)break e;j===Ht&&(j=null),Ht=Ht.return}j===Ht&&(j=null),Ht.sibling.return=Ht.return,Ht=Ht.sibling}}if(gi&&!dr&&P.mode&1){Tt=P;for(var ze=P.child;ze!==null;){for(P=Tt=ze;Tt!==null;){R=Tt;var De=R.child;switch(R.tag){case 0:case 11:case 14:case 15:jp(4,R,R.return);break;case 1:xA(R,R.return);var We=R.stateNode;if(typeof We.componentWillUnmount=="function"){var Dt=R.return;try{We.props=R.memoizedProps,We.state=R.memoizedState,We.componentWillUnmount()}catch(Vt){$a(R,Dt,Vt)}}break;case 5:xA(R,R.return);break;case 22:if(R.memoizedState!==null){m8(P);continue}}De!==null?(De.return=R,Tt=De):m8(P)}ze=ze.sibling}}}switch(Pe&4102){case 2:u8(w),w.flags&=-3;break;case 6:u8(w),w.flags&=-3,jR(w.alternate,w);break;case 4096:w.flags&=-4097;break;case 4100:w.flags&=-4097,jR(w.alternate,w);break;case 4:jR(w.alternate,w)}}catch(Vt){$a(w,w.return,Vt)}if(P=w.sibling,P!==null){P.return=w.return,Tt=P;break}Tt=w.return}}}function mfe(b,w,P){Tt=b,f8(b)}function f8(b,w,P){for(var R=(b.mode&1)!==0;Tt!==null;){var k=Tt,j=k.child;if(k.tag===22&&R){var ue=k.memoizedState!==null||yA;if(!ue){var Pe=k.alternate,qe=Pe!==null&&Pe.memoizedState!==null||Hp;Pe=yA;var vt=Hp;if(yA=ue,(Hp=qe)&&!vt)for(Tt=k;Tt!==null;)ue=Tt,qe=ue.child,ue.tag===22&&ue.memoizedState!==null?g8(k):qe!==null?(qe.return=ue,Tt=qe):g8(k);for(;j!==null;)Tt=j,f8(j),j=j.sibling;Tt=k,yA=Pe,Hp=vt}p8(b)}else k.subtreeFlags&8772&&j!==null?(j.return=k,Tt=j):p8(b)}}function p8(b){for(;Tt!==null;){var w=Tt;if(w.flags&8772){var P=w.alternate;try{if(w.flags&8772)switch(w.tag){case 0:case 11:case 15:Hp||wx(5,w);break;case 1:var R=w.stateNode;if(w.flags&4&&!Hp)if(P===null)R.componentDidMount();else{var k=w.elementType===w.type?P.memoizedProps:Jl(w.type,P.memoizedProps);R.componentDidUpdate(k,P.memoizedState,R.__reactInternalSnapshotBeforeUpdate)}var j=w.updateQueue;j!==null&&l6(w,j,R);break;case 3:var ue=w.updateQueue;if(ue!==null){if(P=null,w.child!==null)switch(w.child.tag){case 5:P=q(w.child.stateNode);break;case 1:P=w.child.stateNode}l6(w,ue,P)}break;case 5:var Pe=w.stateNode;P===null&&w.flags&4&&$e(Pe,w.type,w.memoizedProps,w);break;case 6:break;case 4:break;case 12:break;case 13:if(pe&&w.memoizedState===null){var qe=w.alternate;if(qe!==null){var vt=qe.memoizedState;if(vt!==null){var kt=vt.dehydrated;kt!==null&&wt(kt)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(a(163))}Hp||w.flags&512&&GR(w)}catch(gi){$a(w,w.return,gi)}}if(w===b){Tt=null;break}if(P=w.sibling,P!==null){P.return=w.return,Tt=P;break}Tt=w.return}}function m8(b){for(;Tt!==null;){var w=Tt;if(w===b){Tt=null;break}var P=w.sibling;if(P!==null){P.return=w.return,Tt=P;break}Tt=w.return}}function g8(b){for(;Tt!==null;){var w=Tt;try{switch(w.tag){case 0:case 11:case 15:var P=w.return;try{wx(4,w)}catch(qe){$a(w,P,qe)}break;case 1:var R=w.stateNode;if(typeof R.componentDidMount=="function"){var k=w.return;try{R.componentDidMount()}catch(qe){$a(w,k,qe)}}var j=w.return;try{GR(w)}catch(qe){$a(w,j,qe)}break;case 5:var ue=w.return;try{GR(w)}catch(qe){$a(w,ue,qe)}}}catch(qe){$a(w,w.return,qe)}if(w===b){Tt=null;break}var Pe=w.sibling;if(Pe!==null){Pe.return=w.return,Tt=Pe;break}Tt=w.return}}var wA=0,SA=1,_A=2,AA=3,EA=4;if(typeof Symbol=="function"&&Symbol.for){var Sx=Symbol.for;wA=Sx("selector.component"),SA=Sx("selector.has_pseudo_class"),_A=Sx("selector.role"),AA=Sx("selector.test_id"),EA=Sx("selector.text")}function WR(b){var w=Ie(b);if(w!=null){if(typeof w.memoizedProps["data-testname"]!="string")throw Error(a(364));return w}if(b=dt(b),b===null)throw Error(a(362));return b.stateNode.current}function XR(b,w){switch(w.$$typeof){case wA:if(b.type===w.value)return!0;break;case SA:e:{w=w.value,b=[b,0];for(var P=0;P<b.length;){var R=b[P++],k=b[P++],j=w[k];if(R.tag!==5||!oe(R)){for(;j!=null&&XR(R,j);)k++,j=w[k];if(k===w.length){w=!0;break e}else for(R=R.child;R!==null;)b.push(R,k),R=R.sibling}}w=!1}return w;case _A:if(b.tag===5&&Ce(b.stateNode,w.value))return!0;break;case EA:if((b.tag===5||b.tag===6)&&(b=F(b),b!==null&&0<=b.indexOf(w.value)))return!0;break;case AA:if(b.tag===5&&(b=b.memoizedProps["data-testname"],typeof b=="string"&&b.toLowerCase()===w.value.toLowerCase()))return!0;break;default:throw Error(a(365))}return!1}function YR(b){switch(b.$$typeof){case wA:return"<"+(M(b.value)||"Unknown")+">";case SA:return":has("+(YR(b)||"")+")";case _A:return'[role="'+b.value+'"]';case EA:return'"'+b.value+'"';case AA:return'[data-testname="'+b.value+'"]';default:throw Error(a(365))}}function v8(b,w){var P=[];b=[b,0];for(var R=0;R<b.length;){var k=b[R++],j=b[R++],ue=w[j];if(k.tag!==5||!oe(k)){for(;ue!=null&&XR(k,ue);)j++,ue=w[j];if(j===w.length)P.push(k);else for(k=k.child;k!==null;)b.push(k,j),k=k.sibling}}return P}function qR(b,w){if(!ut)throw Error(a(363));b=WR(b),b=v8(b,w),w=[],b=Array.from(b);for(var P=0;P<b.length;){var R=b[P++];if(R.tag===5)oe(R)||w.push(R.stateNode);else for(R=R.child;R!==null;)b.push(R),R=R.sibling}return w}var gfe=Math.ceil,MA=o.ReactCurrentDispatcher,KR=o.ReactCurrentOwner,un=o.ReactCurrentBatchConfig,_i=0,Mn=null,Tn=null,Bs=0,To=0,w0=Nr(0),Hn=0,_x=null,S0=0,TA=0,QR=0,Ax=null,Ka=null,$R=0,JR=1/0;function _0(){JR=hs()+500}var CA=!1,ZR=null,Od=null,PA=!1,Bd=null,DA=0,Ex=0,eI=null,RA=-1,IA=0;function Aa(){return _i&6?hs():RA!==-1?RA:RA=hs()}function Fd(b){return b.mode&1?_i&2&&Bs!==0?Bs&-Bs:Jde.transition!==null?(IA===0&&(b=W_,W_<<=1,!(W_&4194240)&&(W_=64),IA=b),IA):(b=Vi,b!==0?b:Ge()):1}function rl(b,w,P){if(50<Ex)throw Ex=0,eI=null,Error(a(185));var R=LA(b,w);return R===null?null:(lx(R,w,P),(!(_i&2)||R!==Mn)&&(R===Mn&&(!(_i&2)&&(TA|=w),Hn===4&&kd(R,Bs)),Qa(R,P),w===1&&_i===0&&!(b.mode&1)&&(_0(),K_&&jc())),R)}function LA(b,w){b.lanes|=w;var P=b.alternate;for(P!==null&&(P.lanes|=w),P=b,b=b.return;b!==null;)b.childLanes|=w,P=b.alternate,P!==null&&(P.childLanes|=w),P=b,b=b.return;return P.tag===3?P.stateNode:null}function Qa(b,w){var P=b.callbackNode;Hde(b,w);var R=Y_(b,b===Mn?Bs:0);if(R===0)P!==null&&r6(P),b.callbackNode=null,b.callbackPriority=0;else if(w=R&-R,b.callbackPriority!==w){if(P!=null&&r6(P),w===1)b.tag===0?$de(x8.bind(null,b)):n6(x8.bind(null,b)),Ve?ke(function(){_i===0&&jc()}):lR(cR,jc),P=null;else{switch(i6(R)){case 1:P=cR;break;case 4:P=Yde;break;case 16:P=hR;break;case 536870912:P=qde;break;default:P=hR}P=C8(P,y8.bind(null,b))}b.callbackPriority=w,b.callbackNode=P}}function y8(b,w){if(RA=-1,IA=0,_i&6)throw Error(a(327));var P=b.callbackNode;if(Yp()&&b.callbackNode!==P)return null;var R=Y_(b,b===Mn?Bs:0);if(R===0)return null;if(R&30||R&b.expiredLanes||w)w=OA(b,R);else{w=R;var k=_i;_i|=2;var j=S8();(Mn!==b||Bs!==w)&&(_0(),Wp(b,w));do try{xfe();break}catch(Pe){w8(b,Pe)}while(!0);fR(),MA.current=j,_i=k,Tn!==null?w=0:(Mn=null,Bs=0,w=Hn)}if(w!==0){if(w===2&&(k=sR(b),k!==0&&(R=k,w=tI(b,k))),w===1)throw P=_x,Wp(b,0),kd(b,R),Qa(b,hs()),P;if(w===6)kd(b,R);else{if(k=b.current.alternate,!(R&30)&&!vfe(k)&&(w=OA(b,R),w===2&&(j=sR(b),j!==0&&(R=j,w=tI(b,j))),w===1))throw P=_x,Wp(b,0),kd(b,R),Qa(b,hs()),P;switch(b.finishedWork=k,b.finishedLanes=R,w){case 0:case 1:throw Error(a(345));case 2:Xp(b,Ka);break;case 3:if(kd(b,R),(R&130023424)===R&&(w=$R+500-hs(),10<w)){if(Y_(b,0)!==0)break;if(k=b.suspendedLanes,(k&R)!==R){Aa(),b.pingedLanes|=b.suspendedLanes&k;break}b.timeoutHandle=Ae(Xp.bind(null,b,Ka),w);break}Xp(b,Ka);break;case 4:if(kd(b,R),(R&4194240)===R)break;for(w=b.eventTimes,k=-1;0<R;){var ue=31-$l(R);j=1<<ue,ue=w[ue],ue>k&&(k=ue),R&=~j}if(R=k,R=hs()-R,R=(120>R?120:480>R?480:1080>R?1080:1920>R?1920:3e3>R?3e3:4320>R?4320:1960*gfe(R/1960))-R,10<R){b.timeoutHandle=Ae(Xp.bind(null,b,Ka),R);break}Xp(b,Ka);break;case 5:Xp(b,Ka);break;default:throw Error(a(329))}}}return Qa(b,hs()),b.callbackNode===P?y8.bind(null,b):null}function tI(b,w){var P=Ax;return b.current.memoizedState.isDehydrated&&(Wp(b,w).flags|=256),b=OA(b,w),b!==2&&(w=Ka,Ka=P,w!==null&&iI(w)),b}function iI(b){Ka===null?Ka=b:Ka.push.apply(Ka,b)}function vfe(b){for(var w=b;;){if(w.flags&16384){var P=w.updateQueue;if(P!==null&&(P=P.stores,P!==null))for(var R=0;R<P.length;R++){var k=P[R],j=k.getSnapshot;k=k.value;try{if(!Hc(j(),k))return!1}catch{return!1}}}if(P=w.child,w.subtreeFlags&16384&&P!==null)P.return=w,w=P;else{if(w===b)break;for(;w.sibling===null;){if(w.return===null||w.return===b)return!0;w=w.return}w.sibling.return=w.return,w=w.sibling}}return!0}function kd(b,w){for(w&=~QR,w&=~TA,b.suspendedLanes|=w,b.pingedLanes&=~w,b=b.expirationTimes;0<w;){var P=31-$l(w),R=1<<P;b[P]=-1,w&=~R}}function x8(b){if(_i&6)throw Error(a(327));Yp();var w=Y_(b,0);if(!(w&1))return Qa(b,hs()),null;var P=OA(b,w);if(b.tag!==0&&P===2){var R=sR(b);R!==0&&(w=R,P=tI(b,R))}if(P===1)throw P=_x,Wp(b,0),kd(b,w),Qa(b,hs()),P;if(P===6)throw Error(a(345));return b.finishedWork=b.current.alternate,b.finishedLanes=w,Xp(b,Ka),Qa(b,hs()),null}function b8(b){Bd!==null&&Bd.tag===0&&!(_i&6)&&Yp();var w=_i;_i|=1;var P=un.transition,R=Vi;try{if(un.transition=null,Vi=1,b)return b()}finally{Vi=R,un.transition=P,_i=w,!(_i&6)&&jc()}}function rI(){To=w0.current,$(w0)}function Wp(b,w){b.finishedWork=null,b.finishedLanes=0;var P=b.timeoutHandle;if(P!==_e&&(b.timeoutHandle=_e,Se(P)),Tn!==null)for(P=Tn.return;P!==null;){var R=P;switch(bR(R),R.tag){case 1:R=R.type.childContextTypes,R!=null&&$h();break;case 3:x0(),$(Te),$(ne),TR();break;case 5:ER(R);break;case 4:x0();break;case 13:$(Ur);break;case 19:$(Ur);break;case 10:pR(R.type._context);break;case 22:case 23:rI()}P=P.return}if(Mn=b,Tn=b=Nd(b.current,null),Bs=To=w,Hn=0,_x=null,QR=TA=S0=0,Ka=Ax=null,Wc!==null){for(w=0;w<Wc.length;w++)if(P=Wc[w],R=P.interleaved,R!==null){P.interleaved=null;var k=R.next,j=P.pending;if(j!==null){var ue=j.next;j.next=k,R.next=ue}P.pending=R}Wc=null}return b}function w8(b,w){do{var P=Tn;try{if(fR(),aA.current=dA,oA){for(var R=Jr.memoizedState;R!==null;){var k=R.queue;k!==null&&(k.pending=null),R=R.next}oA=!1}if(b0=0,us=Zs=Jr=null,px=!1,mx=0,KR.current=null,P===null||P.return===null){Hn=1,_x=w,Tn=null;break}e:{var j=b,ue=P.return,Pe=P,qe=w;if(w=Bs,Pe.flags|=32768,qe!==null&&typeof qe=="object"&&typeof qe.then=="function"){var vt=qe,kt=Pe,gi=kt.tag;if(!(kt.mode&1)&&(gi===0||gi===11||gi===15)){var Zt=kt.alternate;Zt?(kt.updateQueue=Zt.updateQueue,kt.memoizedState=Zt.memoizedState,kt.lanes=Zt.lanes):(kt.updateQueue=null,kt.memoizedState=null)}var dr=V6(ue);if(dr!==null){dr.flags&=-257,H6(dr,ue,Pe,j,w),dr.mode&1&&G6(j,vt,w),w=dr,qe=vt;var Ht=w.updateQueue;if(Ht===null){var ia=new Set;ia.add(qe),w.updateQueue=ia}else Ht.add(qe);break e}else{if(!(w&1)){G6(j,vt,w),nI();break e}qe=Error(a(426))}}else if(Rr&&Pe.mode&1){var sl=V6(ue);if(sl!==null){!(sl.flags&65536)&&(sl.flags|=256),H6(sl,ue,Pe,j,w),_R(qe);break e}}j=qe,Hn!==4&&(Hn=2),Ax===null?Ax=[j]:Ax.push(j),qe=OR(qe,Pe),Pe=ue;do{switch(Pe.tag){case 3:Pe.flags|=65536,w&=-w,Pe.lanes|=w;var ze=U6(Pe,qe,w);o6(Pe,ze);break e;case 1:j=qe;var De=Pe.type,We=Pe.stateNode;if(!(Pe.flags&128)&&(typeof De.getDerivedStateFromError=="function"||We!==null&&typeof We.componentDidCatch=="function"&&(Od===null||!Od.has(We)))){Pe.flags|=65536,w&=-w,Pe.lanes|=w;var Dt=z6(Pe,j,w);o6(Pe,Dt);break e}}Pe=Pe.return}while(Pe!==null)}A8(P)}catch(Vt){w=Vt,Tn===P&&P!==null&&(Tn=P=P.return);continue}break}while(!0)}function S8(){var b=MA.current;return MA.current=dA,b===null?dA:b}function nI(){(Hn===0||Hn===3||Hn===2)&&(Hn=4),Mn===null||!(S0&268435455)&&!(TA&268435455)||kd(Mn,Bs)}function OA(b,w){var P=_i;_i|=2;var R=S8();Mn===b&&Bs===w||Wp(b,w);do try{yfe();break}catch(k){w8(b,k)}while(!0);if(fR(),_i=P,MA.current=R,Tn!==null)throw Error(a(261));return Mn=null,Bs=0,Hn}function yfe(){for(;Tn!==null;)_8(Tn)}function xfe(){for(;Tn!==null&&!Wde();)_8(Tn)}function _8(b){var w=T8(b.alternate,b,To);b.memoizedProps=b.pendingProps,w===null?A8(b):Tn=w,KR.current=null}function A8(b){var w=b;do{var P=w.alternate;if(b=w.return,w.flags&32768){if(P=ufe(P,w),P!==null){P.flags&=32767,Tn=P;return}if(b!==null)b.flags|=32768,b.subtreeFlags=0,b.deletions=null;else{Hn=6,Tn=null;return}}else if(P=lfe(P,w,To),P!==null){Tn=P;return}if(w=w.sibling,w!==null){Tn=w;return}Tn=w=b}while(w!==null);Hn===0&&(Hn=5)}function Xp(b,w){var P=Vi,R=un.transition;try{un.transition=null,Vi=1,bfe(b,w,P)}finally{un.transition=R,Vi=P}return null}function bfe(b,w,P){do Yp();while(Bd!==null);if(_i&6)throw Error(a(327));var R=b.finishedWork,k=b.finishedLanes;if(R===null)return null;if(b.finishedWork=null,b.finishedLanes=0,R===b.current)throw Error(a(177));b.callbackNode=null,b.callbackPriority=0;var j=R.lanes|R.childLanes;if(jde(b,j),b===Mn&&(Tn=Mn=null,Bs=0),!(R.subtreeFlags&2064)&&!(R.flags&2064)||PA||(PA=!0,C8(hR,function(){return Yp(),null})),j=(R.flags&15990)!==0,R.subtreeFlags&15990||j){j=un.transition,un.transition=null;var ue=Vi;Vi=1;var Pe=_i;_i|=4,KR.current=null,ffe(b,R),pfe(b,R),U(b.containerInfo),b.current=R,mfe(R),Xde(),_i=Pe,Vi=ue,un.transition=j}else b.current=R;if(PA&&(PA=!1,Bd=b,DA=k),j=b.pendingLanes,j===0&&(Od=null),Kde(R.stateNode),Qa(b,hs()),w!==null)for(P=b.onRecoverableError,R=0;R<w.length;R++)P(w[R]);if(CA)throw CA=!1,b=ZR,ZR=null,b;return DA&1&&b.tag!==0&&Yp(),j=b.pendingLanes,j&1?b===eI?Ex++:(Ex=0,eI=b):Ex=0,jc(),null}function Yp(){if(Bd!==null){var b=i6(DA),w=un.transition,P=Vi;try{if(un.transition=null,Vi=16>b?16:b,Bd===null)var R=!1;else{if(b=Bd,Bd=null,DA=0,_i&6)throw Error(a(331));var k=_i;for(_i|=4,Tt=b.current;Tt!==null;){var j=Tt,ue=j.child;if(Tt.flags&16){var Pe=j.deletions;if(Pe!==null){for(var qe=0;qe<Pe.length;qe++){var vt=Pe[qe];for(Tt=vt;Tt!==null;){var kt=Tt;switch(kt.tag){case 0:case 11:case 15:jp(8,kt,j)}var gi=kt.child;if(gi!==null)gi.return=kt,Tt=gi;else for(;Tt!==null;){kt=Tt;var Zt=kt.sibling,dr=kt.return;if(l8(kt),kt===vt){Tt=null;break}if(Zt!==null){Zt.return=dr,Tt=Zt;break}Tt=dr}}}var Ht=j.alternate;if(Ht!==null){var ia=Ht.child;if(ia!==null){Ht.child=null;do{var sl=ia.sibling;ia.sibling=null,ia=sl}while(ia!==null)}}Tt=j}}if(j.subtreeFlags&2064&&ue!==null)ue.return=j,Tt=ue;else e:for(;Tt!==null;){if(j=Tt,j.flags&2048)switch(j.tag){case 0:case 11:case 15:jp(9,j,j.return)}var ze=j.sibling;if(ze!==null){ze.return=j.return,Tt=ze;break e}Tt=j.return}}var De=b.current;for(Tt=De;Tt!==null;){ue=Tt;var We=ue.child;if(ue.subtreeFlags&2064&&We!==null)We.return=ue,Tt=We;else e:for(ue=De;Tt!==null;){if(Pe=Tt,Pe.flags&2048)try{switch(Pe.tag){case 0:case 11:case 15:wx(9,Pe)}}catch(Vt){$a(Pe,Pe.return,Vt)}if(Pe===ue){Tt=null;break e}var Dt=Pe.sibling;if(Dt!==null){Dt.return=Pe.return,Tt=Dt;break e}Tt=Pe.return}}if(_i=k,jc(),Vc&&typeof Vc.onPostCommitFiberRoot=="function")try{Vc.onPostCommitFiberRoot(q_,b)}catch{}R=!0}return R}finally{Vi=P,un.transition=w}}return!1}function E8(b,w,P){w=OR(P,w),w=U6(b,w,1),Ld(b,w),w=Aa(),b=LA(b,1),b!==null&&(lx(b,1,w),Qa(b,w))}function $a(b,w,P){if(b.tag===3)E8(b,b,P);else for(;w!==null;){if(w.tag===3){E8(w,b,P);break}else if(w.tag===1){var R=w.stateNode;if(typeof w.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&(Od===null||!Od.has(R))){b=OR(P,b),b=z6(w,b,1),Ld(w,b),b=Aa(),w=LA(w,1),w!==null&&(lx(w,1,b),Qa(w,b));break}}w=w.return}}function wfe(b,w,P){var R=b.pingCache;R!==null&&R.delete(w),w=Aa(),b.pingedLanes|=b.suspendedLanes&P,Mn===b&&(Bs&P)===P&&(Hn===4||Hn===3&&(Bs&130023424)===Bs&&500>hs()-$R?Wp(b,0):QR|=P),Qa(b,w)}function M8(b,w){w===0&&(b.mode&1?(w=X_,X_<<=1,!(X_&130023424)&&(X_=4194304)):w=1);var P=Aa();b=LA(b,w),b!==null&&(lx(b,w,P),Qa(b,P))}function Sfe(b){var w=b.memoizedState,P=0;w!==null&&(P=w.retryLane),M8(b,P)}function _fe(b,w){var P=0;switch(b.tag){case 13:var R=b.stateNode,k=b.memoizedState;k!==null&&(P=k.retryLane);break;case 19:R=b.stateNode;break;default:throw Error(a(314))}R!==null&&R.delete(w),M8(b,P)}var T8;T8=function(b,w,P){if(b!==null)if(b.memoizedProps!==w.pendingProps||Te.current)Mo=!0;else{if(!(b.lanes&P)&&!(w.flags&128))return Mo=!1,hfe(b,w,P);Mo=!!(b.flags&131072)}else Mo=!1,Rr&&w.flags&1048576&&f6(w,rA,w.index);switch(w.lanes=0,w.tag){case 2:var R=w.type;b!==null&&(b.alternate=null,w.alternate=null,w.flags|=2),b=w.pendingProps;var k=Vn(w,ne.current);f0(w,P),k=PR(null,w,R,b,k,P);var j=DR();return w.flags|=1,typeof k=="object"&&k!==null&&typeof k.render=="function"&&k.$$typeof===void 0?(w.tag=1,w.memoizedState=null,w.updateQueue=null,cs(R)?(j=!0,Rd(w)):j=!1,w.memoizedState=k.state!==null&&k.state!==void 0?k.state:null,gR(w),k.updater=tA,w.stateNode=k,k._reactInternals=w,yR(w,R,b,P),w=kR(null,w,R,!0,j,P)):(w.tag=0,Rr&&j&&xR(w),_a(null,w,k,P),w=w.child),w;case 16:R=w.elementType;e:{switch(b!==null&&(b.alternate=null,w.alternate=null,w.flags|=2),b=w.pendingProps,k=R._init,R=k(R._payload),w.type=R,k=w.tag=Efe(R),b=Jl(R,b),k){case 0:w=FR(null,w,R,b,P);break e;case 1:w=$6(null,w,R,b,P);break e;case 11:w=X6(null,w,R,b,P);break e;case 14:w=Y6(null,w,R,Jl(R.type,b),P);break e}throw Error(a(306,R,""))}return w;case 0:return R=w.type,k=w.pendingProps,k=w.elementType===R?k:Jl(R,k),FR(b,w,R,k,P);case 1:return R=w.type,k=w.pendingProps,k=w.elementType===R?k:Jl(R,k),$6(b,w,R,k,P);case 3:e:{if(J6(w),b===null)throw Error(a(387));R=w.pendingProps,j=w.memoizedState,k=j.element,a6(b,w),eA(w,R,null,P);var ue=w.memoizedState;if(R=ue.element,pe&&j.isDehydrated)if(j={element:R,isDehydrated:!1,cache:ue.cache,transitions:ue.transitions},w.updateQueue.baseState=j,w.memoizedState=j,w.flags&256){k=Error(a(423)),w=Z6(b,w,R,P,k);break e}else if(R!==k){k=Error(a(424)),w=Z6(b,w,R,P,k);break e}else for(pe&&(Eo=se(w.stateNode.containerInfo),Ao=w,Rr=!0,Zl=null,cx=!1),P=x6(w,null,R,P),w.child=P;P;)P.flags=P.flags&-3|4096,P=P.sibling;else{if(g0(),R===k){w=ru(b,w,P);break e}_a(b,w,R,P)}w=w.child}return w;case 5:return b6(w),b===null&&SR(w),R=w.type,k=w.pendingProps,j=b!==null?b.memoizedProps:null,ue=k.children,ce(R,k)?ue=null:j!==null&&ce(R,j)&&(w.flags|=32),Q6(b,w),_a(b,w,ue,P),w.child;case 6:return b===null&&SR(w),null;case 13:return e8(b,w,P);case 4:return AR(w,w.stateNode.containerInfo),R=w.pendingProps,b===null?w.child=v0(w,null,R,P):_a(b,w,R,P),w.child;case 11:return R=w.type,k=w.pendingProps,k=w.elementType===R?k:Jl(R,k),X6(b,w,R,k,P);case 7:return _a(b,w,w.pendingProps,P),w.child;case 8:return _a(b,w,w.pendingProps.children,P),w.child;case 12:return _a(b,w,w.pendingProps.children,P),w.child;case 10:e:{if(R=w.type._context,k=w.pendingProps,j=w.memoizedProps,ue=k.value,s6(w,R,ue),j!==null)if(Hc(j.value,ue)){if(j.children===k.children&&!Te.current){w=ru(b,w,P);break e}}else for(j=w.child,j!==null&&(j.return=w);j!==null;){var Pe=j.dependencies;if(Pe!==null){ue=j.child;for(var qe=Pe.firstContext;qe!==null;){if(qe.context===R){if(j.tag===1){qe=Zh(-1,P&-P),qe.tag=2;var vt=j.updateQueue;if(vt!==null){vt=vt.shared;var kt=vt.pending;kt===null?qe.next=qe:(qe.next=kt.next,kt.next=qe),vt.pending=qe}}j.lanes|=P,qe=j.alternate,qe!==null&&(qe.lanes|=P),mR(j.return,P,w),Pe.lanes|=P;break}qe=qe.next}}else if(j.tag===10)ue=j.type===w.type?null:j.child;else if(j.tag===18){if(ue=j.return,ue===null)throw Error(a(341));ue.lanes|=P,Pe=ue.alternate,Pe!==null&&(Pe.lanes|=P),mR(ue,P,w),ue=j.sibling}else ue=j.child;if(ue!==null)ue.return=j;else for(ue=j;ue!==null;){if(ue===w){ue=null;break}if(j=ue.sibling,j!==null){j.return=ue.return,ue=j;break}ue=ue.return}j=ue}_a(b,w,k.children,P),w=w.child}return w;case 9:return k=w.type,R=w.pendingProps.children,f0(w,P),k=Jo(k),R=R(k),w.flags|=1,_a(b,w,R,P),w.child;case 14:return R=w.type,k=Jl(R,w.pendingProps),k=Jl(R.type,k),Y6(b,w,R,k,P);case 15:return q6(b,w,w.type,w.pendingProps,P);case 17:return R=w.type,k=w.pendingProps,k=w.elementType===R?k:Jl(R,k),b!==null&&(b.alternate=null,w.alternate=null,w.flags|=2),w.tag=1,cs(R)?(b=!0,Rd(w)):b=!1,f0(w,P),u6(w,R,k),yR(w,R,k,P),kR(null,w,R,!0,b,P);case 19:return n8(b,w,P);case 22:return K6(b,w,P)}throw Error(a(156,w.tag))};function C8(b,w){return lR(b,w)}function Afe(b,w,P,R){this.tag=b,this.key=P,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=w,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function nl(b,w,P,R){return new Afe(b,w,P,R)}function sI(b){return b=b.prototype,!(!b||!b.isReactComponent)}function Efe(b){if(typeof b=="function")return sI(b)?1:0;if(b!=null){if(b=b.$$typeof,b===m)return 11;if(b===y)return 14}return 2}function Nd(b,w){var P=b.alternate;return P===null?(P=nl(b.tag,w,b.key,b.mode),P.elementType=b.elementType,P.type=b.type,P.stateNode=b.stateNode,P.alternate=b,b.alternate=P):(P.pendingProps=w,P.type=b.type,P.flags=0,P.subtreeFlags=0,P.deletions=null),P.flags=b.flags&14680064,P.childLanes=b.childLanes,P.lanes=b.lanes,P.child=b.child,P.memoizedProps=b.memoizedProps,P.memoizedState=b.memoizedState,P.updateQueue=b.updateQueue,w=b.dependencies,P.dependencies=w===null?null:{lanes:w.lanes,firstContext:w.firstContext},P.sibling=b.sibling,P.index=b.index,P.ref=b.ref,P}function BA(b,w,P,R,k,j){var ue=2;if(R=b,typeof b=="function")sI(b)&&(ue=1);else if(typeof b=="string")ue=5;else e:switch(b){case h:return qp(P.children,k,j,w);case u:ue=8,k|=8;break;case d:return b=nl(12,P,w,k|2),b.elementType=d,b.lanes=j,b;case g:return b=nl(13,P,w,k),b.elementType=g,b.lanes=j,b;case v:return b=nl(19,P,w,k),b.elementType=v,b.lanes=j,b;case S:return FA(P,k,j,w);default:if(typeof b=="object"&&b!==null)switch(b.$$typeof){case f:ue=10;break e;case p:ue=9;break e;case m:ue=11;break e;case y:ue=14;break e;case x:ue=16,R=null;break e}throw Error(a(130,b==null?b:typeof b,""))}return w=nl(ue,P,w,k),w.elementType=b,w.type=R,w.lanes=j,w}function qp(b,w,P,R){return b=nl(7,b,R,w),b.lanes=P,b}function FA(b,w,P,R){return b=nl(22,b,R,w),b.elementType=S,b.lanes=P,b.stateNode={},b}function aI(b,w,P){return b=nl(6,b,null,w),b.lanes=P,b}function oI(b,w,P){return w=nl(4,b.children!==null?b.children:[],b.key,w),w.lanes=P,w.stateNode={containerInfo:b.containerInfo,pendingChildren:null,implementation:b.implementation},w}function Mfe(b,w,P,R,k){this.tag=w,this.containerInfo=b,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=_e,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=aR(0),this.expirationTimes=aR(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=aR(0),this.identifierPrefix=R,this.onRecoverableError=k,pe&&(this.mutableSourceEagerHydrationData=null)}function P8(b,w,P,R,k,j,ue,Pe,qe){return b=new Mfe(b,w,P,Pe,qe),w===1?(w=1,j===!0&&(w|=8)):w=0,j=nl(3,null,null,w),b.current=j,j.stateNode=b,j.memoizedState={element:R,isDehydrated:P,cache:null,transitions:null},gR(j),b}function D8(b){if(!b)return be;b=b._reactInternals;e:{if(T(b)!==b||b.tag!==1)throw Error(a(170));var w=b;do{switch(w.tag){case 3:w=w.stateNode.context;break e;case 1:if(cs(w.type)){w=w.stateNode.__reactInternalMemoizedMergedChildContext;break e}}w=w.return}while(w!==null);throw Error(a(171))}if(b.tag===1){var P=b.type;if(cs(P))return Up(b,P,w)}return w}function R8(b){var w=b._reactInternals;if(w===void 0)throw typeof b.render=="function"?Error(a(188)):(b=Object.keys(b).join(","),Error(a(268,b)));return b=B(w),b===null?null:b.stateNode}function I8(b,w){if(b=b.memoizedState,b!==null&&b.dehydrated!==null){var P=b.retryLane;b.retryLane=P!==0&&P<w?P:w}}function lI(b,w){I8(b,w),(b=b.alternate)&&I8(b,w)}function Tfe(b){return b=B(b),b===null?null:b.stateNode}function Cfe(){return null}return i.attemptContinuousHydration=function(b){if(b.tag===13){var w=Aa();rl(b,134217728,w),lI(b,134217728)}},i.attemptHydrationAtCurrentPriority=function(b){if(b.tag===13){var w=Aa(),P=Fd(b);rl(b,P,w),lI(b,P)}},i.attemptSynchronousHydration=function(b){switch(b.tag){case 3:var w=b.stateNode;if(w.current.memoizedState.isDehydrated){var P=ox(w.pendingLanes);P!==0&&(oR(w,P|1),Qa(w,hs()),!(_i&6)&&(_0(),jc()))}break;case 13:var R=Aa();b8(function(){return rl(b,1,R)}),lI(b,1)}},i.batchedUpdates=function(b,w){var P=_i;_i|=1;try{return b(w)}finally{_i=P,_i===0&&(_0(),K_&&jc())}},i.createComponentSelector=function(b){return{$$typeof:wA,value:b}},i.createContainer=function(b,w,P,R,k,j,ue){return P8(b,w,!1,null,P,R,k,j,ue)},i.createHasPseudoClassSelector=function(b){return{$$typeof:SA,value:b}},i.createHydrationContainer=function(b,w,P,R,k,j,ue,Pe,qe){return b=P8(P,R,!0,b,k,j,ue,Pe,qe),b.context=D8(null),P=b.current,R=Aa(),k=Fd(P),j=Zh(R,k),j.callback=w??null,Ld(P,j),b.current.lanes=k,lx(b,k,R),Qa(b,R),b},i.createPortal=function(b,w,P){var R=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:R==null?null:""+R,children:b,containerInfo:w,implementation:P}},i.createRoleSelector=function(b){return{$$typeof:_A,value:b}},i.createTestNameSelector=function(b){return{$$typeof:AA,value:b}},i.createTextSelector=function(b){return{$$typeof:EA,value:b}},i.deferredUpdates=function(b){var w=Vi,P=un.transition;try{return un.transition=null,Vi=16,b()}finally{Vi=w,un.transition=P}},i.discreteUpdates=function(b,w,P,R,k){var j=Vi,ue=un.transition;try{return un.transition=null,Vi=1,b(w,P,R,k)}finally{Vi=j,un.transition=ue,_i===0&&_0()}},i.findAllNodes=qR,i.findBoundingRects=function(b,w){if(!ut)throw Error(a(363));w=qR(b,w),b=[];for(var P=0;P<w.length;P++)b.push(V(w[P]));for(w=b.length-1;0<w;w--){P=b[w];for(var R=P.x,k=R+P.width,j=P.y,ue=j+P.height,Pe=w-1;0<=Pe;Pe--)if(w!==Pe){var qe=b[Pe],vt=qe.x,kt=vt+qe.width,gi=qe.y,Zt=gi+qe.height;if(R>=vt&&j>=gi&&k<=kt&&ue<=Zt){b.splice(w,1);break}else if(R!==vt||P.width!==qe.width||Zt<j||gi>ue){if(!(j!==gi||P.height!==qe.height||kt<R||vt>k)){vt>R&&(qe.width+=vt-R,qe.x=R),kt<k&&(qe.width=k-vt),b.splice(w,1);break}}else{gi>j&&(qe.height+=gi-j,qe.y=j),Zt<ue&&(qe.height=ue-gi),b.splice(w,1);break}}}return b},i.findHostInstance=R8,i.findHostInstanceWithNoPortals=function(b){return b=D(b),b=b!==null?L(b):null,b===null?null:b.stateNode},i.findHostInstanceWithWarning=function(b){return R8(b)},i.flushControlled=function(b){var w=_i;_i|=1;var P=un.transition,R=Vi;try{un.transition=null,Vi=1,b()}finally{Vi=R,un.transition=P,_i=w,_i===0&&(_0(),jc())}},i.flushPassiveEffects=Yp,i.flushSync=b8,i.focusWithin=function(b,w){if(!ut)throw Error(a(363));for(b=WR(b),w=v8(b,w),w=Array.from(w),b=0;b<w.length;){var P=w[b++];if(!oe(P)){if(P.tag===5&&K(P.stateNode))return!0;for(P=P.child;P!==null;)w.push(P),P=P.sibling}}return!1},i.getCurrentUpdatePriority=function(){return Vi},i.getFindAllNodesFailureDescription=function(b,w){if(!ut)throw Error(a(363));var P=0,R=[];b=[WR(b),0];for(var k=0;k<b.length;){var j=b[k++],ue=b[k++],Pe=w[ue];if((j.tag!==5||!oe(j))&&(XR(j,Pe)&&(R.push(YR(Pe)),ue++,ue>P&&(P=ue)),ue<w.length))for(j=j.child;j!==null;)b.push(j,ue),j=j.sibling}if(P<w.length){for(b=[];P<w.length;P++)b.push(YR(w[P]));return`findAllNodes was able to match part of the selector:
  `+(R.join(" > ")+`

No matching component was found for:
  `)+b.join(" > ")}return null},i.getPublicRootInstance=function(b){if(b=b.current,!b.child)return null;switch(b.child.tag){case 5:return q(b.child.stateNode);default:return b.child.stateNode}},i.injectIntoDevTools=function(b){if(b={bundleType:b.bundleType,version:b.version,rendererPackageName:b.rendererPackageName,rendererConfig:b.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:Tfe,findFiberByHostInstance:b.findFiberByHostInstance||Cfe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")b=!1;else{var w=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(w.isDisabled||!w.supportsFiber)b=!0;else{try{q_=w.inject(b),Vc=w}catch{}b=!!w.checkDCE}}return b},i.isAlreadyRendering=function(){return!1},i.observeVisibleRects=function(b,w,P,R){if(!ut)throw Error(a(363));b=qR(b,w);var k=Re(b,P,R).disconnect;return{disconnect:function(){k()}}},i.registerMutableSourceForHydration=function(b,w){var P=w._getVersion;P=P(w._source),b.mutableSourceEagerHydrationData==null?b.mutableSourceEagerHydrationData=[w,P]:b.mutableSourceEagerHydrationData.push(w,P)},i.runWithPriority=function(b,w){var P=Vi;try{return Vi=b,w()}finally{Vi=P}},i.shouldError=function(){return null},i.shouldSuspend=function(){return!1},i.updateContainer=function(b,w,P,R){var k=w.current,j=Aa(),ue=Fd(k);return P=D8(P),w.context===null?w.context=P:w.pendingContext=P,w=Zh(j,ue),w.payload={element:b},R=R===void 0?null:R,R!==null&&(w.callback=R),Ld(k,w),b=rl(k,ue,j),b!==null&&Z_(b,k,ue),ue},i};dre.exports=WSe;var XSe=dre.exports;const YSe=C1(XSe);var fre={exports:{}},pre={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(I,z){var U=I.length;I.push(z);e:for(;0<U;){var X=U-1>>>1,Q=I[X];if(0<n(Q,z))I[X]=z,I[U]=Q,U=X;else break e}}function i(I){return I.length===0?null:I[0]}function r(I){if(I.length===0)return null;var z=I[0],U=I.pop();if(U!==z){I[0]=U;e:for(var X=0,Q=I.length,re=Q>>>1;X<re;){var ie=2*(X+1)-1,ce=I[ie],Z=ie+1,Ae=I[Z];if(0>n(ce,U))Z<Q&&0>n(Ae,ce)?(I[X]=Ae,I[Z]=U,X=Z):(I[X]=ce,I[ie]=U,X=ie);else if(Z<Q&&0>n(Ae,U))I[X]=Ae,I[Z]=U,X=Z;else break e}}return z}function n(I,z){var U=I.sortIndex-z.sortIndex;return U!==0?U:I.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var l=[],c=[],h=1,u=null,d=3,f=!1,p=!1,m=!1,g=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(I){for(var z=i(c);z!==null;){if(z.callback===null)r(c);else if(z.startTime<=I)r(c),z.sortIndex=z.expirationTime,e(l,z);else break;z=i(c)}}function S(I){if(m=!1,x(I),!p)if(i(l)!==null)p=!0,q(A);else{var z=i(c);z!==null&&W(S,z.startTime-I)}}function A(I,z){p=!1,m&&(m=!1,v(E),E=-1),f=!0;var U=d;try{for(x(z),u=i(l);u!==null&&(!(u.expirationTime>z)||I&&!D());){var X=u.callback;if(typeof X=="function"){u.callback=null,d=u.priorityLevel;var Q=X(u.expirationTime<=z);z=t.unstable_now(),typeof Q=="function"?u.callback=Q:u===i(l)&&r(l),x(z)}else r(l);u=i(l)}if(u!==null)var re=!0;else{var ie=i(c);ie!==null&&W(S,ie.startTime-z),re=!1}return re}finally{u=null,d=U,f=!1}}var _=!1,M=null,E=-1,T=5,C=-1;function D(){return!(t.unstable_now()-C<T)}function B(){if(M!==null){var I=t.unstable_now();C=I;var z=!0;try{z=M(!0,I)}finally{z?O():(_=!1,M=null)}}else _=!1}var O;if(typeof y=="function")O=function(){y(B)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,H=L.port2;L.port1.onmessage=B,O=function(){H.postMessage(null)}}else O=function(){g(B,0)};function q(I){M=I,_||(_=!0,O())}function W(I,z){E=g(function(){I(t.unstable_now())},z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(I){I.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,q(A))},t.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<I?Math.floor(1e3/I):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(I){switch(d){case 1:case 2:case 3:var z=3;break;default:z=d}var U=d;d=z;try{return I()}finally{d=U}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(I,z){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var U=d;d=I;try{return z()}finally{d=U}},t.unstable_scheduleCallback=function(I,z,U){var X=t.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?X+U:X):U=X,I){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=U+Q,I={id:h++,callback:z,priorityLevel:I,startTime:U,expirationTime:Q,sortIndex:-1},U>X?(I.sortIndex=U,e(c,I),i(l)===null&&I===i(c)&&(m?(v(E),E=-1):m=!0,W(S,U-X))):(I.sortIndex=Q,e(l,I),p||f||(p=!0,q(A))),I},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(I){var z=d;return function(){var U=d;d=z;try{return I.apply(this,arguments)}finally{d=U}}}})(pre);fre.exports=pre;var yW=fre.exports;const t5={},qSe=t=>void Object.assign(t5,t);function KSe(t,e){function i(h,{args:u=[],attach:d,...f},p){let m=`${h[0].toUpperCase()}${h.slice(1)}`,g;if(h==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const v=f.object;g=Pv(v,{type:h,root:p,attach:d,primitive:!0})}else{const v=t5[m];if(!v)throw new Error(`R3F: ${m} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(u))throw new Error("R3F: The args prop must be an array!");g=Pv(new v(...u),{type:h,root:p,attach:d,memoizedProps:{args:u}})}return g.__r3f.attach===void 0&&(g instanceof xi?g.__r3f.attach="geometry":g instanceof kn&&(g.__r3f.attach="material")),m!=="inject"&&SL(g,f),g}function r(h,u){let d=!1;if(u){var f,p;(f=u.__r3f)!=null&&f.attach?wL(h,u,u.__r3f.attach):u.isObject3D&&h.isObject3D&&(h.add(u),d=!0),d||(p=h.__r3f)==null||p.objects.push(u),u.__r3f||Pv(u,{}),u.__r3f.parent=h,ok(u),Dv(u)}}function n(h,u,d){let f=!1;if(u){var p,m;if((p=u.__r3f)!=null&&p.attach)wL(h,u,u.__r3f.attach);else if(u.isObject3D&&h.isObject3D){u.parent=h,u.dispatchEvent({type:"added"}),h.dispatchEvent({type:"childadded",child:u});const g=h.children.filter(y=>y!==u),v=g.indexOf(d);h.children=[...g.slice(0,v),u,...g.slice(v)],f=!0}f||(m=h.__r3f)==null||m.objects.push(u),u.__r3f||Pv(u,{}),u.__r3f.parent=h,ok(u),Dv(u)}}function s(h,u,d=!1){h&&[...h].forEach(f=>a(u,f,d))}function a(h,u,d){if(u){var f,p,m;if(u.__r3f&&(u.__r3f.parent=null),(f=h.__r3f)!=null&&f.objects&&(h.__r3f.objects=h.__r3f.objects.filter(S=>S!==u)),(p=u.__r3f)!=null&&p.attach)_W(h,u,u.__r3f.attach);else if(u.isObject3D&&h.isObject3D){var g;h.remove(u),(g=u.__r3f)!=null&&g.root&&n_e(ZT(u),u)}const y=(m=u.__r3f)==null?void 0:m.primitive,x=!y&&(d===void 0?u.dispose!==null:d);if(!y){var v;s((v=u.__r3f)==null?void 0:v.objects,u,x),s(u.children,u,x)}if(delete u.__r3f,x&&u.dispose&&u.type!=="Scene"){const S=()=>{try{u.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?yW.unstable_scheduleCallback(yW.unstable_IdlePriority,S):S()}Dv(h)}}function o(h,u,d,f){var p;const m=(p=h.__r3f)==null?void 0:p.parent;if(!m)return;const g=i(u,d,h.__r3f.root);if(h.children){for(const v of h.children)v.__r3f&&r(g,v);h.children=h.children.filter(v=>!v.__r3f)}h.__r3f.objects.forEach(v=>r(g,v)),h.__r3f.objects=[],h.__r3f.autoRemovedBeforeAppend||a(m,h),g.parent&&(g.__r3f.autoRemovedBeforeAppend=!0),r(m,g),g.raycast&&g.__r3f.eventCount&&ZT(g).getState().internal.interaction.push(g),[f,f.alternate].forEach(v=>{v!==null&&(v.stateNode=g,v.ref&&(typeof v.ref=="function"?v.ref(g):v.ref.current=g))})}const l=()=>{};return{reconciler:YSe({createInstance:i,removeChild:a,appendChild:r,appendInitialChild:r,insertBefore:n,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(h,u)=>{if(!u)return;const d=h.getState().scene;d.__r3f&&(d.__r3f.root=h,r(d,u))},removeChildFromContainer:(h,u)=>{u&&a(h.getState().scene,u)},insertInContainerBefore:(h,u,d)=>{if(!u||!d)return;const f=h.getState().scene;f.__r3f&&n(f,u,d)},getRootHostContext:()=>null,getChildHostContext:h=>h,finalizeInitialChildren(h){var u;return!!((u=h==null?void 0:h.__r3f)!=null?u:{}).handlers},prepareUpdate(h,u,d,f){var p;if(((p=h==null?void 0:h.__r3f)!=null?p:{}).primitive&&f.object&&f.object!==h)return[!0];{const{args:g=[],children:v,...y}=f,{args:x=[],children:S,...A}=d;if(!Array.isArray(g))throw new Error("R3F: the args prop must be an array!");if(g.some((M,E)=>M!==x[E]))return[!0];const _=wre(h,y,A,!0);return _.changes.length?[!1,_]:null}},commitUpdate(h,[u,d],f,p,m,g){u?o(h,f,m,g):SL(h,d)},commitMount(h,u,d,f){var p;const m=(p=h.__r3f)!=null?p:{};h.raycast&&m.handlers&&m.eventCount&&ZT(h).getState().internal.interaction.push(h)},getPublicInstance:h=>h,prepareForCommit:()=>null,preparePortalMount:h=>Pv(h.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(h){var u;const{attach:d,parent:f}=(u=h.__r3f)!=null?u:{};d&&f&&_W(f,h,d),h.isObject3D&&(h.visible=!1),Dv(h)},unhideInstance(h,u){var d;const{attach:f,parent:p}=(d=h.__r3f)!=null?d:{};f&&p&&wL(p,h,f),(h.isObject3D&&u.visible==null||u.visible)&&(h.visible=!0),Dv(h)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>e?e():ey.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&br.fun(performance.now)?performance.now:br.fun(Date.now)?Date.now:()=>0,scheduleTimeout:br.fun(setTimeout)?setTimeout:void 0,cancelTimeout:br.fun(clearTimeout)?clearTimeout:void 0}),applyProps:SL}}var xW,bW;const bL=t=>"colorSpace"in t||"outputColorSpace"in t,mre=()=>{var t;return(t=t5.ColorManagement)!=null?t:null},gre=t=>t&&t.isOrthographicCamera,QSe=t=>t&&t.hasOwnProperty("current"),b_=typeof window<"u"&&((xW=window.document)!=null&&xW.createElement||((bW=window.navigator)==null?void 0:bW.product)==="ReactNative")?we.useLayoutEffect:we.useEffect;function vre(t){const e=we.useRef(t);return b_(()=>void(e.current=t),[t]),e}function $Se({set:t}){return b_(()=>(t(new Promise(()=>null)),()=>t(!1)),[t]),null}class yre extends we.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}yre.getDerivedStateFromError=()=>({error:!0});const xre="__default",wW=new Map,JSe=t=>t&&!!t.memoized&&!!t.changes;function bre(t){var e;const i=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(t)?Math.min(Math.max(t[0],i),t[1]):t}const jx=t=>{var e;return(e=t.__r3f)==null?void 0:e.root.getState()};function ZT(t){let e=t.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const br={obj:t=>t===Object(t)&&!br.arr(t)&&typeof t!="function",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",boo:t=>typeof t=="boolean",und:t=>t===void 0,arr:t=>Array.isArray(t),equ(t,e,{arrays:i="shallow",objects:r="reference",strict:n=!0}={}){if(typeof t!=typeof e||!!t!=!!e)return!1;if(br.str(t)||br.num(t)||br.boo(t))return t===e;const s=br.obj(t);if(s&&r==="reference")return t===e;const a=br.arr(t);if(a&&i==="reference")return t===e;if((a||s)&&t===e)return!0;let o;for(o in t)if(!(o in e))return!1;if(s&&i==="shallow"&&r==="shallow"){for(o in n?e:t)if(!br.equ(t[o],e[o],{strict:n,objects:"reference"}))return!1}else for(o in n?e:t)if(t[o]!==e[o])return!1;if(br.und(o)){if(a&&t.length===0&&e.length===0||s&&Object.keys(t).length===0&&Object.keys(e).length===0)return!0;if(t!==e)return!1}return!0}};function ZSe(t){const e={nodes:{},materials:{}};return t&&t.traverse(i=>{i.name&&(e.nodes[i.name]=i),i.material&&!e.materials[i.material.name]&&(e.materials[i.material.name]=i.material)}),e}function e_e(t){t.dispose&&t.type!=="Scene"&&t.dispose();for(const e in t)e.dispose==null||e.dispose(),delete t[e]}function Pv(t,e){const i=t;return i.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},t}function ak(t,e){let i=t;if(e.includes("-")){const r=e.split("-"),n=r.pop();return i=r.reduce((s,a)=>s[a],t),{target:i,key:n}}else return{target:i,key:e}}const SW=/-\d+$/;function wL(t,e,i){if(br.str(i)){if(SW.test(i)){const s=i.replace(SW,""),{target:a,key:o}=ak(t,s);Array.isArray(a[o])||(a[o]=[])}const{target:r,key:n}=ak(t,i);e.__r3f.previousAttach=r[n],r[n]=e}else e.__r3f.previousAttach=i(t,e)}function _W(t,e,i){var r,n;if(br.str(i)){const{target:s,key:a}=ak(t,i),o=e.__r3f.previousAttach;o===void 0?delete s[a]:s[a]=o}else(r=e.__r3f)==null||r.previousAttach==null||r.previousAttach(t,e);(n=e.__r3f)==null||delete n.previousAttach}function wre(t,{children:e,key:i,ref:r,...n},{children:s,key:a,ref:o,...l}={},c=!1){const h=t.__r3f,u=Object.entries(n),d=[];if(c){const p=Object.keys(l);for(let m=0;m<p.length;m++)n.hasOwnProperty(p[m])||u.unshift([p[m],xre+"remove"])}u.forEach(([p,m])=>{var g;if((g=t.__r3f)!=null&&g.primitive&&p==="object"||br.equ(m,l[p]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(p))return d.push([p,m,!0,[]]);let v=[];p.includes("-")&&(v=p.split("-")),d.push([p,m,!1,v]);for(const y in n){const x=n[y];y.startsWith(`${p}-`)&&d.push([y,x,!1,y.split("-")])}});const f={...n};return h!=null&&h.memoizedProps&&h!=null&&h.memoizedProps.args&&(f.args=h.memoizedProps.args),h!=null&&h.memoizedProps&&h!=null&&h.memoizedProps.attach&&(f.attach=h.memoizedProps.attach),{memoized:f,changes:d}}const t_e=typeof process<"u"&&!1;function SL(t,e){var i;const r=t.__r3f,n=r==null?void 0:r.root,s=n==null||n.getState==null?void 0:n.getState(),{memoized:a,changes:o}=JSe(e)?e:wre(t,e),l=r==null?void 0:r.eventCount;t.__r3f&&(t.__r3f.memoizedProps=a);for(let h=0;h<o.length;h++){let[u,d,f,p]=o[h];if(bL(t)){const y="srgb",x="srgb-linear";u==="encoding"?(u="colorSpace",d=d===3001?y:x):u==="outputEncoding"&&(u="outputColorSpace",d=d===3001?y:x)}let m=t,g=m[u];if(p.length&&(g=p.reduce((v,y)=>v[y],t),!(g&&g.set))){const[v,...y]=p.reverse();m=y.reverse().reduce((x,S)=>x[S],t),u=v}if(d===xre+"remove")if(m.constructor){let v=wW.get(m.constructor);v||(v=new m.constructor,wW.set(m.constructor,v)),d=v[u]}else d=0;if(f&&r)d?r.handlers[u]=d:delete r.handlers[u],r.eventCount=Object.keys(r.handlers).length;else if(g&&g.set&&(g.copy||g instanceof ug)){if(Array.isArray(d))g.fromArray?g.fromArray(d):g.set(...d);else if(g.copy&&d&&d.constructor&&(t_e?g.constructor.name===d.constructor.name:g.constructor===d.constructor))g.copy(d);else if(d!==void 0){const v=g instanceof Ct;!v&&g.setScalar?g.setScalar(d):g instanceof ug&&d instanceof ug?g.mask=d.mask:g.set(d),!mre()&&s&&!s.linear&&v&&g.convertSRGBToLinear()}}else if(m[u]=d,m[u]instanceof kr&&m[u].format===so&&m[u].type===ud&&s){const v=m[u];bL(v)&&bL(s.gl)?v.colorSpace=s.gl.outputColorSpace:v.encoding=s.gl.outputEncoding}Dv(t)}if(r&&r.parent&&t.raycast&&l!==r.eventCount){const h=ZT(t).getState().internal,u=h.interaction.indexOf(t);u>-1&&h.interaction.splice(u,1),r.eventCount&&h.interaction.push(t)}return!(o.length===1&&o[0][0]==="onUpdate")&&o.length&&(i=t.__r3f)!=null&&i.parent&&ok(t),t}function Dv(t){var e,i;const r=(e=t.__r3f)==null||(i=e.root)==null||i.getState==null?void 0:i.getState();r&&r.internal.frames===0&&r.invalidate()}function ok(t){t.onUpdate==null||t.onUpdate(t)}function i_e(t,e){t.manual||(gre(t)?(t.left=e.width/-2,t.right=e.width/2,t.top=e.height/2,t.bottom=e.height/-2):t.aspect=e.width/e.height,t.updateProjectionMatrix(),t.updateMatrixWorld())}function GE(t){return(t.eventObject||t.object).uuid+"/"+t.index+t.instanceId}function r_e(){var t;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return ey.DefaultEventPriority;switch((t=e.event)==null?void 0:t.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ey.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ey.ContinuousEventPriority;default:return ey.DefaultEventPriority}}function Sre(t,e,i,r){const n=i.get(e);n&&(i.delete(e),i.size===0&&(t.delete(r),n.target.releasePointerCapture(r)))}function n_e(t,e){const{internal:i}=t.getState();i.interaction=i.interaction.filter(r=>r!==e),i.initialHits=i.initialHits.filter(r=>r!==e),i.hovered.forEach((r,n)=>{(r.eventObject===e||r.object===e)&&i.hovered.delete(n)}),i.capturedMap.forEach((r,n)=>{Sre(i.capturedMap,e,r,n)})}function s_e(t){function e(l){const{internal:c}=t.getState(),h=l.offsetX-c.initialClick[0],u=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(h*h+u*u))}function i(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(h=>{var u;return(u=c.__r3f)==null?void 0:u.handlers["onPointer"+h]}))}function r(l,c){const h=t.getState(),u=new Set,d=[],f=c?c(h.internal.interaction):h.internal.interaction;for(let v=0;v<f.length;v++){const y=jx(f[v]);y&&(y.raycaster.camera=void 0)}h.previousRoot||h.events.compute==null||h.events.compute(l,h);function p(v){const y=jx(v);if(!y||!y.events.enabled||y.raycaster.camera===null)return[];if(y.raycaster.camera===void 0){var x;y.events.compute==null||y.events.compute(l,y,(x=y.previousRoot)==null?void 0:x.getState()),y.raycaster.camera===void 0&&(y.raycaster.camera=null)}return y.raycaster.camera?y.raycaster.intersectObject(v,!0):[]}let m=f.flatMap(p).sort((v,y)=>{const x=jx(v.object),S=jx(y.object);return!x||!S?v.distance-y.distance:S.events.priority-x.events.priority||v.distance-y.distance}).filter(v=>{const y=GE(v);return u.has(y)?!1:(u.add(y),!0)});h.events.filter&&(m=h.events.filter(m,h));for(const v of m){let y=v.object;for(;y;){var g;(g=y.__r3f)!=null&&g.eventCount&&d.push({...v,eventObject:y}),y=y.parent}}if("pointerId"in l&&h.internal.capturedMap.has(l.pointerId))for(let v of h.internal.capturedMap.get(l.pointerId).values())u.has(GE(v.intersection))||d.push(v.intersection);return d}function n(l,c,h,u){const d=t.getState();if(l.length){const f={stopped:!1};for(const p of l){const m=jx(p.object)||d,{raycaster:g,pointer:v,camera:y,internal:x}=m,S=new le(v.x,v.y,0).unproject(y),A=C=>{var D,B;return(D=(B=x.capturedMap.get(C))==null?void 0:B.has(p.eventObject))!=null?D:!1},_=C=>{const D={intersection:p,target:c.target};x.capturedMap.has(C)?x.capturedMap.get(C).set(p.eventObject,D):x.capturedMap.set(C,new Map([[p.eventObject,D]])),c.target.setPointerCapture(C)},M=C=>{const D=x.capturedMap.get(C);D&&Sre(x.capturedMap,p.eventObject,D,C)};let E={};for(let C in c){let D=c[C];typeof D!="function"&&(E[C]=D)}let T={...p,...E,pointer:v,intersections:l,stopped:f.stopped,delta:h,unprojectedPoint:S,ray:g.ray,camera:y,stopPropagation(){const C="pointerId"in c&&x.capturedMap.get(c.pointerId);if((!C||C.has(p.eventObject))&&(T.stopped=f.stopped=!0,x.hovered.size&&Array.from(x.hovered.values()).find(D=>D.eventObject===p.eventObject))){const D=l.slice(0,l.indexOf(p));s([...D,p])}},target:{hasPointerCapture:A,setPointerCapture:_,releasePointerCapture:M},currentTarget:{hasPointerCapture:A,setPointerCapture:_,releasePointerCapture:M},nativeEvent:c};if(u(T),f.stopped===!0)break}}return l}function s(l){const{internal:c}=t.getState();for(const h of c.hovered.values())if(!l.length||!l.find(u=>u.object===h.object&&u.index===h.index&&u.instanceId===h.instanceId)){const d=h.eventObject.__r3f,f=d==null?void 0:d.handlers;if(c.hovered.delete(GE(h)),d!=null&&d.eventCount){const p={...h,intersections:l};f.onPointerOut==null||f.onPointerOut(p),f.onPointerLeave==null||f.onPointerLeave(p)}}}function a(l,c){for(let h=0;h<c.length;h++){const u=c[h].__r3f;u==null||u.handlers.onPointerMissed==null||u.handlers.onPointerMissed(l)}}function o(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:h}=t.getState();"pointerId"in c&&h.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{h.capturedMap.has(c.pointerId)&&(h.capturedMap.delete(c.pointerId),s([]))})}}return function(h){const{onPointerMissed:u,internal:d}=t.getState();d.lastEvent.current=h;const f=l==="onPointerMove",p=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",g=r(h,f?i:void 0),v=p?e(h):0;l==="onPointerDown"&&(d.initialClick=[h.offsetX,h.offsetY],d.initialHits=g.map(x=>x.eventObject)),p&&!g.length&&v<=2&&(a(h,d.interaction),u&&u(h)),f&&s(g);function y(x){const S=x.eventObject,A=S.__r3f,_=A==null?void 0:A.handlers;if(A!=null&&A.eventCount)if(f){if(_.onPointerOver||_.onPointerEnter||_.onPointerOut||_.onPointerLeave){const M=GE(x),E=d.hovered.get(M);E?E.stopped&&x.stopPropagation():(d.hovered.set(M,x),_.onPointerOver==null||_.onPointerOver(x),_.onPointerEnter==null||_.onPointerEnter(x))}_.onPointerMove==null||_.onPointerMove(x)}else{const M=_[l];M?(!p||d.initialHits.includes(S))&&(a(h,d.interaction.filter(E=>!d.initialHits.includes(E))),M(x)):p&&d.initialHits.includes(S)&&a(h,d.interaction.filter(E=>!d.initialHits.includes(E)))}}n(g,h,v,y)}}return{handlePointer:o}}const _re=t=>!!(t!=null&&t.render),Are=we.createContext(null),a_e=(t,e)=>{const i=USe((o,l)=>{const c=new le,h=new le,u=new le;function d(v=l().camera,y=h,x=l().size){const{width:S,height:A,top:_,left:M}=x,E=S/A;y instanceof le?u.copy(y):u.set(...y);const T=v.getWorldPosition(c).distanceTo(u);if(gre(v))return{width:S/v.zoom,height:A/v.zoom,top:_,left:M,factor:1,distance:T,aspect:E};{const C=v.fov*Math.PI/180,D=2*Math.tan(C/2)*T,B=D*(S/A);return{width:B,height:D,top:_,left:M,factor:S/B,distance:T,aspect:E}}}let f;const p=v=>o(y=>({performance:{...y.performance,current:v}})),m=new tt;return{set:o,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(v=1)=>t(l(),v),advance:(v,y)=>e(v,y,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new $4,pointer:m,mouse:m,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const v=l();f&&clearTimeout(f),v.performance.current!==v.performance.min&&p(v.performance.min),f=setTimeout(()=>p(l().performance.max),v.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:v=>o(y=>({...y,events:{...y.events,...v}})),setSize:(v,y,x,S,A)=>{const _=l().camera,M={width:v,height:y,top:S||0,left:A||0,updateStyle:x};o(E=>({size:M,viewport:{...E.viewport,...d(_,h,M)}}))},setDpr:v=>o(y=>{const x=bre(v);return{viewport:{...y.viewport,dpr:x,initialDpr:y.viewport.initialDpr||x}}}),setFrameloop:(v="always")=>{const y=l().clock;y.stop(),y.elapsedTime=0,v!=="never"&&(y.start(),y.elapsedTime=0),o(()=>({frameloop:v}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:we.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(v,y,x)=>{const S=l().internal;return S.priority=S.priority+(y>0?1:0),S.subscribers.push({ref:v,priority:y,store:x}),S.subscribers=S.subscribers.sort((A,_)=>A.priority-_.priority),()=>{const A=l().internal;A!=null&&A.subscribers&&(A.priority=A.priority-(y>0?1:0),A.subscribers=A.subscribers.filter(_=>_.ref!==v))}}}}}),r=i.getState();let n=r.size,s=r.viewport.dpr,a=r.camera;return i.subscribe(()=>{const{camera:o,size:l,viewport:c,gl:h,set:u}=i.getState();if(l.width!==n.width||l.height!==n.height||c.dpr!==s){var d;n=l,s=c.dpr,i_e(o,l),h.setPixelRatio(c.dpr);const f=(d=l.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&h.domElement instanceof HTMLCanvasElement;h.setSize(l.width,l.height,f)}o!==a&&(a=o,u(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(o)}})))}),i.subscribe(o=>t(o)),i};let VE,o_e=new Set,l_e=new Set,c_e=new Set;function _L(t,e){if(t.size)for(const{callback:i}of t.values())i(e)}function Wx(t,e){switch(t){case"before":return _L(o_e,e);case"after":return _L(l_e,e);case"tail":return _L(c_e,e)}}let AL,EL;function ML(t,e,i){let r=e.clock.getDelta();for(e.frameloop==="never"&&typeof t=="number"&&(r=t-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=t),AL=e.internal.subscribers,VE=0;VE<AL.length;VE++)EL=AL[VE],EL.ref.current(EL.store.getState(),r,i);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function h_e(t){let e=!1,i=!1,r,n,s;function a(c){n=requestAnimationFrame(a),e=!0,r=0,Wx("before",c),i=!0;for(const u of t.values()){var h;s=u.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((h=s.gl.xr)!=null&&h.isPresenting)&&(r+=ML(c,s))}if(i=!1,Wx("after",c),r===0)return Wx("tail",c),e=!1,cancelAnimationFrame(n)}function o(c,h=1){var u;if(!c)return t.forEach(d=>o(d.store.getState(),h));(u=c.gl.xr)!=null&&u.isPresenting||!c.internal.active||c.frameloop==="never"||(h>1?c.internal.frames=Math.min(60,c.internal.frames+h):i?c.internal.frames=2:c.internal.frames=1,e||(e=!0,requestAnimationFrame(a)))}function l(c,h=!0,u,d){if(h&&Wx("before",c),u)ML(c,u,d);else for(const f of t.values())ML(c,f.store.getState());h&&Wx("after",c)}return{loop:a,invalidate:o,advance:l}}function Ere(){const t=we.useContext(Are);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function eo(t=i=>i,e){return Ere()(t,e)}function gD(t,e=0){const i=Ere(),r=i.getState().internal.subscribe,n=vre(t);return b_(()=>r(n,e,i),[e,r,i]),null}const AW=new WeakMap;function Mre(t,e){return function(i,...r){let n=AW.get(i);return n||(n=new i,AW.set(i,n)),t&&t(n),Promise.all(r.map(s=>new Promise((a,o)=>n.load(s,l=>{l.scene&&Object.assign(l,ZSe(l.scene)),a(l)},e,l=>o(new Error(`Could not load ${s}: ${l==null?void 0:l.message}`))))))}}function Rp(t,e,i,r){const n=Array.isArray(e)?e:[e],s=ure(Mre(i,r),[t,...n],{equal:br.equ});return Array.isArray(e)?s:s[0]}Rp.preload=function(t,e,i){const r=Array.isArray(e)?e:[e];return GSe(Mre(i),[t,...r])};Rp.clear=function(t,e){const i=Array.isArray(e)?e:[e];return VSe([t,...i])};const e1=new Map,{invalidate:EW,advance:MW}=h_e(e1),{reconciler:o2,applyProps:H0}=KSe(e1,r_e),j0={objects:"shallow",strict:!1},u_e=(t,e)=>{const i=typeof t=="function"?t(e):t;return _re(i)?i:new C4({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...t})};function d_e(t,e){const i=typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement;if(e){const{width:r,height:n,top:s,left:a,updateStyle:o=i}=e;return{width:r,height:n,top:s,left:a,updateStyle:o}}else if(typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&t.parentElement){const{width:r,height:n,top:s,left:a}=t.parentElement.getBoundingClientRect();return{width:r,height:n,top:s,left:a,updateStyle:i}}else if(typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height,top:0,left:0,updateStyle:i};return{width:0,height:0,top:0,left:0}}function f_e(t){const e=e1.get(t),i=e==null?void 0:e.fiber,r=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const n=typeof reportError=="function"?reportError:console.error,s=r||a_e(EW,MW),a=i||o2.createContainer(s,ey.ConcurrentRoot,null,!1,null,"",n,null);e||e1.set(t,{fiber:a,store:s});let o,l=!1,c;return{configure(h={}){let{gl:u,size:d,scene:f,events:p,onCreated:m,shadows:g=!1,linear:v=!1,flat:y=!1,legacy:x=!1,orthographic:S=!1,frameloop:A="always",dpr:_=[1,2],performance:M,raycaster:E,camera:T,onPointerMissed:C}=h,D=s.getState(),B=D.gl;D.gl||D.set({gl:B=u_e(u,t)});let O=D.raycaster;O||D.set({raycaster:O=new are});const{params:L,...H}=E||{};if(br.equ(H,O,j0)||H0(O,{...H}),br.equ(L,O.params,j0)||H0(O,{params:{...O.params,...L}}),!D.camera||D.camera===c&&!br.equ(c,T,j0)){c=T;const U=T instanceof i_,X=U?T:S?new Dc(0,0,0,0,.1,1e3):new Or(75,0,.1,1e3);U||(X.position.z=5,T&&(H0(X,T),("aspect"in T||"left"in T||"right"in T||"bottom"in T||"top"in T)&&(X.manual=!0,X.updateProjectionMatrix())),!D.camera&&!(T!=null&&T.rotation)&&X.lookAt(0,0,0)),D.set({camera:X}),O.camera=X}if(!D.scene){let U;f instanceof a2?U=f:(U=new a2,f&&H0(U,f)),D.set({scene:Pv(U)})}if(!D.xr){var q;const U=(re,ie)=>{const ce=s.getState();ce.frameloop!=="never"&&MW(re,!0,ce,ie)},X=()=>{const re=s.getState();re.gl.xr.enabled=re.gl.xr.isPresenting,re.gl.xr.setAnimationLoop(re.gl.xr.isPresenting?U:null),re.gl.xr.isPresenting||EW(re)},Q={connect(){const re=s.getState().gl;re.xr.addEventListener("sessionstart",X),re.xr.addEventListener("sessionend",X)},disconnect(){const re=s.getState().gl;re.xr.removeEventListener("sessionstart",X),re.xr.removeEventListener("sessionend",X)}};typeof((q=B.xr)==null?void 0:q.addEventListener)=="function"&&Q.connect(),D.set({xr:Q})}if(B.shadowMap){const U=B.shadowMap.enabled,X=B.shadowMap.type;if(B.shadowMap.enabled=!!g,br.boo(g))B.shadowMap.type=rw;else if(br.str(g)){var W;const Q={basic:vte,percentage:eD,soft:rw,variance:zm};B.shadowMap.type=(W=Q[g])!=null?W:rw}else br.obj(g)&&Object.assign(B.shadowMap,g);(U!==B.shadowMap.enabled||X!==B.shadowMap.type)&&(B.shadowMap.needsUpdate=!0)}const I=mre();I&&("enabled"in I?I.enabled=!x:"legacyMode"in I&&(I.legacyMode=x)),l||H0(B,{outputEncoding:v?3e3:3001,toneMapping:y?Pc:p4}),D.legacy!==x&&D.set(()=>({legacy:x})),D.linear!==v&&D.set(()=>({linear:v})),D.flat!==y&&D.set(()=>({flat:y})),u&&!br.fun(u)&&!_re(u)&&!br.equ(u,B,j0)&&H0(B,u),p&&!D.events.handlers&&D.set({events:p(s)});const z=d_e(t,d);return br.equ(z,D.size,j0)||D.setSize(z.width,z.height,z.updateStyle,z.top,z.left),_&&D.viewport.dpr!==bre(_)&&D.setDpr(_),D.frameloop!==A&&D.setFrameloop(A),D.onPointerMissed||D.set({onPointerMissed:C}),M&&!br.equ(M,D.performance,j0)&&D.set(U=>({performance:{...U.performance,...M}})),o=m,l=!0,this},render(h){return l||this.configure(),o2.updateContainer(Y.jsx(p_e,{store:s,children:h,onCreated:o,rootElement:t}),a,null,()=>{}),s},unmount(){Tre(t)}}}function p_e({store:t,children:e,onCreated:i,rootElement:r}){return b_(()=>{const n=t.getState();n.set(s=>({internal:{...s.internal,active:!0}})),i&&i(n),t.getState().events.connected||n.events.connect==null||n.events.connect(r)},[]),Y.jsx(Are.Provider,{value:t,children:e})}function Tre(t,e){const i=e1.get(t),r=i==null?void 0:i.fiber;if(r){const n=i==null?void 0:i.store.getState();n&&(n.internal.active=!1),o2.updateContainer(null,r,null,()=>{n&&setTimeout(()=>{try{var s,a,o,l;n.events.disconnect==null||n.events.disconnect(),(s=n.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(o=n.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(l=n.gl)!=null&&l.xr&&n.xr.disconnect(),e_e(n),e1.delete(t)}catch{}},500)})}}o2.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:we.version});const TL={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function m_e(t){const{handlePointer:e}=s_e(t);return{priority:1,enabled:!0,compute(i,r,n){r.pointer.set(i.offsetX/r.size.width*2-1,-(i.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(TL).reduce((i,r)=>({...i,[r]:e(r)}),{}),update:()=>{var i;const{events:r,internal:n}=t.getState();(i=n.lastEvent)!=null&&i.current&&r.handlers&&r.handlers.onPointerMove(n.lastEvent.current)},connect:i=>{var r;const{set:n,events:s}=t.getState();s.disconnect==null||s.disconnect(),n(a=>({events:{...a.events,connected:i}})),Object.entries((r=s.handlers)!=null?r:[]).forEach(([a,o])=>{const[l,c]=TL[a];i.addEventListener(l,o,{passive:c})})},disconnect:()=>{const{set:i,events:r}=t.getState();if(r.connected){var n;Object.entries((n=r.handlers)!=null?n:[]).forEach(([s,a])=>{if(r&&r.connected instanceof HTMLElement){const[o]=TL[s];r.connected.removeEventListener(o,a)}}),i(s=>({events:{...s.events,connected:void 0}}))}}}}function lk(t,e,i){var r,n,s,a,o;e==null&&(e=100);function l(){var h=Date.now()-a;h<e&&h>=0?r=setTimeout(l,e-h):(r=null,i||(o=t.apply(s,n),s=n=null))}var c=function(){s=this,n=arguments,a=Date.now();var h=i&&!r;return r||(r=setTimeout(l,e)),h&&(o=t.apply(s,n),s=n=null),o};return c.clear=function(){r&&(clearTimeout(r),r=null)},c.flush=function(){r&&(o=t.apply(s,n),s=n=null,clearTimeout(r),r=null)},c}lk.debounce=lk;var g_e=lk;const TW=C1(g_e);var v_e=Object.defineProperty,y_e=Object.defineProperties,x_e=Object.getOwnPropertyDescriptors,CW=Object.getOwnPropertySymbols,b_e=Object.prototype.hasOwnProperty,w_e=Object.prototype.propertyIsEnumerable,PW=(t,e,i)=>e in t?v_e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,DW=(t,e)=>{for(var i in e||(e={}))b_e.call(e,i)&&PW(t,i,e[i]);if(CW)for(var i of CW(e))w_e.call(e,i)&&PW(t,i,e[i]);return t},S_e=(t,e)=>y_e(t,x_e(e)),RW,IW;typeof window<"u"&&((RW=window.document)!=null&&RW.createElement||((IW=window.navigator)==null?void 0:IW.product)==="ReactNative")?we.useLayoutEffect:we.useEffect;function Cre(t,e,i){if(!t)return;if(i(t)===!0)return t;let r=t.child;for(;r;){const n=Cre(r,e,i);if(n)return n;r=r.sibling}}function Pre(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const LW=console.error;console.error=function(){const t=[...arguments].join("");if(t!=null&&t.startsWith("Warning:")&&t.includes("useContext")){console.error=LW;return}return LW.apply(this,arguments)};const i5=Pre(we.createContext(null));class Dre extends we.Component{render(){return we.createElement(i5.Provider,{value:this._reactInternals},this.props.children)}}function __e(){const t=we.useContext(i5);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=we.useId();return we.useMemo(()=>{for(const r of[t,t==null?void 0:t.alternate]){if(!r)continue;const n=Cre(r,!1,s=>{let a=s.memoizedState;for(;a;){if(a.memoizedState===e)return!0;a=a.next}});if(n)return n}},[t,e])}function A_e(){const t=__e(),[e]=we.useState(()=>new Map);e.clear();let i=t;for(;i;){if(i.type&&typeof i.type=="object"){const n=i.type._context===void 0&&i.type.Provider===i.type?i.type:i.type._context;n&&n!==i5&&!e.has(n)&&e.set(n,we.useContext(Pre(n)))}i=i.return}return e}function E_e(){const t=A_e();return we.useMemo(()=>Array.from(t.keys()).reduce((e,i)=>r=>we.createElement(e,null,we.createElement(i.Provider,S_e(DW({},r),{value:t.get(i)}))),e=>we.createElement(Dre,DW({},e))),[t])}function M_e({debounce:t,scroll:e,polyfill:i,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const n=i||typeof window<"u"&&window.ResizeObserver,[s,a]=we.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!n)return s.width=1280,s.height=800,[()=>{},s,()=>{}];const o=we.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=t?typeof t=="number"?t:t.scroll:null,c=t?typeof t=="number"?t:t.resize:null,h=we.useRef(!1);we.useEffect(()=>(h.current=!0,()=>void(h.current=!1)));const[u,d,f]=we.useMemo(()=>{const v=()=>{if(!o.current.element)return;const{left:y,top:x,width:S,height:A,bottom:_,right:M,x:E,y:T}=o.current.element.getBoundingClientRect(),C={left:y,top:x,width:S,height:A,bottom:_,right:M,x:E,y:T};o.current.element instanceof HTMLElement&&r&&(C.height=o.current.element.offsetHeight,C.width=o.current.element.offsetWidth),Object.freeze(C),h.current&&!D_e(o.current.lastBounds,C)&&a(o.current.lastBounds=C)};return[v,c?TW(v,c):v,l?TW(v,l):v]},[a,r,l,c]);function p(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(v=>v.removeEventListener("scroll",f,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function m(){var v;o.current.element&&(o.current.resizeObserver=new n(d),(v=o.current.resizeObserver)==null||v.observe(o.current.element),e&&o.current.scrollContainers&&o.current.scrollContainers.forEach(y=>y.addEventListener("scroll",f,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{f()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const g=v=>{!v||v===o.current.element||(p(),o.current.element=v,o.current.scrollContainers=Rre(v),m())};return C_e(f,!!e),T_e(d),we.useEffect(()=>{p(),m()},[e,f,d]),we.useEffect(()=>p,[]),[g,s,u]}function T_e(t){we.useEffect(()=>{const e=t;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[t])}function C_e(t,e){we.useEffect(()=>{if(e){const i=t;return window.addEventListener("scroll",i,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",i,!0)}},[t,e])}function Rre(t){const e=[];if(!t||t===document.body)return e;const{overflow:i,overflowX:r,overflowY:n}=window.getComputedStyle(t);return[i,r,n].some(s=>s==="auto"||s==="scroll")&&e.push(t),[...e,...Rre(t.parentElement)]}const P_e=["x","y","top","bottom","left","right","width","height"],D_e=(t,e)=>P_e.every(i=>t[i]===e[i]),R_e=we.forwardRef(function({children:e,fallback:i,resize:r,style:n,gl:s,events:a=m_e,eventSource:o,eventPrefix:l,shadows:c,linear:h,flat:u,legacy:d,orthographic:f,frameloop:p,dpr:m,performance:g,raycaster:v,camera:y,scene:x,onPointerMissed:S,onCreated:A,..._},M){we.useMemo(()=>qSe(FSe),[]);const E=E_e(),[T,C]=M_e({scroll:!0,debounce:{scroll:50,resize:0},...r}),D=we.useRef(null),B=we.useRef(null);we.useImperativeHandle(M,()=>D.current);const O=vre(S),[L,H]=we.useState(!1),[q,W]=we.useState(!1);if(L)throw L;if(q)throw q;const I=we.useRef(null);b_(()=>{const U=D.current;C.width>0&&C.height>0&&U&&(I.current||(I.current=f_e(U)),I.current.configure({gl:s,events:a,shadows:c,linear:h,flat:u,legacy:d,orthographic:f,frameloop:p,dpr:m,performance:g,raycaster:v,camera:y,scene:x,size:C,onPointerMissed:(...X)=>O.current==null?void 0:O.current(...X),onCreated:X=>{X.events.connect==null||X.events.connect(o?QSe(o)?o.current:o:B.current),l&&X.setEvents({compute:(Q,re)=>{const ie=Q[l+"X"],ce=Q[l+"Y"];re.pointer.set(ie/re.size.width*2-1,-(ce/re.size.height)*2+1),re.raycaster.setFromCamera(re.pointer,re.camera)}}),A==null||A(X)}}),I.current.render(Y.jsx(E,{children:Y.jsx(yre,{set:W,children:Y.jsx(we.Suspense,{fallback:Y.jsx($Se,{set:H}),children:e})})})))}),we.useEffect(()=>{const U=D.current;if(U)return()=>Tre(U)},[]);const z=o?"none":"auto";return Y.jsx("div",{ref:B,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:z,...n},..._,children:Y.jsx("div",{ref:T,style:{width:"100%",height:"100%"},children:Y.jsx("canvas",{ref:D,style:{display:"block"},children:i})})})}),vD=we.forwardRef(function(e,i){return Y.jsx(Dre,{children:Y.jsx(R_e,{...e,ref:i})})});function lS(){return lS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)({}).hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},lS.apply(null,arguments)}const w_=new le,r5=new le,I_e=new le,OW=new tt;function L_e(t,e,i){const r=w_.setFromMatrixPosition(t.matrixWorld);r.project(e);const n=i.width/2,s=i.height/2;return[r.x*n+n,-(r.y*s)+s]}function O_e(t,e){const i=w_.setFromMatrixPosition(t.matrixWorld),r=r5.setFromMatrixPosition(e.matrixWorld),n=i.sub(r),s=e.getWorldDirection(I_e);return n.angleTo(s)>Math.PI/2}function B_e(t,e,i,r){const n=w_.setFromMatrixPosition(t.matrixWorld),s=n.clone();s.project(e),OW.set(s.x,s.y),i.setFromCamera(OW,e);const a=i.intersectObjects(r,!0);if(a.length){const o=a[0].distance;return n.distanceTo(i.ray.origin)<o}return!0}function F_e(t,e){if(e instanceof Dc)return e.zoom;if(e instanceof Or){const i=w_.setFromMatrixPosition(t.matrixWorld),r=r5.setFromMatrixPosition(e.matrixWorld),n=e.fov*Math.PI/180,s=i.distanceTo(r);return 1/(2*Math.tan(n/2)*s)}else return 1}function k_e(t,e,i){if(e instanceof Or||e instanceof Dc){const r=w_.setFromMatrixPosition(t.matrixWorld),n=r5.setFromMatrixPosition(e.matrixWorld),s=r.distanceTo(n),a=(i[1]-i[0])/(e.far-e.near),o=i[1]-a*e.far;return Math.round(a*s+o)}}const ck=t=>Math.abs(t)<1e-10?0:t;function Ire(t,e,i=""){let r="matrix3d(";for(let n=0;n!==16;n++)r+=ck(e[n]*t.elements[n])+(n!==15?",":")");return i+r}const N_e=(t=>e=>Ire(e,t))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),U_e=(t=>(e,i)=>Ire(e,t(i),"translate(-50%,-50%)"))(t=>[1/t,1/t,1/t,1,-1/t,-1/t,-1/t,-1,1/t,1/t,1/t,1,1,1,1,1]);function z_e(t){return t&&typeof t=="object"&&"current"in t}const G_e=we.forwardRef(({children:t,eps:e=.001,style:i,className:r,prepend:n,center:s,fullscreen:a,portal:o,distanceFactor:l,sprite:c=!1,transform:h=!1,occlude:u,onOcclude:d,castShadow:f,receiveShadow:p,material:m,geometry:g,zIndexRange:v=[16777271,0],calculatePosition:y=L_e,as:x="div",wrapperClass:S,pointerEvents:A="auto",..._},M)=>{const{gl:E,camera:T,scene:C,size:D,raycaster:B,events:O,viewport:L}=eo(),[H]=we.useState(()=>document.createElement(x)),q=we.useRef(),W=we.useRef(null),I=we.useRef(0),z=we.useRef([0,0]),U=we.useRef(null),X=we.useRef(null),Q=(o==null?void 0:o.current)||O.connected||E.domElement.parentNode,re=we.useRef(null),ie=we.useRef(!1),ce=we.useMemo(()=>u&&u!=="blending"||Array.isArray(u)&&u.length&&z_e(u[0]),[u]);we.useLayoutEffect(()=>{const ve=E.domElement;u&&u==="blending"?(ve.style.zIndex=`${Math.floor(v[0]/2)}`,ve.style.position="absolute",ve.style.pointerEvents="none"):(ve.style.zIndex=null,ve.style.position=null,ve.style.pointerEvents=null)},[u]),we.useLayoutEffect(()=>{if(W.current){const ve=q.current=c4(H);if(C.updateMatrixWorld(),h)H.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const Ee=y(W.current,T,D);H.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${Ee[0]}px,${Ee[1]}px,0);transform-origin:0 0;`}return Q&&(n?Q.prepend(H):Q.appendChild(H)),()=>{Q&&Q.removeChild(H),ve.unmount()}}},[Q,h]),we.useLayoutEffect(()=>{S&&(H.className=S)},[S]);const Z=we.useMemo(()=>h?{position:"absolute",top:0,left:0,width:D.width,height:D.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...a&&{top:-D.height/2,left:-D.width/2,width:D.width,height:D.height},...i},[i,s,a,D,h]),Ae=we.useMemo(()=>({position:"absolute",pointerEvents:A}),[A]);we.useLayoutEffect(()=>{if(ie.current=!1,h){var ve;(ve=q.current)==null||ve.render(we.createElement("div",{ref:U,style:Z},we.createElement("div",{ref:X,style:Ae},we.createElement("div",{ref:M,className:r,style:i,children:t}))))}else{var Ee;(Ee=q.current)==null||Ee.render(we.createElement("div",{ref:M,style:Z,className:r,children:t}))}});const Se=we.useRef(!0);gD(ve=>{if(W.current){T.updateMatrixWorld(),W.current.updateWorldMatrix(!0,!1);const Ee=h?z.current:y(W.current,T,D);if(h||Math.abs(I.current-T.zoom)>e||Math.abs(z.current[0]-Ee[0])>e||Math.abs(z.current[1]-Ee[1])>e){const fe=O_e(W.current,T);let pe=!1;ce&&(Array.isArray(u)?pe=u.map(Ke=>Ke.current):u!=="blending"&&(pe=[C]));const Ie=Se.current;if(pe){const Ke=B_e(W.current,T,B,pe);Se.current=Ke&&!fe}else Se.current=!fe;Ie!==Se.current&&(d?d(!Se.current):H.style.display=Se.current?"block":"none");const Le=Math.floor(v[0]/2),Ge=u?ce?[v[0],Le]:[Le-1,0]:v;if(H.style.zIndex=`${k_e(W.current,T,Ge)}`,h){const[Ke,Ve]=[D.width/2,D.height/2],ke=T.projectionMatrix.elements[5]*Ve,{isOrthographicCamera:ut,top:dt,left:V,bottom:F,right:oe}=T,Ce=N_e(T.matrixWorldInverse),K=ut?`scale(${ke})translate(${ck(-(oe+V)/2)}px,${ck((dt+F)/2)}px)`:`translateZ(${ke}px)`;let Re=W.current.matrixWorld;c&&(Re=T.matrixWorldInverse.clone().transpose().copyPosition(Re).scale(W.current.scale),Re.elements[3]=Re.elements[7]=Re.elements[11]=0,Re.elements[15]=1),H.style.width=D.width+"px",H.style.height=D.height+"px",H.style.perspective=ut?"":`${ke}px`,U.current&&X.current&&(U.current.style.transform=`${K}${Ce}translate(${Ke}px,${Ve}px)`,X.current.style.transform=U_e(Re,1/((l||10)/400)))}else{const Ke=l===void 0?1:F_e(W.current,T)*l;H.style.transform=`translate3d(${Ee[0]}px,${Ee[1]}px,0) scale(${Ke})`}z.current=Ee,I.current=T.zoom}}if(!ce&&re.current&&!ie.current)if(h){if(U.current){const Ee=U.current.children[0];if(Ee!=null&&Ee.clientWidth&&Ee!=null&&Ee.clientHeight){const{isOrthographicCamera:fe}=T;if(fe||g)_.scale&&(Array.isArray(_.scale)?_.scale instanceof le?re.current.scale.copy(_.scale.clone().divideScalar(1)):re.current.scale.set(1/_.scale[0],1/_.scale[1],1/_.scale[2]):re.current.scale.setScalar(1/_.scale));else{const pe=(l||10)/400,Ie=Ee.clientWidth*pe,Le=Ee.clientHeight*pe;re.current.scale.set(Ie,Le,1)}ie.current=!0}}}else{const Ee=H.children[0];if(Ee!=null&&Ee.clientWidth&&Ee!=null&&Ee.clientHeight){const fe=1/L.factor,pe=Ee.clientWidth*fe,Ie=Ee.clientHeight*fe;re.current.scale.set(pe,Ie,1),ie.current=!0}re.current.lookAt(ve.camera.position)}});const _e=we.useMemo(()=>({vertexShader:h?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[h]);return we.createElement("group",lS({},_,{ref:W}),u&&!ce&&we.createElement("mesh",{castShadow:f,receiveShadow:p,ref:re},g||we.createElement("planeGeometry",null),m||we.createElement("shaderMaterial",{side:_c,vertexShader:_e.vertexShader,fragmentShader:_e.fragmentShader})))}),BW=t=>{let e;const i=new Set,r=(c,h)=>{const u=typeof c=="function"?c(e):c;if(!Object.is(u,e)){const d=e;e=h??(typeof u!="object"||u===null)?u:Object.assign({},e,u),i.forEach(f=>f(e,d))}},n=()=>e,o={setState:r,getState:n,getInitialState:()=>l,subscribe:c=>(i.add(c),()=>i.delete(c))},l=e=t(r,n,o);return o},V_e=t=>t?BW(t):BW,H_e=t=>t;function j_e(t,e=H_e){const i=F8.useSyncExternalStore(t.subscribe,()=>e(t.getState()),()=>e(t.getInitialState()));return F8.useDebugValue(i),i}const FW=t=>{const e=V_e(t),i=r=>j_e(e,r);return Object.assign(i,e),i},W_e=t=>t?FW(t):FW;let Xx=0;const X_e=W_e(t=>(Zv.onStart=(e,i,r)=>{t({active:!0,item:e,loaded:i,total:r,progress:(i-Xx)/(r-Xx)*100})},Zv.onLoad=()=>{t({active:!1})},Zv.onError=e=>t(i=>({errors:[...i.errors,e]})),Zv.onProgress=(e,i,r)=>{i===r&&(Xx=r),t({active:!0,item:e,loaded:i,total:r,progress:(i-Xx)/(r-Xx)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Y_e=parseInt(ZS.replace(/\D+/g,""));function kW(t,e){if(e===oie)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(e===r2||e===v4){let i=t.getIndex();if(i===null){const a=[],o=t.getAttribute("position");if(o!==void 0){for(let l=0;l<o.count;l++)a.push(l);t.setIndex(a),i=t.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t}const r=i.count-2,n=[];if(i)if(e===r2)for(let a=1;a<=r;a++)n.push(i.getX(0)),n.push(i.getX(a)),n.push(i.getX(a+1));else for(let a=0;a<r;a++)a%2===0?(n.push(i.getX(a)),n.push(i.getX(a+1)),n.push(i.getX(a+2))):(n.push(i.getX(a+2)),n.push(i.getX(a+1)),n.push(i.getX(a)));n.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=t.clone();return s.setIndex(n),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}var q_e=Object.defineProperty,K_e=(t,e,i)=>e in t?q_e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,ei=(t,e,i)=>(K_e(t,typeof e!="symbol"?e+"":e,i),i);const HE=new L1,NW=new Ou,Q_e=Math.cos(70*(Math.PI/180)),UW=(t,e)=>(t%e+e)%e;let $_e=class extends Yh{constructor(e,i){super(),ei(this,"object"),ei(this,"domElement"),ei(this,"enabled",!0),ei(this,"target",new le),ei(this,"minDistance",0),ei(this,"maxDistance",1/0),ei(this,"minZoom",0),ei(this,"maxZoom",1/0),ei(this,"minPolarAngle",0),ei(this,"maxPolarAngle",Math.PI),ei(this,"minAzimuthAngle",-1/0),ei(this,"maxAzimuthAngle",1/0),ei(this,"enableDamping",!1),ei(this,"dampingFactor",.05),ei(this,"enableZoom",!0),ei(this,"zoomSpeed",1),ei(this,"enableRotate",!0),ei(this,"rotateSpeed",1),ei(this,"enablePan",!0),ei(this,"panSpeed",1),ei(this,"screenSpacePanning",!0),ei(this,"keyPanSpeed",7),ei(this,"zoomToCursor",!1),ei(this,"autoRotate",!1),ei(this,"autoRotateSpeed",2),ei(this,"reverseOrbit",!1),ei(this,"reverseHorizontalOrbit",!1),ei(this,"reverseVerticalOrbit",!1),ei(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),ei(this,"mouseButtons",{LEFT:xm.ROTATE,MIDDLE:xm.DOLLY,RIGHT:xm.PAN}),ei(this,"touches",{ONE:bm.ROTATE,TWO:bm.DOLLY_PAN}),ei(this,"target0"),ei(this,"position0"),ei(this,"zoom0"),ei(this,"_domElementKeyEvents",null),ei(this,"getPolarAngle"),ei(this,"getAzimuthalAngle"),ei(this,"setPolarAngle"),ei(this,"setAzimuthalAngle"),ei(this,"getDistance"),ei(this,"getZoomScale"),ei(this,"listenToKeyEvents"),ei(this,"stopListenToKeyEvents"),ei(this,"saveState"),ei(this,"reset"),ei(this,"update"),ei(this,"connect"),ei(this,"dispose"),ei(this,"dollyIn"),ei(this,"dollyOut"),ei(this,"getScale"),ei(this,"setScale"),this.object=e,this.domElement=i,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>h.phi,this.getAzimuthalAngle=()=>h.theta,this.setPolarAngle=de=>{let Xe=UW(de,2*Math.PI),mt=h.phi;mt<0&&(mt+=2*Math.PI),Xe<0&&(Xe+=2*Math.PI);let J=Math.abs(Xe-mt);2*Math.PI-J<J&&(Xe<mt?Xe+=2*Math.PI:mt+=2*Math.PI),u.phi=Xe-mt,r.update()},this.setAzimuthalAngle=de=>{let Xe=UW(de,2*Math.PI),mt=h.theta;mt<0&&(mt+=2*Math.PI),Xe<0&&(Xe+=2*Math.PI);let J=Math.abs(Xe-mt);2*Math.PI-J<J&&(Xe<mt?Xe+=2*Math.PI:mt+=2*Math.PI),u.theta=Xe-mt,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=de=>{de.addEventListener("keydown",Ze),this._domElementKeyEvents=de},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Ze),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(n),r.update(),l=o.NONE},this.update=(()=>{const de=new le,Xe=new le(0,1,0),mt=new Ds().setFromUnitVectors(e.up,Xe),J=mt.clone().invert(),he=new le,Me=new Ds,Ue=2*Math.PI;return function(){const Mt=r.object.position;mt.setFromUnitVectors(e.up,Xe),J.copy(mt).invert(),de.copy(Mt).sub(r.target),de.applyQuaternion(mt),h.setFromVector3(de),r.autoRotate&&l===o.NONE&&L(B()),r.enableDamping?(h.theta+=u.theta*r.dampingFactor,h.phi+=u.phi*r.dampingFactor):(h.theta+=u.theta,h.phi+=u.phi);let Qt=r.minAzimuthAngle,ci=r.maxAzimuthAngle;isFinite(Qt)&&isFinite(ci)&&(Qt<-Math.PI?Qt+=Ue:Qt>Math.PI&&(Qt-=Ue),ci<-Math.PI?ci+=Ue:ci>Math.PI&&(ci-=Ue),Qt<=ci?h.theta=Math.max(Qt,Math.min(ci,h.theta)):h.theta=h.theta>(Qt+ci)/2?Math.max(Qt,h.theta):Math.min(ci,h.theta)),h.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,h.phi)),h.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(f,r.dampingFactor):r.target.add(f),r.zoomToCursor&&T||r.object.isOrthographicCamera?h.radius=re(h.radius):h.radius=re(h.radius*d),de.setFromSpherical(h),de.applyQuaternion(J),Mt.copy(r.target).add(de),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),r.enableDamping===!0?(u.theta*=1-r.dampingFactor,u.phi*=1-r.dampingFactor,f.multiplyScalar(1-r.dampingFactor)):(u.set(0,0,0),f.set(0,0,0));let ur=!1;if(r.zoomToCursor&&T){let Gt=null;if(r.object instanceof Or&&r.object.isPerspectiveCamera){const Qi=de.length();Gt=re(Qi*d);const Bi=Qi-Gt;r.object.position.addScaledVector(M,Bi),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const Qi=new le(E.x,E.y,0);Qi.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/d)),r.object.updateProjectionMatrix(),ur=!0;const Bi=new le(E.x,E.y,0);Bi.unproject(r.object),r.object.position.sub(Bi).add(Qi),r.object.updateMatrixWorld(),Gt=de.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;Gt!==null&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(Gt).add(r.object.position):(HE.origin.copy(r.object.position),HE.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(HE.direction))<Q_e?e.lookAt(r.target):(NW.setFromNormalAndCoplanarPoint(r.object.up,r.target),HE.intersectPlane(NW,r.target))))}else r.object instanceof Dc&&r.object.isOrthographicCamera&&(ur=d!==1,ur&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/d)),r.object.updateProjectionMatrix()));return d=1,T=!1,ur||he.distanceToSquared(r.object.position)>c||8*(1-Me.dot(r.object.quaternion))>c?(r.dispatchEvent(n),he.copy(r.object.position),Me.copy(r.object.quaternion),ur=!1,!0):!1}})(),this.connect=de=>{r.domElement=de,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",$e),r.domElement.addEventListener("pointerdown",V),r.domElement.addEventListener("pointercancel",oe),r.domElement.addEventListener("wheel",Re)},this.dispose=()=>{var de,Xe,mt,J,he,Me;r.domElement&&(r.domElement.style.touchAction="auto"),(de=r.domElement)==null||de.removeEventListener("contextmenu",$e),(Xe=r.domElement)==null||Xe.removeEventListener("pointerdown",V),(mt=r.domElement)==null||mt.removeEventListener("pointercancel",oe),(J=r.domElement)==null||J.removeEventListener("wheel",Re),(he=r.domElement)==null||he.ownerDocument.removeEventListener("pointermove",F),(Me=r.domElement)==null||Me.ownerDocument.removeEventListener("pointerup",oe),r._domElementKeyEvents!==null&&r._domElementKeyEvents.removeEventListener("keydown",Ze)};const r=this,n={type:"change"},s={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=o.NONE;const c=1e-6,h=new sk,u=new sk;let d=1;const f=new le,p=new tt,m=new tt,g=new tt,v=new tt,y=new tt,x=new tt,S=new tt,A=new tt,_=new tt,M=new le,E=new tt;let T=!1;const C=[],D={};function B(){return 2*Math.PI/60/60*r.autoRotateSpeed}function O(){return Math.pow(.95,r.zoomSpeed)}function L(de){r.reverseOrbit||r.reverseHorizontalOrbit?u.theta+=de:u.theta-=de}function H(de){r.reverseOrbit||r.reverseVerticalOrbit?u.phi+=de:u.phi-=de}const q=(()=>{const de=new le;return function(mt,J){de.setFromMatrixColumn(J,0),de.multiplyScalar(-mt),f.add(de)}})(),W=(()=>{const de=new le;return function(mt,J){r.screenSpacePanning===!0?de.setFromMatrixColumn(J,1):(de.setFromMatrixColumn(J,0),de.crossVectors(r.object.up,de)),de.multiplyScalar(mt),f.add(de)}})(),I=(()=>{const de=new le;return function(mt,J){const he=r.domElement;if(he&&r.object instanceof Or&&r.object.isPerspectiveCamera){const Me=r.object.position;de.copy(Me).sub(r.target);let Ue=de.length();Ue*=Math.tan(r.object.fov/2*Math.PI/180),q(2*mt*Ue/he.clientHeight,r.object.matrix),W(2*J*Ue/he.clientHeight,r.object.matrix)}else he&&r.object instanceof Dc&&r.object.isOrthographicCamera?(q(mt*(r.object.right-r.object.left)/r.object.zoom/he.clientWidth,r.object.matrix),W(J*(r.object.top-r.object.bottom)/r.object.zoom/he.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function z(de){r.object instanceof Or&&r.object.isPerspectiveCamera||r.object instanceof Dc&&r.object.isOrthographicCamera?d=de:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function U(de){z(d/de)}function X(de){z(d*de)}function Q(de){if(!r.zoomToCursor||!r.domElement)return;T=!0;const Xe=r.domElement.getBoundingClientRect(),mt=de.clientX-Xe.left,J=de.clientY-Xe.top,he=Xe.width,Me=Xe.height;E.x=mt/he*2-1,E.y=-(J/Me)*2+1,M.set(E.x,E.y,1).unproject(r.object).sub(r.object.position).normalize()}function re(de){return Math.max(r.minDistance,Math.min(r.maxDistance,de))}function ie(de){p.set(de.clientX,de.clientY)}function ce(de){Q(de),S.set(de.clientX,de.clientY)}function Z(de){v.set(de.clientX,de.clientY)}function Ae(de){m.set(de.clientX,de.clientY),g.subVectors(m,p).multiplyScalar(r.rotateSpeed);const Xe=r.domElement;Xe&&(L(2*Math.PI*g.x/Xe.clientHeight),H(2*Math.PI*g.y/Xe.clientHeight)),p.copy(m),r.update()}function Se(de){A.set(de.clientX,de.clientY),_.subVectors(A,S),_.y>0?U(O()):_.y<0&&X(O()),S.copy(A),r.update()}function _e(de){y.set(de.clientX,de.clientY),x.subVectors(y,v).multiplyScalar(r.panSpeed),I(x.x,x.y),v.copy(y),r.update()}function ve(de){Q(de),de.deltaY<0?X(O()):de.deltaY>0&&U(O()),r.update()}function Ee(de){let Xe=!1;switch(de.code){case r.keys.UP:I(0,r.keyPanSpeed),Xe=!0;break;case r.keys.BOTTOM:I(0,-r.keyPanSpeed),Xe=!0;break;case r.keys.LEFT:I(r.keyPanSpeed,0),Xe=!0;break;case r.keys.RIGHT:I(-r.keyPanSpeed,0),Xe=!0;break}Xe&&(de.preventDefault(),r.update())}function fe(){if(C.length==1)p.set(C[0].pageX,C[0].pageY);else{const de=.5*(C[0].pageX+C[1].pageX),Xe=.5*(C[0].pageY+C[1].pageY);p.set(de,Xe)}}function pe(){if(C.length==1)v.set(C[0].pageX,C[0].pageY);else{const de=.5*(C[0].pageX+C[1].pageX),Xe=.5*(C[0].pageY+C[1].pageY);v.set(de,Xe)}}function Ie(){const de=C[0].pageX-C[1].pageX,Xe=C[0].pageY-C[1].pageY,mt=Math.sqrt(de*de+Xe*Xe);S.set(0,mt)}function Le(){r.enableZoom&&Ie(),r.enablePan&&pe()}function Ge(){r.enableZoom&&Ie(),r.enableRotate&&fe()}function Ke(de){if(C.length==1)m.set(de.pageX,de.pageY);else{const mt=nt(de),J=.5*(de.pageX+mt.x),he=.5*(de.pageY+mt.y);m.set(J,he)}g.subVectors(m,p).multiplyScalar(r.rotateSpeed);const Xe=r.domElement;Xe&&(L(2*Math.PI*g.x/Xe.clientHeight),H(2*Math.PI*g.y/Xe.clientHeight)),p.copy(m)}function Ve(de){if(C.length==1)y.set(de.pageX,de.pageY);else{const Xe=nt(de),mt=.5*(de.pageX+Xe.x),J=.5*(de.pageY+Xe.y);y.set(mt,J)}x.subVectors(y,v).multiplyScalar(r.panSpeed),I(x.x,x.y),v.copy(y)}function ke(de){const Xe=nt(de),mt=de.pageX-Xe.x,J=de.pageY-Xe.y,he=Math.sqrt(mt*mt+J*J);A.set(0,he),_.set(0,Math.pow(A.y/S.y,r.zoomSpeed)),U(_.y),S.copy(A)}function ut(de){r.enableZoom&&ke(de),r.enablePan&&Ve(de)}function dt(de){r.enableZoom&&ke(de),r.enableRotate&&Ke(de)}function V(de){var Xe,mt;r.enabled!==!1&&(C.length===0&&((Xe=r.domElement)==null||Xe.ownerDocument.addEventListener("pointermove",F),(mt=r.domElement)==null||mt.ownerDocument.addEventListener("pointerup",oe)),Qe(de),de.pointerType==="touch"?Ne(de):Ce(de))}function F(de){r.enabled!==!1&&(de.pointerType==="touch"?me(de):K(de))}function oe(de){var Xe,mt,J;Je(de),C.length===0&&((Xe=r.domElement)==null||Xe.releasePointerCapture(de.pointerId),(mt=r.domElement)==null||mt.ownerDocument.removeEventListener("pointermove",F),(J=r.domElement)==null||J.ownerDocument.removeEventListener("pointerup",oe)),r.dispatchEvent(a),l=o.NONE}function Ce(de){let Xe;switch(de.button){case 0:Xe=r.mouseButtons.LEFT;break;case 1:Xe=r.mouseButtons.MIDDLE;break;case 2:Xe=r.mouseButtons.RIGHT;break;default:Xe=-1}switch(Xe){case xm.DOLLY:if(r.enableZoom===!1)return;ce(de),l=o.DOLLY;break;case xm.ROTATE:if(de.ctrlKey||de.metaKey||de.shiftKey){if(r.enablePan===!1)return;Z(de),l=o.PAN}else{if(r.enableRotate===!1)return;ie(de),l=o.ROTATE}break;case xm.PAN:if(de.ctrlKey||de.metaKey||de.shiftKey){if(r.enableRotate===!1)return;ie(de),l=o.ROTATE}else{if(r.enablePan===!1)return;Z(de),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function K(de){if(r.enabled!==!1)switch(l){case o.ROTATE:if(r.enableRotate===!1)return;Ae(de);break;case o.DOLLY:if(r.enableZoom===!1)return;Se(de);break;case o.PAN:if(r.enablePan===!1)return;_e(de);break}}function Re(de){r.enabled===!1||r.enableZoom===!1||l!==o.NONE&&l!==o.ROTATE||(de.preventDefault(),r.dispatchEvent(s),ve(de),r.dispatchEvent(a))}function Ze(de){r.enabled===!1||r.enablePan===!1||Ee(de)}function Ne(de){switch(ot(de),C.length){case 1:switch(r.touches.ONE){case bm.ROTATE:if(r.enableRotate===!1)return;fe(),l=o.TOUCH_ROTATE;break;case bm.PAN:if(r.enablePan===!1)return;pe(),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(r.touches.TWO){case bm.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Le(),l=o.TOUCH_DOLLY_PAN;break;case bm.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Ge(),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function me(de){switch(ot(de),l){case o.TOUCH_ROTATE:if(r.enableRotate===!1)return;Ke(de),r.update();break;case o.TOUCH_PAN:if(r.enablePan===!1)return;Ve(de),r.update();break;case o.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;ut(de),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;dt(de),r.update();break;default:l=o.NONE}}function $e(de){r.enabled!==!1&&de.preventDefault()}function Qe(de){C.push(de)}function Je(de){delete D[de.pointerId];for(let Xe=0;Xe<C.length;Xe++)if(C[Xe].pointerId==de.pointerId){C.splice(Xe,1);return}}function ot(de){let Xe=D[de.pointerId];Xe===void 0&&(Xe=new tt,D[de.pointerId]=Xe),Xe.set(de.pageX,de.pageY)}function nt(de){const Xe=de.pointerId===C[0].pointerId?C[1]:C[0];return D[Xe.pointerId]}this.dollyIn=(de=O())=>{X(de),r.update()},this.dollyOut=(de=O())=>{U(de),r.update()},this.getScale=()=>d,this.setScale=de=>{z(de),r.update()},this.getZoomScale=()=>O(),i!==void 0&&this.connect(i),this.update()}};function l2(t){if(typeof TextDecoder<"u")return new TextDecoder().decode(t);let e="";for(let i=0,r=t.length;i<r;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch{return e}}const Xm="srgb",id="srgb-linear",zW=3001,J_e=3e3;class n5 extends Ya{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new rAe(i)}),this.register(function(i){return new nAe(i)}),this.register(function(i){return new fAe(i)}),this.register(function(i){return new pAe(i)}),this.register(function(i){return new mAe(i)}),this.register(function(i){return new aAe(i)}),this.register(function(i){return new oAe(i)}),this.register(function(i){return new lAe(i)}),this.register(function(i){return new cAe(i)}),this.register(function(i){return new iAe(i)}),this.register(function(i){return new hAe(i)}),this.register(function(i){return new sAe(i)}),this.register(function(i){return new dAe(i)}),this.register(function(i){return new uAe(i)}),this.register(function(i){return new eAe(i)}),this.register(function(i){return new gAe(i)}),this.register(function(i){return new vAe(i)})}load(e,i,r,n){const s=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const c=Zf.extractUrlBase(e);a=Zf.resolveURL(c,this.path)}else a=Zf.extractUrlBase(e);this.manager.itemStart(e);const o=function(c){n?n(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},l=new Xo(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{s.parse(c,a,function(h){i(h),s.manager.itemEnd(e)},o)}catch(h){o(h)}},r,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,r,n){let s;const a={},o={};if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l2(new Uint8Array(e.slice(0,4)))===Lre){try{a[Ci.KHR_BINARY_GLTF]=new yAe(e)}catch(h){n&&n(h);return}s=JSON.parse(a[Ci.KHR_BINARY_GLTF].content)}else s=JSON.parse(l2(new Uint8Array(e)));else s=e;if(s.asset===void 0||s.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new RAe(s,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const h=this.pluginCallbacks[c](l);h.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[h.name]=h,a[h.name]=!0}if(s.extensionsUsed)for(let c=0;c<s.extensionsUsed.length;++c){const h=s.extensionsUsed[c],u=s.extensionsRequired||[];switch(h){case Ci.KHR_MATERIALS_UNLIT:a[h]=new tAe;break;case Ci.KHR_DRACO_MESH_COMPRESSION:a[h]=new xAe(s,this.dracoLoader);break;case Ci.KHR_TEXTURE_TRANSFORM:a[h]=new bAe;break;case Ci.KHR_MESH_QUANTIZATION:a[h]=new wAe;break;default:u.indexOf(h)>=0&&o[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}l.setExtensions(a),l.setPlugins(o),l.parse(r,n)}parseAsync(e,i){const r=this;return new Promise(function(n,s){r.parse(e,i,n,s)})}}function Z_e(){let t={};return{get:function(e){return t[e]},add:function(e,i){t[e]=i},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const Ci={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class eAe{constructor(e){this.parser=e,this.name=Ci.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,i=this.parser.json.nodes||[];for(let r=0,n=i.length;r<n;r++){const s=i[r];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const i=this.parser,r="light:"+e;let n=i.cache.get(r);if(n)return n;const s=i.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const h=new Ct(16777215);l.color!==void 0&&h.setRGB(l.color[0],l.color[1],l.color[2],id);const u=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new K4(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new q4(h),c.distance=u;break;case"spot":c=new Y4(h),c.distance=u,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,Tu(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=i.createUniqueName(l.name||"light_"+e),n=Promise.resolve(c),i.cache.add(r,n),n}getDependency(e,i){if(e==="light")return this._loadLight(i)}createNodeAttachment(e){const i=this,r=this.parser,s=r.json.nodes[e],o=(s.extensions&&s.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(l){return r._getNodeRef(i.cache,o,l)})}}class tAe{constructor(){this.name=Ci.KHR_MATERIALS_UNLIT}getMaterialType(){return ko}extendParams(e,i,r){const n=[];e.color=new Ct(1,1,1),e.opacity=1;const s=i.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const a=s.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],id),e.opacity=a[3]}s.baseColorTexture!==void 0&&n.push(r.assignTexture(e,"map",s.baseColorTexture,Xm))}return Promise.all(n)}}class iAe{constructor(e){this.parser=e,this.name=Ci.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,i){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name].emissiveStrength;return s!==void 0&&(i.emissiveIntensity=s),Promise.resolve()}}class rAe{constructor(e){this.parser=e,this.name=Ci.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:ql}extendMaterialParams(e,i){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];if(a.clearcoatFactor!==void 0&&(i.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&s.push(r.assignTexture(i,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&s.push(r.assignTexture(i,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(s.push(r.assignTexture(i,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const o=a.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new tt(o,o)}return Promise.all(s)}}class nAe{constructor(e){this.parser=e,this.name=Ci.KHR_MATERIALS_DISPERSION}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:ql}extendMaterialParams(e,i){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return i.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class sAe{constructor(e){this.parser=e,this.name=Ci.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:ql}extendMaterialParams(e,i){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return a.iridescenceFactor!==void 0&&(i.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&s.push(r.assignTexture(i,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(i.iridescenceIOR=a.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&s.push(r.assignTexture(i,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(s)}}class aAe{constructor(e){this.parser=e,this.name=Ci.KHR_MATERIALS_SHEEN}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:ql}extendMaterialParams(e,i){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[];i.sheenColor=new Ct(0,0,0),i.sheenRoughness=0,i.sheen=1;const a=n.extensions[this.name];if(a.sheenColorFactor!==void 0){const o=a.sheenColorFactor;i.sheenColor.setRGB(o[0],o[1],o[2],id)}return a.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&s.push(r.assignTexture(i,"sheenColorMap",a.sheenColorTexture,Xm)),a.sheenRoughnessTexture!==void 0&&s.push(r.assignTexture(i,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(s)}}class oAe{constructor(e){this.parser=e,this.name=Ci.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:ql}extendMaterialParams(e,i){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return a.transmissionFactor!==void 0&&(i.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&s.push(r.assignTexture(i,"transmissionMap",a.transmissionTexture)),Promise.all(s)}}class lAe{constructor(e){this.parser=e,this.name=Ci.KHR_MATERIALS_VOLUME}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:ql}extendMaterialParams(e,i){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];i.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&s.push(r.assignTexture(i,"thicknessMap",a.thicknessTexture)),i.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return i.attenuationColor=new Ct().setRGB(o[0],o[1],o[2],id),Promise.all(s)}}class cAe{constructor(e){this.parser=e,this.name=Ci.KHR_MATERIALS_IOR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:ql}extendMaterialParams(e,i){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return i.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class hAe{constructor(e){this.parser=e,this.name=Ci.KHR_MATERIALS_SPECULAR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:ql}extendMaterialParams(e,i){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];i.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&s.push(r.assignTexture(i,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return i.specularColor=new Ct().setRGB(o[0],o[1],o[2],id),a.specularColorTexture!==void 0&&s.push(r.assignTexture(i,"specularColorMap",a.specularColorTexture,Xm)),Promise.all(s)}}class uAe{constructor(e){this.parser=e,this.name=Ci.EXT_MATERIALS_BUMP}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:ql}extendMaterialParams(e,i){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return i.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&s.push(r.assignTexture(i,"bumpMap",a.bumpTexture)),Promise.all(s)}}class dAe{constructor(e){this.parser=e,this.name=Ci.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:ql}extendMaterialParams(e,i){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return a.anisotropyStrength!==void 0&&(i.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(i.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&s.push(r.assignTexture(i,"anisotropyMap",a.anisotropyTexture)),Promise.all(s)}}class fAe{constructor(e){this.parser=e,this.name=Ci.KHR_TEXTURE_BASISU}loadTexture(e){const i=this.parser,r=i.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const s=n.extensions[this.name],a=i.options.ktx2Loader;if(!a){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(e,s.source,a)}}class pAe{constructor(e){this.parser=e,this.name=Ci.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const i=this.name,r=this.parser,n=r.json,s=n.textures[e];if(!s.extensions||!s.extensions[i])return null;const a=s.extensions[i],o=n.images[a.source];let l=r.textureLoader;if(o.uri){const c=r.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(e,a.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class mAe{constructor(e){this.parser=e,this.name=Ci.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const i=this.name,r=this.parser,n=r.json,s=n.textures[e];if(!s.extensions||!s.extensions[i])return null;const a=s.extensions[i],o=n.images[a.source];let l=r.textureLoader;if(o.uri){const c=r.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(e,a.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class gAe{constructor(e){this.name=Ci.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const i=this.parser.json,r=i.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const n=r.extensions[this.name],s=this.parser.getDependency("buffer",n.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(o){const l=n.byteOffset||0,c=n.byteLength||0,h=n.count,u=n.byteStride,d=new Uint8Array(o,l,c);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(h,u,d,n.mode,n.filter).then(function(f){return f.buffer}):a.ready.then(function(){const f=new ArrayBuffer(h*u);return a.decodeGltfBuffer(new Uint8Array(f),h,u,d,n.mode,n.filter),f})})}else return null}}class vAe{constructor(e){this.name=Ci.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const i=this.parser.json,r=i.nodes[e];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;const n=i.meshes[r.mesh];for(const c of n.primitives)if(c.mode!==xl.TRIANGLES&&c.mode!==xl.TRIANGLE_STRIP&&c.mode!==xl.TRIANGLE_FAN&&c.mode!==void 0)return null;const a=r.extensions[this.name].attributes,o=[],l={};for(const c in a)o.push(this.parser.getDependency("accessor",a[c]).then(h=>(l[c]=h,l[c])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(c=>{const h=c.pop(),u=h.isGroup?h.children:[h],d=c[0].count,f=[];for(const p of u){const m=new ui,g=new le,v=new Ds,y=new le(1,1,1),x=new R4(p.geometry,p.material,d);for(let S=0;S<d;S++)l.TRANSLATION&&g.fromBufferAttribute(l.TRANSLATION,S),l.ROTATION&&v.fromBufferAttribute(l.ROTATION,S),l.SCALE&&y.fromBufferAttribute(l.SCALE,S),x.setMatrixAt(S,m.compose(g,v,y));for(const S in l)if(S==="_COLOR_0"){const A=l[S];x.instanceColor=new Og(A.array,A.itemSize,A.normalized)}else S!=="TRANSLATION"&&S!=="ROTATION"&&S!=="SCALE"&&p.geometry.setAttribute(S,l[S]);zi.prototype.copy.call(x,p),this.parser.assignFinalMaterial(x),f.push(x)}return h.isGroup?(h.clear(),h.add(...f),h):f[0]}))}}const Lre="glTF",Yx=12,GW={JSON:1313821514,BIN:5130562};class yAe{constructor(e){this.name=Ci.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(e,0,Yx);if(this.header={magic:l2(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==Lre)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-Yx,n=new DataView(e,Yx);let s=0;for(;s<r;){const a=n.getUint32(s,!0);s+=4;const o=n.getUint32(s,!0);if(s+=4,o===GW.JSON){const l=new Uint8Array(e,Yx+s,a);this.content=l2(l)}else if(o===GW.BIN){const l=Yx+s;this.body=e.slice(l,l+a)}s+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class xAe{constructor(e,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ci.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(e,i){const r=this.json,n=this.dracoLoader,s=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},l={},c={};for(const h in a){const u=hk[h]||h.toLowerCase();o[u]=a[h]}for(const h in e.attributes){const u=hk[h]||h.toLowerCase();if(a[h]!==void 0){const d=r.accessors[e.attributes[h]],f=Ay[d.componentType];c[u]=f.name,l[u]=d.normalized===!0}}return i.getDependency("bufferView",s).then(function(h){return new Promise(function(u,d){n.decodeDracoFile(h,function(f){for(const p in f.attributes){const m=f.attributes[p],g=l[p];g!==void 0&&(m.normalized=g)}u(f)},o,c,id,d)})})}}class bAe{constructor(){this.name=Ci.KHR_TEXTURE_TRANSFORM}extendTexture(e,i){return(i.texCoord===void 0||i.texCoord===e.channel)&&i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(e=e.clone(),i.texCoord!==void 0&&(e.channel=i.texCoord),i.offset!==void 0&&e.offset.fromArray(i.offset),i.rotation!==void 0&&(e.rotation=i.rotation),i.scale!==void 0&&e.repeat.fromArray(i.scale),e.needsUpdate=!0),e}}class wAe{constructor(){this.name=Ci.KHR_MESH_QUANTIZATION}}class Ore extends U1{constructor(e,i,r,n){super(e,i,r,n)}copySampleValue_(e){const i=this.resultBuffer,r=this.sampleValues,n=this.valueSize,s=e*n*3+n;for(let a=0;a!==n;a++)i[a]=r[s+a];return i}interpolate_(e,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=o*2,c=o*3,h=n-i,u=(r-i)/h,d=u*u,f=d*u,p=e*c,m=p-c,g=-2*f+3*d,v=f-d,y=1-g,x=v-d+u;for(let S=0;S!==o;S++){const A=a[m+S+o],_=a[m+S+l]*h,M=a[p+S+o],E=a[p+S]*h;s[S]=y*A+x*_+g*M+v*E}return s}}const SAe=new Ds;class _Ae extends Ore{interpolate_(e,i,r,n){const s=super.interpolate_(e,i,r,n);return SAe.fromArray(s).normalize().toArray(s),s}}const xl={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ay={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},VW={9728:xn,9729:Hr,9984:$w,9985:iD,9986:Jw,9987:_d},HW={33071:js,33648:Ky,10497:dp},CL={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},hk={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...Y_e>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Kd={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},AAe={CUBICSPLINE:void 0,LINEAR:Lg,STEP:$y},PL={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function EAe(t){return t.DefaultMaterial===void 0&&(t.DefaultMaterial=new y_({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:cp})),t.DefaultMaterial}function rm(t,e,i){for(const r in i.extensions)t[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=i.extensions[r])}function Tu(t,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function MAe(t,e,i){let r=!1,n=!1,s=!1;for(let c=0,h=e.length;c<h;c++){const u=e[c];if(u.POSITION!==void 0&&(r=!0),u.NORMAL!==void 0&&(n=!0),u.COLOR_0!==void 0&&(s=!0),r&&n&&s)break}if(!r&&!n&&!s)return Promise.resolve(t);const a=[],o=[],l=[];for(let c=0,h=e.length;c<h;c++){const u=e[c];if(r){const d=u.POSITION!==void 0?i.getDependency("accessor",u.POSITION):t.attributes.position;a.push(d)}if(n){const d=u.NORMAL!==void 0?i.getDependency("accessor",u.NORMAL):t.attributes.normal;o.push(d)}if(s){const d=u.COLOR_0!==void 0?i.getDependency("accessor",u.COLOR_0):t.attributes.color;l.push(d)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(c){const h=c[0],u=c[1],d=c[2];return r&&(t.morphAttributes.position=h),n&&(t.morphAttributes.normal=u),s&&(t.morphAttributes.color=d),t.morphTargetsRelative=!0,t})}function TAe(t,e){if(t.updateMorphTargets(),e.weights!==void 0)for(let i=0,r=e.weights.length;i<r;i++)t.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++)t.morphTargetDictionary[i[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function CAe(t){let e;const i=t.extensions&&t.extensions[Ci.KHR_DRACO_MESH_COMPRESSION];if(i?e="draco:"+i.bufferView+":"+i.indices+":"+DL(i.attributes):e=t.indices+":"+DL(t.attributes)+":"+t.mode,t.targets!==void 0)for(let r=0,n=t.targets.length;r<n;r++)e+=":"+DL(t.targets[r]);return e}function DL(t){let e="";const i=Object.keys(t).sort();for(let r=0,n=i.length;r<n;r++)e+=i[r]+":"+t[i[r]]+";";return e}function uk(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function PAe(t){return t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0?"image/jpeg":t.search(/\.webp($|\?)/i)>0||t.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const DAe=new ui;class RAe{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new Z_e,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,n=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,s=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||r||n&&s<98?this.textureLoader=new x_(this.options.manager):this.textureLoader=new rre(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Xo(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,i){const r=this,n=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(a){const o={scene:a[0][n.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:n.asset,parser:r,userData:{}};return rm(s,o,n),Tu(o,n),Promise.all(r._invokeAll(function(l){return l.afterRoot&&l.afterRoot(o)})).then(function(){for(const l of o.scenes)l.updateMatrixWorld();e(o)})}).catch(i)}_markDefs(){const e=this.json.nodes||[],i=this.json.skins||[],r=this.json.meshes||[];for(let n=0,s=i.length;n<s;n++){const a=i[n].joints;for(let o=0,l=a.length;o<l;o++)e[a[o]].isBone=!0}for(let n=0,s=e.length;n<s;n++){const a=e[n];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(r[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,i){i!==void 0&&(e.refs[i]===void 0&&(e.refs[i]=e.uses[i]=0),e.refs[i]++)}_getNodeRef(e,i,r){if(e.refs[i]<=1)return r;const n=r.clone(),s=(a,o)=>{const l=this.associations.get(a);l!=null&&this.associations.set(o,l);for(const[c,h]of a.children.entries())s(h,o.children[c])};return s(r,n),n.name+="_instance_"+e.uses[i]++,n}_invokeOne(e){const i=Object.values(this.plugins);i.push(this);for(let r=0;r<i.length;r++){const n=e(i[r]);if(n)return n}return null}_invokeAll(e){const i=Object.values(this.plugins);i.unshift(this);const r=[];for(let n=0;n<i.length;n++){const s=e(i[n]);s&&r.push(s)}return r}getDependency(e,i){const r=e+":"+i;let n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(i);break;case"node":n=this._invokeOne(function(s){return s.loadNode&&s.loadNode(i)});break;case"mesh":n=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(i)});break;case"accessor":n=this.loadAccessor(i);break;case"bufferView":n=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(i)});break;case"buffer":n=this.loadBuffer(i);break;case"material":n=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(i)});break;case"texture":n=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(i)});break;case"skin":n=this.loadSkin(i);break;case"animation":n=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(i)});break;case"camera":n=this.loadCamera(i);break;default:if(n=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,i)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(r,n)}return n}getDependencies(e){let i=this.cache.get(e);if(!i){const r=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];i=Promise.all(n.map(function(s,a){return r.getDependency(e,a)})),this.cache.add(e,i)}return i}loadBuffer(e){const i=this.json.buffers[e],r=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&e===0)return Promise.resolve(this.extensions[Ci.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(s,a){r.load(Zf.resolveURL(i.uri,n.path),s,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(r){const n=i.byteLength||0,s=i.byteOffset||0;return r.slice(s,s+n)})}loadAccessor(e){const i=this,r=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const a=CL[n.type],o=Ay[n.componentType],l=n.normalized===!0,c=new o(n.count*a);return Promise.resolve(new Xi(c,a,l))}const s=[];return n.bufferView!==void 0?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),n.sparse!==void 0&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then(function(a){const o=a[0],l=CL[n.type],c=Ay[n.componentType],h=c.BYTES_PER_ELEMENT,u=h*l,d=n.byteOffset||0,f=n.bufferView!==void 0?r.bufferViews[n.bufferView].byteStride:void 0,p=n.normalized===!0;let m,g;if(f&&f!==u){const v=Math.floor(d/f),y="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+v+":"+n.count;let x=i.cache.get(y);x||(m=new c(o,v*f,n.count*f/h),x=new n_(m,f/h),i.cache.add(y,x)),g=new pp(x,l,d%f/h,p)}else o===null?m=new c(n.count*l):m=new c(o,d,n.count*l),g=new Xi(m,l,p);if(n.sparse!==void 0){const v=CL.SCALAR,y=Ay[n.sparse.indices.componentType],x=n.sparse.indices.byteOffset||0,S=n.sparse.values.byteOffset||0,A=new y(a[1],x,n.sparse.count*v),_=new c(a[2],S,n.sparse.count*l);o!==null&&(g=new Xi(g.array.slice(),g.itemSize,g.normalized));for(let M=0,E=A.length;M<E;M++){const T=A[M];if(g.setX(T,_[M*l]),l>=2&&g.setY(T,_[M*l+1]),l>=3&&g.setZ(T,_[M*l+2]),l>=4&&g.setW(T,_[M*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const i=this.json,r=this.options,s=i.textures[e].source,a=i.images[s];let o=this.textureLoader;if(a.uri){const l=r.manager.getHandler(a.uri);l!==null&&(o=l)}return this.loadTextureImage(e,s,o)}loadTextureImage(e,i,r){const n=this,s=this.json,a=s.textures[e],o=s.images[i],l=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(i,r).then(function(h){h.flipY=!1,h.name=a.name||o.name||"",h.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(h.name=o.uri);const d=(s.samplers||{})[a.sampler]||{};return h.magFilter=VW[d.magFilter]||Hr,h.minFilter=VW[d.minFilter]||_d,h.wrapS=HW[d.wrapS]||dp,h.wrapT=HW[d.wrapT]||dp,n.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,i){const r=this,n=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const a=n.images[e],o=self.URL||self.webkitURL;let l=a.uri||"",c=!1;if(a.bufferView!==void 0)l=r.getDependency("bufferView",a.bufferView).then(function(u){c=!0;const d=new Blob([u],{type:a.mimeType});return l=o.createObjectURL(d),l});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(u){return new Promise(function(d,f){let p=d;i.isImageBitmapLoader===!0&&(p=function(m){const g=new kr(m);g.needsUpdate=!0,d(g)}),i.load(Zf.resolveURL(u,s.path),p,void 0,f)})}).then(function(u){return c===!0&&o.revokeObjectURL(l),Tu(u,a),u.userData.mimeType=a.mimeType||PAe(a.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),u});return this.sourceCache[e]=h,h}assignTexture(e,i,r,n){const s=this;return this.getDependency("texture",r.index).then(function(a){if(!a)return null;if(r.texCoord!==void 0&&r.texCoord>0&&(a=a.clone(),a.channel=r.texCoord),s.extensions[Ci.KHR_TEXTURE_TRANSFORM]){const o=r.extensions!==void 0?r.extensions[Ci.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const l=s.associations.get(a);a=s.extensions[Ci.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),s.associations.set(a,l)}}return n!==void 0&&(typeof n=="number"&&(n=n===zW?Xm:id),"colorSpace"in a?a.colorSpace=n:a.encoding=n===Xm?zW:J_e),e[i]=a,a})}assignFinalMaterial(e){const i=e.geometry;let r=e.material;const n=i.attributes.tangent===void 0,s=i.attributes.color!==void 0,a=i.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+r.uuid;let l=this.cache.get(o);l||(l=new hD,kn.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,l.sizeAttenuation=!1,this.cache.add(o,l)),r=l}else if(e.isLine){const o="LineBasicMaterial:"+r.uuid;let l=this.cache.get(o);l||(l=new wa,kn.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,this.cache.add(o,l)),r=l}if(n||s||a){let o="ClonedMaterial:"+r.uuid+":";n&&(o+="derivative-tangents:"),s&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let l=this.cache.get(o);l||(l=r.clone(),s&&(l.vertexColors=!0),a&&(l.flatShading=!0),n&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(o,l),this.associations.set(l,this.associations.get(r))),r=l}e.material=r}getMaterialType(){return y_}loadMaterial(e){const i=this,r=this.json,n=this.extensions,s=r.materials[e];let a;const o={},l=s.extensions||{},c=[];if(l[Ci.KHR_MATERIALS_UNLIT]){const u=n[Ci.KHR_MATERIALS_UNLIT];a=u.getMaterialType(),c.push(u.extendParams(o,s,i))}else{const u=s.pbrMetallicRoughness||{};if(o.color=new Ct(1,1,1),o.opacity=1,Array.isArray(u.baseColorFactor)){const d=u.baseColorFactor;o.color.setRGB(d[0],d[1],d[2],id),o.opacity=d[3]}u.baseColorTexture!==void 0&&c.push(i.assignTexture(o,"map",u.baseColorTexture,Xm)),o.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,o.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(i.assignTexture(o,"metalnessMap",u.metallicRoughnessTexture)),c.push(i.assignTexture(o,"roughnessMap",u.metallicRoughnessTexture))),a=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,o)})))}s.doubleSided===!0&&(o.side=_c);const h=s.alphaMode||PL.OPAQUE;if(h===PL.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,h===PL.MASK&&(o.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&a!==ko&&(c.push(i.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new tt(1,1),s.normalTexture.scale!==void 0)){const u=s.normalTexture.scale;o.normalScale.set(u,u)}if(s.occlusionTexture!==void 0&&a!==ko&&(c.push(i.assignTexture(o,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&a!==ko){const u=s.emissiveFactor;o.emissive=new Ct().setRGB(u[0],u[1],u[2],id)}return s.emissiveTexture!==void 0&&a!==ko&&c.push(i.assignTexture(o,"emissiveMap",s.emissiveTexture,Xm)),Promise.all(c).then(function(){const u=new a(o);return s.name&&(u.name=s.name),Tu(u,s),i.associations.set(u,{materials:e}),s.extensions&&rm(n,u,s),u})}createUniqueName(e){const i=Ui.sanitizeNodeName(e||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(e){const i=this,r=this.extensions,n=this.primitiveCache;function s(o){return r[Ci.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,i).then(function(l){return jW(l,o,i)})}const a=[];for(let o=0,l=e.length;o<l;o++){const c=e[o],h=CAe(c),u=n[h];if(u)a.push(u.promise);else{let d;c.extensions&&c.extensions[Ci.KHR_DRACO_MESH_COMPRESSION]?d=s(c):d=jW(new xi,c,i),n[h]={primitive:c,promise:d},a.push(d)}}return Promise.all(a)}loadMesh(e){const i=this,r=this.json,n=this.extensions,s=r.meshes[e],a=s.primitives,o=[];for(let l=0,c=a.length;l<c;l++){const h=a[l].material===void 0?EAe(this.cache):this.getDependency("material",a[l].material);o.push(h)}return o.push(i.loadGeometries(a)),Promise.all(o).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],u=[];for(let f=0,p=h.length;f<p;f++){const m=h[f],g=a[f];let v;const y=c[f];if(g.mode===xl.TRIANGLES||g.mode===xl.TRIANGLE_STRIP||g.mode===xl.TRIANGLE_FAN||g.mode===void 0)v=s.isSkinnedMesh===!0?new D4(m,y):new Ms(m,y),v.isSkinnedMesh===!0&&v.normalizeSkinWeights(),g.mode===xl.TRIANGLE_STRIP?v.geometry=kW(v.geometry,v4):g.mode===xl.TRIANGLE_FAN&&(v.geometry=kW(v.geometry,r2));else if(g.mode===xl.LINES)v=new kc(m,y);else if(g.mode===xl.LINE_STRIP)v=new dd(m,y);else if(g.mode===xl.LINE_LOOP)v=new I4(m,y);else if(g.mode===xl.POINTS)v=new L4(m,y);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(v.geometry.morphAttributes).length>0&&TAe(v,s),v.name=i.createUniqueName(s.name||"mesh_"+e),Tu(v,s),g.extensions&&rm(n,v,g),i.assignFinalMaterial(v),u.push(v)}for(let f=0,p=u.length;f<p;f++)i.associations.set(u[f],{meshes:e,primitives:f});if(u.length===1)return s.extensions&&rm(n,u[0],s),u[0];const d=new Yu;s.extensions&&rm(n,d,s),i.associations.set(d,{meshes:e});for(let f=0,p=u.length;f<p;f++)d.add(u[f]);return d})}loadCamera(e){let i;const r=this.json.cameras[e],n=r[r.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?i=new Or(x4.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):r.type==="orthographic"&&(i=new Dc(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),r.name&&(i.name=this.createUniqueName(r.name)),Tu(i,r),Promise.resolve(i)}loadSkin(e){const i=this.json.skins[e],r=[];for(let n=0,s=i.joints.length;n<s;n++)r.push(this._loadNodeShallow(i.joints[n]));return i.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",i.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(n){const s=n.pop(),a=n,o=[],l=[];for(let c=0,h=a.length;c<h;c++){const u=a[c];if(u){o.push(u);const d=new ui;s!==null&&d.fromArray(s.array,c*16),l.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[c])}return new s_(o,l)})}loadAnimation(e){const i=this.json,r=this,n=i.animations[e],s=n.name?n.name:"animation_"+e,a=[],o=[],l=[],c=[],h=[];for(let u=0,d=n.channels.length;u<d;u++){const f=n.channels[u],p=n.samplers[f.sampler],m=f.target,g=m.node,v=n.parameters!==void 0?n.parameters[p.input]:p.input,y=n.parameters!==void 0?n.parameters[p.output]:p.output;m.node!==void 0&&(a.push(this.getDependency("node",g)),o.push(this.getDependency("accessor",v)),l.push(this.getDependency("accessor",y)),c.push(p),h.push(m))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(u){const d=u[0],f=u[1],p=u[2],m=u[3],g=u[4],v=[];for(let y=0,x=d.length;y<x;y++){const S=d[y],A=f[y],_=p[y],M=m[y],E=g[y];if(S===void 0)continue;S.updateMatrix&&S.updateMatrix();const T=r._createAnimationTracks(S,A,_,M,E);if(T)for(let C=0;C<T.length;C++)v.push(T[C])}return new Zy(s,void 0,v)})}createNodeMesh(e){const i=this.json,r=this,n=i.nodes[e];return n.mesh===void 0?null:r.getDependency("mesh",n.mesh).then(function(s){const a=r._getNodeRef(r.meshCache,n.mesh,s);return n.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let l=0,c=n.weights.length;l<c;l++)o.morphTargetInfluences[l]=n.weights[l]}),a})}loadNode(e){const i=this.json,r=this,n=i.nodes[e],s=r._loadNodeShallow(e),a=[],o=n.children||[];for(let c=0,h=o.length;c<h;c++)a.push(r.getDependency("node",o[c]));const l=n.skin===void 0?Promise.resolve(null):r.getDependency("skin",n.skin);return Promise.all([s,Promise.all(a),l]).then(function(c){const h=c[0],u=c[1],d=c[2];d!==null&&h.traverse(function(f){f.isSkinnedMesh&&f.bind(d,DAe)});for(let f=0,p=u.length;f<p;f++)h.add(u[f]);return h})}_loadNodeShallow(e){const i=this.json,r=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=i.nodes[e],a=s.name?n.createUniqueName(s.name):"",o=[],l=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&o.push(l),s.camera!==void 0&&o.push(n.getDependency("camera",s.camera).then(function(c){return n._getNodeRef(n.cameraCache,s.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){o.push(c)}),this.nodeCache[e]=Promise.all(o).then(function(c){let h;if(s.isBone===!0?h=new cD:c.length>1?h=new Yu:c.length===1?h=c[0]:h=new zi,h!==c[0])for(let u=0,d=c.length;u<d;u++)h.add(c[u]);if(s.name&&(h.userData.name=s.name,h.name=a),Tu(h,s),s.extensions&&rm(r,h,s),s.matrix!==void 0){const u=new ui;u.fromArray(s.matrix),h.applyMatrix4(u)}else s.translation!==void 0&&h.position.fromArray(s.translation),s.rotation!==void 0&&h.quaternion.fromArray(s.rotation),s.scale!==void 0&&h.scale.fromArray(s.scale);return n.associations.has(h)||n.associations.set(h,{}),n.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const i=this.extensions,r=this.json.scenes[e],n=this,s=new Yu;r.name&&(s.name=n.createUniqueName(r.name)),Tu(s,r),r.extensions&&rm(i,s,r);const a=r.nodes||[],o=[];for(let l=0,c=a.length;l<c;l++)o.push(n.getDependency("node",a[l]));return Promise.all(o).then(function(l){for(let h=0,u=l.length;h<u;h++)s.add(l[h]);const c=h=>{const u=new Map;for(const[d,f]of n.associations)(d instanceof kn||d instanceof kr)&&u.set(d,f);return h.traverse(d=>{const f=n.associations.get(d);f!=null&&u.set(d,f)}),u};return n.associations=c(s),s})}_createAnimationTracks(e,i,r,n,s){const a=[],o=e.name?e.name:e.uuid,l=[];Kd[s.path]===Kd.weights?e.traverse(function(d){d.morphTargetInfluences&&l.push(d.name?d.name:d.uuid)}):l.push(o);let c;switch(Kd[s.path]){case Kd.weights:c=Fg;break;case Kd.rotation:c=mp;break;case Kd.position:case Kd.scale:c=kg;break;default:switch(r.itemSize){case 1:c=Fg;break;case 2:case 3:default:c=kg;break}break}const h=n.interpolation!==void 0?AAe[n.interpolation]:Lg,u=this._getArrayFromAccessor(r);for(let d=0,f=l.length;d<f;d++){const p=new c(l[d]+"."+Kd[s.path],i.array,u,h);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),a.push(p)}return a}_getArrayFromAccessor(e){let i=e.array;if(e.normalized){const r=uk(i.constructor),n=new Float32Array(i.length);for(let s=0,a=i.length;s<a;s++)n[s]=i[s]*r;i=n}return i}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(r){const n=this instanceof mp?_Ae:Ore;return new n(this.times,this.values,this.getValueSize()/3,r)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function IAe(t,e,i){const r=e.attributes,n=new Ad;if(r.POSITION!==void 0){const o=i.json.accessors[r.POSITION],l=o.min,c=o.max;if(l!==void 0&&c!==void 0){if(n.set(new le(l[0],l[1],l[2]),new le(c[0],c[1],c[2])),o.normalized){const h=uk(Ay[o.componentType]);n.min.multiplyScalar(h),n.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const o=new le,l=new le;for(let c=0,h=s.length;c<h;c++){const u=s[c];if(u.POSITION!==void 0){const d=i.json.accessors[u.POSITION],f=d.min,p=d.max;if(f!==void 0&&p!==void 0){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),d.normalized){const m=uk(Ay[d.componentType]);l.multiplyScalar(m)}o.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(o)}t.boundingBox=n;const a=new Ed;n.getCenter(a.center),a.radius=n.min.distanceTo(n.max)/2,t.boundingSphere=a}function jW(t,e,i){const r=e.attributes,n=[];function s(a,o){return i.getDependency("accessor",a).then(function(l){t.setAttribute(o,l)})}for(const a in r){const o=hk[a]||a.toLowerCase();o in t.attributes||n.push(s(r[a],o))}if(e.indices!==void 0&&!t.index){const a=i.getDependency("accessor",e.indices).then(function(o){t.setIndex(o)});n.push(a)}return Tu(t,e),IAe(t,e,i),Promise.all(n).then(function(){return e.targets!==void 0?MAe(t,e.targets,i):t})}const RL=new WeakMap;class LAe extends Ya{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,r,n){const s=new Xo(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,a=>{const o={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(a,o).then(i).catch(n)},r,n)}decodeDracoFile(e,i,r,n){const s={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,s).then(i)}decodeGeometry(e,i){for(const l in i.attributeTypes){const c=i.attributeTypes[l];c.BYTES_PER_ELEMENT!==void 0&&(i.attributeTypes[l]=c.name)}const r=JSON.stringify(i);if(RL.has(e)){const l=RL.get(e);if(l.key===r)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const s=this.workerNextTaskID++,a=e.byteLength,o=this._getWorker(s,a).then(l=>(n=l,new Promise((c,h)=>{n._callbacks[s]={resolve:c,reject:h},n.postMessage({type:"decode",id:s,taskConfig:i,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return o.catch(()=>!0).then(()=>{n&&s&&this._releaseTask(n,s)}),RL.set(e,{key:r,promise:o}),o}_createGeometry(e){const i=new xi;e.index&&i.setIndex(new Xi(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r],s=n.name,a=n.array,o=n.itemSize;i.setAttribute(s,new Xi(a,o))}return i}_loadLibrary(e,i){const r=new Xo(this.manager);return r.setPath(this.decoderPath),r.setResponseType(i),r.setWithCredentials(this.withCredentials),new Promise((n,s)=>{r.load(e,n,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",i=[];return e?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then(r=>{const n=r[0];e||(this.decoderConfig.wasmBinary=r[1]);const s=OAe.toString(),a=["/* draco decoder */",n,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,i){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(s){const a=s.data;switch(a.type){case"decode":n._callbacks[a.id].resolve(a);break;case"error":n._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,s){return n._taskLoad>s._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=i,r._taskLoad+=i,r})}_releaseTask(e,i){e._taskLoad-=e._taskCosts[i],delete e._callbacks[i],delete e._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function OAe(){let t,e;onmessage=function(a){const o=a.data;switch(o.type){case"init":t=o.decoderConfig,e=new Promise(function(h){t.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(t)});break;case"decode":const l=o.buffer,c=o.taskConfig;e.then(h=>{const u=h.draco,d=new u.Decoder,f=new u.DecoderBuffer;f.Init(new Int8Array(l),l.byteLength);try{const p=i(u,d,f,c),m=p.attributes.map(g=>g.array.buffer);p.index&&m.push(p.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:p},m)}catch(p){console.error(p),self.postMessage({type:"error",id:o.id,error:p.message})}finally{u.destroy(f),u.destroy(d)}});break}};function i(a,o,l,c){const h=c.attributeIDs,u=c.attributeTypes;let d,f;const p=o.GetEncodedGeometryType(l);if(p===a.TRIANGULAR_MESH)d=new a.Mesh,f=o.DecodeBufferToMesh(l,d);else if(p===a.POINT_CLOUD)d=new a.PointCloud,f=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const m={index:null,attributes:[]};for(const g in h){const v=self[u[g]];let y,x;if(c.useUniqueIDs)x=h[g],y=o.GetAttributeByUniqueId(d,x);else{if(x=o.GetAttributeId(d,a[h[g]]),x===-1)continue;y=o.GetAttribute(d,x)}m.attributes.push(n(a,o,d,g,v,y))}return p===a.TRIANGULAR_MESH&&(m.index=r(a,o,d)),a.destroy(d),m}function r(a,o,l){const h=l.num_faces()*3,u=h*4,d=a._malloc(u);o.GetTrianglesUInt32Array(l,u,d);const f=new Uint32Array(a.HEAPF32.buffer,d,h).slice();return a._free(d),{array:f,itemSize:1}}function n(a,o,l,c,h,u){const d=u.num_components(),p=l.num_points()*d,m=p*h.BYTES_PER_ELEMENT,g=s(a,h),v=a._malloc(m);o.GetAttributeDataArrayForAllPoints(l,u,g,m,v);const y=new h(a.HEAPF32.buffer,v,p).slice();return a._free(v),{name:c,array:y,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}let jE;const IL=()=>{if(jE)return jE;const t="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),r=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let n=t;WebAssembly.validate(i)&&(n=e);let s;const a=WebAssembly.instantiate(o(n),{}).then(u=>{s=u.instance,s.exports.__wasm_call_ctors()});function o(u){const d=new Uint8Array(u.length);for(let p=0;p<u.length;++p){const m=u.charCodeAt(p);d[p]=m>96?m-71:m>64?m-65:m>47?m+4:m>46?63:62}let f=0;for(let p=0;p<u.length;++p)d[f++]=d[p]<60?r[d[p]]:(d[p]-60)*64+d[++p];return d.buffer.slice(0,f)}function l(u,d,f,p,m,g){const v=s.exports.sbrk,y=f+3&-4,x=v(y*p),S=v(m.length),A=new Uint8Array(s.exports.memory.buffer);A.set(m,S);const _=u(x,f,p,S,m.length);if(_===0&&g&&g(x,y,p),d.set(A.subarray(x,x+f*p)),v(x-v(0)),_!==0)throw new Error(`Malformed buffer data: ${_}`)}const c={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return jE={ready:a,supported:!0,decodeVertexBuffer(u,d,f,p,m){l(s.exports.meshopt_decodeVertexBuffer,u,d,f,p,s.exports[c[m]])},decodeIndexBuffer(u,d,f,p){l(s.exports.meshopt_decodeIndexBuffer,u,d,f,p)},decodeIndexSequence(u,d,f,p){l(s.exports.meshopt_decodeIndexSequence,u,d,f,p)},decodeGltfBuffer(u,d,f,p,m,g){l(s.exports[h[m]],u,d,f,p,s.exports[c[g]])}},jE},LL=t=>t===Object(t)&&!Array.isArray(t)&&typeof t!="function";function yD(t,e){const i=eo(s=>s.gl),r=Rp(x_,LL(t)?Object.values(t):t);return we.useLayoutEffect(()=>{e==null||e(r)},[e]),we.useEffect(()=>{if("initTexture"in i){let s=[];Array.isArray(r)?s=r:r instanceof kr?s=[r]:LL(r)&&(s=Object.values(r)),s.forEach(a=>{a instanceof kr&&i.initTexture(a)})}},[i,r]),we.useMemo(()=>{if(LL(t)){const s={};let a=0;for(const o in t)s[o]=r[a++];return s}else return r},[t,r])}yD.preload=t=>Rp.preload(x_,t);yD.clear=t=>Rp.clear(x_,t);let WE=null,Bre="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Fre(t=!0,e=!0,i){return r=>{i&&i(r),t&&(WE||(WE=new LAe),WE.setDecoderPath(typeof t=="string"?t:Bre),r.setDRACOLoader(WE)),e&&r.setMeshoptDecoder(typeof IL=="function"?IL():IL)}}const $o=(t,e,i,r)=>Rp(n5,t,Fre(e,i,r));$o.preload=(t,e,i,r)=>Rp.preload(n5,t,Fre(e,i,r));$o.clear=t=>Rp.clear(n5,t);$o.setDecoderPath=t=>{Bre=t};const xD=we.forwardRef(({makeDefault:t,camera:e,regress:i,domElement:r,enableDamping:n=!0,keyEvents:s=!1,onChange:a,onStart:o,onEnd:l,...c},h)=>{const u=eo(_=>_.invalidate),d=eo(_=>_.camera),f=eo(_=>_.gl),p=eo(_=>_.events),m=eo(_=>_.setEvents),g=eo(_=>_.set),v=eo(_=>_.get),y=eo(_=>_.performance),x=e||d,S=r||p.connected||f.domElement,A=we.useMemo(()=>new $_e(x),[x]);return gD(()=>{A.enabled&&A.update()},-1),we.useEffect(()=>(s&&A.connect(s===!0?S:s),A.connect(S),()=>void A.dispose()),[s,S,i,A,u]),we.useEffect(()=>{const _=T=>{u(),i&&y.regress(),a&&a(T)},M=T=>{o&&o(T)},E=T=>{l&&l(T)};return A.addEventListener("change",_),A.addEventListener("start",M),A.addEventListener("end",E),()=>{A.removeEventListener("start",M),A.removeEventListener("end",E),A.removeEventListener("change",_)}},[a,o,l,A,u,m]),we.useEffect(()=>{if(t){const _=v().controls;return g({controls:A}),()=>g({controls:_})}},[t,A]),we.createElement("primitive",lS({ref:h,object:A,enableDamping:n},c))}),BAe="modulepreload",FAe=function(t){return"/Portfolio3D/"+t},WW={},Td=function(e,i,r){let n=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(i.map(l=>{if(l=FAe(l),l in WW)return;WW[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":BAe,c||(u.as="script"),u.crossOrigin="",u.href=l,o&&u.setAttribute("nonce",o),document.head.appendChild(u),c)return new Promise((d,f)=>{u.addEventListener("load",d),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return e().catch(s)})};function kAe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var kre={exports:{}};(function(t,e){(function(i){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,c,h){if(h=h||{},l=l.trim(),c=c.trim(),!c){if(!h.alwaysNormalize)return l;var u=o.parseURL(l);if(!u)throw new Error("Error trying to parse base URL.");return u.path=o.normalizePath(u.path),o.buildURLFromParts(u)}var d=o.parseURL(c);if(!d)throw new Error("Error trying to parse relative URL.");if(d.scheme)return h.alwaysNormalize?(d.path=o.normalizePath(d.path),o.buildURLFromParts(d)):c;var f=o.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var p=n.exec(f.path);f.netLoc=p[1],f.path=p[2]}f.netLoc&&!f.path&&(f.path="/");var m={scheme:f.scheme,netLoc:d.netLoc,path:null,params:d.params,query:d.query,fragment:d.fragment};if(!d.netLoc&&(m.netLoc=f.netLoc,d.path[0]!=="/"))if(!d.path)m.path=f.path,d.params||(m.params=f.params,d.query||(m.query=f.query));else{var g=f.path,v=g.substring(0,g.lastIndexOf("/")+1)+d.path;m.path=o.normalizePath(v)}return m.path===null&&(m.path=h.alwaysNormalize?o.normalizePath(d.path):d.path),o.buildURLFromParts(m)},parseURL:function(l){var c=r.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};t.exports=o})()})(kre);var s5=kre.exports;function XW(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),i.push.apply(i,r)}return i}function Is(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?XW(Object(i),!0).forEach(function(r){zAe(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):XW(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function NAe(t,e){if(typeof t!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var r=i.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function UAe(t){var e=NAe(t,"string");return typeof e=="symbol"?e:String(e)}function zAe(t,e,i){return e=UAe(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function zn(){return zn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},zn.apply(this,arguments)}const Bt=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)},GAe=Number.isSafeInteger||function(t){return typeof t=="number"&&Math.abs(t)<=VAe},VAe=Number.MAX_SAFE_INTEGER||9007199254740991;let ee=function(t){return t.MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached",t.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",t}({}),oi=function(t){return t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError",t}({}),je=function(t){return t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",t.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",t.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",t.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_PARSING_ERROR="levelParsingError",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",t.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.FRAG_GAP="fragGap",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted",t.UNKNOWN="unknown",t}({});const Sm=function(){},dk={trace:Sm,debug:Sm,log:Sm,warn:Sm,info:Sm,error:Sm};let ow=dk;function HAe(t){const e=self.console[t];return e?e.bind(self.console,`[${t}] >`):Sm}function jAe(t,...e){e.forEach(function(i){ow[i]=t[i]?t[i].bind(t):HAe(i)})}function WAe(t,e){if(typeof console=="object"&&t===!0||typeof t=="object"){jAe(t,"debug","log","info","warn","error");try{ow.log(`Debug logs enabled for "${e}" in hls.js version 1.5.17`)}catch{ow=dk}}else ow=dk}const Oe=ow,XAe=/^(\d+)x(\d+)$/,YW=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Ir{constructor(e){typeof e=="string"&&(e=Ir.parseAttrList(e)),zn(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const i=parseInt(this[e],10);return i>Number.MAX_SAFE_INTEGER?1/0:i}hexadecimalInteger(e){if(this[e]){let i=(this[e]||"0x").slice(2);i=(i.length&1?"0":"")+i;const r=new Uint8Array(i.length/2);for(let n=0;n<i.length/2;n++)r[n]=parseInt(i.slice(n*2,n*2+2),16);return r}else return null}hexadecimalIntegerAsNumber(e){const i=parseInt(this[e],16);return i>Number.MAX_SAFE_INTEGER?1/0:i}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,i){const r=this[e];return r?parseFloat(r):i}enumeratedString(e){return this[e]}bool(e){return this[e]==="YES"}decimalResolution(e){const i=XAe.exec(this[e]);if(i!==null)return{width:parseInt(i[1],10),height:parseInt(i[2],10)}}static parseAttrList(e){let i;const r={},n='"';for(YW.lastIndex=0;(i=YW.exec(e))!==null;){let s=i[2];s.indexOf(n)===0&&s.lastIndexOf(n)===s.length-1&&(s=s.slice(1,-1));const a=i[1].trim();r[a]=s}return r}}function YAe(t){return t!=="ID"&&t!=="CLASS"&&t!=="START-DATE"&&t!=="DURATION"&&t!=="END-DATE"&&t!=="END-ON-NEXT"}function qAe(t){return t==="SCTE35-OUT"||t==="SCTE35-IN"}class a5{constructor(e,i){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,i){const r=i.attr;for(const n in r)if(Object.prototype.hasOwnProperty.call(e,n)&&e[n]!==r[n]){Oe.warn(`DATERANGE tag attribute: "${n}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=n;break}e=zn(new Ir({}),r,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=new Date(this.attr["END-DATE"]);Bt(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return e!==null?new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Bt(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&Bt(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class S_{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ir={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class o5{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[ir.AUDIO]:null,[ir.VIDEO]:null,[ir.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,i){const r=e.split("@",2);let n;r.length===1?n=(i==null?void 0:i.byteRangeEndOffset)||0:n=parseInt(r[1]),this._byteRange=[n,parseInt(r[0])+n]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=s5.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class eC extends o5{constructor(e,i){super(i),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new S_,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const i=this.levelkeys.identity;if(i)this._decryptdata=i.getDecryptData(this.sn);else{const r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!Bt(this.programDateTime))return null;const e=Bt(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const i=Object.keys(this.levelkeys),r=i.length;if(r>1||r===1&&this.levelkeys[i[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const i=this.levelkeys[e];i&&!this._decryptdata&&(this._decryptdata=i.getDecryptData(this.sn))}}abortRequests(){var e,i;(e=this.loader)==null||e.abort(),(i=this.keyLoader)==null||i.abort()}setElementaryStreamInfo(e,i,r,n,s,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:i,endPTS:r,startDTS:n,endDTS:s,partial:a};return}l.startPTS=Math.min(l.startPTS,i),l.endPTS=Math.max(l.endPTS,r),l.startDTS=Math.min(l.startDTS,n),l.endDTS=Math.max(l.endDTS,s)}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ir.AUDIO]=null,e[ir.VIDEO]=null,e[ir.AUDIOVIDEO]=null}}class Nre extends o5{constructor(e,i,r,n,s){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new S_,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=i,this.index=n;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}const KAe=10;class Ure{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const i=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!i||!this.live,this.advanced=this.endSN>e.endSN||i>0||i===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?Bt(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||KAe}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function l5(t){return Uint8Array.from(atob(t),e=>e.charCodeAt(0))}function QAe(t){const e=fk(t).subarray(0,16),i=new Uint8Array(16);return i.set(e,16-e.length),i}function $Ae(t){const e=function(r,n,s){const a=r[n];r[n]=r[s],r[s]=a};e(t,0,3),e(t,1,2),e(t,4,5),e(t,6,7)}function JAe(t){const e=t.split(":");let i=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),n=r[r.length-1].split(",");if(n.length===2){const s=n[0]==="base64",a=n[1];s?(r.splice(-1,1),i=l5(a)):i=QAe(a)}}return i}function fk(t){return Uint8Array.from(unescape(encodeURIComponent(t)),e=>e.charCodeAt(0))}const t1=typeof self<"u"?self:void 0;var gr={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ba={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function qW(t){switch(t){case Ba.FAIRPLAY:return gr.FAIRPLAY;case Ba.PLAYREADY:return gr.PLAYREADY;case Ba.WIDEVINE:return gr.WIDEVINE;case Ba.CLEARKEY:return gr.CLEARKEY}}var Rb={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",FAIRPLAY:"94ce86fb07ff4f43adb893d2fa968ca2",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function KW(t){if(t===Rb.WIDEVINE)return gr.WIDEVINE;if(t===Rb.PLAYREADY)return gr.PLAYREADY;if(t===Rb.CENC||t===Rb.CLEARKEY)return gr.CLEARKEY}function QW(t){switch(t){case gr.FAIRPLAY:return Ba.FAIRPLAY;case gr.PLAYREADY:return Ba.PLAYREADY;case gr.WIDEVINE:return Ba.WIDEVINE;case gr.CLEARKEY:return Ba.CLEARKEY}}function OL(t){const{drmSystems:e,widevineLicenseUrl:i}=t,r=e?[gr.FAIRPLAY,gr.WIDEVINE,gr.PLAYREADY,gr.CLEARKEY].filter(n=>!!e[n]):[];return!r[gr.WIDEVINE]&&i&&r.push(gr.WIDEVINE),r}const zre=function(t){return t1!=null&&(t=t1.navigator)!=null&&t.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function ZAe(t,e,i,r){let n;switch(t){case gr.FAIRPLAY:n=["cenc","sinf"];break;case gr.WIDEVINE:case gr.PLAYREADY:n=["cenc"];break;case gr.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${t}`)}return eEe(n,e,i,r)}function eEe(t,e,i,r){return[{initDataTypes:t,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs="${s}"`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:i.map(s=>({contentType:`video/mp4; codecs="${s}"`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function fg(t,e,i){return Uint8Array.prototype.slice?t.slice(e,i):new Uint8Array(Array.prototype.slice.call(t,e,i))}const c5=(t,e)=>e+10<=t.length&&t[e]===73&&t[e+1]===68&&t[e+2]===51&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128,Gre=(t,e)=>e+10<=t.length&&t[e]===51&&t[e+1]===68&&t[e+2]===73&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128,cS=(t,e)=>{const i=e;let r=0;for(;c5(t,e);){r+=10;const n=bD(t,e+6);r+=n,Gre(t,e+10)&&(r+=10),e+=r}if(r>0)return t.subarray(i,i+r)},bD=(t,e)=>{let i=0;return i=(t[e]&127)<<21,i|=(t[e+1]&127)<<14,i|=(t[e+2]&127)<<7,i|=t[e+3]&127,i},tEe=(t,e)=>c5(t,e)&&bD(t,e+6)+10<=t.length-e,h5=t=>{const e=Hre(t);for(let i=0;i<e.length;i++){const r=e[i];if(Vre(r))return oEe(r)}},Vre=t=>t&&t.key==="PRIV"&&t.info==="com.apple.streaming.transportStreamTimestamp",iEe=t=>{const e=String.fromCharCode(t[0],t[1],t[2],t[3]),i=bD(t,4),r=10;return{type:e,size:i,data:t.subarray(r,r+i)}},Hre=t=>{let e=0;const i=[];for(;c5(t,e);){const r=bD(t,e+6);e+=10;const n=e+r;for(;e+8<n;){const s=iEe(t.subarray(e)),a=rEe(s);a&&i.push(a),e+=s.size+10}Gre(t,e)&&(e+=10)}return i},rEe=t=>t.type==="PRIV"?nEe(t):t.type[0]==="W"?aEe(t):sEe(t),nEe=t=>{if(t.size<2)return;const e=Ih(t.data,!0),i=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:i.buffer}},sEe=t=>{if(t.size<2)return;if(t.type==="TXXX"){let i=1;const r=Ih(t.data.subarray(i),!0);i+=r.length+1;const n=Ih(t.data.subarray(i));return{key:t.type,info:r,data:n}}const e=Ih(t.data.subarray(1));return{key:t.type,data:e}},aEe=t=>{if(t.type==="WXXX"){if(t.size<2)return;let i=1;const r=Ih(t.data.subarray(i),!0);i+=r.length+1;const n=Ih(t.data.subarray(i));return{key:t.type,info:r,data:n}}const e=Ih(t.data);return{key:t.type,data:e}},oEe=t=>{if(t.data.byteLength===8){const e=new Uint8Array(t.data),i=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,i&&(r+=4772185884e-2),Math.round(r)}},Ih=(t,e=!1)=>{const i=lEe();if(i){const c=i.decode(t);if(e){const h=c.indexOf("\0");return h!==-1?c.substring(0,h):c}return c.replace(/\0/g,"")}const r=t.length;let n,s,a,o="",l=0;for(;l<r;){if(n=t[l++],n===0&&e)return o;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(n);break;case 12:case 13:s=t[l++],o+=String.fromCharCode((n&31)<<6|s&63);break;case 14:s=t[l++],a=t[l++],o+=String.fromCharCode((n&15)<<12|(s&63)<<6|(a&63)<<0);break}}return o};let BL;function lEe(){if(!navigator.userAgent.includes("PlayStation 4"))return!BL&&typeof self.TextDecoder<"u"&&(BL=new self.TextDecoder("utf-8")),BL}const dh={hexDump:function(t){let e="";for(let i=0;i<t.length;i++){let r=t[i].toString(16);r.length<2&&(r="0"+r),e+=r}return e}},c2=Math.pow(2,32)-1,cEe=[].push,jre={video:1,audio:2,id3:3,text:4};function Kn(t){return String.fromCharCode.apply(null,t)}function Wre(t,e){const i=t[e]<<8|t[e+1];return i<0?65536+i:i}function ii(t,e){const i=Xre(t,e);return i<0?4294967296+i:i}function $W(t,e){let i=ii(t,e);return i*=Math.pow(2,32),i+=ii(t,e+4),i}function Xre(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function FL(t,e,i){t[e]=i>>24,t[e+1]=i>>16&255,t[e+2]=i>>8&255,t[e+3]=i&255}function hEe(t){const e=t.byteLength;for(let i=0;i<e;){const r=ii(t,i);if(r>8&&t[i+4]===109&&t[i+5]===111&&t[i+6]===111&&t[i+7]===102)return!0;i=r>1?i+r:e}return!1}function yi(t,e){const i=[];if(!e.length)return i;const r=t.byteLength;for(let n=0;n<r;){const s=ii(t,n),a=Kn(t.subarray(n+4,n+8)),o=s>1?n+s:r;if(a===e[0])if(e.length===1)i.push(t.subarray(n+8,o));else{const l=yi(t.subarray(n+8,o),e.slice(1));l.length&&cEe.apply(i,l)}n=o}return i}function uEe(t){const e=[],i=t[0];let r=8;const n=ii(t,r);r+=4;let s=0,a=0;i===0?(s=ii(t,r),a=ii(t,r+4),r+=8):(s=$W(t,r),a=$W(t,r+8),r+=16),r+=2;let o=t.length+a;const l=Wre(t,r);r+=2;for(let c=0;c<l;c++){let h=r;const u=ii(t,h);h+=4;const d=u&2147483647;if((u&2147483648)>>>31===1)return Oe.warn("SIDX has hierarchical references (not supported)"),null;const p=ii(t,h);h+=4,e.push({referenceSize:d,subsegmentDuration:p,info:{duration:p/n,start:o,end:o+d-1}}),o+=d,h+=4,r=h}return{earliestPresentationTime:s,timescale:n,version:i,referencesCount:l,references:e}}function Yre(t){const e=[],i=yi(t,["moov","trak"]);for(let n=0;n<i.length;n++){const s=i[n],a=yi(s,["tkhd"])[0];if(a){let o=a[0];const l=ii(a,o===0?12:20),c=yi(s,["mdia","mdhd"])[0];if(c){o=c[0];const h=ii(c,o===0?12:20),u=yi(s,["mdia","hdlr"])[0];if(u){const d=Kn(u.subarray(8,12)),f={soun:ir.AUDIO,vide:ir.VIDEO}[d];if(f){const p=yi(s,["mdia","minf","stbl","stsd"])[0],m=dEe(p);e[l]={timescale:h,type:f},e[f]=Is({timescale:h,id:l},m)}}}}}return yi(t,["moov","mvex","trex"]).forEach(n=>{const s=ii(n,4),a=e[s];a&&(a.default={duration:ii(n,12),flags:ii(n,20)})}),e}function dEe(t){const e=t.subarray(8),i=e.subarray(86),r=Kn(e.subarray(4,8));let n=r;const s=r==="enca"||r==="encv";if(s){const o=yi(e,[r])[0].subarray(r==="enca"?28:78);yi(o,["sinf"]).forEach(c=>{const h=yi(c,["schm"])[0];if(h){const u=Kn(h.subarray(4,8));if(u==="cbcs"||u==="cenc"){const d=yi(c,["frma"])[0];d&&(n=Kn(d))}}})}switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const a=yi(i,["avcC"])[0];n+="."+XE(a[1])+XE(a[2])+XE(a[3]);break}case"mp4a":{const a=yi(e,[r])[0],o=yi(a.subarray(28),["esds"])[0];if(o&&o.length>12){let l=4;if(o[l++]!==3)break;l=kL(o,l),l+=2;const c=o[l++];if(c&128&&(l+=2),c&64&&(l+=o[l++]),o[l++]!==4)break;l=kL(o,l);const h=o[l++];if(h===64)n+="."+XE(h);else break;if(l+=12,o[l++]!==5)break;l=kL(o,l);const u=o[l++];let d=(u&248)>>3;d===31&&(d+=1+((u&7)<<3)+((o[l]&224)>>5)),n+="."+d}break}case"hvc1":case"hev1":{const a=yi(i,["hvcC"])[0],o=a[1],l=["","A","B","C"][o>>6],c=o&31,h=ii(a,2),u=(o&32)>>5?"H":"L",d=a[12],f=a.subarray(6,12);n+="."+l+c,n+="."+h.toString(16).toUpperCase(),n+="."+u+d;let p="";for(let m=f.length;m--;){const g=f[m];(g||p)&&(p="."+g.toString(16).toUpperCase()+p)}n+=p;break}case"dvh1":case"dvhe":{const a=yi(i,["dvcC"])[0],o=a[2]>>1&127,l=a[2]<<5&32|a[3]>>3&31;n+="."+Qc(o)+"."+Qc(l);break}case"vp09":{const a=yi(i,["vpcC"])[0],o=a[4],l=a[5],c=a[6]>>4&15;n+="."+Qc(o)+"."+Qc(l)+"."+Qc(c);break}case"av01":{const a=yi(i,["av1C"])[0],o=a[1]>>>5,l=a[1]&31,c=a[2]>>>7?"H":"M",h=(a[2]&64)>>6,u=(a[2]&32)>>5,d=o===2&&h?u?12:10:h?10:8,f=(a[2]&16)>>4,p=(a[2]&8)>>3,m=(a[2]&4)>>2,g=a[2]&3;n+="."+o+"."+Qc(l)+c+"."+Qc(d)+"."+f+"."+p+m+g+"."+Qc(1)+"."+Qc(1)+"."+Qc(1)+"."+0;break}}return{codec:n,encrypted:s}}function kL(t,e){const i=e+5;for(;t[e++]&128&&e<i;);return e}function XE(t){return("0"+t.toString(16).toUpperCase()).slice(-2)}function Qc(t){return(t<10?"0":"")+t}function fEe(t,e){if(!t||!e)return t;const i=e.keyId;return i&&e.isCommonEncryption&&yi(t,["moov","trak"]).forEach(n=>{const a=yi(n,["mdia","minf","stbl","stsd"])[0].subarray(8);let o=yi(a,["enca"]);const l=o.length>0;l||(o=yi(a,["encv"])),o.forEach(c=>{const h=l?c.subarray(28):c.subarray(78);yi(h,["sinf"]).forEach(d=>{const f=qre(d);if(f){const p=f.subarray(8,24);p.some(m=>m!==0)||(Oe.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${dh.hexDump(p)} -> ${dh.hexDump(i)}`),f.set(i,8))}})})}),t}function qre(t){const e=yi(t,["schm"])[0];if(e){const i=Kn(e.subarray(4,8));if(i==="cbcs"||i==="cenc")return yi(t,["schi","tenc"])[0]}return null}function pEe(t,e){return yi(e,["moof","traf"]).reduce((i,r)=>{const n=yi(r,["tfdt"])[0],s=n[0],a=yi(r,["tfhd"]).reduce((o,l)=>{const c=ii(l,4),h=t[c];if(h){let u=ii(n,4);if(s===1){if(u===c2)return Oe.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),o;u*=c2+1,u+=ii(n,8)}const d=h.timescale||9e4,f=u/d;if(Bt(f)&&(o===null||f<o))return f}return o},null);return a!==null&&Bt(a)&&(i===null||a<i)?a:i},null)}function mEe(t,e){let i=0,r=0,n=0;const s=yi(t,["moof","traf"]);for(let a=0;a<s.length;a++){const o=s[a],l=yi(o,["tfhd"])[0],c=ii(l,4),h=e[c];if(!h)continue;const u=h.default,d=ii(l,0)|(u==null?void 0:u.flags);let f=u==null?void 0:u.duration;d&8&&(d&2?f=ii(l,12):f=ii(l,8));const p=h.timescale||9e4,m=yi(o,["trun"]);for(let g=0;g<m.length;g++){if(i=gEe(m[g]),!i&&f){const v=ii(m[g],4);i=f*v}h.type===ir.VIDEO?r+=i/p:h.type===ir.AUDIO&&(n+=i/p)}}if(r===0&&n===0){let a=1/0,o=0,l=0;const c=yi(t,["sidx"]);for(let h=0;h<c.length;h++){const u=uEe(c[h]);if(u!=null&&u.references){a=Math.min(a,u.earliestPresentationTime/u.timescale);const d=u.references.reduce((f,p)=>f+p.info.duration||0,0);o=Math.max(o,d+u.earliestPresentationTime/u.timescale),l=o-a}}if(l&&Bt(l))return l}return r||n}function gEe(t){const e=ii(t,0);let i=8;e&1&&(i+=4),e&4&&(i+=4);let r=0;const n=ii(t,4);for(let s=0;s<n;s++){if(e&256){const a=ii(t,i);r+=a,i+=4}e&512&&(i+=4),e&1024&&(i+=4),e&2048&&(i+=4)}return r}function vEe(t,e,i){yi(e,["moof","traf"]).forEach(r=>{yi(r,["tfhd"]).forEach(n=>{const s=ii(n,4),a=t[s];if(!a)return;const o=a.timescale||9e4;yi(r,["tfdt"]).forEach(l=>{const c=l[0],h=i*o;if(h){let u=ii(l,4);if(c===0)u-=h,u=Math.max(u,0),FL(l,4,u);else{u*=Math.pow(2,32),u+=ii(l,8),u-=h,u=Math.max(u,0);const d=Math.floor(u/(c2+1)),f=Math.floor(u%(c2+1));FL(l,4,d),FL(l,8,f)}}})})})}function yEe(t){const e={valid:null,remainder:null},i=yi(t,["moof"]);if(i.length<2)return e.remainder=t,e;const r=i[i.length-1];return e.valid=fg(t,0,r.byteOffset-8),e.remainder=fg(t,r.byteOffset-8),e}function jl(t,e){const i=new Uint8Array(t.length+e.length);return i.set(t),i.set(e,t.length),i}function JW(t,e){const i=[],r=e.samples,n=e.timescale,s=e.id;let a=!1;return yi(r,["moof"]).map(l=>{const c=l.byteOffset-8;yi(l,["traf"]).map(u=>{const d=yi(u,["tfdt"]).map(f=>{const p=f[0];let m=ii(f,4);return p===1&&(m*=Math.pow(2,32),m+=ii(f,8)),m/n})[0];return d!==void 0&&(t=d),yi(u,["tfhd"]).map(f=>{const p=ii(f,4),m=ii(f,0)&16777215,g=(m&1)!==0,v=(m&2)!==0,y=(m&8)!==0;let x=0;const S=(m&16)!==0;let A=0;const _=(m&32)!==0;let M=8;p===s&&(g&&(M+=8),v&&(M+=4),y&&(x=ii(f,M),M+=4),S&&(A=ii(f,M),M+=4),_&&(M+=4),e.type==="video"&&(a=xEe(e.codec)),yi(u,["trun"]).map(E=>{const T=E[0],C=ii(E,0)&16777215,D=(C&1)!==0;let B=0;const O=(C&4)!==0,L=(C&256)!==0;let H=0;const q=(C&512)!==0;let W=0;const I=(C&1024)!==0,z=(C&2048)!==0;let U=0;const X=ii(E,4);let Q=8;D&&(B=ii(E,Q),Q+=4),O&&(Q+=4);let re=B+c;for(let ie=0;ie<X;ie++){if(L?(H=ii(E,Q),Q+=4):H=x,q?(W=ii(E,Q),Q+=4):W=A,I&&(Q+=4),z&&(T===0?U=ii(E,Q):U=Xre(E,Q),Q+=4),e.type===ir.VIDEO){let ce=0;for(;ce<W;){const Z=ii(r,re);if(re+=4,bEe(a,r[re])){const Ae=r.subarray(re,re+Z);Kre(Ae,a?2:1,t+U/n,i)}re+=Z,ce+=Z+4}}t+=H/n}}))})})}),i}function xEe(t){if(!t)return!1;const e=t.indexOf("."),i=e<0?t:t.substring(0,e);return i==="hvc1"||i==="hev1"||i==="dvh1"||i==="dvhe"}function bEe(t,e){if(t){const i=e>>1&63;return i===39||i===40}else return(e&31)===6}function Kre(t,e,i,r){const n=Qre(t);let s=0;s+=e;let a=0,o=0,l=0;for(;s<n.length;){a=0;do{if(s>=n.length)break;l=n[s++],a+=l}while(l===255);o=0;do{if(s>=n.length)break;l=n[s++],o+=l}while(l===255);const c=n.length-s;let h=s;if(o<c)s+=o;else if(o>c){Oe.error(`Malformed SEI payload. ${o} is too small, only ${c} bytes left to parse.`);break}if(a===4){if(n[h++]===181){const d=Wre(n,h);if(h+=2,d===49){const f=ii(n,h);if(h+=4,f===1195456820){const p=n[h++];if(p===3){const m=n[h++],g=31&m,v=64&m,y=v?2+g*3:0,x=new Uint8Array(y);if(v){x[0]=m;for(let S=1;S<y;S++)x[S]=n[h++]}r.push({type:p,payloadType:a,pts:i,bytes:x})}}}}}else if(a===5&&o>16){const u=[];for(let p=0;p<16;p++){const m=n[h++].toString(16);u.push(m.length==1?"0"+m:m),(p===3||p===5||p===7||p===9)&&u.push("-")}const d=o-16,f=new Uint8Array(d);for(let p=0;p<d;p++)f[p]=n[h++];r.push({payloadType:a,pts:i,uuid:u.join(""),userData:Ih(f),userDataBytes:f})}}}function Qre(t){const e=t.byteLength,i=[];let r=1;for(;r<e-2;)t[r]===0&&t[r+1]===0&&t[r+2]===3?(i.push(r+2),r+=2):r++;if(i.length===0)return t;const n=e-i.length,s=new Uint8Array(n);let a=0;for(r=0;r<n;a++,r++)a===i[0]&&(a++,i.shift()),s[r]=t[a];return s}function wEe(t){const e=t[0];let i="",r="",n=0,s=0,a=0,o=0,l=0,c=0;if(e===0){for(;Kn(t.subarray(c,c+1))!=="\0";)i+=Kn(t.subarray(c,c+1)),c+=1;for(i+=Kn(t.subarray(c,c+1)),c+=1;Kn(t.subarray(c,c+1))!=="\0";)r+=Kn(t.subarray(c,c+1)),c+=1;r+=Kn(t.subarray(c,c+1)),c+=1,n=ii(t,12),s=ii(t,16),o=ii(t,20),l=ii(t,24),c=28}else if(e===1){c+=4,n=ii(t,c),c+=4;const u=ii(t,c);c+=4;const d=ii(t,c);for(c+=4,a=2**32*u+d,GAe(a)||(a=Number.MAX_SAFE_INTEGER,Oe.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=ii(t,c),c+=4,l=ii(t,c),c+=4;Kn(t.subarray(c,c+1))!=="\0";)i+=Kn(t.subarray(c,c+1)),c+=1;for(i+=Kn(t.subarray(c,c+1)),c+=1;Kn(t.subarray(c,c+1))!=="\0";)r+=Kn(t.subarray(c,c+1)),c+=1;r+=Kn(t.subarray(c,c+1)),c+=1}const h=t.subarray(c,t.byteLength);return{schemeIdUri:i,value:r,timeScale:n,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:h}}function SEe(t,...e){const i=e.length;let r=8,n=i;for(;n--;)r+=e[n].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=r&255,s.set(t,4),n=0,r=8;n<i;n++)s.set(e[n],r),r+=e[n].byteLength;return s}function _Ee(t,e,i){if(t.byteLength!==16)throw new RangeError("Invalid system id");let r,n;r=0,n=new Uint8Array;let s;r>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return i&&i.byteLength>0&&new DataView(a.buffer).setUint32(0,i.byteLength,!1),SEe([112,115,115,104],new Uint8Array([r,0,0,0]),t,s,n,a,i||new Uint8Array)}function AEe(t){const e=[];if(t instanceof ArrayBuffer){const i=t.byteLength;let r=0;for(;r+32<i;){const n=new DataView(t,r),s=EEe(n);e.push(s),r+=s.size}}return e}function EEe(t){const e=t.getUint32(0),i=t.byteOffset,r=t.byteLength;if(r<e)return{offset:i,size:r};if(t.getUint32(4)!==1886614376)return{offset:i,size:e};const s=t.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:i,size:e};const a=t.buffer,o=dh.hexDump(new Uint8Array(a,i+12,16)),l=t.getUint32(28);let c=null,h=null;if(s===0){if(e-32<l||l<22)return{offset:i,size:e};h=new Uint8Array(a,i+32,l)}else if(s===1){if(!l||r<i+32+l*16+16)return{offset:i,size:e};c=[];for(let u=0;u<l;u++)c.push(new Uint8Array(a,i+32+u*16,16))}return{version:s,systemId:o,kids:c,data:h,offset:i,size:e}}let YE={};class i1{static clearKeyUriToKeyIdMap(){YE={}}constructor(e,i,r,n=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=i,this.keyFormat=r,this.keyFormatVersions=n,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&e!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ba.FAIRPLAY:case Ba.WIDEVINE:case Ba.PLAYREADY:case Ba.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method==="AES-128"&&!this.iv&&Oe.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const r=MEe(e);return new i1(this.method,this.uri,"identity",this.keyFormatVersions,r)}const i=JAe(this.uri);if(i)switch(this.keyFormat){case Ba.WIDEVINE:this.pssh=i,i.length>=22&&(this.keyId=i.subarray(i.length-22,i.length-6));break;case Ba.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=_Ee(r,null,i);const n=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),s=String.fromCharCode.apply(null,Array.from(n)),a=s.substring(s.indexOf("<"),s.length),c=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("KID")[0];if(c){const h=c.childNodes[0]?c.childNodes[0].nodeValue:c.getAttribute("VALUE");if(h){const u=l5(h).subarray(0,16);$Ae(u),this.keyId=u}}break}default:{let r=i.subarray(0,16);if(r.length!==16){const n=new Uint8Array(16);n.set(r,16-r.length),r=n}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r=YE[this.uri];if(!r){const n=Object.keys(YE).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,n),YE[this.uri]=r}this.keyId=r}return this}}function MEe(t){const e=new Uint8Array(16);for(let i=12;i<16;i++)e[i]=t>>8*(15-i)&255;return e}const $re=/\{\$([a-zA-Z0-9-_]+)\}/g;function ZW(t){return $re.test(t)}function Za(t,e,i){if(t.variableList!==null||t.hasVariableRefs)for(let r=i.length;r--;){const n=i[r],s=e[n];s&&(e[n]=pk(t,s))}}function pk(t,e){if(t.variableList!==null||t.hasVariableRefs){const i=t.variableList;return e.replace($re,r=>{const n=r.substring(2,r.length-1),s=i==null?void 0:i[n];return s===void 0?(t.playlistParsingError||(t.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),r):s})}return e}function e9(t,e,i){let r=t.variableList;r||(t.variableList=r={});let n,s;if("QUERYPARAM"in e){n=e.QUERYPARAM;try{const a=new self.URL(i).searchParams;if(a.has(n))s=a.get(n);else throw new Error(`"${n}" does not match any query parameter in URI: "${i}"`)}catch(a){t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else n=e.NAME,s=e.VALUE;n in r?t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):r[n]=s||""}function TEe(t,e,i){const r=e.IMPORT;if(i&&r in i){let n=t.variableList;n||(t.variableList=n={}),n[r]=i[r]}else t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}function gp(t=!0){return typeof self>"u"?void 0:(t||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function CEe(t){return typeof self<"u"&&t===self.ManagedMediaSource}const h2={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function PEe(t,e){const i=h2[e];return!!i&&!!i[t.slice(0,4)]}function NL(t,e,i=!0){return!t.split(",").some(r=>!Jre(r,e,i))}function Jre(t,e,i=!0){var r;const n=gp(i);return(r=n==null?void 0:n.isTypeSupported(hS(t,e)))!=null?r:!1}function hS(t,e){return`${e}/mp4;codecs="${t}"`}function t9(t){if(t){const e=t.substring(0,4);return h2.video[e]}return 2}function u2(t){return t.split(",").reduce((e,i)=>{const r=h2.video[i];return r?(r*2+e)/(e?3:2):(h2.audio[i]+e)/(e?2:1)},0)}const UL={};function DEe(t,e=!0){if(UL[t])return UL[t];const i={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[t];for(let r=0;r<i.length;r++)if(Jre(i[r],"audio",e))return UL[t]=i[r],i[r];return t}const REe=/flac|opus/i;function d2(t,e=!0){return t.replace(REe,i=>DEe(i.toLowerCase(),e))}function i9(t,e){return t&&t!=="mp4a"?t:e&&e.split(",")[0]}function IEe(t){const e=t.split(",");for(let i=0;i<e.length;i++){const r=e[i].split(".");if(r.length>2){let n=r.shift()+".";n+=parseInt(r.shift()).toString(16),n+=("000"+parseInt(r.shift()).toString(16)).slice(-4),e[i]=n}}return e.join(",")}const r9=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,n9=/#EXT-X-MEDIA:(.*)/g,LEe=/^#EXT(?:INF|-X-TARGETDURATION):/m,s9=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),OEe=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Ah{static findGroup(e,i){for(let r=0;r<e.length;r++){const n=e[r];if(n.id===i)return n}}static resolve(e,i){return s5.buildAbsoluteURL(i,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return LEe.test(e)}static parseMasterPlaylist(e,i){const r=ZW(e),n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},s=[];r9.lastIndex=0;let a;for(;(a=r9.exec(e))!=null;)if(a[1]){var o;const c=new Ir(a[1]);Za(n,c,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const h=pk(n,a[2]),u={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:Ah.resolve(h,i)},d=c.decimalResolution("RESOLUTION");d&&(u.width=d.width,u.height=d.height),BEe(c.CODECS,u),(o=u.unknownCodecs)!=null&&o.length||s.push(u),n.levels.push(u)}else if(a[3]){const c=a[3],h=a[4];switch(c){case"SESSION-DATA":{const u=new Ir(h);Za(n,u,["DATA-ID","LANGUAGE","VALUE","URI"]);const d=u["DATA-ID"];d&&(n.sessionData===null&&(n.sessionData={}),n.sessionData[d]=u);break}case"SESSION-KEY":{const u=a9(h,i,n);u.encrypted&&u.isSupported()?(n.sessionKeys===null&&(n.sessionKeys=[]),n.sessionKeys.push(u)):Oe.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${h}"`);break}case"DEFINE":{{const u=new Ir(h);Za(n,u,["NAME","VALUE","QUERYPARAM"]),e9(n,u,i)}break}case"CONTENT-STEERING":{const u=new Ir(h);Za(n,u,["SERVER-URI","PATHWAY-ID"]),n.contentSteering={uri:Ah.resolve(u["SERVER-URI"],i),pathwayId:u["PATHWAY-ID"]||"."};break}case"START":{n.startTimeOffset=o9(h);break}}}const l=s.length>0&&s.length<n.levels.length;return n.levels=l?s:n.levels,n.levels.length===0&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,i,r){let n;const s={},a=r.levels,o={AUDIO:a.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:a.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(n9.lastIndex=0;(n=n9.exec(e))!==null;){const c=new Ir(n[1]),h=c.TYPE;if(h){const u=o[h],d=s[h]||[];s[h]=d,Za(r,c,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const f=c.LANGUAGE,p=c["ASSOC-LANGUAGE"],m=c.CHANNELS,g=c.CHARACTERISTICS,v=c["INSTREAM-ID"],y={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||f||"",type:h,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:f,url:c.URI?Ah.resolve(c.URI,i):""};if(p&&(y.assocLang=p),m&&(y.channels=m),g&&(y.characteristics=g),v&&(y.instreamId=v),u!=null&&u.length){const x=Ah.findGroup(u,y.groupId)||u[0];l9(y,x,"audioCodec"),l9(y,x,"textCodec")}d.push(y)}}return s}static parseLevelPlaylist(e,i,r,n,s,a){const o=new Ure(i),l=o.fragments;let c=null,h=0,u=0,d=0,f=0,p=null,m=new eC(n,i),g,v,y,x=-1,S=!1,A=null;for(s9.lastIndex=0,o.m3u8=e,o.hasVariableRefs=ZW(e);(g=s9.exec(e))!==null;){S&&(S=!1,m=new eC(n,i),m.start=d,m.sn=h,m.cc=f,m.level=r,c&&(m.initSegment=c,m.rawProgramDateTime=c.rawProgramDateTime,c.rawProgramDateTime=null,A&&(m.setByteRange(A),A=null)));const T=g[1];if(T){m.duration=parseFloat(T);const C=(" "+g[2]).slice(1);m.title=C||null,m.tagList.push(C?["INF",T,C]:["INF",T])}else if(g[3]){if(Bt(m.duration)){m.start=d,y&&u9(m,y,o),m.sn=h,m.level=r,m.cc=f,l.push(m);const C=(" "+g[3]).slice(1);m.relurl=pk(o,C),c9(m,p),p=m,d+=m.duration,h++,u=0,S=!0}}else if(g[4]){const C=(" "+g[4]).slice(1);p?m.setByteRange(C,p):m.setByteRange(C)}else if(g[5])m.rawProgramDateTime=(" "+g[5]).slice(1),m.tagList.push(["PROGRAM-DATE-TIME",m.rawProgramDateTime]),x===-1&&(x=l.length);else{if(g=g[0].match(OEe),!g){Oe.warn("No matches on slow regex match for level playlist!");continue}for(v=1;v<g.length&&!(typeof g[v]<"u");v++);const C=(" "+g[v]).slice(1),D=(" "+g[v+1]).slice(1),B=g[v+2]?(" "+g[v+2]).slice(1):"";switch(C){case"PLAYLIST-TYPE":o.type=D.toUpperCase();break;case"MEDIA-SEQUENCE":h=o.startSN=parseInt(D);break;case"SKIP":{const O=new Ir(D);Za(o,O,["RECENTLY-REMOVED-DATERANGES"]);const L=O.decimalInteger("SKIPPED-SEGMENTS");if(Bt(L)){o.skippedSegments=L;for(let q=L;q--;)l.unshift(null);h+=L}const H=O.enumeratedString("RECENTLY-REMOVED-DATERANGES");H&&(o.recentlyRemovedDateranges=H.split("	"));break}case"TARGETDURATION":o.targetduration=Math.max(parseInt(D),1);break;case"VERSION":o.version=parseInt(D);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"#":(D||B)&&m.tagList.push(B?[D,B]:[D]);break;case"DISCONTINUITY":f++,m.tagList.push(["DIS"]);break;case"GAP":m.gap=!0,m.tagList.push([C]);break;case"BITRATE":m.tagList.push([C,D]);break;case"DATERANGE":{const O=new Ir(D);Za(o,O,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Za(o,O,O.clientAttrs);const L=new a5(O,o.dateRanges[O.ID]);L.isValid||o.skippedSegments?o.dateRanges[L.id]=L:Oe.warn(`Ignoring invalid DATERANGE tag: "${D}"`),m.tagList.push(["EXT-X-DATERANGE",D]);break}case"DEFINE":{{const O=new Ir(D);Za(o,O,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in O?TEe(o,O,a):e9(o,O,i)}break}case"DISCONTINUITY-SEQUENCE":f=parseInt(D);break;case"KEY":{const O=a9(D,i,o);if(O.isSupported()){if(O.method==="NONE"){y=void 0;break}y||(y={}),y[O.keyFormat]&&(y=zn({},y)),y[O.keyFormat]=O}else Oe.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${D}"`);break}case"START":o.startTimeOffset=o9(D);break;case"MAP":{const O=new Ir(D);if(Za(o,O,["BYTERANGE","URI"]),m.duration){const L=new eC(n,i);h9(L,O,r,y),c=L,m.initSegment=c,c.rawProgramDateTime&&!m.rawProgramDateTime&&(m.rawProgramDateTime=c.rawProgramDateTime)}else{const L=m.byteRangeEndOffset;if(L){const H=m.byteRangeStartOffset;A=`${L-H}@${H}`}else A=null;h9(m,O,r,y),c=m,S=!0}break}case"SERVER-CONTROL":{const O=new Ir(D);o.canBlockReload=O.bool("CAN-BLOCK-RELOAD"),o.canSkipUntil=O.optionalFloat("CAN-SKIP-UNTIL",0),o.canSkipDateRanges=o.canSkipUntil>0&&O.bool("CAN-SKIP-DATERANGES"),o.partHoldBack=O.optionalFloat("PART-HOLD-BACK",0),o.holdBack=O.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const O=new Ir(D);o.partTarget=O.decimalFloatingPoint("PART-TARGET");break}case"PART":{let O=o.partList;O||(O=o.partList=[]);const L=u>0?O[O.length-1]:void 0,H=u++,q=new Ir(D);Za(o,q,["BYTERANGE","URI"]);const W=new Nre(q,m,i,H,L);O.push(W),m.duration+=W.duration;break}case"PRELOAD-HINT":{const O=new Ir(D);Za(o,O,["URI"]),o.preloadHint=O;break}case"RENDITION-REPORT":{const O=new Ir(D);Za(o,O,["URI"]),o.renditionReports=o.renditionReports||[],o.renditionReports.push(O);break}default:Oe.warn(`line parsed but not handled: ${g}`);break}}}p&&!p.relurl?(l.pop(),d-=p.duration,o.partList&&(o.fragmentHint=p)):o.partList&&(c9(m,p),m.cc=f,o.fragmentHint=m,y&&u9(m,y,o));const _=l.length,M=l[0],E=l[_-1];if(d+=o.skippedSegments*o.targetduration,d>0&&_&&E){o.averagetargetduration=d/_;const T=E.sn;o.endSN=T!=="initSegment"?T:0,o.live||(E.endList=!0),M&&(o.startCC=M.cc)}else o.endSN=0,o.startCC=0;return o.fragmentHint&&(d+=o.fragmentHint.duration),o.totalduration=d,o.endCC=f,x>0&&FEe(l,x),o}}function a9(t,e,i){var r,n;const s=new Ir(t);Za(i,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const a=(r=s.METHOD)!=null?r:"",o=s.URI,l=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,h=(n=s.KEYFORMAT)!=null?n:"identity";o&&s.IV&&!l&&Oe.error(`Invalid IV: ${s.IV}`);const u=o?Ah.resolve(o,e):"",d=(c||"1").split("/").map(Number).filter(Number.isFinite);return new i1(a,u,h,d,l)}function o9(t){const i=new Ir(t).decimalFloatingPoint("TIME-OFFSET");return Bt(i)?i:null}function BEe(t,e){let i=(t||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const n=i.filter(s=>PEe(s,r));n.length&&(e[`${r}Codec`]=n.join(","),i=i.filter(s=>n.indexOf(s)===-1))}),e.unknownCodecs=i}function l9(t,e,i){const r=e[i];r&&(t[i]=r)}function FEe(t,e){let i=t[e];for(let r=e;r--;){const n=t[r];if(!n)return;n.programDateTime=i.programDateTime-n.duration*1e3,i=n}}function c9(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):e!=null&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),Bt(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}function h9(t,e,i,r){t.relurl=e.URI,e.BYTERANGE&&t.setByteRange(e.BYTERANGE),t.level=i,t.sn="initSegment",r&&(t.levelkeys=r),t.initSegment=null}function u9(t,e,i){t.levelkeys=e;const{encryptedFragments:r}=i;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(n=>e[n].isCommonEncryption)&&r.push(t)}var ki={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Jt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function d9(t){const{type:e}=t;switch(e){case ki.AUDIO_TRACK:return Jt.AUDIO;case ki.SUBTITLE_TRACK:return Jt.SUBTITLE;default:return Jt.MAIN}}function zL(t,e){let i=t.url;return(i===void 0||i.indexOf("data:")===0)&&(i=e.url),i}class kEe{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ee.LEVEL_LOADING,this.onLevelLoading,this),e.on(ee.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(ee.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ee.LEVEL_LOADING,this.onLevelLoading,this),e.off(ee.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(ee.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const i=this.hls.config,r=i.pLoader,n=i.loader,s=r||n,a=new s(i);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const i=this.loaders[e];i&&i.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,i){const{url:r}=i;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ki.MANIFEST,url:r,deliveryDirectives:null})}onLevelLoading(e,i){const{id:r,level:n,pathwayId:s,url:a,deliveryDirectives:o}=i;this.load({id:r,level:n,pathwayId:s,responseType:"text",type:ki.LEVEL,url:a,deliveryDirectives:o})}onAudioTrackLoading(e,i){const{id:r,groupId:n,url:s,deliveryDirectives:a}=i;this.load({id:r,groupId:n,level:null,responseType:"text",type:ki.AUDIO_TRACK,url:s,deliveryDirectives:a})}onSubtitleTrackLoading(e,i){const{id:r,groupId:n,url:s,deliveryDirectives:a}=i;this.load({id:r,groupId:n,level:null,responseType:"text",type:ki.SUBTITLE_TRACK,url:s,deliveryDirectives:a})}load(e){var i;const r=this.hls.config;let n=this.getInternalLoader(e);if(n){const c=n.context;if(c&&c.url===e.url&&c.level===e.level){Oe.trace("[playlist-loader]: playlist request ongoing");return}Oe.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}let s;if(e.type===ki.MANIFEST?s=r.manifestLoadPolicy.default:s=zn({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),Bt((i=e.deliveryDirectives)==null?void 0:i.part)){let c;if(e.type===ki.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===ki.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===ki.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const h=c.partTarget,u=c.targetduration;if(h&&u){const d=Math.max(h*3,u*.8)*1e3;s=zn({},s,{maxTimeToFirstByteMs:Math.min(d,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(d,s.maxTimeToFirstByteMs)})}}}const a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(c,h,u,d)=>{const f=this.getInternalLoader(u);this.resetInternalLoader(u.type);const p=c.data;if(p.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(c,u,new Error("no EXTM3U delimiter"),d||null,h);return}h.parsing.start=performance.now(),Ah.isMediaPlaylist(p)?this.handleTrackOrLevelPlaylist(c,h,u,d||null,f):this.handleMasterPlaylist(c,h,u,d)},onError:(c,h,u,d)=>{this.handleNetworkError(h,u,!1,c,d)},onTimeout:(c,h,u)=>{this.handleNetworkError(h,u,!0,void 0,c)}};n.load(e,o,l)}handleMasterPlaylist(e,i,r,n){const s=this.hls,a=e.data,o=zL(e,r),l=Ah.parseMasterPlaylist(a,o);if(l.playlistParsingError){this.handleManifestParsingError(e,r,l.playlistParsingError,n,i);return}const{contentSteering:c,levels:h,sessionData:u,sessionKeys:d,startTimeOffset:f,variableList:p}=l;this.variableList=p;const{AUDIO:m=[],SUBTITLES:g,"CLOSED-CAPTIONS":v}=Ah.parseMasterPlaylistMedia(a,o,l);m.length&&!m.some(x=>!x.url)&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(Oe.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Ir({}),bitrate:0,url:""})),s.trigger(ee.MANIFEST_LOADED,{levels:h,audioTracks:m,subtitles:g,captions:v,contentSteering:c,url:o,stats:i,networkDetails:n,sessionData:u,sessionKeys:d,startTimeOffset:f,variableList:p})}handleTrackOrLevelPlaylist(e,i,r,n,s){const a=this.hls,{id:o,level:l,type:c}=r,h=zL(e,r),u=0,d=Bt(l)?l:Bt(o)?o:0,f=d9(r),p=Ah.parseLevelPlaylist(e.data,h,d,f,u,this.variableList);if(c===ki.MANIFEST){const m={attrs:new Ir({}),bitrate:0,details:p,name:"",url:h};a.trigger(ee.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:h,stats:i,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}i.parsing.end=performance.now(),r.levelDetails=p,this.handlePlaylistLoaded(p,e,i,r,n,s)}handleManifestParsingError(e,i,r,n,s){this.hls.trigger(ee.ERROR,{type:oi.NETWORK_ERROR,details:je.MANIFEST_PARSING_ERROR,fatal:i.type===ki.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:i,networkDetails:n,stats:s})}handleNetworkError(e,i,r=!1,n,s){let a=`A network ${r?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${e.type}`;e.type===ki.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===ki.AUDIO_TRACK||e.type===ki.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);Oe.warn(`[playlist-loader]: ${a}`);let l=je.UNKNOWN,c=!1;const h=this.getInternalLoader(e);switch(e.type){case ki.MANIFEST:l=r?je.MANIFEST_LOAD_TIMEOUT:je.MANIFEST_LOAD_ERROR,c=!0;break;case ki.LEVEL:l=r?je.LEVEL_LOAD_TIMEOUT:je.LEVEL_LOAD_ERROR,c=!1;break;case ki.AUDIO_TRACK:l=r?je.AUDIO_TRACK_LOAD_TIMEOUT:je.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case ki.SUBTITLE_TRACK:l=r?je.SUBTITLE_TRACK_LOAD_TIMEOUT:je.SUBTITLE_LOAD_ERROR,c=!1;break}h&&this.resetInternalLoader(e.type);const u={type:oi.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:h,context:e,error:o,networkDetails:i,stats:s};if(n){const d=(i==null?void 0:i.url)||e.url;u.response=Is({url:d,data:void 0},n)}this.hls.trigger(ee.ERROR,u)}handlePlaylistLoaded(e,i,r,n,s,a){const o=this.hls,{type:l,level:c,id:h,groupId:u,deliveryDirectives:d}=n,f=zL(i,n),p=d9(n),m=typeof n.level=="number"&&p===Jt.MAIN?c:void 0;if(!e.fragments.length){const v=new Error("No Segments found in Playlist");o.trigger(ee.ERROR,{type:oi.NETWORK_ERROR,details:je.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:v,reason:v.message,response:i,context:n,level:m,parent:p,networkDetails:s,stats:r});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const g=e.playlistParsingError;if(g){o.trigger(ee.ERROR,{type:oi.NETWORK_ERROR,details:je.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:g,reason:g.message,response:i,context:n,level:m,parent:p,networkDetails:s,stats:r});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case ki.MANIFEST:case ki.LEVEL:o.trigger(ee.LEVEL_LOADED,{details:e,level:m||0,id:h||0,stats:r,networkDetails:s,deliveryDirectives:d});break;case ki.AUDIO_TRACK:o.trigger(ee.AUDIO_TRACK_LOADED,{details:e,id:h||0,groupId:u||"",stats:r,networkDetails:s,deliveryDirectives:d});break;case ki.SUBTITLE_TRACK:o.trigger(ee.SUBTITLE_TRACK_LOADED,{details:e,id:h||0,groupId:u||"",stats:r,networkDetails:s,deliveryDirectives:d});break}}}function Zre(t,e){let i;try{i=new Event("addtrack")}catch{i=document.createEvent("Event"),i.initEvent("addtrack",!1,!1)}i.track=t,e.dispatchEvent(i)}function ene(t,e){const i=t.mode;if(i==="disabled"&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){Oe.debug(`[texttrack-utils]: ${r}`);try{const n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,t.addCue(n)}catch(n){Oe.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${n}`)}}i==="disabled"&&(t.mode=i)}function ty(t){const e=t.mode;if(e==="disabled"&&(t.mode="hidden"),t.cues)for(let i=t.cues.length;i--;)t.removeCue(t.cues[i]);e==="disabled"&&(t.mode=e)}function mk(t,e,i,r){const n=t.mode;if(n==="disabled"&&(t.mode="hidden"),t.cues&&t.cues.length>0){const s=UEe(t.cues,e,i);for(let a=0;a<s.length;a++)(!r||r(s[a]))&&t.removeCue(s[a])}n==="disabled"&&(t.mode=n)}function NEe(t,e){if(e<t[0].startTime)return 0;const i=t.length-1;if(e>t[i].endTime)return-1;let r=0,n=i;for(;r<=n;){const s=Math.floor((n+r)/2);if(e<t[s].startTime)n=s-1;else if(e>t[s].startTime&&r<i)r=s+1;else return s}return t[r].startTime-e<e-t[n].startTime?r:n}function UEe(t,e,i){const r=[],n=NEe(t,e);if(n>-1)for(let s=n,a=t.length;s<a;s++){const o=t[s];if(o.startTime>=e&&o.endTime<=i)r.push(o);else if(o.startTime>i)return r}return r}function tC(t){const e=[];for(let i=0;i<t.length;i++){const r=t[i];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(t[i])}return e}var Pl={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const zEe=.25;function gk(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function f9(t,e,i,r,n){let s=new t(e,i,"");try{s.value=r,n&&(s.type=n)}catch{s=new t(e,i,JSON.stringify(n?Is({type:n},r):r))}return s}const qE=(()=>{const t=gk();try{t&&new t(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function GL(t,e){return t.getTime()/1e3-e}function GEe(t){return Uint8Array.from(t.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class VEe{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ee.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(ee.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ee.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(ee.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,i){this.media=i.media}onMediaDetaching(){this.id3Track&&(ty(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const i=this.getID3Track(e.textTracks);return i.mode="hidden",i}getID3Track(e){if(this.media){for(let i=0;i<e.length;i++){const r=e[i];if(r.kind==="metadata"&&r.label==="id3")return Zre(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,i){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:n}}}=this;if(!r&&!n)return;const{samples:s}=i;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=gk();if(a)for(let o=0;o<s.length;o++){const l=s[o].type;if(l===Pl.emsg&&!r||!n)continue;const c=Hre(s[o].data);if(c){const h=s[o].pts;let u=h+s[o].duration;u>qE&&(u=qE),u-h<=0&&(u=h+zEe);for(let f=0;f<c.length;f++){const p=c[f];if(!Vre(p)){this.updateId3CueEnds(h,l);const m=f9(a,h,u,p,l);m&&this.id3Track.addCue(m)}}}}}updateId3CueEnds(e,i){var r;const n=(r=this.id3Track)==null?void 0:r.cues;if(n)for(let s=n.length;s--;){const a=n[s];a.type===i&&a.startTime<e&&a.endTime===qE&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:i,endOffset:r,type:n}){const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(s&&(o||l)){let c;n==="audio"?c=h=>h.type===Pl.audioId3&&l:n==="video"?c=h=>h.type===Pl.emsg&&o:c=h=>h.type===Pl.audioId3&&l||h.type===Pl.emsg&&o,mk(s,i,r,c)}}onLevelUpdated(e,{details:i}){if(!this.media||!i.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:r,id3Track:n}=this,{dateRanges:s}=i,a=Object.keys(s);if(n){const h=Object.keys(r).filter(u=>!a.includes(u));for(let u=h.length;u--;){const d=h[u];Object.keys(r[d].cues).forEach(f=>{n.removeCue(r[d].cues[f])}),delete r[d]}}const o=i.fragments[i.fragments.length-1];if(a.length===0||!Bt(o==null?void 0:o.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=o.programDateTime/1e3-o.start,c=gk();for(let h=0;h<a.length;h++){const u=a[h],d=s[u],f=GL(d.startDate,l),p=r[u],m=(p==null?void 0:p.cues)||{};let g=(p==null?void 0:p.durationKnown)||!1,v=qE;const y=d.endDate;if(y)v=GL(y,l),g=!0;else if(d.endOnNext&&!g){const S=a.reduce((A,_)=>{if(_!==d.id){const M=s[_];if(M.class===d.class&&M.startDate>d.startDate&&(!A||d.startDate<A.startDate))return M}return A},null);S&&(v=GL(S.startDate,l),g=!0)}const x=Object.keys(d.attr);for(let S=0;S<x.length;S++){const A=x[S];if(!YAe(A))continue;const _=m[A];if(_)g&&!p.durationKnown&&(_.endTime=v);else if(c){let M=d.attr[A];qAe(A)&&(M=GEe(M));const E=f9(c,f,v,{key:A,data:M},Pl.dateRange);E&&(E.id=u,this.id3Track.addCue(E),m[A]=E)}}r[u]={cues:m,dateRange:d,durationKnown:g}}}}class HEe{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:i}=this;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:i?e.liveMaxLatencyDurationCount*i.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(e===null)return null;const{holdBack:i,partHoldBack:r,targetduration:n}=e,{liveSyncDuration:s,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let c=o&&r||i;(l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=s!==void 0?s:a*n);const h=n;return c+Math.min(this.stallCount*1,h)}get liveSyncPosition(){const e=this.estimateLiveEdge(),i=this.targetLatency,r=this.levelDetails;if(e===null||i===null||r===null)return null;const n=r.edge,s=e-i-this.edgeStalled,a=n-r.totalduration,o=n-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,s),o)}get drift(){const{levelDetails:e}=this;return e===null?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(e===null)return 0;const i=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-i,0)}get forwardBufferLength(){const{media:e,levelDetails:i}=this;if(!e||!i)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):i.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(ee.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(ee.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(ee.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(ee.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(ee.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(ee.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(ee.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(ee.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(ee.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(ee.ERROR,this.onError,this)}onMediaAttached(e,i){this.media=i.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:i}){this.levelDetails=i,i.advanced&&this.timeupdate(),!i.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,i){var r;i.details===je.BUFFER_STALLED_ERROR&&(this.stallCount++,(r=this.levelDetails)!=null&&r.live&&Oe.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:i}=this;if(!e||!i)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:n,maxLiveSyncPlaybackRate:s}=this.config;if(!n||s===1||!i.live)return;const a=this.targetLatency;if(a===null)return;const o=r-a,l=Math.min(this.maxLatency,a+i.targetduration);if(o<l&&o>.05&&this.forwardBufferLength>1){const h=Math.min(2,Math.max(1,s)),u=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;e.playbackRate=Math.min(h,Math.max(1,u))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}const vk=["NONE","TYPE-0","TYPE-1",null];function jEe(t){return vk.indexOf(t)>-1}const f2=["SDR","PQ","HLG"];function WEe(t){return!!t&&f2.indexOf(t)>-1}var lw={No:"",Yes:"YES",v2:"v2"};function p9(t){const{canSkipUntil:e,canSkipDateRanges:i,age:r}=t,n=r<e/2;return e&&n?i?lw.v2:lw.Yes:lw.No}class yk{constructor(e,i,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=i,this.skip=r}addDirectives(e){const i=new self.URL(e);return this.msn!==void 0&&i.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&i.searchParams.set("_HLS_part",this.part.toString()),this.skip&&i.searchParams.set("_HLS_skip",this.skip),i.href}}class Ug{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return m9(this._audioGroups,e)}hasSubtitleGroup(e){return m9(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,i){if(i){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(i)===-1&&r.push(i)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(i)===-1&&r.push(i)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function m9(t,e){return!e||!t?!1:t.indexOf(e)!==-1}function VL(t,e){const i=e.startPTS;if(Bt(i)){let r=0,n;e.sn>t.sn?(r=i-t.start,n=t):(r=t.start-i,n=e),n.duration!==r&&(n.duration=r)}else e.sn>t.sn?t.cc===e.cc&&t.minEndPTS?e.start=t.start+(t.minEndPTS-t.start):e.start=t.start+t.duration:e.start=Math.max(t.start-e.duration,0)}function tne(t,e,i,r,n,s){r-i<=0&&(Oe.warn("Fragment should have a positive duration",e),r=i+e.duration,s=n+e.duration);let o=i,l=r;const c=e.startPTS,h=e.endPTS;if(Bt(c)){const g=Math.abs(c-i);Bt(e.deltaPTS)?e.deltaPTS=Math.max(g,e.deltaPTS):e.deltaPTS=g,o=Math.max(i,c),i=Math.min(i,c),n=Math.min(n,e.startDTS),l=Math.min(r,h),r=Math.max(r,h),s=Math.max(s,e.endDTS)}const u=i-e.start;e.start!==0&&(e.start=i),e.duration=r-e.start,e.startPTS=i,e.maxStartPTS=o,e.startDTS=n,e.endPTS=r,e.minEndPTS=l,e.endDTS=s;const d=e.sn;if(!t||d<t.startSN||d>t.endSN)return 0;let f;const p=d-t.startSN,m=t.fragments;for(m[p]=e,f=p;f>0;f--)VL(m[f],m[f-1]);for(f=p;f<m.length-1;f++)VL(m[f],m[f+1]);return t.fragmentHint&&VL(m[m.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,u}function XEe(t,e){let i=null;const r=t.fragments;for(let l=r.length-1;l>=0;l--){const c=r[l].initSegment;if(c){i=c;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;let n=0,s;if(KEe(t,e,(l,c)=>{l.relurl&&(n=l.cc-c.cc),Bt(l.startPTS)&&Bt(l.endPTS)&&(c.start=c.startPTS=l.startPTS,c.startDTS=l.startDTS,c.maxStartPTS=l.maxStartPTS,c.endPTS=l.endPTS,c.endDTS=l.endDTS,c.minEndPTS=l.minEndPTS,c.duration=l.endPTS-l.startPTS,c.duration&&(s=c),e.PTSKnown=e.alignedSliding=!0),c.elementaryStreams=l.elementaryStreams,c.loader=l.loader,c.stats=l.stats,l.initSegment&&(c.initSegment=l.initSegment,i=l.initSegment)}),i&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach(c=>{var h;c&&(!c.initSegment||c.initSegment.relurl===((h=i)==null?void 0:h.relurl))&&(c.initSegment=i)}),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(l=>!l),e.deltaUpdateFailed){Oe.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let l=e.skippedSegments;l--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=YEe(t.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));const a=e.fragments;if(n){Oe.warn("discontinuity sliding from playlist, take drift into account");for(let l=0;l<a.length;l++)a[l].cc+=n}e.skippedSegments&&(e.startCC=e.fragments[0].cc),qEe(t.partList,e.partList,(l,c)=>{c.elementaryStreams=l.elementaryStreams,c.stats=l.stats}),s?tne(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):ine(t,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=t.driftStartTime,e.driftStart=t.driftStart;const o=e.advancedDateTime;if(e.advanced&&o){const l=e.edge;e.driftStart||(e.driftStartTime=o,e.driftStart=l),e.driftEndTime=o,e.driftEnd=l}else e.driftEndTime=t.driftEndTime,e.driftEnd=t.driftEnd,e.advancedDateTime=t.advancedDateTime}function YEe(t,e,i){const r=zn({},t);return i&&i.forEach(n=>{delete r[n]}),Object.keys(e).forEach(n=>{const s=new a5(e[n].attr,r[n]);s.isValid?r[n]=s:Oe.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[n].attr)}"`)}),r}function qEe(t,e,i){if(t&&e){let r=0;for(let n=0,s=t.length;n<=s;n++){const a=t[n],o=e[n+r];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?i(a,o):r--}}}function KEe(t,e,i){const r=e.skippedSegments,n=Math.max(t.startSN,e.startSN)-e.startSN,s=(t.fragmentHint?1:0)+(r?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,a=e.startSN-t.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;for(let c=n;c<=s;c++){const h=l[a+c];let u=o[c];r&&!u&&c<r&&(u=e.fragments[c]=h),h&&u&&i(h,u)}}function ine(t,e){const i=e.startSN+e.skippedSegments-t.startSN,r=t.fragments;i<0||i>=r.length||xk(e,r[i].start)}function xk(t,e){if(e){const i=t.fragments;for(let r=t.skippedSegments;r<i.length;r++)i[r].start+=e;t.fragmentHint&&(t.fragmentHint.start+=e)}}function QEe(t,e=1/0){let i=1e3*t.targetduration;if(t.updated){const r=t.fragments;if(r.length&&i*4>e){const s=r[r.length-1].duration*1e3;s<i&&(i=s)}}else i/=2;return Math.round(i)}function $Ee(t,e,i){if(!(t!=null&&t.details))return null;const r=t.details;let n=r.fragments[e-r.startSN];return n||(n=r.fragmentHint,n&&n.sn===e)?n:e<r.startSN&&i&&i.sn===e?i:null}function g9(t,e,i){var r;return t!=null&&t.details?rne((r=t.details)==null?void 0:r.partList,e,i):null}function rne(t,e,i){if(t)for(let r=t.length;r--;){const n=t[r];if(n.index===i&&n.fragment.sn===e)return n}return null}function nne(t){t.forEach((e,i)=>{const{details:r}=e;r!=null&&r.fragments&&r.fragments.forEach(n=>{n.level=i})})}function p2(t){switch(t.details){case je.FRAG_LOAD_TIMEOUT:case je.KEY_LOAD_TIMEOUT:case je.LEVEL_LOAD_TIMEOUT:case je.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function v9(t,e){const i=p2(e);return t.default[`${i?"timeout":"error"}Retry`]}function u5(t,e){const i=t.backoff==="linear"?1:Math.pow(2,e);return Math.min(i*t.retryDelayMs,t.maxRetryDelayMs)}function y9(t){return Is(Is({},t),{errorRetry:null,timeoutRetry:null})}function m2(t,e,i,r){if(!t)return!1;const n=r==null?void 0:r.code,s=e<t.maxNumRetry&&(JEe(n)||!!i);return t.shouldRetry?t.shouldRetry(t,e,i,r,s):s}function JEe(t){return t===0&&navigator.onLine===!1||!!t&&(t<400||t>499)}const sne={search:function(t,e){let i=0,r=t.length-1,n=null,s=null;for(;i<=r;){n=(i+r)/2|0,s=t[n];const a=e(s);if(a>0)i=n+1;else if(a<0)r=n-1;else return s}return null}};function ZEe(t,e,i){if(e===null||!Array.isArray(t)||!t.length||!Bt(e))return null;const r=t[0].programDateTime;if(e<(r||0))return null;const n=t[t.length-1].endProgramDateTime;if(e>=(n||0))return null;i=i||0;for(let s=0;s<t.length;++s){const a=t[s];if(tMe(e,i,a))return a}return null}function g2(t,e,i=0,r=0,n=.005){let s=null;if(t){s=e[t.sn-e[0].sn+1]||null;const o=t.endDTS-i;o>0&&o<15e-7&&(i+=15e-7)}else i===0&&e[0].start===0&&(s=e[0]);if(s&&((!t||t.level===s.level)&&bk(i,r,s)===0||eMe(s,t,Math.min(n,r))))return s;const a=sne.search(e,bk.bind(null,i,r));return a&&(a!==t||!s)?a:s}function eMe(t,e,i){if(e&&e.start===0&&e.level<t.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((n,s)=>(s[0]==="INF"&&(n+=parseFloat(s[1])),n),i);return t.start<=r}return!1}function bk(t=0,e=0,i){if(i.start<=t&&i.start+i.duration>t)return 0;const r=Math.min(e,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-r<=t?1:i.start-r>t&&i.start?-1:0}function tMe(t,e,i){const r=Math.min(e,i.duration+(i.deltaPTS?i.deltaPTS:0))*1e3;return(i.endProgramDateTime||0)-r>t}function iMe(t,e){return sne.search(t,i=>i.cc<e?1:i.cc>e?-1:0)}var Qn={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},gl={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class ane{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=Oe.log.bind(Oe,"[info]:"),this.warn=Oe.warn.bind(Oe,"[warning]:"),this.error=Oe.error.bind(Oe,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(ee.ERROR,this.onError,this),e.on(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ee.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(ee.ERROR,this.onError,this),e.off(ee.ERROR,this.onErrorOut,this),e.off(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ee.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Jt.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,i){var r,n;if(i.fatal)return;const s=this.hls,a=i.context;switch(i.details){case je.FRAG_LOAD_ERROR:case je.FRAG_LOAD_TIMEOUT:case je.KEY_LOAD_ERROR:case je.KEY_LOAD_TIMEOUT:i.errorAction=this.getFragRetryOrSwitchAction(i);return;case je.FRAG_PARSING_ERROR:if((r=i.frag)!=null&&r.gap){i.errorAction={action:Qn.DoNothing,flags:gl.None};return}case je.FRAG_GAP:case je.FRAG_DECRYPT_ERROR:{i.errorAction=this.getFragRetryOrSwitchAction(i),i.errorAction.action=Qn.SendAlternateToPenaltyBox;return}case je.LEVEL_EMPTY_ERROR:case je.LEVEL_PARSING_ERROR:{var o,l;const c=i.parent===Jt.MAIN?i.level:s.loadLevel;i.details===je.LEVEL_EMPTY_ERROR&&((o=i.context)!=null&&(l=o.levelDetails)!=null&&l.live)?i.errorAction=this.getPlaylistRetryOrSwitchAction(i,c):(i.levelRetry=!1,i.errorAction=this.getLevelSwitchAction(i,c))}return;case je.LEVEL_LOAD_ERROR:case je.LEVEL_LOAD_TIMEOUT:typeof(a==null?void 0:a.level)=="number"&&(i.errorAction=this.getPlaylistRetryOrSwitchAction(i,a.level));return;case je.AUDIO_TRACK_LOAD_ERROR:case je.AUDIO_TRACK_LOAD_TIMEOUT:case je.SUBTITLE_LOAD_ERROR:case je.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const c=s.levels[s.loadLevel];if(c&&(a.type===ki.AUDIO_TRACK&&c.hasAudioGroup(a.groupId)||a.type===ki.SUBTITLE_TRACK&&c.hasSubtitleGroup(a.groupId))){i.errorAction=this.getPlaylistRetryOrSwitchAction(i,s.loadLevel),i.errorAction.action=Qn.SendAlternateToPenaltyBox,i.errorAction.flags=gl.MoveAllAlternatesMatchingHost;return}}return;case je.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const c=s.levels[s.loadLevel],h=c==null?void 0:c.attrs["HDCP-LEVEL"];h?i.errorAction={action:Qn.SendAlternateToPenaltyBox,flags:gl.MoveAllAlternatesMatchingHDCP,hdcpLevel:h}:this.keySystemError(i)}return;case je.BUFFER_ADD_CODEC_ERROR:case je.REMUX_ALLOC_ERROR:case je.BUFFER_APPEND_ERROR:i.errorAction=this.getLevelSwitchAction(i,(n=i.level)!=null?n:s.loadLevel);return;case je.INTERNAL_EXCEPTION:case je.BUFFER_APPENDING_ERROR:case je.BUFFER_FULL_ERROR:case je.LEVEL_SWITCH_ERROR:case je.BUFFER_STALLED_ERROR:case je.BUFFER_SEEK_OVER_HOLE:case je.BUFFER_NUDGE_ON_STALL:i.errorAction={action:Qn.DoNothing,flags:gl.None};return}i.type===oi.KEY_SYSTEM_ERROR&&this.keySystemError(i)}keySystemError(e){const i=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,i)}getPlaylistRetryOrSwitchAction(e,i){const r=this.hls,n=v9(r.config.playlistLoadPolicy,e),s=this.playlistError++;if(m2(n,s,p2(e),e.response))return{action:Qn.RetryRequest,flags:gl.None,retryConfig:n,retryCount:s};const o=this.getLevelSwitchAction(e,i);return n&&(o.retryConfig=n,o.retryCount=s),o}getFragRetryOrSwitchAction(e){const i=this.hls,r=this.getVariantLevelIndex(e.frag),n=i.levels[r],{fragLoadPolicy:s,keyLoadPolicy:a}=i.config,o=v9(e.details.startsWith("key")?a:s,e),l=i.levels.reduce((h,u)=>h+u.fragmentError,0);if(n&&(e.details!==je.FRAG_GAP&&n.fragmentError++,m2(o,l,p2(e),e.response)))return{action:Qn.RetryRequest,flags:gl.None,retryConfig:o,retryCount:l};const c=this.getLevelSwitchAction(e,r);return o&&(c.retryConfig=o,c.retryCount=l),c}getLevelSwitchAction(e,i){const r=this.hls;i==null&&(i=r.loadLevel);const n=this.hls.levels[i];if(n){var s,a;const c=e.details;n.loadError++,c===je.BUFFER_APPEND_ERROR&&n.fragmentError++;let h=-1;const{levels:u,loadLevel:d,minAutoLevel:f,maxAutoLevel:p}=r;r.autoLevelEnabled||(r.loadLevel=-1);const m=(s=e.frag)==null?void 0:s.type,v=(m===Jt.AUDIO&&c===je.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===je.BUFFER_ADD_CODEC_ERROR||c===je.BUFFER_APPEND_ERROR))&&u.some(({audioCodec:_})=>n.audioCodec!==_),x=e.sourceBufferName==="video"&&(c===je.BUFFER_ADD_CODEC_ERROR||c===je.BUFFER_APPEND_ERROR)&&u.some(({codecSet:_,audioCodec:M})=>n.codecSet!==_&&n.audioCodec===M),{type:S,groupId:A}=(a=e.context)!=null?a:{};for(let _=u.length;_--;){const M=(_+d)%u.length;if(M!==d&&M>=f&&M<=p&&u[M].loadError===0){var o,l;const E=u[M];if(c===je.FRAG_GAP&&m===Jt.MAIN&&e.frag){const T=u[M].details;if(T){const C=g2(e.frag,T.fragments,e.frag.start);if(C!=null&&C.gap)continue}}else{if(S===ki.AUDIO_TRACK&&E.hasAudioGroup(A)||S===ki.SUBTITLE_TRACK&&E.hasSubtitleGroup(A))continue;if(m===Jt.AUDIO&&(o=n.audioGroups)!=null&&o.some(T=>E.hasAudioGroup(T))||m===Jt.SUBTITLE&&(l=n.subtitleGroups)!=null&&l.some(T=>E.hasSubtitleGroup(T))||v&&n.audioCodec===E.audioCodec||!v&&n.audioCodec!==E.audioCodec||x&&n.codecSet===E.codecSet)continue}h=M;break}}if(h>-1&&r.loadLevel!==h)return e.levelRetry=!0,this.playlistError=0,{action:Qn.SendAlternateToPenaltyBox,flags:gl.None,nextAutoLevel:h}}return{action:Qn.SendAlternateToPenaltyBox,flags:gl.MoveAllAlternatesMatchingHost}}onErrorOut(e,i){var r;switch((r=i.errorAction)==null?void 0:r.action){case Qn.DoNothing:break;case Qn.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(i),!i.errorAction.resolved&&i.details!==je.FRAG_GAP?i.fatal=!0:/MediaSource readyState: ended/.test(i.error.message)&&(this.warn(`MediaSource ended after "${i.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break;case Qn.RetryRequest:break}if(i.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const i=this.hls,r=e.errorAction;if(!r)return;const{flags:n,hdcpLevel:s,nextAutoLevel:a}=r;switch(n){case gl.None:this.switchLevel(e,a);break;case gl.MoveAllAlternatesMatchingHDCP:s&&(i.maxHdcpLevel=vk[vk.indexOf(s)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${i.maxHdcpLevel}" or lower`);break}r.resolved||this.switchLevel(e,a)}switchLevel(e,i){i!==void 0&&e.errorAction&&(this.warn(`switching to level ${i} after ${e.details}`),this.hls.nextAutoLevel=i,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class wD{constructor(e,i){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=Oe.log.bind(Oe,`${i}:`),this.warn=Oe.warn.bind(Oe,`${i}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,i,r){const n=i==null?void 0:i.renditionReports;if(n){let s=-1;for(let a=0;a<n.length;a++){const o=n[a];let l;try{l=new self.URL(o.URI,i.url).href}catch(c){Oe.warn(`Could not construct new URL for Rendition Report: ${c}`),l=o.URI||""}if(l===e){s=a;break}else l===e.substring(0,l.length)&&(s=a)}if(s!==-1){const a=n[s],o=parseInt(a["LAST-MSN"])||(i==null?void 0:i.lastPartSn);let l=parseInt(a["LAST-PART"])||(i==null?void 0:i.lastPartIndex);if(this.hls.config.lowLatencyMode){const h=Math.min(i.age-i.partTarget,i.targetduration);l>=0&&h>i.partTarget&&(l+=1)}const c=r&&p9(r);return new yk(o,l>=0?l:void 0,c)}}}loadPlaylist(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)}playlistLoaded(e,i,r){const{details:n,stats:s}=i,a=self.performance.now(),o=s.loading.first?Math.max(0,a-s.loading.first):0;if(n.advancedDateTime=Date.now()-o,n.live||r!=null&&r.live){if(n.reloaded(r),r&&this.log(`live playlist ${e} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),r&&n.fragments.length>0&&XEe(r,n),!this.canLoad||!n.live)return;let l,c,h;if(n.canBlockReload&&n.endSN&&n.advanced){const g=this.hls.config.lowLatencyMode,v=n.lastPartSn,y=n.endSN,x=n.lastPartIndex,S=x!==-1,A=v===y,_=g?0:x;S?(c=A?y+1:v,h=A?_:x+1):c=y+1;const M=n.age,E=M+n.ageHeader;let T=Math.min(E-n.partTarget,n.targetduration*1.5);if(T>0){if(r&&T>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${T} with playlist age: ${n.age}`),T=0;else{const C=Math.floor(T/n.targetduration);if(c+=C,h!==void 0){const D=Math.round(T%n.targetduration/n.partTarget);h+=D}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${M.toFixed(2)}s goal: ${T} skip sn ${C} to part ${h}`)}n.tuneInGoal=T}if(l=this.getDeliveryDirectives(n,i.deliveryDirectives,c,h),g||!A){this.loadPlaylist(l);return}}else(n.canBlockReload||n.canSkipUntil)&&(l=this.getDeliveryDirectives(n,i.deliveryDirectives,c,h));const u=this.hls.mainForwardBufferInfo,d=u?u.end-u.len:0,f=(n.edge-d)*1e3,p=QEe(n,f);n.updated&&a>this.requestScheduled+p&&(this.requestScheduled=s.loading.start),c!==void 0&&n.canBlockReload?this.requestScheduled=s.loading.first+p-(n.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+p<a?this.requestScheduled=a:this.requestScheduled-a<=0&&(this.requestScheduled+=p);let m=this.requestScheduled-a;m=Math.max(0,m),this.log(`reload live playlist ${e} in ${Math.round(m)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(l),m)}else this.clearTimer()}getDeliveryDirectives(e,i,r,n){let s=p9(e);return i!=null&&i.skip&&e.deltaUpdateFailed&&(r=i.msn,n=i.part,s=lw.No),new yk(r,n,s)}checkRetry(e){const i=e.details,r=p2(e),n=e.errorAction,{action:s,retryCount:a=0,retryConfig:o}=n||{},l=!!n&&!!o&&(s===Qn.RetryRequest||!n.resolved&&s===Qn.SendAlternateToPenaltyBox);if(l){var c;if(this.requestScheduled=-1,a>=o.maxNumRetry)return!1;if(r&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${i}" without delivery-directives`),this.loadPlaylist();else{const h=u5(o,a);this.timer=self.setTimeout(()=>this.loadPlaylist(),h),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${i}" in ${h}ms`)}e.levelRetry=!0,n.resolved=!0}return l}}class W0{constructor(e,i=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=i,this.totalWeight_=r}sample(e,i){const r=Math.pow(this.alpha_,e);this.estimate_=i*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class rMe{constructor(e,i,r,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new W0(e),this.fast_=new W0(i),this.defaultTTFB_=n,this.ttfb_=new W0(e)}update(e,i){const{slow_:r,fast_:n,ttfb_:s}=this;r.halfLife!==e&&(this.slow_=new W0(e,r.getEstimate(),r.getTotalWeight())),n.halfLife!==i&&(this.fast_=new W0(i,n.getEstimate(),n.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new W0(e,s.getEstimate(),s.getTotalWeight()))}sample(e,i){e=Math.max(e,this.minDelayMs_);const r=8*i,n=e/1e3,s=r/n;this.fast_.sample(n,s),this.slow_.sample(n,s)}sampleTTFB(e){const i=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(i,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const one={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},x9={};function nMe(t,e,i,r,n,s){const a=t.audioCodec?t.audioGroups:null,o=s==null?void 0:s.audioCodec,l=s==null?void 0:s.channels,c=l?parseInt(l):o?1/0:2;let h=null;if(a!=null&&a.length)try{a.length===1&&a[0]?h=e.groups[a[0]].channels:h=a.reduce((u,d)=>{if(d){const f=e.groups[d];if(!f)throw new Error(`Audio track group ${d} not found`);Object.keys(f.channels).forEach(p=>{u[p]=(u[p]||0)+f.channels[p]})}return u},{2:0})}catch{return!0}return t.videoCodec!==void 0&&(t.width>1920&&t.height>1088||t.height>1920&&t.width>1088||t.frameRate>Math.max(r,30)||t.videoRange!=="SDR"&&t.videoRange!==i||t.bitrate>Math.max(n,8e6))||!!h&&Bt(c)&&Object.keys(h).some(u=>parseInt(u)>c)}function sMe(t,e,i){const r=t.videoCodec,n=t.audioCodec;if(!r||!n||!i)return Promise.resolve(one);const s={width:t.width,height:t.height,bitrate:Math.ceil(Math.max(t.bitrate*.9,t.averageBitrate)),framerate:t.frameRate||30},a=t.videoRange;a!=="SDR"&&(s.transferFunction=a.toLowerCase());const o=r.split(",").map(l=>({type:"media-source",video:Is(Is({},s),{},{contentType:hS(l,"video")})}));return n&&t.audioGroups&&t.audioGroups.forEach(l=>{var c;l&&((c=e.groups[l])==null||c.tracks.forEach(h=>{if(h.groupId===l){const u=h.channels||"",d=parseFloat(u);Bt(d)&&d>2&&o.push.apply(o,n.split(",").map(f=>({type:"media-source",audio:{contentType:hS(f,"audio"),channels:""+d}})))}}))}),Promise.all(o.map(l=>{const c=aMe(l);return x9[c]||(x9[c]=i.decodingInfo(l))})).then(l=>({supported:!l.some(c=>!c.supported),configurations:o,decodingInfoResults:l})).catch(l=>({supported:!1,configurations:o,decodingInfoResults:[],error:l}))}function aMe(t){const{audio:e,video:i}=t,r=i||e;if(r){const n=r.contentType.split('"')[1];if(i)return`r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${n}_${Math.ceil(i.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${n}`}return""}function oMe(){if(typeof matchMedia=="function"){const t=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(t.media!==e.media)return t.matches===!0}return!1}function lMe(t,e){let i=!1,r=[];return t&&(i=t!=="SDR",r=[t]),e&&(r=e.allowedVideoRanges||f2.slice(0),i=e.preferHDR!==void 0?e.preferHDR:oMe(),i?r=r.filter(n=>n!=="SDR"):r=["SDR"]),{preferHDR:i,allowedVideoRanges:r}}function cMe(t,e,i,r,n){const s=Object.keys(t),a=r==null?void 0:r.channels,o=r==null?void 0:r.audioCodec,l=a&&parseInt(a)===2;let c=!0,h=!1,u=1/0,d=1/0,f=1/0,p=0,m=[];const{preferHDR:g,allowedVideoRanges:v}=lMe(e,n);for(let A=s.length;A--;){const _=t[s[A]];c=_.channels[2]>0,u=Math.min(u,_.minHeight),d=Math.min(d,_.minFramerate),f=Math.min(f,_.minBitrate);const M=v.filter(E=>_.videoRanges[E]>0);M.length>0&&(h=!0,m=M)}u=Bt(u)?u:0,d=Bt(d)?d:0;const y=Math.max(1080,u),x=Math.max(30,d);return f=Bt(f)?f:i,i=Math.max(f,i),h||(e=void 0,m=[]),{codecSet:s.reduce((A,_)=>{const M=t[_];if(_===A)return A;if(M.minBitrate>i)return hu(_,`min bitrate of ${M.minBitrate} > current estimate of ${i}`),A;if(!M.hasDefaultAudio)return hu(_,"no renditions with default or auto-select sound found"),A;if(o&&_.indexOf(o.substring(0,4))%5!==0)return hu(_,`audio codec preference "${o}" not found`),A;if(a&&!l){if(!M.channels[a])return hu(_,`no renditions with ${a} channel sound found (channels options: ${Object.keys(M.channels)})`),A}else if((!o||l)&&c&&M.channels[2]===0)return hu(_,"no renditions with stereo sound found"),A;return M.minHeight>y?(hu(_,`min resolution of ${M.minHeight} > maximum of ${y}`),A):M.minFramerate>x?(hu(_,`min framerate of ${M.minFramerate} > maximum of ${x}`),A):m.some(E=>M.videoRanges[E]>0)?M.maxScore<p?(hu(_,`max score of ${M.maxScore} < selected max of ${p}`),A):A&&(u2(_)>=u2(A)||M.fragmentError>t[A].fragmentError)?A:(p=M.maxScore,_):(hu(_,`no variants with VIDEO-RANGE of ${JSON.stringify(m)} found`),A)},void 0),videoRanges:m,preferHDR:g,minFramerate:d,minBitrate:f}}function hu(t,e){Oe.log(`[abr] start candidates with "${t}" ignored because ${e}`)}function hMe(t){return t.reduce((e,i)=>{let r=e.groups[i.groupId];r||(r=e.groups[i.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(i);const n=i.channels||"2";return r.channels[n]=(r.channels[n]||0)+1,r.hasDefault=r.hasDefault||i.default,r.hasAutoSelect=r.hasAutoSelect||i.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function uMe(t,e,i,r){return t.slice(i,r+1).reduce((n,s)=>{if(!s.codecSet)return n;const a=s.audioGroups;let o=n[s.codecSet];o||(n[s.codecSet]=o={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),o.minBitrate=Math.min(o.minBitrate,s.bitrate);const l=Math.min(s.height,s.width);return o.minHeight=Math.min(o.minHeight,l),o.minFramerate=Math.min(o.minFramerate,s.frameRate),o.maxScore=Math.max(o.maxScore,s.score),o.fragmentError+=s.fragmentError,o.videoRanges[s.videoRange]=(o.videoRanges[s.videoRange]||0)+1,a&&a.forEach(c=>{if(!c)return;const h=e.groups[c];h&&(o.hasDefaultAudio=o.hasDefaultAudio||e.hasDefaultAudio?h.hasDefault:h.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(h.channels).forEach(u=>{o.channels[u]=(o.channels[u]||0)+h.channels[u]}))}),n},{})}function Eh(t,e,i){if("attrs"in t){const r=e.indexOf(t);if(r!==-1)return r}for(let r=0;r<e.length;r++){const n=e[r];if(Ey(t,n,i))return r}return-1}function Ey(t,e,i){const{groupId:r,name:n,lang:s,assocLang:a,characteristics:o,default:l}=t,c=t.forced;return(r===void 0||e.groupId===r)&&(n===void 0||e.name===n)&&(s===void 0||e.lang===s)&&(s===void 0||e.assocLang===a)&&(l===void 0||e.default===l)&&(c===void 0||e.forced===c)&&(o===void 0||dMe(o,e.characteristics))&&(i===void 0||i(t,e))}function dMe(t,e=""){const i=t.split(","),r=e.split(",");return i.length===r.length&&!i.some(n=>r.indexOf(n)===-1)}function X0(t,e){const{audioCodec:i,channels:r}=t;return(i===void 0||(e.audioCodec||"").substring(0,4)===i.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function fMe(t,e,i,r,n){const s=e[r],o=e.reduce((d,f,p)=>{const m=f.uri;return(d[m]||(d[m]=[])).push(p),d},{})[s.uri];o.length>1&&(r=Math.max.apply(Math,o));const l=s.videoRange,c=s.frameRate,h=s.codecSet.substring(0,4),u=b9(e,r,d=>{if(d.videoRange!==l||d.frameRate!==c||d.codecSet.substring(0,4)!==h)return!1;const f=d.audioGroups,p=i.filter(m=>!f||f.indexOf(m.groupId)!==-1);return Eh(t,p,n)>-1});return u>-1?u:b9(e,r,d=>{const f=d.audioGroups,p=i.filter(m=>!f||f.indexOf(m.groupId)!==-1);return Eh(t,p,n)>-1})}function b9(t,e,i){for(let r=e;r>-1;r--)if(i(t[r]))return r;for(let r=e+1;r<t.length;r++)if(i(t[r]))return r;return-1}class lne{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:i,partCurrent:r,hls:n}=this,{autoLevelEnabled:s,media:a}=n;if(!i||!a)return;const o=performance.now(),l=r?r.stats:i.stats,c=r?r.duration:i.duration,h=o-l.loading.start,u=n.minAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||i.level<=u){this.clearTimer(),this._nextAutoLevel=-1;return}if(!s||a.paused||!a.playbackRate||!a.readyState)return;const d=n.mainForwardBufferInfo;if(d===null)return;const f=this.bwEstimator.getEstimateTTFB(),p=Math.abs(a.playbackRate);if(h<=Math.max(f,1e3*(c/(p*2))))return;const m=d.len/p,g=l.loading.first?l.loading.first-l.loading.start:-1,v=l.loaded&&g>-1,y=this.getBwEstimate(),x=n.levels,S=x[i.level],A=l.total||Math.max(l.loaded,Math.round(c*S.averageBitrate/8));let _=v?h-g:h;_<1&&v&&(_=Math.min(h,l.loaded*8/y));const M=v?l.loaded*1e3/_:0,E=M?(A-l.loaded)/M:A*8/y+f/1e3;if(E<=m)return;const T=M?M*8:y;let C=Number.POSITIVE_INFINITY,D;for(D=i.level-1;D>u;D--){const O=x[D].maxBitrate;if(C=this.getTimeToLoadFrag(f/1e3,T,c*O,!x[D].details),C<m)break}if(C>=E||C>c*10)return;n.nextLoadLevel=n.nextAutoLevel=D,v?this.bwEstimator.sample(h-Math.min(f,g),l.loaded):this.bwEstimator.sampleTTFB(h);const B=x[D].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>B&&this.resetEstimator(B),this.clearTimer(),Oe.warn(`[abr] Fragment ${i.sn}${r?" part "+r.index:""} of level ${i.level} is loading too slowly;
      Time to underbuffer: ${m.toFixed(3)} s
      Estimated load time for current fragment: ${E.toFixed(3)} s
      Estimated load time for down switch fragment: ${C.toFixed(3)} s
      TTFB estimate: ${g|0} ms
      Current BW estimate: ${Bt(y)?y|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${D} @ ${B|0} bps`),n.trigger(ee.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:r,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(Oe.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new rMe(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ee.FRAG_LOADING,this.onFragLoading,this),e.on(ee.FRAG_LOADED,this.onFragLoaded,this),e.on(ee.FRAG_BUFFERED,this.onFragBuffered,this),e.on(ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(ee.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(ee.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(ee.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ee.FRAG_LOADING,this.onFragLoading,this),e.off(ee.FRAG_LOADED,this.onFragLoaded,this),e.off(ee.FRAG_BUFFERED,this.onFragBuffered,this),e.off(ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(ee.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(ee.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(ee.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,i){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,i){const r=i.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var n;this.fragCurrent=r,this.partCurrent=(n=i.part)!=null?n:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,i){this.clearTimer()}onError(e,i){if(!i.fatal)switch(i.details){case je.BUFFER_ADD_CODEC_ERROR:case je.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case je.FRAG_LOAD_TIMEOUT:{const r=i.frag,{fragCurrent:n,partCurrent:s}=this;if(r&&n&&r.sn===n.sn&&r.level===n.level){const a=performance.now(),o=s?s.stats:r.stats,l=a-o.loading.start,c=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&c>-1){const u=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(u,c),o.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,i,r,n){const s=e+r/i,a=n?this.lastLevelLoadSec:0;return s+a}onLevelLoaded(e,i){const r=this.hls.config,{loading:n}=i.stats,s=n.end-n.start;Bt(s)&&(this.lastLevelLoadSec=s/1e3),i.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}onFragLoaded(e,{frag:i,part:r}){const n=r?r.stats:i.stats;if(i.type===Jt.MAIN&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(i)){if(this.clearTimer(),i.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=r?r.duration:i.duration,a=this.hls.levels[i.level],o=(a.loaded?a.loaded.bytes:0)+n.loaded,l=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(i.bitrateTest){const s={stats:n,frag:i,part:r,id:i.type};this.onFragBuffered(ee.FRAG_BUFFERED,s),i.bitrateTest=!1}else this.lastLoadedFragLevel=i.level}}onFragBuffered(e,i){const{frag:r,part:n}=i,s=n!=null&&n.stats.loaded?n.stats:r.stats;if(s.aborted||this.ignoreFragment(r))return;const a=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,s.loaded),s.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Jt.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:i}=this.hls,r=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,s=this.findBestLevel(r,i,e,0,n,1,1);if(s>-1)return s;const a=this.hls.firstLevel,o=Math.min(Math.max(a,i),e);return Oe.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=r&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,s)&&a[e].loadError<=a[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:i,hls:r}=this,{maxAutoLevel:n,config:s,minAutoLevel:a}=r,o=i?i.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let h=s.abrBandWidthFactor,u=s.abrBandWidthUpFactor;if(c){const g=this.findBestLevel(l,a,n,c,0,h,u);if(g>=0)return g}let d=o?Math.min(o,s.maxStarvationDelay):s.maxStarvationDelay;if(!c){const g=this.bitrateTestDelay;g&&(d=(o?Math.min(o,s.maxLoadingDelay):s.maxLoadingDelay)-g,Oe.info(`[abr] bitrate test took ${Math.round(1e3*g)}ms, set first fragment max fetchDuration to ${Math.round(1e3*d)} ms`),h=u=1)}const f=this.findBestLevel(l,a,n,c,d,h,u);if(Oe.info(`[abr] ${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${f}`),f>-1)return f;const p=r.levels[a],m=r.levels[r.loadLevel];return(p==null?void 0:p.bitrate)<(m==null?void 0:m.bitrate)?a:r.loadLevel}getStarvationDelay(){const e=this.hls,i=e.media;if(!i)return 1/0;const r=i&&i.playbackRate!==0?Math.abs(i.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,i,r,n,s,a,o){var l;const c=n+s,h=this.lastLoadedFragLevel,u=h===-1?this.hls.firstLevel:h,{fragCurrent:d,partCurrent:f}=this,{levels:p,allAudioTracks:m,loadLevel:g,config:v}=this.hls;if(p.length===1)return 0;const y=p[u],x=!!(y!=null&&(l=y.details)!=null&&l.live),S=g===-1||h===-1;let A,_="SDR",M=(y==null?void 0:y.frameRate)||0;const{audioPreference:E,videoPreference:T}=v,C=this.audioTracksByGroup||(this.audioTracksByGroup=hMe(m));if(S){if(this.firstSelection!==-1)return this.firstSelection;const H=this.codecTiers||(this.codecTiers=uMe(p,C,i,r)),q=cMe(H,_,e,E,T),{codecSet:W,videoRanges:I,minFramerate:z,minBitrate:U,preferHDR:X}=q;A=W,_=X?I[I.length-1]:I[0],M=z,e=Math.max(e,U),Oe.log(`[abr] picked start tier ${JSON.stringify(q)}`)}else A=y==null?void 0:y.codecSet,_=y==null?void 0:y.videoRange;const D=f?f.duration:d?d.duration:0,B=this.bwEstimator.getEstimateTTFB()/1e3,O=[];for(let H=r;H>=i;H--){var L;const q=p[H],W=H>u;if(!q)continue;if(v.useMediaCapabilities&&!q.supportedResult&&!q.supportedPromise){const ie=navigator.mediaCapabilities;typeof(ie==null?void 0:ie.decodingInfo)=="function"&&nMe(q,C,_,M,e,E)?(q.supportedPromise=sMe(q,C,ie),q.supportedPromise.then(ce=>{if(!this.hls)return;q.supportedResult=ce;const Z=this.hls.levels,Ae=Z.indexOf(q);ce.error?Oe.warn(`[abr] MediaCapabilities decodingInfo error: "${ce.error}" for level ${Ae} ${JSON.stringify(ce)}`):ce.supported||(Oe.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${Ae} ${JSON.stringify(ce)}`),Ae>-1&&Z.length>1&&(Oe.log(`[abr] Removing unsupported level ${Ae}`),this.hls.removeLevel(Ae)))})):q.supportedResult=one}if(A&&q.codecSet!==A||_&&q.videoRange!==_||W&&M>q.frameRate||!W&&M>0&&M<q.frameRate||q.supportedResult&&!((L=q.supportedResult.decodingInfoResults)!=null&&L[0].smooth)){O.push(H);continue}const I=q.details,z=(f?I==null?void 0:I.partTarget:I==null?void 0:I.averagetargetduration)||D;let U;W?U=o*e:U=a*e;const X=D&&n>=D*2&&s===0?p[H].averageBitrate:p[H].maxBitrate,Q=this.getTimeToLoadFrag(B,U,X*z,I===void 0);if(U>=X&&(H===h||q.loadError===0&&q.fragmentError===0)&&(Q<=B||!Bt(Q)||x&&!this.bitrateTestDelay||Q<c)){const ie=this.forcedAutoLevel;return H!==g&&(ie===-1||ie!==g)&&(O.length&&Oe.trace(`[abr] Skipped level(s) ${O.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${p[O[0]].codecs}" ${p[O[0]].videoRange}; not compatible with "${y.codecs}" ${_}`),Oe.info(`[abr] switch candidate:${u}->${H} adjustedbw(${Math.round(U)})-bitrate=${Math.round(U-X)} ttfb:${B.toFixed(1)} avgDuration:${z.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${Q.toFixed(1)} firstSelection:${S} codecSet:${A} videoRange:${_} hls.loadLevel:${g}`)),S&&(this.firstSelection=H),H}}return-1}set nextAutoLevel(e){const{maxAutoLevel:i,minAutoLevel:r}=this.hls,n=Math.min(Math.max(e,r),i);this._nextAutoLevel!==n&&(this.nextAutoLevelKey="",this._nextAutoLevel=n)}}class pMe{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var bs={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class mMe{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(ee.BUFFER_APPENDED,this.onBufferAppended,this),e.on(ee.FRAG_BUFFERED,this.onFragBuffered,this),e.on(ee.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(ee.BUFFER_APPENDED,this.onBufferAppended,this),e.off(ee.FRAG_BUFFERED,this.onFragBuffered,this),e.off(ee.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,i){const r=this.activePartLists[i];if(r)for(let n=r.length;n--;){const s=r[n];if(!s)break;const a=s.end;if(s.start<=e&&a!==null&&e<=a)return s}return this.getBufferedFrag(e,i)}getBufferedFrag(e,i){const{fragments:r}=this,n=Object.keys(r);for(let s=n.length;s--;){const a=r[n[s]];if((a==null?void 0:a.body.type)===i&&a.buffered){const o=a.body;if(o.start<=e&&e<=o.end)return o}}return null}detectEvictedFragments(e,i,r,n){this.timeRanges&&(this.timeRanges[e]=i);const s=(n==null?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o||s>=o.body.sn)return;if(!o.buffered&&!o.loaded){o.body.type===r&&this.removeFragment(o.body);return}const l=o.range[e];l&&l.time.some(c=>{const h=!this.isTimeBuffered(c.startPTS,c.endPTS,i);return h&&this.removeFragment(o.body),h})})}detectPartialFragments(e){const i=this.timeRanges,{frag:r,part:n}=e;if(!i||r.sn==="initSegment")return;const s=Y0(r),a=this.fragments[s];if(!a||a.buffered&&r.gap)return;const o=!r.relurl;Object.keys(i).forEach(l=>{const c=r.elementaryStreams[l];if(!c)return;const h=i[l],u=o||c.partial===!0;a.range[l]=this.getBufferedTimes(r,n,u,h)}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,(a.body.endList=r.endList||a.body.endList)&&(this.endListFragments[a.body.type]=a),KE(a)||this.removeParts(r.sn-1,r.type)):this.removeFragment(a.body)}removeParts(e,i){const r=this.activePartLists[i];r&&(this.activePartLists[i]=r.filter(n=>n.fragment.sn>=e))}fragBuffered(e,i){const r=Y0(e);let n=this.fragments[r];!n&&i&&(n=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)}getBufferedTimes(e,i,r,n){const s={time:[],partial:r},a=e.start,o=e.end,l=e.minEndPTS||o,c=e.maxStartPTS||a;for(let h=0;h<n.length;h++){const u=n.start(h)-this.bufferPadding,d=n.end(h)+this.bufferPadding;if(c>=u&&l<=d){s.time.push({startPTS:Math.max(a,n.start(h)),endPTS:Math.min(o,n.end(h))});break}else if(a<d&&o>u){const f=Math.max(a,n.start(h)),p=Math.min(o,n.end(h));p>f&&(s.partial=!0,s.time.push({startPTS:f,endPTS:p}))}else if(o<=u)break}return s}getPartialFragment(e){let i=null,r,n,s,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(c=>{const h=l[c];h&&KE(h)&&(n=h.body.start-o,s=h.body.end+o,e>=n&&e<=s&&(r=Math.min(e-n,s-e),a<=r&&(i=h.body,a=r)))}),i}isEndListAppended(e){const i=this.endListFragments[e];return i!==void 0&&(i.buffered||KE(i))}getState(e){const i=Y0(e),r=this.fragments[i];return r?r.buffered?KE(r)?bs.PARTIAL:bs.OK:bs.APPENDING:bs.NOT_LOADED}isTimeBuffered(e,i,r){let n,s;for(let a=0;a<r.length;a++){if(n=r.start(a)-this.bufferPadding,s=r.end(a)+this.bufferPadding,e>=n&&i<=s)return!0;if(i<=n)return!1}return!1}onFragLoaded(e,i){const{frag:r,part:n}=i;if(r.sn==="initSegment"||r.bitrateTest)return;const s=n?null:i,a=Y0(r);this.fragments[a]={body:r,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,i){const{frag:r,part:n,timeRanges:s}=i;if(r.sn==="initSegment")return;const a=r.type;if(n){let o=this.activePartLists[a];o||(this.activePartLists[a]=o=[]),o.push(n)}this.timeRanges=s,Object.keys(s).forEach(o=>{const l=s[o];this.detectEvictedFragments(o,l,a,n)})}onFragBuffered(e,i){this.detectPartialFragments(i)}hasFragment(e){const i=Y0(e);return!!this.fragments[i]}hasParts(e){var i;return!!((i=this.activePartLists[e])!=null&&i.length)}removeFragmentsInRange(e,i,r,n,s){n&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==r||n&&!l.gap||l.start<i&&l.end>e&&(o.buffered||s)&&this.removeFragment(l)})}removeFragment(e){const i=Y0(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const n=e.sn;this.activePartLists[e.type]=r.filter(s=>s.fragment.sn!==n)}delete this.fragments[i],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function KE(t){var e,i,r;return t.buffered&&(t.body.gap||((e=t.range.video)==null?void 0:e.partial)||((i=t.range.audio)==null?void 0:i.partial)||((r=t.range.audiovideo)==null?void 0:r.partial))}function Y0(t){return`${t.type}_${t.level}_${t.sn}`}const gMe={length:0,start:()=>0,end:()=>0};class wr{static isBuffered(e,i){try{if(e){const r=wr.getBuffered(e);for(let n=0;n<r.length;n++)if(i>=r.start(n)&&i<=r.end(n))return!0}}catch{}return!1}static bufferInfo(e,i,r){try{if(e){const n=wr.getBuffered(e),s=[];let a;for(a=0;a<n.length;a++)s.push({start:n.start(a),end:n.end(a)});return this.bufferedInfo(s,i,r)}}catch{}return{len:0,start:i,end:i,nextStart:void 0}}static bufferedInfo(e,i,r){i=Math.max(0,i),e.sort(function(c,h){const u=c.start-h.start;return u||h.end-c.end});let n=[];if(r)for(let c=0;c<e.length;c++){const h=n.length;if(h){const u=n[h-1].end;e[c].start-u<r?e[c].end>u&&(n[h-1].end=e[c].end):n.push(e[c])}else n.push(e[c])}else n=e;let s=0,a,o=i,l=i;for(let c=0;c<n.length;c++){const h=n[c].start,u=n[c].end;if(i+r>=h&&i<u)o=h,l=u,s=l-i;else if(i+r<h){a=h;break}}return{len:s,start:o||0,end:l||0,nextStart:a}}static getBuffered(e){try{return e.buffered}catch(i){return Oe.log("failed to get media.buffered",i),gMe}}}class SD{constructor(e,i,r,n=0,s=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=QE(),this.buffering={audio:QE(),video:QE(),audiovideo:QE()},this.level=e,this.sn=i,this.id=r,this.size=n,this.part=s,this.partial=a}}function QE(){return{start:0,executeStart:0,executeEnd:0,end:0}}function iC(t,e){for(let r=0,n=t.length;r<n;r++){var i;if(((i=t[r])==null?void 0:i.cc)===e)return t[r]}return null}function vMe(t,e,i){return!!(e&&(i.endCC>i.startCC||t&&t.cc<i.startCC))}function yMe(t,e){const i=t.fragments,r=e.fragments;if(!r.length||!i.length){Oe.log("No fragments to align");return}const n=iC(i,r[0].cc);if(!n||n&&!n.startPTS){Oe.log("No frag in previous level to align on");return}return n}function w9(t,e){if(t){const i=t.start+e;t.start=t.startPTS=i,t.endPTS=i+t.duration}}function cne(t,e){const i=e.fragments;for(let r=0,n=i.length;r<n;r++)w9(i[r],t);e.fragmentHint&&w9(e.fragmentHint,t),e.alignedSliding=!0}function xMe(t,e,i){e&&(bMe(t,i,e),!i.alignedSliding&&e&&v2(i,e),!i.alignedSliding&&e&&!i.skippedSegments&&ine(e,i))}function bMe(t,e,i){if(vMe(t,i,e)){const r=yMe(i,e);r&&Bt(r.start)&&(Oe.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),cne(r.start,e))}}function v2(t,e){if(!t.hasProgramDateTime||!e.hasProgramDateTime)return;const i=t.fragments,r=e.fragments;if(!i.length||!r.length)return;let n,s;const a=Math.min(e.endCC,t.endCC);e.startCC<a&&t.startCC<a&&(n=iC(r,a),s=iC(i,a)),(!n||!s)&&(n=r[Math.floor(r.length/2)],s=iC(i,n.cc)||i[Math.floor(i.length/2)]);const o=n.programDateTime,l=s.programDateTime;if(!o||!l)return;const c=(l-o)/1e3-(s.start-n.start);cne(c,t)}const S9=Math.pow(2,17);class wMe{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,i){const r=e.url;if(!r)return Promise.reject(new Cu({type:oi.NETWORK_ERROR,details:je.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const n=this.config,s=n.fLoader,a=n.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(f=>f[0]==="GAP")){l(A9(e));return}else e.gap=!1;const c=this.loader=e.loader=s?new s(n):new a(n),h=_9(e),u=y9(n.fragLoadPolicy.default),d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:S9};e.stats=c.stats,c.load(h,d,{onSuccess:(f,p,m,g)=>{this.resetLoader(e,c);let v=f.data;m.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(v.slice(0,16)),v=v.slice(16)),o({frag:e,part:null,payload:v,networkDetails:g})},onError:(f,p,m,g)=>{this.resetLoader(e,c),l(new Cu({type:oi.NETWORK_ERROR,details:je.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Is({url:r,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:m,stats:g}))},onAbort:(f,p,m)=>{this.resetLoader(e,c),l(new Cu({type:oi.NETWORK_ERROR,details:je.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:m,stats:f}))},onTimeout:(f,p,m)=>{this.resetLoader(e,c),l(new Cu({type:oi.NETWORK_ERROR,details:je.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:m,stats:f}))},onProgress:(f,p,m,g)=>{i&&i({frag:e,part:null,payload:m,networkDetails:g})}})})}loadPart(e,i,r){this.abort();const n=this.config,s=n.fLoader,a=n.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||i.gap){l(A9(e,i));return}const c=this.loader=e.loader=s?new s(n):new a(n),h=_9(e,i),u=y9(n.fragLoadPolicy.default),d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:S9};i.stats=c.stats,c.load(h,d,{onSuccess:(f,p,m,g)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,i);const v={frag:e,part:i,payload:f.data,networkDetails:g};r(v),o(v)},onError:(f,p,m,g)=>{this.resetLoader(e,c),l(new Cu({type:oi.NETWORK_ERROR,details:je.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:i,response:Is({url:h.url,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:m,stats:g}))},onAbort:(f,p,m)=>{e.stats.aborted=i.stats.aborted,this.resetLoader(e,c),l(new Cu({type:oi.NETWORK_ERROR,details:je.INTERNAL_ABORTED,fatal:!1,frag:e,part:i,error:new Error("Aborted"),networkDetails:m,stats:f}))},onTimeout:(f,p,m)=>{this.resetLoader(e,c),l(new Cu({type:oi.NETWORK_ERROR,details:je.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:i,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:m,stats:f}))}})})}updateStatsFromPart(e,i){const r=e.stats,n=i.stats,s=n.total;if(r.loaded+=n.loaded,s){const l=Math.round(e.duration/i.duration),c=Math.min(Math.round(r.loaded/s),l),u=(l-c)*Math.round(r.loaded/c);r.total=r.loaded+u}else r.total=Math.max(r.loaded,r.total);const a=r.loading,o=n.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,i){e.loader=null,this.loader===i&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),i.destroy()}}function _9(t,e=null){const i=e||t,r={frag:t,part:e,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},n=i.byteRangeStartOffset,s=i.byteRangeEndOffset;if(Bt(n)&&Bt(s)){var a;let o=n,l=s;if(t.sn==="initSegment"&&((a=t.decryptdata)==null?void 0:a.method)==="AES-128"){const c=s-n;c%16&&(l=s+(16-c%16)),n!==0&&(r.resetIV=!0,o=n-16)}r.rangeStart=o,r.rangeEnd=l}return r}function A9(t,e){const i=new Error(`GAP ${t.gap?"tag":"attribute"} found`),r={type:oi.MEDIA_ERROR,details:je.FRAG_GAP,fatal:!1,frag:t,error:i,networkDetails:null};return e&&(r.part=e),(e||t).stats.aborted=!0,new Cu(r)}class Cu extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class SMe{constructor(e,i){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=i}decrypt(e,i){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},i,e)}}class _Me{constructor(e,i){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=i}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function AMe(t){const e=t.byteLength,i=e&&new DataView(t.buffer).getUint8(e-1);return i?fg(t,0,e-i):t}class EMe{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const i=new DataView(e),r=new Uint32Array(4);for(let n=0;n<4;n++)r[n]=i.getUint32(n*4);return r}initTable(){const e=this.sBox,i=this.invSBox,r=this.subMix,n=r[0],s=r[1],a=r[2],o=r[3],l=this.invSubMix,c=l[0],h=l[1],u=l[2],d=l[3],f=new Uint32Array(256);let p=0,m=0,g=0;for(g=0;g<256;g++)g<128?f[g]=g<<1:f[g]=g<<1^283;for(g=0;g<256;g++){let v=m^m<<1^m<<2^m<<3^m<<4;v=v>>>8^v&255^99,e[p]=v,i[v]=p;const y=f[p],x=f[y],S=f[x];let A=f[v]*257^v*16843008;n[p]=A<<24|A>>>8,s[p]=A<<16|A>>>16,a[p]=A<<8|A>>>24,o[p]=A,A=S*16843009^x*65537^y*257^p*16843008,c[v]=A<<24|A>>>8,h[v]=A<<16|A>>>16,u[v]=A<<8|A>>>24,d[v]=A,p?(p=y^f[f[f[S^y]]],m^=f[f[m]]):p=m=1}}expandKey(e){const i=this.uint8ArrayToUint32Array_(e);let r=!0,n=0;for(;n<i.length&&r;)r=i[n]===this.key[n],n++;if(r)return;this.key=i;const s=this.keySize=i.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const a=this.ksRows=(s+6+1)*4;let o,l;const c=this.keySchedule=new Uint32Array(a),h=this.invKeySchedule=new Uint32Array(a),u=this.sBox,d=this.rcon,f=this.invSubMix,p=f[0],m=f[1],g=f[2],v=f[3];let y,x;for(o=0;o<a;o++){if(o<s){y=c[o]=i[o];continue}x=y,o%s===0?(x=x<<8|x>>>24,x=u[x>>>24]<<24|u[x>>>16&255]<<16|u[x>>>8&255]<<8|u[x&255],x^=d[o/s|0]<<24):s>6&&o%s===4&&(x=u[x>>>24]<<24|u[x>>>16&255]<<16|u[x>>>8&255]<<8|u[x&255]),c[o]=y=(c[o-s]^x)>>>0}for(l=0;l<a;l++)o=a-l,l&3?x=c[o]:x=c[o-4],l<4||o<=4?h[l]=x:h[l]=p[u[x>>>24]]^m[u[x>>>16&255]]^g[u[x>>>8&255]]^v[u[x&255]],h[l]=h[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,i,r){const n=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],c=o[1],h=o[2],u=o[3],d=this.uint8ArrayToUint32Array_(r);let f=d[0],p=d[1],m=d[2],g=d[3];const v=new Int32Array(e),y=new Int32Array(v.length);let x,S,A,_,M,E,T,C,D,B,O,L,H,q;const W=this.networkToHostOrderSwap;for(;i<v.length;){for(D=W(v[i]),B=W(v[i+1]),O=W(v[i+2]),L=W(v[i+3]),M=D^s[0],E=L^s[1],T=O^s[2],C=B^s[3],H=4,q=1;q<n;q++)x=l[M>>>24]^c[E>>16&255]^h[T>>8&255]^u[C&255]^s[H],S=l[E>>>24]^c[T>>16&255]^h[C>>8&255]^u[M&255]^s[H+1],A=l[T>>>24]^c[C>>16&255]^h[M>>8&255]^u[E&255]^s[H+2],_=l[C>>>24]^c[M>>16&255]^h[E>>8&255]^u[T&255]^s[H+3],M=x,E=S,T=A,C=_,H=H+4;x=a[M>>>24]<<24^a[E>>16&255]<<16^a[T>>8&255]<<8^a[C&255]^s[H],S=a[E>>>24]<<24^a[T>>16&255]<<16^a[C>>8&255]<<8^a[M&255]^s[H+1],A=a[T>>>24]<<24^a[C>>16&255]<<16^a[M>>8&255]<<8^a[E&255]^s[H+2],_=a[C>>>24]<<24^a[M>>16&255]<<16^a[E>>8&255]<<8^a[T&255]^s[H+3],y[i]=W(x^f),y[i+1]=W(_^p),y[i+2]=W(A^m),y[i+3]=W(S^g),f=D,p=B,m=O,g=L,i=i+4}return y.buffer}}const MMe=16;class d5{constructor(e,{removePKCS7Padding:i=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=i,i)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:i}=this;if(!e||i)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?AMe(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,i,r){return this.useSoftware?new Promise((n,s)=>{this.softwareDecrypt(new Uint8Array(e),i,r);const a=this.flush();a?n(a.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),i,r)}softwareDecrypt(e,i,r){const{currentIV:n,currentResult:s,remainderData:a}=this;this.logOnce("JS AES decrypt"),a&&(e=jl(a,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;n&&(r=n);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new EMe),l.expandKey(i);const c=s;return this.currentResult=l.decrypt(o.buffer,0,r),this.currentIV=fg(o,-16).buffer,c||null}webCryptoDecrypt(e,i,r){if(this.key!==i||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,i,r));this.key=i,this.fastAesKey=new _Me(this.subtle,i)}return this.fastAesKey.expandKey().then(n=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new SMe(this.subtle,new Uint8Array(r)).decrypt(e.buffer,n)):Promise.reject(new Error("web crypto not initialized"))).catch(n=>(Oe.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${n.name}: ${n.message}`),this.onWebCryptoError(e,i,r)))}onWebCryptoError(e,i,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,i,r);const n=this.flush();if(n)return n.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let i=e;const r=e.length-e.length%MMe;return r!==e.length&&(i=fg(e,0,r),this.remainderData=fg(e,r)),i}logOnce(e){this.logEnabled&&(Oe.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const TMe={toString:function(t){let e="";const i=t.length;for(let r=0;r<i;r++)e+=`[${t.start(r).toFixed(3)}-${t.end(r).toFixed(3)}]`;return e}},ct={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class _D extends pMe{constructor(e,i,r,n,s){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ct.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=s,this.logPrefix=n,this.log=Oe.log.bind(Oe,`${n}:`),this.warn=Oe.warn.bind(Oe,`${n}:`),this.hls=e,this.fragmentLoader=new wMe(e.config),this.keyLoader=r,this.fragmentTracker=i,this.config=e.config,this.decrypter=new d5(e.config),e.on(ee.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ct.STOPPED}_streamEnded(e,i){if(i.live||e.nextStart||!e.end||!this.media)return!1;const r=i.partList;if(r!=null&&r.length){const s=r[r.length-1];return wr.isBuffered(this.media,s.start+s.duration/2)}const n=i.fragments[i.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(n)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}onMediaAttached(e,i){const r=this.media=this.mediaBuffer=i.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);const n=this.config;this.levels&&n.autoStartLoad&&this.state===ct.STOPPED&&this.startLoad(n.startPosition)}onMediaDetaching(){const e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:i,media:r,mediaBuffer:n,state:s}=this,a=r?r.currentTime:0,o=wr.bufferInfo(n||r,a,e.maxBufferHole);if(this.log(`media seeking to ${Bt(a)?a.toFixed(3):a}, state: ${s}`),this.state===ct.ENDED)this.resetLoadingState();else if(i){const l=e.maxFragLookUpTolerance,c=i.start-l,h=i.start+i.duration+l;if(!o.len||h<o.start||c>o.end){const u=a>h;(a<c||u)&&(u&&i.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),i.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),this.lastCurrentTime=a),!this.loadedmetadata&&!o.len&&(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,i){this.startTimeOffset=i.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(ee.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=ct.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,i,r){this._loadFragForPlayback(e,i,r)}_loadFragForPlayback(e,i,r){const n=s=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${s.part?" p: "+s.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,i,r,n).then(s=>{if(!s)return;const a=this.state;if(this.fragContextChanged(e)){(a===ct.FRAG_LOADING||!this.fragCurrent&&a===ct.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=ct.IDLE);return}"payload"in s&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(ee.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===ct.STOPPED||this.state===ct.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var i;const{fragmentTracker:r}=this;if(r.getState(e)===bs.APPENDING){const s=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,s),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&r.removeFragment(e)}else((i=this.mediaBuffer)==null?void 0:i.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===bs.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const i=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:i,part:null,stats:i.stats,id:i.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,i,r=null){if(!(e-i))return;const n={startOffset:e,endOffset:i,type:r};this.hls.trigger(ee.BUFFER_FLUSHING,n)}_loadInitSegment(e,i){this._doFragLoad(e,i).then(r=>{if(!r||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:n}=this,{payload:s}=r,a=e.decryptdata;if(s&&s.byteLength>0&&a!=null&&a.key&&a.iv&&a.method==="AES-128"){const o=self.performance.now();return this.decrypter.decrypt(new Uint8Array(s),a.key.buffer,a.iv.buffer).catch(l=>{throw n.trigger(ee.ERROR,{type:oi.MEDIA_ERROR,details:je.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:e}),l}).then(l=>{const c=self.performance.now();return n.trigger(ee.FRAG_DECRYPTED,{frag:e,payload:l,stats:{tstart:o,tdecrypt:c}}),r.payload=l,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===ct.STOPPED||this.state===ct.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:i}=this;if(!i)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state=ct.IDLE,e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:i}=this;return!e||!i||e.sn!==i.sn||e.level!==i.level}fragBufferedComplete(e,i){var r,n,s,a;const o=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${i?" part: "+i.index:""} of ${this.playlistType===Jt.MAIN?"level":"track"} ${e.level} (frag:[${((r=e.startPTS)!=null?r:NaN).toFixed(3)}-${((n=e.endPTS)!=null?n:NaN).toFixed(3)}] > buffer:${o?TMe.toString(wr.getBuffered(o)):"(detached)"})`),e.sn!=="initSegment"){var l;if(e.type!==Jt.SUBTITLE){const h=e.elementaryStreams;if(!Object.keys(h).some(u=>!!h[u])){this.state=ct.IDLE;return}}const c=(l=this.levels)==null?void 0:l[e.level];c!=null&&c.fragmentError&&(this.log(`Resetting level fragment error count of ${c.fragmentError} on frag buffered`),c.fragmentError=0)}this.state=ct.IDLE,o&&(!this.loadedmetadata&&e.type==Jt.MAIN&&o.buffered.length&&((s=this.fragCurrent)==null?void 0:s.sn)===((a=this.fragPrevious)==null?void 0:a.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:i}=this;if(!i)return;const{frag:r,part:n,partsLoaded:s}=e,a=!s||s.length===0||s.some(l=>!l),o=new SD(r.level,r.sn,r.stats.chunkCount+1,0,n?n.index:-1,!a);i.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,i,r=null,n){var s;const a=i==null?void 0:i.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level}`),this.state=ct.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(h=>{if(!this.fragContextChanged(h.frag))return this.hls.trigger(ee.KEY_LOADED,h),this.state===ct.KEY_LOADING&&(this.state=ct.IDLE),h}),this.hls.trigger(ee.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(e,a.encryptedFragments),r=Math.max(e.start,r||0),this.config.lowLatencyMode&&e.sn!=="initSegment"){const h=a.partList;if(h&&n){r>e.end&&a.fragmentHint&&(e=a.fragmentHint);const u=this.getNextPart(h,e,r);if(u>-1){const d=h[u];this.log(`Loading part sn: ${e.sn} p: ${d.index} cc: ${e.cc} of playlist [${a.startSN}-${a.endSN}] parts [0-${u}-${h.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=d.start+d.duration,this.state=ct.FRAG_LOADING;let f;return o?f=o.then(p=>!p||this.fragContextChanged(p.frag)?null:this.doFragPartsLoad(e,d,i,n)).catch(p=>this.handleFragLoadError(p)):f=this.doFragPartsLoad(e,d,i,n).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(ee.FRAG_LOADING,{frag:e,part:d,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):f}else if(!e.url||this.loadedEndOfParts(h,r))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${a?"of ["+a.startSN+"-"+a.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),Bt(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ct.FRAG_LOADING;const l=this.config.progressive;let c;return l&&o?c=o.then(h=>!h||this.fragContextChanged(h==null?void 0:h.frag)?null:this.fragmentLoader.load(e,n)).catch(h=>this.handleFragLoadError(h)):c=Promise.all([this.fragmentLoader.load(e,l?n:void 0),o]).then(([h])=>(!l&&h&&n&&n(h),h)).catch(h=>this.handleFragLoadError(h)),this.hls.trigger(ee.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,i,r,n){return new Promise((s,a)=>{var o;const l=[],c=(o=r.details)==null?void 0:o.partList,h=u=>{this.fragmentLoader.loadPart(e,u,n).then(d=>{l[u.index]=d;const f=d.part;this.hls.trigger(ee.FRAG_LOADED,d);const p=g9(r,e.sn,u.index+1)||rne(c,e.sn,u.index+1);if(p)h(p);else return s({frag:e,part:f,partsLoaded:l})}).catch(a)};h(i)})}handleFragLoadError(e){if("data"in e){const i=e.data;e.data&&i.details===je.INTERNAL_ABORTED?this.handleFragLoadAborted(i.frag,i.part):this.hls.trigger(ee.ERROR,i)}else this.hls.trigger(ee.ERROR,{type:oi.OTHER_ERROR,details:je.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const i=this.getCurrentContext(e);if(!i||this.state!==ct.PARSING){!this.fragCurrent&&this.state!==ct.STOPPED&&this.state!==ct.ERROR&&(this.state=ct.IDLE);return}const{frag:r,part:n,level:s}=i,a=self.performance.now();r.stats.parsing.end=a,n&&(n.stats.parsing.end=a),this.updateLevelTiming(r,n,s,e.partial)}getCurrentContext(e){const{levels:i,fragCurrent:r}=this,{level:n,sn:s,part:a}=e;if(!(i!=null&&i[n]))return this.warn(`Levels object was unset while buffering fragment ${s} of level ${n}. The current chunk will not be buffered.`),null;const o=i[n],l=a>-1?g9(o,s,a):null,c=l?l.fragment:$Ee(o,s,r);return c?(r&&r!==c&&(c.stats=r.stats),{frag:c,part:l,level:o}):null}bufferFragmentData(e,i,r,n,s){var a;if(!e||this.state!==ct.PARSING)return;const{data1:o,data2:l}=e;let c=o;if(o&&l&&(c=jl(o,l)),!((a=c)!=null&&a.length))return;const h={type:e.type,frag:i,part:r,chunkMeta:n,parent:i.type,data:c};if(this.hls.trigger(ee.BUFFER_APPENDING,h),e.dropped&&e.independent&&!r){if(s)return;this.flushBufferGap(i)}}flushBufferGap(e){const i=this.media;if(!i)return;if(!wr.isBuffered(i,i.currentTime)){this.flushMainBuffer(0,e.start);return}const r=i.currentTime,n=wr.bufferInfo(i,r,0),s=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),o=Math.max(Math.min(e.start-a,n.end-a),r+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,i){const r=this.getLoadPosition();return Bt(r)?this.getFwdBufferInfoAtPos(e,r,i):null}getFwdBufferInfoAtPos(e,i,r){const{config:{maxBufferHole:n}}=this,s=wr.bufferInfo(e,i,n);if(s.len===0&&s.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(i,r);if(a&&s.nextStart<a.end)return wr.bufferInfo(e,i,Math.max(s.nextStart,n))}return s}getMaxBufferLength(e){const{config:i}=this;let r;return e?r=Math.max(8*i.maxBufferSize/e,i.maxBufferLength):r=i.maxBufferLength,Math.min(r,i.maxMaxBufferLength)}reduceMaxBufferLength(e,i){const r=this.config,n=Math.max(Math.min(e-i,r.maxBufferLength),i),s=Math.max(e-i*3,r.maxMaxBufferLength/2,n);return s>=n?(r.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,i=Jt.MAIN){const r=this.fragmentTracker.getAppendedFrag(e,Jt.MAIN);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,i){const r=i.fragments,n=r.length;if(!n)return null;const{config:s}=this,a=r[0].start;let o;if(i.live){const l=s.initialLiveManifestSize;if(n<l)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${l})`),null;(!i.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a)&&(o=this.getInitialLiveFragment(i,r),this.startPosition=this.nextLoadPosition=o?this.hls.liveSyncPosition||o.start:e)}else e<=a&&(o=r[0]);if(!o){const l=s.lowLatencyMode?i.partEnd:i.fragmentEnd;o=this.getFragmentAtPosition(e,l,i)}return this.mapToInitFragWhenRequired(o)}isLoopLoading(e,i){const r=this.fragmentTracker.getState(e);return(r===bs.OK||r===bs.PARTIAL&&!!e.gap)&&this.nextLoadPosition>i}getNextFragmentLoopLoading(e,i,r,n,s){const a=e.gap,o=this.getNextFragment(this.nextLoadPosition,i);if(o===null)return o;if(e=o,a&&e&&!e.gap&&r.nextStart){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,n);if(l!==null&&r.len+l.len>=s)return this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,i,r){let n=-1,s=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const c=e[o];if(a=a&&!c.independent,n>-1&&r<c.start)break;const h=c.loaded;h?n=-1:(s||c.independent||a)&&c.fragment===i&&(n=o),s=h}return n}loadedEndOfParts(e,i){const r=e[e.length-1];return r&&i>r.start&&r.loaded}getInitialLiveFragment(e,i){const r=this.fragPrevious;let n=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),n=ZEe(i,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const s=r.sn+1;if(s>=e.startSN&&s<=e.endSN){const a=i[s-e.startSN];r.cc===a.cc&&(n=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=iMe(i,r.cc),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(n=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,i,r){const{config:n}=this;let{fragPrevious:s}=this,{fragments:a,endSN:o}=r;const{fragmentHint:l}=r,{maxFragLookUpTolerance:c}=n,h=r.partList,u=!!(n.lowLatencyMode&&h!=null&&h.length&&l);u&&l&&!this.bitrateTest&&(a=a.concat(l),o=l.sn);let d;if(e<i){const f=e>i-c?0:c;d=g2(s,a,e,f)}else d=a[a.length-1];if(d){const f=d.sn-r.startSN,p=this.fragmentTracker.getState(d);if((p===bs.OK||p===bs.PARTIAL&&d.gap)&&(s=d),s&&d.sn===s.sn&&(!u||h[0].fragment.sn>d.sn)&&s&&d.level===s.level){const g=a[f+1];d.sn<o&&this.fragmentTracker.getState(g)!==bs.OK?d=g:d=null}}return d}synchronizeToLiveEdge(e){const{config:i,media:r}=this;if(!r)return;const n=this.hls.liveSyncPosition,s=r.currentTime,a=e.fragments[0].start,o=e.edge,l=s>=a-i.maxFragLookUpTolerance&&s<=o;if(n!==null&&r.duration>n&&(s<n||!l)){const c=i.liveMaxLatencyDuration!==void 0?i.liveMaxLatencyDuration:i.liveMaxLatencyDurationCount*e.targetduration;(!l&&r.readyState<4||s<o-c)&&(this.loadedmetadata||(this.nextLoadPosition=n),r.readyState&&(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${n.toFixed(3)}`),r.currentTime=n))}}alignPlaylists(e,i,r){const n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const s=e.fragments[0].start,a=!i,o=e.alignedSliding&&Bt(s);if(a||!o&&!s){const{fragPrevious:l}=this;xMe(l,r,e);const c=e.fragments[0].start;return this.log(`Live playlist sliding: ${c.toFixed(2)} start-sn: ${i?i.startSN:"na"}->${e.startSN} prev-sn: ${l?l.sn:"na"} fragments: ${n}`),c}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,i){let r=this.startPosition;if(r<i&&(r=-1),r===-1||this.lastCurrentTime===-1){const n=this.startTimeOffset!==null,s=n?this.startTimeOffset:e.startTimeOffset;s!==null&&Bt(s)?(r=i+s,s<0&&(r+=e.totalduration),r=Math.min(Math.max(i,r),i+e.totalduration),this.log(`Start time offset ${s} found in ${n?"multivariant":"media"} playlist, adjust startPosition to ${r}`),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||i:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}getLoadPosition(){const{media:e}=this;let i=0;return this.loadedmetadata&&e?i=e.currentTime:this.nextLoadPosition&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,i){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${i?" part "+i.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ct.FRAG_LOADING_WAITING_RETRY)&&(this.state=ct.IDLE)}onFragmentOrKeyLoadError(e,i){if(i.chunkMeta&&!i.frag){const h=this.getCurrentContext(i.chunkMeta);h&&(i.frag=h.frag)}const r=i.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var n;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(n=this.fragCurrent)==null?void 0:n.url}`);return}const s=i.details===je.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(r,!0);const a=i.errorAction,{action:o,retryCount:l=0,retryConfig:c}=a||{};if(a&&o===Qn.RetryRequest&&c){this.resetStartWhenNotLoaded(this.levelLastLoaded);const h=u5(c,l);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${i.details}, retrying loading ${l+1}/${c.maxNumRetry} in ${h}ms`),a.resolved=!0,this.retryDate=self.performance.now()+h,this.state=ct.FRAG_LOADING_WAITING_RETRY}else if(c&&a)if(this.resetFragmentErrors(e),l<c.maxNumRetry)!s&&o!==Qn.RemoveAlternatePermanently&&(a.resolved=!0);else{Oe.warn(`${i.details} reached or exceeded max retry (${l})`);return}else(a==null?void 0:a.action)===Qn.SendAlternateToPenaltyBox?this.state=ct.WAITING_LEVEL:this.state=ct.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===ct.PARSING||this.state===ct.PARSED){const i=e.frag,r=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,r),s=n&&n.len>.5;s&&this.reduceMaxBufferLength(n.len,(i==null?void 0:i.duration)||10);const a=!s;return a&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${r} buffer`),i&&(this.fragmentTracker.removeFragment(i),this.nextLoadPosition=i.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===Jt.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==ct.STOPPED&&(this.state=ct.IDLE)}afterBufferFlushed(e,i,r){if(!e)return;const n=wr.getBuffered(e);this.fragmentTracker.detectEvictedFragments(i,n,r),this.state===ct.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=ct.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const i=e?e.details:null;i!=null&&i.live?(this.startPosition=-1,this.setStartPosition(i,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,i,r,n){var s;const a=r.details;if(!a){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const h=e.elementaryStreams[c];if(h){const u=h.endPTS-h.startPTS;if(u<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${u})`),l||!1;const d=n?0:tne(a,e,h.startPTS,h.endPTS,h.startDTS,h.endDTS);return this.hls.trigger(ee.LEVEL_PTS_UPDATED,{details:a,level:r,drift:d,type:c,frag:e,start:h.startPTS,end:h.endPTS}),!0}return l},!1)&&((s=this.transmuxer)==null?void 0:s.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(r.fragmentError===0&&(r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(l.message),this.hls.trigger(ee.ERROR,{type:oi.MEDIA_ERROR,details:je.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of level "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=ct.PARSED,this.hls.trigger(ee.FRAG_PARSED,{frag:e,part:i})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const i=this._state;i!==e&&(this._state=e,this.log(`${i}->${e}`))}get state(){return this._state}}class hne{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:i}=this;let r;if(e.length)e.length===1?r=e[0]:r=CMe(e,i);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function CMe(t,e){const i=new Uint8Array(e);let r=0;for(let n=0;n<t.length;n++){const s=t[n];i.set(s,r),r+=s.length}return i}function PMe(){return typeof __HLS_WORKER_BUNDLE__=="function"}function DMe(){const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(t);return{worker:new self.Worker(e),objectURL:e}}function RMe(t){const e=new self.URL(t,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}function gh(t="",e=9e4){return{type:t,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class f5{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,i,r,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,i){return!1}appendFrame(e,i,r){}demux(e,i){this.cachedData&&(e=jl(this.cachedData,e),this.cachedData=null);let r=cS(e,0),n=r?r.length:0,s;const a=this._audioTrack,o=this._id3Track,l=r?h5(r):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&Bt(l))&&(this.basePTS=IMe(l,i,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Pl.audioId3,duration:Number.POSITIVE_INFINITY});n<c;){if(this.canParse(e,n)){const h=this.appendFrame(a,e,n);h?(this.frameIndex++,this.lastPTS=h.sample.pts,n+=h.length,s=n):n=c}else tEe(e,n)?(r=cS(e,n),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Pl.audioId3,duration:Number.POSITIVE_INFINITY}),n+=r.length,s=n):n++;if(n===c&&s!==c){const h=fg(e,s);this.cachedData?this.cachedData=jl(this.cachedData,h):this.cachedData=h}}return{audioTrack:a,videoTrack:gh(),id3Track:o,textTrack:gh()}}demuxSampleAes(e,i,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const i=this.cachedData;return i&&(this.cachedData=null,this.demux(i,0)),{audioTrack:this._audioTrack,videoTrack:gh(),id3Track:this._id3Track,textTrack:gh()}}destroy(){}}const IMe=(t,e,i)=>{if(Bt(t))return t*90;const r=i?i.baseTime*9e4/i.timescale:0;return e*9e4+r};function LMe(t,e,i,r){let n,s,a,o;const l=navigator.userAgent.toLowerCase(),c=r,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n=((e[i+2]&192)>>>6)+1;const u=(e[i+2]&60)>>>2;if(u>h.length-1){const d=new Error(`invalid ADTS sampling index:${u}`);t.emit(ee.ERROR,ee.ERROR,{type:oi.MEDIA_ERROR,details:je.FRAG_PARSING_ERROR,fatal:!0,error:d,reason:d.message});return}return a=(e[i+2]&1)<<2,a|=(e[i+3]&192)>>>6,Oe.log(`manifest codec:${r}, ADTS type:${n}, samplingIndex:${u}`),/firefox/i.test(l)?u>=6?(n=5,o=new Array(4),s=u-3):(n=2,o=new Array(2),s=u):l.indexOf("android")!==-1?(n=2,o=new Array(2),s=u):(n=5,o=new Array(4),r&&(r.indexOf("mp4a.40.29")!==-1||r.indexOf("mp4a.40.5")!==-1)||!r&&u>=6?s=u-3:((r&&r.indexOf("mp4a.40.2")!==-1&&(u>=6&&a===1||/vivaldi/i.test(l))||!r&&a===1)&&(n=2,o=new Array(2)),s=u)),o[0]=n<<3,o[0]|=(u&14)>>1,o[1]|=(u&1)<<7,o[1]|=a<<3,n===5&&(o[1]|=(s&14)>>1,o[2]=(s&1)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:h[u],channelCount:a,codec:"mp4a.40."+n,manifestCodec:c}}function une(t,e){return t[e]===255&&(t[e+1]&246)===240}function dne(t,e){return t[e+1]&1?7:9}function p5(t,e){return(t[e+3]&3)<<11|t[e+4]<<3|(t[e+5]&224)>>>5}function OMe(t,e){return e+5<t.length}function y2(t,e){return e+1<t.length&&une(t,e)}function BMe(t,e){return OMe(t,e)&&une(t,e)&&p5(t,e)<=t.length-e}function FMe(t,e){if(y2(t,e)){const i=dne(t,e);if(e+i>=t.length)return!1;const r=p5(t,e);if(r<=i)return!1;const n=e+r;return n===t.length||y2(t,n)}return!1}function fne(t,e,i,r,n){if(!t.samplerate){const s=LMe(e,i,r,n);if(!s)return;t.config=s.config,t.samplerate=s.samplerate,t.channelCount=s.channelCount,t.codec=s.codec,t.manifestCodec=s.manifestCodec,Oe.log(`parsed codec:${t.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function pne(t){return 1024*9e4/t}function kMe(t,e){const i=dne(t,e);if(e+i<=t.length){const r=p5(t,e)-i;if(r>0)return{headerLength:i,frameLength:r}}}function mne(t,e,i,r,n){const s=pne(t.samplerate),a=r+n*s,o=kMe(e,i);let l;if(o){const{frameLength:u,headerLength:d}=o,f=d+u,p=Math.max(0,i+f-e.length);p?(l=new Uint8Array(f-d),l.set(e.subarray(i+d,e.length),0)):l=e.subarray(i+d,i+f);const m={unit:l,pts:a};return p||t.samples.push(m),{sample:m,length:f,missing:p}}const c=e.length-i;return l=new Uint8Array(c),l.set(e.subarray(i,e.length),0),{sample:{unit:l,pts:a},length:c,missing:-1}}let $E=null;const NMe=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],UMe=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],zMe=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],GMe=[0,1,1,4];function gne(t,e,i,r,n){if(i+24>e.length)return;const s=vne(e,i);if(s&&i+s.frameLength<=e.length){const a=s.samplesPerFrame*9e4/s.sampleRate,o=r+n*a,l={unit:e.subarray(i,i+s.frameLength),pts:o,dts:o};return t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function vne(t,e){const i=t[e+1]>>3&3,r=t[e+1]>>1&3,n=t[e+2]>>4&15,s=t[e+2]>>2&3;if(i!==1&&n!==0&&n!==15&&s!==3){const a=t[e+2]>>1&1,o=t[e+3]>>6,l=i===3?3-r:r===3?3:4,c=NMe[l*14+n-1]*1e3,u=UMe[(i===3?0:i===2?1:2)*3+s],d=o===3?1:2,f=zMe[i][r],p=GMe[r],m=f*8*p,g=Math.floor(f*c/u+a)*p;if($E===null){const x=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);$E=x?parseInt(x[1]):0}return!!$E&&$E<=87&&r===2&&c>=224e3&&o===0&&(t[e+3]=t[e+3]|128),{sampleRate:u,channelCount:d,frameLength:g,samplesPerFrame:m}}}function m5(t,e){return t[e]===255&&(t[e+1]&224)===224&&(t[e+1]&6)!==0}function yne(t,e){return e+1<t.length&&m5(t,e)}function VMe(t,e){return m5(t,e)&&4<=t.length-e}function xne(t,e){if(e+1<t.length&&m5(t,e)){const r=vne(t,e);let n=4;r!=null&&r.frameLength&&(n=r.frameLength);const s=e+n;return s===t.length||yne(t,s)}return!1}class HMe extends f5{constructor(e,i){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=i}resetInitSegment(e,i,r,n){super.resetInitSegment(e,i,r,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:i,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const i=cS(e,0);let r=(i==null?void 0:i.length)||0;if(xne(e,r))return!1;for(let n=e.length;r<n;r++)if(FMe(e,r))return Oe.log("ADTS sync word found !"),!0;return!1}canParse(e,i){return BMe(e,i)}appendFrame(e,i,r){fne(e,this.observer,i,r,e.manifestCodec);const n=mne(e,i,r,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n}}const jMe=/\/emsg[-/]ID3/i;class WMe{constructor(e,i){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=i}resetTimeStamp(){}resetInitSegment(e,i,r,n){const s=this.videoTrack=gh("video",1),a=this.audioTrack=gh("audio",1),o=this.txtTrack=gh("text",1);if(this.id3Track=gh("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=Yre(e);if(l.video){const{id:c,timescale:h,codec:u}=l.video;s.id=c,s.timescale=o.timescale=h,s.codec=u}if(l.audio){const{id:c,timescale:h,codec:u}=l.audio;a.id=c,a.timescale=h,a.codec=u}o.id=jre.text,s.sampleDuration=0,s.duration=a.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return hEe(e)}demux(e,i){this.timeOffset=i;let r=e;const n=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=jl(this.remainderData,e));const o=yEe(r);this.remainderData=o.remainder,n.samples=o.valid||new Uint8Array}else n.samples=r;const a=this.extractID3Track(n,i);return s.samples=JW(i,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,i=this.videoTrack,r=this.txtTrack;i.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(i,this.timeOffset);return r.samples=JW(e,i),{videoTrack:i,audioTrack:gh(),id3Track:n,textTrack:gh()}}extractID3Track(e,i){const r=this.id3Track;if(e.samples.length){const n=yi(e.samples,["emsg"]);n&&n.forEach(s=>{const a=wEe(s);if(jMe.test(a.schemeIdUri)){const o=Bt(a.presentationTime)?a.presentationTime/a.timeScale:i+a.presentationTimeDelta/a.timeScale;let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=a.payload;r.samples.push({data:c,len:c.byteLength,dts:o,pts:o,type:Pl.emsg,duration:l})}})}return r}demuxSampleAes(e,i,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const bne=(t,e)=>{let i=0,r=5;e+=r;const n=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;r>0;){a[0]=t[e];const o=Math.min(r,8),l=8-o;s[0]=4278190080>>>24+l<<l,n[0]=(a[0]&s[0])>>l,i=i?i<<o|n[0]:n[0],e+=1,r-=o}return i};class XMe extends f5{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,i,r,n){super.resetInitSegment(e,i,r,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:i,duration:n,inputTimeScale:9e4,dropped:0}}canParse(e,i){return i+64<e.length}appendFrame(e,i,r){const n=wne(e,i,r,this.basePTS,this.frameIndex);if(n!==-1)return{sample:e.samples[e.samples.length-1],length:n,missing:0}}static probe(e){if(!e)return!1;const i=cS(e,0);if(!i)return!1;const r=i.length;return e[r]===11&&e[r+1]===119&&h5(i)!==void 0&&bne(e,r)<16}}function wne(t,e,i,r,n){if(i+8>e.length||e[i]!==11||e[i+1]!==119)return-1;const s=e[i+4]>>6;if(s>=3)return-1;const o=[48e3,44100,32e3][s],l=e[i+4]&63,h=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+s]*2;if(i+h>e.length)return-1;const u=e[i+6]>>5;let d=0;u===2?d+=2:(u&1&&u!==1&&(d+=2),u&4&&(d+=2));const f=(e[i+6]<<8|e[i+7])>>12-d&1,m=[2,1,2,3,3,4,4,5][u]+f,g=e[i+5]>>3,v=e[i+5]&7,y=new Uint8Array([s<<6|g<<1|v>>2,(v&3)<<6|u<<3|f<<2|l>>4,l<<4&224]),x=1536/o*9e4,S=r+n*x,A=e.subarray(i,i+h);return t.config=y,t.channelCount=m,t.samplerate=o,t.samples.push({unit:A,pts:S}),h}class YMe{constructor(){this.VideoSample=null}createVideoSample(e,i,r,n){return{key:e,frame:!1,pts:i,dts:r,units:[],debug:n,length:0}}getLastNalUnit(e){var i;let r=this.VideoSample,n;if((!r||r.units.length===0)&&(r=e[e.length-1]),(i=r)!=null&&i.units){const s=r.units;n=s[s.length-1]}return n}pushAccessUnit(e,i){if(e.units.length&&e.frame){if(e.pts===void 0){const r=i.samples,n=r.length;if(n){const s=r[n-1];e.pts=s.pts,e.dts=s.dts}else{i.dropped++;return}}i.samples.push(e)}e.debug.length&&Oe.log(e.pts+"/"+e.dts+":"+e.debug)}}class E9{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,i=this.bytesAvailable,r=e.byteLength-i,n=new Uint8Array(4),s=Math.min(4,i);if(s===0)throw new Error("no bytes available");n.set(e.subarray(r,r+s)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let i;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,i=e>>3,e-=i<<3,this.bytesAvailable-=i,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let i=Math.min(this.bitsAvailable,e);const r=this.word>>>32-i;if(e>32&&Oe.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=i,this.bitsAvailable>0)this.word<<=i;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return i=e-i,i>0&&this.bitsAvailable?r<<i|this.readBits(i):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let i=8,r=8,n;for(let s=0;s<e;s++)r!==0&&(n=this.readEG(),r=(i+n+256)%256),i=r===0?i:r}readSPS(){let e=0,i=0,r=0,n=0,s,a,o;const l=this.readUByte.bind(this),c=this.readBits.bind(this),h=this.readUEG.bind(this),u=this.readBoolean.bind(this),d=this.skipBits.bind(this),f=this.skipEG.bind(this),p=this.skipUEG.bind(this),m=this.skipScalingList.bind(this);l();const g=l();if(c(5),d(3),l(),p(),g===100||g===110||g===122||g===244||g===44||g===83||g===86||g===118||g===128){const _=h();if(_===3&&d(1),p(),p(),d(1),u())for(a=_!==3?8:12,o=0;o<a;o++)u()&&(o<6?m(16):m(64))}p();const v=h();if(v===0)h();else if(v===1)for(d(1),f(),f(),s=h(),o=0;o<s;o++)f();p(),d(1);const y=h(),x=h(),S=c(1);S===0&&d(1),d(1),u()&&(e=h(),i=h(),r=h(),n=h());let A=[1,1];if(u()&&u())switch(l()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[l()<<8|l(),l()<<8|l()];break}}return{width:Math.ceil((y+1)*16-e*2-i*2),height:(2-S)*(x+1)*16-(S?2:4)*(r+n),pixelRatio:A}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class qMe extends YMe{parseAVCPES(e,i,r,n,s){const a=this.parseAVCNALu(e,r.data);let o=this.VideoSample,l,c=!1;r.data=null,o&&a.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"")),a.forEach(h=>{var u;switch(h.type){case 1:{let m=!1;l=!0;const g=h.data;if(c&&g.length>4){const v=new E9(g).readSliceType();(v===2||v===4||v===7||v===9)&&(m=!0)}if(m){var d;(d=o)!=null&&d.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),o.frame=!0,o.key=m;break}case 5:l=!0,(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),o.key=!0,o.frame=!0;break;case 6:{l=!0,Kre(h.data,1,r.pts,i.samples);break}case 7:{var f,p;l=!0,c=!0;const m=h.data,v=new E9(m).readSPS();if(!e.sps||e.width!==v.width||e.height!==v.height||((f=e.pixelRatio)==null?void 0:f[0])!==v.pixelRatio[0]||((p=e.pixelRatio)==null?void 0:p[1])!==v.pixelRatio[1]){e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.sps=[m],e.duration=s;const y=m.subarray(1,4);let x="avc1.";for(let S=0;S<3;S++){let A=y[S].toString(16);A.length<2&&(A="0"+A),x+=A}e.codec=x}break}case 8:l=!0,e.pps=[h.data];break;case 9:l=!0,e.audFound=!0,o&&this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"");break;case 12:l=!0;break;default:l=!1,o&&(o.debug+="unknown NAL "+h.type+" ");break}o&&l&&o.units.push(h)}),n&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}parseAVCNALu(e,i){const r=i.byteLength;let n=e.naluState||0;const s=n,a=[];let o=0,l,c,h,u=-1,d=0;for(n===-1&&(u=0,d=i[0]&31,n=0,o=1);o<r;){if(l=i[o++],!n){n=l?0:1;continue}if(n===1){n=l?0:2;continue}if(!l)n=3;else if(l===1){if(c=o-n-1,u>=0){const f={data:i.subarray(u,c),type:d};a.push(f)}else{const f=this.getLastNalUnit(e.samples);f&&(s&&o<=4-s&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-s)),c>0&&(f.data=jl(f.data,i.subarray(0,c)),f.state=0))}o<r?(h=i[o]&31,u=o,d=h,n=0):n=-1}else n=0}if(u>=0&&n>=0){const f={data:i.subarray(u,r),type:d,state:n};a.push(f)}if(a.length===0){const f=this.getLastNalUnit(e.samples);f&&(f.data=jl(f.data,i))}return e.naluState=n,a}}class KMe{constructor(e,i,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new d5(i,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,i,r){const n=e[i].unit;if(n.length<=16)return;const s=n.subarray(16,n.length-n.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);n.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,i+1,r)})}decryptAacSamples(e,i,r){for(;;i++){if(i>=e.length){r();return}if(!(e[i].unit.length<32)&&(this.decryptAacSample(e,i,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const i=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(i);let n=0;for(let s=32;s<e.length-16;s+=160,n+=16)r.set(e.subarray(s,s+16),n);return r}getAvcDecryptedUnit(e,i){const r=new Uint8Array(i);let n=0;for(let s=32;s<e.length-16;s+=160,n+=16)e.set(r.subarray(n,n+16),s);return e}decryptAvcSample(e,i,r,n,s){const a=Qre(s.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,i,r+1,n)})}decryptAvcSamples(e,i,r,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;i++,r=0){if(i>=e.length){n();return}const s=e[i].units;for(;!(r>=s.length);r++){const a=s[r];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,i,r,n,a),!this.decrypter.isSync()))return}}}}const ps=188;class gf{constructor(e,i,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=i,this.typeSupported=r,this.videoParser=new qMe}static probe(e){const i=gf.syncOffset(e);return i>0&&Oe.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const i=e.length;let r=Math.min(ps*5,i-ps)+1,n=0;for(;n<r;){let s=!1,a=-1,o=0;for(let l=n;l<i;l+=ps)if(e[l]===71&&(i-l===ps||e[l+ps]===71)){if(o++,a===-1&&(a=l,a!==0&&(r=Math.min(a+ps*99,e.length-ps)+1)),s||(s=wk(e,l)===0),s&&o>1&&(a===0&&o>2||l+ps>r))return a}else{if(o)return-1;break}n++}return-1}static createTrack(e,i){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:jre[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?i:void 0}}resetInitSegment(e,i,r,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=gf.createTrack("video"),this._audioTrack=gf.createTrack("audio",n),this._id3Track=gf.createTrack("id3"),this._txtTrack=gf.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=i,this.videoCodec=r,this._duration=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:i,_id3Track:r}=this;e&&(e.pesData=null),i&&(i.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,i,r=!1,n=!1){r||(this.sampleAes=null);let s;const a=this._videoTrack,o=this._audioTrack,l=this._id3Track,c=this._txtTrack;let h=a.pid,u=a.pesData,d=o.pid,f=l.pid,p=o.pesData,m=l.pesData,g=null,v=this.pmtParsed,y=this._pmtId,x=e.length;if(this.remainderData&&(e=jl(this.remainderData,e),x=e.length,this.remainderData=null),x<ps&&!n)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};const S=Math.max(0,gf.syncOffset(e));x-=(x-S)%ps,x<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,x,e.buffer.byteLength-x));let A=0;for(let M=S;M<x;M+=ps)if(e[M]===71){const E=!!(e[M+1]&64),T=wk(e,M),C=(e[M+3]&48)>>4;let D;if(C>1){if(D=M+5+e[M+4],D===M+ps)continue}else D=M+4;switch(T){case h:E&&(u&&(s=q0(u))&&this.videoParser.parseAVCPES(a,c,s,!1,this._duration),u={data:[],size:0}),u&&(u.data.push(e.subarray(D,M+ps)),u.size+=M+ps-D);break;case d:if(E){if(p&&(s=q0(p)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,s);break;case"mp3":this.parseMPEGPES(o,s);break;case"ac3":this.parseAC3PES(o,s);break}p={data:[],size:0}}p&&(p.data.push(e.subarray(D,M+ps)),p.size+=M+ps-D);break;case f:E&&(m&&(s=q0(m))&&this.parseID3PES(l,s),m={data:[],size:0}),m&&(m.data.push(e.subarray(D,M+ps)),m.size+=M+ps-D);break;case 0:E&&(D+=e[D]+1),y=this._pmtId=QMe(e,D);break;case y:{E&&(D+=e[D]+1);const B=$Me(e,D,this.typeSupported,r,this.observer);h=B.videoPid,h>0&&(a.pid=h,a.segmentCodec=B.segmentVideoCodec),d=B.audioPid,d>0&&(o.pid=d,o.segmentCodec=B.segmentAudioCodec),f=B.id3Pid,f>0&&(l.pid=f),g!==null&&!v&&(Oe.warn(`MPEG-TS PMT found at ${M} after unknown PID '${g}'. Backtracking to sync byte @${S} to parse all TS packets.`),g=null,M=S-188),v=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=T;break}}else A++;A>0&&x2(this.observer,new Error(`Found ${A} TS packet/s that do not start with 0x47`)),a.pesData=u,o.pesData=p,l.pesData=m;const _={audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};return n&&this.extractRemainingSamples(_),_}flush(){const{remainderData:e}=this;this.remainderData=null;let i;return e?i=this.demux(e,-1,!1,!0):i={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(i),this.sampleAes?this.decrypt(i,this.sampleAes):i}extractRemainingSamples(e){const{audioTrack:i,videoTrack:r,id3Track:n,textTrack:s}=e,a=r.pesData,o=i.pesData,l=n.pesData;let c;if(a&&(c=q0(a))?(this.videoParser.parseAVCPES(r,s,c,!0,this._duration),r.pesData=null):r.pesData=a,o&&(c=q0(o))){switch(i.segmentCodec){case"aac":this.parseAACPES(i,c);break;case"mp3":this.parseMPEGPES(i,c);break;case"ac3":this.parseAC3PES(i,c);break}i.pesData=null}else o!=null&&o.size&&Oe.log("last AAC PES packet truncated,might overlap between fragments"),i.pesData=o;l&&(c=q0(l))?(this.parseID3PES(n,c),n.pesData=null):n.pesData=l}demuxSampleAes(e,i,r){const n=this.demux(e,r,!0,!this.config.progressive),s=this.sampleAes=new KMe(this.observer,this.config,i);return this.decrypt(n,s)}decrypt(e,i){return new Promise(r=>{const{audioTrack:n,videoTrack:s}=e;n.samples&&n.segmentCodec==="aac"?i.decryptAacSamples(n.samples,0,()=>{s.samples?i.decryptAvcSamples(s.samples,0,0,()=>{r(e)}):r(e)}):s.samples&&i.decryptAvcSamples(s.samples,0,0,()=>{r(e)})})}destroy(){this._duration=0}parseAACPES(e,i){let r=0;const n=this.aacOverFlow;let s=i.data;if(n){this.aacOverFlow=null;const u=n.missing,d=n.sample.unit.byteLength;if(u===-1)s=jl(n.sample.unit,s);else{const f=d-u;n.sample.unit.set(s.subarray(0,u),f),e.samples.push(n.sample),r=n.missing}}let a,o;for(a=r,o=s.length;a<o-1&&!y2(s,a);a++);if(a!==r){let u;const d=a<o-1;if(d?u=`AAC PES did not start with ADTS header,offset:${a}`:u="No ADTS header found in AAC PES",x2(this.observer,new Error(u),d),!d)return}fne(e,this.observer,s,a,this.audioCodec);let l;if(i.pts!==void 0)l=i.pts;else if(n){const u=pne(e.samplerate);l=n.sample.pts+u}else{Oe.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,h;for(;a<o;)if(h=mne(e,s,a,l,c),a+=h.length,h.missing){this.aacOverFlow=h;break}else for(c++;a<o-1&&!y2(s,a);a++);}parseMPEGPES(e,i){const r=i.data,n=r.length;let s=0,a=0;const o=i.pts;if(o===void 0){Oe.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<n;)if(yne(r,a)){const l=gne(e,r,a,o,s);if(l)a+=l.length,s++;else break}else a++}parseAC3PES(e,i){{const r=i.data,n=i.pts;if(n===void 0){Oe.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=r.length;let a=0,o=0,l;for(;o<s&&(l=wne(e,r,o,n,a++))>0;)o+=l}}parseID3PES(e,i){if(i.pts===void 0){Oe.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=zn({},i,{type:this._videoTrack?Pl.emsg:Pl.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function wk(t,e){return((t[e+1]&31)<<8)+t[e+2]}function QMe(t,e){return(t[e+10]&31)<<8|t[e+11]}function $Me(t,e,i,r,n){const s={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(t[e+1]&15)<<8|t[e+2],o=e+3+a-4,l=(t[e+10]&15)<<8|t[e+11];for(e+=12+l;e<o;){const c=wk(t,e),h=(t[e+3]&15)<<8|t[e+4];switch(t[e]){case 207:if(!r){HL("ADTS AAC");break}case 15:s.audioPid===-1&&(s.audioPid=c);break;case 21:s.id3Pid===-1&&(s.id3Pid=c);break;case 219:if(!r){HL("H.264");break}case 27:s.videoPid===-1&&(s.videoPid=c,s.segmentVideoCodec="avc");break;case 3:case 4:!i.mpeg&&!i.mp3?Oe.log("MPEG audio found, not supported in this browser"):s.audioPid===-1&&(s.audioPid=c,s.segmentAudioCodec="mp3");break;case 193:if(!r){HL("AC-3");break}case 129:i.ac3?s.audioPid===-1&&(s.audioPid=c,s.segmentAudioCodec="ac3"):Oe.log("AC-3 audio found, not supported in this browser");break;case 6:if(s.audioPid===-1&&h>0){let u=e+5,d=h;for(;d>2;){switch(t[u]){case 106:i.ac3!==!0?Oe.log("AC-3 audio found, not supported in this browser for now"):(s.audioPid=c,s.segmentAudioCodec="ac3");break}const p=t[u+1]+2;u+=p,d-=p}}break;case 194:case 135:return x2(n,new Error("Unsupported EC-3 in M2TS found")),s;case 36:return x2(n,new Error("Unsupported HEVC in M2TS found")),s}e+=h+5}return s}function x2(t,e,i){Oe.warn(`parsing error: ${e.message}`),t.emit(ee.ERROR,ee.ERROR,{type:oi.MEDIA_ERROR,details:je.FRAG_PARSING_ERROR,fatal:!1,levelRetry:i,error:e,reason:e.message})}function HL(t){Oe.log(`${t} with AES-128-CBC encryption found in unencrypted stream`)}function q0(t){let e=0,i,r,n,s,a;const o=t.data;if(!t||t.size===0)return null;for(;o[0].length<19&&o.length>1;)o[0]=jl(o[0],o[1]),o.splice(1,1);if(i=o[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(r=(i[4]<<8)+i[5],r&&r>t.size-6)return null;const c=i[7];c&192&&(s=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,c&64?(a=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,s-a>60*9e4&&(Oe.warn(`${Math.round((s-a)/9e4)}s delta between PTS and DTS, align them`),s=a)):a=s),n=i[8];let h=n+9;if(t.size<=h)return null;t.size-=h;const u=new Uint8Array(t.size);for(let d=0,f=o.length;d<f;d++){i=o[d];let p=i.byteLength;if(h)if(h>p){h-=p;continue}else i=i.subarray(h),p-=h,h=0;u.set(i,e),e+=p}return r&&(r-=n+3),{data:u,pts:s,dts:a,len:r}}return null}class JMe extends f5{resetInitSegment(e,i,r,n){super.resetInitSegment(e,i,r,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:i,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const i=cS(e,0);let r=(i==null?void 0:i.length)||0;if(i&&e[r]===11&&e[r+1]===119&&h5(i)!==void 0&&bne(e,r)<=16)return!1;for(let n=e.length;r<n;r++)if(xne(e,r))return Oe.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,i){return VMe(e,i)}appendFrame(e,i,r){if(this.basePTS!==null)return gne(e,i,r,this.basePTS,this.frameIndex)}}class M9{static getSilentFrame(e,i){switch(e){case"mp4a.40.2":if(i===1)return new Uint8Array([0,200,0,128,35,128]);if(i===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(i===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(i===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(i===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(i===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(i===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(i===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(i===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Qd=Math.pow(2,32)-1;class Fe{static init(){Fe.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in Fe.types)Fe.types.hasOwnProperty(e)&&(Fe.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Fe.HDLR_TYPES={video:i,audio:r};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);Fe.STTS=Fe.STSC=Fe.STCO=s,Fe.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Fe.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Fe.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Fe.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);Fe.FTYP=Fe.box(Fe.types.ftyp,a,l,a,o),Fe.DINF=Fe.box(Fe.types.dinf,Fe.box(Fe.types.dref,n))}static box(e,...i){let r=8,n=i.length;const s=n;for(;n--;)r+=i[n].byteLength;const a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=r&255,a.set(e,4),n=0,r=8;n<s;n++)a.set(i[n],r),r+=i[n].byteLength;return a}static hdlr(e){return Fe.box(Fe.types.hdlr,Fe.HDLR_TYPES[e])}static mdat(e){return Fe.box(Fe.types.mdat,e)}static mdhd(e,i){i*=e;const r=Math.floor(i/(Qd+1)),n=Math.floor(i%(Qd+1));return Fe.box(Fe.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))}static mdia(e){return Fe.box(Fe.types.mdia,Fe.mdhd(e.timescale,e.duration),Fe.hdlr(e.type),Fe.minf(e))}static mfhd(e){return Fe.box(Fe.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?Fe.box(Fe.types.minf,Fe.box(Fe.types.smhd,Fe.SMHD),Fe.DINF,Fe.stbl(e)):Fe.box(Fe.types.minf,Fe.box(Fe.types.vmhd,Fe.VMHD),Fe.DINF,Fe.stbl(e))}static moof(e,i,r){return Fe.box(Fe.types.moof,Fe.mfhd(e),Fe.traf(r,i))}static moov(e){let i=e.length;const r=[];for(;i--;)r[i]=Fe.trak(e[i]);return Fe.box.apply(null,[Fe.types.moov,Fe.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(Fe.mvex(e)))}static mvex(e){let i=e.length;const r=[];for(;i--;)r[i]=Fe.trex(e[i]);return Fe.box.apply(null,[Fe.types.mvex,...r])}static mvhd(e,i){i*=e;const r=Math.floor(i/(Qd+1)),n=Math.floor(i%(Qd+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Fe.box(Fe.types.mvhd,s)}static sdtp(e){const i=e.samples||[],r=new Uint8Array(4+i.length);let n,s;for(n=0;n<i.length;n++)s=i[n].flags,r[n+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return Fe.box(Fe.types.sdtp,r)}static stbl(e){return Fe.box(Fe.types.stbl,Fe.stsd(e),Fe.box(Fe.types.stts,Fe.STTS),Fe.box(Fe.types.stsc,Fe.STSC),Fe.box(Fe.types.stsz,Fe.STSZ),Fe.box(Fe.types.stco,Fe.STCO))}static avc1(e){let i=[],r=[],n,s,a;for(n=0;n<e.sps.length;n++)s=e.sps[n],a=s.byteLength,i.push(a>>>8&255),i.push(a&255),i=i.concat(Array.prototype.slice.call(s));for(n=0;n<e.pps.length;n++)s=e.pps[n],a=s.byteLength,r.push(a>>>8&255),r.push(a&255),r=r.concat(Array.prototype.slice.call(s));const o=Fe.box(Fe.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|e.sps.length].concat(i).concat([e.pps.length]).concat(r))),l=e.width,c=e.height,h=e.pixelRatio[0],u=e.pixelRatio[1];return Fe.box(Fe.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,Fe.box(Fe.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Fe.box(Fe.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,u>>24,u>>16&255,u>>8&255,u&255])))}static esds(e){const i=e.config.length;return new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(e.config).concat([6,1,2]))}static audioStsd(e){const i=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,i>>8&255,i&255,0,0])}static mp4a(e){return Fe.box(Fe.types.mp4a,Fe.audioStsd(e),Fe.box(Fe.types.esds,Fe.esds(e)))}static mp3(e){return Fe.box(Fe.types[".mp3"],Fe.audioStsd(e))}static ac3(e){return Fe.box(Fe.types["ac-3"],Fe.audioStsd(e),Fe.box(Fe.types.dac3,e.config))}static stsd(e){return e.type==="audio"?e.segmentCodec==="mp3"&&e.codec==="mp3"?Fe.box(Fe.types.stsd,Fe.STSD,Fe.mp3(e)):e.segmentCodec==="ac3"?Fe.box(Fe.types.stsd,Fe.STSD,Fe.ac3(e)):Fe.box(Fe.types.stsd,Fe.STSD,Fe.mp4a(e)):Fe.box(Fe.types.stsd,Fe.STSD,Fe.avc1(e))}static tkhd(e){const i=e.id,r=e.duration*e.timescale,n=e.width,s=e.height,a=Math.floor(r/(Qd+1)),o=Math.floor(r%(Qd+1));return Fe.box(Fe.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,i&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,i){const r=Fe.sdtp(e),n=e.id,s=Math.floor(i/(Qd+1)),a=Math.floor(i%(Qd+1));return Fe.box(Fe.types.traf,Fe.box(Fe.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),Fe.box(Fe.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255])),Fe.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,Fe.box(Fe.types.trak,Fe.tkhd(e),Fe.mdia(e))}static trex(e){const i=e.id;return Fe.box(Fe.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,i){const r=e.samples||[],n=r.length,s=12+16*n,a=new Uint8Array(s);let o,l,c,h,u,d;for(i+=8+s,a.set([e.type==="video"?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255],0),o=0;o<n;o++)l=r[o],c=l.duration,h=l.size,u=l.flags,d=l.cts,a.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,u.degradPrio&61440,u.degradPrio&15,d>>>24&255,d>>>16&255,d>>>8&255,d&255],12+16*o);return Fe.box(Fe.types.trun,a)}static initSegment(e){Fe.types||Fe.init();const i=Fe.moov(e);return jl(Fe.FTYP,i)}}Fe.types=void 0;Fe.HDLR_TYPES=void 0;Fe.STTS=void 0;Fe.STSC=void 0;Fe.STCO=void 0;Fe.STSZ=void 0;Fe.VMHD=void 0;Fe.SMHD=void 0;Fe.STSD=void 0;Fe.FTYP=void 0;Fe.DINF=void 0;const Sne=9e4;function g5(t,e,i=1,r=!1){const n=t*e*i;return r?Math.round(n):n}function ZMe(t,e,i=1,r=!1){return g5(t,e,1/i,r)}function qx(t,e=!1){return g5(t,1e3,1/Sne,e)}function eTe(t,e=1){return g5(t,Sne,1/e)}const tTe=10*1e3,T9=1024,iTe=1152,rTe=1536;let K0=null,jL=null;class rC{constructor(e,i,r,n=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=i,this.typeSupported=r,this.ISGenerated=!1,K0===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);K0=a?parseInt(a[1]):0}if(jL===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);jL=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){Oe.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){Oe.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){Oe.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let i=!1;const r=e.reduce((n,s)=>{const a=s.pts-n;return a<-4294967296?(i=!0,Sl(n,s.pts)):a>0?n:s.pts},e[0].pts);return i&&Oe.debug("PTS rollover detected"),r}remux(e,i,r,n,s,a,o,l){let c,h,u,d,f,p,m=s,g=s;const v=e.pid>-1,y=i.pid>-1,x=i.samples.length,S=e.samples.length>0,A=o&&x>0||x>1;if((!v||S)&&(!y||A)||this.ISGenerated||o){if(this.ISGenerated){var M,E,T,C;const L=this.videoTrackConfig;L&&(i.width!==L.width||i.height!==L.height||((M=i.pixelRatio)==null?void 0:M[0])!==((E=L.pixelRatio)==null?void 0:E[0])||((T=i.pixelRatio)==null?void 0:T[1])!==((C=L.pixelRatio)==null?void 0:C[1]))&&this.resetInitSegment()}else u=this.generateIS(e,i,s,a);const D=this.isVideoContiguous;let B=-1,O;if(A&&(B=nTe(i.samples),!D&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,B>0){Oe.warn(`[mp4-remuxer]: Dropped ${B} out of ${x} video samples due to a missing keyframe`);const L=this.getVideoStartPts(i.samples);i.samples=i.samples.slice(B),i.dropped+=B,g+=(i.samples[0].pts-L)/i.inputTimeScale,O=g}else B===-1&&(Oe.warn(`[mp4-remuxer]: No keyframe found out of ${x} video samples`),p=!1);if(this.ISGenerated){if(S&&A){const L=this.getVideoStartPts(i.samples),q=(Sl(e.samples[0].pts,L)-L)/i.inputTimeScale;m+=Math.max(0,q),g+=Math.max(0,-q)}if(S){if(e.samplerate||(Oe.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),u=this.generateIS(e,i,s,a)),h=this.remuxAudio(e,m,this.isAudioContiguous,a,y||A||l===Jt.AUDIO?g:void 0),A){const L=h?h.endPTS-h.startPTS:0;i.inputTimeScale||(Oe.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),u=this.generateIS(e,i,s,a)),c=this.remuxVideo(i,g,D,L)}}else A&&(c=this.remuxVideo(i,g,D,0));c&&(c.firstKeyFrame=B,c.independent=B!==-1,c.firstKeyFramePTS=O)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(f=_ne(r,s,this._initPTS,this._initDTS)),n.samples.length&&(d=Ane(n,s,this._initPTS))),{audio:h,video:c,initSegment:u,independent:p,text:d,id3:f}}generateIS(e,i,r,n){const s=e.samples,a=i.samples,o=this.typeSupported,l={},c=this._initPTS;let h=!c||n,u="audio/mp4",d,f,p;if(h&&(d=f=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(u="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:u,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):Fe.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(p=e.inputTimeScale,!c||p!==c.timescale?d=f=s[0].pts-Math.round(p*r):h=!1)}if(i.sps&&i.pps&&a.length){if(i.timescale=i.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:i.codec,initSegment:Fe.initSegment([i]),metadata:{width:i.width,height:i.height}},h)if(p=i.inputTimeScale,!c||p!==c.timescale){const m=this.getVideoStartPts(a),g=Math.round(p*r);f=Math.min(f,Sl(a[0].dts,m)-g),d=Math.min(d,m-g)}else h=!1;this.videoTrackConfig={width:i.width,height:i.height,pixelRatio:i.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,h?(this._initPTS={baseTime:d,timescale:p},this._initDTS={baseTime:f,timescale:p}):d=p=void 0,{tracks:l,initPTS:d,timescale:p}}remuxVideo(e,i,r,n){const s=e.inputTimeScale,a=e.samples,o=[],l=a.length,c=this._initPTS;let h=this.nextAvcDts,u=8,d=this.videoSampleDuration,f,p,m=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,v=!1;if(!r||h===null){const z=i*s,U=a[0].pts-Sl(a[0].dts,a[0].pts);K0&&h!==null&&Math.abs(z-U-h)<15e3?r=!0:h=z-U}const y=c.baseTime*s/c.timescale;for(let z=0;z<l;z++){const U=a[z];U.pts=Sl(U.pts-y,h),U.dts=Sl(U.dts-y,h),U.dts<a[z>0?z-1:z].dts&&(v=!0)}v&&a.sort(function(z,U){const X=z.dts-U.dts,Q=z.pts-U.pts;return X||Q}),f=a[0].dts,p=a[a.length-1].dts;const x=p-f,S=x?Math.round(x/(l-1)):d||e.inputTimeScale/30;if(r){const z=f-h,U=z>S,X=z<-1;if((U||X)&&(U?Oe.warn(`AVC: ${qx(z,!0)} ms (${z}dts) hole between fragments detected at ${i.toFixed(3)}`):Oe.warn(`AVC: ${qx(-z,!0)} ms (${z}dts) overlapping between fragments detected at ${i.toFixed(3)}`),!X||h>=a[0].pts||K0)){f=h;const Q=a[0].pts-z;if(U)a[0].dts=f,a[0].pts=Q;else for(let re=0;re<a.length&&!(a[re].dts>Q);re++)a[re].dts-=z,a[re].pts-=z;Oe.log(`Video: Initial PTS/DTS adjusted: ${qx(Q,!0)}/${qx(f,!0)}, delta: ${qx(z,!0)} ms`)}}f=Math.max(0,f);let A=0,_=0,M=f;for(let z=0;z<l;z++){const U=a[z],X=U.units,Q=X.length;let re=0;for(let ie=0;ie<Q;ie++)re+=X[ie].data.length;_+=re,A+=Q,U.length=re,U.dts<M?(U.dts=M,M+=S/4|0||1):M=U.dts,m=Math.min(U.pts,m),g=Math.max(U.pts,g)}p=a[l-1].dts;const E=_+4*A+8;let T;try{T=new Uint8Array(E)}catch(z){this.observer.emit(ee.ERROR,ee.ERROR,{type:oi.MUX_ERROR,details:je.REMUX_ALLOC_ERROR,fatal:!1,error:z,bytes:E,reason:`fail allocating video mdat ${E}`});return}const C=new DataView(T.buffer);C.setUint32(0,E),T.set(Fe.types.mdat,4);let D=!1,B=Number.POSITIVE_INFINITY,O=Number.POSITIVE_INFINITY,L=Number.NEGATIVE_INFINITY,H=Number.NEGATIVE_INFINITY;for(let z=0;z<l;z++){const U=a[z],X=U.units;let Q=0;for(let ce=0,Z=X.length;ce<Z;ce++){const Ae=X[ce],Se=Ae.data,_e=Ae.data.byteLength;C.setUint32(u,_e),u+=4,T.set(Se,u),u+=_e,Q+=4+_e}let re;if(z<l-1)d=a[z+1].dts-U.dts,re=a[z+1].pts-U.pts;else{const ce=this.config,Z=z>0?U.dts-a[z-1].dts:S;if(re=z>0?U.pts-a[z-1].pts:S,ce.stretchShortVideoTrack&&this.nextAudioPts!==null){const Ae=Math.floor(ce.maxBufferHole*s),Se=(n?m+n*s:this.nextAudioPts)-U.pts;Se>Ae?(d=Se-Z,d<0?d=Z:D=!0,Oe.log(`[mp4-remuxer]: It is approximately ${Se/90} ms to the next segment; using duration ${d/90} ms for the last video frame.`)):d=Z}else d=Z}const ie=Math.round(U.pts-U.dts);B=Math.min(B,d),L=Math.max(L,d),O=Math.min(O,re),H=Math.max(H,re),o.push(new C9(U.key,d,Q,ie))}if(o.length){if(K0){if(K0<70){const z=o[0].flags;z.dependsOn=2,z.isNonSync=0}}else if(jL&&H-O<L-B&&S/L<.025&&o[0].cts===0){Oe.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let z=f;for(let U=0,X=o.length;U<X;U++){const Q=z+o[U].duration,re=z+o[U].cts;if(U<X-1){const ie=Q+o[U+1].cts;o[U].duration=ie-re}else o[U].duration=U?o[U-1].duration:S;o[U].cts=0,z=Q}}}d=D||!d?S:d,this.nextAvcDts=h=p+d,this.videoSampleDuration=d,this.isVideoContiguous=!0;const I={data1:Fe.moof(e.sequenceNumber++,f,zn({},e,{samples:o})),data2:T,startPTS:m/s,endPTS:(g+d)/s,startDTS:f/s,endDTS:h/s,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,I}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return iTe;case"ac3":return rTe;default:return T9}}remuxAudio(e,i,r,n,s){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,c=this.getSamplesPerFrame(e),h=c*l,u=this._initPTS,d=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,f=[],p=s!==void 0;let m=e.samples,g=d?0:8,v=this.nextAudioPts||-1;const y=i*a,x=u.baseTime*a/u.timescale;if(this.isAudioContiguous=r=r||m.length&&v>0&&(n&&Math.abs(y-v)<9e3||Math.abs(Sl(m[0].pts-x,y)-v)<20*h),m.forEach(function(q){q.pts=Sl(q.pts-x,y)}),!r||v<0){if(m=m.filter(q=>q.pts>=0),!m.length)return;s===0?v=0:n&&!p?v=Math.max(0,y):v=m[0].pts}if(e.segmentCodec==="aac"){const q=this.config.maxAudioFramesDrift;for(let W=0,I=v;W<m.length;W++){const z=m[W],U=z.pts,X=U-I,Q=Math.abs(1e3*X/a);if(X<=-q*h&&p)W===0&&(Oe.warn(`Audio frame @ ${(U/a).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*X/a)} ms.`),this.nextAudioPts=v=I=U);else if(X>=q*h&&Q<tTe&&p){let re=Math.round(X/h);I=U-re*h,I<0&&(re--,I+=h),W===0&&(this.nextAudioPts=v=I),Oe.warn(`[mp4-remuxer]: Injecting ${re} audio frame @ ${(I/a).toFixed(3)}s due to ${Math.round(1e3*X/a)} ms gap.`);for(let ie=0;ie<re;ie++){const ce=Math.max(I,0);let Z=M9.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);Z||(Oe.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Z=z.unit.subarray()),m.splice(W,0,{unit:Z,pts:ce}),I+=h,W++}}z.pts=I,I+=h}}let S=null,A=null,_,M=0,E=m.length;for(;E--;)M+=m[E].unit.byteLength;for(let q=0,W=m.length;q<W;q++){const I=m[q],z=I.unit;let U=I.pts;if(A!==null){const Q=f[q-1];Q.duration=Math.round((U-A)/l)}else if(r&&e.segmentCodec==="aac"&&(U=v),S=U,M>0){M+=g;try{_=new Uint8Array(M)}catch(Q){this.observer.emit(ee.ERROR,ee.ERROR,{type:oi.MUX_ERROR,details:je.REMUX_ALLOC_ERROR,fatal:!1,error:Q,bytes:M,reason:`fail allocating audio mdat ${M}`});return}d||(new DataView(_.buffer).setUint32(0,M),_.set(Fe.types.mdat,4))}else return;_.set(z,g);const X=z.byteLength;g+=X,f.push(new C9(!0,c,X,0)),A=U}const T=f.length;if(!T)return;const C=f[f.length-1];this.nextAudioPts=v=A+l*C.duration;const D=d?new Uint8Array(0):Fe.moof(e.sequenceNumber++,S/l,zn({},e,{samples:f}));e.samples=[];const B=S/a,O=v/a,H={data1:D,data2:_,startPTS:B,endPTS:O,startDTS:B,endDTS:O,type:"audio",hasAudio:!0,hasVideo:!1,nb:T};return this.isAudioContiguous=!0,H}remuxEmptyAudio(e,i,r,n){const s=e.inputTimeScale,a=e.samplerate?e.samplerate:s,o=s/a,l=this.nextAudioPts,c=this._initDTS,h=c.baseTime*9e4/c.timescale,u=(l!==null?l:n.startDTS*s)+h,d=n.endDTS*s+h,f=o*T9,p=Math.ceil((d-u)/f),m=M9.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(Oe.warn("[mp4-remuxer]: remux empty Audio"),!m){Oe.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const g=[];for(let v=0;v<p;v++){const y=u+v*f;g.push({unit:m,pts:y,dts:y})}return e.samples=g,this.remuxAudio(e,i,r,!1)}}function Sl(t,e){let i;if(e===null)return t;for(e<t?i=-8589934592:i=8589934592;Math.abs(t-e)>4294967296;)t+=i;return t}function nTe(t){for(let e=0;e<t.length;e++)if(t[e].key)return e;return-1}function _ne(t,e,i,r){const n=t.samples.length;if(!n)return;const s=t.inputTimeScale;for(let o=0;o<n;o++){const l=t.samples[o];l.pts=Sl(l.pts-i.baseTime*s/i.timescale,e*s)/s,l.dts=Sl(l.dts-r.baseTime*s/r.timescale,e*s)/s}const a=t.samples;return t.samples=[],{samples:a}}function Ane(t,e,i){const r=t.samples.length;if(!r)return;const n=t.inputTimeScale;for(let a=0;a<r;a++){const o=t.samples[a];o.pts=Sl(o.pts-i.baseTime*n/i.timescale,e*n)/n}t.samples.sort((a,o)=>a.pts-o.pts);const s=t.samples;return t.samples=[],{samples:s}}class C9{constructor(e,i,r,n){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=i,this.size=r,this.cts=n,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class sTe{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,i,r,n){this.audioCodec=i,this.videoCodec=r,this.generateInitSegment(fEe(e,n)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:i,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const n=this.initData=Yre(e);n.audio&&(i=P9(n.audio,ir.AUDIO)),n.video&&(r=P9(n.video,ir.VIDEO));const s={};n.audio&&n.video?s.audiovideo={container:"video/mp4",codec:i+","+r,initSegment:e,id:"main"}:n.audio?s.audio={container:"audio/mp4",codec:i,initSegment:e,id:"audio"}:n.video?s.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:Oe.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,i,r,n,s,a){var o,l;let{initPTS:c,lastEndTime:h}=this;const u={audio:void 0,video:void 0,text:n,id3:r,initSegment:void 0};Bt(h)||(h=this.lastEndTime=s||0);const d=i.samples;if(!(d!=null&&d.length))return u;const f={initPTS:void 0,timescale:1};let p=this.initData;if((o=p)!=null&&o.length||(this.generateInitSegment(d),p=this.initData),!((l=p)!=null&&l.length))return Oe.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),u;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const m=mEe(d,p),g=pEe(p,d),v=g===null?s:g;(aTe(c,v,s,m)||f.timescale!==c.timescale&&a)&&(f.initPTS=v-s,c&&c.timescale===1&&Oe.warn(`Adjusting initPTS by ${f.initPTS-c.baseTime}`),this.initPTS=c={baseTime:f.initPTS,timescale:1});const y=e?v-c.baseTime/c.timescale:h,x=y+m;vEe(p,d,c.baseTime/c.timescale),m>0?this.lastEndTime=x:(Oe.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const S=!!p.audio,A=!!p.video;let _="";S&&(_+="audio"),A&&(_+="video");const M={data1:d,startPTS:y,startDTS:y,endPTS:x,endDTS:x,type:_,hasAudio:S,hasVideo:A,nb:1,dropped:0};return u.audio=M.type==="audio"?M:void 0,u.video=M.type!=="audio"?M:void 0,u.initSegment=f,u.id3=_ne(r,s,c,c),n.samples.length&&(u.text=Ane(n,s,c)),u}}function aTe(t,e,i,r){if(t===null)return!0;const n=Math.max(r,1),s=e-t.baseTime/t.timescale;return Math.abs(s-i)>n}function P9(t,e){const i=t==null?void 0:t.codec;if(i&&i.length>4)return i;if(e===ir.AUDIO){if(i==="ec-3"||i==="ac-3"||i==="alac")return i;if(i==="fLaC"||i==="Opus")return d2(i,!1);const r="mp4a.40.5";return Oe.info(`Parsed audio codec "${i}" or audio object type not handled. Using "${r}"`),r}return Oe.warn(`Unhandled video codec "${i}"`),i==="hvc1"||i==="hev1"?"hvc1.1.6.L120.90":i==="av01"?"av01.0.04M.08":"avc1.42e01e"}let Pu;try{Pu=self.performance.now.bind(self.performance)}catch{Oe.debug("Unable to use Performance API on this environment"),Pu=t1==null?void 0:t1.Date.now}const nC=[{demux:WMe,remux:sTe},{demux:gf,remux:rC},{demux:HMe,remux:rC},{demux:JMe,remux:rC}];nC.splice(2,0,{demux:XMe,remux:rC});class D9{constructor(e,i,r,n,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=i,this.config=r,this.vendor=n,this.id=s}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,i,r,n){const s=r.transmuxing;s.executeStart=Pu();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;n&&(this.currentTransmuxState=n);const{contiguous:c,discontinuity:h,trackSwitch:u,accurateTimeOffset:d,timeOffset:f,initSegmentChange:p}=n||o,{audioCodec:m,videoCodec:g,defaultInitPts:v,duration:y,initSegmentData:x}=l,S=oTe(a,i);if(S&&S.method==="AES-128"){const E=this.getDecrypter();if(E.isSync()){let T=E.softwareDecrypt(a,S.key.buffer,S.iv.buffer);if(r.part>-1&&(T=E.flush()),!T)return s.executeEnd=Pu(),WL(r);a=new Uint8Array(T)}else return this.decryptionPromise=E.webCryptoDecrypt(a,S.key.buffer,S.iv.buffer).then(T=>{const C=this.push(T,null,r);return this.decryptionPromise=null,C}),this.decryptionPromise}const A=this.needsProbing(h,u);if(A){const E=this.configureTransmuxer(a);if(E)return Oe.warn(`[transmuxer] ${E.message}`),this.observer.emit(ee.ERROR,ee.ERROR,{type:oi.MEDIA_ERROR,details:je.FRAG_PARSING_ERROR,fatal:!1,error:E,reason:E.message}),s.executeEnd=Pu(),WL(r)}(h||u||p||A)&&this.resetInitSegment(x,m,g,y,i),(h||p||A)&&this.resetInitialTimestamp(v),c||this.resetContiguity();const _=this.transmux(a,S,f,d,r),M=this.currentTransmuxState;return M.contiguous=!0,M.discontinuity=!1,M.trackSwitch=!1,s.executeEnd=Pu(),_}flush(e){const i=e.transmuxing;i.executeStart=Pu();const{decrypter:r,currentTransmuxState:n,decryptionPromise:s}=this;if(s)return s.then(()=>this.flush(e));const a=[],{timeOffset:o}=n;if(r){const u=r.flush();u&&a.push(this.push(u,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c)return i.executeEnd=Pu(),[WL(e)];const h=l.flush(o);return sC(h)?h.then(u=>(this.flushRemux(a,u,e),a)):(this.flushRemux(a,h,e),a)}flushRemux(e,i,r){const{audioTrack:n,videoTrack:s,id3Track:a,textTrack:o}=i,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;Oe.log(`[transmuxer.ts]: Flushed fragment ${r.sn}${r.part>-1?" p: "+r.part:""} of level ${r.level}`);const h=this.remuxer.remux(n,s,a,o,c,l,!0,this.id);e.push({remuxResult:h,chunkMeta:r}),r.transmuxing.executeEnd=Pu()}resetInitialTimestamp(e){const{demuxer:i,remuxer:r}=this;!i||!r||(i.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:i}=this;!e||!i||(e.resetContiguity(),i.resetNextTimestamp())}resetInitSegment(e,i,r,n,s){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,i,r,n),o.resetInitSegment(e,i,r,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,i,r,n,s){let a;return i&&i.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,i,r,n,s):a=this.transmuxUnencrypted(e,r,n,s),a}transmuxUnencrypted(e,i,r,n){const{audioTrack:s,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,i,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,a,o,l,i,r,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,i,r,n,s){return this.demuxer.demuxSampleAes(e,i,r).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,r,n,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:i,observer:r,typeSupported:n,vendor:s}=this;let a;for(let d=0,f=nC.length;d<f;d++){var o;if((o=nC[d].demux)!=null&&o.probe(e)){a=nC[d];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");const l=this.demuxer,c=this.remuxer,h=a.remux,u=a.demux;(!c||!(c instanceof h))&&(this.remuxer=new h(r,i,n,s)),(!l||!(l instanceof u))&&(this.demuxer=new u(r,i,n),this.probe=u.probe)}needsProbing(e,i){return!this.demuxer||!this.remuxer||e||i}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new d5(this.config)),e}}function oTe(t,e){let i=null;return t.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(i=e),i}const WL=t=>({remuxResult:{},chunkMeta:t});function sC(t){return"then"in t&&t.then instanceof Function}class lTe{constructor(e,i,r,n,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=i,this.initSegmentData=r,this.duration=n,this.defaultInitPts=s||null}}class cTe{constructor(e,i,r,n,s,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=i,this.accurateTimeOffset=r,this.trackSwitch=n,this.timeOffset=s,this.initSegmentChange=a}}var Ene={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,i="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1));function n(l,c,h){this.fn=l,this.context=c,this.once=h||!1}function s(l,c,h,u,d){if(typeof h!="function")throw new TypeError("The listener must be a function");var f=new n(h,u||l,d),p=i?i+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],f]:l._events[p].push(f):(l._events[p]=f,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],h,u;if(this._eventsCount===0)return c;for(u in h=this._events)e.call(h,u)&&c.push(i?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(h)):c},o.prototype.listeners=function(c){var h=i?i+c:c,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,f=u.length,p=new Array(f);d<f;d++)p[d]=u[d].fn;return p},o.prototype.listenerCount=function(c){var h=i?i+c:c,u=this._events[h];return u?u.fn?1:u.length:0},o.prototype.emit=function(c,h,u,d,f,p){var m=i?i+c:c;if(!this._events[m])return!1;var g=this._events[m],v=arguments.length,y,x;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),v){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,h),!0;case 3:return g.fn.call(g.context,h,u),!0;case 4:return g.fn.call(g.context,h,u,d),!0;case 5:return g.fn.call(g.context,h,u,d,f),!0;case 6:return g.fn.call(g.context,h,u,d,f,p),!0}for(x=1,y=new Array(v-1);x<v;x++)y[x-1]=arguments[x];g.fn.apply(g.context,y)}else{var S=g.length,A;for(x=0;x<S;x++)switch(g[x].once&&this.removeListener(c,g[x].fn,void 0,!0),v){case 1:g[x].fn.call(g[x].context);break;case 2:g[x].fn.call(g[x].context,h);break;case 3:g[x].fn.call(g[x].context,h,u);break;case 4:g[x].fn.call(g[x].context,h,u,d);break;default:if(!y)for(A=1,y=new Array(v-1);A<v;A++)y[A-1]=arguments[A];g[x].fn.apply(g[x].context,y)}}return!0},o.prototype.on=function(c,h,u){return s(this,c,h,u,!1)},o.prototype.once=function(c,h,u){return s(this,c,h,u,!0)},o.prototype.removeListener=function(c,h,u,d){var f=i?i+c:c;if(!this._events[f])return this;if(!h)return a(this,f),this;var p=this._events[f];if(p.fn)p.fn===h&&(!d||p.once)&&(!u||p.context===u)&&a(this,f);else{for(var m=0,g=[],v=p.length;m<v;m++)(p[m].fn!==h||d&&!p[m].once||u&&p[m].context!==u)&&g.push(p[m]);g.length?this._events[f]=g.length===1?g[0]:g:a(this,f)}return this},o.prototype.removeAllListeners=function(c){var h;return c?(h=i?i+c:c,this._events[h]&&a(this,h)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,t.exports=o})(Ene);var hTe=Ene.exports,v5=kAe(hTe);class Mne{constructor(e,i,r,n){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const s=e.config;this.hls=e,this.id=i,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=r,this.onFlush=n;const a=(c,h)=>{h=h||{},h.frag=this.frag,h.id=this.id,c===ee.ERROR&&(this.error=h.error),this.hls.trigger(c,h)};this.observer=new v5,this.observer.on(ee.FRAG_DECRYPTED,a),this.observer.on(ee.ERROR,a);const o=gp(s.preferManagedMediaSource)||{isTypeSupported:()=>!1},l={mpeg:o.isTypeSupported("audio/mpeg"),mp3:o.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:o.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&typeof Worker<"u"&&(s.workerPath||PMe())){try{s.workerPath?(Oe.log(`loading Web Worker ${s.workerPath} for "${i}"`),this.workerContext=RMe(s.workerPath)):(Oe.log(`injecting Web Worker for "${i}"`),this.workerContext=DMe()),this.onwmsg=u=>this.onWorkerMessage(u);const{worker:h}=this.workerContext;h.addEventListener("message",this.onwmsg),h.onerror=u=>{const d=new Error(`${u.message}  (${u.filename}:${u.lineno})`);s.enableWorker=!1,Oe.warn(`Error in "${i}" Web Worker, fallback to inline`),this.hls.trigger(ee.ERROR,{type:oi.OTHER_ERROR,details:je.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})},h.postMessage({cmd:"init",typeSupported:l,vendor:"",id:i,config:JSON.stringify(s)})}catch(h){Oe.warn(`Error setting up "${i}" Web Worker, fallback to inline`,h),this.resetWorker(),this.error=null,this.transmuxer=new D9(this.observer,l,s,"",i)}return}this.transmuxer=new D9(this.observer,l,s,"",i)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:i}=this.workerContext;i&&self.URL.revokeObjectURL(i),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const i=this.transmuxer;i&&(i.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,i,r,n,s,a,o,l,c,h){var u,d;c.transmuxing.start=self.performance.now();const{transmuxer:f}=this,p=a?a.start:s.start,m=s.decryptdata,g=this.frag,v=!(g&&s.cc===g.cc),y=!(g&&c.level===g.level),x=g?c.sn-g.sn:-1,S=this.part?c.part-this.part.index:-1,A=x===0&&c.id>1&&c.id===(g==null?void 0:g.stats.chunkCount),_=!y&&(x===1||x===0&&(S===1||A&&S<=0)),M=self.performance.now();(y||x||s.stats.parsing.start===0)&&(s.stats.parsing.start=M),a&&(S||!_)&&(a.stats.parsing.start=M);const E=!(g&&((u=s.initSegment)==null?void 0:u.url)===((d=g.initSegment)==null?void 0:d.url)),T=new cTe(v,_,l,y,p,E);if(!_||v||E){Oe.log(`[transmuxer-interface, ${s.type}]: Starting new transmux session for sn: ${c.sn} p: ${c.part} level: ${c.level} id: ${c.id}
        discontinuity: ${v}
        trackSwitch: ${y}
        contiguous: ${_}
        accurateTimeOffset: ${l}
        timeOffset: ${p}
        initSegmentChange: ${E}`);const C=new lTe(r,n,i,o,h);this.configureTransmuxer(C)}if(this.frag=s,this.part=a,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:m,chunkMeta:c,state:T},e instanceof ArrayBuffer?[e]:[]);else if(f){const C=f.push(e,m,c,T);sC(C)?(f.async=!0,C.then(D=>{this.handleTransmuxComplete(D)}).catch(D=>{this.transmuxerError(D,c,"transmuxer-interface push error")})):(f.async=!1,this.handleTransmuxComplete(C))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(i){let r=i.flush(e);sC(r)||i.async?(sC(r)||(r=Promise.resolve(r)),r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")})):this.handleFlushResult(r,e)}}transmuxerError(e,i,r){this.hls&&(this.error=e,this.hls.trigger(ee.ERROR,{type:oi.MEDIA_ERROR,details:je.FRAG_PARSING_ERROR,chunkMeta:i,frag:this.frag||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,i){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(i)}onWorkerMessage(e){const i=e.data;if(!(i!=null&&i.event)){Oe.warn(`worker message received with no ${i?"event name":"data"}`);return}const r=this.hls;if(this.hls)switch(i.event){case"init":{var n;const s=(n=this.workerContext)==null?void 0:n.objectURL;s&&self.URL.revokeObjectURL(s);break}case"transmuxComplete":{this.handleTransmuxComplete(i.data);break}case"flush":{this.onFlush(i.data);break}case"workerLog":Oe[i.data.logType]&&Oe[i.data.logType](i.data.message);break;default:{i.data=i.data||{},i.data.frag=this.frag,i.data.id=this.id,r.trigger(i.event,i.data);break}}}configureTransmuxer(e){const{transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}function Tne(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!r1(t[i].attrs,e[i].attrs))return!1;return!0}function r1(t,e,i){const r=t["STABLE-RENDITION-ID"];return r&&!i?r===e["STABLE-RENDITION-ID"]:!(i||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>t[n]!==e[n])}function Sk(t,e){return e.label.toLowerCase()===t.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(t.lang||"").toLowerCase())}const R9=100;class Cne extends _D{constructor(e,i,r){super(e,i,r,"[audio-stream-controller]",Jt.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ee.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ee.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(ee.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(ee.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(ee.ERROR,this.onError,this),e.on(ee.BUFFER_RESET,this.onBufferReset,this),e.on(ee.BUFFER_CREATED,this.onBufferCreated,this),e.on(ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(ee.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(ee.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(ee.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ee.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ee.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(ee.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(ee.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(ee.ERROR,this.onError,this),e.off(ee.BUFFER_RESET,this.onBufferReset,this),e.off(ee.BUFFER_CREATED,this.onBufferCreated,this),e.off(ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(ee.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(ee.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(ee.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:i,id:r,initPTS:n,timescale:s}){if(r==="main"){const a=i.cc;this.initPTS[i.cc]={baseTime:n,timescale:s},this.log(`InitPTS for cc: ${a} found from main: ${n}`),this.videoTrackCC=a,this.state===ct.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=ct.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(R9),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=ct.IDLE):(this.loadedmetadata=!1,this.state=ct.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case ct.IDLE:this.doTickIdle();break;case ct.WAITING_TRACK:{var e;const{levels:r,trackId:n}=this,s=r==null||(e=r[n])==null?void 0:e.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=ct.WAITING_INIT_PTS}break}case ct.FRAG_LOADING_WAITING_RETRY:{var i;const r=performance.now(),n=this.retryDate;if(!n||r>=n||(i=this.media)!=null&&i.seeking){const{levels:s,trackId:a}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((s==null?void 0:s[a])||null),this.state=ct.IDLE}break}case ct.WAITING_INIT_PTS:{const r=this.waitingData;if(r){const{frag:n,part:s,cache:a,complete:o}=r;if(this.initPTS[n.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=ct.FRAG_LOADING;const l=a.flush(),c={frag:n,part:s,payload:l,networkDetails:null};this._handleFragmentLoadProgress(c),o&&super._handleFragmentLoadComplete(c)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${n.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const l=this.getLoadPosition(),c=wr.bufferInfo(this.mediaBuffer,l,this.config.maxBufferHole);bk(c.end,this.config.maxFragLookUpTolerance,n)<0&&(this.log(`Waiting fragment cc (${n.cc}) @ ${n.start} cancelled because another fragment at ${c.end} is needed`),this.clearWaitingFragment())}}else this.state=ct.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=ct.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:i,media:r,trackId:n}=this,s=e.config;if(!r&&(this.startFragRequested||!s.startFragPrefetch)||!(i!=null&&i[n]))return;const a=i[n],o=a.details;if(!o||o.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(o)){this.state=ct.WAITING_TRACK;return}const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,ir.AUDIO,Jt.AUDIO));const c=this.getFwdBufferInfo(l,Jt.AUDIO);if(c===null)return;const{bufferedTrack:h,switchingTrack:u}=this;if(!u&&this._streamEnded(c,o)){e.trigger(ee.BUFFER_EOS,{type:"audio"}),this.state=ct.ENDED;return}const d=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Jt.MAIN),f=c.len,p=this.getMaxBufferLength(d==null?void 0:d.len),m=o.fragments,g=m[0].start;let v=this.flushing?this.getLoadPosition():c.end;if(u&&r){const A=this.getLoadPosition();h&&!r1(u.attrs,h.attrs)&&(v=A),o.PTSKnown&&A<g&&(c.end>g||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=g+.05)}if(f>=p&&!u&&v<m[m.length-1].start)return;let y=this.getNextFragment(v,o),x=!1;if(y&&this.isLoopLoading(y,v)&&(x=!!y.gap,y=this.getNextFragmentLoopLoading(y,o,c,Jt.MAIN,p)),!y){this.bufferFlushed=!0;return}const S=d&&y.start>d.end+o.targetduration;if(S||!(d!=null&&d.len)&&c.len){const A=this.getAppendedFrag(y.start,Jt.MAIN);if(A===null||(x||(x=!!A.gap||!!S&&d.len===0),S&&!x||x&&c.nextStart&&c.nextStart<A.end))return}this.loadFragment(y,a,v)}getMaxBufferLength(e){const i=super.getMaxBufferLength();return e?Math.min(Math.max(i,e),this.config.maxMaxBufferLength):i}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:i}){this.resetTransmuxer(),this.levels=i.map(r=>new Ug(r))}onAudioTrackSwitching(e,i){const r=!!i.url;this.trackId=i.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),r?this.setInterval(R9):this.resetTransmuxer(),r?(this.switchingTrack=i,this.state=ct.IDLE,this.flushAudioIfNeeded(i)):(this.switchingTrack=null,this.bufferedTrack=i,this.state=ct.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,i){this.mainDetails=i.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(ee.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,i){var r;if(this.mainDetails==null){this.cachedTrackLoadedData=i;return}const{levels:n}=this,{details:s,id:a}=i;if(!n){this.warn(`Audio tracks were reset while loading level ${a}`);return}this.log(`Audio track ${a} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const o=n[a];let l=0;if(s.live||(r=o.details)!=null&&r.live){this.checkLiveUpdate(s);const h=this.mainDetails;if(s.deltaUpdateFailed||!h)return;if(!o.details&&s.hasProgramDateTime&&h.hasProgramDateTime)v2(s,h),l=s.fragments[0].start;else{var c;l=this.alignPlaylists(s,o.details,(c=this.levelLastLoaded)==null?void 0:c.details)}}o.details=s,this.levelLastLoaded=o,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(this.mainDetails||s,l),this.state===ct.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=ct.IDLE),this.tick()}_handleFragmentLoadProgress(e){var i;const{frag:r,part:n,payload:s}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const c=l[o];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const h=c.details;if(!h){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const u=a.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let d=this.transmuxer;d||(d=this.transmuxer=new Mne(this.hls,Jt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const f=this.initPTS[r.cc],p=(i=r.initSegment)==null?void 0:i.data;if(f!==void 0){const g=n?n.index:-1,v=g!==-1,y=new SD(r.level,r.sn,r.stats.chunkCount,s.byteLength,g,v);d.push(s,p,u,"",r,n,h.totalduration,!1,y,f)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${h.startSN} ,${h.endSN}],track ${o}`);const{cache:m}=this.waitingData=this.waitingData||{frag:r,part:n,cache:new hne,complete:!1};m.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=ct.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,i){const r=i.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),i.tracks.video&&(this.videoBuffer=i.tracks.video.buffer||null)}onFragBuffered(e,i){const{frag:r,part:n}=i;if(r.type!==Jt.AUDIO){if(!this.loadedmetadata&&r.type===Jt.MAIN){const s=this.videoBuffer||this.media;s&&wr.getBuffered(s).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${n?" p: "+n.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(r.sn!=="initSegment"){this.fragPrevious=r;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(ee.AUDIO_TRACK_SWITCHED,Is({},s)))}this.fragBufferedComplete(r,n)}onError(e,i){var r;if(i.fatal){this.state=ct.ERROR;return}switch(i.details){case je.FRAG_GAP:case je.FRAG_PARSING_ERROR:case je.FRAG_DECRYPT_ERROR:case je.FRAG_LOAD_ERROR:case je.FRAG_LOAD_TIMEOUT:case je.KEY_LOAD_ERROR:case je.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Jt.AUDIO,i);break;case je.AUDIO_TRACK_LOAD_ERROR:case je.AUDIO_TRACK_LOAD_TIMEOUT:case je.LEVEL_PARSING_ERROR:!i.levelRetry&&this.state===ct.WAITING_TRACK&&((r=i.context)==null?void 0:r.type)===ki.AUDIO_TRACK&&(this.state=ct.IDLE);break;case je.BUFFER_APPEND_ERROR:case je.BUFFER_FULL_ERROR:if(!i.parent||i.parent!=="audio")return;if(i.details===je.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(i)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case je.INTERNAL_EXCEPTION:this.recoverWorkerError(i);break}}onBufferFlushing(e,{type:i}){i!==ir.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:i}){if(i!==ir.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ct.ENDED&&(this.state=ct.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,i,Jt.AUDIO),this.tick())}}_handleTransmuxComplete(e){var i;const r="audio",{hls:n}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:c,level:h}=o,{details:u}=h,{audio:d,text:f,id3:p,initSegment:m}=s;if(this.fragContextChanged(l)||!u){this.fragmentTracker.removeFragment(l);return}if(this.state=ct.PARSING,this.switchingTrack&&d&&this.completeAudioSwitch(this.switchingTrack),m!=null&&m.tracks){const g=l.initSegment||l;this._bufferInitSegment(h,m.tracks,g,a),n.trigger(ee.FRAG_PARSING_INIT_SEGMENT,{frag:g,id:r,tracks:m.tracks})}if(d){const{startPTS:g,endPTS:v,startDTS:y,endDTS:x}=d;c&&(c.elementaryStreams[ir.AUDIO]={startPTS:g,endPTS:v,startDTS:y,endDTS:x}),l.setElementaryStreamInfo(ir.AUDIO,g,v,y,x),this.bufferFragmentData(d,l,c,a)}if(p!=null&&(i=p.samples)!=null&&i.length){const g=zn({id:r,frag:l,details:u},p);n.trigger(ee.FRAG_PARSING_METADATA,g)}if(f){const g=zn({id:r,frag:l,details:u},f);n.trigger(ee.FRAG_PARSING_USERDATA,g)}}_bufferInitSegment(e,i,r,n){if(this.state!==ct.PARSING)return;i.video&&delete i.video;const s=i.audio;if(!s)return;s.id="audio";const a=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${a}/${s.codec}]`),a&&a.split(",").length===1&&(s.levelCodec=a),this.hls.trigger(ee.BUFFER_CODECS,i);const o=s.initSegment;if(o!=null&&o.byteLength){const l={type:"audio",frag:r,part:null,chunkMeta:n,parent:r.type,data:o};this.hls.trigger(ee.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,i,r){const n=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||n===bs.NOT_LOADED||n===bs.PARTIAL){var s;if(e.sn==="initSegment")this._loadInitSegment(e,i);else if((s=i.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ct.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragments[0].start!==i.details.fragments[0].start&&v2(i.details,a)}else this.startFragRequested=!0,super.loadFragment(e,i,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){const{media:i,bufferedTrack:r}=this,n=r==null?void 0:r.attrs,s=e.attrs;i&&n&&(n.CHANNELS!==s.CHANNELS||r.name!==e.name||r.lang!==e.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(e){const{hls:i}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,i.trigger(ee.AUDIO_TRACK_SWITCHED,Is({},e))}}class Pne extends wD{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ee.LEVEL_LOADING,this.onLevelLoading,this),e.on(ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(ee.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(ee.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ee.LEVEL_LOADING,this.onLevelLoading,this),e.off(ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(ee.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(ee.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,i){this.tracks=i.audioTracks||[]}onAudioTrackLoaded(e,i){const{id:r,groupId:n,details:s}=i,a=this.tracksInGroup[r];if(!a||a.groupId!==n){this.warn(`Audio track with id:${r} and group:${n} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=i.details,this.log(`Audio track ${r} "${a.name}" lang:${a.lang} group:${n} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,i,o)}onLevelLoading(e,i){this.switchLevel(i.level)}onLevelSwitching(e,i){this.switchLevel(i.level)}switchLevel(e){const i=this.hls.levels[e];if(!i)return;const r=i.audioGroups||null,n=this.groupIds;let s=this.currentTrack;if(!r||(n==null?void 0:n.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(n==null?void 0:n.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(d=>!r||r.indexOf(d.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(d=>d.default)&&(this.selectDefaultTrack=!1),o.forEach((d,f)=>{d.id=f});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.audioPreference;if(!s&&l){const d=Eh(l,o,X0);if(d>-1)s=o[d];else{const f=Eh(l,this.tracks);s=this.tracks[f]}}let c=this.findTrackId(s);c===-1&&s&&(c=this.findTrackId(null));const h={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(ee.AUDIO_TRACKS_UPDATED,h);const u=this.trackId;if(c!==-1&&u===-1)this.setAudioTrack(c);else if(o.length&&u===-1){var a;const d=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(d.message),this.hls.trigger(ee.ERROR,{type:oi.MEDIA_ERROR,details:je.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:d})}}else this.shouldReloadPlaylist(s)&&this.setAudioTrack(this.trackId)}onError(e,i){i.fatal||!i.context||i.context.type===ki.AUDIO_TRACK&&i.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(i.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(i))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const i=this.hls;if(i.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const n=this.currentTrack;if(n&&Ey(e,n,X0))return n;const s=Eh(e,this.tracksInGroup,X0);if(s>-1){const a=this.tracksInGroup[s];return this.setAudioTrack(s),a}else if(n){let a=i.loadLevel;a===-1&&(a=i.firstAutoLevel);const o=fMe(e,i.levels,r,a,X0);if(o===-1)return null;i.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=Eh(e,r);if(a>-1)return r[a]}}}return null}setAudioTrack(e){const i=this.tracksInGroup;if(e<0||e>=i.length){this.warn(`Invalid audio track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,n=i[e],s=n.details&&!n.details.live;if(e===this.trackId&&n===r&&s||(this.log(`Switching to audio-track ${e} "${n.name}" lang:${n.lang} group:${n.groupId} channels:${n.channels}`),this.trackId=e,this.currentTrack=n,this.hls.trigger(ee.AUDIO_TRACK_SWITCHING,Is({},n)),s))return;const a=this.switchParams(n.url,r==null?void 0:r.details,n.details);this.loadPlaylist(a)}findTrackId(e){const i=this.tracksInGroup;for(let r=0;r<i.length;r++){const n=i[r];if(!(this.selectDefaultTrack&&!n.default)&&(!e||Ey(e,n,X0)))return r}if(e){const{name:r,lang:n,assocLang:s,characteristics:a,audioCodec:o,channels:l}=e;for(let c=0;c<i.length;c++){const h=i[c];if(Ey({name:r,lang:n,assocLang:s,characteristics:a,audioCodec:o,channels:l},h,X0))return c}for(let c=0;c<i.length;c++){const h=i[c];if(r1(e.attrs,h.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<i.length;c++){const h=i[c];if(r1(e.attrs,h.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){const i=this.currentTrack;if(this.shouldLoadPlaylist(i)&&i){super.loadPlaylist();const r=i.id,n=i.groupId;let s=i.url;if(e)try{s=e.addDirectives(s)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}this.log(`loading audio-track playlist ${r} "${i.name}" lang:${i.lang} group:${n}`),this.clearTimer(),this.hls.trigger(ee.AUDIO_TRACK_LOADING,{url:s,id:r,groupId:n,deliveryDirectives:e||null})}}}const I9=500;class Dne extends _D{constructor(e,i,r){super(e,i,r,"[subtitle-stream-controller]",Jt.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ee.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ee.ERROR,this.onError,this),e.on(ee.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(ee.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(ee.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(ee.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(ee.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ee.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ee.ERROR,this.onError,this),e.off(ee.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(ee.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(ee.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(ee.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(ee.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=ct.IDLE,this.setInterval(I9),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,i){this.mainDetails=i.details}onSubtitleFragProcessed(e,i){const{frag:r,success:n}=i;if(this.fragPrevious=r,this.state=ct.IDLE,!n)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let a;const o=r.start;for(let c=0;c<s.length;c++)if(o>=s[c].start&&o<=s[c].end){a=s[c];break}const l=r.start+r.duration;a?a.end=l:(a={start:o,end:l},s.push(a)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null)}onBufferFlushing(e,i){const{startOffset:r,endOffset:n}=i;if(r===0&&n!==Number.POSITIVE_INFINITY){const s=n-1;if(s<=0)return;i.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=s){a.shift();continue}else if(a[o].start<s)a[o].start=s;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(r,s,Jt.SUBTITLE)}}onFragBuffered(e,i){if(!this.loadedmetadata&&i.frag.type===Jt.MAIN){var r;(r=this.media)!=null&&r.buffered.length&&(this.loadedmetadata=!0)}}onError(e,i){const r=i.frag;(r==null?void 0:r.type)===Jt.SUBTITLE&&(i.details===je.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ct.STOPPED&&(this.state=ct.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:i}){if(this.levels&&Tne(this.levels,i)){this.levels=i.map(r=>new Ug(r));return}this.tracksBuffered=[],this.levels=i.map(r=>{const n=new Ug(r);return this.tracksBuffered[n.id]=[],n}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Jt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,i){var r;if(this.currentTrackId=i.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.setInterval(I9)}onSubtitleTrackLoaded(e,i){var r;const{currentTrackId:n,levels:s}=this,{details:a,id:o}=i;if(!s){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const l=s[o];if(o>=s.length||!l)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(a.live||(r=l.details)!=null&&r.live){const u=this.mainDetails;if(a.deltaUpdateFailed||!u)return;const d=u.fragments[0];if(!l.details)a.hasProgramDateTime&&u.hasProgramDateTime?(v2(a,u),c=a.fragments[0].start):d&&(c=d.start,xk(a,c));else{var h;c=this.alignPlaylists(a,l.details,(h=this.levelLastLoaded)==null?void 0:h.details),c===0&&d&&(c=d.start,xk(a,c))}}l.details=a,this.levelLastLoaded=l,o===n&&(!this.startFragRequested&&(this.mainDetails||!a.live)&&this.setStartPosition(this.mainDetails||a,c),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===ct.IDLE&&(g2(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:i,payload:r}=e,n=i.decryptdata,s=this.hls;if(!this.fragContextChanged(i)&&r&&r.byteLength>0&&n!=null&&n.key&&n.iv&&n.method==="AES-128"){const a=performance.now();this.decrypter.decrypt(new Uint8Array(r),n.key.buffer,n.iv.buffer).catch(o=>{throw s.trigger(ee.ERROR,{type:oi.MEDIA_ERROR,details:je.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:i}),o}).then(o=>{const l=performance.now();s.trigger(ee.FRAG_DECRYPTED,{frag:i,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=ct.IDLE})}}doTick(){if(!this.media){this.state=ct.IDLE;return}if(this.state===ct.IDLE){const{currentTrackId:e,levels:i}=this,r=i==null?void 0:i[e];if(!r||!i.length||!r.details)return;const{config:n}=this,s=this.getLoadPosition(),a=wr.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,n.maxBufferHole),{end:o,len:l}=a,c=this.getFwdBufferInfo(this.media,Jt.MAIN),h=r.details,u=this.getMaxBufferLength(c==null?void 0:c.len)+h.levelTargetDuration;if(l>u)return;const d=h.fragments,f=d.length,p=h.edge;let m=null;const g=this.fragPrevious;if(o<p){const v=n.maxFragLookUpTolerance,y=o>p-v?0:v;m=g2(g,d,Math.max(d[0].start,o),y),!m&&g&&g.start<d[0].start&&(m=d[0])}else m=d[f-1];if(!m)return;if(m=this.mapToInitFragWhenRequired(m),m.sn!=="initSegment"){const v=m.sn-h.startSN,y=d[v-1];y&&y.cc===m.cc&&this.fragmentTracker.getState(y)===bs.NOT_LOADED&&(m=y)}this.fragmentTracker.getState(m)===bs.NOT_LOADED&&this.loadFragment(m,r,o)}}getMaxBufferLength(e){const i=super.getMaxBufferLength();return e?Math.max(i,e):i}loadFragment(e,i,r){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,i):(this.startFragRequested=!0,super.loadFragment(e,i,r))}get mediaBufferTimeRanges(){return new uTe(this.tracksBuffered[this.currentTrackId]||[])}}class uTe{constructor(e){this.buffered=void 0;const i=(r,n,s)=>{if(n=n>>>0,n>s-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${s})`);return e[n][r]};this.buffered={get length(){return e.length},end(r){return i("end",r,e.length)},start(r){return i("start",r,e.length)}}}}class Rne extends wD{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let i=null;const r=tC(this.media.textTracks);for(let s=0;s<r.length;s++)if(r[s].mode==="hidden")i=r[s];else if(r[s].mode==="showing"){i=r[s];break}const n=this.findTrackForTextTrack(i);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ee.LEVEL_LOADING,this.onLevelLoading,this),e.on(ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(ee.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(ee.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ee.LEVEL_LOADING,this.onLevelLoading,this),e.off(ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(ee.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(ee.ERROR,this.onError,this)}onMediaAttached(e,i){this.media=i.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),tC(this.media.textTracks).forEach(i=>{ty(i)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,i){this.tracks=i.subtitleTracks}onSubtitleTrackLoaded(e,i){const{id:r,groupId:n,details:s}=i,a=this.tracksInGroup[r];if(!a||a.groupId!==n){this.warn(`Subtitle track with id:${r} and group:${n} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=i.details,this.log(`Subtitle track ${r} "${a.name}" lang:${a.lang} group:${n} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,i,o)}onLevelLoading(e,i){this.switchLevel(i.level)}onLevelSwitching(e,i){this.switchLevel(i.level)}switchLevel(e){const i=this.hls.levels[e];if(!i)return;const r=i.subtitleGroups||null,n=this.groupIds;let s=this.currentTrack;if(!r||(n==null?void 0:n.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(n==null?void 0:n.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(h=>!r||r.indexOf(h.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(h=>h.default)&&(this.selectDefaultTrack=!1),a.forEach((h,u)=>{h.id=u});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!s&&o){this.selectDefaultTrack=!1;const h=Eh(o,a);if(h>-1)s=a[h];else{const u=Eh(o,this.tracks);s=this.tracks[u]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const c={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(ee.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}else this.shouldReloadPlaylist(s)&&this.setSubtitleTrack(this.trackId)}findTrackId(e){const i=this.tracksInGroup,r=this.selectDefaultTrack;for(let n=0;n<i.length;n++){const s=i[n];if(!(r&&!s.default||!r&&!e)&&(!e||Ey(s,e)))return n}if(e){for(let n=0;n<i.length;n++){const s=i[n];if(r1(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<i.length;n++){const s=i[n];if(r1(e.attrs,s.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const i=this.tracksInGroup;for(let r=0;r<i.length;r++){const n=i[r];if(Sk(n,e))return r}}return-1}onError(e,i){i.fatal||!i.context||i.context.type===ki.SUBTITLE_TRACK&&i.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(i.context.groupId)!==-1)&&this.checkRetry(i)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){const i=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,i.length){const r=this.currentTrack;if(r&&Ey(e,r))return r;const n=Eh(e,this.tracksInGroup);if(n>-1){const s=this.tracksInGroup[n];return this.setSubtitleTrack(n),s}else{if(r)return null;{const s=Eh(e,i);if(s>-1)return i[s]}}}}return null}loadPlaylist(e){super.loadPlaylist();const i=this.currentTrack;if(this.shouldLoadPlaylist(i)&&i){const r=i.id,n=i.groupId;let s=i.url;if(e)try{s=e.addDirectives(s)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}this.log(`Loading subtitle playlist for id ${r}`),this.hls.trigger(ee.SUBTITLE_TRACK_LOADING,{url:s,id:r,groupId:n,deliveryDirectives:e||null})}}toggleTrackModes(){const{media:e}=this;if(!e)return;const i=tC(e.textTracks),r=this.currentTrack;let n;if(r&&(n=i.filter(s=>Sk(r,s))[0],n||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(i).forEach(s=>{s.mode!=="disabled"&&s!==n&&(s.mode="disabled")}),n){const s=this.subtitleDisplay?"showing":"hidden";n.mode!==s&&(n.mode=s)}}setSubtitleTrack(e){const i=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=i.length||!Bt(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,n=i[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),!n){this.hls.trigger(ee.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!n.details&&!n.details.live;if(e===this.trackId&&n===r&&s)return;this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:""));const{id:a,groupId:o="",name:l,type:c,url:h}=n;this.hls.trigger(ee.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:c,url:h});const u=this.switchParams(n.url,r==null?void 0:r.details,n.details);this.loadPlaylist(u)}}class dTe{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,i,r){const n=this.queues[i];n.push(e),n.length===1&&!r&&this.executeNext(i)}insertAbort(e,i){this.queues[i].unshift(e),this.executeNext(i)}appendBlocker(e){let i;const r=new Promise(s=>{i=s}),n={execute:i,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(n,e),r}executeNext(e){const i=this.queues[e];if(i.length){const r=i[0];try{r.execute()}catch(n){Oe.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${n}`),r.onError(n);const s=this.buffers[e];s!=null&&s.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const L9=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class Ine{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=r=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:r,mediaSource:n}=this;this.log("Media source opened"),r&&(r.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(ee.MEDIA_ATTACHED,{media:r,mediaSource:n})),n&&n.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:n}=this;r!==n&&Oe.error(`Media element src was set while attaching MediaSource (${n} > ${r})`)},this.hls=e;const i="[buffer-controller]";this.appendSource=CEe(gp(e.config.preferManagedMediaSource)),this.log=Oe.log.bind(Oe,i),this.warn=Oe.warn.bind(Oe,i),this.error=Oe.error.bind(Oe,i),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:e}=this;e.on(ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ee.BUFFER_RESET,this.onBufferReset,this),e.on(ee.BUFFER_APPENDING,this.onBufferAppending,this),e.on(ee.BUFFER_CODECS,this.onBufferCodecs,this),e.on(ee.BUFFER_EOS,this.onBufferEos,this),e.on(ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(ee.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(ee.FRAG_PARSED,this.onFragParsed,this),e.on(ee.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ee.BUFFER_RESET,this.onBufferReset,this),e.off(ee.BUFFER_APPENDING,this.onBufferAppending,this),e.off(ee.BUFFER_CODECS,this.onBufferCodecs,this),e.off(ee.BUFFER_EOS,this.onBufferEos,this),e.off(ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(ee.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(ee.FRAG_PARSED,this.onFragParsed,this),e.off(ee.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new dTe(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,i){let r=2;(i.audio&&!i.video||!i.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,i){const r=this.media=i.media,n=gp(this.appendSource);if(r&&n){var s;const a=this.mediaSource=new n;this.log(`created media source: ${(s=a.constructor)==null?void 0:s.name}`),a.addEventListener("sourceopen",this._onMediaSourceOpen),a.addEventListener("sourceended",this._onMediaSourceEnded),a.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.addEventListener("startstreaming",this._onStartStreaming),a.addEventListener("endstreaming",this._onEndStreaming));const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{r.removeAttribute("src");const l=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||l&&a instanceof l,O9(r),fTe(r,o),r.load()}catch{r.src=o}else r.src=o;r.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:i,_objectUrl:r}=this;if(i){if(this.log("media source detaching"),i.readyState==="open")try{i.endOfStream()}catch(n){this.warn(`onMediaDetaching: ${n.message} while calling endOfStream`)}this.onBufferReset(),i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),this.mediaSrc===r?(e.removeAttribute("src"),this.appendSource&&O9(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(ee.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{this.resetBuffer(e)}),this._initSourceBuffer()}resetBuffer(e){const i=this.sourceBuffer[e];try{if(i){var r;this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}}catch(n){this.warn(`onBufferReset ${e}`,n)}}onBufferCodecs(e,i){const r=this.getSourceBufferTypes().length,n=Object.keys(i);if(n.forEach(a=>{if(r){const l=this.tracks[a];if(l&&typeof l.buffer.changeType=="function"){var o;const{id:c,codec:h,levelCodec:u,container:d,metadata:f}=i[a],p=i9(l.codec,l.levelCodec),m=p==null?void 0:p.replace(L9,"$1");let g=i9(h,u);const v=(o=g)==null?void 0:o.replace(L9,"$1");if(g&&m!==v){a.slice(0,5)==="audio"&&(g=d2(g,this.appendSource));const y=`${d};codecs=${g}`;this.appendChangeType(a,y),this.log(`switching codec ${p} to ${g}`),this.tracks[a]={buffer:l.buffer,codec:h,container:d,levelCodec:u,metadata:f,id:c}}}}else this.pendingTracks[a]=i[a]}),r)return;const s=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==s&&(this.log(`${s} bufferCodec event(s) expected ${n.join(",")}`),this.bufferCodecEventsExpected=s),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(e,i){const{operationQueue:r}=this,n={execute:()=>{const s=this.sourceBuffer[e];s&&(this.log(`changing ${e} sourceBuffer type to ${i}`),s.changeType(i)),r.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:s=>{this.warn(`Failed to change ${e} SourceBuffer type`,s)}};r.append(n,e,!!this.pendingTracks[e])}onBufferAppending(e,i){const{hls:r,operationQueue:n,tracks:s}=this,{data:a,type:o,frag:l,part:c,chunkMeta:h}=i,u=h.buffering[o],d=self.performance.now();u.start=d;const f=l.stats.buffering,p=c?c.stats.buffering:null;f.start===0&&(f.start=d),p&&p.start===0&&(p.start=d);const m=s.audio;let g=!1;o==="audio"&&(m==null?void 0:m.container)==="audio/mpeg"&&(g=!this.lastMpegAudioChunk||h.id===1||this.lastMpegAudioChunk.sn!==h.sn,this.lastMpegAudioChunk=h);const v=l.start,y={execute:()=>{if(u.executeStart=self.performance.now(),g){const x=this.sourceBuffer[o];if(x){const S=v-x.timestampOffset;Math.abs(S)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${v} (delta: ${S}) sn: ${l.sn})`),x.timestampOffset=v)}}this.appendExecutor(a,o)},onStart:()=>{},onComplete:()=>{const x=self.performance.now();u.executeEnd=u.end=x,f.first===0&&(f.first=x),p&&p.first===0&&(p.first=x);const{sourceBuffer:S}=this,A={};for(const _ in S)A[_]=wr.getBuffered(S[_]);this.appendErrors[o]=0,o==="audio"||o==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(ee.BUFFER_APPENDED,{type:o,frag:l,part:c,chunkMeta:h,parent:l.type,timeRanges:A})},onError:x=>{const S={type:oi.MEDIA_ERROR,parent:l.type,details:je.BUFFER_APPEND_ERROR,sourceBufferName:o,frag:l,part:c,chunkMeta:h,error:x,err:x,fatal:!1};if(x.code===DOMException.QUOTA_EXCEEDED_ERR)S.details=je.BUFFER_FULL_ERROR;else{const A=++this.appendErrors[o];S.details=je.BUFFER_APPEND_ERROR,this.warn(`Failed ${A}/${r.config.appendErrorMaxRetry} times to append segment in "${o}" sourceBuffer`),A>=r.config.appendErrorMaxRetry&&(S.fatal=!0)}r.trigger(ee.ERROR,S)}};n.append(y,o,!!this.pendingTracks[o])}onBufferFlushing(e,i){const{operationQueue:r}=this,n=s=>({execute:this.removeExecutor.bind(this,s,i.startOffset,i.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(ee.BUFFER_FLUSHED,{type:s})},onError:a=>{this.warn(`Failed to remove from ${s} SourceBuffer`,a)}});i.type?r.append(n(i.type),i.type):this.getSourceBufferTypes().forEach(s=>{r.append(n(s),s)})}onFragParsed(e,i){const{frag:r,part:n}=i,s=[],a=n?n.elementaryStreams:r.elementaryStreams;a[ir.AUDIOVIDEO]?s.push("audiovideo"):(a[ir.AUDIO]&&s.push("audio"),a[ir.VIDEO]&&s.push("video"));const o=()=>{const l=self.performance.now();r.stats.buffering.end=l,n&&(n.stats.buffering.end=l);const c=n?n.stats:r.stats;this.hls.trigger(ee.FRAG_BUFFERED,{frag:r,part:n,stats:c,id:r.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(o,s)}onFragChanged(e,i){this.trimBuffers()}onBufferEos(e,i){this.getSourceBufferTypes().reduce((n,s)=>{const a=this.sourceBuffer[s];return a&&(!i.type||i.type===s)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${s} sourceBuffer now EOS`))),n&&!!(!a||a.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(s=>{const a=this.sourceBuffer[s];a&&(a.ending=!1)});const{mediaSource:n}=this;if(!n||n.readyState!=="open"){n&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${n.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),n.endOfStream()}))}onLevelUpdated(e,{details:i}){i.fragments.length&&(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:e,details:i,media:r}=this;if(!r||i===null||!this.getSourceBufferTypes().length)return;const s=e.config,a=r.currentTime,o=i.levelTargetDuration,l=i.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(Bt(l)&&l>0){const c=Math.max(l,o),h=Math.floor(a/o)*o-c;this.flushBackBuffer(a,o,h)}if(Bt(s.frontBufferFlushThreshold)&&s.frontBufferFlushThreshold>0){const c=Math.max(s.maxBufferLength,s.frontBufferFlushThreshold),h=Math.max(c,o),u=Math.floor(a/o)*o+h;this.flushFrontBuffer(a,o,u)}}flushBackBuffer(e,i,r){const{details:n,sourceBuffer:s}=this;this.getSourceBufferTypes().forEach(o=>{const l=s[o];if(l){const c=wr.getBuffered(l);if(c.length>0&&r>c.start(0)){if(this.hls.trigger(ee.BACK_BUFFER_REACHED,{bufferEnd:r}),n!=null&&n.live)this.hls.trigger(ee.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(l.ended&&c.end(c.length-1)-e<i*2){this.log(`Cannot flush ${o} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(ee.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:o})}}})}flushFrontBuffer(e,i,r){const{sourceBuffer:n}=this;this.getSourceBufferTypes().forEach(a=>{const o=n[a];if(o){const l=wr.getBuffered(o),c=l.length;if(c<2)return;const h=l.start(c-1),u=l.end(c-1);if(r>h||e>=h&&e<=u)return;if(o.ended&&e-u<2*i){this.log(`Cannot flush ${a} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(ee.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:a})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:e,hls:i,media:r,mediaSource:n}=this,s=e.fragments[0].start+e.totalduration,a=r.duration,o=Bt(n.duration)?n.duration:0;e.live&&i.config.liveDurationInfinity?(n.duration=1/0,this.updateSeekableRange(e)):(s>o&&s>a||!Bt(a))&&(this.log(`Updating Media Source duration to ${s.toFixed(3)}`),n.duration=s)}updateSeekableRange(e){const i=this.mediaSource,r=e.fragments;if(r.length&&e.live&&i!=null&&i.setLiveSeekableRange){const s=Math.max(0,r[0].start),a=Math.max(s,s+e.totalduration);this.log(`Media Source duration is set to ${i.duration}. Setting seekable range to ${s}-${a}.`),i.setLiveSeekableRange(s,a)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:i,pendingTracks:r}=this,n=Object.keys(r).length;if(n&&(!e||n===2||"audiovideo"in r)){this.createSourceBuffers(r),this.pendingTracks={};const s=this.getSourceBufferTypes();if(s.length)this.hls.trigger(ee.BUFFER_CREATED,{tracks:this.tracks}),s.forEach(a=>{i.executeNext(a)});else{const a=new Error("could not create source buffer for media codec(s)");this.hls.trigger(ee.ERROR,{type:oi.MEDIA_ERROR,details:je.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:a,reason:a.message})}}}createSourceBuffers(e){const{sourceBuffer:i,mediaSource:r}=this;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(const s in e)if(!i[s]){var n;const a=e[s];if(!a)throw Error(`source buffer exists for track ${s}, however track does not`);let o=((n=a.levelCodec)==null?void 0:n.indexOf(","))===-1?a.levelCodec:a.codec;o&&s.slice(0,5)==="audio"&&(o=d2(o,this.appendSource));const l=`${a.container};codecs=${o}`;this.log(`creating sourceBuffer(${l})`);try{const c=i[s]=r.addSourceBuffer(l),h=s;this.addBufferListener(h,"updatestart",this._onSBUpdateStart),this.addBufferListener(h,"updateend",this._onSBUpdateEnd),this.addBufferListener(h,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(h,"bufferedchange",(u,d)=>{const f=d.removedRanges;f!=null&&f.length&&this.hls.trigger(ee.BUFFER_FLUSHED,{type:s})}),this.tracks[s]={buffer:c,codec:o,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id}}catch(c){this.error(`error while trying to add sourceBuffer: ${c.message}`),this.hls.trigger(ee.ERROR,{type:oi.MEDIA_ERROR,details:je.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:s,mimeType:l})}}}get mediaSrc(){var e,i;const r=((e=this.media)==null||(i=e.querySelector)==null?void 0:i.call(e,"source"))||this.media;return r==null?void 0:r.src}_onSBUpdateStart(e){const{operationQueue:i}=this;i.current(e).onStart()}_onSBUpdateEnd(e){var i;if(((i=this.mediaSource)==null?void 0:i.readyState)==="closed"){this.resetBuffer(e);return}const{operationQueue:r}=this;r.current(e).onComplete(),r.shiftAndExecuteNext(e)}_onSBUpdateError(e,i){var r;const n=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${n}`,i),this.hls.trigger(ee.ERROR,{type:oi.MEDIA_ERROR,details:je.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});const s=this.operationQueue.current(e);s&&s.onError(n)}removeExecutor(e,i,r){const{media:n,mediaSource:s,operationQueue:a,sourceBuffer:o}=this,l=o[e];if(!n||!s||!l){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),a.shiftAndExecuteNext(e);return}const c=Bt(n.duration)?n.duration:1/0,h=Bt(s.duration)?s.duration:1/0,u=Math.max(0,i),d=Math.min(r,c,h);d>u&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${u},${d}] from the ${e} SourceBuffer`),l.remove(u,d)):a.shiftAndExecuteNext(e)}appendExecutor(e,i){const r=this.sourceBuffer[i];if(!r){if(!this.pendingTracks[i])throw new Error(`Attempting to append to the ${i} SourceBuffer, but it does not exist`);return}r.ended=!1,r.appendBuffer(e)}blockBuffers(e,i=this.getSourceBufferTypes()){if(!i.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}const{operationQueue:r}=this,n=i.map(s=>r.appendBlocker(s));Promise.all(n).then(()=>{e(),i.forEach(s=>{const a=this.sourceBuffer[s];a!=null&&a.updating||r.shiftAndExecuteNext(s)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,i,r){const n=this.sourceBuffer[e];if(!n)return;const s=r.bind(this,e);this.listeners[e].push({event:i,listener:s}),n.addEventListener(i,s)}removeBufferListeners(e){const i=this.sourceBuffer[e];i&&this.listeners[e].forEach(r=>{i.removeEventListener(r.event,r.listener)})}}function O9(t){const e=t.querySelectorAll("source");[].slice.call(e).forEach(i=>{t.removeChild(i)})}function fTe(t,e){const i=self.document.createElement("source");i.type="video/mp4",i.src=e,t.appendChild(i)}const pTe={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Lne=t=>String.fromCharCode(pTe[t]||t),mc=15,uu=100,mTe={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},gTe={17:2,18:4,21:6,22:8,23:10,19:13,20:15},vTe={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},yTe={25:2,26:4,29:6,30:8,31:10,27:13,28:15},xTe=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class bTe{constructor(){this.time=null,this.verboseLevel=0}log(e,i){if(this.verboseLevel>=e){const r=typeof i=="function"?i():i;Oe.log(`${this.time} [${e}] ${r}`)}}}const nm=function(e){const i=[];for(let r=0;r<e.length;r++)i.push(e[r].toString(16));return i};class One{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const i=["foreground","underline","italics","background","flash"];for(let r=0;r<i.length;r++){const n=i[r];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class wTe{constructor(){this.uchar=" ",this.penState=new One}reset(){this.uchar=" ",this.penState.reset()}setChar(e,i){this.uchar=e,this.penState.copy(i)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class STe{constructor(e){this.chars=[],this.pos=0,this.currPenState=new One,this.cueStartTime=null,this.logger=void 0;for(let i=0;i<uu;i++)this.chars.push(new wTe);this.logger=e}equals(e){for(let i=0;i<uu;i++)if(!this.chars[i].equals(e.chars[i]))return!1;return!0}copy(e){for(let i=0;i<uu;i++)this.chars[i].copy(e.chars[i])}isEmpty(){let e=!0;for(let i=0;i<uu;i++)if(!this.chars[i].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>uu&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=uu)}moveCursor(e){const i=this.pos+e;if(e>1)for(let r=this.pos+1;r<i+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(i)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const i=Lne(e);if(this.pos>=uu){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+i+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(i,this.currPenState),this.moveCursor(1)}clearFromPos(e){let i;for(i=e;i<uu;i++)this.chars[i].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let i=!0;for(let r=0;r<uu;r++){const n=this.chars[r].uchar;n!==" "&&(i=!1),e.push(n)}return i?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class XL{constructor(e){this.rows=[],this.currRow=mc-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let i=0;i<mc;i++)this.rows.push(new STe(e));this.logger=e}reset(){for(let e=0;e<mc;e++)this.rows[e].clear();this.currRow=mc-1}equals(e){let i=!0;for(let r=0;r<mc;r++)if(!this.rows[r].equals(e.rows[r])){i=!1;break}return i}copy(e){for(let i=0;i<mc;i++)this.rows[i].copy(e.rows[i])}isEmpty(){let e=!0;for(let i=0;i<mc;i++)if(!this.rows[i].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let i=e.row-1;if(this.nrRollUpRows&&i<this.nrRollUpRows-1&&(i=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==i){for(let o=0;o<mc;o++)this.rows[o].clear();const s=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[s].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[i-this.nrRollUpRows+c+1].copy(a.rows[s+c])}}this.currRow=i;const r=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,a=Math.max(s-1,0);r.setCursor(e.indent),e.color=r.chars[a].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,i=this.rows.splice(e,1)[0];i.clear(),this.rows.splice(this.currRow,0,i),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const i=[];let r="",n=-1;for(let s=0;s<mc;s++){const a=this.rows[s].getTextString();a&&(n=s+1,e?i.push("Row "+n+": '"+a+"'"):i.push(a.trim()))}return i.length>0&&(e?r="["+i.join(" | ")+"]":r=i.join(`
`)),r}getTextAndFormat(){return this.rows}}class B9{constructor(e,i,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=i,this.mode=null,this.verbose=0,this.displayedMemory=new XL(r),this.nonDisplayedMemory=new XL(r),this.lastOutputScreen=new XL(r),this.currRollUpRow=this.displayedMemory.rows[mc-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[mc-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>i+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const i={flash:!1};if(i.underline=e%2===1,i.italics=e>=46,i.italics)i.foreground="white";else{const r=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];i.foreground=n[r]}this.logger.log(2,"MIDROW: "+JSON.stringify(i)),this.writeScreen.setPen(i)}outputDataUpdate(e=!1){const i=this.logger.time;i!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=i:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,i,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:i),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class F9{constructor(e,i,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=ATe(),this.logger=void 0;const n=this.logger=new bTe;this.channels=[null,new B9(e,i,n),new B9(e+1,r,n)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,i){this.channels[e].setHandler(i)}addData(e,i){this.logger.time=e;for(let r=0;r<i.length;r+=2){const n=i[r]&127,s=i[r+1]&127;let a=!1,o=null;if(n===0&&s===0)continue;this.logger.log(3,()=>"["+nm([i[r],i[r+1]])+"] -> ("+nm([n,s])+")");const l=this.cmdHistory;if(n>=16&&n<=31){if(_Te(n,s,l)){JE(null,null,l),this.logger.log(3,()=>"Repeated command ("+nm([n,s])+") is dropped");continue}JE(n,s,this.cmdHistory),a=this.parseCmd(n,s),a||(a=this.parseMidrow(n,s)),a||(a=this.parsePAC(n,s)),a||(a=this.parseBackgroundAttributes(n,s))}else JE(null,null,l);if(!a&&(o=this.parseChars(n,s),o)){const h=this.currentChannel;h&&h>0?this.channels[h].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+nm([n,s])+" orig: "+nm([i[r],i[r+1]]))}}parseCmd(e,i){const r=(e===20||e===28||e===21||e===29)&&i>=32&&i<=47,n=(e===23||e===31)&&i>=33&&i<=35;if(!(r||n))return!1;const s=e===20||e===21||e===23?1:2,a=this.channels[s];return e===20||e===21||e===28||e===29?i===32?a.ccRCL():i===33?a.ccBS():i===34?a.ccAOF():i===35?a.ccAON():i===36?a.ccDER():i===37?a.ccRU(2):i===38?a.ccRU(3):i===39?a.ccRU(4):i===40?a.ccFON():i===41?a.ccRDC():i===42?a.ccTR():i===43?a.ccRTD():i===44?a.ccEDM():i===45?a.ccCR():i===46?a.ccENM():i===47&&a.ccEOC():a.ccTO(i-32),this.currentChannel=s,!0}parseMidrow(e,i){let r=0;if((e===17||e===25)&&i>=32&&i<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[r];return n?(n.ccMIDROW(i),this.logger.log(3,()=>"MIDROW ("+nm([e,i])+")"),!0):!1}return!1}parsePAC(e,i){let r;const n=(e>=17&&e<=23||e>=25&&e<=31)&&i>=64&&i<=127,s=(e===16||e===24)&&i>=64&&i<=95;if(!(n||s))return!1;const a=e<=23?1:2;i>=64&&i<=95?r=a===1?mTe[e]:vTe[e]:r=a===1?gTe[e]:yTe[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(r,i)),this.currentChannel=a,!0):!1}interpretPAC(e,i){let r;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return i>95?r=i-96:r=i-64,n.underline=(r&1)===1,r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=Math.floor((r-16)/2)*4,n}parseChars(e,i){let r,n=null,s=null;if(e>=25?(r=2,s=e-8):(r=1,s=e),s>=17&&s<=19){let a;s===17?a=i+80:s===18?a=i+112:a=i+144,this.logger.log(2,()=>"Special char '"+Lne(a)+"' in channel "+r),n=[a]}else e>=32&&e<=127&&(n=i===0?[e]:[e,i]);return n&&this.logger.log(3,()=>"Char codes =  "+nm(n).join(",")),n}parseBackgroundAttributes(e,i){const r=(e===16||e===24)&&i>=32&&i<=47,n=(e===23||e===31)&&i>=45&&i<=47;if(!(r||n))return!1;let s;const a={};e===16||e===24?(s=Math.floor((i-32)/2),a.background=xTe[s],i%2===1&&(a.background=a.background+"_semi")):i===45?a.background="transparent":(a.foreground="black",i===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const i=this.channels[e];i&&i.reset()}JE(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let i=0;i<this.channels.length;i++){const r=this.channels[i];r&&r.cueSplitAtTime(e)}}}function JE(t,e,i){i.a=t,i.b=e}function _Te(t,e,i){return i.a===t&&i.b===e}function ATe(){return{a:null,b:null}}class ZE{constructor(e,i){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=i}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,i,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=i,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var y5=function(){if(t1!=null&&t1.VTTCue)return self.VTTCue;const t=["","lr","rl"],e=["start","middle","end","left","right"];function i(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const c=l.toLowerCase();return~o.indexOf(c)?c:!1}function r(o){return i(t,o)}function n(o){return i(e,o)}function s(o,...l){let c=1;for(;c<arguments.length;c++){const h=arguments[c];for(const u in h)o[u]=h[u]}return o}function a(o,l,c){const h=this,u={enumerable:!0};h.hasBeenReset=!1;let d="",f=!1,p=o,m=l,g=c,v=null,y="",x=!0,S="auto",A="start",_=50,M="middle",E=50,T="middle";Object.defineProperty(h,"id",s({},u,{get:function(){return d},set:function(C){d=""+C}})),Object.defineProperty(h,"pauseOnExit",s({},u,{get:function(){return f},set:function(C){f=!!C}})),Object.defineProperty(h,"startTime",s({},u,{get:function(){return p},set:function(C){if(typeof C!="number")throw new TypeError("Start time must be set to a number.");p=C,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",s({},u,{get:function(){return m},set:function(C){if(typeof C!="number")throw new TypeError("End time must be set to a number.");m=C,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",s({},u,{get:function(){return g},set:function(C){g=""+C,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",s({},u,{get:function(){return v},set:function(C){v=C,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",s({},u,{get:function(){return y},set:function(C){const D=r(C);if(D===!1)throw new SyntaxError("An invalid or illegal string was specified.");y=D,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",s({},u,{get:function(){return x},set:function(C){x=!!C,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",s({},u,{get:function(){return S},set:function(C){if(typeof C!="number"&&C!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");S=C,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",s({},u,{get:function(){return A},set:function(C){const D=n(C);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");A=D,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",s({},u,{get:function(){return _},set:function(C){if(C<0||C>100)throw new Error("Position must be between 0 and 100.");_=C,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",s({},u,{get:function(){return M},set:function(C){const D=n(C);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");M=D,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",s({},u,{get:function(){return E},set:function(C){if(C<0||C>100)throw new Error("Size must be between 0 and 100.");E=C,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",s({},u,{get:function(){return T},set:function(C){const D=n(C);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");T=D,this.hasBeenReset=!0}})),h.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class ETe{decode(e,i){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Bne(t){function e(r,n,s,a){return(r|0)*3600+(n|0)*60+(s|0)+parseFloat(a||0)}const i=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return i?parseFloat(i[2])>59?e(i[2],i[3],0,i[4]):e(i[1],i[2],i[3],i[4]):null}class MTe{constructor(){this.values=Object.create(null)}set(e,i){!this.get(e)&&i!==""&&(this.values[e]=i)}get(e,i,r){return r?this.has(e)?this.values[e]:i[r]:this.has(e)?this.values[e]:i}has(e){return e in this.values}alt(e,i,r){for(let n=0;n<r.length;++n)if(i===r[n]){this.set(e,i);break}}integer(e,i){/^-?\d+$/.test(i)&&this.set(e,parseInt(i,10))}percent(e,i){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(i)){const r=parseFloat(i);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function Fne(t,e,i,r){const n=r?t.split(r):[t];for(const s in n){if(typeof n[s]!="string")continue;const a=n[s].split(i);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const _k=new y5(0,0,""),eM=_k.align==="middle"?"middle":"center";function TTe(t,e,i){const r=t;function n(){const o=Bne(t);if(o===null)throw new Error("Malformed timestamp: "+r);return t=t.replace(/^[^\sa-zA-Z-]+/,""),o}function s(o,l){const c=new MTe;Fne(o,function(d,f){let p;switch(d){case"region":for(let m=i.length-1;m>=0;m--)if(i[m].id===f){c.set(d,i[m].region);break}break;case"vertical":c.alt(d,f,["rl","lr"]);break;case"line":p=f.split(","),c.integer(d,p[0]),c.percent(d,p[0])&&c.set("snapToLines",!1),c.alt(d,p[0],["auto"]),p.length===2&&c.alt("lineAlign",p[1],["start",eM,"end"]);break;case"position":p=f.split(","),c.percent(d,p[0]),p.length===2&&c.alt("positionAlign",p[1],["start",eM,"end","line-left","line-right","auto"]);break;case"size":c.percent(d,f);break;case"align":c.alt(d,f,["start",eM,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let h=c.get("line","auto");h==="auto"&&_k.line===-1&&(h=-1),l.line=h,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",eM);let u=c.get("position","auto");u==="auto"&&_k.position===50&&(u=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=u}function a(){t=t.replace(/^\s+/,"")}if(a(),e.startTime=n(),a(),t.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);t=t.slice(3),a(),e.endTime=n(),a(),s(t,e)}function kne(t){return t.replace(/<br(?: \/)?>/gi,`
`)}class CTe{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new ETe,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const i=this;e&&(i.buffer+=i.decoder.decode(e,{stream:!0}));function r(){let s=i.buffer,a=0;for(s=kne(s);a<s.length&&s[a]!=="\r"&&s[a]!==`
`;)++a;const o=s.slice(0,a);return s[a]==="\r"&&++a,s[a]===`
`&&++a,i.buffer=s.slice(a),o}function n(s){Fne(s,function(a,o){},/:/)}try{let s="";if(i.state==="INITIAL"){if(!/\r\n|\n/.test(i.buffer))return this;s=r();const o=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");i.state="HEADER"}let a=!1;for(;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(a?a=!1:s=r(),i.state){case"HEADER":/:/.test(s)?n(s):s||(i.state="ID");continue;case"NOTE":s||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){i.state="NOTE";break}if(!s)continue;if(i.cue=new y5(0,0,""),i.state="CUE",s.indexOf("-->")===-1){i.cue.id=s;continue}case"CUE":if(!i.cue){i.state="BADCUE";continue}try{TTe(s,i.cue,i.regionList)}catch{i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":{const o=s.indexOf("-->")!==-1;if(!s||o&&(a=!0)){i.oncue&&i.cue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}if(i.cue===null)continue;i.cue.text&&(i.cue.text+=`
`),i.cue.text+=s}continue;case"BADCUE":s||(i.state="ID")}}}catch{i.state==="CUETEXT"&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state=i.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(i){e.onparsingerror&&e.onparsingerror(i)}return e.onflush&&e.onflush(),this}}const PTe=/\r\n|\n\r|\n|\r/g,YL=function(e,i,r=0){return e.slice(r,r+i.length)===i},DTe=function(e){let i=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Bt(i)||!Bt(r)||!Bt(n)||!Bt(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return i+=1e3*r,i+=60*1e3*n,i+=60*60*1e3*s,i},qL=function(e){let i=5381,r=e.length;for(;r;)i=i*33^e.charCodeAt(--r);return(i>>>0).toString()};function x5(t,e,i){return qL(t.toString())+qL(e.toString())+qL(i)}const RTe=function(e,i,r){let n=e[i],s=e[n.prevCC];if(!s||!s.new&&n.new){e.ccOffset=e.presentationOffset=n.start,n.new=!1;return}for(;(a=s)!=null&&a.new;){var a;e.ccOffset+=n.start-s.start,n.new=!1,n=s,s=e[n.prevCC]}e.presentationOffset=r};function ITe(t,e,i,r,n,s,a){const o=new CTe,l=Ih(new Uint8Array(t)).trim().replace(PTe,`
`).split(`
`),c=[],h=e?eTe(e.baseTime,e.timescale):0;let u="00:00.000",d=0,f=0,p,m=!0;o.oncue=function(g){const v=i[r];let y=i.ccOffset;const x=(d-h)/9e4;if(v!=null&&v.new&&(f!==void 0?y=i.ccOffset=v.start:RTe(i,r,x)),x){if(!e){p=new Error("Missing initPTS for VTT MPEGTS");return}y=x-i.presentationOffset}const S=g.endTime-g.startTime,A=Sl((g.startTime+y-f)*9e4,n*9e4)/9e4;g.startTime=Math.max(A,0),g.endTime=Math.max(A+S,0);const _=g.text.trim();g.text=decodeURIComponent(encodeURIComponent(_)),g.id||(g.id=x5(g.startTime,g.endTime,_)),g.endTime>0&&c.push(g)},o.onparsingerror=function(g){p=g},o.onflush=function(){if(p){a(p);return}s(c)},l.forEach(g=>{if(m)if(YL(g,"X-TIMESTAMP-MAP=")){m=!1,g.slice(16).split(",").forEach(v=>{YL(v,"LOCAL:")?u=v.slice(6):YL(v,"MPEGTS:")&&(d=parseInt(v.slice(7)))});try{f=DTe(u)/1e3}catch(v){p=v}return}else g===""&&(m=!1);o.parse(g+`
`)}),o.flush()}const KL="stpp.ttml.im1t",Nne=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Une=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,LTe={left:"start",center:"center",right:"end",start:"start",end:"end"};function k9(t,e,i,r){const n=yi(new Uint8Array(t),["mdat"]);if(n.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const s=n.map(o=>Ih(o)),a=ZMe(e.baseTime,1,e.timescale);try{s.forEach(o=>i(OTe(o,a)))}catch(o){r(o)}}function OTe(t,e){const n=new DOMParser().parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((u,d)=>(u[d]=n.getAttribute(`ttp:${d}`)||s[d],u),{}),o=n.getAttribute("xml:space")!=="preserve",l=N9(QL(n,"styling","style")),c=N9(QL(n,"layout","region")),h=QL(n,"body","[begin]");return[].map.call(h,u=>{const d=zne(u,o);if(!d||!u.hasAttribute("begin"))return null;const f=JL(u.getAttribute("begin"),a),p=JL(u.getAttribute("dur"),a);let m=JL(u.getAttribute("end"),a);if(f===null)throw U9(u);if(m===null){if(p===null)throw U9(u);m=f+p}const g=new y5(f-e,m-e,d);g.id=x5(g.startTime,g.endTime,g.text);const v=c[u.getAttribute("region")],y=l[u.getAttribute("style")],x=BTe(v,y,l),{textAlign:S}=x;if(S){const A=LTe[S];A&&(g.lineAlign=A),g.align=S}return zn(g,x),g}).filter(u=>u!==null)}function QL(t,e,i){const r=t.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(i)):[]}function N9(t){return t.reduce((e,i)=>{const r=i.getAttribute("xml:id");return r&&(e[r]=i),e},{})}function zne(t,e){return[].slice.call(t.childNodes).reduce((i,r,n)=>{var s;return r.nodeName==="br"&&n?i+`
`:(s=r.childNodes)!=null&&s.length?zne(r,e):e?i+r.textContent.trim().replace(/\s+/g," "):i+r.textContent},"")}function BTe(t,e,i){const r="http://www.w3.org/ns/ttml#styling";let n=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=t!=null&&t.hasAttribute("style")?t.getAttribute("style"):null;return a&&i.hasOwnProperty(a)&&(n=i[a]),s.reduce((o,l)=>{const c=$L(e,r,l)||$L(t,r,l)||$L(n,r,l);return c&&(o[l]=c),o},{})}function $L(t,e,i){return t&&t.hasAttributeNS(e,i)?t.getAttributeNS(e,i):null}function U9(t){return new Error(`Could not parse ttml timestamp ${t}`)}function JL(t,e){if(!t)return null;let i=Bne(t);return i===null&&(Nne.test(t)?i=FTe(t,e):Une.test(t)&&(i=kTe(t,e))),i}function FTe(t,e){const i=Nne.exec(t),r=(i[4]|0)+(i[5]|0)/e.subFrameRate;return(i[1]|0)*3600+(i[2]|0)*60+(i[3]|0)+r/e.frameRate}function kTe(t,e){const i=Une.exec(t),r=Number(i[1]);switch(i[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Gne{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=G9(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(ee.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(ee.FRAG_LOADING,this.onFragLoading,this),e.on(ee.FRAG_LOADED,this.onFragLoaded,this),e.on(ee.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(ee.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(ee.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(ee.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(ee.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(ee.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(ee.FRAG_LOADING,this.onFragLoading,this),e.off(ee.FRAG_LOADED,this.onFragLoaded,this),e.off(ee.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(ee.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(ee.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(ee.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(ee.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const e=new ZE(this,"textTrack1"),i=new ZE(this,"textTrack2"),r=new ZE(this,"textTrack3"),n=new ZE(this,"textTrack4");this.cea608Parser1=new F9(1,e,i),this.cea608Parser2=new F9(3,r,n)}}addCues(e,i,r,n,s){let a=!1;for(let o=s.length;o--;){const l=s[o],c=NTe(l[0],l[1],i,r);if(c>=0&&(l[0]=Math.min(l[0],i),l[1]=Math.max(l[1],r),a=!0,c/(r-i)>.5))return}if(a||s.push([i,r]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,i,r,n)}else{const o=this.Cues.newCue(null,i,r,n);this.hls.trigger(ee.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:i,id:r,initPTS:n,timescale:s}){const{unparsedVttFrags:a}=this;r==="main"&&(this.initPTS[i.cc]={baseTime:n,timescale:s}),a.length&&(this.unparsedVttFrags=[],a.forEach(o=>{this.onFragLoaded(ee.FRAG_LOADED,o)}))}getExistingTrack(e,i){const{media:r}=this;if(r)for(let n=0;n<r.textTracks.length;n++){const s=r.textTracks[n];if(z9(s,{name:e,lang:i,attrs:{}}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:i,captionsTracks:r,media:n}=this,{label:s,languageCode:a}=i[e],o=this.getExistingTrack(s,a);if(o)r[e]=o,ty(r[e]),Zre(r[e],n);else{const l=this.createTextTrack("captions",s,a);l&&(l[e]=!0,r[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const i=this.captionsProperties[e];if(!i)return;const r=i.label,n={_id:e,label:r,kind:"captions",default:i.media?!!i.media.default:!1,closedCaptions:i.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(ee.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,i,r){const n=this.media;if(n)return n.addTextTrack(e,i,r)}onMediaAttaching(e,i){this.media=i.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(i=>{ty(e[i]),delete e[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=G9(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const i=e.textTracks;if(i)for(let r=0;r<i.length;r++)ty(i[r])}onSubtitleTracksUpdated(e,i){const r=i.subtitleTracks||[],n=r.some(s=>s.textCodec===KL);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(Tne(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const a=this.media,o=a?tC(a.textTracks):null;if(this.tracks.forEach((l,c)=>{let h;if(o){let u=null;for(let d=0;d<o.length;d++)if(o[d]&&z9(o[d],l)){u=o[d],o[d]=null;break}u&&(h=u)}if(h)ty(h);else{const u=Vne(l);h=this.createTextTrack(u,l.name,l.lang),h&&(h.mode="disabled")}h&&this.textTracks.push(h)}),o!=null&&o.length){const l=o.filter(c=>c!==null).map(c=>c.label);l.length&&Oe.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(ee.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,i){this.config.enableCEA708Captions&&i.captions&&i.captions.forEach(r=>{const n=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!n)return;const s=`textTrack${n[1]}`,a=this.captionsProperties[s];a&&(a.label=r.name,r.lang&&(a.languageCode=r.lang),a.media=r)})}closedCaptionsForLevel(e){const i=this.hls.levels[e.level];return i==null?void 0:i.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,i){if(this.enabled&&i.frag.type===Jt.MAIN){var r,n;const{cea608Parser1:s,cea608Parser2:a,lastSn:o}=this,{cc:l,sn:c}=i.frag,h=(r=(n=i.part)==null?void 0:n.index)!=null?r:-1;s&&a&&(c!==o+1||c===o&&h!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),a.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=h}}onFragLoaded(e,i){const{frag:r,payload:n}=i;if(r.type===Jt.SUBTITLE)if(n.byteLength){const s=r.decryptdata,a="stats"in i;if(s==null||!s.encrypted||a){const o=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),o&&o.textCodec===KL?this._parseIMSC1(r,n):this._parseVTTs(i)}}else this.hls.trigger(ee.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,i){const r=this.hls;k9(i,this.initPTS[e.cc],n=>{this._appendCues(n,e.level),r.trigger(ee.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},n=>{Oe.log(`Failed to parse IMSC1: ${n}`),r.trigger(ee.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})})}_parseVTTs(e){var i;const{frag:r,payload:n}=e,{initPTS:s,unparsedVttFrags:a}=this,o=s.length-1;if(!s[r.cc]&&o===-1){a.push(e);return}const l=this.hls,c=(i=r.initSegment)!=null&&i.data?jl(r.initSegment.data,new Uint8Array(n)):n;ITe(c,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,h=>{this._appendCues(h,r.level),l.trigger(ee.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},h=>{const u=h.message==="Missing initPTS for VTT MPEGTS";u?a.push(e):this._fallbackToIMSC1(r,n),Oe.log(`Failed to parse VTT cue: ${h}`),!(u&&o>r.cc)&&l.trigger(ee.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:h})})}_fallbackToIMSC1(e,i){const r=this.tracks[e.level];r.textCodec||k9(i,this.initPTS[e.cc],()=>{r.textCodec=KL,this._parseIMSC1(e,i)},()=>{r.textCodec="wvtt"})}_appendCues(e,i){const r=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[i];if(!n||n.mode==="disabled")return;e.forEach(s=>ene(n,s))}else{const n=this.tracks[i];if(!n)return;const s=n.default?"default":"subtitles"+i;r.trigger(ee.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,i){const{frag:r}=i;r.type===Jt.SUBTITLE&&this.onFragLoaded(ee.FRAG_LOADED,i)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,i){this.initCea608Parsers();const{cea608Parser1:r,cea608Parser2:n}=this;if(!this.enabled||!r||!n)return;const{frag:s,samples:a}=i;if(!(s.type===Jt.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let o=0;o<a.length;o++){const l=a[o].bytes;if(l){const c=this.extractCea608Data(l);r.addData(a[o].pts,c[0]),n.addData(a[o].pts,c[1])}}}onBufferFlushing(e,{startOffset:i,endOffset:r,endOffsetSubtitles:n,type:s}){const{media:a}=this;if(!(!a||a.currentTime<r)){if(!s||s==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>mk(o[l],i,r))}if(this.config.renderTextTracksNatively&&i===0&&n!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>mk(o[l],i,n))}}}extractCea608Data(e){const i=[[],[]],r=e[0]&31;let n=2;for(let s=0;s<r;s++){const a=e[n++],o=127&e[n++],l=127&e[n++];if(o===0&&l===0)continue;if((4&a)!==0){const h=3&a;(h===0||h===1)&&(i[h].push(o),i[h].push(l))}}return i}}function Vne(t){return t.characteristics&&/transcribes-spoken-dialog/gi.test(t.characteristics)&&/describes-music-and-sound/gi.test(t.characteristics)?"captions":"subtitles"}function z9(t,e){return!!t&&t.kind===Vne(e)&&Sk(e,t)}function NTe(t,e,i,r){return Math.min(e,r)-Math.max(t,i)}function G9(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class AD{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(ee.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(ee.BUFFER_CODECS,this.onBufferCodecs,this),e.on(ee.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(ee.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(ee.BUFFER_CODECS,this.onBufferCodecs,this),e.off(ee.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,i){const r=this.hls.levels[i.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,i){this.media=i.media instanceof HTMLVideoElement?i.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,i){const r=this.hls;this.restrictedLevels=[],this.firstLevel=i.firstLevel,r.config.capLevelToPlayerSize&&i.video&&this.startCapping()}onLevelsUpdated(e,i){this.timer&&Bt(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,i){this.hls.config.capLevelToPlayerSize&&i.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const i=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&Oe.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),i.autoLevelCapping=r,i.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=i.autoLevelCapping}}}getMaxLevel(e){const i=this.hls.levels;if(!i.length)return-1;const r=i.filter((n,s)=>this.isLevelAllowed(n)&&s<=e);return this.clientRect=null,AD.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,i={width:0,height:0};if(e){const r=e.getBoundingClientRect();i.width=r.width,i.height=r.height,!i.width&&!i.height&&(i.width=r.right-r.left||e.width||0,i.height=r.bottom-r.top||e.height||0)}return this.clientRect=i,i}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,i,r){if(!(e!=null&&e.length))return-1;const n=(o,l)=>l?o.width!==l.width||o.height!==l.height:!0;let s=e.length-1;const a=Math.max(i,r);for(let o=0;o<e.length;o+=1){const l=e[o];if((l.width>=a||l.height>=a)&&n(l,e[o+1])){s=o;break}}return s}}class Hne{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(ee.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(ee.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,i){const r=this.hls.config;if(r.capLevelOnFPSDrop){const n=i.media instanceof self.HTMLVideoElement?i.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}checkFPS(e,i,r){const n=performance.now();if(i){if(this.lastTime){const s=n-this.lastTime,a=r-this.lastDroppedFrames,o=i-this.lastDecodedFrames,l=1e3*a/s,c=this.hls;if(c.trigger(ee.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:r}),l>0&&a>c.config.fpsDroppedMonitoringThreshold*o){let h=c.currentLevel;Oe.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=h)&&(h=h-1,c.trigger(ee.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:c.currentLevel}),c.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=r,this.lastDecodedFrames=i}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const i=e.getVideoPlaybackQuality();this.checkFPS(e,i.totalVideoFrames,i.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}const tM="[eme]";class pg{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=pg.CDMCleanupPromise?[pg.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=Oe.debug.bind(Oe,tM),this.log=Oe.log.bind(Oe,tM),this.warn=Oe.warn.bind(Oe,tM),this.error=Oe.error.bind(Oe,tM),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(ee.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(ee.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(ee.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(ee.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(ee.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(ee.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(ee.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(ee.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:i,widevineLicenseUrl:r}=this.config,n=i[e];if(n)return n.licenseUrl;if(e===gr.WIDEVINE&&r)return r;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:i}=this.config,r=i[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const i=this.hls.levels,r=(a,o,l)=>!!a&&l.indexOf(a)===o,n=i.map(a=>a.audioCodec).filter(r),s=i.map(a=>a.videoCodec).filter(r);return n.length+s.length===0&&s.push("avc1.42e01e"),new Promise((a,o)=>{const l=c=>{const h=c.shift();this.getMediaKeysPromise(h,n,s).then(u=>a({keySystem:h,mediaKeys:u})).catch(u=>{c.length?l(c):u instanceof ol?o(u):o(new ol({type:oi.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_NO_ACCESS,error:u,fatal:!0},u.message))})};l(e)})}requestMediaKeySystemAccess(e,i){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let n=`Configured requestMediaKeySystemAccess is not a function ${r}`;return zre===null&&self.location.protocol==="http:"&&(n=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(n))}return r(e,i)}getMediaKeysPromise(e,i,r){const n=ZAe(e,i,r,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e];let a=s==null?void 0:s.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(n)}`),a=this.requestMediaKeySystemAccess(e,n);const o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),a.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const c=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),o.mediaKeys=l.createMediaKeys().then(h=>(this.log(`Media-keys created for "${e}"`),c.then(u=>u?this.setMediaKeysServerCertificate(h,e,u):h))),o.mediaKeys.catch(h=>{this.error(`Failed to create media-keys for "${e}"}: ${h}`)}),o.mediaKeys})}return a.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:i,mediaKeys:r}){this.log(`Creating key-system session "${i}" keyId: ${dh.hexDump(e.keyId||[])}`);const n=r.createSession(),s={decryptdata:e,keySystem:i,mediaKeys:r,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const i=e.decryptdata;if(i.pssh){const r=this.createMediaKeySessionContext(e),n=this.getKeyIdString(i),s="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(r,s,i.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return dh.hexDump(e.keyId)}updateKeySession(e,i){var r;const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyID ${dh.hexDump(((r=e.decryptdata)==null?void 0:r.keyId)||[])}
      } (data length: ${i&&i.byteLength})`),n.update(i)}selectKeySystemFormat(e){const i=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((i,r)=>{const n=OL(this.config),s=e.map(qW).filter(a=>!!a&&n.indexOf(a)!==-1);return this.getKeySystemSelectionPromise(s).then(({keySystem:a})=>{const o=QW(a);o?i(o):r(new Error(`Unable to find format for key-system "${a}"`))}).catch(r)})}loadKey(e){const i=e.keyInfo.decryptdata,r=this.getKeyIdString(i),n=`(keyId: ${r} format: "${i.keyFormat}" method: ${i.method} uri: ${i.uri})`;this.log(`Starting session for key ${n}`);let s=this.keyIdToKeySessionPromise[r];return s||(s=this.keyIdToKeySessionPromise[r]=this.getKeySystemForKeyPromise(i).then(({keySystem:a,mediaKeys:o})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${n}`),this.attemptSetMediaKeys(a,o).then(()=>{this.throwIfDestroyed();const l=this.createMediaKeySessionContext({keySystem:a,mediaKeys:o,decryptdata:i});return this.generateRequestWithPreferredKeySession(l,"cenc",i.pssh,"playlist-key")}))),s.catch(a=>this.handleError(a))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof ol?this.hls.trigger(ee.ERROR,e.data):this.hls.trigger(ee.ERROR,{type:oi.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const i=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[i];if(!r){const n=qW(e.keyFormat),s=n?[n]:OL(this.config);return this.attemptKeySystemAccess(s)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=OL(this.config)),e.length===0)throw new ol({type:oi.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:i,initData:r}=e,n=`"${e.type}" event: init data type: "${i}"`;if(this.debug(n),r===null)return;let s,a;if(i==="sinf"&&this.config.drmSystems[gr.FAIRPLAY]){const u=Kn(new Uint8Array(r));try{const d=l5(JSON.parse(u).sinf),f=qre(new Uint8Array(d));if(!f)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");s=f.subarray(8,24),a=gr.FAIRPLAY}catch(d){this.warn(`${n} Failed to parse sinf: ${d}`);return}}else{const u=AEe(r),d=u.filter(f=>f.systemId===Rb.WIDEVINE)[0];if(!d){u.length===0||u.some(f=>!f.systemId)?this.warn(`${n} contains incomplete or invalid pssh data`):this.log(`ignoring ${n} for ${u.map(f=>KW(f.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(a=KW(d.systemId),d.version===0&&d.data){const f=d.data.length-22;s=d.data.subarray(f,f+16)}}if(!a||!s)return;const o=dh.hexDump(s),{keyIdToKeySessionPromise:l,mediaKeySessions:c}=this;let h=l[o];for(let u=0;u<c.length;u++){const d=c[u],f=d.decryptdata;if(!f.keyId)continue;const p=dh.hexDump(f.keyId);if(o===p||f.uri.replace(/-/g,"").indexOf(o)!==-1){if(h=l[p],f.pssh)break;delete l[p],f.pssh=new Uint8Array(r),f.keyId=s,h=l[o]=h.then(()=>this.generateRequestWithPreferredKeySession(d,i,r,"encrypted-event-key-match"));break}}h||(h=l[o]=this.getKeySystemSelectionPromise([a]).then(({keySystem:u,mediaKeys:d})=>{var f;this.throwIfDestroyed();const p=new i1("ISO-23001-7",o,(f=QW(u))!=null?f:"");return p.pssh=new Uint8Array(r),p.keyId=s,this.attemptSetMediaKeys(u,d).then(()=>{this.throwIfDestroyed();const m=this.createMediaKeySessionContext({decryptdata:p,keySystem:u,mediaKeys:d});return this.generateRequestWithPreferredKeySession(m,i,r,"encrypted-event-no-match")})})),h.catch(u=>this.handleError(u))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,i){const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const n=Promise.all(r).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(i)});return this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>r.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,i,r,n){var s,a;const o=(s=this.config.drmSystems)==null||(a=s[e.keySystem])==null?void 0:a.generateRequest;if(o)try{const p=o.call(this.hls,i,r,e);if(!p)throw new Error("Invalid response from configured generateRequest filter");i=p.initDataType,r=e.decryptdata.pssh=p.initData?new Uint8Array(p.initData):null}catch(p){var l;if(this.warn(p.message),(l=this.hls)!=null&&l.config.debug)throw p}if(r===null)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(e);const c=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${n}": ${c} (init data type: ${i} length: ${r?r.byteLength:null})`);const h=new v5,u=e._onmessage=p=>{const m=e.mediaKeysSession;if(!m){h.emit("error",new Error("invalid state"));return}const{messageType:g,message:v}=p;this.log(`"${g}" message event for session "${m.sessionId}" message size: ${v.byteLength}`),g==="license-request"||g==="license-renewal"?this.renewLicense(e,v).catch(y=>{this.handleError(y),h.emit("error",y)}):g==="license-release"?e.keySystem===gr.FAIRPLAY&&(this.updateKeySession(e,fk("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${g}"`)},d=e._onkeystatuseschange=p=>{if(!e.mediaKeysSession){h.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const g=e.keyStatus;h.emit("keyStatus",g),g==="expired"&&(this.warn(`${e.keySystem} expired for key ${c}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",u),e.mediaKeysSession.addEventListener("keystatuseschange",d);const f=new Promise((p,m)=>{h.on("error",m),h.on("keyStatus",g=>{g.startsWith("usable")?p():g==="output-restricted"?m(new ol({type:oi.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):g==="internal-error"?m(new ol({type:oi.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${g}"`)):g==="expired"?m(new Error("key expired while generating request")):this.warn(`unhandled key status change "${g}"`)})});return e.mediaKeysSession.generateRequest(i,r).then(()=>{var p;this.log(`Request generated for key-session "${(p=e.mediaKeysSession)==null?void 0:p.sessionId}" keyId: ${c}`)}).catch(p=>{throw new ol({type:oi.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_NO_SESSION,error:p,fatal:!1},`Error generating key-session request: ${p}`)}).then(()=>f).catch(p=>{throw h.removeAllListeners(),this.removeSession(e),p}).then(()=>(h.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((i,r)=>{this.log(`key status change "${i}" for keyStatuses keyId: ${dh.hexDump("buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r))} session keyId: ${dh.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=i})}fetchServerCertificate(e){const i=this.config,r=i.loader,n=new r(i),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:s},c=i.certLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(d,f,p,m)=>{a(d.data)},onError:(d,f,p,m)=>{o(new ol({type:oi.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:Is({url:l.url,data:void 0},d)},`"${e}" certificate request failed (${s}). Status: ${d.code} (${d.text})`))},onTimeout:(d,f,p)=>{o(new ol({type:oi.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(d,f,p)=>{o(new Error("aborted"))}};n.load(l,h,u)})):Promise.resolve()}setMediaKeysServerCertificate(e,i,r){return new Promise((n,s)=>{e.setServerCertificate(r).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${r==null?void 0:r.byteLength}) on "${i}"`),n(e)}).catch(a=>{s(new ol({type:oi.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,i){return this.requestLicense(e,new Uint8Array(i)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(n=>{throw new ol({type:oi.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:n,fatal:!0},n.message)}))}unpackPlayReadyKeyMessage(e,i){const r=String.fromCharCode.apply(null,new Uint16Array(i.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),i;const n=new DOMParser().parseFromString(r,"application/xml"),s=n.querySelectorAll("HttpHeader");if(s.length>0){let h;for(let u=0,d=s.length;u<d;u++){var a,o;h=s[u];const f=(a=h.querySelector("name"))==null?void 0:a.textContent,p=(o=h.querySelector("value"))==null?void 0:o.textContent;f&&p&&e.setRequestHeader(f,p)}}const l=n.querySelector("Challenge"),c=l==null?void 0:l.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return fk(atob(c))}setupLicenseXHR(e,i,r,n){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,i,r,n)}).catch(a=>{if(!r.decryptdata)throw a;return e.open("POST",i,!0),s.call(this.hls,e,i,r,n)}).then(a=>(e.readyState||e.open("POST",i,!0),{xhr:e,licenseChallenge:a||n})):(e.open("POST",i,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,i){const r=this.config.keyLoadPolicy.default;return new Promise((n,s)=>{const a=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,o,a,e)}catch(h){this.error(h)}n(l)}else{const l=r.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||o.status>=400&&o.status<500)s(new ol({type:oi.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const h=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${h} attempts left`),this.requestLicense(e,i).then(n,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,i).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==gr.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)})})}onMediaAttached(e,i){if(!this.config.emeEnabled)return;const r=i.media;this.media=r,r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,i=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},i1.clearKeyUriToKeyIdMap();const r=i.length;pg.CDMCleanupPromise=Promise.all(i.map(n=>this.removeSession(n)).concat(e==null?void 0:e.setMediaKeys(null).catch(n=>{this.log(`Could not clear media keys: ${n}`)}))).then(()=>{r&&(this.log("finished closing key sessions and clearing media keys"),i.length=0)}).catch(n=>{this.log(`Could not close sessions and clear media keys: ${n}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:i}){if(!(!i||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=i.reduce((n,s)=>(n.indexOf(s.keyFormat)===-1&&n.push(s.keyFormat),n),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:i,licenseXhr:r}=e;if(i){this.log(`Remove licenses and keys and close session ${i.sessionId}`),e._onmessage&&(i.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(i.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const n=this.mediaKeySessions.indexOf(e);return n>-1&&this.mediaKeySessions.splice(n,1),i.remove().catch(s=>{this.log(`Could not remove session: ${s}`)}).then(()=>i.close()).catch(s=>{this.log(`Could not close session: ${s}`)})}}}pg.CDMCleanupPromise=void 0;class ol extends Error{constructor(e,i){super(i),this.data=void 0,e.error||(e.error=new Error(i)),this.data=e,e.err=e.error}}var la;(function(t){t.MANIFEST="m",t.AUDIO="a",t.VIDEO="v",t.MUXED="av",t.INIT="i",t.CAPTION="c",t.TIMED_TEXT="tt",t.KEY="k",t.OTHER="o"})(la||(la={}));var Ak;(function(t){t.DASH="d",t.HLS="h",t.SMOOTH="s",t.OTHER="o"})(Ak||(Ak={}));var Ym;(function(t){t.OBJECT="CMCD-Object",t.REQUEST="CMCD-Request",t.SESSION="CMCD-Session",t.STATUS="CMCD-Status"})(Ym||(Ym={}));const UTe={[Ym.OBJECT]:["br","d","ot","tb"],[Ym.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Ym.SESSION]:["cid","pr","sf","sid","st","v"],[Ym.STATUS]:["bs","rtp"]};class n1{constructor(e,i){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map(r=>r instanceof n1?r:new n1(r))),this.value=e,this.params=i}}class jne{constructor(e){this.description=void 0,this.description=e}}const zTe="Dict";function GTe(t){return Array.isArray(t)?JSON.stringify(t):t instanceof Map?"Map{}":t instanceof Set?"Set{}":typeof t=="object"?JSON.stringify(t):String(t)}function VTe(t,e,i,r){return new Error(`failed to ${t} "${GTe(e)}" as ${i}`,{cause:r})}const V9="Bare Item",HTe="Boolean",jTe="Byte Sequence",WTe="Decimal",XTe="Integer";function YTe(t){return t<-999999999999999||999999999999999<t}const qTe=/[\x00-\x1f\x7f]+/,KTe="Token",QTe="Key";function Gh(t,e,i){return VTe("serialize",t,e,i)}function $Te(t){if(typeof t!="boolean")throw Gh(t,HTe);return t?"?1":"?0"}function JTe(t){return btoa(String.fromCharCode(...t))}function ZTe(t){if(ArrayBuffer.isView(t)===!1)throw Gh(t,jTe);return`:${JTe(t)}:`}function Wne(t){if(YTe(t))throw Gh(t,XTe);return t.toString()}function eCe(t){return`@${Wne(t.getTime()/1e3)}`}function Xne(t,e){if(t<0)return-Xne(-t,e);const i=Math.pow(10,e);if(Math.abs(t*i%1-.5)<Number.EPSILON){const n=Math.floor(t*i);return(n%2===0?n:n+1)/i}else return Math.round(t*i)/i}function tCe(t){const e=Xne(t,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Gh(t,WTe);const i=e.toString();return i.includes(".")?i:`${i}.0`}const iCe="String";function rCe(t){if(qTe.test(t))throw Gh(t,iCe);return`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function nCe(t){return t.description||t.toString().slice(7,-1)}function H9(t){const e=nCe(t);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Gh(e,KTe);return e}function Ek(t){switch(typeof t){case"number":if(!Bt(t))throw Gh(t,V9);return Number.isInteger(t)?Wne(t):tCe(t);case"string":return rCe(t);case"symbol":return H9(t);case"boolean":return $Te(t);case"object":if(t instanceof Date)return eCe(t);if(t instanceof Uint8Array)return ZTe(t);if(t instanceof jne)return H9(t);default:throw Gh(t,V9)}}function Mk(t){if(/^[a-z*][a-z0-9\-_.*]*$/.test(t)===!1)throw Gh(t,QTe);return t}function b5(t){return t==null?"":Object.entries(t).map(([e,i])=>i===!0?`;${Mk(e)}`:`;${Mk(e)}=${Ek(i)}`).join("")}function Yne(t){return t instanceof n1?`${Ek(t.value)}${b5(t.params)}`:Ek(t)}function sCe(t){return`(${t.value.map(Yne).join(" ")})${b5(t.params)}`}function aCe(t,e={whitespace:!0}){if(typeof t!="object")throw Gh(t,zTe);const i=t instanceof Map?t.entries():Object.entries(t),r=e!=null&&e.whitespace?" ":"";return Array.from(i).map(([n,s])=>{s instanceof n1||(s=new n1(s));let a=Mk(n);return s.value===!0?a+=b5(s.params):(a+="=",Array.isArray(s.value)?a+=sCe(s):a+=Yne(s)),a}).join(`,${r}`)}function oCe(t,e){return aCe(t,e)}const lCe=t=>t==="ot"||t==="sf"||t==="st",cCe=t=>typeof t=="number"?Bt(t):t!=null&&t!==""&&t!==!1;function hCe(t,e){const i=new URL(t),r=new URL(e);if(i.origin!==r.origin)return t;const n=i.pathname.split("/").slice(1),s=r.pathname.split("/").slice(1,-1);for(;n[0]===s[0];)n.shift(),s.shift();for(;s.length;)s.shift(),n.unshift("..");return n.join("/")}function uCe(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),i=e.toString();return URL.revokeObjectURL(e),i.slice(i.lastIndexOf("/")+1)}catch{let i=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const s=(i+Math.random()*16)%16|0;return i=Math.floor(i/16),(n=="x"?s:s&3|8).toString(16)})}}}const aC=t=>Math.round(t),dCe=(t,e)=>(e!=null&&e.baseUrl&&(t=hCe(t,e.baseUrl)),encodeURIComponent(t)),iM=t=>aC(t/100)*100,fCe={br:aC,d:aC,bl:iM,dl:iM,mtp:iM,nor:dCe,rtp:iM,tb:aC};function pCe(t,e){const i={};if(t==null||typeof t!="object")return i;const r=Object.keys(t).sort(),n=zn({},fCe,e==null?void 0:e.formatters),s=e==null?void 0:e.filter;return r.forEach(a=>{if(s!=null&&s(a))return;let o=t[a];const l=n[a];l&&(o=l(o,e)),!(a==="v"&&o===1)&&(a=="pr"&&o===1||cCe(o)&&(lCe(a)&&typeof o=="string"&&(o=new jne(o)),i[a]=o))}),i}function qne(t,e={}){return t?oCe(pCe(t,e),zn({whitespace:!1},e)):""}function mCe(t,e={}){if(!t)return{};const i=Object.entries(t),r=Object.entries(UTe).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),n=i.reduce((s,a)=>{var o,l;const[c,h]=a,u=((o=r.find(d=>d[1].includes(c)))==null?void 0:o[0])||Ym.REQUEST;return(l=s[u])!=null||(s[u]={}),s[u][c]=h,s},{});return Object.entries(n).reduce((s,[a,o])=>(s[a]=qne(o,e),s),{})}function gCe(t,e,i){return zn(t,mCe(e,i))}const vCe="CMCD";function yCe(t,e={}){if(!t)return"";const i=qne(t,e);return`${vCe}=${encodeURIComponent(i)}`}const j9=/CMCD=[^&#]+/;function xCe(t,e,i){const r=yCe(e,i);if(!r)return t;if(j9.test(t))return t.replace(j9,r);const n=t.includes("?")?"&":"?";return`${t}${n}${r}`}class Kne{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=n=>{try{this.apply(n,{ot:la.MANIFEST,su:!this.initialized})}catch(s){Oe.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=n=>{try{const s=n.frag,a=this.hls.levels[s.level],o=this.getObjectType(s),l={d:s.duration*1e3,ot:o};(o===la.VIDEO||o===la.AUDIO||o==la.MUXED)&&(l.br=a.bitrate/1e3,l.tb=this.getTopBandwidth(o)/1e3,l.bl=this.getBufferLength(o)),this.apply(n,l)}catch(s){Oe.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const i=this.config=e.config,{cmcd:r}=i;r!=null&&(i.pLoader=this.createPlaylistLoader(),i.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||uCe(),this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ee.MEDIA_DETACHED,this.onMediaDetached,this),e.on(ee.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ee.MEDIA_DETACHED,this.onMediaDetached,this),e.off(ee.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(e,i){this.media=i.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,i){var r,n;this.audioBuffer=(r=i.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(n=i.tracks.video)==null?void 0:n.buffer}createData(){var e;return{v:1,sf:Ak.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,i={}){zn(i,this.createData());const r=i.ot===la.INIT||i.ot===la.VIDEO||i.ot===la.MUXED;this.starved&&r&&(i.bs=!0,i.su=!0,this.starved=!1),i.su==null&&(i.su=this.buffering);const{includeKeys:n}=this;n&&(i=Object.keys(i).reduce((s,a)=>(n.includes(a)&&(s[a]=i[a]),s),{})),this.useHeaders?(e.headers||(e.headers={}),gCe(e.headers,i)):e.url=xCe(e.url,i)}getObjectType(e){const{type:i}=e;if(i==="subtitle")return la.TIMED_TEXT;if(e.sn==="initSegment")return la.INIT;if(i==="audio")return la.AUDIO;if(i==="main")return this.hls.audioTracks.length?la.VIDEO:la.MUXED}getTopBandwidth(e){let i=0,r;const n=this.hls;if(e===la.AUDIO)r=n.audioTracks;else{const s=n.maxAutoLevel,a=s>-1?s+1:n.levels.length;r=n.levels.slice(0,a)}for(const s of r)s.bitrate>i&&(i=s.bitrate);return i>0?i:NaN}getBufferLength(e){const i=this.hls.media,r=e===la.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!i?NaN:wr.bufferInfo(r,i.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,i=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){i(s),this.loader.load(s,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,i=this.applyFragmentData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){i(s),this.loader.load(s,a,o)}}}}const bCe=3e5;class Qne{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=Oe.log.bind(Oe,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ee.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ee.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const i=this.levels;i&&(this.levels=i.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,i){const{contentSteering:r}=i;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,i){this.audioTracks=i.audioTracks,this.subtitleTracks=i.subtitleTracks}onError(e,i){const{errorAction:r}=i;if((r==null?void 0:r.action)===Qn.SendAlternateToPenaltyBox&&r.flags===gl.MoveAllAlternatesMatchingHost){const n=this.levels;let s=this.pathwayPriority,a=this.pathwayId;if(i.context){const{groupId:o,pathwayId:l,type:c}=i.context;o&&n?a=this.getPathwayForGroupId(o,c,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!s&&n&&(s=n.reduce((o,l)=>(o.indexOf(l.pathwayId)===-1&&o.push(l.pathwayId),o),[])),s&&s.length>1&&(this.updatePathwayPriority(s),r.resolved=this.pathwayId!==a),r.resolved||Oe.warn(`Could not resolve ${i.details} ("${i.error.message}") with content-steering for Pathway: ${a} levels: ${n&&n.length} priorities: ${JSON.stringify(s)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let i=this.getLevelsForPathway(this.pathwayId);if(i.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),i=this.getLevelsForPathway(r),this.pathwayId=r}return i.length!==e.length&&this.log(`Found ${i.length}/${e.length} levels in Pathway "${this.pathwayId}"`),i}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(i=>e===i.pathwayId)}updatePathwayPriority(e){this.pathwayPriority=e;let i;const r=this.penalizedPathways,n=performance.now();Object.keys(r).forEach(s=>{n-r[s]>bCe&&delete r[s]});for(let s=0;s<e.length;s++){const a=e[s];if(a in r)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(i=this.getLevelsForPathway(a),i.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,nne(i),this.hls.trigger(ee.LEVELS_UPDATED,{levels:i});const c=this.hls.levels[o];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,i,r){const n=this.getLevelsForPathway(r).concat(this.levels||[]);for(let s=0;s<n.length;s++)if(i===ki.AUDIO_TRACK&&n[s].hasAudioGroup(e)||i===ki.SUBTITLE_TRACK&&n[s].hasSubtitleGroup(e))return n[s].pathwayId;return r}clonePathways(e){const i=this.levels;if(!i)return;const r={},n={};e.forEach(s=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=s;if(i.some(h=>h.pathwayId===a))return;const c=this.getLevelsForPathway(o).map(h=>{const u=new Ir(h.attrs);u["PATHWAY-ID"]=a;const d=u.AUDIO&&`${u.AUDIO}_clone_${a}`,f=u.SUBTITLES&&`${u.SUBTITLES}_clone_${a}`;d&&(r[u.AUDIO]=d,u.AUDIO=d),f&&(n[u.SUBTITLES]=f,u.SUBTITLES=f);const p=$ne(h.uri,u["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),m=new Ug({attrs:u,audioCodec:h.audioCodec,bitrate:h.bitrate,height:h.height,name:h.name,url:p,videoCodec:h.videoCodec,width:h.width});if(h.audioGroups)for(let g=1;g<h.audioGroups.length;g++)m.addGroupId("audio",`${h.audioGroups[g]}_clone_${a}`);if(h.subtitleGroups)for(let g=1;g<h.subtitleGroups.length;g++)m.addGroupId("text",`${h.subtitleGroups[g]}_clone_${a}`);return m});i.push(...c),W9(this.audioTracks,r,l,a),W9(this.subtitleTracks,n,l,a)})}loadSteeringManifest(e){const i=this.hls.config,r=i.loader;this.loader&&this.loader.destroy(),this.loader=new r(i);let n;try{n=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(n.protocol!=="data:"){const h=(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate)|0;n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+h)}const s={responseType:"json",url:n.href},a=i.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},c={onSuccess:(h,u,d,f)=>{this.log(`Loaded steering manifest: "${n}"`);const p=h.data;if(p.VERSION!==1){this.log(`Steering VERSION ${p.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":m,"PATHWAY-CLONES":g,"PATHWAY-PRIORITY":v}=p;if(m)try{this.uri=new self.URL(m,n).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${m}`);return}this.scheduleRefresh(this.uri||d.url),g&&this.clonePathways(g);const y={steeringManifest:p,url:n.toString()};this.hls.trigger(ee.STEERING_MANIFEST_LOADED,y),v&&this.updatePathwayPriority(v)},onError:(h,u,d,f)=>{if(this.log(`Error loading steering manifest: ${h.code} ${h.text} (${u.url})`),this.stopLoad(),h.code===410){this.enabled=!1,this.log(`Steering manifest ${u.url} no longer available`);return}let p=this.timeToLoad*1e3;if(h.code===429){const m=this.loader;if(typeof(m==null?void 0:m.getResponseHeader)=="function"){const g=m.getResponseHeader("Retry-After");g&&(p=parseFloat(g)*1e3)}this.log(`Steering manifest ${u.url} rate limited`);return}this.scheduleRefresh(this.uri||u.url,p)},onTimeout:(h,u,d)=>{this.log(`Timeout loading steering manifest (${u.url})`),this.scheduleRefresh(this.uri||u.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(s,l,c)}scheduleRefresh(e,i=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const n=(r=this.hls)==null?void 0:r.media;if(n&&!n.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},i)}}function W9(t,e,i,r){t&&Object.keys(e).forEach(n=>{const s=t.filter(a=>a.groupId===n).map(a=>{const o=zn({},a);return o.details=void 0,o.attrs=new Ir(o.attrs),o.url=o.attrs.URI=$ne(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",i),o.groupId=o.attrs["GROUP-ID"]=e[n],o.attrs["PATHWAY-ID"]=r,o});t.push(...s)})}function $ne(t,e,i,r){const{HOST:n,PARAMS:s,[i]:a}=r;let o;e&&(o=a==null?void 0:a[e],o&&(t=o));const l=new self.URL(t);return n&&!o&&(l.host=n),s&&Object.keys(s).sort().forEach(c=>{c&&l.searchParams.set(c,s[c])}),l.href}const wCe=/^age:\s*[\d.]+\s*$/im;class Jne{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new S_,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,i,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=i,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:i}=this;if(!e||!i)return;const r=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return s(r,i.url)}).catch(a=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",i.url,!0),s(r,i.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,i,e)}).catch(a=>{this.callbacks.onError({code:r.status,text:a.message},i,r,n)}):this.openAndSendXhr(r,i,e)}openAndSendXhr(e,i,r){e.readyState||e.open("GET",i.url,!0);const n=i.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=r.loadPolicy;if(n)for(const o in n)e.setRequestHeader(o,n[o]);i.rangeEnd&&e.setRequestHeader("Range","bytes="+i.rangeStart+"-"+(i.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=i.responseType,self.clearTimeout(this.requestTimeout),r.timeout=s&&Bt(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:i,stats:r}=this;if(!e||!i)return;const n=i.readyState,s=this.config;if(!r.aborted&&n>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),n===4)){self.clearTimeout(this.requestTimeout),i.onreadystatechange=null,i.onprogress=null;const a=i.status,o=i.responseType!=="text";if(a>=200&&a<300&&(o&&i.response||i.responseText!==null)){r.loading.end=Math.max(self.performance.now(),r.loading.first);const l=o?i.response:i.responseText,c=i.responseType==="arraybuffer"?l.byteLength:l.length;if(r.loaded=r.total=c,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first),!this.callbacks)return;const h=this.callbacks.onProgress;if(h&&h(r,e,l,i),!this.callbacks)return;const u={url:i.responseURL,data:l,code:a};this.callbacks.onSuccess(u,r,e,i)}else{const l=s.loadPolicy.errorRetry,c=r.retry,h={url:e.url,data:void 0,code:a};m2(l,c,!1,h)?this.retry(l):(Oe.error(`${a} while loading ${e.url}`),this.callbacks.onError({code:a,text:i.statusText},e,i,r))}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,i=this.stats.retry;if(m2(e,i,!0))this.retry(e);else{var r;Oe.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:i,stats:r}=this;this.retryDelay=u5(e,r.retry),r.retry++,Oe.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${i==null?void 0:i.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const i=this.stats;i.loaded=e.loaded,e.lengthComputable&&(i.total=e.total)}getCacheAge(){let e=null;if(this.loader&&wCe.test(this.loader.getAllResponseHeaders())){const i=this.loader.getResponseHeader("age");e=i?parseFloat(i):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}function SCe(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const _Ce=/(\d+)-(\d+)\/(\d+)/;class X9{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||TCe,this.controller=new self.AbortController,this.stats=new S_}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,i,r){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const s=ACe(e,this.controller.signal),a=r.onProgress,o=e.responseType==="arraybuffer",l=o?"byteLength":"length",{maxTimeToFirstByteMs:c,maxLoadTimeMs:h}=i.loadPolicy;this.context=e,this.config=i,this.callbacks=r,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),i.timeout=c&&Bt(c)?c:h,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(n,e,this.response)},i.timeout),self.fetch(this.request).then(u=>{this.response=this.loader=u;const d=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),i.timeout=h,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(n,e,this.response)},h-(d-n.loading.start)),!u.ok){const{status:f,statusText:p}=u;throw new CCe(p||"fetch, bad network response",f,u)}return n.loading.first=d,n.total=MCe(u.headers)||n.total,a&&Bt(i.highWaterMark)?this.loadProgressively(u,n,e,i.highWaterMark,a):o?u.arrayBuffer():e.responseType==="json"?u.json():u.text()}).then(u=>{const d=this.response;if(!d)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const f=u[l];f&&(n.loaded=n.total=f);const p={url:d.url,data:u,code:d.status};a&&!Bt(i.highWaterMark)&&a(n,e,u,d),r.onSuccess(p,n,e,d)}).catch(u=>{if(self.clearTimeout(this.requestTimeout),n.aborted)return;const d=u&&u.code||0,f=u?u.message:null;r.onError({code:d,text:f},e,u?u.details:null,n)})}getCacheAge(){let e=null;if(this.response){const i=this.response.headers.get("age");e=i?parseFloat(i):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,i,r,n=0,s){const a=new hne,o=e.body.getReader(),l=()=>o.read().then(c=>{if(c.done)return a.dataLength&&s(i,r,a.flush(),e),Promise.resolve(new ArrayBuffer(0));const h=c.value,u=h.length;return i.loaded+=u,u<n||a.dataLength?(a.push(h),a.dataLength>=n&&s(i,r,a.flush(),e)):s(i,r,h,e),l()}).catch(()=>Promise.reject());return l()}}function ACe(t,e){const i={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(zn({},t.headers))};return t.rangeEnd&&i.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),i}function ECe(t){const e=_Ce.exec(t);if(e)return parseInt(e[2])-parseInt(e[1])+1}function MCe(t){const e=t.get("Content-Range");if(e){const r=ECe(e);if(Bt(r))return r}const i=t.get("Content-Length");if(i)return parseInt(i)}function TCe(t,e){return new self.Request(t.url,e)}class CCe extends Error{constructor(e,i,r){super(e),this.code=void 0,this.details=void 0,this.code=i,this.details=r}}const PCe=/\s/,DCe={newCue(t,e,i,r){const n=[];let s,a,o,l,c;const h=self.VTTCue||self.TextTrackCue;for(let d=0;d<r.rows.length;d++)if(s=r.rows[d],o=!0,l=0,c="",!s.isEmpty()){var u;for(let m=0;m<s.chars.length;m++)PCe.test(s.chars[m].uchar)&&o?l++:(c+=s.chars[m].uchar,o=!1);s.cueStartTime=e,e===i&&(i+=1e-4),l>=16?l--:l++;const f=kne(c.trim()),p=x5(e,i,f);t!=null&&(u=t.cues)!=null&&u.getCueById(p)||(a=new h(e,i,f),a.id=p,a.line=d+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),n.push(a))}return t&&n.length&&(n.sort((d,f)=>d.line==="auto"||f.line==="auto"?0:d.line>8&&f.line>8?f.line-d.line:d.line-f.line),n.forEach(d=>ene(t,d))),n}},RCe={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Zne=Is(Is({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Jne,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:lne,bufferController:Ine,capLevelController:AD,errorController:ane,fpsController:Hne,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:zre,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:RCe},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},ICe()),{},{subtitleStreamController:Dne,subtitleTrackController:Rne,timelineController:Gne,audioStreamController:Cne,audioTrackController:Pne,emeController:pg,cmcdController:Kne,contentSteeringController:Qne});function ICe(){return{cueHandler:DCe,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function LCe(t,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=Tk(t),r=["manifest","level","frag"],n=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(s=>{const a=`${s==="level"?"playlist":s}LoadPolicy`,o=e[a]===void 0,l=[];n.forEach(c=>{const h=`${s}Loading${c}`,u=e[h];if(u!==void 0&&o){l.push(h);const d=i[a].default;switch(e[a]={default:d},c){case"TimeOut":d.maxLoadTimeMs=u,d.maxTimeToFirstByteMs=u;break;case"MaxRetry":d.errorRetry.maxNumRetry=u,d.timeoutRetry.maxNumRetry=u;break;case"RetryDelay":d.errorRetry.retryDelayMs=u,d.timeoutRetry.retryDelayMs=u;break;case"MaxRetryTimeout":d.errorRetry.maxRetryDelayMs=u,d.timeoutRetry.maxRetryDelayMs=u;break}}}),l.length&&Oe.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${a}": ${JSON.stringify(e[a])}`)}),Is(Is({},i),e)}function Tk(t){return t&&typeof t=="object"?Array.isArray(t)?t.map(Tk):Object.keys(t).reduce((e,i)=>(e[i]=Tk(t[i]),e),{}):t}function OCe(t){const e=t.loader;e!==X9&&e!==Jne?(Oe.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1):SCe()&&(t.loader=X9,t.progressive=!0,t.enableSoftwareAES=!0,Oe.log("[config]: Progressive streaming enabled, using FetchLoader"))}let ZL;class BCe extends wD{constructor(e,i){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=i,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(ee.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(ee.FRAG_BUFFERED,this.onFragBuffered,this),e.on(ee.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(ee.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(ee.FRAG_BUFFERED,this.onFragBuffered,this),e.off(ee.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(i=>{i.loadError=0,i.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,i){this.resetLevels()}onManifestLoaded(e,i){const r=this.hls.config.preferManagedMediaSource,n=[],s={},a={};let o=!1,l=!1,c=!1;i.levels.forEach(h=>{var u,d;const f=h.attrs;let{audioCodec:p,videoCodec:m}=h;((u=p)==null?void 0:u.indexOf("mp4a.40.34"))!==-1&&(ZL||(ZL=/chrome|firefox/i.test(navigator.userAgent)),ZL&&(h.audioCodec=p=void 0)),p&&(h.audioCodec=p=d2(p,r)),((d=m)==null?void 0:d.indexOf("avc1"))===0&&(m=h.videoCodec=IEe(m));const{width:g,height:v,unknownCodecs:y}=h;if(o||(o=!!(g&&v)),l||(l=!!m),c||(c=!!p),y!=null&&y.length||p&&!NL(p,"audio",r)||m&&!NL(m,"video",r))return;const{CODECS:x,"FRAME-RATE":S,"HDCP-LEVEL":A,"PATHWAY-ID":_,RESOLUTION:M,"VIDEO-RANGE":E}=f,C=`${`${_||"."}-`}${h.bitrate}-${M}-${S}-${x}-${E}-${A}`;if(s[C])if(s[C].uri!==h.url&&!h.attrs["PATHWAY-ID"]){const D=a[C]+=1;h.attrs["PATHWAY-ID"]=new Array(D+1).join(".");const B=new Ug(h);s[C]=B,n.push(B)}else s[C].addGroupId("audio",f.AUDIO),s[C].addGroupId("text",f.SUBTITLES);else{const D=new Ug(h);s[C]=D,a[C]=1,n.push(D)}}),this.filterAndSortMediaOptions(n,i,o,l,c)}filterAndSortMediaOptions(e,i,r,n,s){let a=[],o=[],l=e;if((r||n)&&s&&(l=l.filter(({videoCodec:p,videoRange:m,width:g,height:v})=>(!!p||!!(g&&v))&&WEe(m))),l.length===0){Promise.resolve().then(()=>{if(this.hls){i.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(i.levels[0].attrs)}`);const p=new Error("no level with compatible codecs found in manifest");this.hls.trigger(ee.ERROR,{type:oi.MEDIA_ERROR,details:je.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:i.url,error:p,reason:p.message})}});return}if(i.audioTracks){const{preferManagedMediaSource:p}=this.hls.config;a=i.audioTracks.filter(m=>!m.audioCodec||NL(m.audioCodec,"audio",p)),Y9(a)}i.subtitles&&(o=i.subtitles,Y9(o));const c=l.slice(0);l.sort((p,m)=>{if(p.attrs["HDCP-LEVEL"]!==m.attrs["HDCP-LEVEL"])return(p.attrs["HDCP-LEVEL"]||"")>(m.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&p.height!==m.height)return p.height-m.height;if(p.frameRate!==m.frameRate)return p.frameRate-m.frameRate;if(p.videoRange!==m.videoRange)return f2.indexOf(p.videoRange)-f2.indexOf(m.videoRange);if(p.videoCodec!==m.videoCodec){const g=t9(p.videoCodec),v=t9(m.videoCodec);if(g!==v)return v-g}if(p.uri===m.uri&&p.codecSet!==m.codecSet){const g=u2(p.codecSet),v=u2(m.codecSet);if(g!==v)return v-g}return p.averageBitrate!==m.averageBitrate?p.averageBitrate-m.averageBitrate:0});let h=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length)){for(let p=0;p<c.length;p++)if(c[p].pathwayId===l[0].pathwayId){h=c[p];break}}this._levels=l;for(let p=0;p<l.length;p++)if(l[p]===h){var u;this._firstLevel=p;const m=h.bitrate,g=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${m}`),((u=this.hls.userConfig)==null?void 0:u.abrEwmaDefaultEstimate)===void 0){const v=Math.min(m,this.hls.config.abrEwmaDefaultEstimateMax);v>g&&g===Zne.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=v)}break}const d=s&&!n,f={levels:l,audioTracks:a,subtitleTracks:o,sessionData:i.sessionData,sessionKeys:i.sessionKeys,firstLevel:this._firstLevel,stats:i.stats,audio:s,video:n,altAudio:!d&&a.some(p=>!!p.url)};this.hls.trigger(ee.MANIFEST_PARSED,f),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const i=this._levels;if(i.length===0)return;if(e<0||e>=i.length){const h=new Error("invalid level idx"),u=e<0;if(this.hls.trigger(ee.ERROR,{type:oi.OTHER_ERROR,details:je.LEVEL_SWITCH_ERROR,level:e,fatal:u,error:h,reason:h.message}),u)return;e=Math.min(e,i.length-1)}const r=this.currentLevelIndex,n=this.currentLevel,s=n?n.attrs["PATHWAY-ID"]:void 0,a=i[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,r===e&&a.details&&n&&s===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${r}${s?" with Pathway "+s:""}`);const l={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(ee.LEVEL_SWITCHING,l);const c=a.details;if(!c||c.live){const h=this.switchParams(a.uri,n==null?void 0:n.details,c);this.loadPlaylist(h)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,i){i.fatal||!i.context||i.context.type===ki.LEVEL&&i.context.level===this.level&&this.checkRetry(i)}onFragBuffered(e,{frag:i}){if(i!==void 0&&i.type===Jt.MAIN){const r=i.elementaryStreams;if(!Object.keys(r).some(s=>!!r[s]))return;const n=this._levels[i.level];n!=null&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(e,i){var r;const{level:n,details:s}=i,a=this._levels[n];if(!a){var o;this.warn(`Invalid level index ${n}`),(o=i.deliveryDirectives)!=null&&o.skip&&(s.deltaUpdateFailed=!0);return}n===this.currentLevelIndex?(a.fragmentError===0&&(a.loadError=0),this.playlistLoaded(n,i,a.details)):(r=i.deliveryDirectives)!=null&&r.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist();const i=this.currentLevelIndex,r=this.currentLevel;if(r&&this.shouldLoadPlaylist(r)){let n=r.uri;if(e)try{n=e.addDirectives(n)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}const s=r.attrs["PATHWAY-ID"];this.log(`Loading level index ${i}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""} with${s?" Pathway "+s:""} ${n}`),this.clearTimer(),this.hls.trigger(ee.LEVEL_LOADING,{url:n,level:i,pathwayId:r.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var i;const r=this._levels.filter((n,s)=>s!==e?!0:(this.steering&&this.steering.removeLevel(n),n===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,n.details&&n.details.fragments.forEach(a=>a.level=-1)),!1));nne(r),this._levels=r,this.currentLevelIndex>-1&&(i=this.currentLevel)!=null&&i.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(ee.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:i}){this._levels=i}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:i,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==i&&(this._maxAutoLevel=i,this.hls.trigger(ee.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:i,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function Y9(t){const e={};t.forEach(i=>{const r=i.groupId||"";i.id=e[r]=e[r]||0,e[r]++})}class FCe{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyUriToKeyInfo){const n=this.keyUriToKeyInfo[r].loader;if(n){var i;if(e&&e!==((i=n.context)==null?void 0:i.frag.type))return;n.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[e];(i.mediaKeySessionContext||i.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[e].loader;i&&i.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,i=je.KEY_LOAD_ERROR,r,n,s){return new Cu({type:oi.NETWORK_ERROR,details:i,fatal:!1,frag:e,response:s,error:r,networkDetails:n})}loadClear(e,i){if(this.emeController&&this.config.emeEnabled){const{sn:r,cc:n}=e;for(let s=0;s<i.length;s++){const a=i[s];if(n<=a.cc&&(r==="initSegment"||a.sn==="initSegment"||r<a.sn)){this.emeController.selectKeySystemFormat(a).then(o=>{a.setKeyFormat(o)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(i=>this.loadInternal(e,i)):this.loadInternal(e)}loadInternal(e,i){var r,n;i&&e.setKeyFormat(i);const s=e.decryptdata;if(!s){const c=new Error(i?`Expected frag.decryptdata to be defined after setting format ${i}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,je.KEY_LOAD_ERROR,c))}const a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,je.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let o=this.keyUriToKeyInfo[a];if((r=o)!=null&&r.decryptdata.key)return s.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if((n=o)!=null&&n.keyLoadPromise){var l;switch((l=o.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(c=>(s.key=c.keyInfo.decryptdata.key,{frag:e,keyInfo:o}))}}switch(o=this.keyUriToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,je.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,i){const r={frag:i,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const n=this.emeController.loadKey(r);if(n)return(e.keyLoadPromise=n.then(s=>(e.mediaKeySessionContext=s,r))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(r)}loadKeyHTTP(e,i){const r=this.config,n=r.loader,s=new n(r);return i.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:i,responseType:"arraybuffer",url:e.decryptdata.uri},c=r.keyLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(d,f,p,m)=>{const{frag:g,keyInfo:v,url:y}=p;if(!g.decryptdata||v!==this.keyUriToKeyInfo[y])return o(this.createKeyLoadError(g,je.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),m));v.decryptdata.key=g.decryptdata.key=new Uint8Array(d.data),g.keyLoader=null,v.loader=null,a({frag:g,keyInfo:v})},onError:(d,f,p,m)=>{this.resetLoader(f),o(this.createKeyLoadError(i,je.KEY_LOAD_ERROR,new Error(`HTTP Error ${d.code} loading key ${d.text}`),p,Is({url:l.url,data:void 0},d)))},onTimeout:(d,f,p)=>{this.resetLoader(f),o(this.createKeyLoadError(i,je.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(d,f,p)=>{this.resetLoader(f),o(this.createKeyLoadError(i,je.INTERNAL_ABORTED,new Error("key loading aborted"),p))}};s.load(l,h,u)})}resetLoader(e){const{frag:i,keyInfo:r,url:n}=e,s=r.loader;i.keyLoader===s&&(i.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[n],s&&s.destroy()}}function ese(){return self.SourceBuffer||self.WebKitSourceBuffer}function w5(){if(!gp())return!1;const e=ese();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function tse(){if(!w5())return!1;const t=gp();return typeof(t==null?void 0:t.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>t.isTypeSupported(hS(e,"video")))||["mp4a.40.2","fLaC"].some(e=>t.isTypeSupported(hS(e,"audio"))))}function kCe(){var t;const e=ese();return typeof(e==null||(t=e.prototype)==null?void 0:t.changeType)=="function"}const NCe=250,oC=2,UCe=.1,zCe=.05;class GCe{constructor(e,i,r,n){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=i,this.fragmentTracker=r,this.hls=n}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,i){const{config:r,media:n,stalled:s}=this;if(n===null)return;const{currentTime:a,seeking:o}=n,l=this.seeking&&!o,c=!this.seeking&&o;if(this.seeking=o,a!==e){if(this.moved=!0,o||(this.nudgeRetry=0),s!==null){if(this.stallReported){const g=self.performance.now()-s;Oe.warn(`playback not stuck anymore @${a}, after ${Math.round(g)}ms`),this.stallReported=!1}this.stalled=null}return}if(c||l){this.stalled=null;return}if(n.paused&&!o||n.ended||n.playbackRate===0||!wr.getBuffered(n).length){this.nudgeRetry=0;return}const h=wr.bufferInfo(n,a,0),u=h.nextStart||0;if(o){const g=h.len>oC,v=!u||i&&i.start<=a||u-a>oC&&!this.fragmentTracker.getPartialFragment(a);if(g||v)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var d;if(!(h.len>0)&&!u)return;const v=Math.max(u,h.start||0)-a,y=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,S=(y==null||(d=y.details)==null?void 0:d.live)?y.details.targetduration*2:oC,A=this.fragmentTracker.getPartialFragment(a);if(v>0&&(v<=S||A)){n.paused||this._trySkipBufferHole(A);return}}const f=self.performance.now();if(s===null){this.stalled=f;return}const p=f-s;if(!o&&p>=NCe&&(this._reportStall(h),!this.media))return;const m=wr.bufferInfo(n,a,r.maxBufferHole);this._tryFixBufferStall(m,p)}_tryFixBufferStall(e,i){const{config:r,fragmentTracker:n,media:s}=this;if(s===null)return;const a=s.currentTime,o=n.getPartialFragment(a);o&&(this._trySkipBufferHole(o)||!this.media)||(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-a<r.maxBufferHole)&&i>r.highBufferWatchdogPeriod*1e3&&(Oe.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:i,media:r,stallReported:n}=this;if(!n&&r){this.stallReported=!0;const s=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${JSON.stringify(e)})`);Oe.warn(s.message),i.trigger(ee.ERROR,{type:oi.MEDIA_ERROR,details:je.BUFFER_STALLED_ERROR,fatal:!1,error:s,buffer:e.len})}}_trySkipBufferHole(e){const{config:i,hls:r,media:n}=this;if(n===null)return 0;const s=n.currentTime,a=wr.bufferInfo(n,s,0),o=s<a.start?a.start:a.nextStart;if(o){const l=a.len<=i.maxBufferHole,c=a.len>0&&a.len<1&&n.readyState<3,h=o-s;if(h>0&&(l||c)){if(h>i.maxBufferHole){const{fragmentTracker:d}=this;let f=!1;if(s===0){const p=d.getAppendedFrag(0,Jt.MAIN);p&&o<p.end&&(f=!0)}if(!f){const p=e||d.getAppendedFrag(s,Jt.MAIN);if(p){let m=!1,g=p.end;for(;g<o;){const v=d.getPartialFragment(g);if(v)g+=v.duration;else{m=!0;break}}if(m)return 0}}}const u=Math.max(o+zCe,s+UCe);if(Oe.warn(`skipping hole, adjusting currentTime from ${s} to ${u}`),this.moved=!0,this.stalled=null,n.currentTime=u,e&&!e.gap){const d=new Error(`fragment loaded with buffer holes, seeking from ${s} to ${u}`);r.trigger(ee.ERROR,{type:oi.MEDIA_ERROR,details:je.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:e})}return u}}return 0}_tryNudgeBuffer(){const{config:e,hls:i,media:r,nudgeRetry:n}=this;if(r===null)return;const s=r.currentTime;if(this.nudgeRetry++,n<e.nudgeMaxRetry){const a=s+(n+1)*e.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${s} to ${a}`);Oe.warn(o.message),r.currentTime=a,i.trigger(ee.ERROR,{type:oi.MEDIA_ERROR,details:je.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1})}else{const a=new Error(`Playhead still not moving while enough data buffered @${s} after ${e.nudgeMaxRetry} nudges`);Oe.error(a.message),i.trigger(ee.ERROR,{type:oi.MEDIA_ERROR,details:je.BUFFER_STALLED_ERROR,error:a,fatal:!0})}}}const VCe=100;class HCe extends _D{constructor(e,i,r){super(e,i,r,"[stream-controller]",Jt.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ee.LEVEL_LOADING,this.onLevelLoading,this),e.on(ee.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ee.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(ee.ERROR,this.onError,this),e.on(ee.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(ee.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(ee.BUFFER_CREATED,this.onBufferCreated,this),e.on(ee.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(ee.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ee.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ee.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(ee.ERROR,this.onError,this),e.off(ee.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(ee.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(ee.BUFFER_CREATED,this.onBufferCreated,this),e.off(ee.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(ee.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(e){if(this.levels){const{lastCurrentTime:i,hls:r}=this;if(this.stopLoad(),this.setInterval(VCe),this.level=-1,!this.startFragRequested){let n=r.startLevel;n===-1&&(r.config.testBandwidth&&this.levels.length>1?(n=0,this.bitrateTest=!0):n=r.firstAutoLevel),r.nextLoadLevel=n,this.level=r.loadLevel,this.loadedmetadata=!1}i>0&&e===-1&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=ct.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=ct.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ct.WAITING_LEVEL:{const{levels:i,level:r}=this,n=i==null?void 0:i[r],s=n==null?void 0:n.details;if(s&&(!s.live||this.levelLastLoaded===n)){if(this.waitForCdnTuneIn(s))break;this.state=ct.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ct.IDLE;break}break}case ct.FRAG_LOADING_WAITING_RETRY:{var e;const i=self.performance.now(),r=this.retryDate;if(!r||i>=r||(e=this.media)!=null&&e.seeking){const{levels:n,level:s}=this,a=n==null?void 0:n[s];this.resetStartWhenNotLoaded(a||null),this.state=ct.IDLE}}break}this.state===ct.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:i,levels:r,media:n}=this;if(i===null||!n&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=e.nextLoadLevel;if(!(r!=null&&r[s]))return;const a=r[s],o=this.getMainFwdBufferInfo();if(o===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const m={};this.altAudio&&(m.type="video"),this.hls.trigger(ee.BUFFER_EOS,m),this.state=ct.ENDED;return}e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const c=a.details;if(!c||this.state===ct.WAITING_LEVEL||c.live&&this.levelLastLoaded!==a){this.level=s,this.state=ct.WAITING_LEVEL;return}const h=o.len,u=this.getMaxBufferLength(a.maxBitrate);if(h>=u)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const d=this.backtrackFragment?this.backtrackFragment.start:o.end;let f=this.getNextFragment(d,c);if(this.couldBacktrack&&!this.fragPrevious&&f&&f.sn!=="initSegment"&&this.fragmentTracker.getState(f)!==bs.OK){var p;const g=((p=this.backtrackFragment)!=null?p:f).sn-c.startSN,v=c.fragments[g-1];v&&f.cc===v.cc&&(f=v,this.fragmentTracker.removeFragment(v))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,d)){if(!f.gap){const g=this.audioOnly&&!this.altAudio?ir.AUDIO:ir.VIDEO,v=(g===ir.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;v&&this.afterBufferFlushed(v,g,Jt.MAIN)}f=this.getNextFragmentLoopLoading(f,c,o,Jt.MAIN,u)}f&&(f.initSegment&&!f.initSegment.data&&!this.bitrateTest&&(f=f.initSegment),this.loadFragment(f,a,d))}loadFragment(e,i,r){const n=this.fragmentTracker.getState(e);this.fragCurrent=e,n===bs.NOT_LOADED||n===bs.PARTIAL?e.sn==="initSegment"?this._loadInitSegment(e,i):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,i)):(this.startFragRequested=!0,super.loadFragment(e,i,r)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Jt.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:i}=this;if(i!=null&&i.readyState){let r;const n=this.getAppendedFrag(i.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<s.targetduration*2)return}if(!i.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],c=this.fragLastKbps;c&&this.fragCurrent?r=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:r=0}else r=0;const a=this.getBufferedFrag(i.currentTime+r);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,c=o.duration,h=Math.max(a.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ct.KEY_LOADING:case ct.FRAG_LOADING:case ct.FRAG_LOADING_WAITING_RETRY:case ct.PARSING:case ct.PARSED:this.state=ct.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,i){super.flushMainBuffer(e,i,this.altAudio?"video":null)}onMediaAttached(e,i){super.onMediaAttached(e,i);const r=i.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new GCe(this.config,r,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,i=e?e.currentTime:null;Bt(i)&&this.log(`Media seeked to ${i.toFixed(3)}`);const r=this.getMainFwdBufferInfo();if(r===null||r.len===0){this.warn(`Main forward buffer length on "seeked" event ${r?r.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(ee.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(e,i){let r=!1,n=!1;i.levels.forEach(s=>{const a=s.audioCodec;a&&(r=r||a.indexOf("mp4a.40.2")!==-1,n=n||a.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=r&&n&&!kCe(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=i.levels,this.startFragRequested=!1}onLevelLoading(e,i){const{levels:r}=this;if(!r||this.state!==ct.IDLE)return;const n=r[i.level];(!n.details||n.details.live&&this.levelLastLoaded!==n||this.waitForCdnTuneIn(n.details))&&(this.state=ct.WAITING_LEVEL)}onLevelLoaded(e,i){var r;const{levels:n}=this,s=i.level,a=i.details,o=a.totalduration;if(!n){this.warn(`Levels were reset while loading level ${s}`);return}this.log(`Level ${s} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${o}`);const l=n[s],c=this.fragCurrent;c&&(this.state===ct.FRAG_LOADING||this.state===ct.FRAG_LOADING_WAITING_RETRY)&&c.level!==i.level&&c.loader&&this.abortCurrentFrag();let h=0;if(a.live||(r=l.details)!=null&&r.live){var u;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;h=this.alignPlaylists(a,l.details,(u=this.levelLastLoaded)==null?void 0:u.details)}if(l.details=a,this.levelLastLoaded=l,this.hls.trigger(ee.LEVEL_UPDATED,{details:a,level:s}),this.state===ct.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=ct.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,h),this.tick()}_handleFragmentLoadProgress(e){var i;const{frag:r,part:n,payload:s}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const o=a[r.level],l=o.details;if(!l){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const c=o.videoCodec,h=l.PTSKnown||!l.live,u=(i=r.initSegment)==null?void 0:i.data,d=this._getAudioCodec(o),f=this.transmuxer=this.transmuxer||new Mne(this.hls,Jt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=n?n.index:-1,m=p!==-1,g=new SD(r.level,r.sn,r.stats.chunkCount,s.byteLength,p,m),v=this.initPTS[r.cc];f.push(s,u,d,c,r,n,l.totalduration,h,g,v)}onAudioTrackSwitching(e,i){const r=this.altAudio;if(!!!i.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const s=this.hls;r&&(s.trigger(ee.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),s.trigger(ee.AUDIO_TRACK_SWITCHED,i)}}onAudioTrackSwitched(e,i){const r=i.id,n=!!this.hls.audioTracks[r].url;if(n){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=n,this.tick()}onBufferCreated(e,i){const r=i.tracks;let n,s,a=!1;for(const o in r){const l=r[o];if(l.id==="main"){if(s=o,n=l,o==="video"){const c=r[o];c&&(this.videoBuffer=c.buffer)}}else a=!0}a&&n?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,i){const{frag:r,part:n}=i;if(r&&r.type!==Jt.MAIN)return;if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${n?" p: "+n.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ct.PARSED&&(this.state=ct.IDLE);return}const s=n?n.stats:r.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),r.sn!=="initSegment"&&(this.fragPrevious=r),this.fragBufferedComplete(r,n)}onError(e,i){var r;if(i.fatal){this.state=ct.ERROR;return}switch(i.details){case je.FRAG_GAP:case je.FRAG_PARSING_ERROR:case je.FRAG_DECRYPT_ERROR:case je.FRAG_LOAD_ERROR:case je.FRAG_LOAD_TIMEOUT:case je.KEY_LOAD_ERROR:case je.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Jt.MAIN,i);break;case je.LEVEL_LOAD_ERROR:case je.LEVEL_LOAD_TIMEOUT:case je.LEVEL_PARSING_ERROR:!i.levelRetry&&this.state===ct.WAITING_LEVEL&&((r=i.context)==null?void 0:r.type)===ki.LEVEL&&(this.state=ct.IDLE);break;case je.BUFFER_APPEND_ERROR:case je.BUFFER_FULL_ERROR:if(!i.parent||i.parent!=="main")return;if(i.details===je.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(i)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case je.INTERNAL_EXCEPTION:this.recoverWorkerError(i);break}}checkBuffer(){const{media:e,gapController:i}=this;if(!(!e||!i||!e.readyState)){if(this.loadedmetadata||!wr.getBuffered(e).length){const r=this.state!==ct.IDLE?this.fragCurrent:null;i.poll(this.lastCurrentTime,r)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=ct.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:i}){if(i!==ir.AUDIO||this.audioOnly&&!this.altAudio){const r=(i===ir.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(r,i,Jt.MAIN),this.tick()}}onLevelsUpdated(e,i){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=i.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const i=e.currentTime;let r=this.startPosition;if(r>=0&&i<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${i}`);return}const n=wr.getBuffered(e),a=(n.length?n.start(0):0)-r;a>0&&(a<this.config.maxBufferHole||a<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${a} to match buffer start`),r+=a,this.startPosition=r),this.log(`seek to target start position ${r} from current time ${i}`),e.currentTime=r}}_getAudioCodec(e){let i=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&i&&(this.log("Swapping audio codec"),i.indexOf("mp4a.40.5")!==-1?i="mp4a.40.2":i="mp4a.40.5"),i}_loadBitrateTestFrag(e,i){e.bitrateTest=!0,this._doFragLoad(e,i).then(r=>{const{hls:n}=this;if(!r||this.fragContextChanged(e))return;i.fragmentError=0,this.state=ct.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const s=e.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),n.trigger(ee.FRAG_LOADED,r),e.bitrateTest=!1})}_handleTransmuxComplete(e){var i;const r="main",{hls:n}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:c,level:h}=o,{video:u,text:d,id3:f,initSegment:p}=s,{details:m}=h,g=this.altAudio?void 0:s.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=ct.PARSING,p){if(p!=null&&p.tracks){const x=l.initSegment||l;this._bufferInitSegment(h,p.tracks,x,a),n.trigger(ee.FRAG_PARSING_INIT_SEGMENT,{frag:x,id:r,tracks:p.tracks})}const v=p.initPTS,y=p.timescale;Bt(v)&&(this.initPTS[l.cc]={baseTime:v,timescale:y},n.trigger(ee.INIT_PTS_FOUND,{frag:l,id:r,initPTS:v,timescale:y}))}if(u&&m&&l.sn!=="initSegment"){const v=m.fragments[l.sn-1-m.startSN],y=l.sn===m.startSN,x=!v||l.cc>v.cc;if(s.independent!==!1){const{startPTS:S,endPTS:A,startDTS:_,endDTS:M}=u;if(c)c.elementaryStreams[u.type]={startPTS:S,endPTS:A,startDTS:_,endDTS:M};else if(u.firstKeyFrame&&u.independent&&a.id===1&&!x&&(this.couldBacktrack=!0),u.dropped&&u.independent){const E=this.getMainFwdBufferInfo(),T=(E?E.end:this.getLoadPosition())+this.config.maxBufferHole,C=u.firstKeyFramePTS?u.firstKeyFramePTS:S;if(!y&&T<C-this.config.maxBufferHole&&!x){this.backtrack(l);return}else x&&(l.gap=!0);l.setElementaryStreamInfo(u.type,l.start,A,l.start,M,!0)}else y&&S>oC&&(l.gap=!0);l.setElementaryStreamInfo(u.type,S,A,_,M),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(u,l,c,a,y||x)}else if(y||x)l.gap=!0;else{this.backtrack(l);return}}if(g){const{startPTS:v,endPTS:y,startDTS:x,endDTS:S}=g;c&&(c.elementaryStreams[ir.AUDIO]={startPTS:v,endPTS:y,startDTS:x,endDTS:S}),l.setElementaryStreamInfo(ir.AUDIO,v,y,x,S),this.bufferFragmentData(g,l,c,a)}if(m&&f!=null&&(i=f.samples)!=null&&i.length){const v={id:r,frag:l,details:m,samples:f.samples};n.trigger(ee.FRAG_PARSING_METADATA,v)}if(m&&d){const v={id:r,frag:l,details:m,samples:d.samples};n.trigger(ee.FRAG_PARSING_USERDATA,v)}}_bufferInitSegment(e,i,r,n){if(this.state!==ct.PARSING)return;this.audioOnly=!!i.audio&&!i.video,this.altAudio&&!this.audioOnly&&delete i.audio;const{audio:s,video:a,audiovideo:o}=i;if(s){let l=e.audioCodec;const c=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){l&&(l.indexOf("mp4a.40.5")!==-1?l="mp4a.40.2":l="mp4a.40.5");const h=s.metadata;h&&"channelCount"in h&&(h.channelCount||1)!==1&&c.indexOf("firefox")===-1&&(l="mp4a.40.5")}l&&l.indexOf("mp4a.40.5")!==-1&&c.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),e.audioCodec&&e.audioCodec!==l&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${l}"`),s.levelCodec=l,s.id="main",this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${l||""}/${e.audioCodec||""}/${s.codec}]`)}a&&(a.levelCodec=e.videoCodec,a.id="main",this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${a.codec}]`)),o&&this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),this.hls.trigger(ee.BUFFER_CODECS,i),Object.keys(i).forEach(l=>{const h=i[l].initSegment;h!=null&&h.byteLength&&this.hls.trigger(ee.BUFFER_APPENDING,{type:l,data:h,frag:r,part:null,chunkMeta:n,parent:r.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Jt.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ct.IDLE}checkFragmentChanged(){const e=this.media;let i=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(wr.isBuffered(e,r)?i=this.getAppendedFrag(r):wr.isBuffered(e,r+.1)&&(i=this.getAppendedFrag(r+.1)),i){this.backtrackFragment=null;const n=this.fragPlaying,s=i.level;(!n||i.sn!==n.sn||n.level!==s)&&(this.fragPlaying=i,this.hls.trigger(ee.FRAG_CHANGED,{frag:i}),(!n||n.level!==s)&&this.hls.trigger(ee.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const i=e.currentTime,r=this.currentFrag;if(r&&Bt(i)&&Bt(r.programDateTime)){const n=r.programDateTime+(i-r.start)*1e3;return new Date(n)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Rf{static get version(){return"1.5.17"}static isMSESupported(){return w5()}static isSupported(){return tse()}static getMediaSource(){return gp()}static get Events(){return ee}static get ErrorTypes(){return oi}static get ErrorDetails(){return je}static get DefaultConfig(){return Rf.defaultConfig?Rf.defaultConfig:Zne}static set DefaultConfig(e){Rf.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new v5,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,WAe(e.debug||!1,"Hls instance");const i=this.config=LCe(Rf.DefaultConfig,e);this.userConfig=e,i.progressive&&OCe(i);const{abrController:r,bufferController:n,capLevelController:s,errorController:a,fpsController:o}=i,l=new a(this),c=this.abrController=new r(this),h=this.bufferController=new n(this),u=this.capLevelController=new s(this),d=new o(this),f=new kEe(this),p=new VEe(this),m=i.contentSteeringController,g=m?new m(this):null,v=this.levelController=new BCe(this,g),y=new mMe(this),x=new FCe(this.config),S=this.streamController=new HCe(this,y,x);u.setStreamController(S),d.setStreamController(S);const A=[f,v,S];g&&A.splice(1,0,g),this.networkControllers=A;const _=[c,h,u,d,p,y];this.audioTrackController=this.createController(i.audioTrackController,A);const M=i.audioStreamController;M&&A.push(new M(this,y,x)),this.subtitleTrackController=this.createController(i.subtitleTrackController,A);const E=i.subtitleStreamController;E&&A.push(new E(this,y,x)),this.createController(i.timelineController,_),x.emeController=this.emeController=this.createController(i.emeController,_),this.cmcdController=this.createController(i.cmcdController,_),this.latencyController=this.createController(HEe,_),this.coreComponents=_,A.push(l);const T=l.onErrorOut;typeof T=="function"&&this.on(ee.ERROR,T,l)}createController(e,i){if(e){const r=new e(this);return i&&i.push(r),r}return null}on(e,i,r=this){this._emitter.on(e,i,r)}once(e,i,r=this){this._emitter.once(e,i,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,i,r=this,n){this._emitter.off(e,i,r,n)}listeners(e){return this._emitter.listeners(e)}emit(e,i,r){return this._emitter.emit(e,i,r)}trigger(e,i){if(this.config.debug)return this.emit(e,e,i);try{return this.emit(e,e,i)}catch(r){if(Oe.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const n=e===ee.ERROR;this.trigger(ee.ERROR,{type:oi.OTHER_ERROR,details:je.INTERNAL_EXCEPTION,fatal:n,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){Oe.log("destroy"),this.trigger(ee.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(i=>i.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(i=>i.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){Oe.log("attachMedia"),this._media=e,this.trigger(ee.MEDIA_ATTACHING,{media:e})}detachMedia(){Oe.log("detachMedia"),this.trigger(ee.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const i=this.media,r=this.url,n=this.url=s5.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,Oe.log(`loadSource:${n}`),i&&r&&(r!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(i)),this.trigger(ee.MANIFEST_LOADING,{url:e})}startLoad(e=-1){Oe.log(`startLoad(${e})`),this.started=!0,this.networkControllers.forEach(i=>{i.startLoad(e)})}stopLoad(){Oe.log("stopLoad"),this.started=!1,this.networkControllers.forEach(e=>{e.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.stopLoad()})}swapAudioCodec(){Oe.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){Oe.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e){this.levelController.removeLevel(e)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){Oe.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){Oe.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){Oe.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){Oe.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){Oe.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const i=!!e;i!==this.config.capLevelToPlayerSize&&(i?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=i)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(Oe.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){jEe(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:i}}=this;if(!e)return 0;const r=e.length;for(let n=0;n<r;n++)if(e[n].maxBitrate>=i)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:i,maxHdcpLevel:r}=this;let n;if(i===-1&&e!=null&&e.length?n=e.length-1:n=i,r)for(let s=n;s--;){const a=e[s].attrs["HDCP-LEVEL"];if(a&&a<=r)return s}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(e){var i;return(i=this.audioTrackController)==null?void 0:i.setAudioOption(e)}setSubtitleOption(e){var i;return(i=this.subtitleTrackController)==null||i.setSubtitleOption(e),null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const i=this.audioTrackController;i&&(i.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const i=this.subtitleTrackController;i&&(i.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const i=this.subtitleTrackController;i&&(i.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Rf.defaultConfig=void 0;const jCe=Object.freeze(Object.defineProperty({__proto__:null,AbrController:lne,AttrList:Ir,AudioStreamController:Cne,AudioTrackController:Pne,BasePlaylistController:wD,BaseSegment:o5,BaseStreamController:_D,BufferController:Ine,CMCDController:Kne,CapLevelController:AD,ChunkMetadata:SD,ContentSteeringController:Qne,DateRange:a5,EMEController:pg,ErrorActionFlags:gl,ErrorController:ane,ErrorDetails:je,ErrorTypes:oi,Events:ee,FPSController:Hne,Fragment:eC,Hls:Rf,HlsSkip:lw,HlsUrlParameters:yk,KeySystemFormats:Ba,KeySystems:gr,Level:Ug,LevelDetails:Ure,LevelKey:i1,LoadStats:S_,MetadataSchema:Pl,NetworkErrorAction:Qn,Part:Nre,PlaylistLevelType:Jt,SubtitleStreamController:Dne,SubtitleTrackController:Rne,TimelineController:Gne,default:Rf,getMediaSource:gp,isMSESupported:w5,isSupported:tse},Symbol.toStringTag,{value:"Module"}));var q9,K9;const WCe=typeof window<"u"&&typeof((q9=window.document)==null?void 0:q9.createElement)=="function"&&typeof((K9=window.navigator)==null?void 0:K9.userAgent)=="string";let e3=null;async function XCe(...t){var e;(e=e3)!==null&&e!==void 0||(e3=await Td(()=>Promise.resolve().then(()=>jCe),void 0));const i=e3.default;return i.isSupported()?new i(...t):null}function YCe(t,{unsuspend:e="loadedmetadata",start:i=!0,hls:r={},crossOrigin:n="anonymous",muted:s=!0,loop:a=!0,playsInline:o=!0,...l}={}){const c=eo(d=>d.gl),h=we.useRef(null),u=ure(()=>new Promise(async d=>{let f,p;typeof t=="string"?f=t:p=t;const m=Object.assign(document.createElement("video"),{src:f,srcObject:p,crossOrigin:n,loop:a,muted:s,playsInline:o,...l});if(f&&WCe&&f.endsWith(".m3u8")){const v=h.current=await XCe(r);v&&(v.on(ee.MEDIA_ATTACHED,()=>void v.loadSource(f)),v.attachMedia(m))}const g=new Cie(m);"colorSpace"in g?g.colorSpace=c.outputColorSpace:g.encoding=c.outputEncoding,m.addEventListener(e,()=>d(g))}),[t]);return we.useEffect(()=>(i&&u.image.play(),()=>{h.current&&(h.current.destroy(),h.current=null)}),[u,i]),u}const ise=we.forwardRef(function({children:e,disable:i,disableX:r,disableY:n,disableZ:s,left:a,right:o,top:l,bottom:c,front:h,back:u,onCentered:d,precise:f=!0,cacheKey:p=0,...m},g){const v=we.useRef(null),y=we.useRef(null),x=we.useRef(null);return we.useLayoutEffect(()=>{y.current.matrixWorld.identity();const S=new Ad().setFromObject(x.current,f),A=new le,_=new Ed,M=S.max.x-S.min.x,E=S.max.y-S.min.y,T=S.max.z-S.min.z;S.getCenter(A),S.getBoundingSphere(_);const C=l?E/2:c?-E/2:0,D=a?-M/2:o?M/2:0,B=h?T/2:u?-T/2:0;y.current.position.set(i||r?0:-A.x+D,i||n?0:-A.y+C,i||s?0:-A.z+B),typeof d<"u"&&d({parent:v.current.parent,container:v.current,width:M,height:E,depth:T,boundingBox:S,boundingSphere:_,center:A,verticalAlignment:C,horizontalAlignment:D,depthAlignment:B})},[p,d,l,a,h,i,r,n,s,f,o,c,u]),we.useImperativeHandle(g,()=>v.current,[]),we.createElement("group",lS({ref:v},m),we.createElement("group",{ref:y},we.createElement("group",{ref:x},e)))}),rse=we.forwardRef(({children:t,enabled:e=!0,speed:i=1,rotationIntensity:r=1,floatIntensity:n=1,floatingRange:s=[-.1,.1],autoInvalidate:a=!1,...o},l)=>{const c=we.useRef(null);we.useImperativeHandle(l,()=>c.current,[]);const h=we.useRef(Math.random()*1e4);return gD(u=>{var d,f;if(!e||i===0)return;a&&u.invalidate();const p=h.current+u.clock.getElapsedTime();c.current.rotation.x=Math.cos(p/4*i)/8*r,c.current.rotation.y=Math.sin(p/4*i)/8*r,c.current.rotation.z=Math.sin(p/4*i)/20*r;let m=Math.sin(p/4*i)/10;m=x4.mapLinear(m,-.1,.1,(d=s==null?void 0:s[0])!==null&&d!==void 0?d:-.1,(f=s==null?void 0:s[1])!==null&&f!==void 0?f:.1),c.current.position.y=m*n,c.current.updateMatrix()}),we.createElement("group",o,we.createElement("group",{ref:c,matrixAutoUpdate:!1},t))});function qCe({all:t,scene:e,camera:i}){const r=eo(({gl:a})=>a),n=eo(({camera:a})=>a),s=eo(({scene:a})=>a);return we.useLayoutEffect(()=>{const a=[];t&&(e||s).traverse(c=>{c.visible===!1&&(a.push(c),c.visible=!0)}),r.compile(e||s,i||n);const o=new A4(128);new _4(.01,1e5,o).update(r,e||s),o.dispose(),a.forEach(c=>c.visible=!1)},[]),null}var KCe=Object.create,ED=Object.defineProperty,QCe=Object.getOwnPropertyDescriptor,$Ce=Object.getOwnPropertyNames,JCe=Object.getPrototypeOf,ZCe=Object.prototype.hasOwnProperty,e2e=(t,e,i)=>e in t?ED(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,r0=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),t2e=(t,e)=>{for(var i in e)ED(t,i,{get:e[i],enumerable:!0})},i2e=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of $Ce(e))!ZCe.call(t,n)&&n!==i&&ED(t,n,{get:()=>e[n],enumerable:!(r=QCe(e,n))||r.enumerable});return t},Ip=(t,e,i)=>(i=t!=null?KCe(JCe(t)):{},i2e(e||!t||!t.__esModule?ED(i,"default",{value:t,enumerable:!0}):i,t)),Ib=(t,e,i)=>(e2e(t,typeof e!="symbol"?e+"":e,i),i),r2e=r0((t,e)=>{(function(i,r){typeof t=="object"?e.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(t,function(){return i.importState=function(n){var s=new i;return s.importState(n),s},i;function i(){return function(n){var s=0,a=0,o=0,l=1;n.length==0&&(n=[+new Date]);var c=r();s=c(" "),a=c(" "),o=c(" ");for(var h=0;h<n.length;h++)s-=c(n[h]),s<0&&(s+=1),a-=c(n[h]),a<0&&(a+=1),o-=c(n[h]),o<0&&(o+=1);c=null;var u=function(){var d=2091639*s+l*23283064365386963e-26;return s=a,a=o,o=d-(l=d|0)};return u.next=u,u.uint32=function(){return u()*4294967296},u.fract53=function(){return u()+(u()*2097152|0)*11102230246251565e-32},u.version="Alea 0.9",u.args=n,u.exportState=function(){return[s,a,o,l]},u.importState=function(d){s=+d[0]||0,a=+d[1]||0,o=+d[2]||0,l=+d[3]||0},u}(Array.prototype.slice.call(arguments))}function r(){var n=4022871197,s=function(a){a=a.toString();for(var o=0;o<a.length;o++){n+=a.charCodeAt(o);var l=.02519603282416938*n;n=l>>>0,l-=n,l*=n,n=l>>>0,l-=n,n+=l*4294967296}return(n>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})}),nse=r0((t,e)=>{(function(i,r){typeof t=="object"&&typeof e<"u"?r(t):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(t,function(i){i.SVD=function(r,n,s,a,o){if(n=n===void 0||n,s=s===void 0||s,o=1e-64/(a=a||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var l,c,h,u,d,f,p,m,g,v,y,x,S=r[0].length,A=r.length;if(A<S)throw new TypeError("Invalid matrix: m < n");for(var _=[],M=[],E=[],T=n==="f"?A:S,C=v=p=0;C<A;C++)M[C]=new Array(T).fill(0);for(C=0;C<S;C++)E[C]=new Array(S).fill(0);var D,B=new Array(S).fill(0);for(C=0;C<A;C++)for(l=0;l<S;l++)M[C][l]=r[C][l];for(C=0;C<S;C++){for(_[C]=p,g=0,h=C+1,l=C;l<A;l++)g+=Math.pow(M[l][C],2);if(g<o)p=0;else for(m=(f=M[C][C])*(p=f<0?Math.sqrt(g):-Math.sqrt(g))-g,M[C][C]=f-p,l=h;l<S;l++){for(g=0,c=C;c<A;c++)g+=M[c][C]*M[c][l];for(f=g/m,c=C;c<A;c++)M[c][l]=M[c][l]+f*M[c][C]}for(B[C]=p,g=0,l=h;l<S;l++)g+=Math.pow(M[C][l],2);if(g<o)p=0;else{for(m=(f=M[C][C+1])*(p=f<0?Math.sqrt(g):-Math.sqrt(g))-g,M[C][C+1]=f-p,l=h;l<S;l++)_[l]=M[C][l]/m;for(l=h;l<A;l++){for(g=0,c=h;c<S;c++)g+=M[l][c]*M[C][c];for(c=h;c<S;c++)M[l][c]=M[l][c]+g*_[c]}}v<(y=Math.abs(B[C])+Math.abs(_[C]))&&(v=y)}if(s)for(C=S-1;0<=C;C--){if(p!==0){for(m=M[C][C+1]*p,l=h;l<S;l++)E[l][C]=M[C][l]/m;for(l=h;l<S;l++){for(g=0,c=h;c<S;c++)g+=M[C][c]*E[c][l];for(c=h;c<S;c++)E[c][l]=E[c][l]+g*E[c][C]}}for(l=h;l<S;l++)E[C][l]=0,E[l][C]=0;E[C][C]=1,p=_[C],h=C}if(n){if(n==="f")for(C=S;C<A;C++){for(l=S;l<A;l++)M[C][l]=0;M[C][C]=1}for(C=S-1;0<=C;C--){for(h=C+1,p=B[C],l=h;l<T;l++)M[C][l]=0;if(p!==0){for(m=M[C][C]*p,l=h;l<T;l++){for(g=0,c=h;c<A;c++)g+=M[c][C]*M[c][l];for(f=g/m,c=C;c<A;c++)M[c][l]=M[c][l]+f*M[c][C]}for(l=C;l<A;l++)M[l][C]=M[l][C]/p}else for(l=C;l<A;l++)M[l][C]=0;M[C][C]=M[C][C]+1}}for(a*=v,c=S-1;0<=c;c--)for(var O=0;O<50;O++){for(D=!1,h=c;0<=h;h--){if(Math.abs(_[h])<=a){D=!0;break}if(Math.abs(B[h-1])<=a)break}if(!D){for(d=0,u=h-(g=1),C=h;C<c+1&&(f=g*_[C],_[C]=d*_[C],!(Math.abs(f)<=a));C++)if(p=B[C],B[C]=Math.sqrt(f*f+p*p),d=p/(m=B[C]),g=-f/m,n)for(l=0;l<A;l++)y=M[l][u],x=M[l][C],M[l][u]=y*d+x*g,M[l][C]=-y*g+x*d}if(x=B[c],h===c){if(x<0&&(B[c]=-x,s))for(l=0;l<S;l++)E[l][c]=-E[l][c];break}for(v=B[h],f=(((y=B[c-1])-x)*(y+x)+((p=_[c-1])-(m=_[c]))*(p+m))/(2*m*y),p=Math.sqrt(f*f+1),f=((v-x)*(v+x)+m*(y/(f<0?f-p:f+p)-m))/v,C=h+(g=d=1);C<c+1;C++){if(p=_[C],y=B[C],m=g*p,p*=d,x=Math.sqrt(f*f+m*m),f=v*(d=f/(_[C-1]=x))+p*(g=m/x),p=-v*g+p*d,m=y*g,y*=d,s)for(l=0;l<S;l++)v=E[l][C-1],x=E[l][C],E[l][C-1]=v*d+x*g,E[l][C]=-v*g+x*d;if(x=Math.sqrt(f*f+m*m),f=(d=f/(B[C-1]=x))*p+(g=m/x)*y,v=-g*p+d*y,n)for(l=0;l<A;l++)y=M[l][C-1],x=M[l][C],M[l][C-1]=y*d+x*g,M[l][C]=-y*g+x*d}_[h]=0,_[c]=f,B[c]=v}for(C=0;C<S;C++)B[C]<a&&(B[C]=0);return{u:M,q:B,v:E}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),n2e=r0((t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;function i(r){if(r===null||r===!0||r===!1)return NaN;var n=Number(r);return isNaN(n)?n:n<0?Math.ceil(n):Math.floor(n)}e.exports=t.default}),s2e=r0((t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;function i(r){var n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return n.setUTCFullYear(r.getFullYear()),r.getTime()-n.getTime()}e.exports=t.default}),a2e=r0((t,e)=>{function i(s,a){function o(){this.constructor=s}o.prototype=a.prototype,s.prototype=new o}function r(s,a,o,l){this.message=s,this.expected=a,this.found=o,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}i(r,Error),r.buildMessage=function(s,a){var o={literal:function(p){return'"'+c(p.text)+'"'},class:function(p){var m="",g;for(g=0;g<p.parts.length;g++)m+=p.parts[g]instanceof Array?h(p.parts[g][0])+"-"+h(p.parts[g][1]):h(p.parts[g]);return"["+(p.inverted?"^":"")+m+"]"},any:function(p){return"any character"},end:function(p){return"end of input"},other:function(p){return p.description}};function l(p){return p.charCodeAt(0).toString(16).toUpperCase()}function c(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+l(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+l(m)})}function h(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+l(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+l(m)})}function u(p){return o[p.type](p)}function d(p){var m=new Array(p.length),g,v;for(g=0;g<p.length;g++)m[g]=u(p[g]);if(m.sort(),m.length>0){for(g=1,v=1;g<m.length;g++)m[g-1]!==m[g]&&(m[v]=m[g],v++);m.length=v}switch(m.length){case 1:return m[0];case 2:return m[0]+" or "+m[1];default:return m.slice(0,-1).join(", ")+", or "+m[m.length-1]}}function f(p){return p?'"'+c(p)+'"':"end of input"}return"Expected "+d(s)+" but "+f(a)+" found."};function n(s,a){a=a!==void 0?a:{};var o={},l={svg_path:mt},c=mt,h=function($){if(!$)return[];for(var te=[],be=0;be<$.length;be++)te=te.concat.apply(te,$[be]);var ne=te[0];return ne&&ne.code=="m"&&(delete ne.relative,ne.code="M"),te},u=function($,te){return Dr($,te)},d=/^[Mm]/,f=Qe(["M","m"],!1,!1),p=function($,te,be){var ne=Nr($,[te]);return be&&(ne=ne.concat(Nr($=="M"?"L":"l",be[1]))),ne},m=/^[Zz]/,g=Qe(["Z","z"],!1,!1),v=function(){return Nr("Z")},y=/^[Ll]/,x=Qe(["L","l"],!1,!1),S=function($,te){return Nr($,te)},A=/^[Hh]/,_=Qe(["H","h"],!1,!1),M=function($,te){return Nr($,te.map(function(be){return{x:be}}))},E=/^[Vv]/,T=Qe(["V","v"],!1,!1),C=function($,te){return Nr($,te.map(function(be){return{y:be}}))},D=/^[Cc]/,B=Qe(["C","c"],!1,!1),O=function($,te,be){return{x1:$.x,y1:$.y,x2:te.x,y2:te.y,x:be.x,y:be.y}},L=/^[Ss]/,H=Qe(["S","s"],!1,!1),q=function($,te){return{x2:$.x,y2:$.y,x:te.x,y:te.y}},W=/^[Qq]/,I=Qe(["Q","q"],!1,!1),z=function($,te){return{x1:$.x,y1:$.y,x:te.x,y:te.y}},U=/^[Tt]/,X=Qe(["T","t"],!1,!1),Q=/^[Aa]/,re=Qe(["A","a"],!1,!1),ie=function($,te,be,ne,Te,lt){return{rx:$,ry:te,xAxisRotation:be,largeArc:ne,sweep:Te,x:lt.x,y:lt.y}},ce=function($,te){return{x:$,y:te}},Z=function($){return $*1},Ae=function($){return $.join("")*1},Se=/^[01]/,_e=Qe(["0","1"],!1,!1),ve=function($){return $=="1"},Ee=function(){return""},fe=",",pe=$e(",",!1),Ie=function($){return $.join("")},Le=".",Ge=$e(".",!1),Ke=/^[eE]/,Ve=Qe(["e","E"],!1,!1),ke=/^[+\-]/,ut=Qe(["+","-"],!1,!1),dt=/^[0-9]/,V=Qe([["0","9"]],!1,!1),F=function($){return $.join("")},oe=/^[ \t\n\r]/,Ce=Qe([" ","	",`
`,"\r"],!1,!1),K=0,Re=[{line:1,column:1}],Ze=0,Ne=[],me;if("startRule"in a){if(!(a.startRule in l))throw new Error(`Can't start parsing from rule "`+a.startRule+'".');c=l[a.startRule]}function $e($,te){return{type:"literal",text:$,ignoreCase:te}}function Qe($,te,be){return{type:"class",parts:$,inverted:te,ignoreCase:be}}function Je(){return{type:"end"}}function ot($){var te=Re[$],be;if(te)return te;for(be=$-1;!Re[be];)be--;for(te=Re[be],te={line:te.line,column:te.column};be<$;)s.charCodeAt(be)===10?(te.line++,te.column=1):te.column++,be++;return Re[$]=te,te}function nt($,te){var be=ot($),ne=ot(te);return{start:{offset:$,line:be.line,column:be.column},end:{offset:te,line:ne.line,column:ne.column}}}function de($){K<Ze||(K>Ze&&(Ze=K,Ne=[]),Ne.push($))}function Xe($,te,be){return new r(r.buildMessage($,te),$,te,be)}function mt(){var $,te,be,ne,Te;for($=K,te=[],be=Ft();be!==o;)te.push(be),be=Ft();if(te!==o)if(be=J(),be===o&&(be=null),be!==o){for(ne=[],Te=Ft();Te!==o;)ne.push(Te),Te=Ft();ne!==o?(te=h(be),$=te):(K=$,$=o)}else K=$,$=o;else K=$,$=o;return $}function J(){var $,te,be,ne,Te,lt;if($=K,te=he(),te!==o){for(be=[],ne=K,Te=[],lt=Ft();lt!==o;)Te.push(lt),lt=Ft();for(Te!==o?(lt=he(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);ne!==o;){for(be.push(ne),ne=K,Te=[],lt=Ft();lt!==o;)Te.push(lt),lt=Ft();Te!==o?(lt=he(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o)}be!==o?(te=u(te,be),$=te):(K=$,$=o)}else K=$,$=o;return $}function he(){var $,te,be,ne,Te,lt;if($=K,te=Ue(),te!==o){for(be=[],ne=K,Te=[],lt=Ft();lt!==o;)Te.push(lt),lt=Ft();for(Te!==o?(lt=Me(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);ne!==o;){for(be.push(ne),ne=K,Te=[],lt=Ft();lt!==o;)Te.push(lt),lt=Ft();Te!==o?(lt=Me(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o)}be!==o?(te=u(te,be),$=te):(K=$,$=o)}else K=$,$=o;return $}function Me(){var $;return $=at(),$===o&&($=Mt(),$===o&&($=ci(),$===o&&($=Gt(),$===o&&($=Qi(),$===o&&($=Np(),$===o&&($=G(),$===o&&($=se(),$===o&&($=rt())))))))),$}function Ue(){var $,te,be,ne,Te,lt,Vn;if($=K,d.test(s.charAt(K))?(te=s.charAt(K),K++):(te=o,de(f)),te!==o){for(be=[],ne=Ft();ne!==o;)be.push(ne),ne=Ft();be!==o?(ne=ht(),ne!==o?(Te=K,lt=It(),lt===o&&(lt=null),lt!==o?(Vn=Qt(),Vn!==o?(lt=[lt,Vn],Te=lt):(K=Te,Te=o)):(K=Te,Te=o),Te===o&&(Te=null),Te!==o?(te=p(te,ne,Te),$=te):(K=$,$=o)):(K=$,$=o)):(K=$,$=o)}else K=$,$=o;return $}function at(){var $,te;return $=K,m.test(s.charAt(K))?(te=s.charAt(K),K++):(te=o,de(g)),te!==o&&(te=v()),$=te,$}function Mt(){var $,te,be,ne;if($=K,y.test(s.charAt(K))?(te=s.charAt(K),K++):(te=o,de(x)),te!==o){for(be=[],ne=Ft();ne!==o;)be.push(ne),ne=Ft();be!==o?(ne=Qt(),ne!==o?(te=S(te,ne),$=te):(K=$,$=o)):(K=$,$=o)}else K=$,$=o;return $}function Qt(){var $,te,be,ne,Te,lt;if($=K,te=ht(),te!==o){for(be=[],ne=K,Te=It(),Te===o&&(Te=null),Te!==o?(lt=ht(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);ne!==o;)be.push(ne),ne=K,Te=It(),Te===o&&(Te=null),Te!==o?(lt=ht(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);be!==o?(te=u(te,be),$=te):(K=$,$=o)}else K=$,$=o;return $}function ci(){var $,te,be,ne;if($=K,A.test(s.charAt(K))?(te=s.charAt(K),K++):(te=o,de(_)),te!==o){for(be=[],ne=Ft();ne!==o;)be.push(ne),ne=Ft();be!==o?(ne=ur(),ne!==o?(te=M(te,ne),$=te):(K=$,$=o)):(K=$,$=o)}else K=$,$=o;return $}function ur(){var $,te,be,ne,Te,lt;if($=K,te=wt(),te!==o){for(be=[],ne=K,Te=It(),Te===o&&(Te=null),Te!==o?(lt=wt(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);ne!==o;)be.push(ne),ne=K,Te=It(),Te===o&&(Te=null),Te!==o?(lt=wt(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);be!==o?(te=u(te,be),$=te):(K=$,$=o)}else K=$,$=o;return $}function Gt(){var $,te,be,ne;if($=K,E.test(s.charAt(K))?(te=s.charAt(K),K++):(te=o,de(T)),te!==o){for(be=[],ne=Ft();ne!==o;)be.push(ne),ne=Ft();be!==o?(ne=ur(),ne!==o?(te=C(te,ne),$=te):(K=$,$=o)):(K=$,$=o)}else K=$,$=o;return $}function Qi(){var $,te,be,ne;if($=K,D.test(s.charAt(K))?(te=s.charAt(K),K++):(te=o,de(B)),te!==o){for(be=[],ne=Ft();ne!==o;)be.push(ne),ne=Ft();be!==o?(ne=Bi(),ne!==o?(te=S(te,ne),$=te):(K=$,$=o)):(K=$,$=o)}else K=$,$=o;return $}function Bi(){var $,te,be,ne,Te,lt;if($=K,te=Kl(),te!==o){for(be=[],ne=K,Te=It(),Te===o&&(Te=null),Te!==o?(lt=Kl(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);ne!==o;)be.push(ne),ne=K,Te=It(),Te===o&&(Te=null),Te!==o?(lt=Kl(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);be!==o?(te=u(te,be),$=te):(K=$,$=o)}else K=$,$=o;return $}function Kl(){var $,te,be,ne,Te,lt;return $=K,te=ht(),te!==o?(be=It(),be===o&&(be=null),be!==o?(ne=ht(),ne!==o?(Te=It(),Te===o&&(Te=null),Te!==o?(lt=ht(),lt!==o?(te=O(te,ne,lt),$=te):(K=$,$=o)):(K=$,$=o)):(K=$,$=o)):(K=$,$=o)):(K=$,$=o),$}function Np(){var $,te,be,ne;if($=K,L.test(s.charAt(K))?(te=s.charAt(K),K++):(te=o,de(H)),te!==o){for(be=[],ne=Ft();ne!==o;)be.push(ne),ne=Ft();be!==o?(ne=Dd(),ne!==o?(te=S(te,ne),$=te):(K=$,$=o)):(K=$,$=o)}else K=$,$=o;return $}function Dd(){var $,te,be,ne,Te,lt;if($=K,te=Ql(),te!==o){for(be=[],ne=K,Te=It(),Te===o&&(Te=null),Te!==o?(lt=Ql(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);ne!==o;)be.push(ne),ne=K,Te=It(),Te===o&&(Te=null),Te!==o?(lt=Ql(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);be!==o?(te=u(te,be),$=te):(K=$,$=o)}else K=$,$=o;return $}function Ql(){var $,te,be,ne;return $=K,te=ht(),te!==o?(be=It(),be===o&&(be=null),be!==o?(ne=ht(),ne!==o?(te=q(te,ne),$=te):(K=$,$=o)):(K=$,$=o)):(K=$,$=o),$}function G(){var $,te,be,ne;if($=K,W.test(s.charAt(K))?(te=s.charAt(K),K++):(te=o,de(I)),te!==o){for(be=[],ne=Ft();ne!==o;)be.push(ne),ne=Ft();be!==o?(ne=ae(),ne!==o?(te=S(te,ne),$=te):(K=$,$=o)):(K=$,$=o)}else K=$,$=o;return $}function ae(){var $,te,be,ne,Te,lt;if($=K,te=ge(),te!==o){for(be=[],ne=K,Te=It(),Te===o&&(Te=null),Te!==o?(lt=ge(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);ne!==o;)be.push(ne),ne=K,Te=It(),Te===o&&(Te=null),Te!==o?(lt=ge(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);be!==o?(te=u(te,be),$=te):(K=$,$=o)}else K=$,$=o;return $}function ge(){var $,te,be,ne;return $=K,te=ht(),te!==o?(be=It(),be===o&&(be=null),be!==o?(ne=ht(),ne!==o?(te=z(te,ne),$=te):(K=$,$=o)):(K=$,$=o)):(K=$,$=o),$}function se(){var $,te,be,ne;if($=K,U.test(s.charAt(K))?(te=s.charAt(K),K++):(te=o,de(X)),te!==o){for(be=[],ne=Ft();ne!==o;)be.push(ne),ne=Ft();be!==o?(ne=xe(),ne!==o?(te=S(te,ne),$=te):(K=$,$=o)):(K=$,$=o)}else K=$,$=o;return $}function xe(){var $,te,be,ne,Te,lt;if($=K,te=ht(),te!==o){for(be=[],ne=K,Te=It(),Te===o&&(Te=null),Te!==o?(lt=ht(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);ne!==o;)be.push(ne),ne=K,Te=It(),Te===o&&(Te=null),Te!==o?(lt=ht(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);be!==o?(te=u(te,be),$=te):(K=$,$=o)}else K=$,$=o;return $}function rt(){var $,te,be,ne;if($=K,Q.test(s.charAt(K))?(te=s.charAt(K),K++):(te=o,de(re)),te!==o){for(be=[],ne=Ft();ne!==o;)be.push(ne),ne=Ft();be!==o?(ne=ft(),ne!==o?(te=S(te,ne),$=te):(K=$,$=o)):(K=$,$=o)}else K=$,$=o;return $}function ft(){var $,te,be,ne,Te,lt;if($=K,te=gt(),te!==o){for(be=[],ne=K,Te=It(),Te===o&&(Te=null),Te!==o?(lt=gt(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);ne!==o;)be.push(ne),ne=K,Te=It(),Te===o&&(Te=null),Te!==o?(lt=gt(),lt!==o?(Te=[Te,lt],ne=Te):(K=ne,ne=o)):(K=ne,ne=o);be!==o?(te=u(te,be),$=te):(K=$,$=o)}else K=$,$=o;return $}function gt(){var $,te,be,ne,Te,lt,Vn,cs,$h,u0,Up,Rd;return $=K,te=Lt(),te!==o?(be=It(),be===o&&(be=null),be!==o?(ne=Lt(),ne!==o?(Te=It(),Te===o&&(Te=null),Te!==o?(lt=wt(),lt!==o?(Vn=It(),Vn!==o?(cs=_t(),cs!==o?($h=It(),$h===o&&($h=null),$h!==o?(u0=_t(),u0!==o?(Up=It(),Up===o&&(Up=null),Up!==o?(Rd=ht(),Rd!==o?(te=ie(te,ne,lt,cs,u0,Rd),$=te):(K=$,$=o)):(K=$,$=o)):(K=$,$=o)):(K=$,$=o)):(K=$,$=o)):(K=$,$=o)):(K=$,$=o)):(K=$,$=o)):(K=$,$=o)):(K=$,$=o)):(K=$,$=o),$}function ht(){var $,te,be,ne;return $=K,te=wt(),te!==o?(be=It(),be===o&&(be=null),be!==o?(ne=wt(),ne!==o?(te=ce(te,ne),$=te):(K=$,$=o)):(K=$,$=o)):(K=$,$=o),$}function Lt(){var $,te;return $=K,te=cn(),te===o&&(te=$r()),te!==o&&(te=Z(te)),$=te,$}function wt(){var $,te,be,ne;return $=K,te=K,be=At(),be===o&&(be=null),be!==o?(ne=cn(),ne!==o?(be=[be,ne],te=be):(K=te,te=o)):(K=te,te=o),te===o&&(te=K,be=At(),be===o&&(be=null),be!==o?(ne=$r(),ne!==o?(be=[be,ne],te=be):(K=te,te=o)):(K=te,te=o)),te!==o&&(te=Ae(te)),$=te,$}function _t(){var $,te;return $=K,Se.test(s.charAt(K))?(te=s.charAt(K),K++):(te=o,de(_e)),te!==o&&(te=ve(te)),$=te,$}function It(){var $,te,be,ne,Te;if($=K,te=[],be=Ft(),be!==o)for(;be!==o;)te.push(be),be=Ft();else te=o;if(te!==o)if(be=Zi(),be===o&&(be=null),be!==o){for(ne=[],Te=Ft();Te!==o;)ne.push(Te),Te=Ft();ne!==o?(te=[te,be,ne],$=te):(K=$,$=o)}else K=$,$=o;else K=$,$=o;if($===o){if($=K,te=K,be=Zi(),be!==o){for(ne=[],Te=Ft();Te!==o;)ne.push(Te),Te=Ft();ne!==o?(be=[be,ne],te=be):(K=te,te=o)}else K=te,te=o;te!==o&&(te=Ee()),$=te}return $}function Zi(){var $;return s.charCodeAt(K)===44?($=fe,K++):($=o,de(pe)),$}function cn(){var $,te,be,ne;return $=K,te=K,be=ls(),be!==o?(ne=Ai(),ne===o&&(ne=null),ne!==o?(be=[be,ne],te=be):(K=te,te=o)):(K=te,te=o),te===o&&(te=K,be=$r(),be!==o?(ne=Ai(),ne!==o?(be=[be,ne],te=be):(K=te,te=o)):(K=te,te=o)),te!==o&&(te=Ie(te)),$=te,$}function ls(){var $,te,be,ne,Te;return $=K,te=K,be=$r(),be===o&&(be=null),be!==o?(s.charCodeAt(K)===46?(ne=Le,K++):(ne=o,de(Ge)),ne!==o?(Te=$r(),Te!==o?(be=[be,ne,Te],te=be):(K=te,te=o)):(K=te,te=o)):(K=te,te=o),te===o&&(te=K,be=$r(),be!==o?(s.charCodeAt(K)===46?(ne=Le,K++):(ne=o,de(Ge)),ne!==o?(be=[be,ne],te=be):(K=te,te=o)):(K=te,te=o)),te!==o&&(te=Ie(te)),$=te,$}function Ai(){var $,te,be,ne,Te;return $=K,te=K,Ke.test(s.charAt(K))?(be=s.charAt(K),K++):(be=o,de(Ve)),be!==o?(ne=At(),ne===o&&(ne=null),ne!==o?(Te=$r(),Te!==o?(be=[be,ne,Te],te=be):(K=te,te=o)):(K=te,te=o)):(K=te,te=o),te!==o&&(te=Ie(te)),$=te,$}function At(){var $;return ke.test(s.charAt(K))?($=s.charAt(K),K++):($=o,de(ut)),$}function $r(){var $,te,be;if($=K,te=[],dt.test(s.charAt(K))?(be=s.charAt(K),K++):(be=o,de(V)),be!==o)for(;be!==o;)te.push(be),dt.test(s.charAt(K))?(be=s.charAt(K),K++):(be=o,de(V));else te=o;return te!==o&&(te=F(te)),$=te,$}function Ft(){var $,te;return $=K,oe.test(s.charAt(K))?(te=s.charAt(K),K++):(te=o,de(Ce)),te!==o&&(te=Ee()),$=te,$}function Dr($,te){if(!te)return[$];for(var be=[$],ne=0,Te=te.length;ne<Te;ne++)be[ne+1]=te[ne][1];return be}var En={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var hn in En)En[hn.toUpperCase()]=En[hn];function Nr($,te){te||(te=[{}]);for(var be=te.length;be--;){var ne={code:$,command:En[$]};$==$.toLowerCase()&&(ne.relative=!0);for(var Te in te[be])ne[Te]=te[be][Te];te[be]=ne}return te}if(me=c(),me!==o&&K===s.length)return me;throw me!==o&&K<s.length&&de(Je()),Xe(Ne,Ze<s.length?s.charAt(Ze):null,Ze<s.length?nt(Ze,Ze+1):nt(Ze,Ze))}e.exports={SyntaxError:r,parse:n}}),sse=r0((t,e)=>{var i=a2e().parse;i.parseSVG=i,i.makeAbsolute=r,e.exports=i;function r(n){var s,a={x:0,y:0},o={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return n.forEach(function(l){l.command==="moveto"&&(s=l),l.x0=a.x,l.y0=a.y;for(var c in o)c in l&&(l[c]+=l.relative?l[o[c]]:0);"x"in l||(l.x=a.x),"y"in l||(l.y=a.y),l.relative=!1,l.code=l.code.toUpperCase(),l.command=="closepath"&&(l.x=s.x,l.y=s.y),a=l}),n}}),o2e=r0((t,e)=>{e.exports=function(i,r){for(var n=i.split("."),s=r.split("."),a=0;a<3;a++){var o=Number(n[a]),l=Number(s[a]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0}}),z1="149",ll={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},l2e=0,Q9=1,c2e=2,S5=1,h2e=2,Lb=3,Lc=0,Ts=1,pa=2,Nn=0,mg=1,$9=2,J9=3,Z9=4,u2e=5,Rv=100,d2e=101,f2e=102,e7=103,t7=104,p2e=200,m2e=201,g2e=202,v2e=203,ase=204,ose=205,y2e=206,x2e=207,b2e=208,w2e=209,S2e=210,_2e=0,A2e=1,E2e=2,Ck=3,M2e=4,T2e=5,C2e=6,P2e=7,lse=0,D2e=1,R2e=2,Lh=0,I2e=1,L2e=2,O2e=3,B2e=4,F2e=5,cse=300,zg=301,Gg=302,Pk=303,Dk=304,__=306,qu=1e3,Cr=1001,Rk=1002,bi=1003,i7=1004,t3=1005,mi=1006,k2e=1007,s1=1008,ba=1009,N2e=1010,U2e=1011,hse=1012,z2e=1013,Ku=1014,tr=1015,fd=1016,G2e=1017,V2e=1018,gg=1020,H2e=1021,Fr=1023,j2e=1024,W2e=1025,vg=1026,Vg=1027,lC=1028,X2e=1029,b2=1030,Y2e=1031,use=1033,i3=33776,r3=33777,n3=33778,s3=33779,r7=35840,n7=35841,s7=35842,a7=35843,q2e=36196,o7=37492,l7=37496,c7=37808,h7=37809,u7=37810,d7=37811,f7=37812,p7=37813,m7=37814,g7=37815,v7=37816,y7=37817,x7=37818,b7=37819,w7=37820,S7=37821,a3=36492,K2e=36283,_7=36284,A7=36285,E7=36286,dse=2200,fse=2201,_5=2202,w2=2300,S2=2301,o3=2302,iy=2400,ry=2401,_2=2402,A5=2500,Q2e=2501,Oc=3e3,fi=3001,Cd=3200,pse=3201,$2e=0,J2e=1,fh="srgb",A2="srgb-linear",l3=7680,Z2e=519,Ik=35044,ePe=35048,Lk="300 es",Ok=1035,Js=class{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;let i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;let i=this._listeners[t];if(i!==void 0){let r=i.indexOf(e);r!==-1&&i.splice(r,1)}}dispatchEvent(t){if(this._listeners===void 0)return;let e=this._listeners[t.type];if(e!==void 0){t.target=this;let i=e.slice(0);for(let r=0,n=i.length;r<n;r++)i[r].call(this,t);t.target=null}}},aa=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],M7=1234567,cw=Math.PI/180,uS=180/Math.PI;function Nl(){let t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(aa[t&255]+aa[t>>8&255]+aa[t>>16&255]+aa[t>>24&255]+"-"+aa[e&255]+aa[e>>8&255]+"-"+aa[e>>16&15|64]+aa[e>>24&255]+"-"+aa[i&63|128]+aa[i>>8&255]+"-"+aa[i>>16&255]+aa[i>>24&255]+aa[r&255]+aa[r>>8&255]+aa[r>>16&255]+aa[r>>24&255]).toLowerCase()}function In(t,e,i){return Math.max(e,Math.min(i,t))}function E5(t,e){return(t%e+e)%e}function tPe(t,e,i,r,n){return r+(t-e)*(n-r)/(i-e)}function iPe(t,e,i){return t!==e?(i-t)/(e-t):0}function hw(t,e,i){return(1-i)*t+i*e}function rPe(t,e,i,r){return hw(t,e,1-Math.exp(-i*r))}function nPe(t,e=1){return e-Math.abs(E5(t,e*2)-e)}function sPe(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))}function aPe(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(t*6-15)+10))}function oPe(t,e){return t+Math.floor(Math.random()*(e-t+1))}function lPe(t,e){return t+Math.random()*(e-t)}function cPe(t){return t*(.5-Math.random())}function hPe(t){t!==void 0&&(M7=t);let e=M7+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function uPe(t){return t*cw}function dPe(t){return t*uS}function Bk(t){return(t&t-1)===0&&t!==0}function mse(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function E2(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function fPe(t,e,i,r,n){let s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((e+r)/2),h=a((e+r)/2),u=s((e-r)/2),d=a((e-r)/2),f=s((r-e)/2),p=a((r-e)/2);switch(n){case"XYX":t.set(o*h,l*u,l*d,o*c);break;case"YZY":t.set(l*d,o*h,l*u,o*c);break;case"ZXZ":t.set(l*u,l*d,o*h,o*c);break;case"XZX":t.set(o*h,l*p,l*f,o*c);break;case"YXY":t.set(l*f,o*h,l*p,o*c);break;case"ZYZ":t.set(l*p,l*f,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function Qu(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function mr(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}var Et=Object.freeze({__proto__:null,DEG2RAD:cw,RAD2DEG:uS,ceilPowerOfTwo:mse,clamp:In,damp:rPe,degToRad:uPe,denormalize:Qu,euclideanModulo:E5,floorPowerOfTwo:E2,generateUUID:Nl,inverseLerp:iPe,isPowerOfTwo:Bk,lerp:hw,mapLinear:tPe,normalize:mr,pingpong:nPe,radToDeg:dPe,randFloat:lPe,randFloatSpread:cPe,randInt:oPe,seededRandom:hPe,setQuaternionFromProperEuler:fPe,smootherstep:aPe,smoothstep:sPe}),ye=class{constructor(t=0,e=0){ye.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,i=this.y,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6],this.y=r[1]*e+r[4]*i+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){let i=Math.cos(e),r=Math.sin(e),n=this.x-t.x,s=this.y-t.y;return this.x=n*i-s*r+t.x,this.y=n*r+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Bn=class{constructor(){Bn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,i,r,n,s,a,o,l){let c=this.elements;return c[0]=t,c[1]=r,c[2]=a,c[3]=e,c[4]=n,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){let e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){let e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let i=t.elements,r=e.elements,n=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],f=i[8],p=r[0],m=r[3],g=r[6],v=r[1],y=r[4],x=r[7],S=r[2],A=r[5],_=r[8];return n[0]=s*p+a*v+o*S,n[3]=s*m+a*y+o*A,n[6]=s*g+a*x+o*_,n[1]=l*p+c*v+h*S,n[4]=l*m+c*y+h*A,n[7]=l*g+c*x+h*_,n[2]=u*p+d*v+f*S,n[5]=u*m+d*y+f*A,n[8]=u*g+d*x+f*_,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){let t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8];return e*s*c-e*a*l-i*n*c+i*a*o+r*n*l-r*s*o}invert(){let t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=c*s-a*l,u=a*o-c*n,d=l*n-s*o,f=e*h+i*u+r*d;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);let p=1/f;return t[0]=h*p,t[1]=(r*l-c*i)*p,t[2]=(a*i-r*s)*p,t[3]=u*p,t[4]=(c*e-r*o)*p,t[5]=(r*n-a*e)*p,t[6]=d*p,t[7]=(i*o-l*e)*p,t[8]=(s*e-i*n)*p,this}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){let e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,r,n,s,a){let o=Math.cos(n),l=Math.sin(n);return this.set(i*o,i*l,-i*(o*s+l*a)+s+t,-r*l,r*o,-r*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(c3.makeScale(t,e)),this}rotate(t){return this.premultiply(c3.makeRotation(-t)),this}translate(t,e){return this.premultiply(c3.makeTranslation(t,e)),this}makeTranslation(t,e){return this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){let e=this.elements,i=t.elements;for(let r=0;r<9;r++)if(e[r]!==i[r])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){let i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}},c3=new Bn;function gse(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}var pPe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function rM(t,e){return new pPe[t](e)}function dS(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function mPe(t,e,i){return new Promise(function(r,n){function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:n();break;case t.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:r()}}setTimeout(s,i)})}function yg(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function cC(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}var h3={[fh]:{[A2]:yg},[A2]:{[fh]:cC}},Ma={legacyMode:!0,get workingColorSpace(){return A2},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(h3[e]&&h3[e][i]!==void 0){let r=h3[e][i];return t.r=r(t.r),t.g=r(t.g),t.b=r(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},vse={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Wn={r:0,g:0,b:0},nc={h:0,s:0,l:0},nM={h:0,s:0,l:0};function u3(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*6*(2/3-i):t}function sM(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}var Xt=class{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,e===void 0&&i===void 0?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=fh){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Ma.toWorkingColorSpace(this,e),this}setRGB(t,e,i,r=Ma.workingColorSpace){return this.r=t,this.g=e,this.b=i,Ma.toWorkingColorSpace(this,r),this}setHSL(t,e,i,r=Ma.workingColorSpace){if(t=E5(t,1),e=In(e,0,1),i=In(i,0,1),e===0)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+e):i+e-i*e,s=2*i-n;this.r=u3(s,n,t+1/3),this.g=u3(s,n,t),this.b=u3(s,n,t-1/3)}return Ma.toWorkingColorSpace(this,r),this}setStyle(t,e=fh){function i(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let n,s=r[1],a=r[2];switch(s){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,Ma.toWorkingColorSpace(this,e),i(n[4]),this;if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,Ma.toWorkingColorSpace(this,e),i(n[4]),this;break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){let o=parseFloat(n[1])/360,l=parseFloat(n[2])/100,c=parseFloat(n[3])/100;return i(n[4]),this.setHSL(o,l,c,e)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){let n=r[1],s=n.length;if(s===3)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,Ma.toWorkingColorSpace(this,e),this;if(s===6)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,Ma.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e=fh){let i=vse[t.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=yg(t.r),this.g=yg(t.g),this.b=yg(t.b),this}copyLinearToSRGB(t){return this.r=cC(t.r),this.g=cC(t.g),this.b=cC(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=fh){return Ma.fromWorkingColorSpace(sM(this,Wn),t),In(Wn.r*255,0,255)<<16^In(Wn.g*255,0,255)<<8^In(Wn.b*255,0,255)<<0}getHexString(t=fh){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Ma.workingColorSpace){Ma.fromWorkingColorSpace(sM(this,Wn),e);let i=Wn.r,r=Wn.g,n=Wn.b,s=Math.max(i,r,n),a=Math.min(i,r,n),o,l,c=(a+s)/2;if(a===s)o=0,l=0;else{let h=s-a;switch(l=c<=.5?h/(s+a):h/(2-s-a),s){case i:o=(r-n)/h+(r<n?6:0);break;case r:o=(n-i)/h+2;break;case n:o=(i-r)/h+4;break}o/=6}return t.h=o,t.s=l,t.l=c,t}getRGB(t,e=Ma.workingColorSpace){return Ma.fromWorkingColorSpace(sM(this,Wn),e),t.r=Wn.r,t.g=Wn.g,t.b=Wn.b,t}getStyle(t=fh){return Ma.fromWorkingColorSpace(sM(this,Wn),t),t!==fh?`color(${t} ${Wn.r} ${Wn.g} ${Wn.b})`:`rgb(${Wn.r*255|0},${Wn.g*255|0},${Wn.b*255|0})`}offsetHSL(t,e,i){return this.getHSL(nc),nc.h+=t,nc.s+=e,nc.l+=i,this.setHSL(nc.h,nc.s,nc.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(nc),t.getHSL(nM);let i=hw(nc.h,nM.h,e),r=hw(nc.s,nM.s,e),n=hw(nc.l,nM.l,e);return this.setHSL(i,r,n),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};Xt.NAMES=vse;var Q0,yse=class{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{Q0===void 0&&(Q0=dS("canvas")),Q0.width=t.width,Q0.height=t.height;let i=Q0.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=Q0}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){let e=dS("canvas");e.width=t.width,e.height=t.height;let i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);let r=i.getImageData(0,0,t.width,t.height),n=r.data;for(let s=0;s<n.length;s++)n[s]=yg(n[s]/255)*255;return i.putImageData(r,0,0),e}else if(t.data){let e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(yg(e[i]/255)*255):e[i]=yg(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}},xse=class{constructor(t=null){this.isSource=!0,this.uuid=Nl(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){let e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let n;if(Array.isArray(r)){n=[];for(let s=0,a=r.length;s<a;s++)r[s].isDataTexture?n.push(d3(r[s].image)):n.push(d3(r[s]))}else n=d3(r);i.url=n}return e||(t.images[this.uuid]=i),i}};function d3(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?yse.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var gPe=0,Kr=class extends Js{constructor(t=Kr.DEFAULT_IMAGE,e=Kr.DEFAULT_MAPPING,i=Cr,r=Cr,n=mi,s=s1,a=Fr,o=ba,l=Kr.DEFAULT_ANISOTROPY,c=Oc){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:gPe++}),this.uuid=Nl(),this.name="",this.source=new xse(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new ye(0,0),this.repeat=new ye(1,1),this.center=new ye(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Bn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){let e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==cse)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case qu:t.x=t.x-Math.floor(t.x);break;case Cr:t.x=t.x<0?0:1;break;case Rk:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case qu:t.y=t.y-Math.floor(t.y);break;case Cr:t.y=t.y<0?0:1;break;case Rk:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}};Kr.DEFAULT_IMAGE=null;Kr.DEFAULT_MAPPING=cse;Kr.DEFAULT_ANISOTROPY=1;var si=class{constructor(t=0,e=0,i=0,r=1){si.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){let e=this.x,i=this.y,r=this.z,n=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*r+s[12]*n,this.y=s[1]*e+s[5]*i+s[9]*r+s[13]*n,this.z=s[2]*e+s[6]*i+s[10]*r+s[14]*n,this.w=s[3]*e+s[7]*i+s[11]*r+s[15]*n,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);let e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,r,n,s=t.elements,a=s[0],o=s[4],l=s[8],c=s[1],h=s[5],u=s[9],d=s[2],f=s[6],p=s[10];if(Math.abs(o-c)<.01&&Math.abs(l-d)<.01&&Math.abs(u-f)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+d)<.1&&Math.abs(u+f)<.1&&Math.abs(a+h+p-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;let g=(a+1)/2,v=(h+1)/2,y=(p+1)/2,x=(o+c)/4,S=(l+d)/4,A=(u+f)/4;return g>v&&g>y?g<.01?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(g),r=x/i,n=S/i):v>y?v<.01?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(v),i=x/r,n=A/r):y<.01?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(y),i=S/n,r=A/n),this.set(i,r,n,e),this}let m=Math.sqrt((f-u)*(f-u)+(l-d)*(l-d)+(c-o)*(c-o));return Math.abs(m)<.001&&(m=1),this.x=(f-u)/m,this.y=(l-d)/m,this.z=(c-o)/m,this.w=Math.acos((a+h+p-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Di=class extends Js{constructor(t=1,e=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new si(0,0,t,e),this.scissorTest=!1,this.viewport=new si(0,0,t,e);let r={width:t,height:e,depth:1};this.texture=new Kr(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:mi,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(t,e,i=1){(this.width!==t||this.height!==e||this.depth!==i)&&(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;let e=Object.assign({},t.texture.image);return this.texture.source=new xse(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},bse=class extends Kr{constructor(t=null,e=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:r},this.magFilter=bi,this.minFilter=bi,this.wrapR=Cr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},vPe=class extends Kr{constructor(t=null,e=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:r},this.magFilter=bi,this.minFilter=bi,this.wrapR=Cr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},wse=class extends Di{constructor(t=1,e=1,i=1,r={}){super(t,e,r),this.isWebGLMultipleRenderTargets=!0;let n=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=n.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let r=0,n=this.texture.length;r<n;r++)this.texture[r].image.width=t,this.texture[r].image.height=e,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}},ri=class{constructor(t=0,e=0,i=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=r}static slerpFlat(t,e,i,r,n,s,a){let o=i[r+0],l=i[r+1],c=i[r+2],h=i[r+3],u=n[s+0],d=n[s+1],f=n[s+2],p=n[s+3];if(a===0){t[e+0]=o,t[e+1]=l,t[e+2]=c,t[e+3]=h;return}if(a===1){t[e+0]=u,t[e+1]=d,t[e+2]=f,t[e+3]=p;return}if(h!==p||o!==u||l!==d||c!==f){let m=1-a,g=o*u+l*d+c*f+h*p,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){let S=Math.sqrt(y),A=Math.atan2(S,g*v);m=Math.sin(m*A)/S,a=Math.sin(a*A)/S}let x=a*v;if(o=o*m+u*x,l=l*m+d*x,c=c*m+f*x,h=h*m+p*x,m===1-a){let S=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=S,l*=S,c*=S,h*=S}}t[e]=o,t[e+1]=l,t[e+2]=c,t[e+3]=h}static multiplyQuaternionsFlat(t,e,i,r,n,s){let a=i[r],o=i[r+1],l=i[r+2],c=i[r+3],h=n[s],u=n[s+1],d=n[s+2],f=n[s+3];return t[e]=a*f+c*h+o*d-l*u,t[e+1]=o*f+c*u+l*h-a*d,t[e+2]=l*f+c*d+a*u-o*h,t[e+3]=c*f-a*h-o*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){let i=t._x,r=t._y,n=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(i/2),c=a(r/2),h=a(n/2),u=o(i/2),d=o(r/2),f=o(n/2);switch(s){case"XYZ":this._x=u*c*h+l*d*f,this._y=l*d*h-u*c*f,this._z=l*c*f+u*d*h,this._w=l*c*h-u*d*f;break;case"YXZ":this._x=u*c*h+l*d*f,this._y=l*d*h-u*c*f,this._z=l*c*f-u*d*h,this._w=l*c*h+u*d*f;break;case"ZXY":this._x=u*c*h-l*d*f,this._y=l*d*h+u*c*f,this._z=l*c*f+u*d*h,this._w=l*c*h-u*d*f;break;case"ZYX":this._x=u*c*h-l*d*f,this._y=l*d*h+u*c*f,this._z=l*c*f-u*d*h,this._w=l*c*h+u*d*f;break;case"YZX":this._x=u*c*h+l*d*f,this._y=l*d*h+u*c*f,this._z=l*c*f-u*d*h,this._w=l*c*h-u*d*f;break;case"XZY":this._x=u*c*h-l*d*f,this._y=l*d*h-u*c*f,this._z=l*c*f+u*d*h,this._w=l*c*h+u*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){let i=e/2,r=Math.sin(i);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){let e=t.elements,i=e[0],r=e[4],n=e[8],s=e[1],a=e[5],o=e[9],l=e[2],c=e[6],h=e[10],u=i+a+h;if(u>0){let d=.5/Math.sqrt(u+1);this._w=.25/d,this._x=(c-o)*d,this._y=(n-l)*d,this._z=(s-r)*d}else if(i>a&&i>h){let d=2*Math.sqrt(1+i-a-h);this._w=(c-o)/d,this._x=.25*d,this._y=(r+s)/d,this._z=(n+l)/d}else if(a>h){let d=2*Math.sqrt(1+a-i-h);this._w=(n-l)/d,this._x=(r+s)/d,this._y=.25*d,this._z=(o+c)/d}else{let d=2*Math.sqrt(1+h-i-a);this._w=(s-r)/d,this._x=(n+l)/d,this._y=(o+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(In(this.dot(t),-1,1)))}rotateTowards(t,e){let i=this.angleTo(t);if(i===0)return this;let r=Math.min(1,e/i);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){let i=t._x,r=t._y,n=t._z,s=t._w,a=e._x,o=e._y,l=e._z,c=e._w;return this._x=i*c+s*a+r*l-n*o,this._y=r*c+s*o+n*a-i*l,this._z=n*c+s*l+i*o-r*a,this._w=s*c-i*a-r*o-n*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);let i=this._x,r=this._y,n=this._z,s=this._w,a=s*t._w+i*t._x+r*t._y+n*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=i,this._y=r,this._z=n,this;let o=1-a*a;if(o<=Number.EPSILON){let d=1-e;return this._w=d*s+e*this._w,this._x=d*i+e*this._x,this._y=d*r+e*this._y,this._z=d*n+e*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),c=Math.atan2(l,a),h=Math.sin((1-e)*c)/l,u=Math.sin(e*c)/l;return this._w=s*h+this._w*u,this._x=i*h+this._x*u,this._y=r*h+this._y*u,this._z=n*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){let t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(e*Math.cos(r),i*Math.sin(n),i*Math.cos(n),e*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},N=class{constructor(t=0,e=0,i=0){N.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(T7.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(T7.setFromAxisAngle(t,e))}applyMatrix3(t){let e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6]*r,this.y=n[1]*e+n[4]*i+n[7]*r,this.z=n[2]*e+n[5]*i+n[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let e=this.x,i=this.y,r=this.z,n=t.elements,s=1/(n[3]*e+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*e+n[4]*i+n[8]*r+n[12])*s,this.y=(n[1]*e+n[5]*i+n[9]*r+n[13])*s,this.z=(n[2]*e+n[6]*i+n[10]*r+n[14])*s,this}applyQuaternion(t){let e=this.x,i=this.y,r=this.z,n=t.x,s=t.y,a=t.z,o=t.w,l=o*e+s*r-a*i,c=o*i+a*e-n*r,h=o*r+n*i-s*e,u=-n*e-s*i-a*r;return this.x=l*o+u*-n+c*-a-h*-s,this.y=c*o+u*-s+h*-n-l*-a,this.z=h*o+u*-a+l*-s-c*-n,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*r,this.y=n[1]*e+n[5]*i+n[9]*r,this.z=n[2]*e+n[6]*i+n[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){let i=t.x,r=t.y,n=t.z,s=e.x,a=e.y,o=e.z;return this.x=r*o-n*a,this.y=n*s-i*o,this.z=i*a-r*s,this}projectOnVector(t){let e=t.lengthSq();if(e===0)return this.set(0,0,0);let i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return f3.copy(this).projectOnVector(t),this.sub(f3)}reflect(t){return this.sub(f3.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;let i=this.dot(t)/e;return Math.acos(In(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){let r=Math.sin(e)*t;return this.x=r*Math.sin(i),this.y=Math.cos(e)*t,this.z=r*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){let e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},f3=new N,T7=new ri,_n=class{constructor(t=new N(1/0,1/0,1/0),e=new N(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.length;o<l;o+=3){let c=t[o],h=t[o+1],u=t[o+2];c<e&&(e=c),h<i&&(i=h),u<r&&(r=u),c>n&&(n=c),h>s&&(s=h),u>a&&(a=u)}return this.min.set(e,i,r),this.max.set(n,s,a),this}setFromBufferAttribute(t){let e=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.count;o<l;o++){let c=t.getX(o),h=t.getY(o),u=t.getZ(o);c<e&&(e=c),h<i&&(i=h),u<r&&(r=u),c>n&&(n=c),h>s&&(s=h),u>a&&(a=u)}return this.min.set(e,i,r),this.max.set(n,s,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let i=sm.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);let i=t.geometry;if(i!==void 0)if(e&&i.attributes!=null&&i.attributes.position!==void 0){let n=i.attributes.position;for(let s=0,a=n.count;s<a;s++)sm.fromBufferAttribute(n,s).applyMatrix4(t.matrixWorld),this.expandByPoint(sm)}else i.boundingBox===null&&i.computeBoundingBox(),p3.copy(i.boundingBox),p3.applyMatrix4(t.matrixWorld),this.union(p3);let r=t.children;for(let n=0,s=r.length;n<s;n++)this.expandByObject(r[n],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,sm),sm.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Kx),aM.subVectors(this.max,Kx),$0.subVectors(t.a,Kx),J0.subVectors(t.b,Kx),Z0.subVectors(t.c,Kx),$d.subVectors(J0,$0),Jd.subVectors(Z0,J0),am.subVectors($0,Z0);let e=[0,-$d.z,$d.y,0,-Jd.z,Jd.y,0,-am.z,am.y,$d.z,0,-$d.x,Jd.z,0,-Jd.x,am.z,0,-am.x,-$d.y,$d.x,0,-Jd.y,Jd.x,0,-am.y,am.x,0];return!m3(e,$0,J0,Z0,aM)||(e=[1,0,0,0,1,0,0,0,1],!m3(e,$0,J0,Z0,aM))?!1:(oM.crossVectors($d,Jd),e=[oM.x,oM.y,oM.z],m3(e,$0,J0,Z0,aM))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return sm.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(sm).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(du[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),du[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),du[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),du[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),du[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),du[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),du[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),du[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(du),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},du=[new N,new N,new N,new N,new N,new N,new N,new N],sm=new N,p3=new _n,$0=new N,J0=new N,Z0=new N,$d=new N,Jd=new N,am=new N,Kx=new N,aM=new N,oM=new N,om=new N;function m3(t,e,i,r,n){for(let s=0,a=t.length-3;s<=a;s+=3){om.fromArray(t,s);let o=n.x*Math.abs(om.x)+n.y*Math.abs(om.y)+n.z*Math.abs(om.z),l=e.dot(om),c=i.dot(om),h=r.dot(om);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>o)return!1}return!0}var yPe=new _n,Qx=new N,g3=new N,wo=class{constructor(t=new N,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){let i=this.center;e!==void 0?i.copy(e):yPe.setFromPoints(t).getCenter(i);let r=0;for(let n=0,s=t.length;n<s;n++)r=Math.max(r,i.distanceToSquared(t[n]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){let e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){let i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Qx.subVectors(t,this.center);let e=Qx.lengthSq();if(e>this.radius*this.radius){let i=Math.sqrt(e),r=(i-this.radius)*.5;this.center.addScaledVector(Qx,r/i),this.radius+=r}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(g3.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Qx.copy(t.center).add(g3)),this.expandByPoint(Qx.copy(t.center).sub(g3))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}},fu=new N,v3=new N,lM=new N,Zd=new N,y3=new N,cM=new N,x3=new N,G1=class{constructor(t=new N,e=new N(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,fu)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);let i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){let e=fu.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(fu.copy(this.direction).multiplyScalar(e).add(this.origin),fu.distanceToSquared(t))}distanceSqToSegment(t,e,i,r){v3.copy(t).add(e).multiplyScalar(.5),lM.copy(e).sub(t).normalize(),Zd.copy(this.origin).sub(v3);let n=t.distanceTo(e)*.5,s=-this.direction.dot(lM),a=Zd.dot(this.direction),o=-Zd.dot(lM),l=Zd.lengthSq(),c=Math.abs(1-s*s),h,u,d,f;if(c>0)if(h=s*o-a,u=s*a-o,f=n*c,h>=0)if(u>=-f)if(u<=f){let p=1/c;h*=p,u*=p,d=h*(h+s*u+2*a)+u*(s*h+u+2*o)+l}else u=n,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u=-n,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u<=-f?(h=Math.max(0,-(-s*n+a)),u=h>0?-n:Math.min(Math.max(-n,-o),n),d=-h*h+u*(u+2*o)+l):u<=f?(h=0,u=Math.min(Math.max(-n,-o),n),d=u*(u+2*o)+l):(h=Math.max(0,-(s*n+a)),u=h>0?n:Math.min(Math.max(-n,-o),n),d=-h*h+u*(u+2*o)+l);else u=s>0?-n:n,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),r&&r.copy(lM).multiplyScalar(u).add(v3),d}intersectSphere(t,e){fu.subVectors(t.center,this.origin);let i=fu.dot(this.direction),r=fu.dot(fu)-i*i,n=t.radius*t.radius;if(r>n)return null;let s=Math.sqrt(n-r),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){let e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){let i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){let e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,r,n,s,a,o,l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,r=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,r=(t.min.x-u.x)*l),c>=0?(n=(t.min.y-u.y)*c,s=(t.max.y-u.y)*c):(n=(t.max.y-u.y)*c,s=(t.min.y-u.y)*c),i>s||n>r||((n>i||isNaN(i))&&(i=n),(s<r||isNaN(r))&&(r=s),h>=0?(a=(t.min.z-u.z)*h,o=(t.max.z-u.z)*h):(a=(t.max.z-u.z)*h,o=(t.min.z-u.z)*h),i>o||a>r)||((a>i||i!==i)&&(i=a),(o<r||r!==r)&&(r=o),r<0)?null:this.at(i>=0?i:r,e)}intersectsBox(t){return this.intersectBox(t,fu)!==null}intersectTriangle(t,e,i,r,n){y3.subVectors(e,t),cM.subVectors(i,t),x3.crossVectors(y3,cM);let s=this.direction.dot(x3),a;if(s>0){if(r)return null;a=1}else if(s<0)a=-1,s=-s;else return null;Zd.subVectors(this.origin,t);let o=a*this.direction.dot(cM.crossVectors(Zd,cM));if(o<0)return null;let l=a*this.direction.dot(y3.cross(Zd));if(l<0||o+l>s)return null;let c=-a*Zd.dot(x3);return c<0?null:this.at(c/s,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},st=class{constructor(){st.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,r,n,s,a,o,l,c,h,u,d,f,p,m){let g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=r,g[1]=n,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new st().fromArray(this.elements)}copy(t){let e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){let e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){let e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){let e=this.elements,i=t.elements,r=1/ev.setFromMatrixColumn(t,0).length(),n=1/ev.setFromMatrixColumn(t,1).length(),s=1/ev.setFromMatrixColumn(t,2).length();return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=0,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){let e=this.elements,i=t.x,r=t.y,n=t.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(r),l=Math.sin(r),c=Math.cos(n),h=Math.sin(n);if(t.order==="XYZ"){let u=s*c,d=s*h,f=a*c,p=a*h;e[0]=o*c,e[4]=-o*h,e[8]=l,e[1]=d+f*l,e[5]=u-p*l,e[9]=-a*o,e[2]=p-u*l,e[6]=f+d*l,e[10]=s*o}else if(t.order==="YXZ"){let u=o*c,d=o*h,f=l*c,p=l*h;e[0]=u+p*a,e[4]=f*a-d,e[8]=s*l,e[1]=s*h,e[5]=s*c,e[9]=-a,e[2]=d*a-f,e[6]=p+u*a,e[10]=s*o}else if(t.order==="ZXY"){let u=o*c,d=o*h,f=l*c,p=l*h;e[0]=u-p*a,e[4]=-s*h,e[8]=f+d*a,e[1]=d+f*a,e[5]=s*c,e[9]=p-u*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if(t.order==="ZYX"){let u=s*c,d=s*h,f=a*c,p=a*h;e[0]=o*c,e[4]=f*l-d,e[8]=u*l+p,e[1]=o*h,e[5]=p*l+u,e[9]=d*l-f,e[2]=-l,e[6]=a*o,e[10]=s*o}else if(t.order==="YZX"){let u=s*o,d=s*l,f=a*o,p=a*l;e[0]=o*c,e[4]=p-u*h,e[8]=f*h+d,e[1]=h,e[5]=s*c,e[9]=-a*c,e[2]=-l*c,e[6]=d*h+f,e[10]=u-p*h}else if(t.order==="XZY"){let u=s*o,d=s*l,f=a*o,p=a*l;e[0]=o*c,e[4]=-h,e[8]=l*c,e[1]=u*h+p,e[5]=s*c,e[9]=d*h-f,e[2]=f*h-d,e[6]=a*c,e[10]=p*h+u}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(xPe,t,bPe)}lookAt(t,e,i){let r=this.elements;return Do.subVectors(t,e),Do.lengthSq()===0&&(Do.z=1),Do.normalize(),ef.crossVectors(i,Do),ef.lengthSq()===0&&(Math.abs(i.z)===1?Do.x+=1e-4:Do.z+=1e-4,Do.normalize(),ef.crossVectors(i,Do)),ef.normalize(),hM.crossVectors(Do,ef),r[0]=ef.x,r[4]=hM.x,r[8]=Do.x,r[1]=ef.y,r[5]=hM.y,r[9]=Do.y,r[2]=ef.z,r[6]=hM.z,r[10]=Do.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let i=t.elements,r=e.elements,n=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],f=i[2],p=i[6],m=i[10],g=i[14],v=i[3],y=i[7],x=i[11],S=i[15],A=r[0],_=r[4],M=r[8],E=r[12],T=r[1],C=r[5],D=r[9],B=r[13],O=r[2],L=r[6],H=r[10],q=r[14],W=r[3],I=r[7],z=r[11],U=r[15];return n[0]=s*A+a*T+o*O+l*W,n[4]=s*_+a*C+o*L+l*I,n[8]=s*M+a*D+o*H+l*z,n[12]=s*E+a*B+o*q+l*U,n[1]=c*A+h*T+u*O+d*W,n[5]=c*_+h*C+u*L+d*I,n[9]=c*M+h*D+u*H+d*z,n[13]=c*E+h*B+u*q+d*U,n[2]=f*A+p*T+m*O+g*W,n[6]=f*_+p*C+m*L+g*I,n[10]=f*M+p*D+m*H+g*z,n[14]=f*E+p*B+m*q+g*U,n[3]=v*A+y*T+x*O+S*W,n[7]=v*_+y*C+x*L+S*I,n[11]=v*M+y*D+x*H+S*z,n[15]=v*E+y*B+x*q+S*U,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){let t=this.elements,e=t[0],i=t[4],r=t[8],n=t[12],s=t[1],a=t[5],o=t[9],l=t[13],c=t[2],h=t[6],u=t[10],d=t[14],f=t[3],p=t[7],m=t[11],g=t[15];return f*(+n*o*h-r*l*h-n*a*u+i*l*u+r*a*d-i*o*d)+p*(+e*o*d-e*l*u+n*s*u-r*s*d+r*l*c-n*o*c)+m*(+e*l*h-e*a*d-n*s*h+i*s*d+n*a*c-i*l*c)+g*(-r*a*c-e*o*h+e*a*u+r*s*h-i*s*u+i*o*c)}transpose(){let t=this.elements,e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){let r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=i),this}invert(){let t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11],f=t[12],p=t[13],m=t[14],g=t[15],v=h*m*l-p*u*l+p*o*d-a*m*d-h*o*g+a*u*g,y=f*u*l-c*m*l-f*o*d+s*m*d+c*o*g-s*u*g,x=c*p*l-f*h*l+f*a*d-s*p*d-c*a*g+s*h*g,S=f*h*o-c*p*o-f*a*u+s*p*u+c*a*m-s*h*m,A=e*v+i*y+r*x+n*S;if(A===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let _=1/A;return t[0]=v*_,t[1]=(p*u*n-h*m*n-p*r*d+i*m*d+h*r*g-i*u*g)*_,t[2]=(a*m*n-p*o*n+p*r*l-i*m*l-a*r*g+i*o*g)*_,t[3]=(h*o*n-a*u*n-h*r*l+i*u*l+a*r*d-i*o*d)*_,t[4]=y*_,t[5]=(c*m*n-f*u*n+f*r*d-e*m*d-c*r*g+e*u*g)*_,t[6]=(f*o*n-s*m*n-f*r*l+e*m*l+s*r*g-e*o*g)*_,t[7]=(s*u*n-c*o*n+c*r*l-e*u*l-s*r*d+e*o*d)*_,t[8]=x*_,t[9]=(f*h*n-c*p*n-f*i*d+e*p*d+c*i*g-e*h*g)*_,t[10]=(s*p*n-f*a*n+f*i*l-e*p*l-s*i*g+e*a*g)*_,t[11]=(c*a*n-s*h*n-c*i*l+e*h*l+s*i*d-e*a*d)*_,t[12]=S*_,t[13]=(c*p*r-f*h*r+f*i*u-e*p*u-c*i*m+e*h*m)*_,t[14]=(f*a*r-s*p*r-f*i*o+e*p*o+s*i*m-e*a*m)*_,t[15]=(s*h*r-c*a*r+c*i*o-e*h*o-s*i*u+e*a*u)*_,this}scale(t){let e=this.elements,i=t.x,r=t.y,n=t.z;return e[0]*=i,e[4]*=r,e[8]*=n,e[1]*=i,e[5]*=r,e[9]*=n,e[2]*=i,e[6]*=r,e[10]*=n,e[3]*=i,e[7]*=r,e[11]*=n,this}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){let e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){let i=Math.cos(e),r=Math.sin(e),n=1-i,s=t.x,a=t.y,o=t.z,l=n*s,c=n*a;return this.set(l*s+i,l*a-r*o,l*o+r*a,0,l*a+r*o,c*a+i,c*o-r*s,0,l*o-r*a,c*o+r*s,n*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,r,n,s){return this.set(1,i,n,0,t,1,s,0,e,r,1,0,0,0,0,1),this}compose(t,e,i){let r=this.elements,n=e._x,s=e._y,a=e._z,o=e._w,l=n+n,c=s+s,h=a+a,u=n*l,d=n*c,f=n*h,p=s*c,m=s*h,g=a*h,v=o*l,y=o*c,x=o*h,S=i.x,A=i.y,_=i.z;return r[0]=(1-(p+g))*S,r[1]=(d+x)*S,r[2]=(f-y)*S,r[3]=0,r[4]=(d-x)*A,r[5]=(1-(u+g))*A,r[6]=(m+v)*A,r[7]=0,r[8]=(f+y)*_,r[9]=(m-v)*_,r[10]=(1-(u+p))*_,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,i){let r=this.elements,n=ev.set(r[0],r[1],r[2]).length(),s=ev.set(r[4],r[5],r[6]).length(),a=ev.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),t.x=r[12],t.y=r[13],t.z=r[14],sc.copy(this);let o=1/n,l=1/s,c=1/a;return sc.elements[0]*=o,sc.elements[1]*=o,sc.elements[2]*=o,sc.elements[4]*=l,sc.elements[5]*=l,sc.elements[6]*=l,sc.elements[8]*=c,sc.elements[9]*=c,sc.elements[10]*=c,e.setFromRotationMatrix(sc),i.x=n,i.y=s,i.z=a,this}makePerspective(t,e,i,r,n,s){let a=this.elements,o=2*n/(e-t),l=2*n/(i-r),c=(e+t)/(e-t),h=(i+r)/(i-r),u=-(s+n)/(s-n),d=-2*s*n/(s-n);return a[0]=o,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,r,n,s){let a=this.elements,o=1/(e-t),l=1/(i-r),c=1/(s-n),h=(e+t)*o,u=(i+r)*l,d=(s+n)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){let e=this.elements,i=t.elements;for(let r=0;r<16;r++)if(e[r]!==i[r])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){let i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}},ev=new N,sc=new st,xPe=new N(0,0,0),bPe=new N(1,1,1),ef=new N,hM=new N,Do=new N,C7=new st,P7=new ri,Zn=class{constructor(t=0,e=0,i=0,r=Zn.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,r=this._order){return this._x=t,this._y=e,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){let r=t.elements,n=r[0],s=r[4],a=r[8],o=r[1],l=r[5],c=r[9],h=r[2],u=r[6],d=r[10];switch(e){case"XYZ":this._y=Math.asin(In(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-In(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,n),this._z=0);break;case"ZXY":this._x=Math.asin(In(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-In(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(In(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,n)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-In(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return C7.makeRotationFromQuaternion(t),this.setFromRotationMatrix(C7,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return P7.setFromEuler(this),this.setFromQuaternion(P7,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Zn.DEFAULT_ORDER="XYZ";var M5=class{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}},wPe=0,D7=new N,tv=new ri,pu=new st,uM=new N,$x=new N,SPe=new N,_Pe=new ri,R7=new N(1,0,0),I7=new N(0,1,0),L7=new N(0,0,1),APe={type:"added"},O7={type:"removed"},Ji=class extends Js{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:wPe++}),this.uuid=Nl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ji.DEFAULT_UP.clone();let t=new N,e=new Zn,i=new ri,r=new N(1,1,1);function n(){i.setFromEuler(e,!1)}function s(){e.setFromQuaternion(i,void 0,!1)}e._onChange(n),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new st},normalMatrix:{value:new Bn}}),this.matrix=new st,this.matrixWorld=new st,this.matrixAutoUpdate=Ji.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Ji.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new M5,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return tv.setFromAxisAngle(t,e),this.quaternion.multiply(tv),this}rotateOnWorldAxis(t,e){return tv.setFromAxisAngle(t,e),this.quaternion.premultiply(tv),this}rotateX(t){return this.rotateOnAxis(R7,t)}rotateY(t){return this.rotateOnAxis(I7,t)}rotateZ(t){return this.rotateOnAxis(L7,t)}translateOnAxis(t,e){return D7.copy(t).applyQuaternion(this.quaternion),this.position.add(D7.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(R7,t)}translateY(t){return this.translateOnAxis(I7,t)}translateZ(t){return this.translateOnAxis(L7,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(pu.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?uM.copy(t):uM.set(t,e,i);let r=this.parent;this.updateWorldMatrix(!0,!1),$x.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?pu.lookAt($x,uM,this.up):pu.lookAt(uM,$x,this.up),this.quaternion.setFromRotationMatrix(pu),r&&(pu.extractRotation(r.matrixWorld),tv.setFromRotationMatrix(pu),this.quaternion.premultiply(tv.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(APe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(O7)),this}removeFromParent(){let t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){let e=this.children[t];e.parent=null,e.dispatchEvent(O7)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),pu.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),pu.multiply(t.parent.matrixWorld)),t.applyMatrix4(pu),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,r=this.children.length;i<r;i++){let n=this.children[i].getObjectByProperty(t,e);if(n!==void 0)return n}}getObjectsByProperty(t,e){let i=[];this[t]===e&&i.push(this);for(let r=0,n=this.children.length;r<n;r++){let s=this.children[r].getObjectsByProperty(t,e);s.length>0&&(i=i.concat(s))}return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($x,t,SPe),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($x,_Pe,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);let e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);let e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverseVisible(t)}traverseAncestors(t){let e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);let e=this.children;for(let i=0,r=e.length;i<r;i++){let n=e[i];(n.matrixWorldAutoUpdate===!0||t===!0)&&n.updateMatrixWorld(t)}}updateWorldMatrix(t,e){let i=this.parent;if(t===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){let r=this.children;for(let n=0,s=r.length;n<s;n++){let a=r[n];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(t){let e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function n(a,o){return a[o.uuid]===void 0&&(a[o.uuid]=o.toJSON(t)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(t.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let o=a.shapes;if(Array.isArray(o))for(let l=0,c=o.length;l<c;l++){let h=o[l];n(t.shapes,h)}else n(t.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let o=0,l=this.material.length;o<l;o++)a.push(n(t.materials,this.material[o]));r.material=a}else r.material=n(t.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){let o=this.animations[a];r.animations.push(n(t.animations,o))}}if(e){let a=s(t.geometries),o=s(t.materials),l=s(t.textures),c=s(t.images),h=s(t.shapes),u=s(t.skeletons),d=s(t.animations),f=s(t.nodes);a.length>0&&(i.geometries=a),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),h.length>0&&(i.shapes=h),u.length>0&&(i.skeletons=u),d.length>0&&(i.animations=d),f.length>0&&(i.nodes=f)}return i.object=r,i;function s(a){let o=[];for(let l in a){let c=a[l];delete c.metadata,o.push(c)}return o}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){let r=t.children[i];this.add(r.clone())}return this}};Ji.DEFAULT_UP=new N(0,1,0);Ji.DEFAULT_MATRIX_AUTO_UPDATE=!0;Ji.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var ac=new N,mu=new N,b3=new N,gu=new N,iv=new N,rv=new N,B7=new N,w3=new N,S3=new N,_3=new N,Ws=class{constructor(t=new N,e=new N,i=new N){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,r){r.subVectors(i,e),ac.subVectors(t,e),r.cross(ac);let n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(t,e,i,r,n){ac.subVectors(r,e),mu.subVectors(i,e),b3.subVectors(t,e);let s=ac.dot(ac),a=ac.dot(mu),o=ac.dot(b3),l=mu.dot(mu),c=mu.dot(b3),h=s*l-a*a;if(h===0)return n.set(-2,-1,-1);let u=1/h,d=(l*o-a*c)*u,f=(s*c-a*o)*u;return n.set(1-d-f,f,d)}static containsPoint(t,e,i,r){return this.getBarycoord(t,e,i,r,gu),gu.x>=0&&gu.y>=0&&gu.x+gu.y<=1}static getUV(t,e,i,r,n,s,a,o){return this.getBarycoord(t,e,i,r,gu),o.set(0,0),o.addScaledVector(n,gu.x),o.addScaledVector(s,gu.y),o.addScaledVector(a,gu.z),o}static isFrontFacing(t,e,i,r){return ac.subVectors(i,e),mu.subVectors(t,e),ac.cross(mu).dot(r)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,r){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,i,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return ac.subVectors(this.c,this.b),mu.subVectors(this.a,this.b),ac.cross(mu).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Ws.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Ws.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,r,n){return Ws.getUV(t,this.a,this.b,this.c,e,i,r,n)}containsPoint(t){return Ws.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Ws.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){let i=this.a,r=this.b,n=this.c,s,a;iv.subVectors(r,i),rv.subVectors(n,i),w3.subVectors(t,i);let o=iv.dot(w3),l=rv.dot(w3);if(o<=0&&l<=0)return e.copy(i);S3.subVectors(t,r);let c=iv.dot(S3),h=rv.dot(S3);if(c>=0&&h<=c)return e.copy(r);let u=o*h-c*l;if(u<=0&&o>=0&&c<=0)return s=o/(o-c),e.copy(i).addScaledVector(iv,s);_3.subVectors(t,n);let d=iv.dot(_3),f=rv.dot(_3);if(f>=0&&d<=f)return e.copy(n);let p=d*l-o*f;if(p<=0&&l>=0&&f<=0)return a=l/(l-f),e.copy(i).addScaledVector(rv,a);let m=c*f-d*h;if(m<=0&&h-c>=0&&d-f>=0)return B7.subVectors(n,r),a=(h-c)/(h-c+(d-f)),e.copy(r).addScaledVector(B7,a);let g=1/(m+p+u);return s=p*g,a=u*g,e.copy(i).addScaledVector(iv,s).addScaledVector(rv,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},EPe=0,A_=class extends Js{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:EPe++}),this.uuid=Nl(),this.name="",this.type="Material",this.blending=mg,this.side=Lc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=ase,this.blendDst=ose,this.blendEquation=Rv,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Ck,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Z2e,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=l3,this.stencilZFail=l3,this.stencilZPass=l3,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(let e in t){let i=t[e];if(i===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}let r=this[e];if(r===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[e]=i}}toJSON(t){let e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==mg&&(i.blending=this.blending),this.side!==Lc&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(n){let s=[];for(let a in n){let o=n[a];delete o.metadata,s.push(o)}return s}if(e){let n=r(t.textures),s=r(t.images);n.length>0&&(i.textures=n),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;let e=t.clippingPlanes,i=null;if(e!==null){let r=e.length;i=new Array(r);for(let n=0;n!==r;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}},pd=class extends A_{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Xt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=lse,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}},Pn=new N,dM=new ye,Yt=class{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i,this.usage=Ik,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[t+r]=e.array[i+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)dM.fromBufferAttribute(this,e),dM.applyMatrix3(t),this.setXY(e,dM.x,dM.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Pn.fromBufferAttribute(this,e),Pn.applyMatrix3(t),this.setXYZ(e,Pn.x,Pn.y,Pn.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)Pn.fromBufferAttribute(this,e),Pn.applyMatrix4(t),this.setXYZ(e,Pn.x,Pn.y,Pn.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Pn.fromBufferAttribute(this,e),Pn.applyNormalMatrix(t),this.setXYZ(e,Pn.x,Pn.y,Pn.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Pn.fromBufferAttribute(this,e),Pn.transformDirection(t),this.setXYZ(e,Pn.x,Pn.y,Pn.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Qu(e,this.array)),e}setX(t,e){return this.normalized&&(e=mr(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Qu(e,this.array)),e}setY(t,e){return this.normalized&&(e=mr(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Qu(e,this.array)),e}setZ(t,e){return this.normalized&&(e=mr(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Qu(e,this.array)),e}setW(t,e){return this.normalized&&(e=mr(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=mr(e,this.array),i=mr(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,r){return t*=this.itemSize,this.normalized&&(e=mr(e,this.array),i=mr(i,this.array),r=mr(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this}setXYZW(t,e,i,r,n){return t*=this.itemSize,this.normalized&&(e=mr(e,this.array),i=mr(i,this.array),r=mr(r,this.array),n=mr(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Ik&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},Sse=class extends Yt{constructor(t,e,i){super(new Uint16Array(t),e,i)}},My=class extends Yt{constructor(t,e,i){super(new Uint32Array(t),e,i)}},bt=class extends Yt{constructor(t,e,i){super(new Float32Array(t),e,i)}},MPe=0,cl=new st,A3=new Ji,nv=new N,Ro=new _n,Jx=new _n,ms=new N,Nt=class extends Js{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:MPe++}),this.uuid=Nl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(gse(t)?My:Sse)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){let e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let n=new Bn().getNormalMatrix(t);i.applyNormalMatrix(n),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(t),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return cl.makeRotationFromQuaternion(t),this.applyMatrix4(cl),this}rotateX(t){return cl.makeRotationX(t),this.applyMatrix4(cl),this}rotateY(t){return cl.makeRotationY(t),this.applyMatrix4(cl),this}rotateZ(t){return cl.makeRotationZ(t),this.applyMatrix4(cl),this}translate(t,e,i){return cl.makeTranslation(t,e,i),this.applyMatrix4(cl),this}scale(t,e,i){return cl.makeScale(t,e,i),this.applyMatrix4(cl),this}lookAt(t){return A3.lookAt(t),A3.updateMatrix(),this.applyMatrix4(A3.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(nv).negate(),this.translate(nv.x,nv.y,nv.z),this}setFromPoints(t){let e=[];for(let i=0,r=t.length;i<r;i++){let n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new bt(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new _n);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new N(-1/0,-1/0,-1/0),new N(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,r=e.length;i<r;i++){let n=e[i];Ro.setFromBufferAttribute(n),this.morphTargetsRelative?(ms.addVectors(this.boundingBox.min,Ro.min),this.boundingBox.expandByPoint(ms),ms.addVectors(this.boundingBox.max,Ro.max),this.boundingBox.expandByPoint(ms)):(this.boundingBox.expandByPoint(Ro.min),this.boundingBox.expandByPoint(Ro.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new wo);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new N,1/0);return}if(t){let i=this.boundingSphere.center;if(Ro.setFromBufferAttribute(t),e)for(let n=0,s=e.length;n<s;n++){let a=e[n];Jx.setFromBufferAttribute(a),this.morphTargetsRelative?(ms.addVectors(Ro.min,Jx.min),Ro.expandByPoint(ms),ms.addVectors(Ro.max,Jx.max),Ro.expandByPoint(ms)):(Ro.expandByPoint(Jx.min),Ro.expandByPoint(Jx.max))}Ro.getCenter(i);let r=0;for(let n=0,s=t.count;n<s;n++)ms.fromBufferAttribute(t,n),r=Math.max(r,i.distanceToSquared(ms));if(e)for(let n=0,s=e.length;n<s;n++){let a=e[n],o=this.morphTargetsRelative;for(let l=0,c=a.count;l<c;l++)ms.fromBufferAttribute(a,l),o&&(nv.fromBufferAttribute(t,l),ms.add(nv)),r=Math.max(r,i.distanceToSquared(ms))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=t.array,r=e.position.array,n=e.normal.array,s=e.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Yt(new Float32Array(4*a),4));let o=this.getAttribute("tangent").array,l=[],c=[];for(let T=0;T<a;T++)l[T]=new N,c[T]=new N;let h=new N,u=new N,d=new N,f=new ye,p=new ye,m=new ye,g=new N,v=new N;function y(T,C,D){h.fromArray(r,T*3),u.fromArray(r,C*3),d.fromArray(r,D*3),f.fromArray(s,T*2),p.fromArray(s,C*2),m.fromArray(s,D*2),u.sub(h),d.sub(h),p.sub(f),m.sub(f);let B=1/(p.x*m.y-m.x*p.y);!isFinite(B)||(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-p.y).multiplyScalar(B),v.copy(d).multiplyScalar(p.x).addScaledVector(u,-m.x).multiplyScalar(B),l[T].add(g),l[C].add(g),l[D].add(g),c[T].add(v),c[C].add(v),c[D].add(v))}let x=this.groups;x.length===0&&(x=[{start:0,count:i.length}]);for(let T=0,C=x.length;T<C;++T){let D=x[T],B=D.start,O=D.count;for(let L=B,H=B+O;L<H;L+=3)y(i[L+0],i[L+1],i[L+2])}let S=new N,A=new N,_=new N,M=new N;function E(T){_.fromArray(n,T*3),M.copy(_);let C=l[T];S.copy(C),S.sub(_.multiplyScalar(_.dot(C))).normalize(),A.crossVectors(M,C);let D=A.dot(c[T])<0?-1:1;o[T*4]=S.x,o[T*4+1]=S.y,o[T*4+2]=S.z,o[T*4+3]=D}for(let T=0,C=x.length;T<C;++T){let D=x[T],B=D.start,O=D.count;for(let L=B,H=B+O;L<H;L+=3)E(i[L+0]),E(i[L+1]),E(i[L+2])}}computeVertexNormals(){let t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Yt(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let u=0,d=i.count;u<d;u++)i.setXYZ(u,0,0,0);let r=new N,n=new N,s=new N,a=new N,o=new N,l=new N,c=new N,h=new N;if(t)for(let u=0,d=t.count;u<d;u+=3){let f=t.getX(u+0),p=t.getX(u+1),m=t.getX(u+2);r.fromBufferAttribute(e,f),n.fromBufferAttribute(e,p),s.fromBufferAttribute(e,m),c.subVectors(s,n),h.subVectors(r,n),c.cross(h),a.fromBufferAttribute(i,f),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,m),a.add(c),o.add(c),l.add(c),i.setXYZ(f,a.x,a.y,a.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let u=0,d=e.count;u<d;u+=3)r.fromBufferAttribute(e,u+0),n.fromBufferAttribute(e,u+1),s.fromBufferAttribute(e,u+2),c.subVectors(s,n),h.subVectors(r,n),c.cross(h),i.setXYZ(u+0,c.x,c.y,c.z),i.setXYZ(u+1,c.x,c.y,c.z),i.setXYZ(u+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)ms.fromBufferAttribute(t,e),ms.normalize(),t.setXYZ(e,ms.x,ms.y,ms.z)}toNonIndexed(){function t(a,o){let l=a.array,c=a.itemSize,h=a.normalized,u=new l.constructor(o.length*c),d=0,f=0;for(let p=0,m=o.length;p<m;p++){a.isInterleavedBufferAttribute?d=o[p]*a.data.stride+a.offset:d=o[p]*c;for(let g=0;g<c;g++)u[f++]=l[d++]}return new Yt(u,c,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let e=new Nt,i=this.index.array,r=this.attributes;for(let a in r){let o=r[a],l=t(o,i);e.setAttribute(a,l)}let n=this.morphAttributes;for(let a in n){let o=[],l=n[a];for(let c=0,h=l.length;c<h;c++){let u=l[c],d=t(u,i);o.push(d)}e.morphAttributes[a]=o}e.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,o=s.length;a<o;a++){let l=s[a];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){let t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(t[l]=o[l]);return t}t.data={attributes:{}};let e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});let i=this.attributes;for(let o in i){let l=i[o];t.data.attributes[o]=l.toJSON(t.data)}let r={},n=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],c=[];for(let h=0,u=l.length;h<u;h++){let d=l[h];c.push(d.toJSON(t.data))}c.length>0&&(r[o]=c,n=!0)}n&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let e={};this.name=t.name;let i=t.index;i!==null&&this.setIndex(i.clone(e));let r=t.attributes;for(let l in r){let c=r[l];this.setAttribute(l,c.clone(e))}let n=t.morphAttributes;for(let l in n){let c=[],h=n[l];for(let u=0,d=h.length;u<d;u++)c.push(h[u].clone(e));this.morphAttributes[l]=c}this.morphTargetsRelative=t.morphTargetsRelative;let s=t.groups;for(let l=0,c=s.length;l<c;l++){let h=s[l];this.addGroup(h.start,h.count,h.materialIndex)}let a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());let o=t.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,t.parameters!==void 0&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},F7=new st,sv=new G1,E3=new wo,Zx=new N,eb=new N,tb=new N,M3=new N,fM=new N,pM=new ye,mM=new ye,gM=new ye,T3=new N,vM=new N,vr=class extends Ji{constructor(t=new Nt,e=new pd){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){let t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){let i=t[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}getVertexPosition(t,e){let i=this.geometry,r=i.attributes.position,n=i.morphAttributes.position,s=i.morphTargetsRelative;e.fromBufferAttribute(r,t);let a=this.morphTargetInfluences;if(n&&a){fM.set(0,0,0);for(let o=0,l=n.length;o<l;o++){let c=a[o],h=n[o];c!==0&&(M3.fromBufferAttribute(h,t),s?fM.addScaledVector(M3,c):fM.addScaledVector(M3.sub(e),c))}e.add(fM)}return this.isSkinnedMesh&&this.boneTransform(t,e),e}raycast(t,e){let i=this.geometry,r=this.material,n=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),E3.copy(i.boundingSphere),E3.applyMatrix4(n),t.ray.intersectsSphere(E3)===!1)||(F7.copy(n).invert(),sv.copy(t.ray).applyMatrix4(F7),i.boundingBox!==null&&sv.intersectsBox(i.boundingBox)===!1))return;let s,a=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv2,h=i.groups,u=i.drawRange;if(a!==null)if(Array.isArray(r))for(let d=0,f=h.length;d<f;d++){let p=h[d],m=r[p.materialIndex],g=Math.max(p.start,u.start),v=Math.min(a.count,Math.min(p.start+p.count,u.start+u.count));for(let y=g,x=v;y<x;y+=3){let S=a.getX(y),A=a.getX(y+1),_=a.getX(y+2);s=yM(this,m,t,sv,l,c,S,A,_),s&&(s.faceIndex=Math.floor(y/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else{let d=Math.max(0,u.start),f=Math.min(a.count,u.start+u.count);for(let p=d,m=f;p<m;p+=3){let g=a.getX(p),v=a.getX(p+1),y=a.getX(p+2);s=yM(this,r,t,sv,l,c,g,v,y),s&&(s.faceIndex=Math.floor(p/3),e.push(s))}}else if(o!==void 0)if(Array.isArray(r))for(let d=0,f=h.length;d<f;d++){let p=h[d],m=r[p.materialIndex],g=Math.max(p.start,u.start),v=Math.min(o.count,Math.min(p.start+p.count,u.start+u.count));for(let y=g,x=v;y<x;y+=3){let S=y,A=y+1,_=y+2;s=yM(this,m,t,sv,l,c,S,A,_),s&&(s.faceIndex=Math.floor(y/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else{let d=Math.max(0,u.start),f=Math.min(o.count,u.start+u.count);for(let p=d,m=f;p<m;p+=3){let g=p,v=p+1,y=p+2;s=yM(this,r,t,sv,l,c,g,v,y),s&&(s.faceIndex=Math.floor(p/3),e.push(s))}}}};function TPe(t,e,i,r,n,s,a,o){let l;if(e.side===Ts?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,e.side===Lc,o),l===null)return null;vM.copy(o),vM.applyMatrix4(t.matrixWorld);let c=i.ray.origin.distanceTo(vM);return c<i.near||c>i.far?null:{distance:c,point:vM.clone(),object:t}}function yM(t,e,i,r,n,s,a,o,l){t.getVertexPosition(a,Zx),t.getVertexPosition(o,eb),t.getVertexPosition(l,tb);let c=TPe(t,e,i,r,Zx,eb,tb,T3);if(c){n&&(pM.fromBufferAttribute(n,a),mM.fromBufferAttribute(n,o),gM.fromBufferAttribute(n,l),c.uv=Ws.getUV(T3,Zx,eb,tb,pM,mM,gM,new ye)),s&&(pM.fromBufferAttribute(s,a),mM.fromBufferAttribute(s,o),gM.fromBufferAttribute(s,l),c.uv2=Ws.getUV(T3,Zx,eb,tb,pM,mM,gM,new ye));let h={a,b:o,c:l,normal:new N,materialIndex:0};Ws.getNormal(Zx,eb,tb,h.normal),c.face=h}return c}var Bc=class extends Nt{constructor(t=1,e=1,i=1,r=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:r,heightSegments:n,depthSegments:s};let a=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s);let o=[],l=[],c=[],h=[],u=0,d=0;f("z","y","x",-1,-1,i,e,t,s,n,0),f("z","y","x",1,-1,i,e,-t,s,n,1),f("x","z","y",1,1,t,i,e,r,s,2),f("x","z","y",1,-1,t,i,-e,r,s,3),f("x","y","z",1,-1,t,e,i,r,n,4),f("x","y","z",-1,-1,t,e,-i,r,n,5),this.setIndex(o),this.setAttribute("position",new bt(l,3)),this.setAttribute("normal",new bt(c,3)),this.setAttribute("uv",new bt(h,2));function f(p,m,g,v,y,x,S,A,_,M,E){let T=x/_,C=S/M,D=x/2,B=S/2,O=A/2,L=_+1,H=M+1,q=0,W=0,I=new N;for(let z=0;z<H;z++){let U=z*C-B;for(let X=0;X<L;X++){let Q=X*T-D;I[p]=Q*v,I[m]=U*y,I[g]=O,l.push(I.x,I.y,I.z),I[p]=0,I[m]=0,I[g]=A>0?1:-1,c.push(I.x,I.y,I.z),h.push(X/_),h.push(1-z/M),q+=1}}for(let z=0;z<M;z++)for(let U=0;U<_;U++){let X=u+U+L*z,Q=u+U+L*(z+1),re=u+(U+1)+L*(z+1),ie=u+(U+1)+L*z;o.push(X,Q,ie),o.push(Q,re,ie),W+=6}a.addGroup(d,W,E),d+=W,u+=q}}static fromJSON(t){return new Bc(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}};function a1(t){let e={};for(let i in t){e[i]={};for(let r in t[i]){let n=t[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?e[i][r]=n.clone():Array.isArray(n)?e[i][r]=n.slice():e[i][r]=n}}return e}function Ra(t){let e={};for(let i=0;i<t.length;i++){let r=a1(t[i]);for(let n in r)e[n]=r[n]}return e}function CPe(t){let e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}function _se(t){return t.getRenderTarget()===null&&t.outputEncoding===fi?fh:A2}var V1={clone:a1,merge:Ra},PPe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,DPe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Ri=class extends A_{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=PPe,this.fragmentShader=DPe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=a1(t.uniforms),this.uniformsGroups=CPe(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){let e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(let r in this.uniforms){let n=this.uniforms[r].value;n&&n.isTexture?e.uniforms[r]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[r]={type:"m4",value:n.toArray()}:e.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}},Lp=class extends Ji{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new st,this.projectionMatrix=new st,this.projectionMatrixInverse=new st}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},ua=class extends Lp{constructor(t=50,e=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){let e=.5*this.getFilmHeight()/t;this.fov=uS*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){let t=Math.tan(cw*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return uS*2*Math.atan(Math.tan(cw*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,r,n,s){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=this.near,e=t*Math.tan(cw*.5*this.fov)/this.zoom,i=2*e,r=this.aspect*i,n=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){let o=s.fullWidth,l=s.fullHeight;n+=s.offsetX*r/o,e-=s.offsetY*i/l,r*=s.width/o,i*=s.height/l}let a=this.filmOffset;a!==0&&(n+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}},av=-90,ov=1,RPe=class extends Ji{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i;let r=new ua(av,ov,t,e);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);let n=new ua(av,ov,t,e);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(-1,0,0),this.add(n);let s=new ua(av,ov,t,e);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let a=new ua(av,ov,t,e);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);let o=new ua(av,ov,t,e);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new ua(av,ov,t,e);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(t,e){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,n,s,a,o,l]=this.children,c=t.getRenderTarget(),h=t.toneMapping,u=t.xr.enabled;t.toneMapping=Lh,t.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,r),t.setRenderTarget(i,1),t.render(e,n),t.setRenderTarget(i,2),t.render(e,s),t.setRenderTarget(i,3),t.render(e,a),t.setRenderTarget(i,4),t.render(e,o),i.texture.generateMipmaps=d,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(c),t.toneMapping=h,t.xr.enabled=u,i.texture.needsPMREMUpdate=!0}},T5=class extends Kr{constructor(t,e,i,r,n,s,a,o,l,c){t=t!==void 0?t:[],e=e!==void 0?e:zg,super(t,e,i,r,n,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}},IPe=class extends Di{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;let i={width:t,height:t,depth:1},r=[i,i,i,i,i,i];this.texture=new T5(r,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:mi}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Bc(5,5,5),n=new Ri({name:"CubemapFromEquirect",uniforms:a1(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Ts,blending:Nn});n.uniforms.tEquirect.value=e;let s=new vr(r,n),a=e.minFilter;return e.minFilter===s1&&(e.minFilter=mi),new RPe(1,10,this).update(t,s),e.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,i,r){let n=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(e,i,r);t.setRenderTarget(n)}},C3=new N,LPe=new N,OPe=new Bn,ro=class{constructor(t=new N(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){let r=C3.subVectors(i,e).cross(LPe.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){let t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){let i=t.delta(C3),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;let n=-(t.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:e.copy(i).multiplyScalar(n).add(t.start)}intersectsLine(t){let e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){let i=e||OPe.getNormalMatrix(t),r=this.coplanarPoint(C3).applyMatrix4(t),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}},lv=new wo,xM=new N,C5=class{constructor(t=new ro,e=new ro,i=new ro,r=new ro,n=new ro,s=new ro){this.planes=[t,e,i,r,n,s]}set(t,e,i,r,n,s){let a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(s),this}copy(t){let e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){let e=this.planes,i=t.elements,r=i[0],n=i[1],s=i[2],a=i[3],o=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],f=i[10],p=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return e[0].setComponents(a-r,h-o,p-u,y-m).normalize(),e[1].setComponents(a+r,h+o,p+u,y+m).normalize(),e[2].setComponents(a+n,h+l,p+d,y+g).normalize(),e[3].setComponents(a-n,h-l,p-d,y-g).normalize(),e[4].setComponents(a-s,h-c,p-f,y-v).normalize(),e[5].setComponents(a+s,h+c,p+f,y+v).normalize(),this}intersectsObject(t){let e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),lv.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(lv)}intersectsSprite(t){return lv.center.set(0,0,0),lv.radius=.7071067811865476,lv.applyMatrix4(t.matrixWorld),this.intersectsSphere(lv)}intersectsSphere(t){let e=this.planes,i=t.center,r=-t.radius;for(let n=0;n<6;n++)if(e[n].distanceToPoint(i)<r)return!1;return!0}intersectsBox(t){let e=this.planes;for(let i=0;i<6;i++){let r=e[i];if(xM.x=r.normal.x>0?t.max.x:t.min.x,xM.y=r.normal.y>0?t.max.y:t.min.y,xM.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(xM)<0)return!1}return!0}containsPoint(t){let e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function Ase(){let t=null,e=!1,i=null,r=null;function n(s,a){i(s,a),r=t.requestAnimationFrame(n)}return{start:function(){e!==!0&&i!==null&&(r=t.requestAnimationFrame(n),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){i=s},setContext:function(s){t=s}}}function BPe(t,e){let i=e.isWebGL2,r=new WeakMap;function n(c,h){let u=c.array,d=c.usage,f=t.createBuffer();t.bindBuffer(h,f),t.bufferData(h,u,d),c.onUploadCallback();let p;if(u instanceof Float32Array)p=5126;else if(u instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(i)p=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else p=5123;else if(u instanceof Int16Array)p=5122;else if(u instanceof Uint32Array)p=5125;else if(u instanceof Int32Array)p=5124;else if(u instanceof Int8Array)p=5120;else if(u instanceof Uint8Array)p=5121;else if(u instanceof Uint8ClampedArray)p=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:f,type:p,bytesPerElement:u.BYTES_PER_ELEMENT,version:c.version}}function s(c,h,u){let d=h.array,f=h.updateRange;t.bindBuffer(u,c),f.count===-1?t.bufferSubData(u,0,d):(i?t.bufferSubData(u,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):t.bufferSubData(u,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1),h.onUploadCallback()}function a(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);let h=r.get(c);h&&(t.deleteBuffer(h.buffer),r.delete(c))}function l(c,h){if(c.isGLBufferAttribute){let d=r.get(c);(!d||d.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let u=r.get(c);u===void 0?r.set(c,n(c,h)):u.version<c.version&&(s(u.buffer,c,h),u.version=c.version)}return{get:a,remove:o,update:l}}var Vh=class extends Nt{constructor(t=1,e=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:r};let n=t/2,s=e/2,a=Math.floor(i),o=Math.floor(r),l=a+1,c=o+1,h=t/a,u=e/o,d=[],f=[],p=[],m=[];for(let g=0;g<c;g++){let v=g*u-s;for(let y=0;y<l;y++){let x=y*h-n;f.push(x,-v,0),p.push(0,0,1),m.push(y/a),m.push(1-g/o)}}for(let g=0;g<o;g++)for(let v=0;v<a;v++){let y=v+l*g,x=v+l*(g+1),S=v+1+l*(g+1),A=v+1+l*g;d.push(y,x,A),d.push(x,S,A)}this.setIndex(d),this.setAttribute("position",new bt(f,3)),this.setAttribute("normal",new bt(p,3)),this.setAttribute("uv",new bt(m,2))}static fromJSON(t){return new Vh(t.width,t.height,t.widthSegments,t.heightSegments)}},FPe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,kPe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,NPe=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,UPe=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,zPe=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,GPe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,VPe="vec3 transformed = vec3( position );",HPe=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,jPe=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,WPe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,XPe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,YPe=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,qPe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,KPe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,QPe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,$Pe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,JPe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,ZPe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,eDe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,tDe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,iDe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,rDe=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,nDe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,sDe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,aDe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,oDe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,lDe="gl_FragColor = linearToOutputTexel( gl_FragColor );",cDe=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,hDe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,uDe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,dDe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,fDe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,pDe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,mDe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,gDe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,vDe=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,yDe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,xDe=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,bDe=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,wDe=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,SDe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,_De=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,ADe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,EDe=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,MDe=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,TDe=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,CDe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,PDe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,DDe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,RDe=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,IDe=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,LDe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,ODe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,BDe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,FDe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,kDe=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,NDe=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,UDe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,zDe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,GDe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,VDe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,HDe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,jDe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,WDe=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,XDe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,YDe=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,qDe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,KDe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,QDe=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,$De=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,JDe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,ZDe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,eRe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,tRe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,iRe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,rRe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,nRe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,sRe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,aRe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,oRe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,lRe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,cRe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,hRe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,uRe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,dRe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,fRe=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,pRe=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,mRe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,gRe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,vRe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,yRe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,xRe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,bRe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,wRe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,SRe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,_Re=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,ARe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,ERe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,MRe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,TRe=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,CRe=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,PRe=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,DRe=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,RRe=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,IRe=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,LRe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,ORe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,BRe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,FRe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,kRe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,NRe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,URe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,zRe=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,GRe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,VRe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,HRe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,jRe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,WRe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,XRe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,YRe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,qRe=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,KRe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,QRe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,$Re=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,JRe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,ZRe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,eIe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,tIe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,iIe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,rIe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,nIe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,sIe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,aIe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,oIe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lIe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,cIe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,hIe=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,uIe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,dIe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fIe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,pi={alphamap_fragment:FPe,alphamap_pars_fragment:kPe,alphatest_fragment:NPe,alphatest_pars_fragment:UPe,aomap_fragment:zPe,aomap_pars_fragment:GPe,begin_vertex:VPe,beginnormal_vertex:HPe,bsdfs:jPe,iridescence_fragment:WPe,bumpmap_pars_fragment:XPe,clipping_planes_fragment:YPe,clipping_planes_pars_fragment:qPe,clipping_planes_pars_vertex:KPe,clipping_planes_vertex:QPe,color_fragment:$Pe,color_pars_fragment:JPe,color_pars_vertex:ZPe,color_vertex:eDe,common:tDe,cube_uv_reflection_fragment:iDe,defaultnormal_vertex:rDe,displacementmap_pars_vertex:nDe,displacementmap_vertex:sDe,emissivemap_fragment:aDe,emissivemap_pars_fragment:oDe,encodings_fragment:lDe,encodings_pars_fragment:cDe,envmap_fragment:hDe,envmap_common_pars_fragment:uDe,envmap_pars_fragment:dDe,envmap_pars_vertex:fDe,envmap_physical_pars_fragment:EDe,envmap_vertex:pDe,fog_vertex:mDe,fog_pars_vertex:gDe,fog_fragment:vDe,fog_pars_fragment:yDe,gradientmap_pars_fragment:xDe,lightmap_fragment:bDe,lightmap_pars_fragment:wDe,lights_lambert_fragment:SDe,lights_lambert_pars_fragment:_De,lights_pars_begin:ADe,lights_toon_fragment:MDe,lights_toon_pars_fragment:TDe,lights_phong_fragment:CDe,lights_phong_pars_fragment:PDe,lights_physical_fragment:DDe,lights_physical_pars_fragment:RDe,lights_fragment_begin:IDe,lights_fragment_maps:LDe,lights_fragment_end:ODe,logdepthbuf_fragment:BDe,logdepthbuf_pars_fragment:FDe,logdepthbuf_pars_vertex:kDe,logdepthbuf_vertex:NDe,map_fragment:UDe,map_pars_fragment:zDe,map_particle_fragment:GDe,map_particle_pars_fragment:VDe,metalnessmap_fragment:HDe,metalnessmap_pars_fragment:jDe,morphcolor_vertex:WDe,morphnormal_vertex:XDe,morphtarget_pars_vertex:YDe,morphtarget_vertex:qDe,normal_fragment_begin:KDe,normal_fragment_maps:QDe,normal_pars_fragment:$De,normal_pars_vertex:JDe,normal_vertex:ZDe,normalmap_pars_fragment:eRe,clearcoat_normal_fragment_begin:tRe,clearcoat_normal_fragment_maps:iRe,clearcoat_pars_fragment:rRe,iridescence_pars_fragment:nRe,output_fragment:sRe,packing:aRe,premultiplied_alpha_fragment:oRe,project_vertex:lRe,dithering_fragment:cRe,dithering_pars_fragment:hRe,roughnessmap_fragment:uRe,roughnessmap_pars_fragment:dRe,shadowmap_pars_fragment:fRe,shadowmap_pars_vertex:pRe,shadowmap_vertex:mRe,shadowmask_pars_fragment:gRe,skinbase_vertex:vRe,skinning_pars_vertex:yRe,skinning_vertex:xRe,skinnormal_vertex:bRe,specularmap_fragment:wRe,specularmap_pars_fragment:SRe,tonemapping_fragment:_Re,tonemapping_pars_fragment:ARe,transmission_fragment:ERe,transmission_pars_fragment:MRe,uv_pars_fragment:TRe,uv_pars_vertex:CRe,uv_vertex:PRe,uv2_pars_fragment:DRe,uv2_pars_vertex:RRe,uv2_vertex:IRe,worldpos_vertex:LRe,background_vert:ORe,background_frag:BRe,backgroundCube_vert:FRe,backgroundCube_frag:kRe,cube_vert:NRe,cube_frag:URe,depth_vert:zRe,depth_frag:GRe,distanceRGBA_vert:VRe,distanceRGBA_frag:HRe,equirect_vert:jRe,equirect_frag:WRe,linedashed_vert:XRe,linedashed_frag:YRe,meshbasic_vert:qRe,meshbasic_frag:KRe,meshlambert_vert:QRe,meshlambert_frag:$Re,meshmatcap_vert:JRe,meshmatcap_frag:ZRe,meshnormal_vert:eIe,meshnormal_frag:tIe,meshphong_vert:iIe,meshphong_frag:rIe,meshphysical_vert:nIe,meshphysical_frag:sIe,meshtoon_vert:aIe,meshtoon_frag:oIe,points_vert:lIe,points_frag:cIe,shadow_vert:hIe,shadow_frag:uIe,sprite_vert:dIe,sprite_frag:fIe},yt={common:{diffuse:{value:new Xt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Bn},uv2Transform:{value:new Bn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ye(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Xt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Xt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Bn}},sprite:{diffuse:{value:new Xt(16777215)},opacity:{value:1},center:{value:new ye(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Bn}}},vh={basic:{uniforms:Ra([yt.common,yt.specularmap,yt.envmap,yt.aomap,yt.lightmap,yt.fog]),vertexShader:pi.meshbasic_vert,fragmentShader:pi.meshbasic_frag},lambert:{uniforms:Ra([yt.common,yt.specularmap,yt.envmap,yt.aomap,yt.lightmap,yt.emissivemap,yt.bumpmap,yt.normalmap,yt.displacementmap,yt.fog,yt.lights,{emissive:{value:new Xt(0)}}]),vertexShader:pi.meshlambert_vert,fragmentShader:pi.meshlambert_frag},phong:{uniforms:Ra([yt.common,yt.specularmap,yt.envmap,yt.aomap,yt.lightmap,yt.emissivemap,yt.bumpmap,yt.normalmap,yt.displacementmap,yt.fog,yt.lights,{emissive:{value:new Xt(0)},specular:{value:new Xt(1118481)},shininess:{value:30}}]),vertexShader:pi.meshphong_vert,fragmentShader:pi.meshphong_frag},standard:{uniforms:Ra([yt.common,yt.envmap,yt.aomap,yt.lightmap,yt.emissivemap,yt.bumpmap,yt.normalmap,yt.displacementmap,yt.roughnessmap,yt.metalnessmap,yt.fog,yt.lights,{emissive:{value:new Xt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:pi.meshphysical_vert,fragmentShader:pi.meshphysical_frag},toon:{uniforms:Ra([yt.common,yt.aomap,yt.lightmap,yt.emissivemap,yt.bumpmap,yt.normalmap,yt.displacementmap,yt.gradientmap,yt.fog,yt.lights,{emissive:{value:new Xt(0)}}]),vertexShader:pi.meshtoon_vert,fragmentShader:pi.meshtoon_frag},matcap:{uniforms:Ra([yt.common,yt.bumpmap,yt.normalmap,yt.displacementmap,yt.fog,{matcap:{value:null}}]),vertexShader:pi.meshmatcap_vert,fragmentShader:pi.meshmatcap_frag},points:{uniforms:Ra([yt.points,yt.fog]),vertexShader:pi.points_vert,fragmentShader:pi.points_frag},dashed:{uniforms:Ra([yt.common,yt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:pi.linedashed_vert,fragmentShader:pi.linedashed_frag},depth:{uniforms:Ra([yt.common,yt.displacementmap]),vertexShader:pi.depth_vert,fragmentShader:pi.depth_frag},normal:{uniforms:Ra([yt.common,yt.bumpmap,yt.normalmap,yt.displacementmap,{opacity:{value:1}}]),vertexShader:pi.meshnormal_vert,fragmentShader:pi.meshnormal_frag},sprite:{uniforms:Ra([yt.sprite,yt.fog]),vertexShader:pi.sprite_vert,fragmentShader:pi.sprite_frag},background:{uniforms:{uvTransform:{value:new Bn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:pi.background_vert,fragmentShader:pi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:pi.backgroundCube_vert,fragmentShader:pi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:pi.cube_vert,fragmentShader:pi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:pi.equirect_vert,fragmentShader:pi.equirect_frag},distanceRGBA:{uniforms:Ra([yt.common,yt.displacementmap,{referencePosition:{value:new N},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:pi.distanceRGBA_vert,fragmentShader:pi.distanceRGBA_frag},shadow:{uniforms:Ra([yt.lights,yt.fog,{color:{value:new Xt(0)},opacity:{value:1}}]),vertexShader:pi.shadow_vert,fragmentShader:pi.shadow_frag}};vh.physical={uniforms:Ra([vh.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ye(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Xt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ye},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Xt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Xt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:pi.meshphysical_vert,fragmentShader:pi.meshphysical_frag};var bM={r:0,b:0,g:0};function pIe(t,e,i,r,n,s,a){let o=new Xt(0),l=s===!0?0:1,c,h,u=null,d=0,f=null;function p(g,v){let y=!1,x=v.isScene===!0?v.background:null;x&&x.isTexture&&(x=(v.backgroundBlurriness>0?i:e).get(x));let S=t.xr,A=S.getSession&&S.getSession();A&&A.environmentBlendMode==="additive"&&(x=null),x===null?m(o,l):x&&x.isColor&&(m(x,1),y=!0),(t.autoClear||y)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),x&&(x.isCubeTexture||x.mapping===__)?(h===void 0&&(h=new vr(new Bc(1,1,1),new Ri({name:"BackgroundCubeMaterial",uniforms:a1(vh.backgroundCube.uniforms),vertexShader:vh.backgroundCube.vertexShader,fragmentShader:vh.backgroundCube.fragmentShader,side:Ts,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(_,M,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h)),h.material.uniforms.envMap.value=x,h.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,h.material.toneMapped=x.encoding!==fi,(u!==x||d!==x.version||f!==t.toneMapping)&&(h.material.needsUpdate=!0,u=x,d=x.version,f=t.toneMapping),h.layers.enableAll(),g.unshift(h,h.geometry,h.material,0,0,null)):x&&x.isTexture&&(c===void 0&&(c=new vr(new Vh(2,2),new Ri({name:"BackgroundMaterial",uniforms:a1(vh.background.uniforms),vertexShader:vh.background.vertexShader,fragmentShader:vh.background.fragmentShader,side:Lc,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=x,c.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,c.material.toneMapped=x.encoding!==fi,x.matrixAutoUpdate===!0&&x.updateMatrix(),c.material.uniforms.uvTransform.value.copy(x.matrix),(u!==x||d!==x.version||f!==t.toneMapping)&&(c.material.needsUpdate=!0,u=x,d=x.version,f=t.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null))}function m(g,v){g.getRGB(bM,_se(t)),r.buffers.color.setClear(bM.r,bM.g,bM.b,v,a)}return{getClearColor:function(){return o},setClearColor:function(g,v=1){o.set(g),l=v,m(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,m(o,l)},render:p}}function mIe(t,e,i,r){let n=t.getParameter(34921),s=r.isWebGL2?null:e.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=g(null),c=l,h=!1;function u(L,H,q,W,I){let z=!1;if(a){let U=m(W,q,H);c!==U&&(c=U,f(c.object)),z=v(L,W,q,I),z&&y(L,W,q,I)}else{let U=H.wireframe===!0;(c.geometry!==W.id||c.program!==q.id||c.wireframe!==U)&&(c.geometry=W.id,c.program=q.id,c.wireframe=U,z=!0)}I!==null&&i.update(I,34963),(z||h)&&(h=!1,E(L,H,q,W),I!==null&&t.bindBuffer(34963,i.get(I).buffer))}function d(){return r.isWebGL2?t.createVertexArray():s.createVertexArrayOES()}function f(L){return r.isWebGL2?t.bindVertexArray(L):s.bindVertexArrayOES(L)}function p(L){return r.isWebGL2?t.deleteVertexArray(L):s.deleteVertexArrayOES(L)}function m(L,H,q){let W=q.wireframe===!0,I=o[L.id];I===void 0&&(I={},o[L.id]=I);let z=I[H.id];z===void 0&&(z={},I[H.id]=z);let U=z[W];return U===void 0&&(U=g(d()),z[W]=U),U}function g(L){let H=[],q=[],W=[];for(let I=0;I<n;I++)H[I]=0,q[I]=0,W[I]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:H,enabledAttributes:q,attributeDivisors:W,object:L,attributes:{},index:null}}function v(L,H,q,W){let I=c.attributes,z=H.attributes,U=0,X=q.getAttributes();for(let Q in X)if(X[Q].location>=0){let re=I[Q],ie=z[Q];if(ie===void 0&&(Q==="instanceMatrix"&&L.instanceMatrix&&(ie=L.instanceMatrix),Q==="instanceColor"&&L.instanceColor&&(ie=L.instanceColor)),re===void 0||re.attribute!==ie||ie&&re.data!==ie.data)return!0;U++}return c.attributesNum!==U||c.index!==W}function y(L,H,q,W){let I={},z=H.attributes,U=0,X=q.getAttributes();for(let Q in X)if(X[Q].location>=0){let re=z[Q];re===void 0&&(Q==="instanceMatrix"&&L.instanceMatrix&&(re=L.instanceMatrix),Q==="instanceColor"&&L.instanceColor&&(re=L.instanceColor));let ie={};ie.attribute=re,re&&re.data&&(ie.data=re.data),I[Q]=ie,U++}c.attributes=I,c.attributesNum=U,c.index=W}function x(){let L=c.newAttributes;for(let H=0,q=L.length;H<q;H++)L[H]=0}function S(L){A(L,0)}function A(L,H){let q=c.newAttributes,W=c.enabledAttributes,I=c.attributeDivisors;q[L]=1,W[L]===0&&(t.enableVertexAttribArray(L),W[L]=1),I[L]!==H&&((r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](L,H),I[L]=H)}function _(){let L=c.newAttributes,H=c.enabledAttributes;for(let q=0,W=H.length;q<W;q++)H[q]!==L[q]&&(t.disableVertexAttribArray(q),H[q]=0)}function M(L,H,q,W,I,z){r.isWebGL2===!0&&(q===5124||q===5125)?t.vertexAttribIPointer(L,H,q,I,z):t.vertexAttribPointer(L,H,q,W,I,z)}function E(L,H,q,W){if(r.isWebGL2===!1&&(L.isInstancedMesh||W.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;x();let I=W.attributes,z=q.getAttributes(),U=H.defaultAttributeValues;for(let X in z){let Q=z[X];if(Q.location>=0){let re=I[X];if(re===void 0&&(X==="instanceMatrix"&&L.instanceMatrix&&(re=L.instanceMatrix),X==="instanceColor"&&L.instanceColor&&(re=L.instanceColor)),re!==void 0){let ie=re.normalized,ce=re.itemSize,Z=i.get(re);if(Z===void 0)continue;let Ae=Z.buffer,Se=Z.type,_e=Z.bytesPerElement;if(re.isInterleavedBufferAttribute){let ve=re.data,Ee=ve.stride,fe=re.offset;if(ve.isInstancedInterleavedBuffer){for(let pe=0;pe<Q.locationSize;pe++)A(Q.location+pe,ve.meshPerAttribute);L.isInstancedMesh!==!0&&W._maxInstanceCount===void 0&&(W._maxInstanceCount=ve.meshPerAttribute*ve.count)}else for(let pe=0;pe<Q.locationSize;pe++)S(Q.location+pe);t.bindBuffer(34962,Ae);for(let pe=0;pe<Q.locationSize;pe++)M(Q.location+pe,ce/Q.locationSize,Se,ie,Ee*_e,(fe+ce/Q.locationSize*pe)*_e)}else{if(re.isInstancedBufferAttribute){for(let ve=0;ve<Q.locationSize;ve++)A(Q.location+ve,re.meshPerAttribute);L.isInstancedMesh!==!0&&W._maxInstanceCount===void 0&&(W._maxInstanceCount=re.meshPerAttribute*re.count)}else for(let ve=0;ve<Q.locationSize;ve++)S(Q.location+ve);t.bindBuffer(34962,Ae);for(let ve=0;ve<Q.locationSize;ve++)M(Q.location+ve,ce/Q.locationSize,Se,ie,ce*_e,ce/Q.locationSize*ve*_e)}}else if(U!==void 0){let ie=U[X];if(ie!==void 0)switch(ie.length){case 2:t.vertexAttrib2fv(Q.location,ie);break;case 3:t.vertexAttrib3fv(Q.location,ie);break;case 4:t.vertexAttrib4fv(Q.location,ie);break;default:t.vertexAttrib1fv(Q.location,ie)}}}}_()}function T(){B();for(let L in o){let H=o[L];for(let q in H){let W=H[q];for(let I in W)p(W[I].object),delete W[I];delete H[q]}delete o[L]}}function C(L){if(o[L.id]===void 0)return;let H=o[L.id];for(let q in H){let W=H[q];for(let I in W)p(W[I].object),delete W[I];delete H[q]}delete o[L.id]}function D(L){for(let H in o){let q=o[H];if(q[L.id]===void 0)continue;let W=q[L.id];for(let I in W)p(W[I].object),delete W[I];delete q[L.id]}}function B(){O(),h=!0,c!==l&&(c=l,f(c.object))}function O(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:B,resetDefaultState:O,dispose:T,releaseStatesOfGeometry:C,releaseStatesOfProgram:D,initAttributes:x,enableAttribute:S,disableUnusedAttributes:_}}function gIe(t,e,i,r){let n=r.isWebGL2,s;function a(c){s=c}function o(c,h){t.drawArrays(s,c,h),i.update(h,s,1)}function l(c,h,u){if(u===0)return;let d,f;if(n)d=t,f="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[f](s,c,h,u),i.update(h,s,u)}this.setMode=a,this.render=o,this.renderInstances=l}function vIe(t,e,i){let r;function n(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){let M=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(M){if(M==="highp"){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";M="mediump"}return M==="mediump"&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext,o=i.precision!==void 0?i.precision:"highp",l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let c=a||e.has("WEBGL_draw_buffers"),h=i.logarithmicDepthBuffer===!0,u=t.getParameter(34930),d=t.getParameter(35660),f=t.getParameter(3379),p=t.getParameter(34076),m=t.getParameter(34921),g=t.getParameter(36347),v=t.getParameter(36348),y=t.getParameter(36349),x=d>0,S=a||e.has("OES_texture_float"),A=x&&S,_=a?t.getParameter(36183):0;return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:h,maxTextures:u,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:g,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:x,floatFragmentTextures:S,floatVertexTextures:A,maxSamples:_}}function yIe(t){let e=this,i=null,r=0,n=!1,s=!1,a=new ro,o=new Bn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d){let f=u.length!==0||d||r!==0||n;return n=d,r=u.length,f},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(u,d){i=h(u,d,0)},this.setState=function(u,d,f){let p=u.clippingPlanes,m=u.clipIntersection,g=u.clipShadows,v=t.get(u);if(!n||p===null||p.length===0||s&&!g)s?h(null):c();else{let y=s?0:r,x=y*4,S=v.clippingState||null;l.value=S,S=h(p,d,x,f);for(let A=0;A!==x;++A)S[A]=i[A];v.clippingState=S,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=y}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function h(u,d,f,p){let m=u!==null?u.length:0,g=null;if(m!==0){if(g=l.value,p!==!0||g===null){let v=f+m*4,y=d.matrixWorldInverse;o.getNormalMatrix(y),(g===null||g.length<v)&&(g=new Float32Array(v));for(let x=0,S=f;x!==m;++x,S+=4)a.copy(u[x]).applyMatrix4(y,o),a.normal.toArray(g,S),g[S+3]=a.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,g}}function xIe(t){let e=new WeakMap;function i(a,o){return o===Pk?a.mapping=zg:o===Dk&&(a.mapping=Gg),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let o=a.mapping;if(o===Pk||o===Dk)if(e.has(a)){let l=e.get(a).texture;return i(l,a.mapping)}else{let l=a.image;if(l&&l.height>0){let c=new IPe(l.height/2);return c.fromEquirectangularTexture(t,a),e.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){let o=a.target;o.removeEventListener("dispose",n);let l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}var MD=class extends Lp{constructor(t=-1,e=1,i=1,r=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=r,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,i,r,n,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-t,s=i+t,a=r+e,o=r-e;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,s=n+l*this.view.width,a-=c*this.view.offsetY,o=a-c*this.view.height}this.projectionMatrix.makeOrthographic(n,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}},ny=4,k7=[.125,.215,.35,.446,.526,.582],Rm=20,P3=new MD,N7=new Xt,D3=null,_m=(1+Math.sqrt(5))/2,cv=1/_m,U7=[new N(1,1,1),new N(-1,1,1),new N(1,1,-1),new N(-1,1,-1),new N(0,_m,cv),new N(0,_m,-cv),new N(cv,0,_m),new N(-cv,0,_m),new N(_m,cv,0),new N(-_m,cv,0)],z7=class{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,r=100){D3=this._renderer.getRenderTarget(),this._setSize(256);let n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(t,i,r,n),e>0&&this._blur(n,0,0,e),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=H7(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=V7(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(D3),t.scissorTest=!1,wM(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===zg||t.mapping===Gg?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),D3=this._renderer.getRenderTarget();let i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:mi,minFilter:mi,generateMipmaps:!1,type:fd,format:Fr,encoding:Oc,depthBuffer:!1},r=G7(t,e,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=G7(t,e,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=bIe(n)),this._blurMaterial=wIe(n,t,e)}return r}_compileMaterial(t){let e=new vr(this._lodPlanes[0],t);this._renderer.compile(e,P3)}_sceneToCubeUV(t,e,i,r){let n=new ua(90,1,e,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(N7),o.toneMapping=Lh,o.autoClear=!1;let h=new pd({name:"PMREM.Background",side:Ts,depthWrite:!1,depthTest:!1}),u=new vr(new Bc,h),d=!1,f=t.background;f?f.isColor&&(h.color.copy(f),t.background=null,d=!0):(h.color.copy(N7),d=!0);for(let p=0;p<6;p++){let m=p%3;m===0?(n.up.set(0,s[p],0),n.lookAt(a[p],0,0)):m===1?(n.up.set(0,0,s[p]),n.lookAt(0,a[p],0)):(n.up.set(0,s[p],0),n.lookAt(0,0,a[p]));let g=this._cubeSize;wM(r,m*g,p>2?g:0,g,g),o.setRenderTarget(r),d&&o.render(u,n),o.render(t,n)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=c,o.autoClear=l,t.background=f}_textureToCubeUV(t,e){let i=this._renderer,r=t.mapping===zg||t.mapping===Gg;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=H7()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=V7());let n=r?this._cubemapMaterial:this._equirectMaterial,s=new vr(this._lodPlanes[0],n),a=n.uniforms;a.envMap.value=t;let o=this._cubeSize;wM(e,0,0,3*o,2*o),i.setRenderTarget(e),i.render(s,P3)}_applyPMREM(t){let e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let n=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),s=U7[(r-1)%U7.length];this._blur(t,r-1,r,n,s)}e.autoClear=i}_blur(t,e,i,r,n){let s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,r,"latitudinal",n),this._halfBlur(s,t,i,i,r,"longitudinal",n)}_halfBlur(t,e,i,r,n,s,a){let o=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let c=3,h=new vr(this._lodPlanes[r],l),u=l.uniforms,d=this._sizeLods[i]-1,f=isFinite(n)?Math.PI/(2*d):2*Math.PI/(2*Rm-1),p=n/f,m=isFinite(n)?1+Math.floor(c*p):Rm;m>Rm&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${Rm}`);let g=[],v=0;for(let _=0;_<Rm;++_){let M=_/p,E=Math.exp(-M*M/2);g.push(E),_===0?v+=E:_<m&&(v+=2*E)}for(let _=0;_<g.length;_++)g[_]=g[_]/v;u.envMap.value=t.texture,u.samples.value=m,u.weights.value=g,u.latitudinal.value=s==="latitudinal",a&&(u.poleAxis.value=a);let{_lodMax:y}=this;u.dTheta.value=f,u.mipInt.value=y-i;let x=this._sizeLods[r],S=3*x*(r>y-ny?r-y+ny:0),A=4*(this._cubeSize-x);wM(e,S,A,3*x,2*x),o.setRenderTarget(e),o.render(h,P3)}};function bIe(t){let e=[],i=[],r=[],n=t,s=t-ny+1+k7.length;for(let a=0;a<s;a++){let o=Math.pow(2,n);i.push(o);let l=1/o;a>t-ny?l=k7[a-t+ny-1]:a===0&&(l=0),r.push(l);let c=1/(o-2),h=-c,u=1+c,d=[h,h,u,h,u,u,h,h,u,u,h,u],f=6,p=6,m=3,g=2,v=1,y=new Float32Array(m*p*f),x=new Float32Array(g*p*f),S=new Float32Array(v*p*f);for(let _=0;_<f;_++){let M=_%3*2/3-1,E=_>2?0:-1,T=[M,E,0,M+2/3,E,0,M+2/3,E+1,0,M,E,0,M+2/3,E+1,0,M,E+1,0];y.set(T,m*p*_),x.set(d,g*p*_);let C=[_,_,_,_,_,_];S.set(C,v*p*_)}let A=new Nt;A.setAttribute("position",new Yt(y,m)),A.setAttribute("uv",new Yt(x,g)),A.setAttribute("faceIndex",new Yt(S,v)),e.push(A),n>ny&&n--}return{lodPlanes:e,sizeLods:i,sigmas:r}}function G7(t,e,i){let r=new Di(t,e,i);return r.texture.mapping=__,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function wM(t,e,i,r,n){t.viewport.set(e,i,r,n),t.scissor.set(e,i,r,n)}function wIe(t,e,i){let r=new Float32Array(Rm),n=new N(0,1,0);return new Ri({name:"SphericalGaussianBlur",defines:{n:Rm,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:P5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Nn,depthTest:!1,depthWrite:!1})}function V7(){return new Ri({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:P5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Nn,depthTest:!1,depthWrite:!1})}function H7(){return new Ri({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:P5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Nn,depthTest:!1,depthWrite:!1})}function P5(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function SIe(t){let e=new WeakMap,i=null;function r(o){if(o&&o.isTexture){let l=o.mapping,c=l===Pk||l===Dk,h=l===zg||l===Gg;if(c||h)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let u=e.get(o);return i===null&&(i=new z7(t)),u=c?i.fromEquirectangular(o,u):i.fromCubemap(o,u),e.set(o,u),u.texture}else{if(e.has(o))return e.get(o).texture;{let u=o.image;if(c&&u&&u.height>0||h&&u&&n(u)){i===null&&(i=new z7(t));let d=c?i.fromEquirectangular(o):i.fromCubemap(o);return e.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0,c=6;for(let h=0;h<c;h++)o[h]!==void 0&&l++;return l===c}function s(o){let l=o.target;l.removeEventListener("dispose",s);let c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function a(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function _Ie(t){let e={};function i(r){if(e[r]!==void 0)return e[r];let n;switch(r){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(r)}return e[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function AIe(t,e,i,r){let n={},s=new WeakMap;function a(u){let d=u.target;d.index!==null&&e.remove(d.index);for(let p in d.attributes)e.remove(d.attributes[p]);d.removeEventListener("dispose",a),delete n[d.id];let f=s.get(d);f&&(e.remove(f),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(u,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(u){let d=u.attributes;for(let p in d)e.update(d[p],34962);let f=u.morphAttributes;for(let p in f){let m=f[p];for(let g=0,v=m.length;g<v;g++)e.update(m[g],34962)}}function c(u){let d=[],f=u.index,p=u.attributes.position,m=0;if(f!==null){let y=f.array;m=f.version;for(let x=0,S=y.length;x<S;x+=3){let A=y[x+0],_=y[x+1],M=y[x+2];d.push(A,_,_,M,M,A)}}else{let y=p.array;m=p.version;for(let x=0,S=y.length/3-1;x<S;x+=3){let A=x+0,_=x+1,M=x+2;d.push(A,_,_,M,M,A)}}let g=new(gse(d)?My:Sse)(d,1);g.version=m;let v=s.get(u);v&&e.remove(v),s.set(u,g)}function h(u){let d=s.get(u);if(d){let f=u.index;f!==null&&d.version<f.version&&c(u)}else c(u);return s.get(u)}return{get:o,update:l,getWireframeAttribute:h}}function EIe(t,e,i,r){let n=r.isWebGL2,s;function a(d){s=d}let o,l;function c(d){o=d.type,l=d.bytesPerElement}function h(d,f){t.drawElements(s,f,o,d*l),i.update(f,s,1)}function u(d,f,p){if(p===0)return;let m,g;if(n)m=t,g="drawElementsInstanced";else if(m=e.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",m===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[g](s,f,o,d*l,p),i.update(f,s,p)}this.setMode=a,this.setIndex=c,this.render=h,this.renderInstances=u}function MIe(t){let e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case 4:i.triangles+=o*(s/3);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:n,update:r}}function TIe(t,e){return t[0]-e[0]}function CIe(t,e){return Math.abs(e[1])-Math.abs(t[1])}function PIe(t,e,i){let r={},n=new Float32Array(8),s=new WeakMap,a=new si,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,h,u,d){let f=c.morphTargetInfluences;if(e.isWebGL2===!0){let p=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,m=p!==void 0?p.length:0,g=s.get(h);if(g===void 0||g.count!==m){let x=function(){L.dispose(),s.delete(h),h.removeEventListener("dispose",x)};g!==void 0&&g.texture.dispose();let S=h.morphAttributes.position!==void 0,A=h.morphAttributes.normal!==void 0,_=h.morphAttributes.color!==void 0,M=h.morphAttributes.position||[],E=h.morphAttributes.normal||[],T=h.morphAttributes.color||[],C=0;S===!0&&(C=1),A===!0&&(C=2),_===!0&&(C=3);let D=h.attributes.position.count*C,B=1;D>e.maxTextureSize&&(B=Math.ceil(D/e.maxTextureSize),D=e.maxTextureSize);let O=new Float32Array(D*B*4*m),L=new bse(O,D,B,m);L.type=tr,L.needsUpdate=!0;let H=C*4;for(let q=0;q<m;q++){let W=M[q],I=E[q],z=T[q],U=D*B*4*q;for(let X=0;X<W.count;X++){let Q=X*H;S===!0&&(a.fromBufferAttribute(W,X),O[U+Q+0]=a.x,O[U+Q+1]=a.y,O[U+Q+2]=a.z,O[U+Q+3]=0),A===!0&&(a.fromBufferAttribute(I,X),O[U+Q+4]=a.x,O[U+Q+5]=a.y,O[U+Q+6]=a.z,O[U+Q+7]=0),_===!0&&(a.fromBufferAttribute(z,X),O[U+Q+8]=a.x,O[U+Q+9]=a.y,O[U+Q+10]=a.z,O[U+Q+11]=z.itemSize===4?a.w:1)}}g={count:m,texture:L,size:new ye(D,B)},s.set(h,g),h.addEventListener("dispose",x)}let v=0;for(let x=0;x<f.length;x++)v+=f[x];let y=h.morphTargetsRelative?1:1-v;d.getUniforms().setValue(t,"morphTargetBaseInfluence",y),d.getUniforms().setValue(t,"morphTargetInfluences",f),d.getUniforms().setValue(t,"morphTargetsTexture",g.texture,i),d.getUniforms().setValue(t,"morphTargetsTextureSize",g.size)}else{let p=f===void 0?0:f.length,m=r[h.id];if(m===void 0||m.length!==p){m=[];for(let S=0;S<p;S++)m[S]=[S,0];r[h.id]=m}for(let S=0;S<p;S++){let A=m[S];A[0]=S,A[1]=f[S]}m.sort(CIe);for(let S=0;S<8;S++)S<p&&m[S][1]?(o[S][0]=m[S][0],o[S][1]=m[S][1]):(o[S][0]=Number.MAX_SAFE_INTEGER,o[S][1]=0);o.sort(TIe);let g=h.morphAttributes.position,v=h.morphAttributes.normal,y=0;for(let S=0;S<8;S++){let A=o[S],_=A[0],M=A[1];_!==Number.MAX_SAFE_INTEGER&&M?(g&&h.getAttribute("morphTarget"+S)!==g[_]&&h.setAttribute("morphTarget"+S,g[_]),v&&h.getAttribute("morphNormal"+S)!==v[_]&&h.setAttribute("morphNormal"+S,v[_]),n[S]=M,y+=M):(g&&h.hasAttribute("morphTarget"+S)===!0&&h.deleteAttribute("morphTarget"+S),v&&h.hasAttribute("morphNormal"+S)===!0&&h.deleteAttribute("morphNormal"+S),n[S]=0)}let x=h.morphTargetsRelative?1:1-y;d.getUniforms().setValue(t,"morphTargetBaseInfluence",x),d.getUniforms().setValue(t,"morphTargetInfluences",n)}}return{update:l}}function DIe(t,e,i,r){let n=new WeakMap;function s(l){let c=r.render.frame,h=l.geometry,u=e.get(l,h);return n.get(u)!==c&&(e.update(u),n.set(u,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),u}function a(){n=new WeakMap}function o(l){let c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}var Ese=new Kr,Mse=new bse,Tse=new vPe,Cse=new T5,j7=[],W7=[],X7=new Float32Array(16),Y7=new Float32Array(9),q7=new Float32Array(4);function H1(t,e,i){let r=t[0];if(r==null||r<=0||r>0)return t;let n=e*i,s=j7[n];if(s===void 0&&(s=new Float32Array(n),j7[n]=s),e!==0){r.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=i,t[a].toArray(s,o)}return s}function ss(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function as(t,e){for(let i=0,r=e.length;i<r;i++)t[i]=e[i]}function TD(t,e){let i=W7[e];i===void 0&&(i=new Int32Array(e),W7[e]=i);for(let r=0;r!==e;++r)i[r]=t.allocateTextureUnit();return i}function RIe(t,e){let i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function IIe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ss(i,e))return;t.uniform2fv(this.addr,e),as(i,e)}}function LIe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(ss(i,e))return;t.uniform3fv(this.addr,e),as(i,e)}}function OIe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ss(i,e))return;t.uniform4fv(this.addr,e),as(i,e)}}function BIe(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(ss(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),as(i,e)}else{if(ss(i,r))return;q7.set(r),t.uniformMatrix2fv(this.addr,!1,q7),as(i,r)}}function FIe(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(ss(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),as(i,e)}else{if(ss(i,r))return;Y7.set(r),t.uniformMatrix3fv(this.addr,!1,Y7),as(i,r)}}function kIe(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(ss(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),as(i,e)}else{if(ss(i,r))return;X7.set(r),t.uniformMatrix4fv(this.addr,!1,X7),as(i,r)}}function NIe(t,e){let i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function UIe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ss(i,e))return;t.uniform2iv(this.addr,e),as(i,e)}}function zIe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(ss(i,e))return;t.uniform3iv(this.addr,e),as(i,e)}}function GIe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ss(i,e))return;t.uniform4iv(this.addr,e),as(i,e)}}function VIe(t,e){let i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function HIe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ss(i,e))return;t.uniform2uiv(this.addr,e),as(i,e)}}function jIe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(ss(i,e))return;t.uniform3uiv(this.addr,e),as(i,e)}}function WIe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ss(i,e))return;t.uniform4uiv(this.addr,e),as(i,e)}}function XIe(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(e||Ese,n)}function YIe(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(e||Tse,n)}function qIe(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(e||Cse,n)}function KIe(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(e||Mse,n)}function QIe(t){switch(t){case 5126:return RIe;case 35664:return IIe;case 35665:return LIe;case 35666:return OIe;case 35674:return BIe;case 35675:return FIe;case 35676:return kIe;case 5124:case 35670:return NIe;case 35667:case 35671:return UIe;case 35668:case 35672:return zIe;case 35669:case 35673:return GIe;case 5125:return VIe;case 36294:return HIe;case 36295:return jIe;case 36296:return WIe;case 35678:case 36198:case 36298:case 36306:case 35682:return XIe;case 35679:case 36299:case 36307:return YIe;case 35680:case 36300:case 36308:case 36293:return qIe;case 36289:case 36303:case 36311:case 36292:return KIe}}function $Ie(t,e){t.uniform1fv(this.addr,e)}function JIe(t,e){let i=H1(e,this.size,2);t.uniform2fv(this.addr,i)}function ZIe(t,e){let i=H1(e,this.size,3);t.uniform3fv(this.addr,i)}function eLe(t,e){let i=H1(e,this.size,4);t.uniform4fv(this.addr,i)}function tLe(t,e){let i=H1(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function iLe(t,e){let i=H1(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function rLe(t,e){let i=H1(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function nLe(t,e){t.uniform1iv(this.addr,e)}function sLe(t,e){t.uniform2iv(this.addr,e)}function aLe(t,e){t.uniform3iv(this.addr,e)}function oLe(t,e){t.uniform4iv(this.addr,e)}function lLe(t,e){t.uniform1uiv(this.addr,e)}function cLe(t,e){t.uniform2uiv(this.addr,e)}function hLe(t,e){t.uniform3uiv(this.addr,e)}function uLe(t,e){t.uniform4uiv(this.addr,e)}function dLe(t,e,i){let r=this.cache,n=e.length,s=TD(i,n);ss(r,s)||(t.uniform1iv(this.addr,s),as(r,s));for(let a=0;a!==n;++a)i.setTexture2D(e[a]||Ese,s[a])}function fLe(t,e,i){let r=this.cache,n=e.length,s=TD(i,n);ss(r,s)||(t.uniform1iv(this.addr,s),as(r,s));for(let a=0;a!==n;++a)i.setTexture3D(e[a]||Tse,s[a])}function pLe(t,e,i){let r=this.cache,n=e.length,s=TD(i,n);ss(r,s)||(t.uniform1iv(this.addr,s),as(r,s));for(let a=0;a!==n;++a)i.setTextureCube(e[a]||Cse,s[a])}function mLe(t,e,i){let r=this.cache,n=e.length,s=TD(i,n);ss(r,s)||(t.uniform1iv(this.addr,s),as(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(e[a]||Mse,s[a])}function gLe(t){switch(t){case 5126:return $Ie;case 35664:return JIe;case 35665:return ZIe;case 35666:return eLe;case 35674:return tLe;case 35675:return iLe;case 35676:return rLe;case 5124:case 35670:return nLe;case 35667:case 35671:return sLe;case 35668:case 35672:return aLe;case 35669:case 35673:return oLe;case 5125:return lLe;case 36294:return cLe;case 36295:return hLe;case 36296:return uLe;case 35678:case 36198:case 36298:case 36306:case 35682:return dLe;case 35679:case 36299:case 36307:return fLe;case 35680:case 36300:case 36308:case 36293:return pLe;case 36289:case 36303:case 36311:case 36292:return mLe}}var vLe=class{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=QIe(e.type)}},yLe=class{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=gLe(e.type)}},xLe=class{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){if(e===void 0)return;let r=this.seq;for(let n=0,s=r.length;n!==s;++n){let a=r[n];a.setValue(t,e[a.id],i)}}},R3=/(\w+)(\])?(\[|\.)?/g;function K7(t,e){t.seq.push(e),t.map[e.id]=e}function bLe(t,e,i){let r=t.name,n=r.length;for(R3.lastIndex=0;;){let s=R3.exec(r),a=R3.lastIndex,o=s[1],l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){K7(i,c===void 0?new vLe(o,t,e):new yLe(o,t,e));break}else{let h=i.map[o];h===void 0&&(h=new xLe(o),K7(i,h)),i=h}}}var hC=class{constructor(t,e){this.seq=[],this.map={};let i=t.getProgramParameter(e,35718);for(let r=0;r<i;++r){let n=t.getActiveUniform(e,r),s=t.getUniformLocation(e,n.name);bLe(n,s,this)}}setValue(t,e,i,r){let n=this.map[e];n!==void 0&&n.setValue(t,i,r)}setOptional(t,e,i){let r=e[i];r!==void 0&&this.setValue(t,i,r)}static upload(t,e,i,r){for(let n=0,s=e.length;n!==s;++n){let a=e[n],o=i[a.id];o.needsUpdate!==!1&&a.setValue(t,o.value,r)}}static seqWithValue(t,e){let i=[];for(let r=0,n=t.length;r!==n;++r){let s=t[r];s.id in e&&i.push(s)}return i}};function Q7(t,e,i){let r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}var wLe=0;function SLe(t,e){let i=t.split(`
`),r=[],n=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let a=n;a<s;a++){let o=a+1;r.push(`${o===e?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function _Le(t){switch(t){case Oc:return["Linear","( value )"];case fi:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function $7(t,e,i){let r=t.getShaderParameter(e,35713),n=t.getShaderInfoLog(e).trim();if(r&&n==="")return"";let s=/ERROR: 0:(\d+)/.exec(n);if(s){let a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+SLe(t.getShaderSource(e),a)}else return n}function ALe(t,e){let i=_Le(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function ELe(t,e){let i;switch(e){case I2e:i="Linear";break;case L2e:i="Reinhard";break;case O2e:i="OptimizedCineon";break;case B2e:i="ACESFilmic";break;case F2e:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function MLe(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||t.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ob).join(`
`)}function TLe(t){let e=[];for(let i in t){let r=t[i];r!==!1&&e.push("#define "+i+" "+r)}return e.join(`
`)}function CLe(t,e){let i={},r=t.getProgramParameter(e,35721);for(let n=0;n<r;n++){let s=t.getActiveAttrib(e,n),a=s.name,o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),i[a]={type:s.type,location:t.getAttribLocation(e,a),locationSize:o}}return i}function Ob(t){return t!==""}function J7(t,e){let i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Z7(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var PLe=/^[ \t]*#include +<([\w\d./]+)>/gm;function Fk(t){return t.replace(PLe,DLe)}function DLe(t,e){let i=pi[e];if(i===void 0)throw new Error("Can not resolve #include <"+e+">");return Fk(i)}var RLe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function eX(t){return t.replace(RLe,ILe)}function ILe(t,e,i,r){let n="";for(let s=parseInt(e);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function tX(t){let e="precision "+t.precision+` float;
precision `+t.precision+" int;";return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function LLe(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===S5?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===h2e?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===Lb&&(e="SHADOWMAP_TYPE_VSM"),e}function OLe(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case zg:case Gg:e="ENVMAP_TYPE_CUBE";break;case __:e="ENVMAP_TYPE_CUBE_UV";break}return e}function BLe(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case Gg:e="ENVMAP_MODE_REFRACTION";break}return e}function FLe(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case lse:e="ENVMAP_BLENDING_MULTIPLY";break;case D2e:e="ENVMAP_BLENDING_MIX";break;case R2e:e="ENVMAP_BLENDING_ADD";break}return e}function kLe(t){let e=t.envMapCubeUVHeight;if(e===null)return null;let i=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function NLe(t,e,i,r){let n=t.getContext(),s=i.defines,a=i.vertexShader,o=i.fragmentShader,l=LLe(i),c=OLe(i),h=BLe(i),u=FLe(i),d=kLe(i),f=i.isWebGL2?"":MLe(i),p=TLe(s),m=n.createProgram(),g,v,y=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(g=[p].filter(Ob).join(`
`),g.length>0&&(g+=`
`),v=[f,p].filter(Ob).join(`
`),v.length>0&&(v+=`
`)):(g=[tX(i),"#define SHADER_NAME "+i.shaderName,p,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Ob).join(`
`),v=[f,tX(i),"#define SHADER_NAME "+i.shaderName,p,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Lh?"#define TONE_MAPPING":"",i.toneMapping!==Lh?pi.tonemapping_pars_fragment:"",i.toneMapping!==Lh?ELe("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",pi.encodings_pars_fragment,ALe("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Ob).join(`
`)),a=Fk(a),a=J7(a,i),a=Z7(a,i),o=Fk(o),o=J7(o,i),o=Z7(o,i),a=eX(a),o=eX(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,v=["#define varying in",i.glslVersion===Lk?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Lk?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);let x=y+g+a,S=y+v+o,A=Q7(n,35633,x),_=Q7(n,35632,S);if(n.attachShader(m,A),n.attachShader(m,_),i.index0AttributeName!==void 0?n.bindAttribLocation(m,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(m,0,"position"),n.linkProgram(m),t.debug.checkShaderErrors){let T=n.getProgramInfoLog(m).trim(),C=n.getShaderInfoLog(A).trim(),D=n.getShaderInfoLog(_).trim(),B=!0,O=!0;if(n.getProgramParameter(m,35714)===!1){B=!1;let L=$7(n,A,"vertex"),H=$7(n,_,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(m,35715)+`

Program Info Log: `+T+`
`+L+`
`+H)}else T!==""?console.warn("THREE.WebGLProgram: Program Info Log:",T):(C===""||D==="")&&(O=!1);O&&(this.diagnostics={runnable:B,programLog:T,vertexShader:{log:C,prefix:g},fragmentShader:{log:D,prefix:v}})}n.deleteShader(A),n.deleteShader(_);let M;this.getUniforms=function(){return M===void 0&&(M=new hC(n,m)),M};let E;return this.getAttributes=function(){return E===void 0&&(E=CLe(n,m)),E},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(m),this.program=void 0},this.name=i.shaderName,this.id=wLe++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=A,this.fragmentShader=_,this}var ULe=0,zLe=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){let e=t.vertexShader,i=t.fragmentShader,r=this._getShaderStage(e),n=this._getShaderStage(i),s=this._getShaderCacheForMaterial(t);return s.has(r)===!1&&(s.add(r),r.usedTimes++),s.has(n)===!1&&(s.add(n),n.usedTimes++),this}remove(t){let e=this.materialCache.get(t);for(let i of e)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){let e=this.materialCache,i=e.get(t);return i===void 0&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){let e=this.shaderCache,i=e.get(t);return i===void 0&&(i=new GLe(t),e.set(t,i)),i}},GLe=class{constructor(t){this.id=ULe++,this.code=t,this.usedTimes=0}};function VLe(t,e,i,r,n,s,a){let o=new M5,l=new zLe,c=[],h=n.isWebGL2,u=n.logarithmicDepthBuffer,d=n.vertexTextures,f=n.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(E,T,C,D,B){let O=D.fog,L=B.geometry,H=E.isMeshStandardMaterial?D.environment:null,q=(E.isMeshStandardMaterial?i:e).get(E.envMap||H),W=q&&q.mapping===__?q.image.height:null,I=p[E.type];E.precision!==null&&(f=n.getMaxPrecision(E.precision),f!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",f,"instead."));let z=L.morphAttributes.position||L.morphAttributes.normal||L.morphAttributes.color,U=z!==void 0?z.length:0,X=0;L.morphAttributes.position!==void 0&&(X=1),L.morphAttributes.normal!==void 0&&(X=2),L.morphAttributes.color!==void 0&&(X=3);let Q,re,ie,ce;if(I){let ve=vh[I];Q=ve.vertexShader,re=ve.fragmentShader}else Q=E.vertexShader,re=E.fragmentShader,l.update(E),ie=l.getVertexShaderID(E),ce=l.getFragmentShaderID(E);let Z=t.getRenderTarget(),Ae=E.alphaTest>0,Se=E.clearcoat>0,_e=E.iridescence>0;return{isWebGL2:h,shaderID:I,shaderName:E.type,vertexShader:Q,fragmentShader:re,defines:E.defines,customVertexShaderID:ie,customFragmentShaderID:ce,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:f,instancing:B.isInstancedMesh===!0,instancingColor:B.isInstancedMesh===!0&&B.instanceColor!==null,supportsVertexTextures:d,outputEncoding:Z===null?t.outputEncoding:Z.isXRRenderTarget===!0?Z.texture.encoding:Oc,map:!!E.map,matcap:!!E.matcap,envMap:!!q,envMapMode:q&&q.mapping,envMapCubeUVHeight:W,lightMap:!!E.lightMap,aoMap:!!E.aoMap,emissiveMap:!!E.emissiveMap,bumpMap:!!E.bumpMap,normalMap:!!E.normalMap,objectSpaceNormalMap:E.normalMapType===J2e,tangentSpaceNormalMap:E.normalMapType===$2e,decodeVideoTexture:!!E.map&&E.map.isVideoTexture===!0&&E.map.encoding===fi,clearcoat:Se,clearcoatMap:Se&&!!E.clearcoatMap,clearcoatRoughnessMap:Se&&!!E.clearcoatRoughnessMap,clearcoatNormalMap:Se&&!!E.clearcoatNormalMap,iridescence:_e,iridescenceMap:_e&&!!E.iridescenceMap,iridescenceThicknessMap:_e&&!!E.iridescenceThicknessMap,displacementMap:!!E.displacementMap,roughnessMap:!!E.roughnessMap,metalnessMap:!!E.metalnessMap,specularMap:!!E.specularMap,specularIntensityMap:!!E.specularIntensityMap,specularColorMap:!!E.specularColorMap,opaque:E.transparent===!1&&E.blending===mg,alphaMap:!!E.alphaMap,alphaTest:Ae,gradientMap:!!E.gradientMap,sheen:E.sheen>0,sheenColorMap:!!E.sheenColorMap,sheenRoughnessMap:!!E.sheenRoughnessMap,transmission:E.transmission>0,transmissionMap:!!E.transmissionMap,thicknessMap:!!E.thicknessMap,combine:E.combine,vertexTangents:!!E.normalMap&&!!L.attributes.tangent,vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!L.attributes.color&&L.attributes.color.itemSize===4,vertexUvs:!!E.map||!!E.bumpMap||!!E.normalMap||!!E.specularMap||!!E.alphaMap||!!E.emissiveMap||!!E.roughnessMap||!!E.metalnessMap||!!E.clearcoatMap||!!E.clearcoatRoughnessMap||!!E.clearcoatNormalMap||!!E.iridescenceMap||!!E.iridescenceThicknessMap||!!E.displacementMap||!!E.transmissionMap||!!E.thicknessMap||!!E.specularIntensityMap||!!E.specularColorMap||!!E.sheenColorMap||!!E.sheenRoughnessMap,uvsVertexOnly:!(E.map||E.bumpMap||E.normalMap||E.specularMap||E.alphaMap||E.emissiveMap||E.roughnessMap||E.metalnessMap||E.clearcoatNormalMap||E.iridescenceMap||E.iridescenceThicknessMap||E.transmission>0||E.transmissionMap||E.thicknessMap||E.specularIntensityMap||E.specularColorMap||E.sheen>0||E.sheenColorMap||E.sheenRoughnessMap)&&!!E.displacementMap,fog:!!O,useFog:E.fog===!0,fogExp2:O&&O.isFogExp2,flatShading:!!E.flatShading,sizeAttenuation:E.sizeAttenuation,logarithmicDepthBuffer:u,skinning:B.isSkinnedMesh===!0,morphTargets:L.morphAttributes.position!==void 0,morphNormals:L.morphAttributes.normal!==void 0,morphColors:L.morphAttributes.color!==void 0,morphTargetsCount:U,morphTextureStride:X,numDirLights:T.directional.length,numPointLights:T.point.length,numSpotLights:T.spot.length,numSpotLightMaps:T.spotLightMap.length,numRectAreaLights:T.rectArea.length,numHemiLights:T.hemi.length,numDirLightShadows:T.directionalShadowMap.length,numPointLightShadows:T.pointShadowMap.length,numSpotLightShadows:T.spotShadowMap.length,numSpotLightShadowsWithMaps:T.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:E.dithering,shadowMapEnabled:t.shadowMap.enabled&&C.length>0,shadowMapType:t.shadowMap.type,toneMapping:E.toneMapped?t.toneMapping:Lh,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===pa,flipSided:E.side===Ts,useDepthPacking:!!E.depthPacking,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionDerivatives:E.extensions&&E.extensions.derivatives,extensionFragDepth:E.extensions&&E.extensions.fragDepth,extensionDrawBuffers:E.extensions&&E.extensions.drawBuffers,extensionShaderTextureLOD:E.extensions&&E.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||r.has("EXT_shader_texture_lod"),customProgramCacheKey:E.customProgramCacheKey()}}function g(E){let T=[];if(E.shaderID?T.push(E.shaderID):(T.push(E.customVertexShaderID),T.push(E.customFragmentShaderID)),E.defines!==void 0)for(let C in E.defines)T.push(C),T.push(E.defines[C]);return E.isRawShaderMaterial===!1&&(v(T,E),y(T,E),T.push(t.outputEncoding)),T.push(E.customProgramCacheKey),T.join()}function v(E,T){E.push(T.precision),E.push(T.outputEncoding),E.push(T.envMapMode),E.push(T.envMapCubeUVHeight),E.push(T.combine),E.push(T.vertexUvs),E.push(T.fogExp2),E.push(T.sizeAttenuation),E.push(T.morphTargetsCount),E.push(T.morphAttributeCount),E.push(T.numDirLights),E.push(T.numPointLights),E.push(T.numSpotLights),E.push(T.numSpotLightMaps),E.push(T.numHemiLights),E.push(T.numRectAreaLights),E.push(T.numDirLightShadows),E.push(T.numPointLightShadows),E.push(T.numSpotLightShadows),E.push(T.numSpotLightShadowsWithMaps),E.push(T.shadowMapType),E.push(T.toneMapping),E.push(T.numClippingPlanes),E.push(T.numClipIntersection),E.push(T.depthPacking)}function y(E,T){o.disableAll(),T.isWebGL2&&o.enable(0),T.supportsVertexTextures&&o.enable(1),T.instancing&&o.enable(2),T.instancingColor&&o.enable(3),T.map&&o.enable(4),T.matcap&&o.enable(5),T.envMap&&o.enable(6),T.lightMap&&o.enable(7),T.aoMap&&o.enable(8),T.emissiveMap&&o.enable(9),T.bumpMap&&o.enable(10),T.normalMap&&o.enable(11),T.objectSpaceNormalMap&&o.enable(12),T.tangentSpaceNormalMap&&o.enable(13),T.clearcoat&&o.enable(14),T.clearcoatMap&&o.enable(15),T.clearcoatRoughnessMap&&o.enable(16),T.clearcoatNormalMap&&o.enable(17),T.iridescence&&o.enable(18),T.iridescenceMap&&o.enable(19),T.iridescenceThicknessMap&&o.enable(20),T.displacementMap&&o.enable(21),T.specularMap&&o.enable(22),T.roughnessMap&&o.enable(23),T.metalnessMap&&o.enable(24),T.gradientMap&&o.enable(25),T.alphaMap&&o.enable(26),T.alphaTest&&o.enable(27),T.vertexColors&&o.enable(28),T.vertexAlphas&&o.enable(29),T.vertexUvs&&o.enable(30),T.vertexTangents&&o.enable(31),T.uvsVertexOnly&&o.enable(32),E.push(o.mask),o.disableAll(),T.fog&&o.enable(0),T.useFog&&o.enable(1),T.flatShading&&o.enable(2),T.logarithmicDepthBuffer&&o.enable(3),T.skinning&&o.enable(4),T.morphTargets&&o.enable(5),T.morphNormals&&o.enable(6),T.morphColors&&o.enable(7),T.premultipliedAlpha&&o.enable(8),T.shadowMapEnabled&&o.enable(9),T.physicallyCorrectLights&&o.enable(10),T.doubleSided&&o.enable(11),T.flipSided&&o.enable(12),T.useDepthPacking&&o.enable(13),T.dithering&&o.enable(14),T.specularIntensityMap&&o.enable(15),T.specularColorMap&&o.enable(16),T.transmission&&o.enable(17),T.transmissionMap&&o.enable(18),T.thicknessMap&&o.enable(19),T.sheen&&o.enable(20),T.sheenColorMap&&o.enable(21),T.sheenRoughnessMap&&o.enable(22),T.decodeVideoTexture&&o.enable(23),T.opaque&&o.enable(24),E.push(o.mask)}function x(E){let T=p[E.type],C;if(T){let D=vh[T];C=V1.clone(D.uniforms)}else C=E.uniforms;return C}function S(E,T){let C;for(let D=0,B=c.length;D<B;D++){let O=c[D];if(O.cacheKey===T){C=O,++C.usedTimes;break}}return C===void 0&&(C=new NLe(t,T,E,s),c.push(C)),C}function A(E){if(--E.usedTimes===0){let T=c.indexOf(E);c[T]=c[c.length-1],c.pop(),E.destroy()}}function _(E){l.remove(E)}function M(){l.dispose()}return{getParameters:m,getProgramCacheKey:g,getUniforms:x,acquireProgram:S,releaseProgram:A,releaseShaderCache:_,programs:c,dispose:M}}function HLe(){let t=new WeakMap;function e(s){let a=t.get(s);return a===void 0&&(a={},t.set(s,a)),a}function i(s){t.delete(s)}function r(s,a,o){t.get(s)[a]=o}function n(){t=new WeakMap}return{get:e,remove:i,update:r,dispose:n}}function jLe(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function iX(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function rX(){let t=[],e=0,i=[],r=[],n=[];function s(){e=0,i.length=0,r.length=0,n.length=0}function a(u,d,f,p,m,g){let v=t[e];return v===void 0?(v={id:u.id,object:u,geometry:d,material:f,groupOrder:p,renderOrder:u.renderOrder,z:m,group:g},t[e]=v):(v.id=u.id,v.object=u,v.geometry=d,v.material=f,v.groupOrder=p,v.renderOrder=u.renderOrder,v.z=m,v.group=g),e++,v}function o(u,d,f,p,m,g){let v=a(u,d,f,p,m,g);f.transmission>0?r.push(v):f.transparent===!0?n.push(v):i.push(v)}function l(u,d,f,p,m,g){let v=a(u,d,f,p,m,g);f.transmission>0?r.unshift(v):f.transparent===!0?n.unshift(v):i.unshift(v)}function c(u,d){i.length>1&&i.sort(u||jLe),r.length>1&&r.sort(d||iX),n.length>1&&n.sort(d||iX)}function h(){for(let u=e,d=t.length;u<d;u++){let f=t[u];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:h,sort:c}}function WLe(){let t=new WeakMap;function e(r,n){let s=t.get(r),a;return s===void 0?(a=new rX,t.set(r,[a])):n>=s.length?(a=new rX,s.push(a)):a=s[n],a}function i(){t=new WeakMap}return{get:e,dispose:i}}function XLe(){let t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new N,color:new Xt};break;case"SpotLight":i={position:new N,direction:new N,color:new Xt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new N,color:new Xt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new N,skyColor:new Xt,groundColor:new Xt};break;case"RectAreaLight":i={color:new Xt,position:new N,halfWidth:new N,halfHeight:new N};break}return t[e.id]=i,i}}}function YLe(){let t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ye};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ye};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ye,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=i,i}}}var qLe=0;function KLe(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function QLe(t,e){let i=new XLe,r=YLe(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let h=0;h<9;h++)n.probe.push(new N);let s=new N,a=new st,o=new st;function l(h,u){let d=0,f=0,p=0;for(let D=0;D<9;D++)n.probe[D].set(0,0,0);let m=0,g=0,v=0,y=0,x=0,S=0,A=0,_=0,M=0,E=0;h.sort(KLe);let T=u!==!0?Math.PI:1;for(let D=0,B=h.length;D<B;D++){let O=h[D],L=O.color,H=O.intensity,q=O.distance,W=O.shadow&&O.shadow.map?O.shadow.map.texture:null;if(O.isAmbientLight)d+=L.r*H*T,f+=L.g*H*T,p+=L.b*H*T;else if(O.isLightProbe)for(let I=0;I<9;I++)n.probe[I].addScaledVector(O.sh.coefficients[I],H);else if(O.isDirectionalLight){let I=i.get(O);if(I.color.copy(O.color).multiplyScalar(O.intensity*T),O.castShadow){let z=O.shadow,U=r.get(O);U.shadowBias=z.bias,U.shadowNormalBias=z.normalBias,U.shadowRadius=z.radius,U.shadowMapSize=z.mapSize,n.directionalShadow[m]=U,n.directionalShadowMap[m]=W,n.directionalShadowMatrix[m]=O.shadow.matrix,S++}n.directional[m]=I,m++}else if(O.isSpotLight){let I=i.get(O);I.position.setFromMatrixPosition(O.matrixWorld),I.color.copy(L).multiplyScalar(H*T),I.distance=q,I.coneCos=Math.cos(O.angle),I.penumbraCos=Math.cos(O.angle*(1-O.penumbra)),I.decay=O.decay,n.spot[v]=I;let z=O.shadow;if(O.map&&(n.spotLightMap[M]=O.map,M++,z.updateMatrices(O),O.castShadow&&E++),n.spotLightMatrix[v]=z.matrix,O.castShadow){let U=r.get(O);U.shadowBias=z.bias,U.shadowNormalBias=z.normalBias,U.shadowRadius=z.radius,U.shadowMapSize=z.mapSize,n.spotShadow[v]=U,n.spotShadowMap[v]=W,_++}v++}else if(O.isRectAreaLight){let I=i.get(O);I.color.copy(L).multiplyScalar(H),I.halfWidth.set(O.width*.5,0,0),I.halfHeight.set(0,O.height*.5,0),n.rectArea[y]=I,y++}else if(O.isPointLight){let I=i.get(O);if(I.color.copy(O.color).multiplyScalar(O.intensity*T),I.distance=O.distance,I.decay=O.decay,O.castShadow){let z=O.shadow,U=r.get(O);U.shadowBias=z.bias,U.shadowNormalBias=z.normalBias,U.shadowRadius=z.radius,U.shadowMapSize=z.mapSize,U.shadowCameraNear=z.camera.near,U.shadowCameraFar=z.camera.far,n.pointShadow[g]=U,n.pointShadowMap[g]=W,n.pointShadowMatrix[g]=O.shadow.matrix,A++}n.point[g]=I,g++}else if(O.isHemisphereLight){let I=i.get(O);I.skyColor.copy(O.color).multiplyScalar(H*T),I.groundColor.copy(O.groundColor).multiplyScalar(H*T),n.hemi[x]=I,x++}}y>0&&(e.isWebGL2||t.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=yt.LTC_FLOAT_1,n.rectAreaLTC2=yt.LTC_FLOAT_2):t.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=yt.LTC_HALF_1,n.rectAreaLTC2=yt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=f,n.ambient[2]=p;let C=n.hash;(C.directionalLength!==m||C.pointLength!==g||C.spotLength!==v||C.rectAreaLength!==y||C.hemiLength!==x||C.numDirectionalShadows!==S||C.numPointShadows!==A||C.numSpotShadows!==_||C.numSpotMaps!==M)&&(n.directional.length=m,n.spot.length=v,n.rectArea.length=y,n.point.length=g,n.hemi.length=x,n.directionalShadow.length=S,n.directionalShadowMap.length=S,n.pointShadow.length=A,n.pointShadowMap.length=A,n.spotShadow.length=_,n.spotShadowMap.length=_,n.directionalShadowMatrix.length=S,n.pointShadowMatrix.length=A,n.spotLightMatrix.length=_+M-E,n.spotLightMap.length=M,n.numSpotLightShadowsWithMaps=E,C.directionalLength=m,C.pointLength=g,C.spotLength=v,C.rectAreaLength=y,C.hemiLength=x,C.numDirectionalShadows=S,C.numPointShadows=A,C.numSpotShadows=_,C.numSpotMaps=M,n.version=qLe++)}function c(h,u){let d=0,f=0,p=0,m=0,g=0,v=u.matrixWorldInverse;for(let y=0,x=h.length;y<x;y++){let S=h[y];if(S.isDirectionalLight){let A=n.directional[d];A.direction.setFromMatrixPosition(S.matrixWorld),s.setFromMatrixPosition(S.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(v),d++}else if(S.isSpotLight){let A=n.spot[p];A.position.setFromMatrixPosition(S.matrixWorld),A.position.applyMatrix4(v),A.direction.setFromMatrixPosition(S.matrixWorld),s.setFromMatrixPosition(S.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(v),p++}else if(S.isRectAreaLight){let A=n.rectArea[m];A.position.setFromMatrixPosition(S.matrixWorld),A.position.applyMatrix4(v),o.identity(),a.copy(S.matrixWorld),a.premultiply(v),o.extractRotation(a),A.halfWidth.set(S.width*.5,0,0),A.halfHeight.set(0,S.height*.5,0),A.halfWidth.applyMatrix4(o),A.halfHeight.applyMatrix4(o),m++}else if(S.isPointLight){let A=n.point[f];A.position.setFromMatrixPosition(S.matrixWorld),A.position.applyMatrix4(v),f++}else if(S.isHemisphereLight){let A=n.hemi[g];A.direction.setFromMatrixPosition(S.matrixWorld),A.direction.transformDirection(v),g++}}}return{setup:l,setupView:c,state:n}}function nX(t,e){let i=new QLe(t,e),r=[],n=[];function s(){r.length=0,n.length=0}function a(h){r.push(h)}function o(h){n.push(h)}function l(h){i.setup(r,h)}function c(h){i.setupView(r,h)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:c,pushLight:a,pushShadow:o}}function $Le(t,e){let i=new WeakMap;function r(s,a=0){let o=i.get(s),l;return o===void 0?(l=new nX(t,e),i.set(s,[l])):a>=o.length?(l=new nX(t,e),o.push(l)):l=o[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}var Pse=class extends A_{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Cd,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}},JLe=class extends A_{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new N,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}},ZLe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,e3e=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function t3e(t,e,i){let r=new C5,n=new ye,s=new ye,a=new si,o=new Pse({depthPacking:pse}),l=new JLe,c={},h=i.maxTextureSize,u={[Lc]:Ts,[Ts]:Lc,[pa]:pa},d=new Ri({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ye},radius:{value:4}},vertexShader:ZLe,fragmentShader:e3e}),f=d.clone();f.defines.HORIZONTAL_PASS=1;let p=new Nt;p.setAttribute("position",new Yt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new vr(p,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=S5,this.render=function(S,A,_){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||S.length===0)return;let M=t.getRenderTarget(),E=t.getActiveCubeFace(),T=t.getActiveMipmapLevel(),C=t.state;C.setBlending(Nn),C.buffers.color.setClear(1,1,1,1),C.buffers.depth.setTest(!0),C.setScissorTest(!1);for(let D=0,B=S.length;D<B;D++){let O=S[D],L=O.shadow;if(L===void 0){console.warn("THREE.WebGLShadowMap:",O,"has no shadow.");continue}if(L.autoUpdate===!1&&L.needsUpdate===!1)continue;n.copy(L.mapSize);let H=L.getFrameExtents();if(n.multiply(H),s.copy(L.mapSize),(n.x>h||n.y>h)&&(n.x>h&&(s.x=Math.floor(h/H.x),n.x=s.x*H.x,L.mapSize.x=s.x),n.y>h&&(s.y=Math.floor(h/H.y),n.y=s.y*H.y,L.mapSize.y=s.y)),L.map===null){let W=this.type!==Lb?{minFilter:bi,magFilter:bi}:{};L.map=new Di(n.x,n.y,W),L.map.texture.name=O.name+".shadowMap",L.camera.updateProjectionMatrix()}t.setRenderTarget(L.map),t.clear();let q=L.getViewportCount();for(let W=0;W<q;W++){let I=L.getViewport(W);a.set(s.x*I.x,s.y*I.y,s.x*I.z,s.y*I.w),C.viewport(a),L.updateMatrices(O,W),r=L.getFrustum(),x(A,_,L.camera,O,this.type)}L.isPointLightShadow!==!0&&this.type===Lb&&v(L,_),L.needsUpdate=!1}g.needsUpdate=!1,t.setRenderTarget(M,E,T)};function v(S,A){let _=e.update(m);d.defines.VSM_SAMPLES!==S.blurSamples&&(d.defines.VSM_SAMPLES=S.blurSamples,f.defines.VSM_SAMPLES=S.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),S.mapPass===null&&(S.mapPass=new Di(n.x,n.y)),d.uniforms.shadow_pass.value=S.map.texture,d.uniforms.resolution.value=S.mapSize,d.uniforms.radius.value=S.radius,t.setRenderTarget(S.mapPass),t.clear(),t.renderBufferDirect(A,null,_,d,m,null),f.uniforms.shadow_pass.value=S.mapPass.texture,f.uniforms.resolution.value=S.mapSize,f.uniforms.radius.value=S.radius,t.setRenderTarget(S.map),t.clear(),t.renderBufferDirect(A,null,_,f,m,null)}function y(S,A,_,M,E,T){let C=null,D=_.isPointLight===!0?S.customDistanceMaterial:S.customDepthMaterial;if(D!==void 0)C=D;else if(C=_.isPointLight===!0?l:o,t.localClippingEnabled&&A.clipShadows===!0&&Array.isArray(A.clippingPlanes)&&A.clippingPlanes.length!==0||A.displacementMap&&A.displacementScale!==0||A.alphaMap&&A.alphaTest>0||A.map&&A.alphaTest>0){let B=C.uuid,O=A.uuid,L=c[B];L===void 0&&(L={},c[B]=L);let H=L[O];H===void 0&&(H=C.clone(),L[O]=H),C=H}return C.visible=A.visible,C.wireframe=A.wireframe,T===Lb?C.side=A.shadowSide!==null?A.shadowSide:A.side:C.side=A.shadowSide!==null?A.shadowSide:u[A.side],C.alphaMap=A.alphaMap,C.alphaTest=A.alphaTest,C.map=A.map,C.clipShadows=A.clipShadows,C.clippingPlanes=A.clippingPlanes,C.clipIntersection=A.clipIntersection,C.displacementMap=A.displacementMap,C.displacementScale=A.displacementScale,C.displacementBias=A.displacementBias,C.wireframeLinewidth=A.wireframeLinewidth,C.linewidth=A.linewidth,_.isPointLight===!0&&C.isMeshDistanceMaterial===!0&&(C.referencePosition.setFromMatrixPosition(_.matrixWorld),C.nearDistance=M,C.farDistance=E),C}function x(S,A,_,M,E){if(S.visible===!1)return;if(S.layers.test(A.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&E===Lb)&&(!S.frustumCulled||r.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(_.matrixWorldInverse,S.matrixWorld);let C=e.update(S),D=S.material;if(Array.isArray(D)){let B=C.groups;for(let O=0,L=B.length;O<L;O++){let H=B[O],q=D[H.materialIndex];if(q&&q.visible){let W=y(S,q,M,_.near,_.far,E);t.renderBufferDirect(_,null,C,W,S,H)}}}else if(D.visible){let B=y(S,D,M,_.near,_.far,E);t.renderBufferDirect(_,null,C,B,S,null)}}let T=S.children;for(let C=0,D=T.length;C<D;C++)x(T[C],A,_,M,E)}}function i3e(t,e,i){let r=i.isWebGL2;function n(){let J=!1,he=new si,Me=null,Ue=new si(0,0,0,0);return{setMask:function(at){Me!==at&&!J&&(t.colorMask(at,at,at,at),Me=at)},setLocked:function(at){J=at},setClear:function(at,Mt,Qt,ci,ur){ur===!0&&(at*=ci,Mt*=ci,Qt*=ci),he.set(at,Mt,Qt,ci),Ue.equals(he)===!1&&(t.clearColor(at,Mt,Qt,ci),Ue.copy(he))},reset:function(){J=!1,Me=null,Ue.set(-1,0,0,0)}}}function s(){let J=!1,he=null,Me=null,Ue=null;return{setTest:function(at){at?Ae(2929):Se(2929)},setMask:function(at){he!==at&&!J&&(t.depthMask(at),he=at)},setFunc:function(at){if(Me!==at){switch(at){case _2e:t.depthFunc(512);break;case A2e:t.depthFunc(519);break;case E2e:t.depthFunc(513);break;case Ck:t.depthFunc(515);break;case M2e:t.depthFunc(514);break;case T2e:t.depthFunc(518);break;case C2e:t.depthFunc(516);break;case P2e:t.depthFunc(517);break;default:t.depthFunc(515)}Me=at}},setLocked:function(at){J=at},setClear:function(at){Ue!==at&&(t.clearDepth(at),Ue=at)},reset:function(){J=!1,he=null,Me=null,Ue=null}}}function a(){let J=!1,he=null,Me=null,Ue=null,at=null,Mt=null,Qt=null,ci=null,ur=null;return{setTest:function(Gt){J||(Gt?Ae(2960):Se(2960))},setMask:function(Gt){he!==Gt&&!J&&(t.stencilMask(Gt),he=Gt)},setFunc:function(Gt,Qi,Bi){(Me!==Gt||Ue!==Qi||at!==Bi)&&(t.stencilFunc(Gt,Qi,Bi),Me=Gt,Ue=Qi,at=Bi)},setOp:function(Gt,Qi,Bi){(Mt!==Gt||Qt!==Qi||ci!==Bi)&&(t.stencilOp(Gt,Qi,Bi),Mt=Gt,Qt=Qi,ci=Bi)},setLocked:function(Gt){J=Gt},setClear:function(Gt){ur!==Gt&&(t.clearStencil(Gt),ur=Gt)},reset:function(){J=!1,he=null,Me=null,Ue=null,at=null,Mt=null,Qt=null,ci=null,ur=null}}}let o=new n,l=new s,c=new a,h=new WeakMap,u=new WeakMap,d={},f={},p=new WeakMap,m=[],g=null,v=!1,y=null,x=null,S=null,A=null,_=null,M=null,E=null,T=!1,C=null,D=null,B=null,O=null,L=null,H=t.getParameter(35661),q=!1,W=0,I=t.getParameter(7938);I.indexOf("WebGL")!==-1?(W=parseFloat(/^WebGL (\d)/.exec(I)[1]),q=W>=1):I.indexOf("OpenGL ES")!==-1&&(W=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),q=W>=2);let z=null,U={},X=t.getParameter(3088),Q=t.getParameter(2978),re=new si().fromArray(X),ie=new si().fromArray(Q);function ce(J,he,Me){let Ue=new Uint8Array(4),at=t.createTexture();t.bindTexture(J,at),t.texParameteri(J,10241,9728),t.texParameteri(J,10240,9728);for(let Mt=0;Mt<Me;Mt++)t.texImage2D(he+Mt,0,6408,1,1,0,6408,5121,Ue);return at}let Z={};Z[3553]=ce(3553,3553,1),Z[34067]=ce(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),Ae(2929),l.setFunc(Ck),Ge(!1),Ke(Q9),Ae(2884),Ie(Nn);function Ae(J){d[J]!==!0&&(t.enable(J),d[J]=!0)}function Se(J){d[J]!==!1&&(t.disable(J),d[J]=!1)}function _e(J,he){return f[J]!==he?(t.bindFramebuffer(J,he),f[J]=he,r&&(J===36009&&(f[36160]=he),J===36160&&(f[36009]=he)),!0):!1}function ve(J,he){let Me=m,Ue=!1;if(J)if(Me=p.get(he),Me===void 0&&(Me=[],p.set(he,Me)),J.isWebGLMultipleRenderTargets){let at=J.texture;if(Me.length!==at.length||Me[0]!==36064){for(let Mt=0,Qt=at.length;Mt<Qt;Mt++)Me[Mt]=36064+Mt;Me.length=at.length,Ue=!0}}else Me[0]!==36064&&(Me[0]=36064,Ue=!0);else Me[0]!==1029&&(Me[0]=1029,Ue=!0);Ue&&(i.isWebGL2?t.drawBuffers(Me):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Me))}function Ee(J){return g!==J?(t.useProgram(J),g=J,!0):!1}let fe={[Rv]:32774,[d2e]:32778,[f2e]:32779};if(r)fe[e7]=32775,fe[t7]=32776;else{let J=e.get("EXT_blend_minmax");J!==null&&(fe[e7]=J.MIN_EXT,fe[t7]=J.MAX_EXT)}let pe={[p2e]:0,[m2e]:1,[g2e]:768,[ase]:770,[S2e]:776,[b2e]:774,[y2e]:772,[v2e]:769,[ose]:771,[w2e]:775,[x2e]:773};function Ie(J,he,Me,Ue,at,Mt,Qt,ci){if(J===Nn){v===!0&&(Se(3042),v=!1);return}if(v===!1&&(Ae(3042),v=!0),J!==u2e){if(J!==y||ci!==T){if((x!==Rv||_!==Rv)&&(t.blendEquation(32774),x=Rv,_=Rv),ci)switch(J){case mg:t.blendFuncSeparate(1,771,1,771);break;case $9:t.blendFunc(1,1);break;case J9:t.blendFuncSeparate(0,769,0,1);break;case Z9:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}else switch(J){case mg:t.blendFuncSeparate(770,771,1,771);break;case $9:t.blendFunc(770,1);break;case J9:t.blendFuncSeparate(0,769,0,1);break;case Z9:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}S=null,A=null,M=null,E=null,y=J,T=ci}return}at=at||he,Mt=Mt||Me,Qt=Qt||Ue,(he!==x||at!==_)&&(t.blendEquationSeparate(fe[he],fe[at]),x=he,_=at),(Me!==S||Ue!==A||Mt!==M||Qt!==E)&&(t.blendFuncSeparate(pe[Me],pe[Ue],pe[Mt],pe[Qt]),S=Me,A=Ue,M=Mt,E=Qt),y=J,T=!1}function Le(J,he){J.side===pa?Se(2884):Ae(2884);let Me=J.side===Ts;he&&(Me=!Me),Ge(Me),J.blending===mg&&J.transparent===!1?Ie(Nn):Ie(J.blending,J.blendEquation,J.blendSrc,J.blendDst,J.blendEquationAlpha,J.blendSrcAlpha,J.blendDstAlpha,J.premultipliedAlpha),l.setFunc(J.depthFunc),l.setTest(J.depthTest),l.setMask(J.depthWrite),o.setMask(J.colorWrite);let Ue=J.stencilWrite;c.setTest(Ue),Ue&&(c.setMask(J.stencilWriteMask),c.setFunc(J.stencilFunc,J.stencilRef,J.stencilFuncMask),c.setOp(J.stencilFail,J.stencilZFail,J.stencilZPass)),ke(J.polygonOffset,J.polygonOffsetFactor,J.polygonOffsetUnits),J.alphaToCoverage===!0?Ae(32926):Se(32926)}function Ge(J){C!==J&&(J?t.frontFace(2304):t.frontFace(2305),C=J)}function Ke(J){J!==l2e?(Ae(2884),J!==D&&(J===Q9?t.cullFace(1029):J===c2e?t.cullFace(1028):t.cullFace(1032))):Se(2884),D=J}function Ve(J){J!==B&&(q&&t.lineWidth(J),B=J)}function ke(J,he,Me){J?(Ae(32823),(O!==he||L!==Me)&&(t.polygonOffset(he,Me),O=he,L=Me)):Se(32823)}function ut(J){J?Ae(3089):Se(3089)}function dt(J){J===void 0&&(J=33984+H-1),z!==J&&(t.activeTexture(J),z=J)}function V(J,he,Me){Me===void 0&&(z===null?Me=33984+H-1:Me=z);let Ue=U[Me];Ue===void 0&&(Ue={type:void 0,texture:void 0},U[Me]=Ue),(Ue.type!==J||Ue.texture!==he)&&(z!==Me&&(t.activeTexture(Me),z=Me),t.bindTexture(J,he||Z[J]),Ue.type=J,Ue.texture=he)}function F(){let J=U[z];J!==void 0&&J.type!==void 0&&(t.bindTexture(J.type,null),J.type=void 0,J.texture=void 0)}function oe(){try{t.compressedTexImage2D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ce(){try{t.compressedTexImage3D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function K(){try{t.texSubImage2D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Re(){try{t.texSubImage3D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ze(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ne(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function me(){try{t.texStorage2D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function $e(){try{t.texStorage3D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Qe(){try{t.texImage2D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Je(){try{t.texImage3D.apply(t,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function ot(J){re.equals(J)===!1&&(t.scissor(J.x,J.y,J.z,J.w),re.copy(J))}function nt(J){ie.equals(J)===!1&&(t.viewport(J.x,J.y,J.z,J.w),ie.copy(J))}function de(J,he){let Me=u.get(he);Me===void 0&&(Me=new WeakMap,u.set(he,Me));let Ue=Me.get(J);Ue===void 0&&(Ue=t.getUniformBlockIndex(he,J.name),Me.set(J,Ue))}function Xe(J,he){let Me=u.get(he).get(J);h.get(he)!==Me&&(t.uniformBlockBinding(he,Me,J.__bindingPointIndex),h.set(he,Me))}function mt(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),r===!0&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),d={},z=null,U={},f={},p=new WeakMap,m=[],g=null,v=!1,y=null,x=null,S=null,A=null,_=null,M=null,E=null,T=!1,C=null,D=null,B=null,O=null,L=null,re.set(0,0,t.canvas.width,t.canvas.height),ie.set(0,0,t.canvas.width,t.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:Ae,disable:Se,bindFramebuffer:_e,drawBuffers:ve,useProgram:Ee,setBlending:Ie,setMaterial:Le,setFlipSided:Ge,setCullFace:Ke,setLineWidth:Ve,setPolygonOffset:ke,setScissorTest:ut,activeTexture:dt,bindTexture:V,unbindTexture:F,compressedTexImage2D:oe,compressedTexImage3D:Ce,texImage2D:Qe,texImage3D:Je,updateUBOMapping:de,uniformBlockBinding:Xe,texStorage2D:me,texStorage3D:$e,texSubImage2D:K,texSubImage3D:Re,compressedTexSubImage2D:Ze,compressedTexSubImage3D:Ne,scissor:ot,viewport:nt,reset:mt}}function r3e(t,e,i,r,n,s,a){let o=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,h=n.maxTextureSize,u=n.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap,m,g=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(V,F){return v?new OffscreenCanvas(V,F):dS("canvas")}function x(V,F,oe,Ce){let K=1;if((V.width>Ce||V.height>Ce)&&(K=Ce/Math.max(V.width,V.height)),K<1||F===!0)if(typeof HTMLImageElement<"u"&&V instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&V instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&V instanceof ImageBitmap){let Re=F?E2:Math.floor,Ze=Re(K*V.width),Ne=Re(K*V.height);m===void 0&&(m=y(Ze,Ne));let me=oe?y(Ze,Ne):m;return me.width=Ze,me.height=Ne,me.getContext("2d").drawImage(V,0,0,Ze,Ne),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+V.width+"x"+V.height+") to ("+Ze+"x"+Ne+")."),me}else return"data"in V&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+V.width+"x"+V.height+")."),V;return V}function S(V){return Bk(V.width)&&Bk(V.height)}function A(V){return o?!1:V.wrapS!==Cr||V.wrapT!==Cr||V.minFilter!==bi&&V.minFilter!==mi}function _(V,F){return V.generateMipmaps&&F&&V.minFilter!==bi&&V.minFilter!==mi}function M(V){t.generateMipmap(V)}function E(V,F,oe,Ce,K=!1){if(o===!1)return F;if(V!==null){if(t[V]!==void 0)return t[V];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+V+"'")}let Re=F;return F===6403&&(oe===5126&&(Re=33326),oe===5131&&(Re=33325),oe===5121&&(Re=33321)),F===33319&&(oe===5126&&(Re=33328),oe===5131&&(Re=33327),oe===5121&&(Re=33323)),F===6408&&(oe===5126&&(Re=34836),oe===5131&&(Re=34842),oe===5121&&(Re=Ce===fi&&K===!1?35907:32856),oe===32819&&(Re=32854),oe===32820&&(Re=32855)),(Re===33325||Re===33326||Re===33327||Re===33328||Re===34842||Re===34836)&&e.get("EXT_color_buffer_float"),Re}function T(V,F,oe){return _(V,oe)===!0||V.isFramebufferTexture&&V.minFilter!==bi&&V.minFilter!==mi?Math.log2(Math.max(F.width,F.height))+1:V.mipmaps!==void 0&&V.mipmaps.length>0?V.mipmaps.length:V.isCompressedTexture&&Array.isArray(V.image)?F.mipmaps.length:1}function C(V){return V===bi||V===i7||V===t3?9728:9729}function D(V){let F=V.target;F.removeEventListener("dispose",D),O(F),F.isVideoTexture&&p.delete(F)}function B(V){let F=V.target;F.removeEventListener("dispose",B),H(F)}function O(V){let F=r.get(V);if(F.__webglInit===void 0)return;let oe=V.source,Ce=g.get(oe);if(Ce){let K=Ce[F.__cacheKey];K.usedTimes--,K.usedTimes===0&&L(V),Object.keys(Ce).length===0&&g.delete(oe)}r.remove(V)}function L(V){let F=r.get(V);t.deleteTexture(F.__webglTexture);let oe=V.source,Ce=g.get(oe);delete Ce[F.__cacheKey],a.memory.textures--}function H(V){let F=V.texture,oe=r.get(V),Ce=r.get(F);if(Ce.__webglTexture!==void 0&&(t.deleteTexture(Ce.__webglTexture),a.memory.textures--),V.depthTexture&&V.depthTexture.dispose(),V.isWebGLCubeRenderTarget)for(let K=0;K<6;K++)t.deleteFramebuffer(oe.__webglFramebuffer[K]),oe.__webglDepthbuffer&&t.deleteRenderbuffer(oe.__webglDepthbuffer[K]);else{if(t.deleteFramebuffer(oe.__webglFramebuffer),oe.__webglDepthbuffer&&t.deleteRenderbuffer(oe.__webglDepthbuffer),oe.__webglMultisampledFramebuffer&&t.deleteFramebuffer(oe.__webglMultisampledFramebuffer),oe.__webglColorRenderbuffer)for(let K=0;K<oe.__webglColorRenderbuffer.length;K++)oe.__webglColorRenderbuffer[K]&&t.deleteRenderbuffer(oe.__webglColorRenderbuffer[K]);oe.__webglDepthRenderbuffer&&t.deleteRenderbuffer(oe.__webglDepthRenderbuffer)}if(V.isWebGLMultipleRenderTargets)for(let K=0,Re=F.length;K<Re;K++){let Ze=r.get(F[K]);Ze.__webglTexture&&(t.deleteTexture(Ze.__webglTexture),a.memory.textures--),r.remove(F[K])}r.remove(F),r.remove(V)}let q=0;function W(){q=0}function I(){let V=q;return V>=l&&console.warn("THREE.WebGLTextures: Trying to use "+V+" texture units while this GPU supports only "+l),q+=1,V}function z(V){let F=[];return F.push(V.wrapS),F.push(V.wrapT),F.push(V.wrapR||0),F.push(V.magFilter),F.push(V.minFilter),F.push(V.anisotropy),F.push(V.internalFormat),F.push(V.format),F.push(V.type),F.push(V.generateMipmaps),F.push(V.premultiplyAlpha),F.push(V.flipY),F.push(V.unpackAlignment),F.push(V.encoding),F.join()}function U(V,F){let oe=r.get(V);if(V.isVideoTexture&&ut(V),V.isRenderTargetTexture===!1&&V.version>0&&oe.__version!==V.version){let Ce=V.image;if(Ce===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ce.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Se(oe,V,F);return}}i.bindTexture(3553,oe.__webglTexture,33984+F)}function X(V,F){let oe=r.get(V);if(V.version>0&&oe.__version!==V.version){Se(oe,V,F);return}i.bindTexture(35866,oe.__webglTexture,33984+F)}function Q(V,F){let oe=r.get(V);if(V.version>0&&oe.__version!==V.version){Se(oe,V,F);return}i.bindTexture(32879,oe.__webglTexture,33984+F)}function re(V,F){let oe=r.get(V);if(V.version>0&&oe.__version!==V.version){_e(oe,V,F);return}i.bindTexture(34067,oe.__webglTexture,33984+F)}let ie={[qu]:10497,[Cr]:33071,[Rk]:33648},ce={[bi]:9728,[i7]:9984,[t3]:9986,[mi]:9729,[k2e]:9985,[s1]:9987};function Z(V,F,oe){if(oe?(t.texParameteri(V,10242,ie[F.wrapS]),t.texParameteri(V,10243,ie[F.wrapT]),(V===32879||V===35866)&&t.texParameteri(V,32882,ie[F.wrapR]),t.texParameteri(V,10240,ce[F.magFilter]),t.texParameteri(V,10241,ce[F.minFilter])):(t.texParameteri(V,10242,33071),t.texParameteri(V,10243,33071),(V===32879||V===35866)&&t.texParameteri(V,32882,33071),(F.wrapS!==Cr||F.wrapT!==Cr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(V,10240,C(F.magFilter)),t.texParameteri(V,10241,C(F.minFilter)),F.minFilter!==bi&&F.minFilter!==mi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){let Ce=e.get("EXT_texture_filter_anisotropic");if(F.magFilter===bi||F.minFilter!==t3&&F.minFilter!==s1||F.type===tr&&e.has("OES_texture_float_linear")===!1||o===!1&&F.type===fd&&e.has("OES_texture_half_float_linear")===!1)return;(F.anisotropy>1||r.get(F).__currentAnisotropy)&&(t.texParameterf(V,Ce.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(F.anisotropy,n.getMaxAnisotropy())),r.get(F).__currentAnisotropy=F.anisotropy)}}function Ae(V,F){let oe=!1;V.__webglInit===void 0&&(V.__webglInit=!0,F.addEventListener("dispose",D));let Ce=F.source,K=g.get(Ce);K===void 0&&(K={},g.set(Ce,K));let Re=z(F);if(Re!==V.__cacheKey){K[Re]===void 0&&(K[Re]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,oe=!0),K[Re].usedTimes++;let Ze=K[V.__cacheKey];Ze!==void 0&&(K[V.__cacheKey].usedTimes--,Ze.usedTimes===0&&L(F)),V.__cacheKey=Re,V.__webglTexture=K[Re].texture}return oe}function Se(V,F,oe){let Ce=3553;(F.isDataArrayTexture||F.isCompressedArrayTexture)&&(Ce=35866),F.isData3DTexture&&(Ce=32879);let K=Ae(V,F),Re=F.source;i.bindTexture(Ce,V.__webglTexture,33984+oe);let Ze=r.get(Re);if(Re.version!==Ze.__version||K===!0){i.activeTexture(33984+oe),t.pixelStorei(37440,F.flipY),t.pixelStorei(37441,F.premultiplyAlpha),t.pixelStorei(3317,F.unpackAlignment),t.pixelStorei(37443,0);let Ne=A(F)&&S(F.image)===!1,me=x(F.image,Ne,!1,h);me=dt(F,me);let $e=S(me)||o,Qe=s.convert(F.format,F.encoding),Je=s.convert(F.type),ot=E(F.internalFormat,Qe,Je,F.encoding,F.isVideoTexture);Z(Ce,F,$e);let nt,de=F.mipmaps,Xe=o&&F.isVideoTexture!==!0,mt=Ze.__version===void 0||K===!0,J=T(F,me,$e);if(F.isDepthTexture)ot=6402,o?F.type===tr?ot=36012:F.type===Ku?ot=33190:F.type===gg?ot=35056:ot=33189:F.type===tr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),F.format===vg&&ot===6402&&F.type!==hse&&F.type!==Ku&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),F.type=Ku,Je=s.convert(F.type)),F.format===Vg&&ot===6402&&(ot=34041,F.type!==gg&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),F.type=gg,Je=s.convert(F.type))),mt&&(Xe?i.texStorage2D(3553,1,ot,me.width,me.height):i.texImage2D(3553,0,ot,me.width,me.height,0,Qe,Je,null));else if(F.isDataTexture)if(de.length>0&&$e){Xe&&mt&&i.texStorage2D(3553,J,ot,de[0].width,de[0].height);for(let he=0,Me=de.length;he<Me;he++)nt=de[he],Xe?i.texSubImage2D(3553,he,0,0,nt.width,nt.height,Qe,Je,nt.data):i.texImage2D(3553,he,ot,nt.width,nt.height,0,Qe,Je,nt.data);F.generateMipmaps=!1}else Xe?(mt&&i.texStorage2D(3553,J,ot,me.width,me.height),i.texSubImage2D(3553,0,0,0,me.width,me.height,Qe,Je,me.data)):i.texImage2D(3553,0,ot,me.width,me.height,0,Qe,Je,me.data);else if(F.isCompressedTexture)if(F.isCompressedArrayTexture){Xe&&mt&&i.texStorage3D(35866,J,ot,de[0].width,de[0].height,me.depth);for(let he=0,Me=de.length;he<Me;he++)nt=de[he],F.format!==Fr?Qe!==null?Xe?i.compressedTexSubImage3D(35866,he,0,0,0,nt.width,nt.height,me.depth,Qe,nt.data,0,0):i.compressedTexImage3D(35866,he,ot,nt.width,nt.height,me.depth,0,nt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Xe?i.texSubImage3D(35866,he,0,0,0,nt.width,nt.height,me.depth,Qe,Je,nt.data):i.texImage3D(35866,he,ot,nt.width,nt.height,me.depth,0,Qe,Je,nt.data)}else{Xe&&mt&&i.texStorage2D(3553,J,ot,de[0].width,de[0].height);for(let he=0,Me=de.length;he<Me;he++)nt=de[he],F.format!==Fr?Qe!==null?Xe?i.compressedTexSubImage2D(3553,he,0,0,nt.width,nt.height,Qe,nt.data):i.compressedTexImage2D(3553,he,ot,nt.width,nt.height,0,nt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Xe?i.texSubImage2D(3553,he,0,0,nt.width,nt.height,Qe,Je,nt.data):i.texImage2D(3553,he,ot,nt.width,nt.height,0,Qe,Je,nt.data)}else if(F.isDataArrayTexture)Xe?(mt&&i.texStorage3D(35866,J,ot,me.width,me.height,me.depth),i.texSubImage3D(35866,0,0,0,0,me.width,me.height,me.depth,Qe,Je,me.data)):i.texImage3D(35866,0,ot,me.width,me.height,me.depth,0,Qe,Je,me.data);else if(F.isData3DTexture)Xe?(mt&&i.texStorage3D(32879,J,ot,me.width,me.height,me.depth),i.texSubImage3D(32879,0,0,0,0,me.width,me.height,me.depth,Qe,Je,me.data)):i.texImage3D(32879,0,ot,me.width,me.height,me.depth,0,Qe,Je,me.data);else if(F.isFramebufferTexture){if(mt)if(Xe)i.texStorage2D(3553,J,ot,me.width,me.height);else{let he=me.width,Me=me.height;for(let Ue=0;Ue<J;Ue++)i.texImage2D(3553,Ue,ot,he,Me,0,Qe,Je,null),he>>=1,Me>>=1}}else if(de.length>0&&$e){Xe&&mt&&i.texStorage2D(3553,J,ot,de[0].width,de[0].height);for(let he=0,Me=de.length;he<Me;he++)nt=de[he],Xe?i.texSubImage2D(3553,he,0,0,Qe,Je,nt):i.texImage2D(3553,he,ot,Qe,Je,nt);F.generateMipmaps=!1}else Xe?(mt&&i.texStorage2D(3553,J,ot,me.width,me.height),i.texSubImage2D(3553,0,0,0,Qe,Je,me)):i.texImage2D(3553,0,ot,Qe,Je,me);_(F,$e)&&M(Ce),Ze.__version=Re.version,F.onUpdate&&F.onUpdate(F)}V.__version=F.version}function _e(V,F,oe){if(F.image.length!==6)return;let Ce=Ae(V,F),K=F.source;i.bindTexture(34067,V.__webglTexture,33984+oe);let Re=r.get(K);if(K.version!==Re.__version||Ce===!0){i.activeTexture(33984+oe),t.pixelStorei(37440,F.flipY),t.pixelStorei(37441,F.premultiplyAlpha),t.pixelStorei(3317,F.unpackAlignment),t.pixelStorei(37443,0);let Ze=F.isCompressedTexture||F.image[0].isCompressedTexture,Ne=F.image[0]&&F.image[0].isDataTexture,me=[];for(let he=0;he<6;he++)!Ze&&!Ne?me[he]=x(F.image[he],!1,!0,c):me[he]=Ne?F.image[he].image:F.image[he],me[he]=dt(F,me[he]);let $e=me[0],Qe=S($e)||o,Je=s.convert(F.format,F.encoding),ot=s.convert(F.type),nt=E(F.internalFormat,Je,ot,F.encoding),de=o&&F.isVideoTexture!==!0,Xe=Re.__version===void 0||Ce===!0,mt=T(F,$e,Qe);Z(34067,F,Qe);let J;if(Ze){de&&Xe&&i.texStorage2D(34067,mt,nt,$e.width,$e.height);for(let he=0;he<6;he++){J=me[he].mipmaps;for(let Me=0;Me<J.length;Me++){let Ue=J[Me];F.format!==Fr?Je!==null?de?i.compressedTexSubImage2D(34069+he,Me,0,0,Ue.width,Ue.height,Je,Ue.data):i.compressedTexImage2D(34069+he,Me,nt,Ue.width,Ue.height,0,Ue.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):de?i.texSubImage2D(34069+he,Me,0,0,Ue.width,Ue.height,Je,ot,Ue.data):i.texImage2D(34069+he,Me,nt,Ue.width,Ue.height,0,Je,ot,Ue.data)}}}else{J=F.mipmaps,de&&Xe&&(J.length>0&&mt++,i.texStorage2D(34067,mt,nt,me[0].width,me[0].height));for(let he=0;he<6;he++)if(Ne){de?i.texSubImage2D(34069+he,0,0,0,me[he].width,me[he].height,Je,ot,me[he].data):i.texImage2D(34069+he,0,nt,me[he].width,me[he].height,0,Je,ot,me[he].data);for(let Me=0;Me<J.length;Me++){let Ue=J[Me].image[he].image;de?i.texSubImage2D(34069+he,Me+1,0,0,Ue.width,Ue.height,Je,ot,Ue.data):i.texImage2D(34069+he,Me+1,nt,Ue.width,Ue.height,0,Je,ot,Ue.data)}}else{de?i.texSubImage2D(34069+he,0,0,0,Je,ot,me[he]):i.texImage2D(34069+he,0,nt,Je,ot,me[he]);for(let Me=0;Me<J.length;Me++){let Ue=J[Me];de?i.texSubImage2D(34069+he,Me+1,0,0,Je,ot,Ue.image[he]):i.texImage2D(34069+he,Me+1,nt,Je,ot,Ue.image[he])}}}_(F,Qe)&&M(34067),Re.__version=K.version,F.onUpdate&&F.onUpdate(F)}V.__version=F.version}function ve(V,F,oe,Ce,K){let Re=s.convert(oe.format,oe.encoding),Ze=s.convert(oe.type),Ne=E(oe.internalFormat,Re,Ze,oe.encoding);r.get(F).__hasExternalTextures||(K===32879||K===35866?i.texImage3D(K,0,Ne,F.width,F.height,F.depth,0,Re,Ze,null):i.texImage2D(K,0,Ne,F.width,F.height,0,Re,Ze,null)),i.bindFramebuffer(36160,V),ke(F)?d.framebufferTexture2DMultisampleEXT(36160,Ce,K,r.get(oe).__webglTexture,0,Ve(F)):(K===3553||K>=34069&&K<=34074)&&t.framebufferTexture2D(36160,Ce,K,r.get(oe).__webglTexture,0),i.bindFramebuffer(36160,null)}function Ee(V,F,oe){if(t.bindRenderbuffer(36161,V),F.depthBuffer&&!F.stencilBuffer){let Ce=33189;if(oe||ke(F)){let K=F.depthTexture;K&&K.isDepthTexture&&(K.type===tr?Ce=36012:K.type===Ku&&(Ce=33190));let Re=Ve(F);ke(F)?d.renderbufferStorageMultisampleEXT(36161,Re,Ce,F.width,F.height):t.renderbufferStorageMultisample(36161,Re,Ce,F.width,F.height)}else t.renderbufferStorage(36161,Ce,F.width,F.height);t.framebufferRenderbuffer(36160,36096,36161,V)}else if(F.depthBuffer&&F.stencilBuffer){let Ce=Ve(F);oe&&ke(F)===!1?t.renderbufferStorageMultisample(36161,Ce,35056,F.width,F.height):ke(F)?d.renderbufferStorageMultisampleEXT(36161,Ce,35056,F.width,F.height):t.renderbufferStorage(36161,34041,F.width,F.height),t.framebufferRenderbuffer(36160,33306,36161,V)}else{let Ce=F.isWebGLMultipleRenderTargets===!0?F.texture:[F.texture];for(let K=0;K<Ce.length;K++){let Re=Ce[K],Ze=s.convert(Re.format,Re.encoding),Ne=s.convert(Re.type),me=E(Re.internalFormat,Ze,Ne,Re.encoding),$e=Ve(F);oe&&ke(F)===!1?t.renderbufferStorageMultisample(36161,$e,me,F.width,F.height):ke(F)?d.renderbufferStorageMultisampleEXT(36161,$e,me,F.width,F.height):t.renderbufferStorage(36161,me,F.width,F.height)}}t.bindRenderbuffer(36161,null)}function fe(V,F){if(F&&F.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,V),!(F.depthTexture&&F.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(F.depthTexture).__webglTexture||F.depthTexture.image.width!==F.width||F.depthTexture.image.height!==F.height)&&(F.depthTexture.image.width=F.width,F.depthTexture.image.height=F.height,F.depthTexture.needsUpdate=!0),U(F.depthTexture,0);let oe=r.get(F.depthTexture).__webglTexture,Ce=Ve(F);if(F.depthTexture.format===vg)ke(F)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,oe,0,Ce):t.framebufferTexture2D(36160,36096,3553,oe,0);else if(F.depthTexture.format===Vg)ke(F)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,oe,0,Ce):t.framebufferTexture2D(36160,33306,3553,oe,0);else throw new Error("Unknown depthTexture format")}function pe(V){let F=r.get(V),oe=V.isWebGLCubeRenderTarget===!0;if(V.depthTexture&&!F.__autoAllocateDepthBuffer){if(oe)throw new Error("target.depthTexture not supported in Cube render targets");fe(F.__webglFramebuffer,V)}else if(oe){F.__webglDepthbuffer=[];for(let Ce=0;Ce<6;Ce++)i.bindFramebuffer(36160,F.__webglFramebuffer[Ce]),F.__webglDepthbuffer[Ce]=t.createRenderbuffer(),Ee(F.__webglDepthbuffer[Ce],V,!1)}else i.bindFramebuffer(36160,F.__webglFramebuffer),F.__webglDepthbuffer=t.createRenderbuffer(),Ee(F.__webglDepthbuffer,V,!1);i.bindFramebuffer(36160,null)}function Ie(V,F,oe){let Ce=r.get(V);F!==void 0&&ve(Ce.__webglFramebuffer,V,V.texture,36064,3553),oe!==void 0&&pe(V)}function Le(V){let F=V.texture,oe=r.get(V),Ce=r.get(F);V.addEventListener("dispose",B),V.isWebGLMultipleRenderTargets!==!0&&(Ce.__webglTexture===void 0&&(Ce.__webglTexture=t.createTexture()),Ce.__version=F.version,a.memory.textures++);let K=V.isWebGLCubeRenderTarget===!0,Re=V.isWebGLMultipleRenderTargets===!0,Ze=S(V)||o;if(K){oe.__webglFramebuffer=[];for(let Ne=0;Ne<6;Ne++)oe.__webglFramebuffer[Ne]=t.createFramebuffer()}else{if(oe.__webglFramebuffer=t.createFramebuffer(),Re)if(n.drawBuffers){let Ne=V.texture;for(let me=0,$e=Ne.length;me<$e;me++){let Qe=r.get(Ne[me]);Qe.__webglTexture===void 0&&(Qe.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&V.samples>0&&ke(V)===!1){let Ne=Re?F:[F];oe.__webglMultisampledFramebuffer=t.createFramebuffer(),oe.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,oe.__webglMultisampledFramebuffer);for(let me=0;me<Ne.length;me++){let $e=Ne[me];oe.__webglColorRenderbuffer[me]=t.createRenderbuffer(),t.bindRenderbuffer(36161,oe.__webglColorRenderbuffer[me]);let Qe=s.convert($e.format,$e.encoding),Je=s.convert($e.type),ot=E($e.internalFormat,Qe,Je,$e.encoding,V.isXRRenderTarget===!0),nt=Ve(V);t.renderbufferStorageMultisample(36161,nt,ot,V.width,V.height),t.framebufferRenderbuffer(36160,36064+me,36161,oe.__webglColorRenderbuffer[me])}t.bindRenderbuffer(36161,null),V.depthBuffer&&(oe.__webglDepthRenderbuffer=t.createRenderbuffer(),Ee(oe.__webglDepthRenderbuffer,V,!0)),i.bindFramebuffer(36160,null)}}if(K){i.bindTexture(34067,Ce.__webglTexture),Z(34067,F,Ze);for(let Ne=0;Ne<6;Ne++)ve(oe.__webglFramebuffer[Ne],V,F,36064,34069+Ne);_(F,Ze)&&M(34067),i.unbindTexture()}else if(Re){let Ne=V.texture;for(let me=0,$e=Ne.length;me<$e;me++){let Qe=Ne[me],Je=r.get(Qe);i.bindTexture(3553,Je.__webglTexture),Z(3553,Qe,Ze),ve(oe.__webglFramebuffer,V,Qe,36064+me,3553),_(Qe,Ze)&&M(3553)}i.unbindTexture()}else{let Ne=3553;(V.isWebGL3DRenderTarget||V.isWebGLArrayRenderTarget)&&(o?Ne=V.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Ne,Ce.__webglTexture),Z(Ne,F,Ze),ve(oe.__webglFramebuffer,V,F,36064,Ne),_(F,Ze)&&M(Ne),i.unbindTexture()}V.depthBuffer&&pe(V)}function Ge(V){let F=S(V)||o,oe=V.isWebGLMultipleRenderTargets===!0?V.texture:[V.texture];for(let Ce=0,K=oe.length;Ce<K;Ce++){let Re=oe[Ce];if(_(Re,F)){let Ze=V.isWebGLCubeRenderTarget?34067:3553,Ne=r.get(Re).__webglTexture;i.bindTexture(Ze,Ne),M(Ze),i.unbindTexture()}}}function Ke(V){if(o&&V.samples>0&&ke(V)===!1){let F=V.isWebGLMultipleRenderTargets?V.texture:[V.texture],oe=V.width,Ce=V.height,K=16384,Re=[],Ze=V.stencilBuffer?33306:36096,Ne=r.get(V),me=V.isWebGLMultipleRenderTargets===!0;if(me)for(let $e=0;$e<F.length;$e++)i.bindFramebuffer(36160,Ne.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+$e,36161,null),i.bindFramebuffer(36160,Ne.__webglFramebuffer),t.framebufferTexture2D(36009,36064+$e,3553,null,0);i.bindFramebuffer(36008,Ne.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Ne.__webglFramebuffer);for(let $e=0;$e<F.length;$e++){Re.push(36064+$e),V.depthBuffer&&Re.push(Ze);let Qe=Ne.__ignoreDepthValues!==void 0?Ne.__ignoreDepthValues:!1;if(Qe===!1&&(V.depthBuffer&&(K|=256),V.stencilBuffer&&(K|=1024)),me&&t.framebufferRenderbuffer(36008,36064,36161,Ne.__webglColorRenderbuffer[$e]),Qe===!0&&(t.invalidateFramebuffer(36008,[Ze]),t.invalidateFramebuffer(36009,[Ze])),me){let Je=r.get(F[$e]).__webglTexture;t.framebufferTexture2D(36009,36064,3553,Je,0)}t.blitFramebuffer(0,0,oe,Ce,0,0,oe,Ce,K,9728),f&&t.invalidateFramebuffer(36008,Re)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),me)for(let $e=0;$e<F.length;$e++){i.bindFramebuffer(36160,Ne.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+$e,36161,Ne.__webglColorRenderbuffer[$e]);let Qe=r.get(F[$e]).__webglTexture;i.bindFramebuffer(36160,Ne.__webglFramebuffer),t.framebufferTexture2D(36009,36064+$e,3553,Qe,0)}i.bindFramebuffer(36009,Ne.__webglMultisampledFramebuffer)}}function Ve(V){return Math.min(u,V.samples)}function ke(V){let F=r.get(V);return o&&V.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&F.__useRenderToTexture!==!1}function ut(V){let F=a.render.frame;p.get(V)!==F&&(p.set(V,F),V.update())}function dt(V,F){let oe=V.encoding,Ce=V.format,K=V.type;return V.isCompressedTexture===!0||V.isVideoTexture===!0||V.format===Ok||oe!==Oc&&(oe===fi?o===!1?e.has("EXT_sRGB")===!0&&Ce===Fr?(V.format=Ok,V.minFilter=mi,V.generateMipmaps=!1):F=yse.sRGBToLinear(F):(Ce!==Fr||K!==ba)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",oe)),F}this.allocateTextureUnit=I,this.resetTextureUnits=W,this.setTexture2D=U,this.setTexture2DArray=X,this.setTexture3D=Q,this.setTextureCube=re,this.rebindTextures=Ie,this.setupRenderTarget=Le,this.updateRenderTargetMipmap=Ge,this.updateMultisampleRenderTarget=Ke,this.setupDepthRenderbuffer=pe,this.setupFrameBufferTexture=ve,this.useMultisampledRTT=ke}function n3e(t,e,i){let r=i.isWebGL2;function n(s,a=null){let o;if(s===ba)return 5121;if(s===G2e)return 32819;if(s===V2e)return 32820;if(s===N2e)return 5120;if(s===U2e)return 5122;if(s===hse)return 5123;if(s===z2e)return 5124;if(s===Ku)return 5125;if(s===tr)return 5126;if(s===fd)return r?5131:(o=e.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===H2e)return 6406;if(s===Fr)return 6408;if(s===j2e)return 6409;if(s===W2e)return 6410;if(s===vg)return 6402;if(s===Vg)return 34041;if(s===Ok)return o=e.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===lC)return 6403;if(s===X2e)return 36244;if(s===b2)return 33319;if(s===Y2e)return 33320;if(s===use)return 36249;if(s===i3||s===r3||s===n3||s===s3)if(a===fi)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===i3)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===r3)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===n3)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===s3)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===i3)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===r3)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===n3)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===s3)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===r7||s===n7||s===s7||s===a7)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===r7)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===n7)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===s7)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===a7)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===q2e)return o=e.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===o7||s===l7)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(s===o7)return a===fi?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===l7)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===c7||s===h7||s===u7||s===d7||s===f7||s===p7||s===m7||s===g7||s===v7||s===y7||s===x7||s===b7||s===w7||s===S7)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(s===c7)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===h7)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===u7)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===d7)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===f7)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===p7)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===m7)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===g7)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===v7)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===y7)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===x7)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===b7)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===w7)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===S7)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===a3)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(s===a3)return a===fi?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===K2e||s===_7||s===A7||s===E7)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(s===a3)return o.COMPRESSED_RED_RGTC1_EXT;if(s===_7)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===A7)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===E7)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===gg?r?34042:(o=e.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):t[s]!==void 0?t[s]:null}return{convert:n}}var s3e=class extends ua{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}},$u=class extends Ji{constructor(){super(),this.isGroup=!0,this.type="Group"}},a3e={type:"move"},I3=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new $u,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new $u,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new N,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new N),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new $u,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new N,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new N),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){let e=this._hand;if(e)for(let i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,i){let r=null,n=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(l&&t.hand){s=!0;for(let p of t.hand.values()){let m=e.getJointPose(p,i),g=this._getHandJoint(l,p);m!==null&&(g.matrix.fromArray(m.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.jointRadius=m.radius),g.visible=m!==null}let c=l.joints["index-finger-tip"],h=l.joints["thumb-tip"],u=c.position.distanceTo(h.position),d=.02,f=.005;l.inputState.pinching&&u>d+f?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&u<=d-f&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else o!==null&&t.gripSpace&&(n=e.getPose(t.gripSpace,i),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1));a!==null&&(r=e.getPose(t.targetRaySpace,i),r===null&&n!==null&&(r=n),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(a3e)))}return a!==null&&(a.visible=r!==null),o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){let i=new $u;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}},o1=class extends Kr{constructor(t,e,i,r,n,s,a,o,l,c){if(c=c!==void 0?c:vg,c!==vg&&c!==Vg)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===vg&&(i=Ku),i===void 0&&c===Vg&&(i=gg),super(null,r,n,s,a,o,c,i,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:bi,this.minFilter=o!==void 0?o:bi,this.flipY=!1,this.generateMipmaps=!1}},o3e=class extends Js{constructor(t,e){super();let i=this,r=null,n=1,s=null,a="local-floor",o=1,l=null,c=null,h=null,u=null,d=null,f=null,p=e.getContextAttributes(),m=null,g=null,v=[],y=[],x=new Set,S=new Map,A=new ua;A.layers.enable(1),A.viewport=new si;let _=new ua;_.layers.enable(2),_.viewport=new si;let M=[A,_],E=new s3e;E.layers.enable(1),E.layers.enable(2);let T=null,C=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(X){let Q=v[X];return Q===void 0&&(Q=new I3,v[X]=Q),Q.getTargetRaySpace()},this.getControllerGrip=function(X){let Q=v[X];return Q===void 0&&(Q=new I3,v[X]=Q),Q.getGripSpace()},this.getHand=function(X){let Q=v[X];return Q===void 0&&(Q=new I3,v[X]=Q),Q.getHandSpace()};function D(X){let Q=y.indexOf(X.inputSource);if(Q===-1)return;let re=v[Q];re!==void 0&&re.dispatchEvent({type:X.type,data:X.inputSource})}function B(){r.removeEventListener("select",D),r.removeEventListener("selectstart",D),r.removeEventListener("selectend",D),r.removeEventListener("squeeze",D),r.removeEventListener("squeezestart",D),r.removeEventListener("squeezeend",D),r.removeEventListener("end",B),r.removeEventListener("inputsourceschange",O);for(let X=0;X<v.length;X++){let Q=y[X];Q!==null&&(y[X]=null,v[X].disconnect(Q))}T=null,C=null,t.setRenderTarget(m),d=null,u=null,h=null,r=null,g=null,U.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(X){n=X,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(X){a=X,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(X){l=X},this.getBaseLayer=function(){return u!==null?u:d},this.getBinding=function(){return h},this.getFrame=function(){return f},this.getSession=function(){return r},this.setSession=async function(X){if(r=X,r!==null){if(m=t.getRenderTarget(),r.addEventListener("select",D),r.addEventListener("selectstart",D),r.addEventListener("selectend",D),r.addEventListener("squeeze",D),r.addEventListener("squeezestart",D),r.addEventListener("squeezeend",D),r.addEventListener("end",B),r.addEventListener("inputsourceschange",O),p.xrCompatible!==!0&&await e.makeXRCompatible(),r.renderState.layers===void 0||t.capabilities.isWebGL2===!1){let Q={antialias:r.renderState.layers===void 0?p.antialias:!0,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(r,e,Q),r.updateRenderState({baseLayer:d}),g=new Di(d.framebufferWidth,d.framebufferHeight,{format:Fr,type:ba,encoding:t.outputEncoding,stencilBuffer:p.stencil})}else{let Q=null,re=null,ie=null;p.depth&&(ie=p.stencil?35056:33190,Q=p.stencil?Vg:vg,re=p.stencil?gg:Ku);let ce={colorFormat:32856,depthFormat:ie,scaleFactor:n};h=new XRWebGLBinding(r,e),u=h.createProjectionLayer(ce),r.updateRenderState({layers:[u]}),g=new Di(u.textureWidth,u.textureHeight,{format:Fr,type:ba,depthTexture:new o1(u.textureWidth,u.textureHeight,re,void 0,void 0,void 0,void 0,void 0,void 0,Q),stencilBuffer:p.stencil,encoding:t.outputEncoding,samples:p.antialias?4:0});let Z=t.properties.get(g);Z.__ignoreDepthValues=u.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await r.requestReferenceSpace(a),U.setContext(r),U.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function O(X){for(let Q=0;Q<X.removed.length;Q++){let re=X.removed[Q],ie=y.indexOf(re);ie>=0&&(y[ie]=null,v[ie].disconnect(re))}for(let Q=0;Q<X.added.length;Q++){let re=X.added[Q],ie=y.indexOf(re);if(ie===-1){for(let Z=0;Z<v.length;Z++)if(Z>=y.length){y.push(re),ie=Z;break}else if(y[Z]===null){y[Z]=re,ie=Z;break}if(ie===-1)break}let ce=v[ie];ce&&ce.connect(re)}}let L=new N,H=new N;function q(X,Q,re){L.setFromMatrixPosition(Q.matrixWorld),H.setFromMatrixPosition(re.matrixWorld);let ie=L.distanceTo(H),ce=Q.projectionMatrix.elements,Z=re.projectionMatrix.elements,Ae=ce[14]/(ce[10]-1),Se=ce[14]/(ce[10]+1),_e=(ce[9]+1)/ce[5],ve=(ce[9]-1)/ce[5],Ee=(ce[8]-1)/ce[0],fe=(Z[8]+1)/Z[0],pe=Ae*Ee,Ie=Ae*fe,Le=ie/(-Ee+fe),Ge=Le*-Ee;Q.matrixWorld.decompose(X.position,X.quaternion,X.scale),X.translateX(Ge),X.translateZ(Le),X.matrixWorld.compose(X.position,X.quaternion,X.scale),X.matrixWorldInverse.copy(X.matrixWorld).invert();let Ke=Ae+Le,Ve=Se+Le,ke=pe-Ge,ut=Ie+(ie-Ge),dt=_e*Se/Ve*Ke,V=ve*Se/Ve*Ke;X.projectionMatrix.makePerspective(ke,ut,dt,V,Ke,Ve)}function W(X,Q){Q===null?X.matrixWorld.copy(X.matrix):X.matrixWorld.multiplyMatrices(Q.matrixWorld,X.matrix),X.matrixWorldInverse.copy(X.matrixWorld).invert()}this.updateCamera=function(X){if(r===null)return;E.near=_.near=A.near=X.near,E.far=_.far=A.far=X.far,(T!==E.near||C!==E.far)&&(r.updateRenderState({depthNear:E.near,depthFar:E.far}),T=E.near,C=E.far);let Q=X.parent,re=E.cameras;W(E,Q);for(let ce=0;ce<re.length;ce++)W(re[ce],Q);E.matrixWorld.decompose(E.position,E.quaternion,E.scale),X.matrix.copy(E.matrix),X.matrix.decompose(X.position,X.quaternion,X.scale);let ie=X.children;for(let ce=0,Z=ie.length;ce<Z;ce++)ie[ce].updateMatrixWorld(!0);re.length===2?q(E,A,_):E.projectionMatrix.copy(A.projectionMatrix)},this.getCamera=function(){return E},this.getFoveation=function(){if(!(u===null&&d===null))return o},this.setFoveation=function(X){o=X,u!==null&&(u.fixedFoveation=X),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=X)},this.getPlanes=function(){return x};let I=null;function z(X,Q){if(c=Q.getViewerPose(l||s),f=Q,c!==null){let re=c.views;d!==null&&(t.setRenderTargetFramebuffer(g,d.framebuffer),t.setRenderTarget(g));let ie=!1;re.length!==E.cameras.length&&(E.cameras.length=0,ie=!0);for(let ce=0;ce<re.length;ce++){let Z=re[ce],Ae=null;if(d!==null)Ae=d.getViewport(Z);else{let _e=h.getViewSubImage(u,Z);Ae=_e.viewport,ce===0&&(t.setRenderTargetTextures(g,_e.colorTexture,u.ignoreDepthValues?void 0:_e.depthStencilTexture),t.setRenderTarget(g))}let Se=M[ce];Se===void 0&&(Se=new ua,Se.layers.enable(ce),Se.viewport=new si,M[ce]=Se),Se.matrix.fromArray(Z.transform.matrix),Se.projectionMatrix.fromArray(Z.projectionMatrix),Se.viewport.set(Ae.x,Ae.y,Ae.width,Ae.height),ce===0&&E.matrix.copy(Se.matrix),ie===!0&&E.cameras.push(Se)}}for(let re=0;re<v.length;re++){let ie=y[re],ce=v[re];ie!==null&&ce!==void 0&&ce.update(ie,Q,l||s)}if(I&&I(X,Q),Q.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:Q.detectedPlanes});let re=null;for(let ie of x)Q.detectedPlanes.has(ie)||(re===null&&(re=[]),re.push(ie));if(re!==null)for(let ie of re)x.delete(ie),S.delete(ie),i.dispatchEvent({type:"planeremoved",data:ie});for(let ie of Q.detectedPlanes)if(!x.has(ie))x.add(ie),S.set(ie,Q.lastChangedTime),i.dispatchEvent({type:"planeadded",data:ie});else{let ce=S.get(ie);ie.lastChangedTime>ce&&(S.set(ie,ie.lastChangedTime),i.dispatchEvent({type:"planechanged",data:ie}))}}f=null}let U=new Ase;U.setAnimationLoop(z),this.setAnimationLoop=function(X){I=X},this.dispose=function(){}}};function l3e(t,e){function i(m,g){g.color.getRGB(m.fogColor.value,_se(t)),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)}function r(m,g,v,y,x){g.isMeshBasicMaterial||g.isMeshLambertMaterial?n(m,g):g.isMeshToonMaterial?(n(m,g),h(m,g)):g.isMeshPhongMaterial?(n(m,g),c(m,g)):g.isMeshStandardMaterial?(n(m,g),u(m,g),g.isMeshPhysicalMaterial&&d(m,g,x)):g.isMeshMatcapMaterial?(n(m,g),f(m,g)):g.isMeshDepthMaterial?n(m,g):g.isMeshDistanceMaterial?(n(m,g),p(m,g)):g.isMeshNormalMaterial?n(m,g):g.isLineBasicMaterial?(s(m,g),g.isLineDashedMaterial&&a(m,g)):g.isPointsMaterial?o(m,g,v,y):g.isSpriteMaterial?l(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function n(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,g.side===Ts&&(m.bumpScale.value*=-1)),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),g.side===Ts&&m.normalScale.value.negate()),g.specularMap&&(m.specularMap.value=g.specularMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let v=e.get(g).envMap;if(v&&(m.envMap.value=v,m.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio),g.lightMap){m.lightMap.value=g.lightMap;let S=t.physicallyCorrectLights!==!0?Math.PI:1;m.lightMapIntensity.value=g.lightMapIntensity*S}g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity);let y;g.map?y=g.map:g.specularMap?y=g.specularMap:g.displacementMap?y=g.displacementMap:g.normalMap?y=g.normalMap:g.bumpMap?y=g.bumpMap:g.roughnessMap?y=g.roughnessMap:g.metalnessMap?y=g.metalnessMap:g.alphaMap?y=g.alphaMap:g.emissiveMap?y=g.emissiveMap:g.clearcoatMap?y=g.clearcoatMap:g.clearcoatNormalMap?y=g.clearcoatNormalMap:g.clearcoatRoughnessMap?y=g.clearcoatRoughnessMap:g.iridescenceMap?y=g.iridescenceMap:g.iridescenceThicknessMap?y=g.iridescenceThicknessMap:g.specularIntensityMap?y=g.specularIntensityMap:g.specularColorMap?y=g.specularColorMap:g.transmissionMap?y=g.transmissionMap:g.thicknessMap?y=g.thicknessMap:g.sheenColorMap?y=g.sheenColorMap:g.sheenRoughnessMap&&(y=g.sheenRoughnessMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix));let x;g.aoMap?x=g.aoMap:g.lightMap&&(x=g.lightMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),m.uv2Transform.value.copy(x.matrix))}function s(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity}function a(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}function o(m,g,v,y){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*v,m.scale.value=y*.5,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let x;g.map?x=g.map:g.alphaMap&&(x=g.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),m.uvTransform.value.copy(x.matrix))}function l(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let v;g.map?v=g.map:g.alphaMap&&(v=g.alphaMap),v!==void 0&&(v.matrixAutoUpdate===!0&&v.updateMatrix(),m.uvTransform.value.copy(v.matrix))}function c(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4)}function h(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap)}function u(m,g){m.roughness.value=g.roughness,m.metalness.value=g.metalness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap),e.get(g).envMap&&(m.envMapIntensity.value=g.envMapIntensity)}function d(m,g,v){m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),m.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===Ts&&m.clearcoatNormalScale.value.negate())),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap)),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=v.texture,m.transmissionSamplerSize.value.set(v.width,v.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap)}function f(m,g){g.matcap&&(m.matcap.value=g.matcap)}function p(m,g){m.referencePosition.value.copy(g.referencePosition),m.nearDistance.value=g.nearDistance,m.farDistance.value=g.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function c3e(t,e,i,r){let n={},s={},a=[],o=i.isWebGL2?t.getParameter(35375):0;function l(y,x){let S=x.program;r.uniformBlockBinding(y,S)}function c(y,x){let S=n[y.id];S===void 0&&(p(y),S=h(y),n[y.id]=S,y.addEventListener("dispose",g));let A=x.program;r.updateUBOMapping(y,A);let _=e.render.frame;s[y.id]!==_&&(d(y),s[y.id]=_)}function h(y){let x=u();y.__bindingPointIndex=x;let S=t.createBuffer(),A=y.__size,_=y.usage;return t.bindBuffer(35345,S),t.bufferData(35345,A,_),t.bindBuffer(35345,null),t.bindBufferBase(35345,x,S),S}function u(){for(let y=0;y<o;y++)if(a.indexOf(y)===-1)return a.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){let x=n[y.id],S=y.uniforms,A=y.__cache;t.bindBuffer(35345,x);for(let _=0,M=S.length;_<M;_++){let E=S[_];if(f(E,_,A)===!0){let T=E.__offset,C=Array.isArray(E.value)?E.value:[E.value],D=0;for(let B=0;B<C.length;B++){let O=C[B],L=m(O);typeof O=="number"?(E.__data[0]=O,t.bufferSubData(35345,T+D,E.__data)):O.isMatrix3?(E.__data[0]=O.elements[0],E.__data[1]=O.elements[1],E.__data[2]=O.elements[2],E.__data[3]=O.elements[0],E.__data[4]=O.elements[3],E.__data[5]=O.elements[4],E.__data[6]=O.elements[5],E.__data[7]=O.elements[0],E.__data[8]=O.elements[6],E.__data[9]=O.elements[7],E.__data[10]=O.elements[8],E.__data[11]=O.elements[0]):(O.toArray(E.__data,D),D+=L.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(35345,T,E.__data)}}t.bindBuffer(35345,null)}function f(y,x,S){let A=y.value;if(S[x]===void 0){if(typeof A=="number")S[x]=A;else{let _=Array.isArray(A)?A:[A],M=[];for(let E=0;E<_.length;E++)M.push(_[E].clone());S[x]=M}return!0}else if(typeof A=="number"){if(S[x]!==A)return S[x]=A,!0}else{let _=Array.isArray(S[x])?S[x]:[S[x]],M=Array.isArray(A)?A:[A];for(let E=0;E<_.length;E++){let T=_[E];if(T.equals(M[E])===!1)return T.copy(M[E]),!0}}return!1}function p(y){let x=y.uniforms,S=0,A=16,_=0;for(let M=0,E=x.length;M<E;M++){let T=x[M],C={boundary:0,storage:0},D=Array.isArray(T.value)?T.value:[T.value];for(let B=0,O=D.length;B<O;B++){let L=D[B],H=m(L);C.boundary+=H.boundary,C.storage+=H.storage}if(T.__data=new Float32Array(C.storage/Float32Array.BYTES_PER_ELEMENT),T.__offset=S,M>0){_=S%A;let B=A-_;_!==0&&B-C.boundary<0&&(S+=A-_,T.__offset=S)}S+=C.storage}return _=S%A,_>0&&(S+=A-_),y.__size=S,y.__cache={},this}function m(y){let x={boundary:0,storage:0};return typeof y=="number"?(x.boundary=4,x.storage=4):y.isVector2?(x.boundary=8,x.storage=8):y.isVector3||y.isColor?(x.boundary=16,x.storage=12):y.isVector4?(x.boundary=16,x.storage=16):y.isMatrix3?(x.boundary=48,x.storage=48):y.isMatrix4?(x.boundary=64,x.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),x}function g(y){let x=y.target;x.removeEventListener("dispose",g);let S=a.indexOf(x.__bindingPointIndex);a.splice(S,1),t.deleteBuffer(n[x.id]),delete n[x.id],delete s[x.id]}function v(){for(let y in n)t.deleteBuffer(n[y]);a=[],n={},s={}}return{bind:l,update:c,dispose:v}}function h3e(){let t=dS("canvas");return t.style.display="block",t}function Dse(t={}){this.isWebGLRenderer=!0;let e=t.canvas!==void 0?t.canvas:h3e(),i=t.context!==void 0?t.context:null,r=t.depth!==void 0?t.depth:!0,n=t.stencil!==void 0?t.stencil:!0,s=t.antialias!==void 0?t.antialias:!1,a=t.premultipliedAlpha!==void 0?t.premultipliedAlpha:!0,o=t.preserveDrawingBuffer!==void 0?t.preserveDrawingBuffer:!1,l=t.powerPreference!==void 0?t.powerPreference:"default",c=t.failIfMajorPerformanceCaveat!==void 0?t.failIfMajorPerformanceCaveat:!1,h;i!==null?h=i.getContextAttributes().alpha:h=t.alpha!==void 0?t.alpha:!1;let u=null,d=null,f=[],p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Oc,this.physicallyCorrectLights=!1,this.toneMapping=Lh,this.toneMappingExposure=1;let m=this,g=!1,v=0,y=0,x=null,S=-1,A=null,_=new si,M=new si,E=null,T=e.width,C=e.height,D=1,B=null,O=null,L=new si(0,0,T,C),H=new si(0,0,T,C),q=!1,W=new C5,I=!1,z=!1,U=null,X=new st,Q=new ye,re=new N,ie={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ce(){return x===null?D:1}let Z=i;function Ae(G,ae){for(let ge=0;ge<G.length;ge++){let se=G[ge],xe=e.getContext(se,ae);if(xe!==null)return xe}return null}try{let G={alpha:!0,depth:r,stencil:n,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${z1}`),e.addEventListener("webglcontextlost",ot,!1),e.addEventListener("webglcontextrestored",nt,!1),e.addEventListener("webglcontextcreationerror",de,!1),Z===null){let ae=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&ae.shift(),Z=Ae(ae,G),Z===null)throw Ae(ae)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Z.getShaderPrecisionFormat===void 0&&(Z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(G){throw console.error("THREE.WebGLRenderer: "+G.message),G}let Se,_e,ve,Ee,fe,pe,Ie,Le,Ge,Ke,Ve,ke,ut,dt,V,F,oe,Ce,K,Re,Ze,Ne,me,$e;function Qe(){Se=new _Ie(Z),_e=new vIe(Z,Se,t),Se.init(_e),Ne=new n3e(Z,Se,_e),ve=new i3e(Z,Se,_e),Ee=new MIe,fe=new HLe,pe=new r3e(Z,Se,ve,fe,_e,Ne,Ee),Ie=new xIe(m),Le=new SIe(m),Ge=new BPe(Z,_e),me=new mIe(Z,Se,Ge,_e),Ke=new AIe(Z,Ge,Ee,me),Ve=new DIe(Z,Ke,Ge,Ee),K=new PIe(Z,_e,pe),F=new yIe(fe),ke=new VLe(m,Ie,Le,Se,_e,me,F),ut=new l3e(m,fe),dt=new WLe,V=new $Le(Se,_e),Ce=new pIe(m,Ie,Le,ve,Ve,h,a),oe=new t3e(m,Ve,_e),$e=new c3e(Z,Ee,_e,ve),Re=new gIe(Z,Se,Ee,_e),Ze=new EIe(Z,Se,Ee,_e),Ee.programs=ke.programs,m.capabilities=_e,m.extensions=Se,m.properties=fe,m.renderLists=dt,m.shadowMap=oe,m.state=ve,m.info=Ee}Qe();let Je=new o3e(m,Z);this.xr=Je,this.getContext=function(){return Z},this.getContextAttributes=function(){return Z.getContextAttributes()},this.forceContextLoss=function(){let G=Se.get("WEBGL_lose_context");G&&G.loseContext()},this.forceContextRestore=function(){let G=Se.get("WEBGL_lose_context");G&&G.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(G){G!==void 0&&(D=G,this.setSize(T,C,!1))},this.getSize=function(G){return G.set(T,C)},this.setSize=function(G,ae,ge){if(Je.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}T=G,C=ae,e.width=Math.floor(G*D),e.height=Math.floor(ae*D),ge!==!1&&(e.style.width=G+"px",e.style.height=ae+"px"),this.setViewport(0,0,G,ae)},this.getDrawingBufferSize=function(G){return G.set(T*D,C*D).floor()},this.setDrawingBufferSize=function(G,ae,ge){T=G,C=ae,D=ge,e.width=Math.floor(G*ge),e.height=Math.floor(ae*ge),this.setViewport(0,0,G,ae)},this.getCurrentViewport=function(G){return G.copy(_)},this.getViewport=function(G){return G.copy(L)},this.setViewport=function(G,ae,ge,se){G.isVector4?L.set(G.x,G.y,G.z,G.w):L.set(G,ae,ge,se),ve.viewport(_.copy(L).multiplyScalar(D).floor())},this.getScissor=function(G){return G.copy(H)},this.setScissor=function(G,ae,ge,se){G.isVector4?H.set(G.x,G.y,G.z,G.w):H.set(G,ae,ge,se),ve.scissor(M.copy(H).multiplyScalar(D).floor())},this.getScissorTest=function(){return q},this.setScissorTest=function(G){ve.setScissorTest(q=G)},this.setOpaqueSort=function(G){B=G},this.setTransparentSort=function(G){O=G},this.getClearColor=function(G){return G.copy(Ce.getClearColor())},this.setClearColor=function(){Ce.setClearColor.apply(Ce,arguments)},this.getClearAlpha=function(){return Ce.getClearAlpha()},this.setClearAlpha=function(){Ce.setClearAlpha.apply(Ce,arguments)},this.clear=function(G=!0,ae=!0,ge=!0){let se=0;G&&(se|=16384),ae&&(se|=256),ge&&(se|=1024),Z.clear(se)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",ot,!1),e.removeEventListener("webglcontextrestored",nt,!1),e.removeEventListener("webglcontextcreationerror",de,!1),dt.dispose(),V.dispose(),fe.dispose(),Ie.dispose(),Le.dispose(),Ve.dispose(),me.dispose(),$e.dispose(),ke.dispose(),Je.dispose(),Je.removeEventListener("sessionstart",Ue),Je.removeEventListener("sessionend",at),U&&(U.dispose(),U=null),Mt.stop()};function ot(G){G.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function nt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let G=Ee.autoReset,ae=oe.enabled,ge=oe.autoUpdate,se=oe.needsUpdate,xe=oe.type;Qe(),Ee.autoReset=G,oe.enabled=ae,oe.autoUpdate=ge,oe.needsUpdate=se,oe.type=xe}function de(G){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",G.statusMessage)}function Xe(G){let ae=G.target;ae.removeEventListener("dispose",Xe),mt(ae)}function mt(G){J(G),fe.remove(G)}function J(G){let ae=fe.get(G).programs;ae!==void 0&&(ae.forEach(function(ge){ke.releaseProgram(ge)}),G.isShaderMaterial&&ke.releaseShaderCache(G))}this.renderBufferDirect=function(G,ae,ge,se,xe,rt){ae===null&&(ae=ie);let ft=xe.isMesh&&xe.matrixWorld.determinant()<0,gt=Np(G,ae,ge,se,xe);ve.setMaterial(se,ft);let ht=ge.index,Lt=1;se.wireframe===!0&&(ht=Ke.getWireframeAttribute(ge),Lt=2);let wt=ge.drawRange,_t=ge.attributes.position,It=wt.start*Lt,Zi=(wt.start+wt.count)*Lt;rt!==null&&(It=Math.max(It,rt.start*Lt),Zi=Math.min(Zi,(rt.start+rt.count)*Lt)),ht!==null?(It=Math.max(It,0),Zi=Math.min(Zi,ht.count)):_t!=null&&(It=Math.max(It,0),Zi=Math.min(Zi,_t.count));let cn=Zi-It;if(cn<0||cn===1/0)return;me.setup(xe,se,gt,ge,ht);let ls,Ai=Re;if(ht!==null&&(ls=Ge.get(ht),Ai=Ze,Ai.setIndex(ls)),xe.isMesh)se.wireframe===!0?(ve.setLineWidth(se.wireframeLinewidth*ce()),Ai.setMode(1)):Ai.setMode(4);else if(xe.isLine){let At=se.linewidth;At===void 0&&(At=1),ve.setLineWidth(At*ce()),xe.isLineSegments?Ai.setMode(1):xe.isLineLoop?Ai.setMode(2):Ai.setMode(3)}else xe.isPoints?Ai.setMode(0):xe.isSprite&&Ai.setMode(4);if(xe.isInstancedMesh)Ai.renderInstances(It,cn,xe.count);else if(ge.isInstancedBufferGeometry){let At=ge._maxInstanceCount!==void 0?ge._maxInstanceCount:1/0,$r=Math.min(ge.instanceCount,At);Ai.renderInstances(It,cn,$r)}else Ai.render(It,cn)},this.compile=function(G,ae){function ge(se,xe,rt){se.transparent===!0&&se.side===pa&&se.forceSinglePass===!1?(se.side=Ts,se.needsUpdate=!0,Bi(se,xe,rt),se.side=Lc,se.needsUpdate=!0,Bi(se,xe,rt),se.side=pa):Bi(se,xe,rt)}d=V.get(G),d.init(),p.push(d),G.traverseVisible(function(se){se.isLight&&se.layers.test(ae.layers)&&(d.pushLight(se),se.castShadow&&d.pushShadow(se))}),d.setupLights(m.physicallyCorrectLights),G.traverse(function(se){let xe=se.material;if(xe)if(Array.isArray(xe))for(let rt=0;rt<xe.length;rt++){let ft=xe[rt];ge(ft,G,se)}else ge(xe,G,se)}),p.pop(),d=null};let he=null;function Me(G){he&&he(G)}function Ue(){Mt.stop()}function at(){Mt.start()}let Mt=new Ase;Mt.setAnimationLoop(Me),typeof self<"u"&&Mt.setContext(self),this.setAnimationLoop=function(G){he=G,Je.setAnimationLoop(G),G===null?Mt.stop():Mt.start()},Je.addEventListener("sessionstart",Ue),Je.addEventListener("sessionend",at),this.render=function(G,ae){if(ae!==void 0&&ae.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(g===!0)return;G.matrixWorldAutoUpdate===!0&&G.updateMatrixWorld(),ae.parent===null&&ae.matrixWorldAutoUpdate===!0&&ae.updateMatrixWorld(),Je.enabled===!0&&Je.isPresenting===!0&&(Je.cameraAutoUpdate===!0&&Je.updateCamera(ae),ae=Je.getCamera()),G.isScene===!0&&G.onBeforeRender(m,G,ae,x),d=V.get(G,p.length),d.init(),p.push(d),X.multiplyMatrices(ae.projectionMatrix,ae.matrixWorldInverse),W.setFromProjectionMatrix(X),z=this.localClippingEnabled,I=F.init(this.clippingPlanes,z),u=dt.get(G,f.length),u.init(),f.push(u),Qt(G,ae,0,m.sortObjects),u.finish(),m.sortObjects===!0&&u.sort(B,O),I===!0&&F.beginShadows();let ge=d.state.shadowsArray;if(oe.render(ge,G,ae),I===!0&&F.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ce.render(u,G),d.setupLights(m.physicallyCorrectLights),ae.isArrayCamera){let se=ae.cameras;for(let xe=0,rt=se.length;xe<rt;xe++){let ft=se[xe];ci(u,G,ft,ft.viewport)}}else ci(u,G,ae);x!==null&&(pe.updateMultisampleRenderTarget(x),pe.updateRenderTargetMipmap(x)),G.isScene===!0&&G.onAfterRender(m,G,ae),me.resetDefaultState(),S=-1,A=null,p.pop(),p.length>0?d=p[p.length-1]:d=null,f.pop(),f.length>0?u=f[f.length-1]:u=null};function Qt(G,ae,ge,se){if(G.visible===!1)return;if(G.layers.test(ae.layers)){if(G.isGroup)ge=G.renderOrder;else if(G.isLOD)G.autoUpdate===!0&&G.update(ae);else if(G.isLight)d.pushLight(G),G.castShadow&&d.pushShadow(G);else if(G.isSprite){if(!G.frustumCulled||W.intersectsSprite(G)){se&&re.setFromMatrixPosition(G.matrixWorld).applyMatrix4(X);let rt=Ve.update(G),ft=G.material;ft.visible&&u.push(G,rt,ft,ge,re.z,null)}}else if((G.isMesh||G.isLine||G.isPoints)&&(G.isSkinnedMesh&&G.skeleton.frame!==Ee.render.frame&&(G.skeleton.update(),G.skeleton.frame=Ee.render.frame),!G.frustumCulled||W.intersectsObject(G))){se&&re.setFromMatrixPosition(G.matrixWorld).applyMatrix4(X);let rt=Ve.update(G),ft=G.material;if(Array.isArray(ft)){let gt=rt.groups;for(let ht=0,Lt=gt.length;ht<Lt;ht++){let wt=gt[ht],_t=ft[wt.materialIndex];_t&&_t.visible&&u.push(G,rt,_t,ge,re.z,wt)}}else ft.visible&&u.push(G,rt,ft,ge,re.z,null)}}let xe=G.children;for(let rt=0,ft=xe.length;rt<ft;rt++)Qt(xe[rt],ae,ge,se)}function ci(G,ae,ge,se){let xe=G.opaque,rt=G.transmissive,ft=G.transparent;d.setupLightsView(ge),I===!0&&F.setGlobalState(m.clippingPlanes,ge),rt.length>0&&ur(xe,ae,ge),se&&ve.viewport(_.copy(se)),xe.length>0&&Gt(xe,ae,ge),rt.length>0&&Gt(rt,ae,ge),ft.length>0&&Gt(ft,ae,ge),ve.buffers.depth.setTest(!0),ve.buffers.depth.setMask(!0),ve.buffers.color.setMask(!0),ve.setPolygonOffset(!1)}function ur(G,ae,ge){let se=_e.isWebGL2;U===null&&(U=new Di(1,1,{generateMipmaps:!0,type:Se.has("EXT_color_buffer_half_float")?fd:ba,minFilter:s1,samples:se&&s===!0?4:0})),m.getDrawingBufferSize(Q),se?U.setSize(Q.x,Q.y):U.setSize(E2(Q.x),E2(Q.y));let xe=m.getRenderTarget();m.setRenderTarget(U),m.clear();let rt=m.toneMapping;m.toneMapping=Lh,Gt(G,ae,ge),m.toneMapping=rt,pe.updateMultisampleRenderTarget(U),pe.updateRenderTargetMipmap(U),m.setRenderTarget(xe)}function Gt(G,ae,ge){let se=ae.isScene===!0?ae.overrideMaterial:null;for(let xe=0,rt=G.length;xe<rt;xe++){let ft=G[xe],gt=ft.object,ht=ft.geometry,Lt=se===null?ft.material:se,wt=ft.group;gt.layers.test(ge.layers)&&Qi(gt,ae,ge,ht,Lt,wt)}}function Qi(G,ae,ge,se,xe,rt){G.onBeforeRender(m,ae,ge,se,xe,rt),G.modelViewMatrix.multiplyMatrices(ge.matrixWorldInverse,G.matrixWorld),G.normalMatrix.getNormalMatrix(G.modelViewMatrix),xe.onBeforeRender(m,ae,ge,se,G,rt),xe.transparent===!0&&xe.side===pa&&xe.forceSinglePass===!1?(xe.side=Ts,xe.needsUpdate=!0,m.renderBufferDirect(ge,ae,se,xe,G,rt),xe.side=Lc,xe.needsUpdate=!0,m.renderBufferDirect(ge,ae,se,xe,G,rt),xe.side=pa):m.renderBufferDirect(ge,ae,se,xe,G,rt),G.onAfterRender(m,ae,ge,se,xe,rt)}function Bi(G,ae,ge){ae.isScene!==!0&&(ae=ie);let se=fe.get(G),xe=d.state.lights,rt=d.state.shadowsArray,ft=xe.state.version,gt=ke.getParameters(G,xe.state,rt,ae,ge),ht=ke.getProgramCacheKey(gt),Lt=se.programs;se.environment=G.isMeshStandardMaterial?ae.environment:null,se.fog=ae.fog,se.envMap=(G.isMeshStandardMaterial?Le:Ie).get(G.envMap||se.environment),Lt===void 0&&(G.addEventListener("dispose",Xe),Lt=new Map,se.programs=Lt);let wt=Lt.get(ht);if(wt!==void 0){if(se.currentProgram===wt&&se.lightsStateVersion===ft)return Kl(G,gt),wt}else gt.uniforms=ke.getUniforms(G),G.onBuild(ge,gt,m),G.onBeforeCompile(gt,m),wt=ke.acquireProgram(gt,ht),Lt.set(ht,wt),se.uniforms=gt.uniforms;let _t=se.uniforms;(!G.isShaderMaterial&&!G.isRawShaderMaterial||G.clipping===!0)&&(_t.clippingPlanes=F.uniform),Kl(G,gt),se.needsLights=Ql(G),se.lightsStateVersion=ft,se.needsLights&&(_t.ambientLightColor.value=xe.state.ambient,_t.lightProbe.value=xe.state.probe,_t.directionalLights.value=xe.state.directional,_t.directionalLightShadows.value=xe.state.directionalShadow,_t.spotLights.value=xe.state.spot,_t.spotLightShadows.value=xe.state.spotShadow,_t.rectAreaLights.value=xe.state.rectArea,_t.ltc_1.value=xe.state.rectAreaLTC1,_t.ltc_2.value=xe.state.rectAreaLTC2,_t.pointLights.value=xe.state.point,_t.pointLightShadows.value=xe.state.pointShadow,_t.hemisphereLights.value=xe.state.hemi,_t.directionalShadowMap.value=xe.state.directionalShadowMap,_t.directionalShadowMatrix.value=xe.state.directionalShadowMatrix,_t.spotShadowMap.value=xe.state.spotShadowMap,_t.spotLightMatrix.value=xe.state.spotLightMatrix,_t.spotLightMap.value=xe.state.spotLightMap,_t.pointShadowMap.value=xe.state.pointShadowMap,_t.pointShadowMatrix.value=xe.state.pointShadowMatrix);let It=wt.getUniforms(),Zi=hC.seqWithValue(It.seq,_t);return se.currentProgram=wt,se.uniformsList=Zi,wt}function Kl(G,ae){let ge=fe.get(G);ge.outputEncoding=ae.outputEncoding,ge.instancing=ae.instancing,ge.skinning=ae.skinning,ge.morphTargets=ae.morphTargets,ge.morphNormals=ae.morphNormals,ge.morphColors=ae.morphColors,ge.morphTargetsCount=ae.morphTargetsCount,ge.numClippingPlanes=ae.numClippingPlanes,ge.numIntersection=ae.numClipIntersection,ge.vertexAlphas=ae.vertexAlphas,ge.vertexTangents=ae.vertexTangents,ge.toneMapping=ae.toneMapping}function Np(G,ae,ge,se,xe){ae.isScene!==!0&&(ae=ie),pe.resetTextureUnits();let rt=ae.fog,ft=se.isMeshStandardMaterial?ae.environment:null,gt=x===null?m.outputEncoding:x.isXRRenderTarget===!0?x.texture.encoding:Oc,ht=(se.isMeshStandardMaterial?Le:Ie).get(se.envMap||ft),Lt=se.vertexColors===!0&&!!ge.attributes.color&&ge.attributes.color.itemSize===4,wt=!!se.normalMap&&!!ge.attributes.tangent,_t=!!ge.morphAttributes.position,It=!!ge.morphAttributes.normal,Zi=!!ge.morphAttributes.color,cn=se.toneMapped?m.toneMapping:Lh,ls=ge.morphAttributes.position||ge.morphAttributes.normal||ge.morphAttributes.color,Ai=ls!==void 0?ls.length:0,At=fe.get(se),$r=d.state.lights;if(I===!0&&(z===!0||G!==A)){let ne=G===A&&se.id===S;F.setState(se,G,ne)}let Ft=!1;se.version===At.__version?(At.needsLights&&At.lightsStateVersion!==$r.state.version||At.outputEncoding!==gt||xe.isInstancedMesh&&At.instancing===!1||!xe.isInstancedMesh&&At.instancing===!0||xe.isSkinnedMesh&&At.skinning===!1||!xe.isSkinnedMesh&&At.skinning===!0||At.envMap!==ht||se.fog===!0&&At.fog!==rt||At.numClippingPlanes!==void 0&&(At.numClippingPlanes!==F.numPlanes||At.numIntersection!==F.numIntersection)||At.vertexAlphas!==Lt||At.vertexTangents!==wt||At.morphTargets!==_t||At.morphNormals!==It||At.morphColors!==Zi||At.toneMapping!==cn||_e.isWebGL2===!0&&At.morphTargetsCount!==Ai)&&(Ft=!0):(Ft=!0,At.__version=se.version);let Dr=At.currentProgram;Ft===!0&&(Dr=Bi(se,ae,xe));let En=!1,hn=!1,Nr=!1,$=Dr.getUniforms(),te=At.uniforms;if(ve.useProgram(Dr.program)&&(En=!0,hn=!0,Nr=!0),se.id!==S&&(S=se.id,hn=!0),En||A!==G){if($.setValue(Z,"projectionMatrix",G.projectionMatrix),_e.logarithmicDepthBuffer&&$.setValue(Z,"logDepthBufFC",2/(Math.log(G.far+1)/Math.LN2)),A!==G&&(A=G,hn=!0,Nr=!0),se.isShaderMaterial||se.isMeshPhongMaterial||se.isMeshToonMaterial||se.isMeshStandardMaterial||se.envMap){let ne=$.map.cameraPosition;ne!==void 0&&ne.setValue(Z,re.setFromMatrixPosition(G.matrixWorld))}(se.isMeshPhongMaterial||se.isMeshToonMaterial||se.isMeshLambertMaterial||se.isMeshBasicMaterial||se.isMeshStandardMaterial||se.isShaderMaterial)&&$.setValue(Z,"isOrthographic",G.isOrthographicCamera===!0),(se.isMeshPhongMaterial||se.isMeshToonMaterial||se.isMeshLambertMaterial||se.isMeshBasicMaterial||se.isMeshStandardMaterial||se.isShaderMaterial||se.isShadowMaterial||xe.isSkinnedMesh)&&$.setValue(Z,"viewMatrix",G.matrixWorldInverse)}if(xe.isSkinnedMesh){$.setOptional(Z,xe,"bindMatrix"),$.setOptional(Z,xe,"bindMatrixInverse");let ne=xe.skeleton;ne&&(_e.floatVertexTextures?(ne.boneTexture===null&&ne.computeBoneTexture(),$.setValue(Z,"boneTexture",ne.boneTexture,pe),$.setValue(Z,"boneTextureSize",ne.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let be=ge.morphAttributes;if((be.position!==void 0||be.normal!==void 0||be.color!==void 0&&_e.isWebGL2===!0)&&K.update(xe,ge,se,Dr),(hn||At.receiveShadow!==xe.receiveShadow)&&(At.receiveShadow=xe.receiveShadow,$.setValue(Z,"receiveShadow",xe.receiveShadow)),se.isMeshGouraudMaterial&&se.envMap!==null&&(te.envMap.value=ht,te.flipEnvMap.value=ht.isCubeTexture&&ht.isRenderTargetTexture===!1?-1:1),hn&&($.setValue(Z,"toneMappingExposure",m.toneMappingExposure),At.needsLights&&Dd(te,Nr),rt&&se.fog===!0&&ut.refreshFogUniforms(te,rt),ut.refreshMaterialUniforms(te,se,D,C,U),hC.upload(Z,At.uniformsList,te,pe)),se.isShaderMaterial&&se.uniformsNeedUpdate===!0&&(hC.upload(Z,At.uniformsList,te,pe),se.uniformsNeedUpdate=!1),se.isSpriteMaterial&&$.setValue(Z,"center",xe.center),$.setValue(Z,"modelViewMatrix",xe.modelViewMatrix),$.setValue(Z,"normalMatrix",xe.normalMatrix),$.setValue(Z,"modelMatrix",xe.matrixWorld),xe.previousModelViewMatrix&&$.setValue(Z,"previousModelViewMatrix",xe.previousModelViewMatrix),G.previousProjectionMatrix&&$.setValue(Z,"previousProjectionMatrix",G.previousProjectionMatrix),se.isShaderMaterial||se.isRawShaderMaterial){let ne=se.uniformsGroups;for(let Te=0,lt=ne.length;Te<lt;Te++)if(_e.isWebGL2){let Vn=ne[Te];$e.update(Vn,Dr),$e.bind(Vn,Dr)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Dr}function Dd(G,ae){G.ambientLightColor.needsUpdate=ae,G.lightProbe.needsUpdate=ae,G.directionalLights.needsUpdate=ae,G.directionalLightShadows.needsUpdate=ae,G.pointLights.needsUpdate=ae,G.pointLightShadows.needsUpdate=ae,G.spotLights.needsUpdate=ae,G.spotLightShadows.needsUpdate=ae,G.rectAreaLights.needsUpdate=ae,G.hemisphereLights.needsUpdate=ae}function Ql(G){return G.isMeshLambertMaterial||G.isMeshToonMaterial||G.isMeshPhongMaterial||G.isMeshStandardMaterial||G.isShadowMaterial||G.isShaderMaterial&&G.lights===!0}this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(G,ae,ge){fe.get(G.texture).__webglTexture=ae,fe.get(G.depthTexture).__webglTexture=ge;let se=fe.get(G);se.__hasExternalTextures=!0,se.__hasExternalTextures&&(se.__autoAllocateDepthBuffer=ge===void 0,se.__autoAllocateDepthBuffer||Se.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),se.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(G,ae){let ge=fe.get(G);ge.__webglFramebuffer=ae,ge.__useDefaultFramebuffer=ae===void 0},this.setRenderTarget=function(G,ae=0,ge=0){x=G,v=ae,y=ge;let se=!0,xe=null,rt=!1,ft=!1;if(G){let gt=fe.get(G);gt.__useDefaultFramebuffer!==void 0?(ve.bindFramebuffer(36160,null),se=!1):gt.__webglFramebuffer===void 0?pe.setupRenderTarget(G):gt.__hasExternalTextures&&pe.rebindTextures(G,fe.get(G.texture).__webglTexture,fe.get(G.depthTexture).__webglTexture);let ht=G.texture;(ht.isData3DTexture||ht.isDataArrayTexture||ht.isCompressedArrayTexture)&&(ft=!0);let Lt=fe.get(G).__webglFramebuffer;G.isWebGLCubeRenderTarget?(xe=Lt[ae],rt=!0):_e.isWebGL2&&G.samples>0&&pe.useMultisampledRTT(G)===!1?xe=fe.get(G).__webglMultisampledFramebuffer:xe=Lt,_.copy(G.viewport),M.copy(G.scissor),E=G.scissorTest}else _.copy(L).multiplyScalar(D).floor(),M.copy(H).multiplyScalar(D).floor(),E=q;if(ve.bindFramebuffer(36160,xe)&&_e.drawBuffers&&se&&ve.drawBuffers(G,xe),ve.viewport(_),ve.scissor(M),ve.setScissorTest(E),rt){let gt=fe.get(G.texture);Z.framebufferTexture2D(36160,36064,34069+ae,gt.__webglTexture,ge)}else if(ft){let gt=fe.get(G.texture),ht=ae||0;Z.framebufferTextureLayer(36160,36064,gt.__webglTexture,ge||0,ht)}S=-1},this.readRenderTargetPixels=function(G,ae,ge,se,xe,rt,ft){if(!(G&&G.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let gt=fe.get(G).__webglFramebuffer;if(G.isWebGLCubeRenderTarget&&ft!==void 0&&(gt=gt[ft]),gt){ve.bindFramebuffer(36160,gt);try{let ht=G.texture,Lt=ht.format,wt=ht.type;if(Lt!==Fr&&Ne.convert(Lt)!==Z.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let _t=wt===fd&&(Se.has("EXT_color_buffer_half_float")||_e.isWebGL2&&Se.has("EXT_color_buffer_float"));if(wt!==ba&&Ne.convert(wt)!==Z.getParameter(35738)&&!(wt===tr&&(_e.isWebGL2||Se.has("OES_texture_float")||Se.has("WEBGL_color_buffer_float")))&&!_t){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ae>=0&&ae<=G.width-se&&ge>=0&&ge<=G.height-xe&&Z.readPixels(ae,ge,se,xe,Ne.convert(Lt),Ne.convert(wt),rt)}finally{let ht=x!==null?fe.get(x).__webglFramebuffer:null;ve.bindFramebuffer(36160,ht)}}},this.readRenderTargetPixelsAsync=async function(G,ae,ge,se,xe,rt,ft){if(!(G&&G.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let gt=fe.get(G).__webglFramebuffer;if(G.isWebGLCubeRenderTarget&&ft!==void 0&&(gt=gt[ft]),gt){let ht=G.texture,Lt=ht.format,wt=ht.type;if(ae>=0&&ae<=G.width-se&&ge>=0&&ge<=G.height-xe){ve.bindFramebuffer(Z.FRAMEBUFFER,gt);let _t=Z.createBuffer();Z.bindBuffer(Z.PIXEL_PACK_BUFFER,_t),Z.bufferData(Z.PIXEL_PACK_BUFFER,rt.byteLength,Z.STREAM_READ),Z.readPixels(ae,ge,se,xe,Ne.convert(Lt),Ne.convert(wt),0);let It=x!==null?fe.get(x).__webglFramebuffer:null;ve.bindFramebuffer(Z.FRAMEBUFFER,It);let Zi=Z.fenceSync(Z.SYNC_GPU_COMMANDS_COMPLETE,0);return Z.flush(),await mPe(Z,Zi,4),Z.bindBuffer(Z.PIXEL_PACK_BUFFER,_t),Z.getBufferSubData(Z.PIXEL_PACK_BUFFER,0,rt),Z.deleteBuffer(_t),Z.deleteSync(Zi),rt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(G,ae,ge=0){let se=Math.pow(2,-ge),xe=Math.floor(ae.image.width*se),rt=Math.floor(ae.image.height*se);pe.setTexture2D(ae,0),Z.copyTexSubImage2D(3553,ge,0,0,G.x,G.y,xe,rt),ve.unbindTexture()},this.copyTextureToTexture=function(G,ae,ge,se=0){let xe=ae.image.width,rt=ae.image.height,ft=Ne.convert(ge.format),gt=Ne.convert(ge.type);pe.setTexture2D(ge,0),Z.pixelStorei(37440,ge.flipY),Z.pixelStorei(37441,ge.premultiplyAlpha),Z.pixelStorei(3317,ge.unpackAlignment),ae.isDataTexture?Z.texSubImage2D(3553,se,G.x,G.y,xe,rt,ft,gt,ae.image.data):ae.isCompressedTexture?Z.compressedTexSubImage2D(3553,se,G.x,G.y,ae.mipmaps[0].width,ae.mipmaps[0].height,ft,ae.mipmaps[0].data):Z.texSubImage2D(3553,se,G.x,G.y,ft,gt,ae.image),se===0&&ge.generateMipmaps&&Z.generateMipmap(3553),ve.unbindTexture()},this.copyTextureToTexture3D=function(G,ae,ge,se,xe=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let rt=G.max.x-G.min.x+1,ft=G.max.y-G.min.y+1,gt=G.max.z-G.min.z+1,ht=Ne.convert(se.format),Lt=Ne.convert(se.type),wt;if(se.isData3DTexture)pe.setTexture3D(se,0),wt=32879;else if(se.isDataArrayTexture)pe.setTexture2DArray(se,0),wt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Z.pixelStorei(37440,se.flipY),Z.pixelStorei(37441,se.premultiplyAlpha),Z.pixelStorei(3317,se.unpackAlignment);let _t=Z.getParameter(3314),It=Z.getParameter(32878),Zi=Z.getParameter(3316),cn=Z.getParameter(3315),ls=Z.getParameter(32877),Ai=ge.isCompressedTexture?ge.mipmaps[0]:ge.image;Z.pixelStorei(3314,Ai.width),Z.pixelStorei(32878,Ai.height),Z.pixelStorei(3316,G.min.x),Z.pixelStorei(3315,G.min.y),Z.pixelStorei(32877,G.min.z),ge.isDataTexture||ge.isData3DTexture?Z.texSubImage3D(wt,xe,ae.x,ae.y,ae.z,rt,ft,gt,ht,Lt,Ai.data):ge.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Z.compressedTexSubImage3D(wt,xe,ae.x,ae.y,ae.z,rt,ft,gt,ht,Ai.data)):Z.texSubImage3D(wt,xe,ae.x,ae.y,ae.z,rt,ft,gt,ht,Lt,Ai),Z.pixelStorei(3314,_t),Z.pixelStorei(32878,It),Z.pixelStorei(3316,Zi),Z.pixelStorei(3315,cn),Z.pixelStorei(32877,ls),xe===0&&se.generateMipmaps&&Z.generateMipmap(wt),ve.unbindTexture()},this.initRenderTarget=function(G){fe.get(G).__webglFramebuffer===void 0&&pe.setupRenderTarget(G)},this.initTexture=function(G){G.isCubeTexture?pe.setTextureCube(G,0):G.isData3DTexture?pe.setTexture3D(G,0):G.isDataArrayTexture||G.isCompressedArrayTexture?pe.setTexture2DArray(G,0):pe.setTexture2D(G,0),ve.unbindTexture()},this.resetState=function(){v=0,y=0,x=null,ve.reset(),me.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var u3e=class extends Dse{};u3e.prototype.isWebGL1Renderer=!0;var Rse=class{constructor(t,e=1,i=1e3){this.isFog=!0,this.name="",this.color=new Xt(t),this.near=e,this.far=i}clone(){return new Rse(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},go=class extends Ji{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){let e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}},d3e=class{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=Ik,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Nl()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let r=0,n=this.stride;r<n;r++)this.array[t+r]=e.array[i+r];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Nl()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Nl()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},Ta=new N,kk=class{constructor(t,e,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)Ta.fromBufferAttribute(this,e),Ta.applyMatrix4(t),this.setXYZ(e,Ta.x,Ta.y,Ta.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Ta.fromBufferAttribute(this,e),Ta.applyNormalMatrix(t),this.setXYZ(e,Ta.x,Ta.y,Ta.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Ta.fromBufferAttribute(this,e),Ta.transformDirection(t),this.setXYZ(e,Ta.x,Ta.y,Ta.z);return this}setX(t,e){return this.normalized&&(e=mr(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=mr(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=mr(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=mr(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Qu(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Qu(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Qu(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Qu(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=mr(e,this.array),i=mr(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=mr(e,this.array),i=mr(i,this.array),r=mr(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this}setXYZW(t,e,i,r,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=mr(e,this.array),i=mr(i,this.array),r=mr(r,this.array),n=mr(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this.data.array[t+3]=n,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[r+n])}return new Yt(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new kk(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[r+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},Ise=class extends Ji{constructor(){super(),this.isBone=!0,this.type="Bone"}},Ua=class extends Kr{constructor(t=null,e=1,i=1,r,n,s,a,o,l=bi,c=bi,h,u){super(null,s,a,o,l,c,r,n,h,u),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},sX=new st,f3e=new st,D5=class{constructor(t=[],e=[]){this.uuid=Nl(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),e.length===0)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new st)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){let i=new st;this.bones[t]&&i.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){let i=this.bones[t];i&&i.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){let i=this.bones[t];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let t=this.bones,e=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let n=0,s=t.length;n<s;n++){let a=t[n]?t[n].matrixWorld:f3e;sX.multiplyMatrices(a,e[n]),sX.toArray(i,n*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new D5(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=mse(t),t=Math.max(t,4);let e=new Float32Array(t*t*4);e.set(this.boneMatrices);let i=new Ua(e,t,t,Fr,tr);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){let r=this.bones[e];if(r.name===t)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,r=t.bones.length;i<r;i++){let n=t.bones[i],s=e[n];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new Ise),this.bones.push(s),this.boneInverses.push(new st().fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){let t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;let e=this.bones,i=this.boneInverses;for(let r=0,n=e.length;r<n;r++){let s=e[r];t.bones.push(s.uuid);let a=i[r];t.boneInverses.push(a.toArray())}return t}},fS=class extends Yt{constructor(t,e,i,r=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){let t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}},aX=new st,oX=new st,SM=[],p3e=new st,ib=new vr,m3e=class extends vr{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new fS(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let r=0;r<i;r++)this.setMatrixAt(r,p3e)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}raycast(t,e){let i=this.matrixWorld,r=this.count;if(ib.geometry=this.geometry,ib.material=this.material,ib.material!==void 0)for(let n=0;n<r;n++){this.getMatrixAt(n,aX),oX.multiplyMatrices(i,aX),ib.matrixWorld=oX,ib.raycast(t,SM);for(let s=0,a=SM.length;s<a;s++){let o=SM[s];o.instanceId=n,o.object=this,e.push(o)}SM.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new fS(new Float32Array(this.instanceMatrix.count*3),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},Op=class extends A_{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Xt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}},lX=new N,cX=new N,hX=new st,L3=new G1,_M=new wo,M2=class extends Ji{constructor(t=new Nt,e=new Op){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){let t=this.geometry;if(t.index===null){let e=t.attributes.position,i=[0];for(let r=1,n=e.count;r<n;r++)lX.fromBufferAttribute(e,r-1),cX.fromBufferAttribute(e,r),i[r]=i[r-1],i[r]+=lX.distanceTo(cX);t.setAttribute("lineDistance",new bt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){let i=this.geometry,r=this.matrixWorld,n=t.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),_M.copy(i.boundingSphere),_M.applyMatrix4(r),_M.radius+=n,t.ray.intersectsSphere(_M)===!1)return;hX.copy(r).invert(),L3.copy(t.ray).applyMatrix4(hX);let a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new N,c=new N,h=new N,u=new N,d=this.isLineSegments?2:1,f=i.index,p=i.attributes.position;if(f!==null){let m=Math.max(0,s.start),g=Math.min(f.count,s.start+s.count);for(let v=m,y=g-1;v<y;v+=d){let x=f.getX(v),S=f.getX(v+1);if(l.fromBufferAttribute(p,x),c.fromBufferAttribute(p,S),L3.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);let A=t.ray.origin.distanceTo(u);A<t.near||A>t.far||e.push({distance:A,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else{let m=Math.max(0,s.start),g=Math.min(p.count,s.start+s.count);for(let v=m,y=g-1;v<y;v+=d){if(l.fromBufferAttribute(p,v),c.fromBufferAttribute(p,v+1),L3.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);let x=t.ray.origin.distanceTo(u);x<t.near||x>t.far||e.push({distance:x,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){let i=t[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}},uX=new N,dX=new N,E_=class extends M2{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let t=this.geometry;if(t.index===null){let e=t.attributes.position,i=[];for(let r=0,n=e.count;r<n;r+=2)uX.fromBufferAttribute(e,r),dX.fromBufferAttribute(e,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+uX.distanceTo(dX);t.setAttribute("lineDistance",new bt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},g3e=class extends Kr{constructor(t,e,i,r,n,s,a,o,l){super(t,e,i,r,n,s,a,o,l),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:mi,this.magFilter=n!==void 0?n:mi,this.generateMipmaps=!1;let c=this;function h(){c.needsUpdate=!0,t.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){let t=this.image;!("requestVideoFrameCallback"in t)&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},v3e=class extends Kr{constructor(t,e,i,r,n,s,a,o,l){super(t,e,i,r,n,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},qh=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){let i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){let e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){let e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){let t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let e=[],i,r=this.getPoint(0),n=0;e.push(0);for(let s=1;s<=t;s++)i=this.getPoint(s/t),n+=i.distanceTo(r),e.push(n),r=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){let i=this.getLengths(),r=0,n=i.length,s;e?s=e:s=t*i[n-1];let a=0,o=n-1,l;for(;a<=o;)if(r=Math.floor(a+(o-a)/2),l=i[r]-s,l<0)a=r+1;else if(l>0)o=r-1;else{o=r;break}if(r=o,i[r]===s)return r/(n-1);let c=i[r],h=i[r+1]-c,u=(s-c)/h;return(r+u)/(n-1)}getTangent(t,e){let i=t-1e-4,r=t+1e-4;i<0&&(i=0),r>1&&(r=1);let n=this.getPoint(i),s=this.getPoint(r),a=e||(n.isVector2?new ye:new N);return a.copy(s).sub(n).normalize(),a}getTangentAt(t,e){let i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){let i=new N,r=[],n=[],s=[],a=new N,o=new st;for(let d=0;d<=t;d++){let f=d/t;r[d]=this.getTangentAt(f,new N)}n[0]=new N,s[0]=new N;let l=Number.MAX_VALUE,c=Math.abs(r[0].x),h=Math.abs(r[0].y),u=Math.abs(r[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),u<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],a),s[0].crossVectors(r[0],n[0]);for(let d=1;d<=t;d++){if(n[d]=n[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(r[d-1],r[d]),a.length()>Number.EPSILON){a.normalize();let f=Math.acos(In(r[d-1].dot(r[d]),-1,1));n[d].applyMatrix4(o.makeRotationAxis(a,f))}s[d].crossVectors(r[d],n[d])}if(e===!0){let d=Math.acos(In(n[0].dot(n[t]),-1,1));d/=t,r[0].dot(a.crossVectors(n[0],n[t]))>0&&(d=-d);for(let f=1;f<=t;f++)n[f].applyMatrix4(o.makeRotationAxis(r[f],d*f)),s[f].crossVectors(r[f],n[f])}return{tangents:r,normals:n,binormals:s}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){let t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}},CD=class extends qh{constructor(t=0,e=0,i=1,r=1,n=0,s=Math.PI*2,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(t,e){let i=e||new ye,r=Math.PI*2,n=this.aEndAngle-this.aStartAngle,s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(s?n=0:n=r),this.aClockwise===!0&&!s&&(n===r?n=-r:n=n-r);let a=this.aStartAngle+t*n,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),u=o-this.aX,d=l-this.aY;o=u*c-d*h+this.aX,l=u*h+d*c+this.aY}return i.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){let t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}},y3e=class extends CD{constructor(t,e,i,r,n,s){super(t,e,i,i,r,n,s),this.isArcCurve=!0,this.type="ArcCurve"}};function R5(){let t=0,e=0,i=0,r=0;function n(s,a,o,l){t=s,e=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,h,u){let d=(a-s)/c-(o-s)/(c+h)+(o-a)/h,f=(o-a)/h-(l-a)/(h+u)+(l-o)/u;d*=h,f*=h,n(a,o,d,f)},calc:function(s){let a=s*s,o=a*s;return t+e*s+i*a+r*o}}}var AM=new N,O3=new R5,B3=new R5,F3=new R5,x3e=class extends qh{constructor(t=[],e=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=r}getPoint(t,e=new N){let i=e,r=this.points,n=r.length,s=(n-(this.closed?0:1))*t,a=Math.floor(s),o=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/n)+1)*n:o===0&&a===n-1&&(a=n-2,o=1);let l,c;this.closed||a>0?l=r[(a-1)%n]:(AM.subVectors(r[0],r[1]).add(r[0]),l=AM);let h=r[a%n],u=r[(a+1)%n];if(this.closed||a+2<n?c=r[(a+2)%n]:(AM.subVectors(r[n-1],r[n-2]).add(r[n-1]),c=AM),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,f=Math.pow(l.distanceToSquared(h),d),p=Math.pow(h.distanceToSquared(u),d),m=Math.pow(u.distanceToSquared(c),d);p<1e-4&&(p=1),f<1e-4&&(f=p),m<1e-4&&(m=p),O3.initNonuniformCatmullRom(l.x,h.x,u.x,c.x,f,p,m),B3.initNonuniformCatmullRom(l.y,h.y,u.y,c.y,f,p,m),F3.initNonuniformCatmullRom(l.z,h.z,u.z,c.z,f,p,m)}else this.curveType==="catmullrom"&&(O3.initCatmullRom(l.x,h.x,u.x,c.x,this.tension),B3.initCatmullRom(l.y,h.y,u.y,c.y,this.tension),F3.initCatmullRom(l.z,h.z,u.z,c.z,this.tension));return i.set(O3.calc(o),B3.calc(o),F3.calc(o)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(r.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){let t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];t.points.push(r.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(new N().fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}};function fX(t,e,i,r,n){let s=(r-e)*.5,a=(n-i)*.5,o=t*t,l=t*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*t+i}function b3e(t,e){let i=1-t;return i*i*e}function w3e(t,e){return 2*(1-t)*t*e}function S3e(t,e){return t*t*e}function uw(t,e,i,r){return b3e(t,e)+w3e(t,i)+S3e(t,r)}function _3e(t,e){let i=1-t;return i*i*i*e}function A3e(t,e){let i=1-t;return 3*i*i*t*e}function E3e(t,e){return 3*(1-t)*t*t*e}function M3e(t,e){return t*t*t*e}function dw(t,e,i,r,n){return _3e(t,e)+A3e(t,i)+E3e(t,r)+M3e(t,n)}var Ac=class extends qh{constructor(t=new ye,e=new ye,i=new ye,r=new ye){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=r}getPoint(t,e=new ye){let i=e,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(dw(t,r.x,n.x,s.x,a.x),dw(t,r.y,n.y,s.y,a.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},uC=class extends qh{constructor(t=new N,e=new N,i=new N,r=new N){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=r}getPoint(t,e=new N){let i=e,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(dw(t,r.x,n.x,s.x,a.x),dw(t,r.y,n.y,s.y,a.y),dw(t,r.z,n.z,s.z,a.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},Rc=class extends qh{constructor(t=new ye,e=new ye){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new ye){let i=e;return t===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){let i=e||new ye;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},Lse=class extends qh{constructor(t=new N,e=new N){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new N){let i=e;return t===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},vp=class extends qh{constructor(t=new ye,e=new ye,i=new ye){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new ye){let i=e,r=this.v0,n=this.v1,s=this.v2;return i.set(uw(t,r.x,n.x,s.x),uw(t,r.y,n.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},T3e=class extends qh{constructor(t=new N,e=new N,i=new N){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new N){let i=e,r=this.v0,n=this.v1,s=this.v2;return i.set(uw(t,r.x,n.x,s.x),uw(t,r.y,n.y,s.y),uw(t,r.z,n.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},I5=class extends qh{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new ye){let i=e,r=this.points,n=(r.length-1)*t,s=Math.floor(n),a=n-s,o=r[s===0?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],h=r[s>r.length-3?r.length-1:s+2];return i.set(fX(a,o.x,l.x,c.x,h.x),fX(a,o.y,l.y,c.y,h.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(r.clone())}return this}toJSON(){let t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];t.points.push(r.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(new ye().fromArray(r))}return this}},C3e=Object.freeze({__proto__:null,ArcCurve:y3e,CatmullRomCurve3:x3e,CubicBezierCurve:Ac,CubicBezierCurve3:uC,EllipseCurve:CD,LineCurve:Rc,LineCurve3:Lse,QuadraticBezierCurve:vp,QuadraticBezierCurve3:T3e,SplineCurve:I5}),Ose=class extends qh{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){let t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Rc(e,t))}getPoint(t,e){let i=t*this.getLength(),r=this.getCurveLengths(),n=0;for(;n<r.length;){if(r[n]>=i){let s=r[n]-i,a=this.curves[n],o=a.getLength(),l=o===0?0:1-s/o;return a.getPointAt(l,e)}n++}return null}getLength(){let t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let t=[],e=0;for(let i=0,r=this.curves.length;i<r;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){let e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){let e=[],i;for(let r=0,n=this.curves;r<n.length;r++){let s=n[r],a=s.isEllipseCurve?t*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let l=0;l<o.length;l++){let c=o[l];i&&i.equals(c)||(e.push(c),i=c)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){let r=t.curves[e];this.curves.push(r.clone())}return this.autoClose=t.autoClose,this}toJSON(){let t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){let r=this.curves[e];t.curves.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){let r=t.curves[e];this.curves.push(new C3e[r.type]().fromJSON(r))}return this}},T2=class extends Ose{constructor(t){super(),this.type="Path",this.currentPoint=new ye,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){let i=new Rc(this.currentPoint.clone(),new ye(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,r){let n=new vp(this.currentPoint.clone(),new ye(t,e),new ye(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(t,e,i,r,n,s){let a=new Ac(this.currentPoint.clone(),new ye(t,e),new ye(i,r),new ye(n,s));return this.curves.push(a),this.currentPoint.set(n,s),this}splineThru(t){let e=[this.currentPoint.clone()].concat(t),i=new I5(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,r,n,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,i,r,n,s),this}absarc(t,e,i,r,n,s){return this.absellipse(t,e,i,i,r,n,s),this}ellipse(t,e,i,r,n,s,a,o){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,i,r,n,s,a,o),this}absellipse(t,e,i,r,n,s,a,o){let l=new CD(t,e,i,r,n,s,a,o);if(this.curves.length>0){let h=l.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){let t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}},Bse=class extends Nt{constructor(t=[new ye(0,-.5),new ye(.5,0),new ye(0,.5)],e=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:r},e=Math.floor(e),r=In(r,0,Math.PI*2);let n=[],s=[],a=[],o=[],l=[],c=1/e,h=new N,u=new ye,d=new N,f=new N,p=new N,m=0,g=0;for(let v=0;v<=t.length-1;v++)switch(v){case 0:m=t[v+1].x-t[v].x,g=t[v+1].y-t[v].y,d.x=g*1,d.y=-m,d.z=g*0,p.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case t.length-1:o.push(p.x,p.y,p.z);break;default:m=t[v+1].x-t[v].x,g=t[v+1].y-t[v].y,d.x=g*1,d.y=-m,d.z=g*0,f.copy(d),d.x+=p.x,d.y+=p.y,d.z+=p.z,d.normalize(),o.push(d.x,d.y,d.z),p.copy(f)}for(let v=0;v<=e;v++){let y=i+v*c*r,x=Math.sin(y),S=Math.cos(y);for(let A=0;A<=t.length-1;A++){h.x=t[A].x*x,h.y=t[A].y,h.z=t[A].x*S,s.push(h.x,h.y,h.z),u.x=v/e,u.y=A/(t.length-1),a.push(u.x,u.y);let _=o[3*A+0]*x,M=o[3*A+1],E=o[3*A+0]*S;l.push(_,M,E)}}for(let v=0;v<e;v++)for(let y=0;y<t.length-1;y++){let x=y+v*t.length,S=x,A=x+t.length,_=x+t.length+1,M=x+1;n.push(S,A,M),n.push(_,M,A)}this.setIndex(n),this.setAttribute("position",new bt(s,3)),this.setAttribute("uv",new bt(a,2)),this.setAttribute("normal",new bt(l,3))}static fromJSON(t){return new Bse(t.points,t.segments,t.phiStart,t.phiLength)}},L5=class extends Nt{constructor(t=1,e=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o};let l=this;r=Math.floor(r),n=Math.floor(n);let c=[],h=[],u=[],d=[],f=0,p=[],m=i/2,g=0;v(),s===!1&&(t>0&&y(!0),e>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new bt(h,3)),this.setAttribute("normal",new bt(u,3)),this.setAttribute("uv",new bt(d,2));function v(){let x=new N,S=new N,A=0,_=(e-t)/i;for(let M=0;M<=n;M++){let E=[],T=M/n,C=T*(e-t)+t;for(let D=0;D<=r;D++){let B=D/r,O=B*o+a,L=Math.sin(O),H=Math.cos(O);S.x=C*L,S.y=-T*i+m,S.z=C*H,h.push(S.x,S.y,S.z),x.set(L,_,H).normalize(),u.push(x.x,x.y,x.z),d.push(B,1-T),E.push(f++)}p.push(E)}for(let M=0;M<r;M++)for(let E=0;E<n;E++){let T=p[E][M],C=p[E+1][M],D=p[E+1][M+1],B=p[E][M+1];c.push(T,C,B),c.push(C,D,B),A+=6}l.addGroup(g,A,0),g+=A}function y(x){let S=f,A=new ye,_=new N,M=0,E=x===!0?t:e,T=x===!0?1:-1;for(let D=1;D<=r;D++)h.push(0,m*T,0),u.push(0,T,0),d.push(.5,.5),f++;let C=f;for(let D=0;D<=r;D++){let B=D/r*o+a,O=Math.cos(B),L=Math.sin(B);_.x=E*L,_.y=m*T,_.z=E*O,h.push(_.x,_.y,_.z),u.push(0,T,0),A.x=O*.5+.5,A.y=L*.5*T+.5,d.push(A.x,A.y),f++}for(let D=0;D<r;D++){let B=S+D,O=C+D;x===!0?c.push(O,O+1,B):c.push(O+1,O,B),M+=3}l.addGroup(g,M,x===!0?1:2),g+=M}}static fromJSON(t){return new L5(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}},O5=class extends L5{constructor(t=1,e=1,i=32,r=1,n=!1,s=0,a=Math.PI*2){super(0,t,e,i,r,n,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:s,thetaLength:a}}static fromJSON(t){return new O5(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}},B5=class extends Nt{constructor(t=[],e=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:r};let n=[],s=[];a(r),l(i),c(),this.setAttribute("position",new bt(n,3)),this.setAttribute("normal",new bt(n.slice(),3)),this.setAttribute("uv",new bt(s,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(v){let y=new N,x=new N,S=new N;for(let A=0;A<e.length;A+=3)d(e[A+0],y),d(e[A+1],x),d(e[A+2],S),o(y,x,S,v)}function o(v,y,x,S){let A=S+1,_=[];for(let M=0;M<=A;M++){_[M]=[];let E=v.clone().lerp(x,M/A),T=y.clone().lerp(x,M/A),C=A-M;for(let D=0;D<=C;D++)D===0&&M===A?_[M][D]=E:_[M][D]=E.clone().lerp(T,D/C)}for(let M=0;M<A;M++)for(let E=0;E<2*(A-M)-1;E++){let T=Math.floor(E/2);E%2===0?(u(_[M][T+1]),u(_[M+1][T]),u(_[M][T])):(u(_[M][T+1]),u(_[M+1][T+1]),u(_[M+1][T]))}}function l(v){let y=new N;for(let x=0;x<n.length;x+=3)y.x=n[x+0],y.y=n[x+1],y.z=n[x+2],y.normalize().multiplyScalar(v),n[x+0]=y.x,n[x+1]=y.y,n[x+2]=y.z}function c(){let v=new N;for(let y=0;y<n.length;y+=3){v.x=n[y+0],v.y=n[y+1],v.z=n[y+2];let x=m(v)/2/Math.PI+.5,S=g(v)/Math.PI+.5;s.push(x,1-S)}f(),h()}function h(){for(let v=0;v<s.length;v+=6){let y=s[v+0],x=s[v+2],S=s[v+4],A=Math.max(y,x,S),_=Math.min(y,x,S);A>.9&&_<.1&&(y<.2&&(s[v+0]+=1),x<.2&&(s[v+2]+=1),S<.2&&(s[v+4]+=1))}}function u(v){n.push(v.x,v.y,v.z)}function d(v,y){let x=v*3;y.x=t[x+0],y.y=t[x+1],y.z=t[x+2]}function f(){let v=new N,y=new N,x=new N,S=new N,A=new ye,_=new ye,M=new ye;for(let E=0,T=0;E<n.length;E+=9,T+=6){v.set(n[E+0],n[E+1],n[E+2]),y.set(n[E+3],n[E+4],n[E+5]),x.set(n[E+6],n[E+7],n[E+8]),A.set(s[T+0],s[T+1]),_.set(s[T+2],s[T+3]),M.set(s[T+4],s[T+5]),S.copy(v).add(y).add(x).divideScalar(3);let C=m(S);p(A,T+0,v,C),p(_,T+2,y,C),p(M,T+4,x,C)}}function p(v,y,x,S){S<0&&v.x===1&&(s[y]=v.x-1),x.x===0&&x.z===0&&(s[y]=S/2/Math.PI+.5)}function m(v){return Math.atan2(v.z,-v.x)}function g(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}}static fromJSON(t){return new B5(t.vertices,t.indices,t.radius,t.details)}},Fse=class extends B5{constructor(t=1,e=0){let i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,s,t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Fse(t.radius,t.detail)}},C2=class extends T2{constructor(t){super(t),this.uuid=Nl(),this.type="Shape",this.holes=[]}getPointsHoles(t){let e=[];for(let i=0,r=this.holes.length;i<r;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){let r=t.holes[e];this.holes.push(r.clone())}return this}toJSON(){let t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){let r=this.holes[e];t.holes.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){let r=t.holes[e];this.holes.push(new T2().fromJSON(r))}return this}},P3e={triangulate:function(t,e,i=2){let r=e&&e.length,n=r?e[0]*i:t.length,s=kse(t,0,n,i,!0),a=[];if(!s||s.next===s.prev)return a;let o,l,c,h,u,d,f;if(r&&(s=O3e(t,e,s,i)),t.length>80*i){o=c=t[0],l=h=t[1];for(let p=i;p<n;p+=i)u=t[p],d=t[p+1],u<o&&(o=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);f=Math.max(c-o,h-l),f=f!==0?32767/f:0}return pS(s,a,i,o,l,f,0),a}};function kse(t,e,i,r,n){let s,a;if(n===W3e(t,e,i,r)>0)for(s=e;s<i;s+=r)a=pX(s,t[s],t[s+1],a);else for(s=i-r;s>=e;s-=r)a=pX(s,t[s],t[s+1],a);return a&&PD(a,a.next)&&(gS(a),a=a.next),a}function Hg(t,e){if(!t)return t;e||(e=t);let i=t,r;do if(r=!1,!i.steiner&&(PD(i,i.next)||Wr(i.prev,i,i.next)===0)){if(gS(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function pS(t,e,i,r,n,s,a){if(!t)return;!a&&s&&U3e(t,r,n,s);let o=t,l,c;for(;t.prev!==t.next;){if(l=t.prev,c=t.next,s?R3e(t,r,n,s):D3e(t)){e.push(l.i/i|0),e.push(t.i/i|0),e.push(c.i/i|0),gS(t),t=c.next,o=c.next;continue}if(t=c,t===o){a?a===1?(t=I3e(Hg(t),e,i),pS(t,e,i,r,n,s,2)):a===2&&L3e(t,e,i,r,n,s):pS(Hg(t),e,i,r,n,s,1);break}}}function D3e(t){let e=t.prev,i=t,r=t.next;if(Wr(e,i,r)>=0)return!1;let n=e.x,s=i.x,a=r.x,o=e.y,l=i.y,c=r.y,h=n<s?n<a?n:a:s<a?s:a,u=o<l?o<c?o:c:l<c?l:c,d=n>s?n>a?n:a:s>a?s:a,f=o>l?o>c?o:c:l>c?l:c,p=r.next;for(;p!==e;){if(p.x>=h&&p.x<=d&&p.y>=u&&p.y<=f&&sy(n,o,s,l,a,c,p.x,p.y)&&Wr(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function R3e(t,e,i,r){let n=t.prev,s=t,a=t.next;if(Wr(n,s,a)>=0)return!1;let o=n.x,l=s.x,c=a.x,h=n.y,u=s.y,d=a.y,f=o<l?o<c?o:c:l<c?l:c,p=h<u?h<d?h:d:u<d?u:d,m=o>l?o>c?o:c:l>c?l:c,g=h>u?h>d?h:d:u>d?u:d,v=Nk(f,p,e,i,r),y=Nk(m,g,e,i,r),x=t.prevZ,S=t.nextZ;for(;x&&x.z>=v&&S&&S.z<=y;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==n&&x!==a&&sy(o,h,l,u,c,d,x.x,x.y)&&Wr(x.prev,x,x.next)>=0||(x=x.prevZ,S.x>=f&&S.x<=m&&S.y>=p&&S.y<=g&&S!==n&&S!==a&&sy(o,h,l,u,c,d,S.x,S.y)&&Wr(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;x&&x.z>=v;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==n&&x!==a&&sy(o,h,l,u,c,d,x.x,x.y)&&Wr(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;S&&S.z<=y;){if(S.x>=f&&S.x<=m&&S.y>=p&&S.y<=g&&S!==n&&S!==a&&sy(o,h,l,u,c,d,S.x,S.y)&&Wr(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function I3e(t,e,i){let r=t;do{let n=r.prev,s=r.next.next;!PD(n,s)&&Nse(n,r,r.next,s)&&mS(n,s)&&mS(s,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(s.i/i|0),gS(r),gS(r.next),r=t=s),r=r.next}while(r!==t);return Hg(r)}function L3e(t,e,i,r,n,s){let a=t;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&V3e(a,o)){let l=Use(a,o);a=Hg(a,a.next),l=Hg(l,l.next),pS(a,e,i,r,n,s,0),pS(l,e,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==t)}function O3e(t,e,i,r){let n=[],s,a,o,l,c;for(s=0,a=e.length;s<a;s++)o=e[s]*r,l=s<a-1?e[s+1]*r:t.length,c=kse(t,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(G3e(c));for(n.sort(B3e),s=0;s<n.length;s++)i=F3e(n[s],i);return i}function B3e(t,e){return t.x-e.x}function F3e(t,e){let i=k3e(t,e);if(!i)return e;let r=Use(i,t);return Hg(r,r.next),Hg(i,i.next)}function k3e(t,e){let i=e,r=-1/0,n,s=t.x,a=t.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){let d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==e);if(!n)return null;let o=n,l=n.x,c=n.y,h=1/0,u;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&sy(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(u=Math.abs(a-i.y)/(s-i.x),mS(i,t)&&(u<h||u===h&&(i.x>n.x||i.x===n.x&&N3e(n,i)))&&(n=i,h=u)),i=i.next;while(i!==o);return n}function N3e(t,e){return Wr(t.prev,t,e.prev)<0&&Wr(e.next,t,t.next)<0}function U3e(t,e,i,r){let n=t;do n.z===0&&(n.z=Nk(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,z3e(n)}function z3e(t){let e,i,r,n,s,a,o,l,c=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,r=i,o=0,e=0;e<c&&(o++,r=r.nextZ,!!r);e++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return t}function Nk(t,e,i,r,n){return t=(t-i)*n|0,e=(e-r)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function G3e(t){let e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function sy(t,e,i,r,n,s,a,o){return(n-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(r-o)>=(i-a)*(e-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function V3e(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!H3e(t,e)&&(mS(t,e)&&mS(e,t)&&j3e(t,e)&&(Wr(t.prev,t,e.prev)||Wr(t,e.prev,e))||PD(t,e)&&Wr(t.prev,t,t.next)>0&&Wr(e.prev,e,e.next)>0)}function Wr(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function PD(t,e){return t.x===e.x&&t.y===e.y}function Nse(t,e,i,r){let n=MM(Wr(t,e,i)),s=MM(Wr(t,e,r)),a=MM(Wr(i,r,t)),o=MM(Wr(i,r,e));return!!(n!==s&&a!==o||n===0&&EM(t,i,e)||s===0&&EM(t,r,e)||a===0&&EM(i,t,r)||o===0&&EM(i,e,r))}function EM(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function MM(t){return t>0?1:t<0?-1:0}function H3e(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Nse(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function mS(t,e){return Wr(t.prev,t,t.next)<0?Wr(t,e,t.next)>=0&&Wr(t,t.prev,e)>=0:Wr(t,e,t.prev)<0||Wr(t,t.next,e)<0}function j3e(t,e){let i=t,r=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function Use(t,e){let i=new Uk(t.i,t.x,t.y),r=new Uk(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function pX(t,e,i,r){let n=new Uk(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function gS(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Uk(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function W3e(t,e,i,r){let n=0;for(let s=e,a=i-r;s<i;s+=r)n+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return n}var zse=class{static area(t){let e=t.length,i=0;for(let r=e-1,n=0;n<e;r=n++)i+=t[r].x*t[n].y-t[n].x*t[r].y;return i*.5}static isClockWise(t){return zse.area(t)<0}static triangulateShape(t,e){let i=[],r=[],n=[];mX(t),gX(i,t);let s=t.length;e.forEach(mX);for(let o=0;o<e.length;o++)r.push(s),s+=e[o].length,gX(i,e[o]);let a=P3e.triangulate(i,r);for(let o=0;o<a.length;o+=3)n.push(a.slice(o,o+3));return n}};function mX(t){let e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function gX(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}var Gse=class extends B5{constructor(t=1,e=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,n,t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Gse(t.radius,t.detail)}},Ty=class extends Nt{constructor(t=1,e=32,i=16,r=0,n=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));let o=Math.min(s+a,Math.PI),l=0,c=[],h=new N,u=new N,d=[],f=[],p=[],m=[];for(let g=0;g<=i;g++){let v=[],y=g/i,x=0;g==0&&s==0?x=.5/e:g==i&&o==Math.PI&&(x=-.5/e);for(let S=0;S<=e;S++){let A=S/e;h.x=-t*Math.cos(r+A*n)*Math.sin(s+y*a),h.y=t*Math.cos(s+y*a),h.z=t*Math.sin(r+A*n)*Math.sin(s+y*a),f.push(h.x,h.y,h.z),u.copy(h).normalize(),p.push(u.x,u.y,u.z),m.push(A+x,1-y),v.push(l++)}c.push(v)}for(let g=0;g<i;g++)for(let v=0;v<e;v++){let y=c[g][v+1],x=c[g][v],S=c[g+1][v],A=c[g+1][v+1];(g!==0||s>0)&&d.push(y,x,A),(g!==i-1||o<Math.PI)&&d.push(x,S,A)}this.setIndex(d),this.setAttribute("position",new bt(f,3)),this.setAttribute("normal",new bt(p,3)),this.setAttribute("uv",new bt(m,2))}static fromJSON(t){return new Ty(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}},Vse=class extends Nt{constructor(t=1,e=.4,i=12,r=48,n=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:r,arc:n},i=Math.floor(i),r=Math.floor(r);let s=[],a=[],o=[],l=[],c=new N,h=new N,u=new N;for(let d=0;d<=i;d++)for(let f=0;f<=r;f++){let p=f/r*n,m=d/i*Math.PI*2;h.x=(t+e*Math.cos(m))*Math.cos(p),h.y=(t+e*Math.cos(m))*Math.sin(p),h.z=e*Math.sin(m),a.push(h.x,h.y,h.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),u.subVectors(h,c).normalize(),o.push(u.x,u.y,u.z),l.push(f/r),l.push(d/i)}for(let d=1;d<=i;d++)for(let f=1;f<=r;f++){let p=(r+1)*d+f-1,m=(r+1)*(d-1)+f-1,g=(r+1)*(d-1)+f,v=(r+1)*d+f;s.push(p,m,v),s.push(m,g,v)}this.setIndex(s),this.setAttribute("position",new bt(a,3)),this.setAttribute("normal",new bt(o,3)),this.setAttribute("uv",new bt(l,2))}static fromJSON(t){return new Vse(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}},Hse=class extends Nt{constructor(t=1,e=.4,i=64,r=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:r,p:n,q:s},i=Math.floor(i),r=Math.floor(r);let a=[],o=[],l=[],c=[],h=new N,u=new N,d=new N,f=new N,p=new N,m=new N,g=new N;for(let y=0;y<=i;++y){let x=y/i*n*Math.PI*2;v(x,n,s,t,d),v(x+.01,n,s,t,f),m.subVectors(f,d),g.addVectors(f,d),p.crossVectors(m,g),g.crossVectors(p,m),p.normalize(),g.normalize();for(let S=0;S<=r;++S){let A=S/r*Math.PI*2,_=-e*Math.cos(A),M=e*Math.sin(A);h.x=d.x+(_*g.x+M*p.x),h.y=d.y+(_*g.y+M*p.y),h.z=d.z+(_*g.z+M*p.z),o.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(y/i),c.push(S/r)}}for(let y=1;y<=i;y++)for(let x=1;x<=r;x++){let S=(r+1)*(y-1)+(x-1),A=(r+1)*y+(x-1),_=(r+1)*y+x,M=(r+1)*(y-1)+x;a.push(S,A,M),a.push(A,_,M)}this.setIndex(a),this.setAttribute("position",new bt(o,3)),this.setAttribute("normal",new bt(l,3)),this.setAttribute("uv",new bt(c,2));function v(y,x,S,A,_){let M=Math.cos(y),E=Math.sin(y),T=S/x*y,C=Math.cos(T);_.x=A*(2+C)*.5*M,_.y=A*(2+C)*E*.5,_.z=A*Math.sin(T)*.5}}static fromJSON(t){return new Hse(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}},X3e=class extends Ri{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};function tf(t,e,i){return jse(t)?new t.constructor(t.subarray(e,i!==void 0?i:t.length)):t.slice(e,i)}function TM(t,e,i){return!t||t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function jse(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Y3e(t){function e(n,s){return t[n]-t[s]}let i=t.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(e),r}function vX(t,e,i){let r=t.length,n=new t.constructor(r);for(let s=0,a=0;a!==r;++s){let o=i[s]*e;for(let l=0;l!==e;++l)n[a++]=t[o+l]}return n}function Wse(t,e,i,r){let n=1,s=t[0];for(;s!==void 0&&s[r]===void 0;)s=t[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(e.push(s.time),i.push.apply(i,a)),s=t[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(e.push(s.time),a.toArray(i,i.length)),s=t[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(e.push(s.time),i.push(a)),s=t[n++];while(s!==void 0)}var DD=class{constructor(t,e,i,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){let e=this.parameterPositions,i=this._cachedIndex,r=e[i],n=e[i-1];e:{t:{let s;i:{r:if(!(t<r)){for(let a=i+2;;){if(r===void 0){if(t<n)break r;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(n=r,r=e[++i],t<r)break t}s=e.length;break i}if(!(t>=n)){let a=e[1];t<a&&(i=2,n=a);for(let o=i-2;;){if(n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(r=n,n=e[--i-1],t>=n)break t}s=i,i=0;break i}break e}for(;i<s;){let a=i+s>>>1;t<e[a]?s=a:i=a+1}if(r=e[i],n=e[i-1],n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){let e=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=t*r;for(let s=0;s!==r;++s)e[s]=i[n+s];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},q3e=class extends DD{constructor(t,e,i,r){super(t,e,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:iy,endingEnd:iy}}intervalChanged_(t,e,i){let r=this.parameterPositions,n=t-2,s=t+1,a=r[n],o=r[s];if(a===void 0)switch(this.getSettings_().endingStart){case ry:n=t,a=2*e-i;break;case _2:n=r.length-2,a=e+r[n]-r[n+1];break;default:n=t,a=i}if(o===void 0)switch(this.getSettings_().endingEnd){case ry:s=t,o=2*i-e;break;case _2:s=1,o=i+r[1]-r[0];break;default:s=t-1,o=e}let l=(i-e)*.5,c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-i),this._offsetPrev=n*c,this._offsetNext=s*c}interpolate_(t,e,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,f=(i-e)/(r-e),p=f*f,m=p*f,g=-u*m+2*u*p-u*f,v=(1+u)*m+(-1.5-2*u)*p+(-.5+u)*f+1,y=(-1-d)*m+(1.5+d)*p+.5*f,x=d*m-d*p;for(let S=0;S!==a;++S)n[S]=g*s[c+S]+v*s[l+S]+y*s[o+S]+x*s[h+S];return n}},Xse=class extends DD{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=(i-e)/(r-e),h=1-c;for(let u=0;u!==a;++u)n[u]=s[l+u]*h+s[o+u]*c;return n}},K3e=class extends DD{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t){return this.copySampleValue_(t-1)}},Kh=class{constructor(t,e,i,r){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=TM(e,this.TimeBufferType),this.values=TM(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){let e=t.constructor,i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:TM(t.times,Array),values:TM(t.values,Array)};let r=t.getInterpolation();r!==t.DefaultInterpolation&&(i.interpolation=r)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new K3e(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Xse(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new q3e(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case w2:e=this.InterpolantFactoryMethodDiscrete;break;case S2:e=this.InterpolantFactoryMethodLinear;break;case o3:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return w2;case this.InterpolantFactoryMethodLinear:return S2;case this.InterpolantFactoryMethodSmooth:return o3}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){let e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]+=t}return this}scale(t){if(t!==1){let e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]*=t}return this}trim(t,e){let i=this.times,r=i.length,n=0,s=r-1;for(;n!==r&&i[n]<t;)++n;for(;s!==-1&&i[s]>e;)--s;if(++s,n!==0||s!==r){n>=s&&(s=Math.max(s,1),n=s-1);let a=this.getValueSize();this.times=tf(i,n,s),this.values=tf(this.values,n*a,s*a)}return this}validate(){let t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);let i=this.times,r=this.values,n=i.length;n===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let a=0;a!==n;a++){let o=i[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),t=!1;break}if(s!==null&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,s),t=!1;break}s=o}if(r!==void 0&&jse(r))for(let a=0,o=r.length;a!==o;++a){let l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),t=!1;break}}return t}optimize(){let t=tf(this.times),e=tf(this.values),i=this.getValueSize(),r=this.getInterpolation()===o3,n=t.length-1,s=1;for(let a=1;a<n;++a){let o=!1,l=t[a],c=t[a+1];if(l!==c&&(a!==1||l!==t[0]))if(r)o=!0;else{let h=a*i,u=h-i,d=h+i;for(let f=0;f!==i;++f){let p=e[h+f];if(p!==e[u+f]||p!==e[d+f]){o=!0;break}}}if(o){if(a!==s){t[s]=t[a];let h=a*i,u=s*i;for(let d=0;d!==i;++d)e[u+d]=e[h+d]}++s}}if(n>0){t[s]=t[n];for(let a=n*i,o=s*i,l=0;l!==i;++l)e[o+l]=e[a+l];++s}return s!==t.length?(this.times=tf(t,0,s),this.values=tf(e,0,s*i)):(this.times=t,this.values=e),this}clone(){let t=tf(this.times,0),e=tf(this.values,0),i=this.constructor,r=new i(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}};Kh.prototype.TimeBufferType=Float32Array;Kh.prototype.ValueBufferType=Float32Array;Kh.prototype.DefaultInterpolation=S2;var j1=class extends Kh{};j1.prototype.ValueTypeName="bool";j1.prototype.ValueBufferType=Array;j1.prototype.DefaultInterpolation=w2;j1.prototype.InterpolantFactoryMethodLinear=void 0;j1.prototype.InterpolantFactoryMethodSmooth=void 0;var Yse=class extends Kh{};Yse.prototype.ValueTypeName="color";var P2=class extends Kh{};P2.prototype.ValueTypeName="number";var Q3e=class extends DD{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-e)/(r-e),l=t*a;for(let c=l+a;l!==c;l+=4)ri.slerpFlat(n,0,s,l-a,s,l,o);return n}},M_=class extends Kh{InterpolantFactoryMethodLinear(t){return new Q3e(this.times,this.values,this.getValueSize(),t)}};M_.prototype.ValueTypeName="quaternion";M_.prototype.DefaultInterpolation=S2;M_.prototype.InterpolantFactoryMethodSmooth=void 0;var W1=class extends Kh{};W1.prototype.ValueTypeName="string";W1.prototype.ValueBufferType=Array;W1.prototype.DefaultInterpolation=w2;W1.prototype.InterpolantFactoryMethodLinear=void 0;W1.prototype.InterpolantFactoryMethodSmooth=void 0;var D2=class extends Kh{};D2.prototype.ValueTypeName="vector";var zk=class{constructor(t,e=-1,i,r=A5){this.name=t,this.tracks=i,this.duration=e,this.blendMode=r,this.uuid=Nl(),this.duration<0&&this.resetDuration()}static parse(t){let e=[],i=t.tracks,r=1/(t.fps||1);for(let s=0,a=i.length;s!==a;++s)e.push(J3e(i[s]).scale(r));let n=new this(t.name,t.duration,e,t.blendMode);return n.uuid=t.uuid,n}static toJSON(t){let e=[],i=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let n=0,s=i.length;n!==s;++n)e.push(Kh.toJSON(i[n]));return r}static CreateFromMorphTargetSequence(t,e,i,r){let n=e.length,s=[];for(let a=0;a<n;a++){let o=[],l=[];o.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);let c=Y3e(o);o=vX(o,1,c),l=vX(l,1,c),!r&&o[0]===0&&(o.push(n),l.push(l[0])),s.push(new P2(".morphTargetInfluences["+e[a].name+"]",o,l).scale(1/i))}return new this(t,-1,s)}static findByName(t,e){let i=t;if(!Array.isArray(t)){let r=t;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===e)return i[r];return null}static CreateClipsFromMorphTargetSequences(t,e,i){let r={},n=/^([\w-]*?)([\d]+)$/;for(let a=0,o=t.length;a<o;a++){let l=t[a],c=l.name.match(n);if(c&&c.length>1){let h=c[1],u=r[h];u||(r[h]=u=[]),u.push(l)}}let s=[];for(let a in r)s.push(this.CreateFromMorphTargetSequence(a,r[a],e,i));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(c,h,u,d,f){if(u.length!==0){let p=[],m=[];Wse(u,p,m,d),p.length!==0&&f.push(new c(h,p,m))}},r=[],n=t.name||"default",s=t.fps||30,a=t.blendMode,o=t.length||-1,l=t.hierarchy||[];for(let c=0;c<l.length;c++){let h=l[c].keys;if(!(!h||h.length===0))if(h[0].morphTargets){let u={},d;for(d=0;d<h.length;d++)if(h[d].morphTargets)for(let f=0;f<h[d].morphTargets.length;f++)u[h[d].morphTargets[f]]=-1;for(let f in u){let p=[],m=[];for(let g=0;g!==h[d].morphTargets.length;++g){let v=h[d];p.push(v.time),m.push(v.morphTarget===f?1:0)}r.push(new P2(".morphTargetInfluence["+f+"]",p,m))}o=u.length*s}else{let u=".bones["+e[c].name+"]";i(D2,u+".position",h,"pos",r),i(M_,u+".quaternion",h,"rot",r),i(D2,u+".scale",h,"scl",r)}}return r.length===0?null:new this(n,o,r,a)}resetDuration(){let t=this.tracks,e=0;for(let i=0,r=t.length;i!==r;++i){let n=this.tracks[i];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){let t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function $3e(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return P2;case"vector":case"vector2":case"vector3":case"vector4":return D2;case"color":return Yse;case"quaternion":return M_;case"bool":case"boolean":return j1;case"string":return W1}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function J3e(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=$3e(t.type);if(t.times===void 0){let i=[],r=[];Wse(t.keys,i,r,"value"),t.times=i,t.values=r}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}var R2={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},qse=class{constructor(t,e,i){let r=this,n=!1,s=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(c){a++,n===!1&&r.onStart!==void 0&&r.onStart(c,s,a),n=!0},this.itemEnd=function(c){s++,r.onProgress!==void 0&&r.onProgress(c,s,a),s===a&&(n=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return o?o(c):c},this.setURLModifier=function(c){return o=c,this},this.addHandler=function(c,h){return l.push(c,h),this},this.removeHandler=function(c){let h=l.indexOf(c);return h!==-1&&l.splice(h,2),this},this.getHandler=function(c){for(let h=0,u=l.length;h<u;h+=2){let d=l[h],f=l[h+1];if(d.global&&(d.lastIndex=0),d.test(c))return f}return null}}},Z3e=new qse,T_=class{constructor(t){this.manager=t!==void 0?t:Z3e,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){let i=this;return new Promise(function(r,n){i.load(t,r,e,n)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}},vu={},eOe=class extends Error{constructor(t,e){super(t),this.response=e}},Gk=class extends T_{constructor(t){super(t)}load(t,e,i,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);let n=R2.get(t);if(n!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(n),this.manager.itemEnd(t)},0),n;if(vu[t]!==void 0){vu[t].push({onLoad:e,onProgress:i,onError:r});return}vu[t]=[],vu[t].push({onLoad:e,onProgress:i,onError:r});let s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let c=vu[t],h=l.body.getReader(),u=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=u?parseInt(u):0,f=d!==0,p=0,m=new ReadableStream({start(g){v();function v(){h.read().then(({done:y,value:x})=>{if(y)g.close();else{p+=x.byteLength;let S=new ProgressEvent("progress",{lengthComputable:f,loaded:p,total:d});for(let A=0,_=c.length;A<_;A++){let M=c[A];M.onProgress&&M.onProgress(S)}g.enqueue(x),v()}})}}});return new Response(m)}else throw new eOe(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(o){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(c=>new DOMParser().parseFromString(c,a));case"json":return l.json();default:if(a===void 0)return l.text();{let c=/charset="?([^;"\s]*)"?/i.exec(a),h=c&&c[1]?c[1].toLowerCase():void 0,u=new TextDecoder(h);return l.arrayBuffer().then(d=>u.decode(d))}}}).then(l=>{R2.add(t,l);let c=vu[t];delete vu[t];for(let h=0,u=c.length;h<u;h++){let d=c[h];d.onLoad&&d.onLoad(l)}}).catch(l=>{let c=vu[t];if(c===void 0)throw this.manager.itemError(t),l;delete vu[t];for(let h=0,u=c.length;h<u;h++){let d=c[h];d.onError&&d.onError(l)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}},tOe=class extends T_{constructor(t){super(t)}load(t,e,i,r){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);let n=this,s=R2.get(t);if(s!==void 0)return n.manager.itemStart(t),setTimeout(function(){e&&e(s),n.manager.itemEnd(t)},0),s;let a=dS("img");function o(){c(),R2.add(t,this),e&&e(this),n.manager.itemEnd(t)}function l(h){c(),r&&r(h),n.manager.itemError(t),n.manager.itemEnd(t)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(t),a.src=t,a}},iOe=class extends T_{constructor(t){super(t)}load(t,e,i,r){let n=new Kr,s=new tOe(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,function(a){n.image=a,n.needsUpdate=!0,e!==void 0&&e(n)},i,r),n}},C_=class extends Ji{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Xt(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){let e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}},rOe=class extends C_{constructor(t,e,i){super(t,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ji.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Xt(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}},k3=new st,yX=new N,xX=new N,F5=class{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ye(512,512),this.map=null,this.mapPass=null,this.matrix=new st,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new C5,this._frameExtents=new ye(1,1),this._viewportCount=1,this._viewports=[new si(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){let e=this.camera,i=this.matrix;yX.setFromMatrixPosition(t.matrixWorld),e.position.copy(yX),xX.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(xX),e.updateMatrixWorld(),k3.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(k3),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(k3)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}},nOe=class extends F5{constructor(){super(new ua(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){let e=this.camera,i=uS*2*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=t.distance||e.far;(i!==e.fov||r!==e.aspect||n!==e.far)&&(e.fov=i,e.aspect=r,e.far=n,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}},sOe=class extends C_{constructor(t,e,i=0,r=Math.PI/3,n=0,s=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ji.DEFAULT_UP),this.updateMatrix(),this.target=new Ji,this.distance=i,this.angle=r,this.penumbra=n,this.decay=s,this.map=null,this.shadow=new nOe}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},bX=new st,rb=new N,N3=new N,aOe=class extends F5{constructor(){super(new ua(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ye(4,2),this._viewportCount=6,this._viewports=[new si(2,1,1,1),new si(0,1,1,1),new si(3,1,1,1),new si(1,1,1,1),new si(3,0,1,1),new si(1,0,1,1)],this._cubeDirections=[new N(1,0,0),new N(-1,0,0),new N(0,0,1),new N(0,0,-1),new N(0,1,0),new N(0,-1,0)],this._cubeUps=[new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,0,1),new N(0,0,-1)]}updateMatrices(t,e=0){let i=this.camera,r=this.matrix,n=t.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),rb.setFromMatrixPosition(t.matrixWorld),i.position.copy(rb),N3.copy(i.position),N3.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(N3),i.updateMatrixWorld(),r.makeTranslation(-rb.x,-rb.y,-rb.z),bX.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(bX)}},oOe=class extends C_{constructor(t,e,i=0,r=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new aOe}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}},lOe=class extends F5{constructor(){super(new MD(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},cOe=class extends C_{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ji.DEFAULT_UP),this.updateMatrix(),this.target=new Ji,this.shadow=new lOe}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},Kse=class extends Nt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){let t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}},Qse=class extends T_{constructor(t){super(t)}load(t,e,i,r){let n=this,s=new Gk(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(t,function(a){try{e(n.parse(JSON.parse(a)))}catch(o){r?r(o):console.error(o),n.manager.itemError(t)}},i,r)}parse(t){let e={},i={};function r(u,d){if(e[d]!==void 0)return e[d];let f=u.interleavedBuffers[d],p=n(u,f.buffer),m=rM(f.type,p),g=new d3e(m,f.stride);return g.uuid=f.uuid,e[d]=g,g}function n(u,d){if(i[d]!==void 0)return i[d];let f=u.arrayBuffers[d],p=new Uint32Array(f).buffer;return i[d]=p,p}let s=t.isInstancedBufferGeometry?new Kse:new Nt,a=t.data.index;if(a!==void 0){let u=rM(a.type,a.array);s.setIndex(new Yt(u,1))}let o=t.data.attributes;for(let u in o){let d=o[u],f;if(d.isInterleavedBufferAttribute){let p=r(t.data,d.data);f=new kk(p,d.itemSize,d.offset,d.normalized)}else{let p=rM(d.type,d.array),m=d.isInstancedBufferAttribute?fS:Yt;f=new m(p,d.itemSize,d.normalized)}d.name!==void 0&&(f.name=d.name),d.usage!==void 0&&f.setUsage(d.usage),d.updateRange!==void 0&&(f.updateRange.offset=d.updateRange.offset,f.updateRange.count=d.updateRange.count),s.setAttribute(u,f)}let l=t.data.morphAttributes;if(l)for(let u in l){let d=l[u],f=[];for(let p=0,m=d.length;p<m;p++){let g=d[p],v;if(g.isInterleavedBufferAttribute){let y=r(t.data,g.data);v=new kk(y,g.itemSize,g.offset,g.normalized)}else{let y=rM(g.type,g.array);v=new Yt(y,g.itemSize,g.normalized)}g.name!==void 0&&(v.name=g.name),f.push(v)}s.morphAttributes[u]=f}t.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let c=t.data.groups||t.data.drawcalls||t.data.offsets;if(c!==void 0)for(let u=0,d=c.length;u!==d;++u){let f=c[u];s.addGroup(f.start,f.count,f.materialIndex)}let h=t.data.boundingSphere;if(h!==void 0){let u=new N;h.center!==void 0&&u.fromArray(h.center),s.boundingSphere=new wo(u,h.radius)}return t.name&&(s.name=t.name),t.userData&&(s.userData=t.userData),s}},hOe=class{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=wX(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let e=wX();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}};function wX(){return(typeof performance>"u"?Date:performance).now()}var uOe=class{constructor(t,e,i){this.binding=t,this.valueSize=i;let r,n,s;switch(e){case"quaternion":r=this._slerp,n=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,n=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){let i=this.buffer,r=this.valueSize,n=t*r+r,s=this.cumulativeWeight;if(s===0){for(let a=0;a!==r;++a)i[n+a]=i[a];s=e}else{s+=e;let a=e/s;this._mixBufferRegion(i,n,0,a,r)}this.cumulativeWeight=s}accumulateAdditive(t){let e=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){let e=this.valueSize,i=this.buffer,r=t*e+e,n=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){let o=e*this._origIndex;this._mixBufferRegion(i,r,o,1-n,e)}s>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*e,1,e);for(let o=e,l=e+e;o!==l;++o)if(i[o]!==i[o+e]){a.setValue(i,r);break}}saveOriginalState(){let t=this.binding,e=this.buffer,i=this.valueSize,r=i*this._origIndex;t.getValue(e,r);for(let n=i,s=r;n!==s;++n)e[n]=e[r+n%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){let t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,r,n){if(r>=.5)for(let s=0;s!==n;++s)t[e+s]=t[i+s]}_slerp(t,e,i,r){ri.slerpFlat(t,e,t,e,t,i,r)}_slerpAdditive(t,e,i,r,n){let s=this._workIndex*n;ri.multiplyQuaternionsFlat(t,s,t,e,t,i),ri.slerpFlat(t,e,t,e,t,s,r)}_lerp(t,e,i,r,n){let s=1-r;for(let a=0;a!==n;++a){let o=e+a;t[o]=t[o]*s+t[i+a]*r}}_lerpAdditive(t,e,i,r,n){for(let s=0;s!==n;++s){let a=e+s;t[a]=t[a]+t[i+s]*r}}},k5="\\[\\]\\.:\\/",dOe=new RegExp("["+k5+"]","g"),N5="[^"+k5+"]",fOe="[^"+k5.replace("\\.","")+"]",pOe=/((?:WC+[\/:])*)/.source.replace("WC",N5),mOe=/(WCOD+)?/.source.replace("WCOD",fOe),gOe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",N5),vOe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",N5),yOe=new RegExp("^"+pOe+mOe+gOe+vOe+"$"),xOe=["material","materials","bones","map"],bOe=class{constructor(t,e,i){let r=i||lr.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(t,e)}setValue(t,e){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(t,e)}bind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},lr=class{constructor(t,e,i){this.path=e,this.parsedPath=i||lr.parseTrackName(e),this.node=lr.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new lr.Composite(t,e,i):new lr(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(dOe,"")}static parseTrackName(t){let e=yOe.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);let i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){let n=i.nodeName.substring(r+1);xOe.indexOf(n)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){let i=t.skeleton.getBoneByName(e);if(i!==void 0)return i}if(t.children){let i=function(n){for(let s=0;s<n.length;s++){let a=n[s];if(a.name===e||a.uuid===e)return a;let o=i(a.children);if(o)return o}return null},r=i(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)t[e++]=i[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node,e=this.parsedPath,i=e.objectName,r=e.propertyName,n=e.propertyIndex;if(t||(t=lr.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let l=e.objectIndex;switch(i){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let c=0;c<t.length;c++)if(t[c].name===l){l=c;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[i]}if(l!==void 0){if(t[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[l]}}let s=t[r];if(s===void 0){let l=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",t);return}let a=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(n!==void 0){if(r==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[n]!==void 0&&(n=t.morphTargetDictionary[n])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else s.fromArray!==void 0&&s.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};lr.Composite=bOe;lr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};lr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};lr.prototype.GetterByBindingType=[lr.prototype._getValue_direct,lr.prototype._getValue_array,lr.prototype._getValue_arrayElement,lr.prototype._getValue_toArray];lr.prototype.SetterByBindingTypeAndVersioning=[[lr.prototype._setValue_direct,lr.prototype._setValue_direct_setNeedsUpdate,lr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_array,lr.prototype._setValue_array_setNeedsUpdate,lr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_arrayElement,lr.prototype._setValue_arrayElement_setNeedsUpdate,lr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_fromArray,lr.prototype._setValue_fromArray_setNeedsUpdate,lr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var wOe=class{constructor(t,e,i=null,r=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=r;let n=e.tracks,s=n.length,a=new Array(s),o={endingStart:iy,endingEnd:iy};for(let l=0;l!==s;++l){let c=n[l].createInterpolant(null);a[l]=c,c.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=fse,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){let r=this._clip.duration,n=t._clip.duration,s=n/r,a=r/n;t.warp(1,s,e),this.warp(a,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){let t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){let r=this._mixer,n=r.time,s=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=n,o[1]=n+i,l[0]=t/s,l[1]=e/s,this}stopWarping(){let t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,r){if(!this.enabled){this._updateWeight(t);return}let n=this._startTime;if(n!==null){let o=(t-n)*i;o<0||i===0?e=0:(this._startTime=null,e=i*o)}e*=this._updateTimeScale(t);let s=this._updateTime(e),a=this._updateWeight(t);if(a>0){let o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case Q2e:for(let c=0,h=o.length;c!==h;++c)o[c].evaluate(s),l[c].accumulateAdditive(a);break;case A5:default:for(let c=0,h=o.length;c!==h;++c)o[c].evaluate(s),l[c].accumulate(r,a)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;let i=this._weightInterpolant;if(i!==null){let r=i.evaluate(t)[0];e*=r,t>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;let i=this._timeScaleInterpolant;if(i!==null){let r=i.evaluate(t)[0];e*=r,t>i.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){let e=this._clip.duration,i=this.loop,r=this.time+t,n=this._loopCount,s=i===_5;if(t===0)return n===-1?r:s&&(n&1)===1?e-r:r;if(i===dse){n===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=e)r=e;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(n===-1&&(t>=0?(n=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),r>=e||r<0){let a=Math.floor(r/e);r-=e*a,n+=Math.abs(a);let o=this.repetitions-n;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(o===1){let l=t<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(s&&(n&1)===1)return e-r}return r}_setEndings(t,e,i){let r=this._interpolantSettings;i?(r.endingStart=ry,r.endingEnd=ry):(t?r.endingStart=this.zeroSlopeAtStart?ry:iy:r.endingStart=_2,e?r.endingEnd=this.zeroSlopeAtEnd?ry:iy:r.endingEnd=_2)}_scheduleFading(t,e,i){let r=this._mixer,n=r.time,s=this._weightInterpolant;s===null&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=n,o[0]=e,a[1]=n+t,o[1]=i,this}},SOe=new Float32Array(1),_Oe=class extends Js{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){let i=t._localRoot||this._root,r=t._clip.tracks,n=r.length,s=t._propertyBindings,a=t._interpolants,o=i.uuid,l=this._bindingsByRootAndName,c=l[o];c===void 0&&(c={},l[o]=c);for(let h=0;h!==n;++h){let u=r[h],d=u.name,f=c[d];if(f!==void 0)++f.referenceCount,s[h]=f;else{if(f=s[h],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,o,d));continue}let p=e&&e._propertyBindings[h].binding.parsedPath;f=new uOe(lr.create(i,d,p),u.ValueTypeName,u.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,o,d),s[h]=f}a[h].resultBuffer=f.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){let i=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,r,i)}let e=t._propertyBindings;for(let i=0,r=e.length;i!==r;++i){let n=e[i];n.useCount++===0&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){let e=t._propertyBindings;for(let i=0,r=e.length;i!==r;++i){let n=e[i];--n.useCount===0&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){let e=t._cacheIndex;return e!==null&&e<this._nActiveActions}_addInactiveAction(t,e,i){let r=this._actions,n=this._actionsByClip,s=n[e];if(s===void 0)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,n[e]=s;else{let a=s.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=r.length,r.push(t),s.actionByRoot[i]=t}_removeInactiveAction(t){let e=this._actions,i=e[e.length-1],r=t._cacheIndex;i._cacheIndex=r,e[r]=i,e.pop(),t._cacheIndex=null;let n=t._clip.uuid,s=this._actionsByClip,a=s[n],o=a.knownActions,l=o[o.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),t._byClipCacheIndex=null;let h=a.actionByRoot,u=(t._localRoot||this._root).uuid;delete h[u],o.length===0&&delete s[n],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){let e=t._propertyBindings;for(let i=0,r=e.length;i!==r;++i){let n=e[i];--n.referenceCount===0&&this._removeInactiveBinding(n)}}_lendAction(t){let e=this._actions,i=t._cacheIndex,r=this._nActiveActions++,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_takeBackAction(t){let e=this._actions,i=t._cacheIndex,r=--this._nActiveActions,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_addInactiveBinding(t,e,i){let r=this._bindingsByRootAndName,n=this._bindings,s=r[e];s===void 0&&(s={},r[e]=s),s[i]=t,t._cacheIndex=n.length,n.push(t)}_removeInactiveBinding(t){let e=this._bindings,i=t.binding,r=i.rootNode.uuid,n=i.path,s=this._bindingsByRootAndName,a=s[r],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete a[n],Object.keys(a).length===0&&delete s[r]}_lendBinding(t){let e=this._bindings,i=t._cacheIndex,r=this._nActiveBindings++,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_takeBackBinding(t){let e=this._bindings,i=t._cacheIndex,r=--this._nActiveBindings,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_lendControlInterpolant(){let t=this._controlInterpolants,e=this._nActiveControlInterpolants++,i=t[e];return i===void 0&&(i=new Xse(new Float32Array(2),new Float32Array(2),1,SOe),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){let e=this._controlInterpolants,i=t.__cacheIndex,r=--this._nActiveControlInterpolants,n=e[r];t.__cacheIndex=r,e[r]=t,n.__cacheIndex=i,e[i]=n}clipAction(t,e,i){let r=e||this._root,n=r.uuid,s=typeof t=="string"?zk.findByName(r,t):t,a=s!==null?s.uuid:t,o=this._actionsByClip[a],l=null;if(i===void 0&&(s!==null?i=s.blendMode:i=A5),o!==void 0){let h=o.actionByRoot[n];if(h!==void 0&&h.blendMode===i)return h;l=o.knownActions[0],s===null&&(s=l._clip)}if(s===null)return null;let c=new wOe(this,s,e,i);return this._bindAction(c,l),this._addInactiveAction(c,a,n),c}existingAction(t,e){let i=e||this._root,r=i.uuid,n=typeof t=="string"?zk.findByName(i,t):t,s=n?n.uuid:t,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){let t=this._actions,e=this._nActiveActions;for(let i=e-1;i>=0;--i)t[i].stop();return this}update(t){t*=this.timeScale;let e=this._actions,i=this._nActiveActions,r=this.time+=t,n=Math.sign(t),s=this._accuIndex^=1;for(let l=0;l!==i;++l)e[l]._update(r,t,n,s);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){let e=this._actions,i=t.uuid,r=this._actionsByClip,n=r[i];if(n!==void 0){let s=n.knownActions;for(let a=0,o=s.length;a!==o;++a){let l=s[a];this._deactivateAction(l);let c=l._cacheIndex,h=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,h._cacheIndex=c,e[c]=h,e.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}}uncacheRoot(t){let e=t.uuid,i=this._actionsByClip;for(let s in i){let a=i[s].actionByRoot,o=a[e];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}let r=this._bindingsByRootAndName,n=r[e];if(n!==void 0)for(let s in n){let a=n[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(t,e){let i=this.existingAction(t,e);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}},et=class{constructor(t){this.value=t}clone(){return new et(this.value.clone===void 0?this.value:this.value.clone())}},$se=class{constructor(t,e,i=0,r=1/0){this.ray=new G1(t,e),this.near=i,this.far=r,this.camera=null,this.layers=new M5,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return Vk(t,this,i,e),i.sort(SX),i}intersectObjects(t,e=!0,i=[]){for(let r=0,n=t.length;r<n;r++)Vk(t[r],this,i,e);return i.sort(SX),i}};function SX(t,e){return t.distance-e.distance}function Vk(t,e,i,r){if(t.layers.test(e.layers)&&t.raycast(e,i),r===!0){let n=t.children;for(let s=0,a=n.length;s<a;s++)Vk(n[s],e,i,!0)}}var _X=class{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(In(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},AX=new ye,U5=class{constructor(t=new ye(1/0,1/0),e=new ye(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let i=AX.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return AX.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},EX=new N,CM=new N,Ul=class{constructor(t=new N,e=new N){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){EX.subVectors(t,this.start),CM.subVectors(this.end,this.start);let i=CM.dot(CM),r=CM.dot(EX)/i;return e&&(r=In(r,0,1)),r}closestPointToPoint(t,e,i){let r=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},MX=new N,AOe=class extends Ji{constructor(t,e){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";let i=new Nt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let l=s/o*Math.PI*2,c=a/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new bt(r,3));let n=new Op({fog:!1,toneMapped:!1});this.cone=new E_(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),MX.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(MX),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},EOe=class extends vr{constructor(t,e,i){let r=new Ty(e,4,2),n=new pd({wireframe:!0,fog:!1,toneMapped:!1});super(r,n),this.light=t,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},TX=new N,PM=new N,CX=new N,MOe=class extends Ji{constructor(t,e,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",e===void 0&&(e=1);let r=new Nt;r.setAttribute("position",new bt([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));let n=new Op({fog:!1,toneMapped:!1});this.lightPlane=new M2(r,n),this.add(this.lightPlane),r=new Nt,r.setAttribute("position",new bt([0,0,0,0,0,1],3)),this.targetLine=new M2(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),TX.setFromMatrixPosition(this.light.matrixWorld),PM.setFromMatrixPosition(this.light.target.matrixWorld),CX.subVectors(PM,TX),this.lightPlane.lookAt(PM),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(PM),this.targetLine.scale.z=CX.length()}},DM=new N,en=new Lp,I2=class extends E_{constructor(t){let e=new Nt,i=new Op({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(f,p){o(f),o(p)}function o(f){r.push(0,0,0),n.push(0,0,0),s[f]===void 0&&(s[f]=[]),s[f].push(r.length/3-1)}e.setAttribute("position",new bt(r,3)),e.setAttribute("color",new bt(n,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new Xt(16755200),c=new Xt(16711680),h=new Xt(43775),u=new Xt(16777215),d=new Xt(3355443);this.setColors(l,c,h,u,d)}setColors(t,e,i,r,n){let s=this.geometry.getAttribute("color");s.setXYZ(0,t.r,t.g,t.b),s.setXYZ(1,t.r,t.g,t.b),s.setXYZ(2,t.r,t.g,t.b),s.setXYZ(3,t.r,t.g,t.b),s.setXYZ(4,t.r,t.g,t.b),s.setXYZ(5,t.r,t.g,t.b),s.setXYZ(6,t.r,t.g,t.b),s.setXYZ(7,t.r,t.g,t.b),s.setXYZ(8,t.r,t.g,t.b),s.setXYZ(9,t.r,t.g,t.b),s.setXYZ(10,t.r,t.g,t.b),s.setXYZ(11,t.r,t.g,t.b),s.setXYZ(12,t.r,t.g,t.b),s.setXYZ(13,t.r,t.g,t.b),s.setXYZ(14,t.r,t.g,t.b),s.setXYZ(15,t.r,t.g,t.b),s.setXYZ(16,t.r,t.g,t.b),s.setXYZ(17,t.r,t.g,t.b),s.setXYZ(18,t.r,t.g,t.b),s.setXYZ(19,t.r,t.g,t.b),s.setXYZ(20,t.r,t.g,t.b),s.setXYZ(21,t.r,t.g,t.b),s.setXYZ(22,t.r,t.g,t.b),s.setXYZ(23,t.r,t.g,t.b),s.setXYZ(24,e.r,e.g,e.b),s.setXYZ(25,e.r,e.g,e.b),s.setXYZ(26,e.r,e.g,e.b),s.setXYZ(27,e.r,e.g,e.b),s.setXYZ(28,e.r,e.g,e.b),s.setXYZ(29,e.r,e.g,e.b),s.setXYZ(30,e.r,e.g,e.b),s.setXYZ(31,e.r,e.g,e.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0}update(){let t=this.geometry,e=this.pointMap,i=1,r=1;en.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),fn("c",e,t,en,0,0,-1),fn("t",e,t,en,0,0,1),fn("n1",e,t,en,-i,-r,-1),fn("n2",e,t,en,i,-r,-1),fn("n3",e,t,en,-i,r,-1),fn("n4",e,t,en,i,r,-1),fn("f1",e,t,en,-i,-r,1),fn("f2",e,t,en,i,-r,1),fn("f3",e,t,en,-i,r,1),fn("f4",e,t,en,i,r,1),fn("u1",e,t,en,i*.7,r*1.1,-1),fn("u2",e,t,en,-i*.7,r*1.1,-1),fn("u3",e,t,en,0,r*2,-1),fn("cf1",e,t,en,-i,0,1),fn("cf2",e,t,en,i,0,1),fn("cf3",e,t,en,0,-r,1),fn("cf4",e,t,en,0,r,1),fn("cn1",e,t,en,-i,0,-1),fn("cn2",e,t,en,i,0,-1),fn("cn3",e,t,en,0,-r,-1),fn("cn4",e,t,en,0,r,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function fn(t,e,i,r,n,s,a){DM.set(n,s,a).unproject(r);let o=e[t];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,h=o.length;c<h;c++)l.setXYZ(o[c],DM.x,DM.y,DM.z)}}var L2=class extends E_{constructor(t,e=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],n=new Nt;n.setIndex(new Yt(i,1)),n.setAttribute("position",new bt(r,3)),super(n,new Op({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){let e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}},TOe=class extends E_{constructor(t=1){let e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Nt;r.setAttribute("position",new bt(e,3)),r.setAttribute("color",new bt(i,3));let n=new Op({vertexColors:!0,toneMapped:!1});super(r,n),this.type="AxesHelper"}setColors(t,e,i){let r=new Xt,n=this.geometry.attributes.color.array;return r.set(t),r.toArray(n,0),r.toArray(n,3),r.set(e),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},Gu=COe();function COe(){let t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){let c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}let s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,h=0;for(;!(c&8388608);)c<<=1,h-=8388608;c&=-8388609,h+=947912704,s[l]=c|h}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function POe(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=In(t,-65504,65504),Gu.floatView[0]=t;let e=Gu.uint32View[0],i=e>>23&511;return Gu.baseTable[i]+((e&8388607)>>Gu.shiftTable[i])}function DOe(t){let e=t>>10;return Gu.uint32View[0]=Gu.mantissaTable[Gu.offsetTable[e]+(t&1023)]+Gu.exponentTable[e],Gu.floatView[0]}var ROe=Object.freeze({__proto__:null,fromHalfFloat:DOe,toHalfFloat:POe});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:z1}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=z1);var nb=".",z5=Symbol("target"),Jse=Symbol("unsubscribe");function Hk(t){return t instanceof Date||t instanceof Set||t instanceof Map||t instanceof WeakSet||t instanceof WeakMap||ArrayBuffer.isView(t)}function IOe(t){return(typeof t=="object"?t===null:typeof t!="function")||t instanceof RegExp}var bh=Array.isArray;function G5(t){return typeof t=="symbol"}var LOe={after:(t,e)=>bh(t)?t.slice(e.length):e===""?t:t.slice(e.length+1),concat:(t,e)=>bh(t)?(t=[...t],e&&t.push(e),t):e&&e.toString!==void 0?(t!==""&&(t+=nb),G5(e)?t+e.toString():t+e):t,initial:t=>{if(bh(t))return t.slice(0,-1);if(t==="")return t;let e=t.lastIndexOf(nb);return e===-1?"":t.slice(0,e)},last:t=>{if(bh(t))return t[t.length-1]||"";if(t==="")return t;let e=t.lastIndexOf(nb);return e===-1?t:t.slice(e+1)},walk:(t,e)=>{if(bh(t))for(let i of t)e(i);else if(t!==""){let i=0,r=t.indexOf(nb);if(r===-1)e(t);else for(;i<t.length;)r===-1&&(r=t.length),e(t.slice(i,r)),i=r+1,r=t.indexOf(nb,i)}},get(t,e){return this.walk(e,i=>{t&&(t=t[i])}),t}},_l=LOe;function OOe(t){return typeof t=="object"&&typeof t.next=="function"}function BOe(t,e,i,r,n){let s=t.next;if(e.name==="entries")t.next=function(){let a=s.call(this);return a.done===!1&&(a.value[0]=n(a.value[0],e,a.value[0],r),a.value[1]=n(a.value[1],e,a.value[0],r)),a};else if(e.name==="values"){let a=i[z5].keys();t.next=function(){let o=s.call(this);return o.done===!1&&(o.value=n(o.value,e,a.next().value,r)),o}}else t.next=function(){let a=s.call(this);return a.done===!1&&(a.value=n(a.value,e,a.value,r)),a};return t}function PX(t,e,i){return t.isUnsubscribed||e.ignoreSymbols&&G5(i)||e.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in e&&e.ignoreKeys.includes(i)}var FOe=class{constructor(t){this._equals=t,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(t){let e=this._getDescriptorCache(),i=e.get(t);return i===void 0&&(i={},e.set(t,i)),i}_getOwnPropertyDescriptor(t,e){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(t,e);let i=this._getProperties(t),r=i[e];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(t,e),i[e]=r),r}getProxy(t,e,i,r){if(this.isUnsubscribed)return t;let n=t[r],s=n||t;this._pathCache.set(s,e);let a=this._proxyCache.get(s);return a===void 0&&(a=n===void 0?new Proxy(t,i):t,this._proxyCache.set(s,a)),a}getPath(t){return this.isUnsubscribed?void 0:this._pathCache.get(t)}isDetached(t,e){return!Object.is(t,_l.get(e,this.getPath(t)))}defineProperty(t,e,i){return Reflect.defineProperty(t,e,i)?(this.isUnsubscribed||(this._getProperties(t)[e]=i),!0):!1}setProperty(t,e,i,r,n){if(!this._equals(n,i)||!(e in t)){let s=this._getOwnPropertyDescriptor(t,e);return s!==void 0&&"set"in s?Reflect.set(t,e,i,r):Reflect.set(t,e,i)}return!0}deleteProperty(t,e,i){if(Reflect.deleteProperty(t,e)){if(!this.isUnsubscribed){let r=this._getDescriptorCache().get(t);r&&(delete r[e],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(t,e,i){let r=this._getOwnPropertyDescriptor(e,i);return t!==void 0&&r!==void 0&&Object.is(t.value,r.value)&&(t.writable||!1)===(r.writable||!1)&&(t.enumerable||!1)===(r.enumerable||!1)&&(t.configurable||!1)===(r.configurable||!1)&&t.get===r.get&&t.set===r.set}isGetInvariant(t,e){let i=this._getOwnPropertyDescriptor(t,e);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function jk(t){return toString.call(t)==="[object Object]"}function RM(){return!0}function hv(t,e){return t.length!==e.length||t.some((i,r)=>e[r]!==i)}var Zse=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),kOe=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),eae={push:RM,pop:RM,shift:RM,unshift:RM,copyWithin:hv,reverse:hv,sort:hv,splice:hv,flat:hv,fill:hv},NOe=new Set([...Zse,...kOe,...Object.keys(eae)]);function IM(t,e){if(t.size!==e.size)return!0;for(let i of t)if(!e.has(i))return!0;return!1}var tae=["keys","values","entries"],iae=new Set(["has","toString"]),rae={add:IM,clear:IM,delete:IM,forEach:IM},UOe=new Set([...iae,...Object.keys(rae),...tae]);function LM(t,e){if(t.size!==e.size)return!0;let i;for(let[r,n]of t)if(i=e.get(r),i!==n||i===void 0&&!e.has(r))return!0;return!1}var zOe=new Set([...iae,"get"]),nae={set:LM,clear:LM,delete:LM,forEach:LM},GOe=new Set([...zOe,...Object.keys(nae),...tae]),yp=class{constructor(t,e,i,r){this._path=e,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=e===void 0?t:this._shallowClone(t)}static isHandledMethod(t){return Zse.has(t)}_shallowClone(t){let e=t;if(jk(t))e={...t};else if(bh(t))e=[...t];else if(t instanceof Date)e=new Date(t);else if(t instanceof Set)e=new Set([...t].map(i=>this._shallowClone(i)));else if(t instanceof Map){e=new Map;for(let[i,r]of t.entries())e.set(i,this._shallowClone(r))}return this._clonedCache.add(e),e}preferredThisArg(t,e,i,r){return t?(bh(r)?this._onIsChanged=eae[e]:r instanceof Set?this._onIsChanged=rae[e]:r instanceof Map&&(this._onIsChanged=nae[e]),r):i}update(t,e,i){let r=_l.after(t,this._path);if(e!=="length"){let n=this.clone;_l.walk(r,s=>{n&&n[s]&&(this._clonedCache.has(n[s])||(n[s]=this._shallowClone(n[s])),n=n[s])}),this._hasOnValidate&&this._changes.push({path:r,property:e,previous:i}),n&&n[e]&&(n[e]=i)}this._isChanged=!0}undo(t){let e;for(let i=this._changes.length-1;i!==-1;i--)e=this._changes[i],_l.get(t,e.path)[e.property]=e.previous}isChanged(t){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,t)}},DX=class extends yp{static isHandledMethod(t){return NOe.has(t)}},VOe=class extends yp{undo(t){t.setTime(this.clone.getTime())}isChanged(t,e){return!e(this.clone.valueOf(),t.valueOf())}},RX=class extends yp{static isHandledMethod(t){return UOe.has(t)}undo(t){for(let e of this.clone)t.add(e);for(let e of t)this.clone.has(e)||t.delete(e)}},IX=class extends yp{static isHandledMethod(t){return GOe.has(t)}undo(t){for(let[e,i]of this.clone.entries())t.set(e,i);for(let e of t.keys())this.clone.has(e)||t.delete(e)}},HOe=class extends yp{constructor(t,e,i,r){super(void 0,e,i,r),this._arg1=i[0],this._weakValue=t.has(this._arg1)}isChanged(t){return this._weakValue!==t.has(this._arg1)}undo(t){this._weakValue&&!t.has(this._arg1)?t.add(this._arg1):t.delete(this._arg1)}},jOe=class extends yp{constructor(t,e,i,r){super(void 0,e,i,r),this._weakKey=i[0],this._weakHas=t.has(this._weakKey),this._weakValue=t.get(this._weakKey)}isChanged(t){return this._weakValue!==t.get(this._weakKey)}undo(t){let e=t.has(this._weakKey);this._weakHas&&!e?t.set(this._weakKey,this._weakValue):!this._weakHas&&e?t.delete(this._weakKey):this._weakValue!==t.get(this._weakKey)&&t.set(this._weakKey,this._weakValue)}},Iv=class{constructor(t){this._stack=[],this._hasOnValidate=t}static isHandledType(t){return jk(t)||bh(t)||Hk(t)}static isHandledMethod(t,e){return jk(t)?yp.isHandledMethod(e):bh(t)?DX.isHandledMethod(e):t instanceof Set?RX.isHandledMethod(e):t instanceof Map?IX.isHandledMethod(e):Hk(t)}get isCloning(){return this._stack.length>0}start(t,e,i){let r=yp;bh(t)?r=DX:t instanceof Date?r=VOe:t instanceof Set?r=RX:t instanceof Map?r=IX:t instanceof WeakSet?r=HOe:t instanceof WeakMap&&(r=jOe),this._stack.push(new r(t,e,i,this._hasOnValidate))}update(t,e,i){this._stack[this._stack.length-1].update(t,e,i)}preferredThisArg(t,e,i){let{name:r}=t,n=Iv.isHandledMethod(i,r);return this._stack[this._stack.length-1].preferredThisArg(n,r,e,i)}isChanged(t,e,i){return this._stack[this._stack.length-1].isChanged(t,e,i)}undo(t){this._previousClone!==void 0&&this._previousClone.undo(t)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},WOe={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},V5=(t,e,i={})=>{i={...WOe,...i};let r=Symbol("ProxyTarget"),{equals:n,isShallow:s,ignoreDetached:a,details:o}=i,l=new FOe(n),c=typeof i.onValidate=="function",h=new Iv(c),u=(y,x,S,A,_)=>!c||h.isCloning||i.onValidate(_l.concat(l.getPath(y),x),S,A,_)===!0,d=(y,x,S,A)=>{!PX(l,i,x)&&!(a&&l.isDetached(y,t))&&f(l.getPath(y),x,S,A)},f=(y,x,S,A,_)=>{h.isCloning?h.update(y,x,A):e(_l.concat(y,x),S,A,_)},p=y=>y&&(y[r]||y),m=(y,x,S,A)=>IOe(y)||S==="constructor"||s&&!Iv.isHandledMethod(x,S)||PX(l,i,S)||l.isGetInvariant(x,S)||a&&l.isDetached(x,t)?y:(A===void 0&&(A=l.getPath(x)),l.getProxy(y,_l.concat(A,S),g,r)),g={get(y,x,S){if(G5(x)){if(x===r||x===z5)return y;if(x===Jse&&!l.isUnsubscribed&&l.getPath(y).length===0)return l.unsubscribe(),y}let A=Hk(y)?Reflect.get(y,x):Reflect.get(y,x,S);return m(A,y,x)},set(y,x,S,A){S=p(S);let _=y[r]||y,M=_[x];if(n(M,S)&&x in y)return!0;let E=u(y,x,S,M);return E&&l.setProperty(_,x,S,A,M)?(d(y,x,y[x],M),!0):!E},defineProperty(y,x,S){if(!l.isSameDescriptor(S,y,x)){let A=y[x];u(y,x,S.value,A)&&l.defineProperty(y,x,S,A)&&d(y,x,S.value,A)}return!0},deleteProperty(y,x){if(!Reflect.has(y,x))return!0;let S=Reflect.get(y,x),A=u(y,x,void 0,S);return A&&l.deleteProperty(y,x,S)?(d(y,x,void 0,S),!0):!A},apply(y,x,S){let A=x[r]||x;if(l.isUnsubscribed)return Reflect.apply(y,A,S);if((o===!1||o!==!0&&!o.includes(y.name))&&Iv.isHandledType(A)){let _=_l.initial(l.getPath(y)),M=Iv.isHandledMethod(A,y.name);h.start(A,_,S);let E=Reflect.apply(y,h.preferredThisArg(y,x,A),M?S.map(D=>p(D)):S),T=h.isChanged(A,n),C=h.stop();if(Iv.isHandledType(E)&&M&&(x instanceof Map&&y.name==="get"&&(_=_l.concat(_,S[0])),E=l.getProxy(E,_,g)),T){let D={name:y.name,args:S,result:E},B=h.isCloning?_l.initial(_):_,O=h.isCloning?_l.last(_):"";u(_l.get(t,B),O,A,C,D)?f(B,O,A,C,D):h.undo(A)}return(x instanceof Map||x instanceof Set)&&OOe(E)?BOe(E,y,x,_,m):E}return Reflect.apply(y,x,S)}},v=l.getProxy(t,i.pathAsArray?[]:"",g);return e=e.bind(v),c&&(i.onValidate=i.onValidate.bind(v)),v};V5.target=t=>t&&t[z5]||t;V5.unsubscribe=t=>t[Jse]||t;var LX=V5,XOe=typeof global=="object"&&global&&global.Object===Object&&global,sae=XOe,YOe=typeof self=="object"&&self&&self.Object===Object&&self,qOe=sae||YOe||Function("return this")(),zc=qOe,KOe=zc.Symbol,Wl=KOe,aae=Object.prototype,QOe=aae.hasOwnProperty,$Oe=aae.toString,sb=Wl?Wl.toStringTag:void 0;function JOe(t){var e=QOe.call(t,sb),i=t[sb];try{t[sb]=void 0;var r=!0}catch{}var n=$Oe.call(t);return r&&(e?t[sb]=i:delete t[sb]),n}var ZOe=JOe,eBe=Object.prototype,tBe=eBe.toString;function iBe(t){return tBe.call(t)}var rBe=iBe,nBe="[object Null]",sBe="[object Undefined]",OX=Wl?Wl.toStringTag:void 0;function aBe(t){return t==null?t===void 0?sBe:nBe:OX&&OX in Object(t)?ZOe(t):rBe(t)}var n0=aBe;function oBe(t){return t!=null&&typeof t=="object"}var md=oBe,lBe="[object Symbol]";function cBe(t){return typeof t=="symbol"||md(t)&&n0(t)==lBe}var P_=cBe;function hBe(t,e){for(var i=-1,r=t==null?0:t.length,n=Array(r);++i<r;)n[i]=e(t[i],i,t);return n}var oae=hBe,uBe=Array.isArray,Hh=uBe,dBe=1/0,BX=Wl?Wl.prototype:void 0,FX=BX?BX.toString:void 0;function lae(t){if(typeof t=="string")return t;if(Hh(t))return oae(t,lae)+"";if(P_(t))return FX?FX.call(t):"";var e=t+"";return e=="0"&&1/t==-dBe?"-0":e}var fBe=lae,pBe=/\s/;function mBe(t){for(var e=t.length;e--&&pBe.test(t.charAt(e)););return e}var gBe=mBe,vBe=/^\s+/;function yBe(t){return t&&t.slice(0,gBe(t)+1).replace(vBe,"")}var xBe=yBe;function bBe(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Fc=bBe,kX=NaN,wBe=/^[-+]0x[0-9a-f]+$/i,SBe=/^0b[01]+$/i,_Be=/^0o[0-7]+$/i,ABe=parseInt;function EBe(t){if(typeof t=="number")return t;if(P_(t))return kX;if(Fc(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Fc(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=xBe(t);var i=SBe.test(t);return i||_Be.test(t)?ABe(t.slice(2),i?2:8):wBe.test(t)?kX:+t}var NX=EBe;function MBe(t){return t}var cae=MBe,TBe="[object AsyncFunction]",CBe="[object Function]",PBe="[object GeneratorFunction]",DBe="[object Proxy]";function RBe(t){if(!Fc(t))return!1;var e=n0(t);return e==CBe||e==PBe||e==TBe||e==DBe}var hae=RBe,IBe=zc["__core-js_shared__"],U3=IBe,UX=function(){var t=/[^.]+$/.exec(U3&&U3.keys&&U3.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function LBe(t){return!!UX&&UX in t}var OBe=LBe,BBe=Function.prototype,FBe=BBe.toString;function kBe(t){if(t!=null){try{return FBe.call(t)}catch{}try{return t+""}catch{}}return""}var s0=kBe,NBe=/[\\^$.*+?()[\]{}|]/g,UBe=/^\[object .+?Constructor\]$/,zBe=Function.prototype,GBe=Object.prototype,VBe=zBe.toString,HBe=GBe.hasOwnProperty,jBe=RegExp("^"+VBe.call(HBe).replace(NBe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function WBe(t){if(!Fc(t)||OBe(t))return!1;var e=hae(t)?jBe:UBe;return e.test(s0(t))}var XBe=WBe;function YBe(t,e){return t==null?void 0:t[e]}var qBe=YBe;function KBe(t,e){var i=qBe(t,e);return XBe(i)?i:void 0}var a0=KBe,QBe=a0(zc,"WeakMap"),Wk=QBe,zX=Object.create,$Be=function(){function t(){}return function(e){if(!Fc(e))return{};if(zX)return zX(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}}(),JBe=$Be;function ZBe(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}var eFe=ZBe;function tFe(t,e){var i=-1,r=t.length;for(e||(e=Array(r));++i<r;)e[i]=t[i];return e}var iFe=tFe,rFe=800,nFe=16,sFe=Date.now;function aFe(t){var e=0,i=0;return function(){var r=sFe(),n=nFe-(r-i);if(i=r,n>0){if(++e>=rFe)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var oFe=aFe;function lFe(t){return function(){return t}}var cFe=lFe,hFe=function(){try{var t=a0(Object,"defineProperty");return t({},"",{}),t}catch{}}(),O2=hFe,uFe=O2?function(t,e){return O2(t,"toString",{configurable:!0,enumerable:!1,value:cFe(e),writable:!0})}:cae,dFe=uFe,fFe=oFe(dFe),pFe=fFe;function mFe(t,e){for(var i=-1,r=t==null?0:t.length;++i<r&&e(t[i],i,t)!==!1;);return t}var gFe=mFe,vFe=9007199254740991,yFe=/^(?:0|[1-9]\d*)$/;function xFe(t,e){var i=typeof t;return e=e??vFe,!!e&&(i=="number"||i!="symbol"&&yFe.test(t))&&t>-1&&t%1==0&&t<e}var H5=xFe;function bFe(t,e,i){e=="__proto__"&&O2?O2(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}var uae=bFe;function wFe(t,e){return t===e||t!==t&&e!==e}var j5=wFe,SFe=Object.prototype,_Fe=SFe.hasOwnProperty;function AFe(t,e,i){var r=t[e];(!(_Fe.call(t,e)&&j5(r,i))||i===void 0&&!(e in t))&&uae(t,e,i)}var W5=AFe;function EFe(t,e,i,r){var n=!i;i||(i={});for(var s=-1,a=e.length;++s<a;){var o=e[s],l=r?r(i[o],t[o],o,i,t):void 0;l===void 0&&(l=t[o]),n?uae(i,o,l):W5(i,o,l)}return i}var D_=EFe,GX=Math.max;function MFe(t,e,i){return e=GX(e===void 0?t.length-1:e,0),function(){for(var r=arguments,n=-1,s=GX(r.length-e,0),a=Array(s);++n<s;)a[n]=r[e+n];n=-1;for(var o=Array(e+1);++n<e;)o[n]=r[n];return o[e]=i(a),eFe(t,this,o)}}var TFe=MFe,CFe=9007199254740991;function PFe(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=CFe}var X5=PFe;function DFe(t){return t!=null&&X5(t.length)&&!hae(t)}var dae=DFe,RFe=Object.prototype;function IFe(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||RFe;return t===i}var Y5=IFe;function LFe(t,e){for(var i=-1,r=Array(t);++i<t;)r[i]=e(i);return r}var OFe=LFe,BFe="[object Arguments]";function FFe(t){return md(t)&&n0(t)==BFe}var VX=FFe,fae=Object.prototype,kFe=fae.hasOwnProperty,NFe=fae.propertyIsEnumerable,UFe=VX(function(){return arguments}())?VX:function(t){return md(t)&&kFe.call(t,"callee")&&!NFe.call(t,"callee")},q5=UFe;function zFe(){return!1}var GFe=zFe,pae=typeof exports=="object"&&exports&&!exports.nodeType&&exports,HX=pae&&typeof module=="object"&&module&&!module.nodeType&&module,VFe=HX&&HX.exports===pae,jX=VFe?zc.Buffer:void 0,HFe=jX?jX.isBuffer:void 0,jFe=HFe||GFe,B2=jFe,WFe="[object Arguments]",XFe="[object Array]",YFe="[object Boolean]",qFe="[object Date]",KFe="[object Error]",QFe="[object Function]",$Fe="[object Map]",JFe="[object Number]",ZFe="[object Object]",eke="[object RegExp]",tke="[object Set]",ike="[object String]",rke="[object WeakMap]",nke="[object ArrayBuffer]",ske="[object DataView]",ake="[object Float32Array]",oke="[object Float64Array]",lke="[object Int8Array]",cke="[object Int16Array]",hke="[object Int32Array]",uke="[object Uint8Array]",dke="[object Uint8ClampedArray]",fke="[object Uint16Array]",pke="[object Uint32Array]",Tr={};Tr[ake]=Tr[oke]=Tr[lke]=Tr[cke]=Tr[hke]=Tr[uke]=Tr[dke]=Tr[fke]=Tr[pke]=!0;Tr[WFe]=Tr[XFe]=Tr[nke]=Tr[YFe]=Tr[ske]=Tr[qFe]=Tr[KFe]=Tr[QFe]=Tr[$Fe]=Tr[JFe]=Tr[ZFe]=Tr[eke]=Tr[tke]=Tr[ike]=Tr[rke]=!1;function mke(t){return md(t)&&X5(t.length)&&!!Tr[n0(t)]}var gke=mke;function vke(t){return function(e){return t(e)}}var K5=vke,mae=typeof exports=="object"&&exports&&!exports.nodeType&&exports,fw=mae&&typeof module=="object"&&module&&!module.nodeType&&module,yke=fw&&fw.exports===mae,z3=yke&&sae.process,xke=function(){try{var t=fw&&fw.require&&fw.require("util").types;return t||z3&&z3.binding&&z3.binding("util")}catch{}}(),l1=xke,WX=l1&&l1.isTypedArray,bke=WX?K5(WX):gke,gae=bke,wke=Object.prototype,Ske=wke.hasOwnProperty;function _ke(t,e){var i=Hh(t),r=!i&&q5(t),n=!i&&!r&&B2(t),s=!i&&!r&&!n&&gae(t),a=i||r||n||s,o=a?OFe(t.length,String):[],l=o.length;for(var c in t)(e||Ske.call(t,c))&&!(a&&(c=="length"||n&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||H5(c,l)))&&o.push(c);return o}var vae=_ke;function Ake(t,e){return function(i){return t(e(i))}}var yae=Ake,Eke=yae(Object.keys,Object),Mke=Eke,Tke=Object.prototype,Cke=Tke.hasOwnProperty;function Pke(t){if(!Y5(t))return Mke(t);var e=[];for(var i in Object(t))Cke.call(t,i)&&i!="constructor"&&e.push(i);return e}var Dke=Pke;function Rke(t){return dae(t)?vae(t):Dke(t)}var Q5=Rke;function Ike(t){var e=[];if(t!=null)for(var i in Object(t))e.push(i);return e}var Lke=Ike,Oke=Object.prototype,Bke=Oke.hasOwnProperty;function Fke(t){if(!Fc(t))return Lke(t);var e=Y5(t),i=[];for(var r in t)r=="constructor"&&(e||!Bke.call(t,r))||i.push(r);return i}var kke=Fke;function Nke(t){return dae(t)?vae(t,!0):kke(t)}var qm=Nke,Uke=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,zke=/^\w*$/;function Gke(t,e){if(Hh(t))return!1;var i=typeof t;return i=="number"||i=="symbol"||i=="boolean"||t==null||P_(t)?!0:zke.test(t)||!Uke.test(t)||e!=null&&t in Object(e)}var Vke=Gke,Hke=a0(Object,"create"),vS=Hke;function jke(){this.__data__=vS?vS(null):{},this.size=0}var Wke=jke;function Xke(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Yke=Xke,qke="__lodash_hash_undefined__",Kke=Object.prototype,Qke=Kke.hasOwnProperty;function $ke(t){var e=this.__data__;if(vS){var i=e[t];return i===qke?void 0:i}return Qke.call(e,t)?e[t]:void 0}var Jke=$ke,Zke=Object.prototype,eNe=Zke.hasOwnProperty;function tNe(t){var e=this.__data__;return vS?e[t]!==void 0:eNe.call(e,t)}var iNe=tNe,rNe="__lodash_hash_undefined__";function nNe(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=vS&&e===void 0?rNe:e,this}var sNe=nNe;function X1(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}X1.prototype.clear=Wke;X1.prototype.delete=Yke;X1.prototype.get=Jke;X1.prototype.has=iNe;X1.prototype.set=sNe;var XX=X1;function aNe(){this.__data__=[],this.size=0}var oNe=aNe;function lNe(t,e){for(var i=t.length;i--;)if(j5(t[i][0],e))return i;return-1}var RD=lNe,cNe=Array.prototype,hNe=cNe.splice;function uNe(t){var e=this.__data__,i=RD(e,t);if(i<0)return!1;var r=e.length-1;return i==r?e.pop():hNe.call(e,i,1),--this.size,!0}var dNe=uNe;function fNe(t){var e=this.__data__,i=RD(e,t);return i<0?void 0:e[i][1]}var pNe=fNe;function mNe(t){return RD(this.__data__,t)>-1}var gNe=mNe;function vNe(t,e){var i=this.__data__,r=RD(i,t);return r<0?(++this.size,i.push([t,e])):i[r][1]=e,this}var yNe=vNe;function Y1(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}Y1.prototype.clear=oNe;Y1.prototype.delete=dNe;Y1.prototype.get=pNe;Y1.prototype.has=gNe;Y1.prototype.set=yNe;var ID=Y1,xNe=a0(zc,"Map"),yS=xNe;function bNe(){this.size=0,this.__data__={hash:new XX,map:new(yS||ID),string:new XX}}var wNe=bNe;function SNe(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var _Ne=SNe;function ANe(t,e){var i=t.__data__;return _Ne(e)?i[typeof e=="string"?"string":"hash"]:i.map}var LD=ANe;function ENe(t){var e=LD(this,t).delete(t);return this.size-=e?1:0,e}var MNe=ENe;function TNe(t){return LD(this,t).get(t)}var CNe=TNe;function PNe(t){return LD(this,t).has(t)}var DNe=PNe;function RNe(t,e){var i=LD(this,t),r=i.size;return i.set(t,e),this.size+=i.size==r?0:1,this}var INe=RNe;function q1(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}q1.prototype.clear=wNe;q1.prototype.delete=MNe;q1.prototype.get=CNe;q1.prototype.has=DNe;q1.prototype.set=INe;var OD=q1,LNe="Expected a function";function $5(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(LNe);var i=function(){var r=arguments,n=e?e.apply(this,r):r[0],s=i.cache;if(s.has(n))return s.get(n);var a=t.apply(this,r);return i.cache=s.set(n,a)||s,a};return i.cache=new($5.Cache||OD),i}$5.Cache=OD;var ONe=$5,BNe=500;function FNe(t){var e=ONe(t,function(r){return i.size===BNe&&i.clear(),r}),i=e.cache;return e}var kNe=FNe,NNe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,UNe=/\\(\\)?/g,zNe=kNe(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(NNe,function(i,r,n,s){e.push(n?s.replace(UNe,"$1"):r||i)}),e}),GNe=zNe;function VNe(t){return t==null?"":fBe(t)}var HNe=VNe;function jNe(t,e){return Hh(t)?t:Vke(t,e)?[t]:GNe(HNe(t))}var K1=jNe,WNe=1/0;function XNe(t){if(typeof t=="string"||P_(t))return t;var e=t+"";return e=="0"&&1/t==-WNe?"-0":e}var BD=XNe;function YNe(t,e){e=K1(e,t);for(var i=0,r=e.length;t!=null&&i<r;)t=t[BD(e[i++])];return i&&i==r?t:void 0}var xae=YNe;function qNe(t,e){for(var i=-1,r=e.length,n=t.length;++i<r;)t[n+i]=e[i];return t}var J5=qNe,YX=Wl?Wl.isConcatSpreadable:void 0;function KNe(t){return Hh(t)||q5(t)||!!(YX&&t&&t[YX])}var QNe=KNe;function bae(t,e,i,r,n){var s=-1,a=t.length;for(i||(i=QNe),n||(n=[]);++s<a;){var o=t[s];e>0&&i(o)?e>1?bae(o,e-1,i,r,n):J5(n,o):r||(n[n.length]=o)}return n}var $Ne=bae;function JNe(t){var e=t==null?0:t.length;return e?$Ne(t,1):[]}var ZNe=JNe;function eUe(t){return pFe(TFe(t,void 0,ZNe),t+"")}var wae=eUe,tUe=yae(Object.getPrototypeOf,Object),Z5=tUe,iUe="[object Object]",rUe=Function.prototype,nUe=Object.prototype,Sae=rUe.toString,sUe=nUe.hasOwnProperty,aUe=Sae.call(Object);function oUe(t){if(!md(t)||n0(t)!=iUe)return!1;var e=Z5(t);if(e===null)return!0;var i=sUe.call(e,"constructor")&&e.constructor;return typeof i=="function"&&i instanceof i&&Sae.call(i)==aUe}var lUe=oUe;function cUe(t,e,i){var r=-1,n=t.length;e<0&&(e=-e>n?0:n+e),i=i>n?n:i,i<0&&(i+=n),n=e>i?0:i-e>>>0,e>>>=0;for(var s=Array(n);++r<n;)s[r]=t[r+e];return s}var hUe=cUe;function uUe(){this.__data__=new ID,this.size=0}var dUe=uUe;function fUe(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}var pUe=fUe;function mUe(t){return this.__data__.get(t)}var gUe=mUe;function vUe(t){return this.__data__.has(t)}var yUe=vUe,xUe=200;function bUe(t,e){var i=this.__data__;if(i instanceof ID){var r=i.__data__;if(!yS||r.length<xUe-1)return r.push([t,e]),this.size=++i.size,this;i=this.__data__=new OD(r)}return i.set(t,e),this.size=i.size,this}var wUe=bUe;function Q1(t){var e=this.__data__=new ID(t);this.size=e.size}Q1.prototype.clear=dUe;Q1.prototype.delete=pUe;Q1.prototype.get=gUe;Q1.prototype.has=yUe;Q1.prototype.set=wUe;var dC=Q1;function SUe(t,e){return t&&D_(e,Q5(e),t)}var _Ue=SUe;function AUe(t,e){return t&&D_(e,qm(e),t)}var EUe=AUe,_ae=typeof exports=="object"&&exports&&!exports.nodeType&&exports,qX=_ae&&typeof module=="object"&&module&&!module.nodeType&&module,MUe=qX&&qX.exports===_ae,KX=MUe?zc.Buffer:void 0,QX=KX?KX.allocUnsafe:void 0;function TUe(t,e){if(e)return t.slice();var i=t.length,r=QX?QX(i):new t.constructor(i);return t.copy(r),r}var CUe=TUe;function PUe(t,e){for(var i=-1,r=t==null?0:t.length,n=0,s=[];++i<r;){var a=t[i];e(a,i,t)&&(s[n++]=a)}return s}var DUe=PUe;function RUe(){return[]}var Aae=RUe,IUe=Object.prototype,LUe=IUe.propertyIsEnumerable,$X=Object.getOwnPropertySymbols,OUe=$X?function(t){return t==null?[]:(t=Object(t),DUe($X(t),function(e){return LUe.call(t,e)}))}:Aae,eG=OUe;function BUe(t,e){return D_(t,eG(t),e)}var FUe=BUe,kUe=Object.getOwnPropertySymbols,NUe=kUe?function(t){for(var e=[];t;)J5(e,eG(t)),t=Z5(t);return e}:Aae,Eae=NUe;function UUe(t,e){return D_(t,Eae(t),e)}var zUe=UUe;function GUe(t,e,i){var r=e(t);return Hh(t)?r:J5(r,i(t))}var Mae=GUe;function VUe(t){return Mae(t,Q5,eG)}var Xk=VUe;function HUe(t){return Mae(t,qm,Eae)}var Tae=HUe,jUe=a0(zc,"DataView"),Yk=jUe,WUe=a0(zc,"Promise"),qk=WUe,XUe=a0(zc,"Set"),Kk=XUe,JX="[object Map]",YUe="[object Object]",ZX="[object Promise]",eY="[object Set]",tY="[object WeakMap]",iY="[object DataView]",qUe=s0(Yk),KUe=s0(yS),QUe=s0(qk),$Ue=s0(Kk),JUe=s0(Wk),Am=n0;(Yk&&Am(new Yk(new ArrayBuffer(1)))!=iY||yS&&Am(new yS)!=JX||qk&&Am(qk.resolve())!=ZX||Kk&&Am(new Kk)!=eY||Wk&&Am(new Wk)!=tY)&&(Am=function(t){var e=n0(t),i=e==YUe?t.constructor:void 0,r=i?s0(i):"";if(r)switch(r){case qUe:return iY;case KUe:return JX;case QUe:return ZX;case $Ue:return eY;case JUe:return tY}return e});var xS=Am,ZUe=Object.prototype,eze=ZUe.hasOwnProperty;function tze(t){var e=t.length,i=new t.constructor(e);return e&&typeof t[0]=="string"&&eze.call(t,"index")&&(i.index=t.index,i.input=t.input),i}var ize=tze,rze=zc.Uint8Array,F2=rze;function nze(t){var e=new t.constructor(t.byteLength);return new F2(e).set(new F2(t)),e}var tG=nze;function sze(t,e){var i=e?tG(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}var aze=sze,oze=/\w*$/;function lze(t){var e=new t.constructor(t.source,oze.exec(t));return e.lastIndex=t.lastIndex,e}var cze=lze,rY=Wl?Wl.prototype:void 0,nY=rY?rY.valueOf:void 0;function hze(t){return nY?Object(nY.call(t)):{}}var uze=hze;function dze(t,e){var i=e?tG(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}var fze=dze,pze="[object Boolean]",mze="[object Date]",gze="[object Map]",vze="[object Number]",yze="[object RegExp]",xze="[object Set]",bze="[object String]",wze="[object Symbol]",Sze="[object ArrayBuffer]",_ze="[object DataView]",Aze="[object Float32Array]",Eze="[object Float64Array]",Mze="[object Int8Array]",Tze="[object Int16Array]",Cze="[object Int32Array]",Pze="[object Uint8Array]",Dze="[object Uint8ClampedArray]",Rze="[object Uint16Array]",Ize="[object Uint32Array]";function Lze(t,e,i){var r=t.constructor;switch(e){case Sze:return tG(t);case pze:case mze:return new r(+t);case _ze:return aze(t,i);case Aze:case Eze:case Mze:case Tze:case Cze:case Pze:case Dze:case Rze:case Ize:return fze(t,i);case gze:return new r;case vze:case bze:return new r(t);case yze:return cze(t);case xze:return new r;case wze:return uze(t)}}var Oze=Lze;function Bze(t){return typeof t.constructor=="function"&&!Y5(t)?JBe(Z5(t)):{}}var Fze=Bze,kze="[object Map]";function Nze(t){return md(t)&&xS(t)==kze}var Uze=Nze,sY=l1&&l1.isMap,zze=sY?K5(sY):Uze,Gze=zze,Vze="[object Set]";function Hze(t){return md(t)&&xS(t)==Vze}var jze=Hze,aY=l1&&l1.isSet,Wze=aY?K5(aY):jze,Xze=Wze,Yze=1,qze=2,Kze=4,Cae="[object Arguments]",Qze="[object Array]",$ze="[object Boolean]",Jze="[object Date]",Zze="[object Error]",Pae="[object Function]",e4e="[object GeneratorFunction]",t4e="[object Map]",i4e="[object Number]",Dae="[object Object]",r4e="[object RegExp]",n4e="[object Set]",s4e="[object String]",a4e="[object Symbol]",o4e="[object WeakMap]",l4e="[object ArrayBuffer]",c4e="[object DataView]",h4e="[object Float32Array]",u4e="[object Float64Array]",d4e="[object Int8Array]",f4e="[object Int16Array]",p4e="[object Int32Array]",m4e="[object Uint8Array]",g4e="[object Uint8ClampedArray]",v4e="[object Uint16Array]",y4e="[object Uint32Array]",yr={};yr[Cae]=yr[Qze]=yr[l4e]=yr[c4e]=yr[$ze]=yr[Jze]=yr[h4e]=yr[u4e]=yr[d4e]=yr[f4e]=yr[p4e]=yr[t4e]=yr[i4e]=yr[Dae]=yr[r4e]=yr[n4e]=yr[s4e]=yr[a4e]=yr[m4e]=yr[g4e]=yr[v4e]=yr[y4e]=!0;yr[Zze]=yr[Pae]=yr[o4e]=!1;function fC(t,e,i,r,n,s){var a,o=e&Yze,l=e&qze,c=e&Kze;if(i&&(a=n?i(t,r,n,s):i(t)),a!==void 0)return a;if(!Fc(t))return t;var h=Hh(t);if(h){if(a=ize(t),!o)return iFe(t,a)}else{var u=xS(t),d=u==Pae||u==e4e;if(B2(t))return CUe(t,o);if(u==Dae||u==Cae||d&&!n){if(a=l||d?{}:Fze(t),!o)return l?zUe(t,EUe(a,t)):FUe(t,_Ue(a,t))}else{if(!yr[u])return n?t:{};a=Oze(t,u,o)}}s||(s=new dC);var f=s.get(t);if(f)return f;s.set(t,a),Xze(t)?t.forEach(function(g){a.add(fC(g,e,i,g,t,s))}):Gze(t)&&t.forEach(function(g,v){a.set(v,fC(g,e,i,v,t,s))});var p=c?l?Tae:Xk:l?qm:Q5,m=h?void 0:p(t);return gFe(m||t,function(g,v){m&&(v=g,g=t[v]),W5(a,v,fC(g,e,i,v,t,s))}),a}var Rae=fC,x4e=1,b4e=4;function w4e(t){return Rae(t,x4e|b4e)}var FD=w4e,S4e="__lodash_hash_undefined__";function _4e(t){return this.__data__.set(t,S4e),this}var A4e=_4e;function E4e(t){return this.__data__.has(t)}var M4e=E4e;function k2(t){var e=-1,i=t==null?0:t.length;for(this.__data__=new OD;++e<i;)this.add(t[e])}k2.prototype.add=k2.prototype.push=A4e;k2.prototype.has=M4e;var T4e=k2;function C4e(t,e){for(var i=-1,r=t==null?0:t.length;++i<r;)if(e(t[i],i,t))return!0;return!1}var P4e=C4e;function D4e(t,e){return t.has(e)}var R4e=D4e,I4e=1,L4e=2;function O4e(t,e,i,r,n,s){var a=i&I4e,o=t.length,l=e.length;if(o!=l&&!(a&&l>o))return!1;var c=s.get(t),h=s.get(e);if(c&&h)return c==e&&h==t;var u=-1,d=!0,f=i&L4e?new T4e:void 0;for(s.set(t,e),s.set(e,t);++u<o;){var p=t[u],m=e[u];if(r)var g=a?r(m,p,u,e,t,s):r(p,m,u,t,e,s);if(g!==void 0){if(g)continue;d=!1;break}if(f){if(!P4e(e,function(v,y){if(!R4e(f,y)&&(p===v||n(p,v,i,r,s)))return f.push(y)})){d=!1;break}}else if(!(p===m||n(p,m,i,r,s))){d=!1;break}}return s.delete(t),s.delete(e),d}var Iae=O4e;function B4e(t){var e=-1,i=Array(t.size);return t.forEach(function(r,n){i[++e]=[n,r]}),i}var F4e=B4e;function k4e(t){var e=-1,i=Array(t.size);return t.forEach(function(r){i[++e]=r}),i}var N4e=k4e,U4e=1,z4e=2,G4e="[object Boolean]",V4e="[object Date]",H4e="[object Error]",j4e="[object Map]",W4e="[object Number]",X4e="[object RegExp]",Y4e="[object Set]",q4e="[object String]",K4e="[object Symbol]",Q4e="[object ArrayBuffer]",$4e="[object DataView]",oY=Wl?Wl.prototype:void 0,G3=oY?oY.valueOf:void 0;function J4e(t,e,i,r,n,s,a){switch(i){case $4e:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Q4e:return!(t.byteLength!=e.byteLength||!s(new F2(t),new F2(e)));case G4e:case V4e:case W4e:return j5(+t,+e);case H4e:return t.name==e.name&&t.message==e.message;case X4e:case q4e:return t==e+"";case j4e:var o=F4e;case Y4e:var l=r&U4e;if(o||(o=N4e),t.size!=e.size&&!l)return!1;var c=a.get(t);if(c)return c==e;r|=z4e,a.set(t,e);var h=Iae(o(t),o(e),r,n,s,a);return a.delete(t),h;case K4e:if(G3)return G3.call(t)==G3.call(e)}return!1}var Z4e=J4e,e5e=1,t5e=Object.prototype,i5e=t5e.hasOwnProperty;function r5e(t,e,i,r,n,s){var a=i&e5e,o=Xk(t),l=o.length,c=Xk(e),h=c.length;if(l!=h&&!a)return!1;for(var u=l;u--;){var d=o[u];if(!(a?d in e:i5e.call(e,d)))return!1}var f=s.get(t),p=s.get(e);if(f&&p)return f==e&&p==t;var m=!0;s.set(t,e),s.set(e,t);for(var g=a;++u<l;){d=o[u];var v=t[d],y=e[d];if(r)var x=a?r(y,v,d,e,t,s):r(v,y,d,t,e,s);if(!(x===void 0?v===y||n(v,y,i,r,s):x)){m=!1;break}g||(g=d=="constructor")}if(m&&!g){var S=t.constructor,A=e.constructor;S!=A&&"constructor"in t&&"constructor"in e&&!(typeof S=="function"&&S instanceof S&&typeof A=="function"&&A instanceof A)&&(m=!1)}return s.delete(t),s.delete(e),m}var n5e=r5e,s5e=1,lY="[object Arguments]",cY="[object Array]",OM="[object Object]",a5e=Object.prototype,hY=a5e.hasOwnProperty;function o5e(t,e,i,r,n,s){var a=Hh(t),o=Hh(e),l=a?cY:xS(t),c=o?cY:xS(e);l=l==lY?OM:l,c=c==lY?OM:c;var h=l==OM,u=c==OM,d=l==c;if(d&&B2(t)){if(!B2(e))return!1;a=!0,h=!1}if(d&&!h)return s||(s=new dC),a||gae(t)?Iae(t,e,i,r,n,s):Z4e(t,e,l,i,r,n,s);if(!(i&s5e)){var f=h&&hY.call(t,"__wrapped__"),p=u&&hY.call(e,"__wrapped__");if(f||p){var m=f?t.value():t,g=p?e.value():e;return s||(s=new dC),n(m,g,i,r,s)}}return d?(s||(s=new dC),n5e(t,e,i,r,n,s)):!1}var l5e=o5e;function Lae(t,e,i,r,n){return t===e?!0:t==null||e==null||!md(t)&&!md(e)?t!==t&&e!==e:l5e(t,e,i,r,Lae,n)}var c5e=Lae;function h5e(t,e){return t!=null&&e in Object(t)}var u5e=h5e;function d5e(t,e,i){e=K1(e,t);for(var r=-1,n=e.length,s=!1;++r<n;){var a=BD(e[r]);if(!(s=t!=null&&i(t,a)))break;t=t[a]}return s||++r!=n?s:(n=t==null?0:t.length,!!n&&X5(n)&&H5(a,n)&&(Hh(t)||q5(t)))}var f5e=d5e;function p5e(t,e){return t!=null&&f5e(t,e,u5e)}var m5e=p5e,g5e=function(){return zc.Date.now()},V3=g5e,v5e="Expected a function",y5e=Math.max,x5e=Math.min;function b5e(t,e,i){var r,n,s,a,o,l,c=0,h=!1,u=!1,d=!0;if(typeof t!="function")throw new TypeError(v5e);e=NX(e)||0,Fc(i)&&(h=!!i.leading,u="maxWait"in i,s=u?y5e(NX(i.maxWait)||0,e):s,d="trailing"in i?!!i.trailing:d);function f(_){var M=r,E=n;return r=n=void 0,c=_,a=t.apply(E,M),a}function p(_){return c=_,o=setTimeout(v,e),h?f(_):a}function m(_){var M=_-l,E=_-c,T=e-M;return u?x5e(T,s-E):T}function g(_){var M=_-l,E=_-c;return l===void 0||M>=e||M<0||u&&E>=s}function v(){var _=V3();if(g(_))return y(_);o=setTimeout(v,m(_))}function y(_){return o=void 0,d&&r?f(_):(r=n=void 0,a)}function x(){o!==void 0&&clearTimeout(o),c=0,r=l=n=o=void 0}function S(){return o===void 0?a:y(V3())}function A(){var _=V3(),M=g(_);if(r=arguments,n=this,l=_,M){if(o===void 0)return p(l);if(u)return clearTimeout(o),o=setTimeout(v,e),f(l)}return o===void 0&&(o=setTimeout(v,e)),a}return A.cancel=x,A.flush=S,A}var bS=b5e;function w5e(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}var S5e=w5e;function _5e(t,e){return t>e}var A5e=_5e;function E5e(t,e){return e.length<2?t:xae(t,hUe(e,0,-1))}var M5e=E5e;function T5e(t,e){return c5e(t,e)}var iG=T5e;function C5e(t,e,i){for(var r=-1,n=t.length;++r<n;){var s=t[r],a=e(s);if(a!=null&&(o===void 0?a===a&&!P_(a):i(a,o)))var o=a,l=s}return l}var P5e=C5e;function D5e(t){return t&&t.length?P5e(t,cae,A5e):void 0}var R5e=D5e;function I5e(t,e){return e=K1(e,t),t=M5e(t,e),t==null||delete t[BD(S5e(e))]}var L5e=I5e;function O5e(t){return lUe(t)?void 0:t}var B5e=O5e,F5e=1,k5e=2,N5e=4,U5e=wae(function(t,e){var i={};if(t==null)return i;var r=!1;e=oae(e,function(s){return s=K1(s,t),r||(r=s.length>1),s}),D_(t,Tae(t),i),r&&(i=Rae(i,F5e|k5e|N5e,B5e));for(var n=e.length;n--;)L5e(i,e[n]);return i}),Qk=U5e;function z5e(t,e,i,r){if(!Fc(t))return t;e=K1(e,t);for(var n=-1,s=e.length,a=s-1,o=t;o!=null&&++n<s;){var l=BD(e[n]),c=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return t;if(n!=a){var h=o[l];c=r?r(h,l,o):void 0,c===void 0&&(c=Fc(h)?h:H5(e[n+1])?[]:{})}W5(o,l,c),o=o[l]}return t}var G5e=z5e;function V5e(t,e,i){for(var r=-1,n=e.length,s={};++r<n;){var a=e[r],o=xae(t,a);i(o,a)&&G5e(s,K1(a,t),o)}return s}var H5e=V5e;function j5e(t,e){return H5e(t,e,function(i,r){return m5e(t,r)})}var W5e=j5e,X5e=wae(function(t,e){return t==null?{}:W5e(t,e)}),Oh=X5e,Y5e="Expected a function";function q5e(t,e,i){var r=!0,n=!0;if(typeof t!="function")throw new TypeError(Y5e);return Fc(i)&&(r="leading"in i?!!i.leading:r,n="trailing"in i?!!i.trailing:n),bS(t,e,{leading:r,maxWait:e,trailing:n})}var K5e=q5e;function Oae(t){for(let e of Object.keys(t))t[e]===void 0&&delete t[e];return t}function Xl(t,e){return Object.setPrototypeOf(t,e),t}var Q5e=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),$5e=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),J5e=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||kD&&"ontouchend"in document,Z5e=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,eGe=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,tGe=()=>{if(typeof window>"u")return!1;let t=navigator.userAgent,e=navigator.vendor;return/Safari/i.test(t)&&/Apple Computer/.test(e)},iGe=()=>{if(typeof window>"u")return null;let t=navigator.userAgent.match(/Version\/(\d+\.\d)/);return t&&t[1]},rGe=()=>{if(typeof window>"u")return;let t=new URLSearchParams(window.location.search).get("desktop-app-version");return t?(window.localStorage.setItem("desktop-app-version",t),t):window.localStorage.getItem("desktop-app-version")??"0.0.6"},Bae=Q5e();Bae&&rGe();var kD=$5e(),R_=J5e(),nGe=Z5e(),No=eGe(),uY=tGe(),sGe=Number(iGe());function Fae(t){return Array.isArray(t)?t:[t]}function kae(t,e){let i=0;for(;i<t.length&&i<e.length;){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1;i+=1}return i!==e.length?-1:i!==t.length?1:0}function BM(t){return kD?t.metaKey:t.ctrlKey}function aGe(t){return t.wheelDeltaY===0||t.deltaY===0?kD&&t.shiftKey&&Math.abs(t.wheelDeltaX)>=120?!1:t.wheelDeltaX?t.wheelDeltaX===-3*t.deltaX||t.wheelDeltaX===-3*window.devicePixelRatio*t.deltaX:t.deltaMode===0:t.wheelDeltaY?t.wheelDeltaY===-3*t.deltaY||t.wheelDeltaY===-3*window.devicePixelRatio*t.deltaY:t.deltaMode===0}var $t=[],N2={},Bb={},pC={};function Nae(t){$t.includes(t)||$t.push(t)}function Cy(t){delete N2[t.pointerId];for(let e=0;e<$t.length;e++)if($t[e].pointerId===t.pointerId){$t.splice(e,1);break}}function oGe(){$t.splice(0,$t.length)}function U2(t){if(t.pointerType!=="touch")return;let e=N2[t.pointerId];e===void 0&&(e={x:0,y:0},N2[t.pointerId]=e),e.x=t.pageX,e.y=t.pageY}function H3(t){let e=t.pointerId===$t[0].pointerId?$t[1]:$t[0];return N2[e.pointerId]}function Uae(t){Bb[t.key]=!0,pC[t.key]=pC[t.key]===void 0?1:pC[t.key]+1}function zae(t){if(kD&&Bb.Meta)for(let e in Bb)Bb[e]=!1;else Bb[t.key]=!1;pC={}}function lGe(t){t.addEventListener("pointerdown",Nae,!0),t.addEventListener("pointerdown",U2,!0),t.addEventListener("pointermove",U2,!0),t.addEventListener("pointerup",Cy,!0),t.addEventListener("pointercancel",Cy,!0),t.addEventListener("pointerleave",Cy,!0),window.addEventListener("keydown",Uae,!0),window.addEventListener("keyup",zae,!0)}function cGe(t){t.removeEventListener("pointerdown",Nae,!0),t.removeEventListener("pointerdown",U2,!0),t.removeEventListener("pointermove",U2,!0),t.removeEventListener("pointerup",Cy,!0),t.removeEventListener("pointercancel",Cy,!0),t.removeEventListener("pointerleave",Cy,!0),window.removeEventListener("keydown",Uae,!0),window.removeEventListener("keyup",zae,!0)}var Gae,hGe=new Promise(t=>{Gae=t}),FM;function uGe(){if(FM)return FM;async function t(){let e="https://unpkg.com/@splinetool/navmesh-wasm@1.9.82/build",i=Td(()=>import("./navmesh-BFd9Mv4x.js"),[]),[r,n]=await Promise.all([i,fetch(`${e}/navmesh.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});Gae(a)}return FM=t(),FM}var Vae,dGe=new Promise(t=>{Vae=t}),kM;function fGe(){if(kM)return kM;async function t(){let e=await Td(()=>import("./physics-BM4kW-A5.js"),[]);await e.init(),Vae(e)}return kM=t(),kM}var Wt=class{modifyById(t,e){let i=this;if(i[t]===void 0)throw new Error("not expected");{let r={...i,[t]:e};return Object.setPrototypeOf(r,Wt.prototype),r}}add(t,e){var i;return((i=this.runOp({type:1,id:t,data:e}))==null?void 0:i.data)??this}runOp(t){let e=this;if(t.type===1){let i=e[t.id],r;i===void 0?r={type:2,id:t.id}:r={type:1,id:t.id,data:i};let{id:n,data:s}=t,a={...e,[n]:s};return Object.setPrototypeOf(a,Wt.prototype),{data:a,actual:t,reverse:r}}else if(t.type===2){let{id:i}=t,r=e[i];if(r===void 0)return null;{let n={...e};return Object.setPrototypeOf(n,Wt.prototype),delete n[i],{data:n,actual:t,reverse:{type:1,id:i,data:r}}}}return null}};function rG(t){if(t.deepFreeze!==void 0){t.deepFreeze(t);return}let e=Object.getOwnPropertyNames(t);for(let i of e){let r=t[i];r&&typeof r=="object"&&rG(r)}return Object.freeze(t)}function pGe(t,e){let i=0;for(;i<t.length&&i<e.length;){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1;i+=1}return i!==e.length?-1:i!==t.length?1:0}var Hae=class extends Error{};function j3(t){let e={...t};return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),e}function If(t,e,i){if(t===void 0?e===void 0?(t=0,e=10):t=e-10:e===void 0&&(e=t+10),t>e){let s=t;t=e,e=s}let r=[],n=1/(i+1);for(let s=0;s<i;s++){let a=t+(e-t)*(s+.75+Math.random()*.5)*n;r.push(a)}return r}function nG(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array}function mGe(){return typeof process<"u"}function jae(t,e){for(let i of t)e(i.id,i.data)!==!0&&jae(i.children,e)}function Wae(t,e){if(e(t.id,t.data)!==!0)for(let i of t.children)Wae(i,e)}var Xs=class extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,Xs.prototype)}deepFreeze(){let t=0;for(;t<this.length;)rG(this[t]),t++}fillCaches0(t,e){this.objCaches.set(t.id,t),this.parentCaches.set(t.id,e);for(let i of t.children)this.fillCaches0(i,t.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let t of this)this.fillCaches0(t,null)}}randomId(){this.fillCaches();let t=Array.from(this.objCaches.keys());if(t.length!==0)return t[Math.max(0,Math.floor(Math.random()*t.length)-1)]}nonExistOrDescendantOf(t,e){if(!this.has(t))return!0;for(;t;){let i=this.parent(t);if(i===e)return!0;t=i}return!1}rootAcestor(t){for(;t;){let e=this.parent(t);if(e)t=e;else return t}return t}isDescendantOf(t,e){for(;t;){let i=this.parent(t);if(i===e)return!0;t=i}return!1}data(t){var e;return(e=this.get(t))==null?void 0:e.data}has(t){return this.childrenOf(t)!==void 0}get(t){return this.fillCaches(),this.objCaches.get(t)}childrenOf(t){var e;return t===null?this:(e=this.get(t))==null?void 0:e.children}traverseFrom(t,e){if(t===null)this.traverse(e);else{let i=this.get(t);i&&Wae(i,e)}}traverse(t){jae(this,t)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(t){return this.fillCaches(),this.parentCaches.get(t)}childrenArray(t){return t===null?this:this.get(t).children}modifyById(t,e){if(this.get(t)===void 0)throw new Error("not expected");{let i=this.parent(t),r=this.childrenArray(i),n=r.findIndex(a=>a.id===t);if(n<0)throw new Error("not expected");let s=r[n];return r=[...r],r[n]={...s,data:e},this.modifyArrayBy(i,r)}}modifyArrayBy(t,e){let i=t,r=e;for(;i!==null;){let s=r,a=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let o=r.findIndex(l=>l.id===a);if(o<0)throw new Error;r=[...r],r[o]={...r[o],children:s}}Object.setPrototypeOf(r,Xs.prototype);let n=r;return n.fillCaches(),n}runOp(t){switch(t.type){case 7:return this.addOp(t);case 8:return this.deleteOp(t);case 9:return this.moveOp(t)}return null}checkDuplicatedIdRec({id:t,children:e}){if(this.get(t)!==void 0)return!0;for(let i of e)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(t){let{parent:e,fi:i,id:r,data:n,children:s}=t;if(e!==null&&this.get(e)===void 0||this.checkDuplicatedIdRec(t))return null;{let a=e,o=this.childrenArray(a),l={fi:i,id:r,data:n,children:s};return o=[...o,l],o.sort((c,h)=>c.fi-h.fi),t.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:t,reverse:{type:8,id:r}}}}deleteOp(t){let{id:e}=t;if(this.get(e)===null)return null;{let i=this.parent(e);if(i===void 0)return null;let r=this.childrenArray(i),n=r.findIndex(a=>a.id===e);t.localIndex=n,r=[...r];let s=r.splice(n,1)[0];return{data:this.modifyArrayBy(i,r),actual:t,reverse:{type:7,...s,parent:i}}}}moveOp(t){let{parent:e,fi:i,id:r}=t;if(e!==null&&this.get(e)===void 0)return this.deleteOp({type:8,id:r});if(e!==null){let u=e;for(;u!==null;){if(u===void 0)throw new Error;if(u===r)throw new Hae("cyclic tree");u=this.parent(u)}}let n=this.parent(r);if(n===void 0)return null;let s=n,a=this.childrenArray(n),o=a.findIndex(u=>u.id===r);a=[...a];let l=a.splice(o,1)[0],c=this.modifyArrayBy(n,a);n=e,a=c.childrenArray(n);let h=l.fi;return l={...l,fi:i},a=[...a,l],a.sort((u,d)=>u.fi-d.fi),t.localIndex=a.indexOf(l),c=c.modifyArrayBy(n,a),{data:c,actual:t,reverse:{type:9,parent:s,fi:h,id:r}}}previous(t,e){if(e===null){let r=this.childrenArray(t);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(t)){if(r.id===e)return i;i=r.id}return null}traverseSortNext(t){let e=this.parent(t);if(e!==void 0){let i=this.childrenArray(e),r=i.findIndex(n=>n.id===t)+1;if(r<i.length)return i[r].id;if(e)return this.traverseSortNext(e)}}sortNext(t){let e=this.childrenArray(t);return e.length>0?e[0].id:this.traverseSortNext(t)}traverseSortPrevious(t){let e=this.childrenArray(t);return e.length>0?this.traverseSortPrevious(e[e.length-1].id):t}sortPrevious(t){let e=this.parent(t);if(e!==void 0){let i=this.childrenArray(e),r=i.findIndex(n=>n.id===t)-1;return r>=0?this.traverseSortPrevious(i[r].id):e}}getAllSorted(t){let e=[];for(let i of t){let r=this.getWithSortKey(i.id);r!==void 0&&e.push({...i,...r})}e.sort((i,r)=>pGe(i.sortKey,r.sortKey));for(let i of e)delete i.sortKey;return e}getWithSortKey(t){var e=t;let i=[],r=this.get(e),n=r;if(r!==void 0){for(;e;)i.splice(0,0,r.fi),e=this.parent(e),e!==null&&(r=this.get(e));return{...n,sortKey:i}}}insertBeforeHelper(t,e,i){return this.insertAfterHelper(t,this.previous(t,e),i)}insertAfterHelper(t,e,i){let r=this.childrenArray(t);if(e===null){if(r.length===0)return If(0,i,i);{let n=r[0].fi;return If(n-i,n,i)}}else{let n=this.get(e);if(n===void 0||this.parent(e)!==t)throw new Error("illegal args");let s=r.find(a=>a.fi>n.fi);if(s===void 0){let a=r[r.length-1].fi;return If(a,a+i,i)}else return If(n.fi,s.fi,i)}}},z2;(t=>{function e(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let n=r.props,s={},a=[...i],o=!1;if(n)for(let l of Object.keys(n)){let c=parseInt(l);if(isNaN(c))throw new Error("wrong index");s[l]=a[c],a[c]=n[l],o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}else{let n=r.props,s={},a={...i},o=!1;if(n)for(let l of Object.keys(n)){s[l]=a[l];let c=n[l];c===void 0?delete a[l]:a[l]=c,o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}}t.runOp=e})(z2||(z2={}));var Ut=class extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,Ut.prototype)}deepFreeze(){let t=0;for(;t<this.length;)rG(this[t]),t++}fillCaches0(t){this.objCaches.set(t.id,t)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let t of this)this.fillCaches0(t)}}randomId(){this.fillCaches();let t=Array.from(this.objCaches.keys());if(t.length!==0)return t[Math.max(0,Math.floor(Math.random()*t.length)-1)]}data(t){var e;return(e=this.get(t))==null?void 0:e.data}get(t){return this.fillCaches(),this.objCaches.get(t)}modifyById(t,e){if(this.get(t)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(s=>s.id===t);if(r<0)throw new Error("not expected");let n=i[r];return i=[...i],i[r]={...n,data:e},this.modifyArrayBy(i)}}modifyArrayBy(t){Object.setPrototypeOf(t,Ut.prototype);let e=t;return mGe()||e.fillCaches(),e}runOp(t){switch(t.type){case 4:return this.addOp(t);case 5:return this.deleteOp(t);case 6:return this.moveOp(t)}return null}addOp(t){let{fi:e,id:i,data:r}=t,n=this,s={fi:e,id:i,data:r};return n=[...n,s],n.sort((a,o)=>a.fi-o.fi),t.localIndex=n.indexOf(s),{data:this.modifyArrayBy(n),actual:t,reverse:{type:5,id:i}}}deleteOp(t){let{id:e}=t,i=this,r=i.findIndex(s=>s.id===e);if(r===-1)return null;t.localIndex=r,i=[...i];let n=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:t,reverse:{type:4,...n}}}moveOp(t){let{fi:e,id:i}=t,r=this;r=[...r];let n=r.findIndex(o=>o.id===i);if(n===-1)return null;let s=r[n].fi,a={...r[n],fi:e};return r[n]=a,r.sort((o,l)=>o.fi-l.fi),t.localIndex=r.indexOf(a),{data:this.modifyArrayBy(r),actual:t,reverse:{type:6,fi:s,id:i}}}previous(t){if(t===null)return this.length===0?null:this[this.length-1].id;let e=null;for(let i of this){if(i.id===t)return e;e=i.id}return null}insertBeforeHelper(t,e){return this.insertAfterHelper(this.previous(t),e)}insertAfterHelper(t,e){let i=this;if(t===null){if(i.length===0)return If(0,e,e);{let r=i[0].fi;return If(r-e,r,e)}}else{let r=this.get(t);if(r===void 0)throw new Error("illegal args");let n=i.find(s=>s.fi>r.fi);if(n===void 0){let s=i[i.length-1].fi;return If(s,s+e,e)}else return If(r.fi,n.fi,e)}}};function c1(t){return t&&typeof t=="object"&&t instanceof Un}var Un=class{unusedFunOverridesTable(t){}runOp(t){let e=[],i=this,r=0,n={};for(;r<t.path.length;){if(e.push(i),i=i===void 0?void 0:i[t.path[r]],i!==void 0&&!c1(i))return null;r+=1}i=i?j3(i):new Un;for(let[o,l]of Object.entries(t.props)){let c=i[o];n[o]=c,l===void 0?delete i[o]:i[o]=l}for(;r>0;){if(Object.keys(i).length===0){let o=e[r-1];o&&(i=j3(o),delete i[t.path[r-1]])}else{let o=e[r-1];if(o){let l=j3(o);l[t.path[r-1]]=i,i=l}else{let l=new Un;l[t.path[r-1]]=i,i=l}}r-=1}let s=Object.setPrototypeOf(i,Un.prototype),a={...t,props:n};return{data:s,actual:t,reverse:a}}},ep;(t=>{function e(n,s){return wS(n,s)??n}t.apply=e;function i(n,s){return aG(n,s)}t.merge=i;function r(n,s){let a=0,o=s.path,l=n;for(;a<o.length&&l!==void 0;){if(l=es.zoomOnce(l,o[a]),l===void 0)return s;if(!c1(l))return;a+=1}if(l===void 0)return s;if(c1(l))if(s.type===0){let c={...s.props};for(let h of Object.keys(l))delete c[h];return{...s,props:c}}else if(s.type===1||s.type===4||s.type===7){let c=sG([s],l);return c?(console.log(c),c):s}else return s}t.filterOp=r})(ep||(ep={}));function sG(t,e){if(e===void 0)return;let i=!1,r=t.map(n=>{let s=n.id,a=wS(n.data,e[s]);if(i=i||a!==void 0,a===void 0&&(a=n.data),n.children){let o=sG(n.children,e);return o!==void 0?i=!0:o=n.children,{...n,id:s,data:a,children:o}}else return{...n,id:s,data:a}});if(i)return r}function gGe(t,e){if(e===void 0)return;let i=!1,r=t.map(n=>{let s=n.id,a=wS(n.data,e[s]);return i=i||a!==void 0,a===void 0&&(a=n.data),{...n,id:s,data:a}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r}function wS(t,e){if(!c1(e))return e;if(t instanceof Xs){let i=sG(t,e);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i}else{if(t instanceof Ut)return gGe(t,e);if(Array.isArray(t)){let i=!1,r=t.map((n,s)=>{let a=wS(n,e[s]);return i=i||a!==void 0,a===void 0&&(a=n),a});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r):void 0}else{if(t instanceof Un)return aG(t,e);if(t&&typeof t=="object"){let i={},r=!1;for(let[n,s]of Object.entries(t)){let a=wS(s,e[n]);r=r||a!==void 0,a===void 0&&(a=s),i[n]=a}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i):void 0}}}}function aG(t,e){if(t===void 0)return e;if(e===void 0)return t;if(!c1(e))return e;if(!c1(t))return ep.apply(t,e);let i=new Set;for(let n of Object.keys(t))i.add(n);for(let n of Object.keys(e))i.add(n);let r=new Un;for(let n of i){let s=aG(t===void 0?void 0:t[n],e===void 0?void 0:e[n]);r[n]=s}return r}function vGe(t,e){let i={cur:[],result:[],len:0};return t=SS(t,e,i)??t,[t,i.result]}function G2(t,e){return t===null?null:(t.cur[t.len]=e,t.len+=1,t)}function V2(t){t&&(t.len-=1)}function yGe(t){if(t===null)return null;t.result.push(t.cur.slice(0,t.len))}function Xae(t,e,i){let r=!1,n=t.map(s=>{let a=s.id,o=e[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=SS(s.data,e,G2(i,a));V2(i),r=r||l!==void 0,l===void 0&&(l=s.data);let c=Xae(s.children,e,i);return c!==void 0?r=!0:c=s.children,{...s,id:a,data:l,children:c}});if(r)return n}function xGe(t,e,i){let r=!1,n=t.map(s=>{let a=s.id,o=e[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=SS(s.data,e,G2(i,a));return V2(i),r=r||l!==void 0,l===void 0&&(l=s.data),{...s,id:a,data:l}});if(r)return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),n}function SS(t,e,i){if(t instanceof Xs){let r=Xae(t,e,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r}else{if(t instanceof Ut)return xGe(t,e,i);if(Array.isArray(t)){let r=!1,n=t.map((s,a)=>{let o=SS(s,e,G2(i,a));return V2(i),r=r||o!==void 0,o===void 0&&(o=s),o});return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(t)),n):void 0}else if(t&&typeof t=="object"&&!nG(t)){let r={},n=!1;for(let[s,a]of Object.entries(t))if(s!=="name"&&s!=="variableId"){let o=e[s];if(typeof o=="string"){if(i!==null)throw new Error("not supported");n=!0,s=o}let l=SS(a,e,G2(i,s));V2(i),n=n||l!==void 0,l===void 0&&(l=a),r[s]=l}else r[s]=a;return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r):void 0}else if(typeof t=="string"){let r=e[t];return r!==void 0&&yGe(i),r}else return}}var H2;(t=>{function e(i,r){let n=es.zoom(r,i.path);if(typeof n=="object"){let s={};for(let a of Object.keys(i.props))s[a]=n[a];return{...i,props:s}}else return{...i,props:{}}}t.replaceProps=e})(H2||(H2={}));var As;(t=>{function e(l,c){return{...l,path:l.path.slice(c)}}t.drop=e;function i(l,c){var h;return((h=r(l,c))==null?void 0:h.data)??l}t.applySimple=i;function r(l,c){var d,f;let h=c.path;for(var u=[];;){let p;if(l instanceof Un&&c.type===0&&(p=l.runOp({...c,path:h.slice(u.length)}),p===null&&(p=void 0)),p===void 0&&u.length===h.length&&(l instanceof Xs||l instanceof Ut||l instanceof Wt?p=l.runOp(c):p=z2.runOp(l,c)),p!==void 0)if(p!==null){let v=p.data;for(let y=u.length-1;y>=0;y--){let x=h[y],S=u[y];if(S instanceof Xs){if(typeof x=="number")throw new Error("illegal arg");v=S.modifyById(x,v)}else if(S instanceof Ut){if(typeof x=="number")throw new Error("illegal arg");v=S.modifyById(x,v)}else if(S instanceof Wt){if(typeof x=="number")throw new Error("illegal arg");v=S.modifyById(x,v)}else if(S instanceof Un){let A={...S,[x]:v};v=Object.setPrototypeOf(A,Un.prototype)}else if(typeof S=="object")if(Array.isArray(S)){if(typeof x=="string"&&(x=parseInt(x),isNaN(x)))throw new Error("Invalid path");let A=v;v=[...S],v[x]=A}else v={...S,[x]:v};else return null}return{data:v,actual:{...p.actual,path:h},reverse:{...p.reverse,path:h}}}else return null;let m=h[u.length],g;if(l instanceof Xs){if(typeof m=="number")throw new Error("");g=(d=l.get(m))==null?void 0:d.data}else if(l instanceof Ut){if(typeof m=="number")throw new Error("");g=(f=l.get(m))==null?void 0:f.data}else l!==null&&(g=l[m]);if(g!==void 0)u.push(l),l=g;else return null}}t.apply=r;function n(l,c){for(let h=0;h<l.length&&h<c.length;h++)if(l[h]!==c[h])return!0;return!1}t.pathDisjoint=n;function s(l,c){if(l.length!==c.length)return!1;for(let h=0;h<l.length;h++)if(l[h]!==c[h])return!1;return!0}t.pathEq=s;function a(l,c){return n(l.path,c.path)}t.commutative=a;function o(l,c){return l.type===0&&c.type===0&&s(l.path,c.path)?Object.keys(l.props).every(h=>c.props[h]!==void 0):!1}t.subsumed=o})(As||(As={}));var $k;(t=>{function e(){return[]}t.empty=e;function i(c,h){let u=[];for(let d of c){let[f,...p]=d.path;f===h&&u.push({...d,path:p})}return u}t.removePrefix=i;function r(c,h){return c.map(u=>({...u,path:[h,...u.path]}))}t.addPrefix=r;function n(c,h){return[...c,...h]}t.concat=n;function s(c,h){return[...c.filter(u=>!h.some(d=>As.subsumed(u,d))),...h]}t.compress=s;function a(c,h){return c.every(u=>h.every(d=>As.commutative(u,d)))}t.commutative=a;function o(c,h){for(let u of h){let d=l(c,u);d!==null&&(c=d.data)}return c}t.applyAll=o;function l(c,h){var u=c;let d=[],f=[];for(let p of h)try{if(p.type===3||p.type===5&&p.path[p.path.length-1]==="variables"){let m,g,v;if(p.type===3?(m=es.zoom(u,[...p.path,p.id]),v=As.apply(u,{...p,type:2})):(m=es.zoom(u,[...p.path,p.id,"value"]),v=As.apply(u,p)),v!==null){u=v.data;let[y,x]=vGe(u,{[p.id]:m});u=y;for(let S=0;S<x.length;S++){let A=x[S],_=A.pop();if(typeof _=="number"){let M=[_];for(let T=S+1;T<x.length;T++){let C=x[T],D=C[C.length-1];if(typeof D=="number"&&es.equal(A,C.slice(0,C.length-1)))M.push(D),x.splice(T,1);else break}let E=es.zoom(u,A);g=E.map((T,C)=>M.includes(C)?p.id:T),m=E,_=A.pop()}else{if(_==="alphaOverride"||_==="alpha"){m/=100;let M=m,E=es.zoom(u,A.slice(0,A.length-2)),T=E.layers.map(C=>C.id===A[A.length-1]?{...C,data:{...C.data,[_]:M}}:C);Object.setPrototypeOf(T,Object.getPrototypeOf(E.layers)),E.layers=T}g=p.id}d.push({type:0,path:A,props:{[_]:m}}),f.push({type:0,path:A,props:{[_]:g}})}f.push(v.reverse),d.push(v.actual)}}else{let m=As.apply(u,p);m!==null&&(d.push(m.actual),u=m.data,f.push(m.reverse))}}catch(m){if(m instanceof Hae)return null;throw m}return{data:u,actual:d,reverse:f.reverse()}}t.apply=l})($k||($k={}));var Yae=Symbol(),bGe=Symbol(),ND=Symbol(),I_=class{reportOp(t,e,i=[]){let r=this;if(e===null)return;r._current=e.data;let n=i;for(;!(r instanceof Kae);){let s=r._path,a=r._current;if(s!==""&&n.splice(0,0,s),r=r._parent,r===null)return;r.update(s,a)}r.push(n,t,e.actual,e.reverse)}deleteChildren(t){if(this._children){let e=this._children[t];if(e){let i=e[ND];i&&i(),delete this._children[t]}}}},wGe=class extends I_{constructor(t,e,i){super(),this._parent=t,this._path=e,this._current=i}update(t,e){if(Array.isArray(this._current)){if(typeof t=="string"&&(t=parseInt(t),isNaN(t)))throw new Error("Invalid path");this._current=[...this._current],this._current[t]=e}else this._current={...this._current,[t]:e}}runOp(t){this.reportOp(t,z2.runOp(this._current,t),t.path)}},SGe=class extends I_{constructor(t,e,i){super(),this._parent=t,this._path=e,this._current=i}update(t,e){this._current={...this._current,[t]:e},Object.setPrototypeOf(this._current,Wt.prototype)}runOp(t){this.reportOp(t,this._current.runOp(t))}},qae={get(t,e){if(e===ND)return()=>{t._parent=null};if(e===Yae)return t._current;if(e===bGe)return t;let{_current:i,_children:r}=t;if(e==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let n=r===void 0?void 0:r[e];if(n!==void 0)return n;let s=i[e],a=UD(t,e,s);return a!==s?(r===void 0&&(r={},t._children=r),r[e]=a,a):s},has(t,e){return e in t._current},ownKeys(t){return Reflect.ownKeys(t._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(t){return Object.getPrototypeOf(t._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(t,e){let i=t._current,r=Reflect.getOwnPropertyDescriptor(i,e);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[e]}}},_Ge={...qae,set(t,e,i){let r={type:0,props:{[e]:wn(i)??i}};return t.deleteChildren(e),t.runOp(r),!0},deleteProperty(t,e){let i={type:0,props:{[e]:void 0}};return t.deleteChildren(e),t.runOp(i),!0}},AGe={...qae,set(t,e,i){return i===void 0?this.deleteProperty(t,e):(t.deleteChildren(e),t.runOp({type:1,id:e,data:i})),!0},deleteProperty(t,e){return t.runOp({type:2,id:e}),!0}},oG=class extends I_{constructor(t,e,i){super(),this._children={},this._parent=t,this._path=e,this._current=i,this[ND]=()=>{this._parent=null}}unproxy(){return this._current}update(t,e){this._current=this._current.modifyById(t,e)}runOp(t){this.reportOp(t,this._current.runOp(t))}randomId(){return this._current.randomId()}isDescendantOf(t,e){return this._current.isDescendantOf(t,e)}childrenOf(t){return this._current.childrenOf(t)}traverse(t){return this._current.traverse(t)}get(t){return this._current.get(t)}parent(t){return this._current.parent(t)}traverse(t){this._current.traverse((e,i)=>{t(e,this.data(e))})}data(t){var a;let{_current:e,_children:i}=this,r=i===void 0?void 0:i[t];if(r!==void 0)return r;let n=(a=e.get(t))==null?void 0:a.data,s=UD(this,t,n);return s!==n?(i===void 0&&(i={},this._children=i),i[t]=s,s):n}add(t,e,i,r,n){this.runOp({type:7,parent:t,fi:e,id:i,data:r,children:n})}move(t,e,i){this.runOp({type:9,parent:t,fi:e,id:i})}insertAfter(t,e,i){let r=this._current.insertAfterHelper(t,e,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(t,r[n],s.id,s.data,s.children)}}insertBefore(t,e,i){let r=this._current.insertBeforeHelper(t,e,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(t,r[n],s.id,s.data,s.children)}}moveAfter(t,e,i){let r=this._current.insertAfterHelper(t,e,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(t,r[n],s)}}moveBefore(t,e,i){let r=this._current.insertBeforeHelper(t,e,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(t,r[n],s)}}delete(t){this.deleteChildren(t),this.runOp({type:8,id:t})}sortNext(t){return this._current.sortNext(t)}sortPrevious(t){return this._current.sortPrevious(t)}getAllSorted(t){return this._current.getAllSorted(t)}},lG=class extends I_{constructor(t,e,i){super(),this._children={},this._parent=t,this._path=e,this._current=i,this[ND]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(t){let e=this.length;for(let i=0;i<e;i++){let r=this._current[i].id,n=this._current[i].fi;t(this.data(this._current[i].id),r,n)}}find(t){let e=this.length;for(let i=0;i<e;i++){let r=this._current[i].id;if(t(this.data(r),r))return this.get(r)}}update(t,e){this._current=this._current.modifyById(t,e)}randomId(){return this._current.randomId()}get(t){return{...this._current.get(t),data:this.data(t)}}data(t){var a;let{_current:e,_children:i}=this,r=i===void 0?void 0:i[t];if(r!==void 0)return r;let n=(a=e.get(t))==null?void 0:a.data,s=UD(this,t,n);return s!==n?(i===void 0&&(i={},this._children=i),i[t]=s,s):n}runOp(t){this.reportOp(t,this._current.runOp(t))}add(t,e,i){this.runOp({type:4,fi:t,id:e,data:i})}move(t,e){this.runOp({type:6,fi:t,id:e})}insertAfter(t,e){let i=this._current.insertAfterHelper(t,e.length);for(let r=0;r<e.length;r++){let n=e[r];this.add(i[r],n.id,n.data)}}insertBefore(t,e){let i=this._current.insertBeforeHelper(t,e.length);for(let r=0;r<e.length;r++){let n=e[r];this.add(i[r],n.id,n.data)}}moveAfter(t,e){let i=this._current.insertAfterHelper(t,e.length);for(let r=0;r<e.length;r++){let n=e[r];this.move(i[r],n)}}moveBefore(t,e){let i=this._current.insertBeforeHelper(t,e.length);for(let r=0;r<e.length;r++){let n=e[r];this.move(i[r],n)}}delete(t){this.deleteChildren(t),this.runOp({type:5,id:t})}};function W3(t,e,i){if(t.length>0){let r=t[t.length-1];if(r.type===0&&e.type===0&&es.equal(r.path,i)){Object.assign(r.props,e.props);return}}t.push({...e,path:i})}var Kae=class extends I_{constructor(t){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=t}update(t,e){if(t!=="")throw new Error("");this._current=e}push(t,e,i,r){W3(this.ts,e,t),W3(this.actual,i,t),W3(this.reverse,r,t)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function UD(t,e,i){return i instanceof Xs?new oG(t,e,i):i instanceof Ut?new lG(t,e,i):i instanceof Wt?new Proxy(new SGe(t,e,i),AGe):i!==null&&typeof i=="object"?nG(i)?i:new Proxy(new wGe(t,e,i),_Ge):i}function Qae(t){let e=new Kae(t);return[UD(e,"",t),e]}function _S(t,e){let[i,r]=Qae(t);return e(i),r.result()}function wn(t){return t instanceof oG||t instanceof lG?t._current:t!==null&&typeof t=="object"?t[Yae]:t}var es;(t=>{function e(s,a){if(a.length===s.length)for(var o=0;o<s.length;){if(s[o]!==a[o])return!1;o+=1}else return!1;return!0}t.equal=e;function i(s,a,o){let l=n(o,s);if(l!==void 0&&typeof l=="object"&&l!==null){let c={...a};return Object.keys(l).forEach(h=>{delete c[h]}),c}else return a}t.removeOverridden=i;function r(s,a){if((s instanceof Xs||s instanceof oG)&&typeof a=="string"||(s instanceof Ut||s instanceof lG)&&typeof a=="string")return s.data(a);if(typeof a=="number"&&Array.isArray(s)||typeof a=="string"&&typeof s=="object"&&s!==null)return s[a]}t.zoomOnce=r;function n(s,a,o=0){for(;o<a.length&&s!==void 0;)s=r(s,a[o]),o+=1;return s}t.zoom=n})(es||(es={}));function EGe(t,e){let i=[];if(e.length===t.length)for(var r=0;r<t.length;){if(e[r]==="*")i.push(t[r]);else if(t[r]!==e[r])return null;r+=1}else return null;return i}function hr(t,e){let i=[];if(e.length<=t.length)for(var r=0;r<e.length;){if(e[r]==="*")i.push(t[r]);else if(t[r]!==e[r])return null;r+=1}else return null;return i}var $ae=class{},dY=class extends $ae{constructor(t){super(),this.id=t}},fY=class extends $ae{constructor(t){super(),this.data=t}},Jk;try{Jk=new TextDecoder}catch{}var Rt,tp,Be=0,ao={},Wi,Lf,Al=0,wh=0,Lo,rd,Ha=[],$i,pY={useRecords:!1,mapsAsObjects:!0},Jae=class{},Zae=new Jae;Zae.name="MessagePack 0xC1";var h1=!1,j2=class{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0)),Object.assign(this,t)}unpack(t,e){if(Rt)return soe(()=>(eN(),this?this.unpack(t,e):j2.prototype.unpack.call(pY,t,e)));tp=e>-1?e:t.length,Be=0,wh=0,Lf=null,Lo=null,Rt=t;try{$i=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(i){throw Rt=null,t instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof j2){if(ao=this,this.structures)return Wi=this.structures,NM();(!Wi||Wi.length>0)&&(Wi=[])}else ao=pY,(!Wi||Wi.length>0)&&(Wi=[]);return NM()}unpackMultiple(t,e){let i,r=0;try{h1=!0;let n=t.length,s=this?this.unpack(t,n):GD.unpack(t,n);if(e){for(e(s);Be<n;)if(r=Be,e(NM())===!1)return}else{for(i=[s];Be<n;)r=Be,i.push(NM());return i}}catch(n){throw n.lastPosition=r,n.values=i,n}finally{h1=!1,eN()}}_mergeStructures(t,e){t=t||[];for(let i=0,r=t.length;i<r;i++){let n=t[i];n&&(n.isShared=!0,i>=32&&(n.highByte=i-32>>5))}t.sharedLength=t.length;for(let i in e||[])if(i>=0){let r=t[i],n=e[i];n&&(r&&((t.restoreStructures||(t.restoreStructures=[]))[i]=r),t[i]=n)}return this.structures=t}decode(t,e){return this.unpack(t,e)}};function NM(){try{if(!ao.trusted&&!h1){let e=Wi.sharedLength||0;e<Wi.length&&(Wi.length=e)}let t=sn();if(Be==tp)Wi.restoreStructures&&mY(),Wi=null,Rt=null,rd&&(rd=null);else if(Be>tp){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}else if(!h1)throw new Error("Data read, but end of buffer not reached");return t}catch(t){throw Wi.restoreStructures&&mY(),eN(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer"))&&(t.incomplete=!0),t}}function mY(){for(let t in Wi.restoreStructures)Wi[t]=Wi.restoreStructures[t];Wi.restoreStructures=null}function sn(){let t=Rt[Be++];if(t<160)if(t<128){if(t<64)return t;{let e=Wi[t&63]||ao.getStructures&&eoe()[t&63];return e?(e.read||(e.read=cG(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,ao.mapsAsObjects){let e={};for(let i=0;i<t;i++)e[ioe()]=sn();return e}else{let e=new Map;for(let i=0;i<t;i++)e.set(sn(),sn());return e}else{t-=144;let e=new Array(t);for(let i=0;i<t;i++)e[i]=sn();return e}else if(t<192){let e=t-160;if(wh>=Be)return Lf.slice(Be-Al,(Be+=e)-Al);if(wh==0&&tp<140){let i=e<16?hG(e):toe(e);if(i!=null)return i}return Zk(e)}else{let e;switch(t){case 192:return null;case 193:return Lo?(e=sn(),e>0?Lo[1].slice(Lo.position1,Lo.position1+=e):Lo[0].slice(Lo.position0,Lo.position0-=e)):Zae;case 194:return!1;case 195:return!0;case 196:return X3(Rt[Be++]);case 197:return e=$i.getUint16(Be),Be+=2,X3(e);case 198:return e=$i.getUint32(Be),Be+=4,X3(e);case 199:return lm(Rt[Be++]);case 200:return e=$i.getUint16(Be),Be+=2,lm(e);case 201:return e=$i.getUint32(Be),Be+=4,lm(e);case 202:if(e=$i.getFloat32(Be),ao.useFloat32>2){let i=uG[(Rt[Be]&127)<<1|Rt[Be+1]>>7];return Be+=4,(i*e+(e>0?.5:-.5)>>0)/i}return Be+=4,e;case 203:return e=$i.getFloat64(Be),Be+=8,e;case 204:return Rt[Be++];case 205:return e=$i.getUint16(Be),Be+=2,e;case 206:return e=$i.getUint32(Be),Be+=4,e;case 207:return ao.int64AsNumber?(e=$i.getUint32(Be)*4294967296,e+=$i.getUint32(Be+4)):e=$i.getBigUint64(Be),Be+=8,e;case 208:return $i.getInt8(Be++);case 209:return e=$i.getInt16(Be),Be+=2,e;case 210:return e=$i.getInt32(Be),Be+=4,e;case 211:return ao.int64AsNumber?(e=$i.getInt32(Be)*4294967296,e+=$i.getUint32(Be+4)):e=$i.getBigInt64(Be),Be+=8,e;case 212:if(e=Rt[Be++],e==114)return bY(Rt[Be++]&63);{let i=Ha[e];if(i)return i.read?(Be++,i.read(sn())):i.noBuffer?(Be++,i()):i(Rt.subarray(Be,++Be));throw new Error("Unknown extension "+e)}case 213:return e=Rt[Be],e==114?(Be++,bY(Rt[Be++]&63,Rt[Be++])):lm(2);case 214:return lm(4);case 215:return lm(8);case 216:return lm(16);case 217:return e=Rt[Be++],wh>=Be?Lf.slice(Be-Al,(Be+=e)-Al):TGe(e);case 218:return e=$i.getUint16(Be),Be+=2,wh>=Be?Lf.slice(Be-Al,(Be+=e)-Al):CGe(e);case 219:return e=$i.getUint32(Be),Be+=4,wh>=Be?Lf.slice(Be-Al,(Be+=e)-Al):PGe(e);case 220:return e=$i.getUint16(Be),Be+=2,vY(e);case 221:return e=$i.getUint32(Be),Be+=4,vY(e);case 222:return e=$i.getUint16(Be),Be+=2,yY(e);case 223:return e=$i.getUint32(Be),Be+=4,yY(e);default:if(t>=224)return t-256;if(t===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+t)}}}var MGe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function cG(t,e){function i(){if(i.count++>2){let n=t.read=new Function("r","return function(){return {"+t.map(s=>MGe.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(sn);return t.highByte===0&&(t.read=gY(e,t.read)),n()}let r={};for(let n=0,s=t.length;n<s;n++){let a=t[n];r[a]=sn()}return r}return i.count=0,t.highByte===0?gY(e,i):i}var gY=(t,e)=>function(){let i=Rt[Be++];if(i===0)return e();let r=t<32?-(t+(i<<5)):t+(i<<5),n=Wi[r]||eoe()[r];if(!n)throw new Error("Record id is not defined for "+r);return n.read||(n.read=cG(n,t)),n.read()};function eoe(){let t=soe(()=>(Rt=null,ao.getStructures()));return Wi=ao._mergeStructures(t,Wi)}var Zk=zD,TGe=zD,CGe=zD,PGe=zD;function zD(t){let e;if(t<16&&(e=hG(t)))return e;if(t>64&&Jk)return Jk.decode(Rt.subarray(Be,Be+=t));let i=Be+t,r=[];for(e="";Be<i;){let n=Rt[Be++];if(!(n&128))r.push(n);else if((n&224)===192){let s=Rt[Be++]&63;r.push((n&31)<<6|s)}else if((n&240)===224){let s=Rt[Be++]&63,a=Rt[Be++]&63;r.push((n&31)<<12|s<<6|a)}else if((n&248)===240){let s=Rt[Be++]&63,a=Rt[Be++]&63,o=Rt[Be++]&63,l=(n&7)<<18|s<<12|a<<6|o;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(n);r.length>=4096&&(e+=vs.apply(String,r),r.length=0)}return r.length>0&&(e+=vs.apply(String,r)),e}function vY(t){let e=new Array(t);for(let i=0;i<t;i++)e[i]=sn();return e}function yY(t){if(ao.mapsAsObjects){let e={};for(let i=0;i<t;i++)e[ioe()]=sn();return e}else{let e=new Map;for(let i=0;i<t;i++)e.set(sn(),sn());return e}}var vs=String.fromCharCode;function toe(t){let e=Be,i=new Array(t);for(let r=0;r<t;r++){let n=Rt[Be++];if((n&128)>0){Be=e;return}i[r]=n}return vs.apply(String,i)}function hG(t){if(t<4)if(t<2){if(t===0)return"";{let e=Rt[Be++];if((e&128)>1){Be-=1;return}return vs(e)}}else{let e=Rt[Be++],i=Rt[Be++];if((e&128)>0||(i&128)>0){Be-=2;return}if(t<3)return vs(e,i);let r=Rt[Be++];if((r&128)>0){Be-=3;return}return vs(e,i,r)}else{let e=Rt[Be++],i=Rt[Be++],r=Rt[Be++],n=Rt[Be++];if((e&128)>0||(i&128)>0||(r&128)>0||(n&128)>0){Be-=4;return}if(t<6){if(t===4)return vs(e,i,r,n);{let s=Rt[Be++];if((s&128)>0){Be-=5;return}return vs(e,i,r,n,s)}}else if(t<8){let s=Rt[Be++],a=Rt[Be++];if((s&128)>0||(a&128)>0){Be-=6;return}if(t<7)return vs(e,i,r,n,s,a);let o=Rt[Be++];if((o&128)>0){Be-=7;return}return vs(e,i,r,n,s,a,o)}else{let s=Rt[Be++],a=Rt[Be++],o=Rt[Be++],l=Rt[Be++];if((s&128)>0||(a&128)>0||(o&128)>0||(l&128)>0){Be-=8;return}if(t<10){if(t===8)return vs(e,i,r,n,s,a,o,l);{let c=Rt[Be++];if((c&128)>0){Be-=9;return}return vs(e,i,r,n,s,a,o,l,c)}}else if(t<12){let c=Rt[Be++],h=Rt[Be++];if((c&128)>0||(h&128)>0){Be-=10;return}if(t<11)return vs(e,i,r,n,s,a,o,l,c,h);let u=Rt[Be++];if((u&128)>0){Be-=11;return}return vs(e,i,r,n,s,a,o,l,c,h,u)}else{let c=Rt[Be++],h=Rt[Be++],u=Rt[Be++],d=Rt[Be++];if((c&128)>0||(h&128)>0||(u&128)>0||(d&128)>0){Be-=12;return}if(t<14){if(t===12)return vs(e,i,r,n,s,a,o,l,c,h,u,d);{let f=Rt[Be++];if((f&128)>0){Be-=13;return}return vs(e,i,r,n,s,a,o,l,c,h,u,d,f)}}else{let f=Rt[Be++],p=Rt[Be++];if((f&128)>0||(p&128)>0){Be-=14;return}if(t<15)return vs(e,i,r,n,s,a,o,l,c,h,u,d,f,p);let m=Rt[Be++];if((m&128)>0){Be-=15;return}return vs(e,i,r,n,s,a,o,l,c,h,u,d,f,p,m)}}}}}function X3(t){return ao.copyBuffers?Uint8Array.prototype.slice.call(Rt,Be,Be+=t):Rt.subarray(Be,Be+=t)}function lm(t){let e=Rt[Be++];if(Ha[e])return Ha[e](Rt.subarray(Be,Be+=t));throw new Error("Unknown extension type "+e)}var xY=new Array(4096);function ioe(){let t=Rt[Be++];if(t>=160&&t<192){if(t=t-160,wh>=Be)return Lf.slice(Be-Al,(Be+=t)-Al);if(!(wh==0&&tp<180))return Zk(t)}else return Be--,sn();let e=(t<<5^(t>1?$i.getUint16(Be):t>0?Rt[Be]:0))&4095,i=xY[e],r=Be,n=Be+t-3,s,a=0;if(i&&i.bytes==t){for(;r<n;){if(s=$i.getUint32(r),s!=i[a++]){r=1879048192;break}r+=4}for(n+=3;r<n;)if(s=Rt[r++],s!=i[a++]){r=1879048192;break}if(r===n)return Be=r,i.string;n-=3,r=Be}for(i=[],xY[e]=i,i.bytes=t;r<n;)s=$i.getUint32(r),i.push(s),r+=4;for(n+=3;r<n;)s=Rt[r++],i.push(s);let o=t<16?hG(t):toe(t);return o!=null?i.string=o:i.string=Zk(t)}var bY=(t,e)=>{var i=sn();let r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,i.highByte=e);let n=Wi[t];return n&&n.isShared&&((Wi.restoreStructures||(Wi.restoreStructures=[]))[t]=n),Wi[t]=i,i.read=cG(i,r),i.read()},roe=typeof self=="object"?self:global;Ha[0]=()=>{};Ha[0].noBuffer=!0;Ha[101]=()=>{let t=sn();return(roe[t[0]]||Error)(t[1])};Ha[105]=t=>{let e=$i.getUint32(Be-4);rd||(rd=new Map);let i=Rt[Be],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let n={target:r};rd.set(e,n);let s=sn();return n.used?Object.assign(r,s):(n.target=s,s)};Ha[112]=t=>{let e=$i.getUint32(Be-4),i=rd.get(e);return i.used=!0,i.target};Ha[115]=()=>new Set(sn());var noe=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");Ha[116]=t=>{let e=t[0],i=noe[e];if(!i)throw new Error("Could not find typed array for code "+e);return new roe[i](Uint8Array.prototype.slice.call(t,1).buffer)};Ha[120]=()=>{let t=sn();return new RegExp(t[0],t[1])};Ha[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],i=Be;Be+=e-4,Lo=[sn(),sn()],Lo.position0=0,Lo.position1=0;let r=Be;Be=i;try{return sn()}finally{Be=r}};Ha[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function soe(t){let e=tp,i=Be,r=Al,n=wh,s=Lf,a=rd,o=Lo,l=new Uint8Array(Rt.slice(0,tp)),c=Wi,h=Wi.slice(0,Wi.length),u=ao,d=h1,f=t();return tp=e,Be=i,Al=r,wh=n,Lf=s,rd=a,Lo=o,Rt=l,h1=d,Wi=c,Wi.splice(0,Wi.length,...h),ao=u,$i=new DataView(Rt.buffer,Rt.byteOffset,Rt.byteLength),f}function eN(){Rt=null,rd=null,Wi=null}function DGe(t){t.unpack?Ha[t.type]=t.unpack:Ha[t.type]=t}var uG=new Array(147);for(let t=0;t<256;t++)uG[t]=+("1e"+Math.floor(45.15-t*.30103));var GD=new j2({useRecords:!1});GD.unpack;GD.unpackMultiple;GD.unpack;var RGe=new Float32Array(1);new Uint8Array(RGe.buffer,0,4);var mC;try{mC=new TextEncoder}catch{}var W2,dG,VD=typeof Buffer<"u",Y3=VD?Buffer.allocUnsafeSlow:Uint8Array,aoe=VD?Buffer:Uint8Array,wY=VD?4294967296:2144337920,it,pn,He=0,$c,Jc=null,IGe=/[\u0080-\uFFFF]/,ab=Symbol("record-id"),ooe=class extends j2{constructor(t){super(t),this.offset=0;let e,i,r,n,s,a=0,o=aoe.prototype.utf8Write?function(_,M,E){return it.utf8Write(_,M,E)}:mC&&mC.encodeInto?function(_,M){return mC.encodeInto(_,it.subarray(M)).written}:!1,l=this;t||(t={});let c=t&&t.sequential,h=t.structures||t.saveStructures,u=t.maxSharedStructures;if(u==null&&(u=h?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=t.maxOwnStructures;d==null&&(d=h?32:64),c&&!t.saveStructures&&(this.structures=[]);let f=u>32||d+u>64,p=u+64,m=u+d+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],v=0,y=0;this.pack=this.encode=function(_,M){if(it||(it=new Y3(8192),pn=new DataView(it.buffer,0,8192),He=0),$c=it.length-10,$c-He<2048?(it=new Y3(it.length),pn=new DataView(it.buffer,0,it.length),$c=it.length-10,He=0):He=He+7&2147483640,e=He,s=l.structuredClone?new Map:null,l.bundleStrings?(Jc=["",""],it[He++]=214,it[He++]=98,Jc.position=He-e,He+=4):Jc=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let E=i.sharedLength||0;if(E>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let T=0;T<E;T++){let C=i[T];if(!C)continue;let D,B=i.transitions;for(let O=0,L=C.length;O<L;O++){let H=C[O];D=B[H],D||(D=B[H]=Object.create(null)),B=D}B[ab]=T+64}a=E}c||(i.nextId=E+64)}r&&(r=!1),n=i||[];try{if(x(_),Jc){pn.setUint32(Jc.position+e,He-Jc.position-e);let E=Jc;Jc=null,x(E[0]),x(E[1])}if(l.offset=He,s&&s.idsToInsert){He+=s.idsToInsert.length*6,He>$c&&A(He),l.offset=He;let E=OGe(it.subarray(e,He),s.idsToInsert);return s=null,E}return M&BGe?(it.start=e,it.end=He,it):it.subarray(e,He)}finally{if(i){if(y<10&&y++,v>1e4)i.transitions=null,y=0,v=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let E=0,T=g.length;E<T;E++)g[E][ab]=0;g=[]}if(r&&l.saveStructures){let E=i.sharedLength||u;i.length>E&&(i=i.slice(0,E));let T=it.subarray(e,He);return l.saveStructures(i,a)===!1?(l._mergeStructures(l.getStructures()),l.pack(_)):(a=E,T)}}M&FGe&&(He=e)}};let x=_=>{He>$c&&(it=A(He));var M=typeof _,E;if(M==="string"){let T=_.length;if(Jc&&T>=8&&T<4096){let B=IGe.test(_);Jc[B?0:1]+=_,it[He++]=193,x(B?-T:T);return}let C;T<32?C=1:T<256?C=2:T<65536?C=3:C=5;let D=T*3;if(He+D>$c&&(it=A(He+D)),T<64||!o){let B,O,L,H=He+C;for(B=0;B<T;B++)O=_.charCodeAt(B),O<128?it[H++]=O:O<2048?(it[H++]=O>>6|192,it[H++]=O&63|128):(O&64512)===55296&&((L=_.charCodeAt(B+1))&64512)===56320?(O=65536+((O&1023)<<10)+(L&1023),B++,it[H++]=O>>18|240,it[H++]=O>>12&63|128,it[H++]=O>>6&63|128,it[H++]=O&63|128):(it[H++]=O>>12|224,it[H++]=O>>6&63|128,it[H++]=O&63|128);E=H-He-C}else E=o(_,He+C,D);E<32?it[He++]=160|E:E<256?(C<2&&it.copyWithin(He+2,He+1,He+1+E),it[He++]=217,it[He++]=E):E<65536?(C<3&&it.copyWithin(He+3,He+2,He+2+E),it[He++]=218,it[He++]=E>>8,it[He++]=E&255):(C<5&&it.copyWithin(He+5,He+3,He+3+E),it[He++]=219,pn.setUint32(He,E),He+=4),He+=E}else if(M==="number")if(_>>>0===_)_<64?it[He++]=_:_<256?(it[He++]=204,it[He++]=_):_<65536?(it[He++]=205,it[He++]=_>>8,it[He++]=_&255):(it[He++]=206,pn.setUint32(He,_),He+=4);else if(_>>0===_)_>=-32?it[He++]=256+_:_>=-128?(it[He++]=208,it[He++]=_+256):_>=-32768?(it[He++]=209,pn.setInt16(He,_),He+=2):(it[He++]=210,pn.setInt32(He,_),He+=4);else{let T;if((T=this.useFloat32)>0&&_<4294967296&&_>=-2147483648){it[He++]=202,pn.setFloat32(He,_);let C;if(T<4||(C=_*uG[(it[He]&127)<<1|it[He+1]>>7])>>0===C){He+=4;return}else He--}it[He++]=203,pn.setFloat64(He,_),He+=8}else if(M==="object")if(!_)it[He++]=192;else{if(s){let C=s.get(_);if(C){if(!C.id){let D=s.idsToInsert||(s.idsToInsert=[]);C.id=D.push(C)}it[He++]=214,it[He++]=112,pn.setUint32(He,C.id),He+=4;return}else s.set(_,{offset:He-e})}let T=_.constructor;if(T===Object)S(_,!0);else if(T===Array){E=_.length,E<16?it[He++]=144|E:E<65536?(it[He++]=220,it[He++]=E>>8,it[He++]=E&255):(it[He++]=221,pn.setUint32(He,E),He+=4);for(let C=0;C<E;C++)x(_[C])}else if(T===Map){E=_.size,E<16?it[He++]=128|E:E<65536?(it[He++]=222,it[He++]=E>>8,it[He++]=E&255):(it[He++]=223,pn.setUint32(He,E),He+=4);for(let[C,D]of _)x(C),x(D)}else{for(let C=0,D=W2.length;C<D;C++){let B=dG[C];if(_ instanceof B){let O=W2[C];if(O.write){O.type&&(it[He++]=212,it[He++]=O.type,it[He++]=0),x(O.write.call(this,_));return}let L=it,H=pn,q=He;it=null;let W;try{W=O.pack.call(this,_,I=>(it=L,L=null,He+=I,He>$c&&A(He),{target:it,targetView:pn,position:He-I}),x)}finally{L&&(it=L,pn=H,He=q,$c=it.length-10)}W&&(W.length+He>$c&&A(W.length+He),He=LGe(W,it,He,O.type));return}}S(_,!_.hasOwnProperty)}}else if(M==="boolean")it[He++]=_?195:194;else if(M==="bigint"){if(_<BigInt(1)<<BigInt(63)&&_>=-(BigInt(1)<<BigInt(63)))it[He++]=211,pn.setBigInt64(He,_);else if(_<BigInt(1)<<BigInt(64)&&_>0)it[He++]=207,pn.setBigUint64(He,_);else if(this.largeBigIntToFloat)it[He++]=203,pn.setFloat64(He,Number(_));else throw new RangeError(_+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");He+=8}else if(M==="undefined")this.encodeUndefinedAsNil?it[He++]=192:(it[He++]=212,it[He++]=0,it[He++]=0);else if(M==="function")x(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+M)},S=this.useRecords===!1?this.variableMapSize?_=>{let M=Object.keys(_),E=M.length;E<16?it[He++]=128|E:E<65536?(it[He++]=222,it[He++]=E>>8,it[He++]=E&255):(it[He++]=223,pn.setUint32(He,E),He+=4);let T;for(let C=0;C<E;C++)x(T=M[C]),x(_[T])}:(_,M)=>{it[He++]=222;let E=He-e;He+=2;let T=0;for(let C in _)(M||_.hasOwnProperty(C))&&(x(C),x(_[C]),T++);it[E+++e]=T>>8,it[E+e]=T&255}:_=>{let M=Object.keys(_),E,T=n.transitions||(n.transitions=Object.create(null)),C=0;for(let B=0,O=M.length;B<O;B++){let L=M[B];E=T[L],E||(E=T[L]=Object.create(null),C++),T=E}let D=T[ab];if(D)D>=96&&f?(it[He++]=((D-=96)&31)+96,it[He++]=D>>5):it[He++]=D;else{D=n.nextId,D||(D=64),D<p&&this.shouldShareStructure&&!this.shouldShareStructure(M)?(D=n.nextOwnId,D<m||(D=p),n.nextOwnId=D+1):(D>=m&&(D=p),n.nextId=D+1);let B=M.highByte=D>=96&&f?D-96>>5:-1;T[ab]=D,n[D-64]=M,D<p?(M.isShared=!0,n.sharedLength=D-63,r=!0,B>=0?(it[He++]=(D&31)+96,it[He++]=B):it[He++]=D):(B>=0?(it[He++]=213,it[He++]=114,it[He++]=(D&31)+96,it[He++]=B):(it[He++]=212,it[He++]=114,it[He++]=D),C&&(v+=y*C),g.length>=d&&(g.shift()[ab]=0),g.push(T),x(M))}for(let B=0,O=M.length;B<O;B++)x(_[M[B]])},A=_=>{let M;if(_>16777216){if(_-e>wY)throw new Error("Packed buffer would be larger than maximum buffer size");M=Math.min(wY,Math.round(Math.max((_-e)*(_>67108864?1.25:2),4194304)/4096)*4096)}else M=(Math.max(_-e<<2,it.length-1)>>12)+1<<12;let E=new Y3(M);return pn=new DataView(E.buffer,0,M),it.copy?it.copy(E,0,e,_):E.set(it.slice(e,_)),He-=e,e=0,$c=E.length-10,it=E}}useBuffer(t){it=t,pn=new DataView(it.buffer,it.byteOffset,it.byteLength),He=0}};dG=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Jae];W2=[{pack(t,e,i){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:n,targetView:s,position:a}=e(6);n[a++]=214,n[a++]=255,s.setUint32(a,r)}else if(r>0&&r<17179869184){let{target:n,targetView:s,position:a}=e(10);n[a++]=215,n[a++]=255,s.setUint32(a,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(a+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),i(this.onInvalidDate());let{target:n,targetView:s,position:a}=e(3);n[a++]=212,n[a++]=255,n[a++]=255}else{let{target:n,targetView:s,position:a}=e(15);n[a++]=199,n[a++]=12,n[a++]=255,s.setUint32(a,t.getMilliseconds()*1e6),s.setBigInt64(a+4,BigInt(Math.floor(r)))}}},{pack(t,e,i){let r=Array.from(t),{target:n,position:s}=e(this.structuredClone?3:0);this.structuredClone&&(n[s++]=212,n[s++]=115,n[s++]=0),i(r)}},{pack(t,e,i){let{target:r,position:n}=e(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=101,r[n++]=0),i([t.name,t.message])}},{pack(t,e,i){let{target:r,position:n}=e(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=120,r[n++]=0),i([t.source,t.flags])}},{pack(t,e){this.structuredClone?SY(t,16,e):_Y(VD?Buffer.from(t):new Uint8Array(t),e)}},{pack(t,e){let i=t.constructor;i!==aoe&&this.structuredClone?SY(t,noe.indexOf(i.name),e):_Y(t,e)}},{pack(t,e){let{target:i,position:r}=e(1);i[r]=193}}];function SY(t,e,i,r){let n=t.byteLength;if(n+1<256){var{target:s,position:a}=i(4+n);s[a++]=199,s[a++]=n+1}else if(n+1<65536){var{target:s,position:a}=i(5+n);s[a++]=200,s[a++]=n+1>>8,s[a++]=n+1&255}else{var{target:s,position:a,targetView:o}=i(7+n);s[a++]=201,o.setUint32(a,n+1),a+=4}s[a++]=116,s[a++]=e,s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),a)}function _Y(t,e){let i=t.byteLength;var r,n;if(i<256){var{target:r,position:n}=e(i+2);r[n++]=196,r[n++]=i}else if(i<65536){var{target:r,position:n}=e(i+3);r[n++]=197,r[n++]=i>>8,r[n++]=i&255}else{var{target:r,position:n,targetView:s}=e(i+5);r[n++]=198,s.setUint32(n,i),n+=4}r.set(t,n)}function LGe(t,e,i,r){let n=t.length;switch(n){case 1:e[i++]=212;break;case 2:e[i++]=213;break;case 4:e[i++]=214;break;case 8:e[i++]=215;break;case 16:e[i++]=216;break;default:n<256?(e[i++]=199,e[i++]=n):n<65536?(e[i++]=200,e[i++]=n>>8,e[i++]=n&255):(e[i++]=201,e[i++]=n>>24,e[i++]=n>>16&255,e[i++]=n>>8&255,e[i++]=n&255)}return e[i++]=r,e.set(t,i),i+=n,i}function OGe(t,e){let i,r=e.length*6,n=t.length-r;for(e.sort((s,a)=>s.offset>a.offset?1:-1);i=e.pop();){let s=i.offset,a=i.id;t.copyWithin(s+r,s,n),r-=6;let o=s+r;t[o++]=214,t[o++]=105,t[o++]=a>>24,t[o++]=a>>16&255,t[o++]=a>>8&255,t[o++]=a&255,n=s}return t}function $1(t){if(t.Class){if(!t.pack&&!t.write)throw new Error("Extension has no pack or write function");if(t.pack&&!t.type)throw new Error("Extension has no type (numeric code to identify the extension)");dG.unshift(t.Class),W2.unshift(t)}DGe(t)}var loe=new ooe({useRecords:!1});loe.pack;loe.pack;var BGe=512,FGe=1024,AY=new ooe({structuredClone:!0});$1({Class:Wt.prototype.constructor,type:1,write(t){return{...t}},read(t){return Object.setPrototypeOf(t,Wt.prototype),t}});$1({Class:Ut.prototype.constructor,type:2,write(t){return[...t]},read(t){return Object.setPrototypeOf(t,Ut.prototype),t}});$1({Class:Xs.prototype.constructor,type:3,write(t){return[...t]},read(t){return Object.setPrototypeOf(t,Xs.prototype),t}});$1({Class:dY.prototype.constructor,type:4,write(t){return t.id},read(t){return new dY(t)}});$1({Class:fY.prototype.constructor,type:5,write(t){return t.data},read(t){return new fY(t)}});$1({Class:Un.prototype.constructor,type:6,write(t){return{...t}},read(t){return Object.setPrototypeOf(t,Un.prototype),t}});function kGe(t){var e=0;if(t.length===0)return e;for(let i=0;i<t.length;i++){let r=t[i];e=(e<<5)-e+r,e=e&e}return e}function tN(t){if(nG(t))return t;if(Array.isArray(t))return t.map(tN);if(typeof t=="object"&&t!==null){let e={};for(let i of Object.keys(t).sort())e[i]=tN(t[i]);return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),e}else return t}var iN;(t=>{function e(n){return AY.pack(n)}t.serialize=e;function i(n){return AY.unpack(n)}t.deserialize=i;function r(n){return kGe(e(tN(n))).toString()}t.checksum=r})(iN||(iN={}));var EY;(t=>{function e(r){return r.type==="Conditional"?r.condition.type==="Distance"?"Distance":"StateChange":r.type}t.toEventUIType=e;function i(r){return r==="Distance"||r==="StateChange"?"Conditional":r}t.fromEventUIType=i})(EY||(EY={}));function MY(t){return t==="MouseDown"||t==="MouseUp"||t==="KeyDown"||t==="KeyUp"||t==="Collision"||t==="Trigger"}var oa={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],AIAssistantListener:["SetVariable"],AIAssistantTrigger:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]},TY;(t=>{function e(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"}t.is=e;function i(r){return r==="MouseDown"||r==="MouseUp"||r==="MousePress"?{type:r,mode:"Object",disabled:!1,actions:new Ut}:{type:r,disabled:!1,key:void 0,actions:new Ut}}t.defaultData=i})(TY||(TY={}));var X2;(t=>{function e(i){return{type:"Property",value:[i??null,"position","x"]}}t.propertyDefaultData=e,t.valueDefaultData={type:"Literal",value:0}})(X2||(X2={}));var rN;(t=>{function e(n){return{type:"Comparison",operator:"==",lOperand:X2.propertyDefaultData(n),rOperand:{...X2.valueDefaultData}}}t.comparisonDefaultData=e;function i(n){return{type:"Distance",toObject:n??null,fromObject:n??null,distance:200}}t.distanceDefaultData=i;function r(n,s){return{type:"State",object:n??null,state:s??null}}t.stateDefaultData=r})(rN||(rN={}));var CY;(t=>{function e(i){return i.find(r=>r==="ifActions"||r==="elseActions")!==void 0}t.isConditionalSubActions=e})(CY||(CY={}));var PY;(t=>{function e(r){return r.type==="Conditional"}t.is=e;function i(r){return{type:"Conditional",disabled:!1,inActions:new Ut,outActions:new Ut,condition:rN.distanceDefaultData(r)}}t.defaultData=i})(PY||(PY={}));var DY;(t=>t.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new Ut,drop:new Ut}})(DY||(DY={}));var nN;(t=>t.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new Ut})(nN||(nN={}));var sN;(t=>t.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(sN||(sN={}));var RY;(t=>{function e(r){return r.type==="MouseHover"}t.is=e;function i(){return{type:"MouseHover",disabled:!1,actions:new Ut}}t.defaultData=i})(RY||(RY={}));var IY;(t=>{function e(r){return r.type==="Scroll"}t.is=e;function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new Ut}}t.defaultData=i})(IY||(IY={}));var LY;(t=>{function e(r){return r.type==="Start"}t.is=e;function i(){return{type:"Start",disabled:!1,actions:new Ut}}t.defaultData=i})(LY||(LY={}));var OY;(t=>{function e(r){return r.type==="Collision"}t.is=e;function i(){return{type:"Collision",disabled:!1,target:"character",actions:new Ut}}t.defaultData=i})(OY||(OY={}));var BY;(t=>{function e(r){return r.type==="Trigger"}t.is=e;function i(r,n){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new Ut,triggerZone:"box",position:n.toArray(),rotation:[0,0,0],size:r.toArray(),radius:r.length()/2,helperVisible:!0}}t.defaultData=i})(BY||(BY={}));var aN;(t=>{t.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function e(a){return a.type==="Resize"}t.is=e;function i(a){return typeof a=="string"?a:"custom"}t.sizeToDevice=i;function r(a){return typeof a=="string"?[...t.defaultSizes[a]]:[...a]}t.deviceToSize=r;function n(){let a={size:"mobile",operator:"<",actions:new Ut},o={size:"tablet",operator:"<",actions:new Ut},l={size:[...t.defaultSizes.custom],operator:"<>",actions:new Ut},c=new Ut;return c.push({id:Et.generateUUID(),fi:0,data:a},{id:Et.generateUUID(),fi:1,data:o},{id:Et.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:c}}t.defaultData=n;function s(){return{size:[...t.defaultSizes.custom],operator:"<>",actions:new Ut}}t.defaultBreakpointData=s})(aN||(aN={}));var oN;(t=>{t.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function e(r){return r.type==="VariableChange"}t.is=e;function i(){return{disabled:!1,type:"VariableChange",actions:new Ut,variableId:"",objectId:null,property:"Position X"}}t.defaultData=i})(oN||(oN={}));var FY;(t=>{function e(r){return r.type==="API"}t.is=e;function i(){return{disabled:!1,type:"API",successActions:new Ut,errorActions:new Ut,userAPIId:""}}t.defaultData=i})(FY||(FY={}));var kY;(t=>{function e(r){return r.type==="WEBHOOK"}t.is=e;function i(){return{disabled:!1,type:"WEBHOOK",actions:new Ut,userWebhookId:""}}t.defaultData=i})(kY||(kY={}));var NY;(t=>{function e(r){return r.type==="AIAssistantListener"}t.is=e;function i(){return{disabled:!1,type:"AIAssistantListener",actions:new Ut,analysis:"average",analysisRange:[0,71],analysisSingle:0}}t.defaultData=i})(NY||(NY={}));var UY;(t=>{function e(r){return r.type==="AIAssistantTrigger"}t.is=e;function i(){return{disabled:!1,description:"",type:"AIAssistantTrigger",actions:new Ut}}t.defaultData=i})(UY||(UY={}));var J1="personal camera",pw="a218fcc3-276b-49b9-b485-49037fd14f5f",NGe=2960946,Yo=5526619,Ju;(t=>{function e(p,m){return p[0]===m[0]&&p[1]===m[1]}t.isEqual=e;function i(p,m,g){return[p[0]+(m[0]-p[0])*g,p[1]+(m[1]-p[1])*g]}t.lerp=i;function r(p,m){return[p[0]+m[0],p[1]+m[1]]}t.add=r;function n(p,m){return[p[0]-m[0],p[1]-m[1]]}t.sub=n;function s(p,m){return[p[0]*m[0],p[1]*m[1]]}t.multiply=s;function a(p,m){return[p[0]/m[0],p[1]/m[1]]}t.divide=a;function o(p,m){return Math.pow(m[0]-p[0],2)+Math.pow(m[1]-p[1],2)}t.distanceSquared=o;function l(p,m){return Math.sqrt(o(p,m))}t.distance=l;function c(p,m){return p[0]*m[0]+p[1]*m[1]}t.dot=c;function h(p,m){return[p[0]*m,p[1]*m]}t.scalarMultiply=h;function u(p,m,g){let v=t.sub(m,p),y=t.sub(g,p),x=t.dot(v,y)/t.dot(v,v),S=t.scalarMultiply(v,x);return t.add(p,S)}t.projectionOnto=u;function d(p,m,g){return l(p,u(p,m,g))}t.projectionOntoDistance=d;function f(p,m){return[(p[0]+m[0])*.5,(p[1]+m[1])*.5]}t.center=f})(Ju||(Ju={}));var xg;(t=>{function e(l,c){return l[0]===c[0]&&l[1]===c[1]&&l[2]===c[2]}t.isEqual=e;function i(l,c){return[l[0]+c[0],l[1]+c[1],l[2]+c[2]]}t.add=i;function r(l,c){return[l[0]-c[0],l[1]-c[1],l[2]-c[2]]}t.sub=r;function n(l,c){return[l[0]/c[0],l[1]/c[1],l[2]/c[2]]}t.div=n;function s(l,c){return[l[0]*c[0],l[1]*c[1],l[2]*c[2]]}t.mul=s;function a(l,c){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])}t.dist=a;function o(l,c,h){return[l[0]+(c[0]-l[0])*h,l[1]+(c[1]-l[1])*h,l[2]+(c[2]-l[2])*h]}t.lerp=o})(xg||(xg={}));var Y2;(t=>{function e(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]}t.isEqual=e;function i(r,n,s){return[r[0]+(n[0]-r[0])*s,r[1]+(n[1]-r[1])*s,r[2]+(n[2]-r[2])*s,r[3]+(n[3]-r[3])*s]}t.lerp=i})(Y2||(Y2={}));var zY;(t=>{let e=180/Math.PI,i=Math.PI/180;function r(o){return typeof o=="number"?o*e:o}function n(o){return typeof o=="number"?o*i:o}function s(o){return[r(o[0]),r(o[1]),r(o[2])]}t.radToDeg=s;function a(o){return[n(o[0]),n(o[1]),n(o[2])]}t.degToRad=a})(zY||(zY={}));var u1;(t=>{t.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function e(n,s){for(let a=0;a<16;a++)if(n[a]!==s[a])return!1;return!0}t.isEqual=e;function i(n){return n??t.identity}t.simplify=i;function r(n,s){let a=s.slice(0);for(var o=0,l=s.length;o<l;o+=3){let c=n[3]*s[o]+n[7]*s[o+1]+n[11]*s[o+2]+n[15];a[o]=(n[0]*s[o]+n[4]*s[o+1]+n[8]*s[o+2]+n[12])/c,a[o+1]=(n[1]*s[o]+n[5]*s[o+1]+n[9]*s[o+2]+n[13])/c,a[o+2]=(n[2]*s[o]+n[6]*s[o+1]+n[10]*s[o+2]+n[14])/c}return a}t.applyMatrix4=r})(u1||(u1={}));var Hs;(t=>{function e(c){return typeof c=="object"&&typeof c.r=="number"&&typeof c.g=="number"&&typeof c.b=="number"}t.isRGB=e,t.white={r:1,g:1,b:1},t.red={r:1,g:0,b:0},t.black={r:0,g:0,b:0};function i(c){return{r:Math.round(c.r*255),g:Math.round(c.g*255),b:Math.round(c.b*255),a:1}}t.toRgb255a1=i;function r(c){return{r:c.r,g:c.g,b:c.b}}t.clone=r;function n(c){return c=Math.floor(c),{r:(c>>16&255)/255,g:(c>>8&255)/255,b:(c&255)/255}}t.fromHex=n;function s(c){return Math.round(c.r*255)*65536+Math.round(c.g*255)*256+Math.round(c.b*255)}t.toHex=s;function a(c,h){return c.r===h.r&&c.g===h.g&&c.b===h.b}t.equals=a;function o(c,h){return c.r.toFixed(2)===h.r.toFixed(2)&&c.g.toFixed(2)===h.g.toFixed(2)&&c.b.toFixed(2)===h.b.toFixed(2)}t.equalsFixed=o;function l(c,h,u){return{r:c.r+(h.r-c.r)*u,g:c.g+(h.g-c.g)*u,b:c.b+(h.b-c.b)*u}}t.lerp=l})(Hs||(Hs={}));var sr;(t=>{t.white={...Hs.white,a:1},t.transparent={...Hs.white,a:0};function e(l){return{r:l[0],g:l[1],b:l[2],a:l[3]}}t.from0to1=e;function i(l,c){return{...Hs.fromHex(l),a:c}}t.fromHexAndA=i;function r(l){return{r:Math.round(l.r*255),g:Math.round(l.g*255),b:Math.round(l.b*255),a:l.a}}t.toRgb255a1=r;function n(l,c){return Hs.equals(l,c)&&l.a===c.a}t.equals=n;function s(l,c){return Hs.equalsFixed(l,c)&&l.a.toFixed(2)===c.a.toFixed(2)}t.equalsFixed=s;function a(l,c,h){return{r:l.r+(c.r-l.r)*h,g:l.g+(c.g-l.g)*h,b:l.b+(c.b-l.b)*h,a:l.a+(c.a-l.a)*h}}t.lerp=a;function o({r:l,g:c,b:h,a:u}=t.white){return`rgba(${l*255}, ${c*255}, ${h*255}, ${u})`}t.toStyle=o})(sr||(sr={}));var lN;(t=>t.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(lN||(lN={}));var GY;(t=>t.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(GY||(GY={}));var VY;(t=>t.defaultData={control1:[.5,0],control2:[.5,1]})(VY||(VY={}));var vf;(t=>(t.linear=[0,0,1,1],t.ease=[.25,.1,.25,1],t.easeIn=[.42,0,1,1],t.easeOut=[0,0,.58,1],t.easeInOut=[.42,0,.58,1]))(vf||(vf={}));function HY(t){return typeof t=="string"&&t.length===36?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t):!1}var jg;(t=>{t.all=["PerspectiveCamera","OrthographicCamera"];function e(i){return t.all.includes(i)}t.is=e})(jg||(jg={}));var d1;(t=>{t.DefaultUp=[0,1,0],t.DefaultTargetOffset=1e3,t.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:t.DefaultUp,isUpVectorFlipped:!1,targetOffset:t.DefaultTargetOffset};function e(i){var r,n;return i.type==="PerspectiveCamera"?((r=i.perspective)==null?void 0:r.zoom)??1:((n=i.orthographic)==null?void 0:n.zoom)??1}t.getZoom=e})(d1||(d1={}));var Of;(t=>{function e(r,n=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(r[0],r[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[r[0]+r[0]*n,0,0]},grid:{count:[2,2,2],size:r.map(s=>s*(1+n)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}t.defaultData=e;function i(r,n){let s={...r};if(coe.forEach(a=>{Object.assign(s,{[a]:n[a]??r[a]})}),s.radial={...r.radial},n.radial){let a=r.radial,o=n.radial;hoe.forEach(l=>{Object.assign(s.radial,{[l]:o[l]??a[l]})})}if(s.linear={...r.linear},n.linear){let a=r.linear,o=n.linear;uoe.forEach(l=>{Object.assign(s.linear,{[l]:o[l]??a[l]})})}if(s.grid={...r.grid},n.grid){let a=r.grid,o=n.grid;doe.forEach(l=>{Object.assign(s.grid,{[l]:o[l]??a[l]})})}if(s.toObject={...r.toObject},n.toObject){let a=r.toObject,o=n.toObject;foe.forEach(l=>{Object.assign(s.toObject,{[l]:o[l]??a[l]})})}if(s.randomnessObject={...r.randomnessObject},n.randomnessObject){let a=r.randomnessObject,o=n.randomnessObject;poe.forEach(l=>{Object.assign(s.randomnessObject,{[l]:o[l]??a[l]})})}return s}t.merge=i})(Of||(Of={}));var cN;(t=>{t.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let e=["radial","linear","grid","toObject","randomnessObject"];function i(r,n){let s=[];r.count!==void 0&&s.push({type:0,path:n,props:{count:r.count}});for(let a of e){let o=r[a];o&&Object.keys(o).length>0&&s.push({type:0,path:[...n,a],props:o})}return s}t.toOps=i})(cN||(cN={}));var coe=["count"],hoe=["radius","start","end","position","scale","rotation"],uoe=["position","scale","rotation"],doe=["count","size"],foe=["count","position","scale","rotation"],poe=["strength","scale","rotation","position","movement","seed","freqScale"],hN;(t=>{t.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function e(i){return t.all.includes(i)}t.is=e})(hN||(hN={}));var uN;(t=>{function e(r){return i(r)}t.defaultData=e;function i(r){if(r==="PointLight")return{type:r,color:sr.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(r==="SpotLight")return{type:r,color:sr.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:sr.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(uN||(uN={}));var q2;(t=>(t.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},t.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},t.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:t.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1,...t.defaultCollisionData}))(q2||(q2={}));var f1;(t=>t.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(f1||(f1={}));var dN;(t=>{t.defaultData={castShadow:!0,receiveShadow:!0};function e(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}t.equals=e})(dN||(dN={}));var fN;(t=>{t.defaultData={flatShading:!1,wireframe:!1,side:0};function e(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}t.equals=e})(fN||(fN={}));var pN;(t=>t.defaultData={...fN.defaultData,...dN.defaultData})(pN||(pN={}));var jY;(t=>{function e(i,r){var s,a;let n=[];if("material"in i){let o=typeof i.material=="string"?r.materials[i.material]??((s=r.lib.materials[i.material])==null?void 0:s.asset):i.material;o&&n.push(o)}else if("materials"in i)for(let o of i.materials){let l=typeof o=="string"?r.materials[o]??((a=r.lib.materials[o])==null?void 0:a.asset):o;l&&n.push(l)}return n}t.getMaterialData=e})(jY||(jY={}));var K2;(t=>(t.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},t.maxSize=3e7))(K2||(K2={}));var WY;(t=>{function e(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="particle"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}t.is=e})(WY||(WY={}));function UGe(t){return t.type!=="displace"}var XY;(t=>{function e(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}t.is=e})(XY||(XY={}));var moe=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],zGe=["wrapping","image","video","name","minFilter","magFilter"],ys;(t=>{function e(s,a){let{texture:o,...l}=a;if(Object.assign(s,l),o){let c=s.texture;c&&Object.assign(c,o)}}t.patch=e;function i(s,a){return s==="light"&&a?r(a):n(s)}t.defaultData=i;function r(s){let a={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(s){case"phong":return{...a,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...a,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...a,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...a,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function n(s){let a={alpha:1,mode:0,isMask:!1,visible:!0};switch(s){case"texture":return{...a,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"video":return{...a,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:K2.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"color":return{...a,type:"color",color:Hs.fromHex(Yo)};case"depth":return{...a,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...a,type:"normal",cnormal:[1,1,1]};case"gradient":return{...a,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...a,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...Hs.fromHex(6710886),a:1},colorB:{...Hs.fromHex(6710886),a:1},colorC:{...Hs.fromHex(16777215),a:1},colorD:{...Hs.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...a,type:"fresnel",color:sr.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...a,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...a,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:sr.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...a,type:"outline",outlineColor:sr.fromHexAndA(0,1),contourColor:sr.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...a,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}};case"transmission":return{...a,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...a,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...Hs.fromHex(0),a:1},colorB:{...Hs.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(ys||(ys={}));var Es;(t=>{function e(h){return!h.layers.some(u=>u.data.type==="texture"&&u.data.projection!==0||u.data.type==="depth"&&!u.data.isWorldSpace||u.data.type==="noise"||u.data.type==="displace")}t.isMergable=e;function i(h){let u="";return h.layers.forEach(d=>{Object.entries(d.data).forEach(([f,p])=>{u+=`${f}${p}`,Array.isArray(p)?p.forEach(m=>u+=`${m}`):typeof p=="object"?Object.values(p).forEach(m=>{typeof m=="number"?u+=`${m.toFixed(4)}`:u+=`${m}`}):u+=`${p}`})}),u}t.getHash=i;function r(){return{layers:new Ut}}t.defaultEmptyData=r;function n(h="layer1",u="layer2"){return a("phong",h,u)}t.defaultData=n;function s(h,u){return{...h,name:u}}t.withName=s;function a(h,u="layer1",d="layer2"){let f=new Ut;return f.push({fi:0,data:ys.defaultData("light",h),id:u}),f.push({fi:1,data:ys.defaultData("color"),id:d}),{layers:f}}t.defaultTwoLayerData=a;function o(h){let u=ys.defaultData("texture");h&&Object.assign(u.texture,{image:h});let d=new Ut;return d.push({fi:0,data:u,id:"layer1"}),d.push({fi:1,data:{...ys.defaultData("transmission"),alpha:1},id:"layer2"}),d.push({fi:2,data:{...ys.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:d}}t.defaultUIObjectMaterial=o;function l(h,u="phong",d="layer1",f="layer2"){let p=ys.defaultData("texture");Object.assign(p.texture,{image:h});let m=new Ut;return m.push({fi:0,data:p,id:d}),m.push({fi:1,data:ys.defaultData("light",u),id:f}),{layers:m}}t.defaultTwoLayerTextureData=l;function c(h,u="phong",d="layer1",f="layer2"){let p=ys.defaultData("video");Object.assign(p.texture,{video:h});let m=new Ut;return m.push({fi:0,data:p,id:d}),m.push({fi:1,data:ys.defaultData("light",u),id:f}),{layers:m}}t.defaultTwoLayerVideoTextureData=c})(Es||(Es={}));var Q2;(t=>{function e(){return{points:new Ut,roundness:0,shapeHoles:[],isClosed:!1}}t.defaultData=e})(Q2||(Q2={}));var $2;(t=>{function e(){return{points:new Ut,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}t.defaultData=e})($2||($2={}));var goe={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0},mN;(t=>{function e(i,r){let n={...i};return yoe.forEach(s=>{Object.assign(n,{[s]:r[s]??i[s]})}),n}t.merge=e})(mN||(mN={}));var voe={shape:goe,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},yoe=["depth","offset","angle","twist","startScale","endScale"],J2;(t=>{function e(r){return r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="UIGeometry"}t.is2DParametricMesh=e;function i(r){return r==="PolygonGeometry"||r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="PathGeometry"||r==="VectorGeometry"||r==="ConeGeometry"||r==="CubeGeometry"||r==="CylinderGeometry"||r==="DodecahedronGeometry"||r==="HelixGeometry"||r==="IcosahedronGeometry"||r==="LatheGeometry"||r==="PyramidGeometry"||r==="SphereGeometry"||r==="PlaneGeometry"||r==="BackdropGeometry"||r==="TorusGeometry"||r==="TorusKnotGeometry"||r==="BooleanGeometry"||r==="TextGeometry"||r==="InputGeometry"}t.isParametricMesh=i})(J2||(J2={}));var gN;(t=>{function e(i,r){let n={...i};return Object.assign(n,r),n.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(n.extrusion={...i.extrusion},Object.assign(n.extrusion,mN.merge(n.extrusion,r.extrusion))),n}t.merge=e})(gN||(gN={}));var wf;(t=>{function e(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="UIGeometry")return{type:i,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:$2.defaultData(),extrusion:voe};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:Q2.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="ShapeBlendGeometry")return{type:i,width:0,height:0,depth:0,resolutionLevel:6,blendRange:100,useChildrenColors:!1};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="InputGeometry")return{...t.defaultData("TextGeometry"),type:i,editable:!0};if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}t.defaultData=e})(wf||(wf={}));var q3=["width","height","depth"],vN;(t=>t.defaultData={enabled:!1,useBackgroundColor:!1,color:Hs.white,near:.1,far:2e3})(vN||(vN={}));var Z2;(t=>{let e={opacity:1,blendFunction:13,enabled:!1};t.defaultData={enabled:!1,pixelation:{...e,blendFunction:16,granularity:15},bloom:{...e,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...e,offset:[2,2]},vignette:{...e,darkness:1,offset:0},hueSaturation:{...e,hue:3,saturation:0},brightnessContrast:{...e,brightness:.25,contrast:0},depthOfField:{...e,focusDistance:100,focalLength:20,bokehScale:5},noise:{...e,blendFunction:16}}})(Z2||(Z2={}));var yN;(t=>t.defaultData={softShadowQuality:"low"})(yN||(yN={}));var xN;(t=>t.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(xN||(xN={}));var bN;(t=>t.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(bN||(bN={}));var p1;(t=>t.defaultData={usePhysics:!1,gravity:-10})(p1||(p1={}));var wN;(t=>t.defaultData={playCamera:J1,gameControlObject:null})(wN||(wN={}));var SN;(t=>t.defaultData={backgroundColor:sr.fromHexAndA(NGe,1),postprocessing:Z2.defaultData,fog:vN.defaultData,globalPhysics:p1.defaultData,ambient:xN.defaultData,ao:bN.defaultData,shadow:yN.defaultData,publish:wN.defaultData})(SN||(SN={}));var _N;(t=>t.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95})(_N||(_N={}));var YY;(t=>{function e(r){return r==="Component"||r==="Instance"}t.isComponentRelated=e;function i(r){return r==="Empty"||r==="Instance"}t.isEmptyOrComponent=i})(YY||(YY={}));var m1;(t=>{t.identity={...lN.identity,hiddenMatrix:u1.identity};function e(n){return{position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix}}t.fromObject=e;function i(n,s){return{position:(s==null?void 0:s.position)||n.position,rotation:(s==null?void 0:s.rotation)||n.rotation,scale:(s==null?void 0:s.scale)||n.scale,hiddenMatrix:(s==null?void 0:s.hiddenMatrix)||n.hiddenMatrix}}t.merge=i;function r(n,s){return Oae({position:xg.isEqual(n.position,s.position)?void 0:s.position,rotation:xg.isEqual(n.rotation,s.rotation)?void 0:s.rotation,scale:xg.isEqual(n.scale,s.scale)?null:s.scale,hiddenMatrix:u1.isEqual(n.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})}t.diff=r})(m1||(m1={}));var ts;(t=>t.defaultData={states:new Ut,events:new Ut,visible:!0,raycastLock:!1,physics:f1.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...m1.identity,cloner:null})(ts||(ts={}));var AN;(t=>t.defaultData={type:"Empty",...ts.defaultData})(AN||(AN={}));var qY;(t=>t.defaultData={type:"ParticleCollider",..._N.defaultData,...ts.defaultData})(qY||(qY={}));var KY;(t=>t.defaultData={type:"Component",...ts.defaultData})(KY||(KY={}));var QY;(t=>t.defaultData={type:"Particle",...ts.defaultData,...q2.defaultData})(QY||(QY={}));var Sf;(t=>t.defaultData={type:"Mesh",...ts.defaultData,...pN.defaultData})(Sf||(Sf={}));var AS;(t=>t.defaultData={...ts.defaultData,...m1.identity,position:[0,0,d1.DefaultTargetOffset],...d1.defaultData})(AS||(AS={}));var EN;(t=>{function e(i){return{...ts.defaultData,...uN.defaultData(i)}}t.defaultData=e,t.defaultDirectionalLightData={...t.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(EN||(EN={}));var eP;(t=>{function e(r,n,s=0){for(;s<n.length;){let a=r?r[n[s]]:void 0;if(n.length===s+1)return a;if(a)r=a.descendants,s+=1;else return}}t.resolveWithDes=e;function i(r,n,s=0){let a=e(r,n,s);if(a){let o=Object.keys(a);if(o.length===1&&o[0]==="descendants")return}return a}t.resolve=i})(eP||(eP={}));var Bf;(t=>{t.rootOverrideProps=["physics","events"],t.compositeNonOptionalOverrideProps=["geometry"],t.compositeEntireOverrideOverrideProps=["material"];function e(r,n){return{...ts.defaultData,...n,component:r,overrides:new Un,physics:void 0,events:void 0,type:"Instance"}}t.ofComponent=e;function i(r){let n=m1.fromObject(r.data);return e(r.id,n)}t.fromComponentData=i})(Bf||(Bf={}));var g1;(t=>{t.defaultData={type:"Page",...ts.defaultData,physics:{...f1.defaultData,fusedBody:!1},...SN.defaultData,camera:AS.defaultData};function e(i){return i.uiScene!==void 0}t.isUIPage=e})(g1||(g1={}));var MN;(t=>(t.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:u1.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:f1.defaultData,states:new Ut,events:new Ut,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...d1.defaultData},t.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},t.defaultMeshObject={name:"Rectangle",...ts.defaultData,...Sf.defaultData,geometry:wf.defaultData("RectangleGeometry"),material:Es.defaultTwoLayerData("phong","layer1","layer2")},t.defaultBooleanObject={name:"Boolean",...ts.defaultData,...Sf.defaultData,geometry:wf.defaultData("BooleanGeometry"),material:Es.defaultTwoLayerData("phong","layer1","layer2")},t.defaultShapeBlendObject={name:"Shape Blend",...ts.defaultData,...Sf.defaultData,geometry:wf.defaultData("ShapeBlendGeometry"),material:Es.defaultTwoLayerData("phong","layer1","layer2")},t.defaultTextObject={name:"Text",...ts.defaultData,...Sf.defaultData,geometry:wf.defaultData("TextGeometry"),material:Es.defaultTwoLayerData("phong","layer1","layer2")},t.defaultInputObject={name:"Input",...ts.defaultData,...Sf.defaultData,geometry:wf.defaultData("InputGeometry"),material:Es.defaultTwoLayerData("phong","layer1","layer2")}))(MN||(MN={}));var Km;(t=>{function e(s,a){let o={name:a};return s.type==="Mesh"?(o.geometry={},"material"in s&&(o.material={layers:new Un}),"materials"in s&&(o.materials=s.materials.map(l=>({layers:new Un})))):jg.is(s.type)&&(o.perspective={},o.orthographic={}),o}t.newEmpty=e;function i(s,a){if(a===void 0)return s;let o={...s};return"material"in o&&"material"in a&&a.material&&(o.material=_S(o.material,l=>{if(typeof l!="string")for(let[c,h]of Object.entries(a.material.layers)){let u=l.layers.data(c);u&&ys.patch(u,h)}}).data),o.materials&&a.materials&&(o.materials=_S(o.materials,l=>{var c,h;for(let u=0;u<o.materials.length;u++){let d=a.materials[u];if(typeof d!="string")for(let[f,p]of Object.entries(d.layers)){let m=(h=(c=l[u])==null?void 0:c.layers)==null?void 0:h.data(f);m&&ys.patch(m,p)}}}).data),o}function r(s,a){let o,l=[],c={orthographic:0,perspective:0,geometry:0};function h(u,d){for(let[f,p]of Object.entries(d.layers)){let{texture:m,...g}=p;if(m!==void 0&&Object.keys(m).length>0){let v={path:[...u,"layers",f,"texture"],props:m,type:0};l.push(v)}if(Object.keys(g).length>0){let v={path:[...u,"layers",f],props:g,type:0};l.push(v)}}}for(let[u,d]of Object.entries(a))if(u!=="name")if(u==="cloner")l.push(...cN.toOps(d,["cloner"]));else if(u==="pathSnapping")l.push({path:[u],props:{slide:d.slide,offset:d.offset},type:0});else if(u==="material")h(["material"],d);else if(u==="materials")for(let[f,p]of Object.entries(d))h(["materials",f],p);else if(c[u]===0){if(u==="geometry"&&d.extrusion!==void 0){let f={path:[u,"extrusion"],props:d.extrusion,type:0};l.push(f),d={...d},delete d.extrusion}if(Object.keys(d).length>0){let f={path:[u],props:d,type:0};l.push(f)}}else o===void 0&&(o={path:[],props:{},type:0},l.push(o)),o.props[u]=d;return l}t.toOps=r;function n(s,a){var l,c,h,u,d,f;if(a===void 0)return s;let o={...s};if(Object.assign(o,m1.merge(o,a)),Object.assign(o,{pathSnapping:Object.assign({},o.pathSnapping,{slide:((l=a.pathSnapping)==null?void 0:l.slide)??((c=o.pathSnapping)==null?void 0:c.slide)??0,offset:((h=a.pathSnapping)==null?void 0:h.offset)??((u=o.pathSnapping)==null?void 0:u.offset)??0})}),jg.is(s.type)){o.orthographic={...o.orthographic},o.perspective={...o.perspective};let p=a;((d=p.orthographic)==null?void 0:d.zoom)!==void 0&&(o.orthographic.zoom=p.orthographic.zoom),((f=p.perspective)==null?void 0:f.zoom)!==void 0&&(o.perspective.zoom=p.perspective.zoom),p.isUpVectorFlipped!==void 0&&(o.isUpVectorFlipped=p.isUpVectorFlipped),p.targetOffset!==void 0&&(o.targetOffset=p.targetOffset)}else if(s.type==="Mesh")"geometry"in a&&Object.assign(o,{geometry:gN.merge(o.geometry,a.geometry)}),(a.material||a.materials)&&(o=i(o,a)),o.cloner&&"cloner"in a&&Object.assign(o,{cloner:Of.merge(o.cloner,a.cloner)});else if(s.type==="Empty")o.cloner&&"cloner"in a&&Object.assign(o,{cloner:Of.merge(o.cloner,a.cloner)});else if(hN.is(s.type)){let p=a;p.intensity!==void 0&&(o.intensity=p.intensity),p.color!==void 0&&(typeof p.color=="string"?o.color=p.color:o.color=Hs.clone(p.color))}return o}t.patch=n})(Km||(Km={}));var tP;(t=>t.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(tP||(tP={}));var Ff;(t=>t.defaultData={orbitControls:tP.defaultData,playPage:pw,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((e,i)=>{let r=0,n=0;return i<5?n=-30:i<10&&(n=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,n],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70}},stopRaycast:!0,hdTransmission:!1})(Ff||(Ff={}));var TN;(t=>t.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(TN||(TN={}));var CN;(t=>t.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(CN||(CN={}));var Qm;(t=>(t.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...TN.defaultData},isRandomSeed:!0,seed:t.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:CN.defaultData}),t.generateSeed=()=>Math.round(Math.random()*1e5)))(Qm||(Qm={}));var ES;(t=>{function e(r){return r.find(n=>n.data.type==="Page"&&n.data.globalPhysics.usePhysics)!==void 0}t.physicsEnabled=e;function i(r,n,s){r.scene.objects.traverseFrom(n,(a,o)=>{var l;if(o.type==="Instance"){let c=(l=nP.getComponentData(r,o.component))==null?void 0:l.data;c&&s(a,o,c.events)}else s(a,o,o.events)})}t.traverseModuleInstances=i})(ES||(ES={}));var $m;(t=>{t.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",t.defaultLight={fi:-1,data:EN.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]};function e(n=!0,s=[]){let a=[],o=MN.defaultMeshObject;n&&(a.push({...t.defaultLight}),a.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:o,children:[]})),a.push(...s);let l=new Xs;return l.push({fi:1,id:pw,data:{...g1.defaultData,name:"Scene 1"},children:a}),l}t.createDefaultObjectTreeWithPage=e,t.defaultData={objects:e(),publish:Ff.defaultData,styles:Qm.defaultData()},t.emptyDataWithoutPage=function(){return{objects:new Xs,publish:Ff.defaultData,styles:Qm.defaultData()}},t.emptyDataWithPage=function(n=!0){return{objects:e(n),publish:Ff.defaultData,styles:Qm.defaultData()}},t.emptyData=function(){return{objects:new Xs,publish:{...Ff.defaultData},styles:Qm.defaultData()}};function i(n){return{...t.defaultData,objects:Xl(n,Xs.prototype)}}t.withObjs=i;function r(n,s){return i([{id:n,data:s,children:[],fi:0}])}t.withObj=r})($m||($m={}));var mw;(t=>t.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(mw||(mw={}));var PN;(t=>(t.defaultData=e=>({url:e,name:"New Webhook",parametersSchemas:new Ut}),t.defaultParameterValueByType=e=>e==="number"?0:e==="boolean"?!1:""))(PN||(PN={}));var $Y;(t=>t.defaultData=(e,i="GET")=>({url:e,method:i,name:"New API",headers:new Ut,queries:new Ut,autoStart:!0}))($Y||($Y={}));var Ys;(t=>{function e(a){return a.textValue!==void 0}t.isTextValue=e;function i(a){return typeof a=="number"}t.isNumber=i;function r(a){return typeof a=="boolean"}t.isBoolean=r;function n(a){return e(a)?"string":r(a)?"boolean":"number"}t.typeOfVariable=n;function s(a){return t.isTextValue(a)?Array.isArray(a.textValue)?a.textValue.map(o=>o.toString().padStart(a.padding??2,"0")).join(a.deliminator??":")+(a.suffix!==void 0?" "+a.suffix:""):a.textValue.toString():t.isBoolean(a)?a?"True":"False":t.isNumber(a)?parseFloat(a.toFixed(3)).toString():a.toString()}t.getDisplayedValue=s})(Ys||(Ys={}));var DN;(t=>t.all=["images","videos","colors","audios","particles","fonts","materials","variables"])(DN||(DN={}));var JY;(t=>t.all=[...DN.all,"components"])(JY||(JY={}));var ZY;(t=>{function e(){return{images:new Wt,videos:new Wt,colors:new Wt,audios:new Wt,particles:new Wt,fonts:new Wt,materials:new Wt,components:new Wt,variables:new Wt,userAPIs:new Wt,userWebhooks:new Wt}}t.defaultData=e})(ZY||(ZY={}));var gd;(t=>{function e(){return{images:new Wt,videos:new Wt,colors:new Wt,audios:new Wt,particles:new Wt,fonts:new Wt,materials:new Wt,components:new Wt,variables:new Wt,userAPIs:new Wt,userWebhooks:new Wt}}t.defaultData=e})(gd||(gd={}));var El;(t=>{function e(){let a={};return a["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},Xl(a,Wt.prototype)}t.defaultColors=e;function i(){return Xl({},Wt.prototype)}t.defaultImages=i;function r(){return{catelogs:new Wt,materials:new Wt,images:new Wt,videos:new Wt,colors:new Wt,audios:new Wt,particles:new Wt,fonts:new Wt,variables:new Ut,userAPIs:new Wt,userWebhooks:new Wt,lib:gd.defaultData()}}t.emptyData=r;function n(a){switch(a){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let o=[0,0,0];return{name:"Time",value:{textValue:o,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:o,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",a)}}t.defaultVariables=n;function s(a,o){if(o.format==="HH:mm:ss"){let l=Math.floor(a/3600),c=Math.floor((a-l*3600)/60),h=Math.round(a-l*3600-c*60);return{textValue:[l,c,h]}}else if(o.format==="mm:ss"){let l=Math.floor(a/60),c=Math.round(a-l*60);return{textValue:[l,c]}}else return o.format==="number"?a=Math.round(a):a=Math.round(a*1e3)/1e3,a}t.getFormattedTimerTime=s})(El||(El={}));var iP;(t=>t.list=["idle","move","jump","run"])(iP||(iP={}));var rP;(t=>(t.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},t.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX",""],["rotPosY",""],["rotNegX",""],["rotNegY",""],["jump","Space"],["run",""],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:t.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new Ut,move:new Ut,jump:new Ut,run:new Ut},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:sr.fromHexAndA(3728051,1)}}))(rP||(rP={}));function eq(t){t.layers.forEach(e=>{if(e.type==="depth"&&e.colorA!==void 0){let i=e.colorA,r=e.colorB,n=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],s=[0,1];for(let o=2;o<10;o++)n.push(n[1]),s.push(1);let a={...Oh(wn(e),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,e.near),far:Math.max(0,e.far),colors:n,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(e,a)}else if(e.type==="depth"&&e.gradientType===1&&(e.near<0||e.far<0)){let i={...wn(e),near:Math.max(e.near,0),far:Math.max(e.far,0)};Object.assign(e,i)}})}function _f(t,e){Object.values(t.shared.materials).forEach(i=>e(i))}function Af(t,e){t.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach((n,s)=>{n===void 0&&(r.materials[s]=Es.defaultData(),n=r.materials[s]),typeof n!="string"&&e(n)}):"material"in r?typeof r.material!="string"&&(r.material===void 0&&(r.material=Es.defaultData()),e(r.material)):r.type==="Mesh"&&(r.material===void 0&&(r.material=Es.defaultData()),e(r.material)),"overrides"in r&&Object.values(r.overrides).forEach(n=>{n.material&&typeof n.material!="string"&&Object.getPrototypeOf(n.material)!==Un.prototype&&e(n.material)})})}function GGe(t){Object.assign(t.scene.publish,{orbitControls:{...tP.defaultData,...wn(t.scene.publish.orbitControls)}})}function VGe(t){Object.assign(t.scene.publish.settings,{video:{...Ff.defaultData.settings.video,...wn(t.scene.publish.settings.video)}})}function HGe(t){function e(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[n,s]of Object.entries(r))if((moe.includes(n)||typeof s=="boolean")&&delete r[n],n==="texture")for(let[a,o]of Object.entries(s))(zGe.includes(a)||typeof o=="boolean")&&delete s[a]}}}t.scene.objects.traverse((i,r)=>{r.states.forEach(n=>{let s=n;s.material?e(s.material):s.materials&&s.materials.forEach(a=>{e(a)})})})}function jGe(t){t.scene.publish.withBackground=!0}function WGe(t){t.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function XGe(t){t.scene.objects.traverse((e,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(n=>n+1),r.linear.scale=r.linear.scale.map(n=>n+1))})}function YGe(t){t.scene.objects.traverse((e,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function qGe(t){t.scene.objects.traverse((e,i)=>{let r=t.scene.objects.unproxy().parent(e);if(r){let n=wn(t.scene.objects.data(r));n&&n.type==="Mesh"&&n.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=wn(i).booleanExclude!==!0)}})}function KGe(t){t.scene.objects.traverse((e,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function QGe(t){function e(r){Object.setPrototypeOf(r,Un.prototype),r.texture&&Object.setPrototypeOf(r.texture,Un.prototype)}function i(r){Object.setPrototypeOf(r,Un.prototype);for(let n in r)e(r[n])}t.scene.objects.traverse((r,n)=>{n.states.forEach(s=>{let a=s;if(a.material){let o=wn(a.material).layers;i(o),a.material.layers=o}if(a.materials)for(let o=0;o<a.materials.length;o++){let l=a.materials[o],c=wn(l).layers;i(c),l.layers=c}})})}function tq(t){t.layers===void 0&&Object.assign(t,Es.defaultTwoLayerData("lambert"))}function K3(t){!t.layers||t.layers.forEach(e=>{if(e.type==="depth"&&e.colors.length===10){let i=[...e.colors];i.push(e.colors[9]);let r=[...e.steps];r.push(e.steps[9]);let n={...wn(e),colors:i,steps:r};Object.assign(e,n)}})}function $Ge(t){t.scene.objects.traverse((e,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function iq(t){t.scene.objects.traverse((e,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&K3(r)}):"material"in i&&typeof i.material!="string"&&K3(i.material)}),Object.values(t.shared.materials).forEach(e=>K3(e))}function JGe(t){t.scene.environment.ambientLight.softShadows=!1,t.scene.environment.ambientLight.softShadowQuality="low",t.scene.objects.traverse((e,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),t.shared.penumbraSize=new Array(5).fill(.5)}function ZGe(t){t.shared.audios=Xl({},Wt.prototype)}function eVe(t){t.shared.videos=Xl({},Wt.prototype)}function tVe(t){let e=t.shared.materials;Object.entries(e).forEach(([i,r])=>{if(!r.layers){let n={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(e,{[i]:n})}})}function iVe(t){Object.entries(wn(t.shared.images)).filter(e=>e[1].asset===!1).map(e=>e[0]).forEach(e=>{delete t.shared.images[e]}),Object.entries(wn(t.shared.audios)).filter(e=>e[1].asset===!1).map(e=>e[0]).forEach(e=>{delete t.shared.audios[e]})}function rVe(t){t.scene.publish.settings.web.preload=!1}function rq(t){t.layers&&t.layers.forEach(e=>{e.type==="depth"&&e.num!==void 0&&(e.colors=e.colors.slice(0,e.num),e.steps=e.steps.slice(0,e.num),delete e.num)})}function nq(t){t.layers&&t.layers.forEach(e=>{UGe(e)&&e.isMask===void 0&&(e.isMask=!1),(e.type==="texture"||e.type==="video")&&e.blending===void 0&&(e.blending=0),(e.type==="noise"||e.type==="displace"&&e.displacementType==="noise")&&(e.voronoiStyle===void 0&&(e.voronoiStyle=0),e.highCut===void 0&&(e.highCut=1),e.lowCut===void 0&&(e.lowCut=0),e.smoothness===void 0&&(e.smoothness=.3),e.seed===void 0&&(e.seed=0),e.quality===void 0&&(e.quality=1))})}function nVe(t){t.shared.fonts=Xl({},Wt.prototype)}function sVe(t){return t.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function aVe(t){let e=[];t.scene.objects.traverse((i,r)=>{let n=r;if(n.type==="TextFrame"){let s=Es.defaultTwoLayerData("phong"),a=typeof n.color=="string"?t.shared.colors[n.color]:n.color;s.layers[1].data.color={r:a.r,g:a.g,b:a.b},s.layers[1].data.alpha=n.alpha;let o=sVe(n.font);t.shared.fonts[o]===void 0&&(t.shared.fonts[o]={name:o});let l={name:n.name,...ts.defaultData,...Sf.defaultData,flatShading:!1,wireframe:!1,geometry:{...wf.defaultData("TextGeometry"),width:n.width,height:n.height,font:o,depth:0,horizontalAlign:n.horizontalAlign,verticalAlign:n.verticalAlign,fontSize:n.fontSize*1.40625,lineHeight:n.lineHeight/1.40625,letterSpacing:n.letterSpacing-1,text:n.text,textTransform:n.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:wn(n.states),events:wn(n.events),visible:n.visible,raycastLock:n.raycastLock,position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix},c=wn(t.scene.objects).parent(i);t.scene.objects.insertAfter(c??null,i,[{id:i+"new",data:l,children:[]}]),e.push(i)}}),e.forEach(i=>{t.scene.objects.delete(i)})}function oVe(t){let e={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};t.scene.objects.traverse((i,r)=>{r.events.forEach(n=>{if(e[Number(n.type)])if(Object.assign(n,{type:e[Number(n.type)]}),n.type==="Audio"&&"audioEvent"in n&&(Object.assign(n,{playAudio:n.audioEvent}),delete n.audioEvent),n.type==="GameControl")Object.assign(n,{gameActions:{idle:new Ut,move:new Ut,jump:new Ut}});else{let s=new Ut;Object.assign(n,{actions:s}),(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp")&&"url"in n&&s.push({fi:0,id:Et.generateUUID(),data:{type:"Link",url:n.url,delay:0}}),"targets"in n&&(n.targets.forEach((a,o,l)=>{let c={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},h={easing:a.easing,duration:a.duration};a.easing===6?Object.assign(h,Oh(a,"mass","stiffness","damping","velocity")):a.easing===5&&Object.assign(h,{control1:{...a.control1},control2:{...a.control2}});let u={repeat:a.repeat?-1:0,delay:a.delay,delayDirection:a.delayDirection,direction:a.cycle&&a.rewind?"pingpong-rewind":a.cycle?"pingpong":"normal"},d={state:a.state,...u,...h},f={allowSlerp:!0,type:"Transition",object:a.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new Ut({fi:0,id:Et.generateUUID(),data:c},{fi:1,id:Et.generateUUID(),data:d})};s.push({fi:l,id:o,data:f})}),delete n.targets)}})})}function lVe(t){t.scene.objects.traverse((e,i)=>{function r(n,s){var l;let a=new Ut,o=[];if(i.events.forEach((c,h,u)=>{if(c.type==="Audio"&&c.trigger===s){let d;o.push(h),c.interaction==="play"?d={...Oh(c,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in c?c.after:void 0,toggle:"after"in c?c.toggle:void 0,type:"Audio"}:(c.interaction==="pause"||c.interaction==="stop")&&(d={...Oh(c,"interaction","delay","object","playAudio"),type:"Audio"}),d&&a.push({fi:u,id:h,data:d})}}),o.forEach(c=>i.events.delete(c)),a.length){let c=(l=i.events.find(h=>h.type===n))==null?void 0:l.data;c?"actions"in c&&c.actions.insertBefore(null,a):i.events.insertBefore(null,[{id:Et.generateUUID(),data:{type:n,actions:a}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function sq(t){var i;let e=(i=t.layers.find(r=>r.type==="light"))==null?void 0:i.data;if((e==null?void 0:e.category)==="basic"){let r=ys.defaultData("light","phong"),n=e;Object.assign(n,r),n.visible=!1}}function aq(t){_f(t,sq),Af(t,sq)}function cVe(t){t.scene.objects.traverse((e,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function hVe(t){t.scene.objects.traverse((e,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function uVe(t){t.scene.objects.traverse((e,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=Es.defaultTwoLayerData("phong"))})}function dVe(t){t.scene.publish.orbitControls.autoZoom===void 0&&(t.scene.publish.orbitControls.autoZoom=!1),t.scene.objects.traverse((e,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function fVe(t){t.scene.objects.traverse((e,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function pVe(t){t.scene.publish.mouseEventTarget===void 0&&(t.scene.publish.mouseEventTarget="canvas"),t.scene.publish.settings.web.hint===void 0&&(t.scene.publish.settings.web.hint=!1)}function mVe(t){let{video:e}=t.scene.publish.settings;e.format==="gif"&&e.fps>48&&(e.fps=15)}function gVe(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function vVe(t){let e=t.scene.environment.usePhysics;t.scene.objects.traverse((i,r)=>{e&&r.physics===null?r.collision=!1:r.collision="visibility"})}function yVe(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.navmesh=rP.defaultDataThirdPerson.navmesh)})})}function xVe(t){t.scene.styles||(t.scene.styles=Qm.defaultData())}function oq(t){t.layers.forEach(e=>{e.type==="light"&&e.category!=="toon"&&e.occlusion===void 0&&(e.occlusion=!0)})}function bVe(t){t.scene.environment.ambientLight.occlusion===void 0&&(t.scene.environment.ambientLight.occlusion=!1),t.scene.environment.ambientLight.aoFullRes===void 0&&(t.scene.environment.ambientLight.aoFullRes=!1),t.scene.environment.ambientLight.radius===void 0&&(t.scene.environment.ambientLight.radius=256),t.scene.environment.ambientLight.bias===void 0&&(t.scene.environment.ambientLight.bias=.5),t.scene.environment.ambientLight.aoColor===void 0&&(t.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),Af(t,oq),_f(t,oq)}function wVe(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&Object.assign(r.gameActions,{run:new Ut})})})}function SVe(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.keyAssignments=[...r.keyAssignments,["run",""],["none","Ctrl"]])})})}function lq(t){t.layers&&t.layers.forEach(e=>{e.type==="light"&&e.bumpMapIntensity===void 0&&(e.bumpMapIntensity=5)})}function _Ve(t,e){if(e<1&&(Af(t,eq),_f(t,eq),t.schema=1),e<2&&(GGe(t),t.schema=2),e<3&&(HGe(t),t.schema=3),e<4&&(jGe(t),t.schema=4),e<5&&(WGe(t),t.schema=5),e<6&&(XGe(t),t.schema=6),e<7&&(YGe(t),t.schema=7),e<8&&(t.schema=8),e<9&&(iq(t),t.schema=9),e<10&&($Ge(t),t.schema=10),e<11&&(JGe(t),t.schema=11),e<12&&(iq(t),t.schema=12),e<13&&(ZGe(t),t.schema=13),e<14&&(tVe(t),t.schema=14),e<15&&(iVe(t),t.schema=15),e<16&&(rVe(t),t.schema=16),e<17&&(Af(t,rq),_f(t,rq),t.schema=17),e<18&&(Af(t,tq),_f(t,tq),t.schema=18),e<19&&(VGe(t),t.schema=19),e<20&&(nVe(t),aVe(t),t.schema=20),e<21&&(oVe(t),lVe(t),t.schema=21),e<22&&(aq(t),t.schema=22),e<23&&(cVe(t),t.schema=23),e<24&&(hVe(t),t.schema=24),(e<25||t.shared.videos===void 0)&&(eVe(t),e<25&&(t.schema=25)),e<26&&(qGe(t),t.schema=26),e<27&&(KGe(t),t.schema=27),e<28&&(aq(t),t.schema=28),e<29&&(QGe(t),t.schema=29),e<30&&(uVe(t),t.schema=30),e<31&&(dVe(t),t.schema=31),e<33&&(fVe(t),t.schema=33),e<34&&(pVe(t),t.schema=34),e<35&&(mVe(t),t.schema=35),e<36&&(gVe(t),t.schema=36),e<37&&(vVe(t),t.schema=37),e<38&&(Af(t,nq),_f(t,nq),t.schema=38),e<39&&(yVe(t),t.schema=39),e<40&&(xVe(t),t.schema=40),e<41&&(bVe(t),t.schema=41),e<42&&(wVe(t),t.schema=42),e<43&&(SVe(t),t.schema=43),e<99){Af(t,lq),_f(t,lq),t.scene.publish.playCamera===null&&(t.scene.publish.playCamera=J1);let i=wn(t.scene.objects),r=t.scene.objects;t.scene.publish.playPage=pw,r.insertBefore(null,null,[{id:pw,data:{...g1.defaultData,backgroundColor:t.scene.backgroundColor,fog:t.scene.fog,postprocessing:t.scene.postprocessing,ao:Oh(t.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:t.scene.publish.playCamera,gameControlObject:t.scene.publish.gameControlObject},shadow:Oh(t.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...p1.defaultData,...Oh(t.scene.environment,"usePhysics","gravity")},camera:wn(t.scene.ownerCamera)??g1.defaultData.camera,name:"Scene"},children:[]}]);for(let a of i)a.id!==$m.TRASH_CAN_ID&&r.move(pw,a.fi,a.id);let n=0,s=0;t.shared.penumbraSize&&t.scene.objects.traverse((a,o)=>{o.type==="DirectionalLight"?(o.penumbraSize=t.shared.penumbraSize[Math.min(n,2)],n+=1):o.type==="SpotLight"&&(o.penumbraSize=t.shared.penumbraSize[3+Math.min(s,1)],s+=1),(o.physics===void 0||o.physics===null)&&o.type!=="Instance"&&(o.physics={},Object.assign(o.physics,f1.defaultData)),o.physics!==void 0&&o.physics!==null&&(o.physics.enabled=o.collision??"visibility",delete o.collision)}),t.schema=99}}function cq(t){t.layers&&t.layers.forEach(e=>{e.type==="light"&&e.alphaOverride===void 0&&(e.alphaOverride=1)})}function AVe(t){t.scene.objects.traverse((e,i)=>{let r=i.geometry;r&&r.type==="PathGeometry"&&(r.extrusion.capType="flat",r.extrusion.bevel=50,r.extrusion.bevelSides=6,r.extrusion.shape.type==="Custom"&&(r.extrusion.shape.shapeQuality="low"))})}function EVe(t){var e;Array.isArray(wn(t.events))&&((e=t.events)==null||e.forEach(i=>{"disabled"in i||(i.disabled=!1),(i.type==="MouseDown"||i.type==="MouseUp"||i.type==="MousePress")&&(i.mode=i.mode||"Object")}))}var Lv=180/Math.PI;function hq(t){t.rotation=t.rotation.slice(0,3).map(e=>e*Lv)}function xoe(t){var i,r;hq(t),t.type==="Page"&&hq(t.camera),(i=t.states)==null||i.forEach(n=>{n.rotation===void 0||n.rotation===null||(n.rotation=n.rotation.slice(0,3).map(s=>s*Lv))});let e=t.geometry;e&&e.type==="SphereGeometry"&&(e.thetaLength=(e.thetaLength??180)*Lv),e&&e.type==="TorusGeometry"&&(e.arc=e.arc*Lv),e&&e.type==="PathGeometry"&&(e.extrusion.angle*=Lv,e.extrusion.twist*=Lv),t.type==="Mesh"&&t.geometry.type==="TextGeometry"&&(t.geometry.text={textValue:t.geometry.text}),Array.isArray(wn(t.events))&&((r=t.events)==null||r.forEach(n=>{(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="MousePress"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="KeyPress"||n.type==="Collision"||n.type==="Trigger")&&(n.runMode=n.toggle?"Toggle":"Repeat")}))}function MVe(t){t.shared.variables=Xl({},Wt.prototype)}function TVe(t){let e=wn(t.shared.variables);t.shared.variables=Xl(Object.entries(e??{}).map(([i,r],n)=>({fi:n,id:i,data:r})),Ut.prototype)}var Bu=115;function boe(t,e){e(t.data);for(let i of t.children)boe(i,e)}function CVe(t){let e=t.schema??104;e!==Bu&&e<105&&(boe(t.asset,xoe),t.schema=105)}function PVe(t){t.shared.particles=Xl({},Wt.prototype),t.shared.lib&&(t.shared.lib.particles=gd.defaultData().particles)}function DVe(t){t.scene.objects.traverse((e,i)=>{i.type==="Particle"&&typeof i.renderMaterial.size=="number"&&Object.assign(i.renderMaterial,{size:[i.renderMaterial.size,i.renderMaterial.size]})})}function RVe(t){t.scene.objects.traverse((e,i)=>{i.type==="Page"&&(i.postprocessing.depthOfField.focusDistance=100,i.postprocessing.depthOfField.focalLength=20,i.postprocessing.depthOfField.bokehScale=5)})}function IVe(t){t.scene.objects.traverse((e,i)=>{var r;Array.isArray(wn(i.events))!==!1&&((r=i.events)==null||r.forEach(n=>{var a,o,l,c,h,u,d,f,p,m,g;let s=n.runMode;n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="Collision"||n.type==="Trigger"?(a=n.actions)==null||a.forEach(v=>{v.type==="Transition"&&(v.runMode=s??"Repeat"),(v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode=s==="Toggle"?"Toggle":"Normal")}):n.type==="MouseHover"||n.type==="MousePress"||n.type==="KeyPress"?(o=n.actions)==null||o.forEach(v=>{(v.type==="Transition"||v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode="Toggle")}):n.type==="GameControl"?(delete n.actions,Object.keys(n.gameActions).forEach(v=>{var y;(y=n.gameActions[v])==null||y.forEach(x=>{x.type==="Transition"&&(x.runMode="Repeat"),x.type==="Animation"&&(x.runMode="Normal")})})):n.type==="DragDrop"?(delete n.actions,(c=(l=n.dragDropActions)==null?void 0:l.drag)==null||c.forEach(v=>{(v.type==="Transition"||v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode="Toggle")}),(u=(h=n.dragDropActions)==null?void 0:h.drop)==null||u.forEach(v=>{(v.type==="Transition"||v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode="Toggle")})):n.type==="Resize"?(delete n.actions,(d=n.breakpoints)==null||d.forEach(v=>{var y;(y=v.actions)==null||y.forEach(x=>{(x.type==="Transition"||x.type==="Animation"||x.type==="SwitchCamera")&&(x.runMode="Toggle")})})):n.type==="Start"?(f=n.actions)==null||f.forEach(v=>{v.type==="Transition"&&(v.runMode="Once"),(v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode="Normal")}):n.type==="VariableChange"||n.type==="Scroll"?(p=n.actions)==null||p.forEach(v=>{v.type==="Transition"&&(v.runMode="Repeat"),(v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode="Normal")}):n.type==="Conditional"&&(delete n.actions,(m=n.inActions)==null||m.forEach(v=>{v.type==="Transition"&&(v.runMode="Repeat"),(v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode="Normal")}),(g=n.outActions)==null||g.forEach(v=>{v.type==="Transition"&&(v.runMode="Repeat"),(v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode="Normal")}))}))})}function LVe(t){t.shared.userAPIs=Xl({},Wt.prototype),t.shared.userWebhooks=Xl({},Wt.prototype),t.shared.lib&&(t.shared.lib.userAPIs=gd.defaultData().userAPIs,t.shared.lib.userWebhooks=gd.defaultData().userWebhooks)}function woe(t){let e=t.schema??0;if(e!==Bu){console.warn("updating from ",e,"to ",Bu),_Ve(t,e),e<100&&(t.scene.publish.joystickSizeAndXYOffset===void 0&&(t.scene.publish.joystickSizeAndXYOffset=Ff.defaultData.joystickSizeAndXYOffset),t.schema=100),e<101&&(Af(t,cq),_f(t,cq),t.schema=101),e<102&&(AVe(t),t.schema=102),e<104&&(t.shared.catelogs=new Wt,t.shared.lib=gd.defaultData(),t.schema=104),e<105&&(MVe(t),t.scene.objects.traverse((i,r)=>{xoe(r)}),t.schema=105);for(let i of Object.values(t.shared.lib.components))CVe(i);e<106&&(TVe(t),t.schema=106),e<107&&(t.shared.lib.variables=gd.defaultData().variables,t.schema=107),e<109&&(PVe(t),t.schema=109),e<110&&(DVe(t),t.schema=110),e<111&&(t.scene.objects.traverse((i,r)=>{EVe(r)}),t.schema=111),e<112&&(RVe(t),t.schema=112),e<113&&(IVe(t),t.schema=113),e<114&&(t.scene.publish.settings.web.imageQuality===void 0&&(t.scene.publish.settings.web.imageQuality=70),t.schema=114),e<115&&(LVe(t),t.schema=115)}}var nP;(t=>{t.defaultData={schema:Bu,scene:$m.defaultData,frames:new Wt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",mw.defaultData),shared:{...El.emptyData(),colors:El.defaultColors()}},t.emptyDataForImports=function(){let s=$m.emptyDataWithPage();return{schema:Bu,scene:s,frames:new Wt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",mw.defaultData),shared:{...El.emptyData(),colors:El.defaultColors(),images:El.defaultImages()}}},t.emptyData=function(){return{schema:Bu,scene:$m.emptyDataWithPage(),frames:new Wt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",mw.defaultData),shared:El.emptyData()}},t.clipboard2dData=function(){return{schema:Bu,scene:$m.emptyData(),frames:new Wt,shared:El.emptyData()}},t.collabHelper={...$k,updateSchema(s){return(s.schema??0)<Bu?_S(s,woe):(s.schema??0)-Bu}};function e(s){let a=t.collabHelper.updateSchema(s);return typeof a=="number"?a===0?s:null:a.data}t.updateSchemaDirectly=e;function i(s){return{...s,shared:{...s.shared,lib:gd.defaultData()}}}t.withoutLib=i;function r(s,a){let o=s.scene.objects.get(a);if(o&&o.data.type==="Component")return o;{let l=s.shared.lib.components[a];if(l)return l.asset}}t.getComponentData=r;function n(s){let a=Object.values(s.shared.userAPIs);for(let o of a){let l=o.headers;for(let c of l)if(c.data.key.toLowerCase()==="authorization"&&c.data.value!=="")return!0}return!1}t.hasSensitiveData=n})(nP||(nP={}));var RN;(t=>t.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(RN||(RN={}));var uq;(t=>{function e(i){return!0}t.is=e})(uq||(uq={}));var sP;(t=>{t.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]};function e(r,n){return{position:(n==null?void 0:n.position)??r.position,rotation:(n==null?void 0:n.rotation)??r.rotation,scale:(n==null?void 0:n.scale)??r.scale,shear:(n==null?void 0:n.shear)??r.shear}}t.merge=e;function i(r,n){return Oae({position:Ju.isEqual(r.position,n.position)?void 0:n.position,rotation:r.rotation===n.rotation?void 0:n.rotation,scale:Ju.isEqual(r.scale,n.scale)?void 0:n.scale,shear:r.shear&&n.shear&&Ju.isEqual(r.shear,n.shear)?void 0:n.shear})}t.diff=i})(sP||(sP={}));var IN;(t=>t.defaultData={horizontalConstraint:0,verticalConstraint:0})(IN||(IN={}));var dq;(t=>t.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8})(dq||(dq={}));var aP;(t=>t.defaultData={opacity:1,fill:{color:sr.fromHexAndA(Yo,1),enabled:!0},stroke:{color:sr.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:sr.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:sr.from0to1([0,0,0,1]),enabled:!1,spread:0}})(aP||(aP={}));var Jm;(t=>{function e(a,o){return{name:o}}t.newEmpty=e;function i(a,o){if(o===void 0)return a;let l={...a},c=["width","height","cornerRadius"];for(let h of c)h in l&&h in o&&o[h]!==void 0&&Object.assign(l,{[h]:o[h]});return l}function r(a,o){if(o===void 0)return a;let l={...a};return"fill"in l&&"fill"in o&&o.fill!==void 0&&Object.assign(l,{fill:{...l.fill,...o.fill}}),"stroke"in l&&"stroke"in o&&o.stroke!==void 0&&Object.assign(l,{stroke:{...l.stroke,...o.stroke}}),"layerBlur"in l&&"layerBlur"in o&&o.layerBlur!==void 0&&Object.assign(l,{layerBlur:{...l.layerBlur,...o.layerBlur}}),"backgroundBlur"in l&&"backgroundBlur"in o&&o.backgroundBlur!==void 0&&Object.assign(l,{backgroundBlur:{...l.backgroundBlur,...o.backgroundBlur}}),"dropShadow"in l&&"dropShadow"in o&&o.dropShadow!==void 0&&Object.assign(l,{dropShadow:{...l.dropShadow,...o.dropShadow}}),"innerShadow"in l&&"innerShadow"in o&&o.innerShadow!==void 0&&Object.assign(l,{innerShadow:{...l.innerShadow,...o.innerShadow}}),l}function n(a,o){if(o===void 0)return a;let l={...a};return Object.assign(l,sP.merge(l,o)),l=i(l,o),l=r(l,o),l}t.patch=n;function s(a,o){let l,c=[];for(let[h,u]of Object.entries(o))h!=="name"&&(l===void 0&&(l={path:[],props:{},type:0},c.push(l)),l.props[h]=u);return c}t.toOps=s})(Jm||(Jm={}));var MS;(t=>t.defaultData={...sP.defaultData,...IN.defaultData,states:new Ut,events:new Ut,visible:!0,raycastLock:!1})(MS||(MS={}));var v1;(t=>t.defaultData={...MS.defaultData,...aP.defaultData})(v1||(v1={}));var oP;(t=>t.defaultData={cornerRadius:[0,0,0,0]})(oP||(oP={}));var LN;(t=>t.defaultData={...v1.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"})(LN||(LN={}));var TS;(t=>t.defaultData={...v1.defaultData,...oP.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"})(TS||(TS={}));var ON;(t=>t.defaultData={...v1.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"})(ON||(ON={}));var BN;(t=>t.defaultData={...v1.defaultData,type:"path2d",path:"",name:"Path"})(BN||(BN={}));var fq;(t=>{function e(i){return i.type==="ellipse2d"||i.type==="rectangle2d"||i.type==="text2d"||i.type==="vector2d"||i.type==="path2d"}t.is=e})(fq||(fq={}));var lP;(t=>t.defaultData={...MS.defaultData,name:"Group",type:"group2d"})(lP||(lP={}));var FN;(t=>t.defaultData=()=>({...MS.defaultData,...oP.defaultData,...aP.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:sr.fromHexAndA(4737101,1),enabled:!0},stroke:{color:sr.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}}))(FN||(FN={}));var bg;(t=>{function e(a){switch(a){case"rectangle2d":return{...TS.defaultData};case"ellipse2d":return{...LN.defaultData};case"text2d":return{...ON.defaultData};case"vector2d":return{...TS.defaultData};case"path2d":return{...BN.defaultData};case"frame2d":return{...FN.defaultData()};case"group2d":return{...lP.defaultData}}}t.defaultData=e;function i(a){return"width"in a&&"height"in a?[typeof a.width=="number"?a.width*.5:0,typeof a.height=="number"?a.height*.5:0]:[0,0]}t.getPivot=i;function r(a){return a.type==="rectangle2d"||a.type==="ellipse2d"||a.type==="text2d"||a.type==="frame2d"}t.isResizeable=r;function n(a){return a.type==="frame2d"&&a.autoLayout!==void 0}t.isAutoLayoutable=n;function s(a){return a.type==="rectangle2d"||a.type==="frame2d"}t.hasCorners=s})(bg||(bg={}));var kN;(t=>(t.defaultData={name:"UI",type:"scene2d",objects:new Xs},t.emptyData=function(){return{type:"scene2d",objects:new Xs}}))(kN||(kN={}));function Zm(t,e=!1){let i=t[0].index!==null,r=new Set(Object.keys(t[0].attributes)),n=new Set(Object.keys(t[0].morphAttributes)),s={},a={},o=t[0].morphTargetsRelative,l=new Nt,c=0;for(let h=0;h<t.length;++h){let u=t[h],d=0;if(i!==(u.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let f in u.attributes){if(!r.has(f))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;s[f]===void 0&&(s[f]=[]),s[f].push(u.attributes[f]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(o!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let f in u.morphAttributes){if(!n.has(f))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;a[f]===void 0&&(a[f]=[]),a[f].push(u.morphAttributes[f])}if(e){let f;if(i)f=u.index.count;else if(u.attributes.position!==void 0)f=u.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,f,h),c+=f}}if(i){let h=0,u=[];for(let d=0;d<t.length;++d){let f=t[d].index;for(let p=0;p<f.count;++p)u.push(f.getX(p)+h);h+=t[d].attributes.position.count}l.setIndex(u)}for(let h in s){let u=pq(s[h]);if(!u)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" attribute."),null;l.setAttribute(h,u)}for(let h in a){let u=a[h][0].length;if(u===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[h]=[];for(let d=0;d<u;++d){let f=[];for(let m=0;m<a[h].length;++m)f.push(a[h][m][d]);let p=pq(f);if(!p)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" morphAttribute."),null;l.morphAttributes[h].push(p)}}return l}function pq(t){let e,i,r,n=0;for(let o=0;o<t.length;++o){let l=t[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=l.array.constructor),e!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=l.normalized),r!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=l.array.length}let s=new e(n),a=0;for(let o=0;o<t.length;++o)s.set(t[o].array,a),a+=t[o].array.length;return new Yt(s,i,r)}var OVe=Math.pow(2,-24),UM=class{constructor(){}};function Sh(t,e,i){return i.min.x=e[t],i.min.y=e[t+1],i.min.z=e[t+2],i.max.x=e[t+3],i.max.y=e[t+4],i.max.z=e[t+5],i}function mq(t){let e=-1,i=-1/0;for(let r=0;r<3;r++){let n=t[r+3]-t[r];n>i&&(i=n,e=r)}return e}function gq(t,e){e.set(t)}function vq(t,e,i){let r,n;for(let s=0;s<3;s++){let a=s+3;r=t[s],n=e[s],i[s]=r<n?r:n,r=t[a],n=e[a],i[a]=r>n?r:n}}function zM(t,e,i){for(let r=0;r<3;r++){let n=e[t+2*r],s=e[t+2*r+1],a=n-s,o=n+s;a<i[r]&&(i[r]=a),o>i[r+3]&&(i[r+3]=o)}}function ob(t){let e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2];return 2*(e*i+i*r+r*e)}function BVe(t,e){if(!t.index){let i=t.attributes.position.count,r=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n;i>65535?n=new Uint32Array(new r(4*i)):n=new Uint16Array(new r(2*i)),t.setIndex(new Yt(n,1));for(let s=0;s<i;s++)n[s]=s}}function FVe(t){if(!t.groups||!t.groups.length)return[{offset:0,count:t.index.count/3}];let e=[],i=new Set;for(let n of t.groups)i.add(n.start),i.add(n.start+n.count);let r=Array.from(i.values()).sort((n,s)=>n-s);for(let n=0;n<r.length-1;n++){let s=r[n],a=r[n+1];e.push({offset:s/3,count:(a-s)/3})}return e}function Q3(t,e,i,r,n=null){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,h=-1/0,u=1/0,d=1/0,f=1/0,p=-1/0,m=-1/0,g=-1/0,v=n!==null;for(let y=e*6,x=(e+i)*6;y<x;y+=6){let S=t[y+0],A=t[y+1],_=S-A,M=S+A;_<s&&(s=_),M>l&&(l=M),v&&S<u&&(u=S),v&&S>p&&(p=S);let E=t[y+2],T=t[y+3],C=E-T,D=E+T;C<a&&(a=C),D>c&&(c=D),v&&E<d&&(d=E),v&&E>m&&(m=E);let B=t[y+4],O=t[y+5],L=B-O,H=B+O;L<o&&(o=L),H>h&&(h=H),v&&B<f&&(f=B),v&&B>g&&(g=B)}r[0]=s,r[1]=a,r[2]=o,r[3]=l,r[4]=c,r[5]=h,v&&(n[0]=u,n[1]=d,n[2]=f,n[3]=p,n[4]=m,n[5]=g)}function kVe(t,e,i,r){let n=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,c=-1/0;for(let h=e*6,u=(e+i)*6;h<u;h+=6){let d=t[h+0];d<n&&(n=d),d>o&&(o=d);let f=t[h+2];f<s&&(s=f),f>l&&(l=f);let p=t[h+4];p<a&&(a=p),p>c&&(c=p)}r[0]=n,r[1]=s,r[2]=a,r[3]=o,r[4]=l,r[5]=c}function NVe(t,e,i,r,n){let s=i,a=i+r-1,o=n.pos,l=n.axis*2;for(;;){for(;s<=a&&e[s*6+l]<o;)s++;for(;s<=a&&e[a*6+l]>=o;)a--;if(s<a){for(let c=0;c<3;c++){let h=t[s*3+c];t[s*3+c]=t[a*3+c],t[a*3+c]=h;let u=e[s*6+c*2+0];e[s*6+c*2+0]=e[a*6+c*2+0],e[a*6+c*2+0]=u;let d=e[s*6+c*2+1];e[s*6+c*2+1]=e[a*6+c*2+1],e[a*6+c*2+1]=d}s++,a--}else return s}}var _u=32,UVe=(t,e)=>t.candidate-e.candidate,rf=new Array(_u).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),GM=new Float32Array(6);function zVe(t,e,i,r,n,s){let a=-1,o=0;if(s===0)a=mq(e),a!==-1&&(o=(e[a]+e[a+3])/2);else if(s===1)a=mq(t),a!==-1&&(o=GVe(i,r,n,a));else if(s===2){let l=ob(t),c=1.25*n,h=r*6,u=(r+n)*6;for(let d=0;d<3;d++){let f=e[d],p=(e[d+3]-f)/_u;if(n<_u/4){let m=[...rf];m.length=n;let g=0;for(let y=h;y<u;y+=6,g++){let x=m[g];x.candidate=i[y+2*d],x.count=0;let{bounds:S,leftCacheBounds:A,rightCacheBounds:_}=x;for(let M=0;M<3;M++)_[M]=1/0,_[M+3]=-1/0,A[M]=1/0,A[M+3]=-1/0,S[M]=1/0,S[M+3]=-1/0;zM(y,i,S)}m.sort(UVe);let v=n;for(let y=0;y<v;y++){let x=m[y];for(;y+1<v&&m[y+1].candidate===x.candidate;)m.splice(y+1,1),v--}for(let y=h;y<u;y+=6){let x=i[y+2*d];for(let S=0;S<v;S++){let A=m[S];x>=A.candidate?zM(y,i,A.rightCacheBounds):(zM(y,i,A.leftCacheBounds),A.count++)}}for(let y=0;y<v;y++){let x=m[y],S=x.count,A=n-x.count,_=x.leftCacheBounds,M=x.rightCacheBounds,E=0;S!==0&&(E=ob(_)/l);let T=0;A!==0&&(T=ob(M)/l);let C=1+1.25*(E*S+T*A);C<c&&(a=d,c=C,o=x.candidate)}}else{for(let v=0;v<_u;v++){let y=rf[v];y.count=0,y.candidate=f+p+v*p;let x=y.bounds;for(let S=0;S<3;S++)x[S]=1/0,x[S+3]=-1/0}for(let v=h;v<u;v+=6){let y=~~((i[v+2*d]-f)/p);y>=_u&&(y=_u-1);let x=rf[y];x.count++,zM(v,i,x.bounds)}let m=rf[_u-1];gq(m.bounds,m.rightCacheBounds);for(let v=_u-2;v>=0;v--){let y=rf[v],x=rf[v+1];vq(y.bounds,x.rightCacheBounds,y.rightCacheBounds)}let g=0;for(let v=0;v<_u-1;v++){let y=rf[v],x=y.count,S=y.bounds,A=rf[v+1].rightCacheBounds;x!==0&&(g===0?gq(S,GM):vq(S,GM,GM)),g+=x;let _=0,M=0;g!==0&&(_=ob(GM)/l);let E=n-g;E!==0&&(M=ob(A)/l);let T=1+1.25*(_*g+M*E);T<c&&(a=d,c=T,o=y.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}function GVe(t,e,i,r){let n=0;for(let s=e,a=e+i;s<a;s++)n+=t[s*6+r*2];return n/i}function VVe(t,e){let i=t.attributes.position,r=t.index.array,n=r.length/3,s=new Float32Array(n*6),a=i.normalized,o=i.array,l=i.offset||0,c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);let h=["getX","getY","getZ"];for(let u=0;u<n;u++){let d=u*3,f=u*6,p,m,g;a?(p=r[d+0],m=r[d+1],g=r[d+2]):(p=r[d+0]*c+l,m=r[d+1]*c+l,g=r[d+2]*c+l);for(let v=0;v<3;v++){let y,x,S;a?(y=i[h[v]](p),x=i[h[v]](m),S=i[h[v]](g)):(y=o[p+v],x=o[m+v],S=o[g+v]);let A=y;x<A&&(A=x),S<A&&(A=S);let _=y;x>_&&(_=x),S>_&&(_=S);let M=(_-A)/2,E=v*2;s[f+E+0]=A+M,s[f+E+1]=M+(Math.abs(A)+M)*OVe,A<e[v]&&(e[v]=A),_>e[v+3]&&(e[v+3]=_)}}return s}function HVe(t,e){function i(v){d&&d(v/f)}function r(v,y,x,S=null,A=0){if(!p&&A>=l&&(p=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),x<=h||A>=l)return i(y+x),v.offset=y,v.count=x,v;let _=zVe(v.boundingData,S,a,y,x,u);if(_.axis===-1)return i(y+x),v.offset=y,v.count=x,v;let M=NVe(o,a,y,x,_);if(M===y||M===y+x)i(y+x),v.offset=y,v.count=x;else{v.splitAxis=_.axis;let E=new UM,T=y,C=M-y;v.left=E,E.boundingData=new Float32Array(6),Q3(a,T,C,E.boundingData,s),r(E,T,C,s,A+1);let D=new UM,B=M,O=x-C;v.right=D,D.boundingData=new Float32Array(6),Q3(a,B,O,D.boundingData,s),r(D,B,O,s,A+1)}return v}BVe(t,e);let n=new Float32Array(6),s=new Float32Array(6),a=VVe(t,n),o=t.index.array,l=e.maxDepth,c=e.verbose,h=e.maxLeafTris,u=e.strategy,d=e.onProgress,f=t.index.count/3,p=!1,m=[],g=FVe(t);if(g.length===1){let v=g[0],y=new UM;y.boundingData=n,kVe(a,v.offset,v.count,s),r(y,v.offset,v.count,s),m.push(y)}else for(let v of g){let y=new UM;y.boundingData=new Float32Array(6),Q3(a,v.offset,v.count,y.boundingData,s),r(y,v.offset,v.count,s),m.push(y)}return m}function jVe(t,e){let i=HVe(t,e),r,n,s,a=[],o=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let h=0;h<i.length;h++){let u=i[h],d=l(u),f=new o(32*d);r=new Float32Array(f),n=new Uint32Array(f),s=new Uint16Array(f),c(0,u),a.push(f)}return a;function l(h){return h.count?1:1+l(h.left)+l(h.right)}function c(h,u){let d=h/4,f=h/2,p=!!u.count,m=u.boundingData;for(let g=0;g<6;g++)r[d+g]=m[g];if(p){let g=u.offset,v=u.count;return n[d+6]=g,s[f+14]=v,s[f+15]=65535,h+32}else{let g=u.left,v=u.right,y=u.splitAxis,x;if(x=c(h+32,g),x/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[d+6]=x/4,x=c(x,v),n[d+7]=y,x}}}var vd=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let i=1/0,r=-1/0;for(let n=0,s=t.length;n<s;n++){let a=t[n][e];i=a<i?a:i,r=a>r?a:r}this.min=i,this.max=r}setFromPoints(t,e){let i=1/0,r=-1/0;for(let n=0,s=e.length;n<s;n++){let a=e[n],o=t.dot(a);i=o<i?o:i,r=o>r?o:r}this.min=i,this.max=r}isSeparated(t){return this.min>t.max||t.min>this.max}};vd.prototype.setFromBox=function(){let t=new N;return function(e,i){let r=i.min,n=i.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){t.x=r.x*o+n.x*(1-o),t.y=r.y*l+n.y*(1-l),t.z=r.z*c+n.z*(1-c);let h=e.dot(t);s=Math.min(h,s),a=Math.max(h,a)}this.min=s,this.max=a}}();var WVe=function(){let t=new N,e=new N,i=new N;return function(r,n,s){let a=r.start,o=t,l=n.start,c=e;i.subVectors(a,l),t.subVectors(r.end,r.start),e.subVectors(n.end,n.start);let h=i.dot(c),u=c.dot(o),d=c.dot(c),f=i.dot(o),p=o.dot(o)*d-u*u,m,g;p!==0?m=(h*u-f*d)/p:m=0,g=(h+m*u)/d,s.x=m,s.y=g}}(),fG=function(){let t=new ye,e=new N,i=new N;return function(r,n,s,a){WVe(r,n,t);let o=t.x,l=t.y;if(o>=0&&o<=1&&l>=0&&l<=1){r.at(o,s),n.at(l,a);return}else if(o>=0&&o<=1){l<0?n.at(0,a):n.at(1,a),r.closestPointToPoint(a,!0,s);return}else if(l>=0&&l<=1){o<0?r.at(0,s):r.at(1,s),n.closestPointToPoint(s,!0,a);return}else{let c;o<0?c=r.start:c=r.end;let h;l<0?h=n.start:h=n.end;let u=e,d=i;if(r.closestPointToPoint(h,!0,e),n.closestPointToPoint(c,!0,i),u.distanceToSquared(h)<=d.distanceToSquared(c)){s.copy(u),a.copy(h);return}else{s.copy(c),a.copy(d);return}}}}(),XVe=function(){let t=new N,e=new N,i=new ro,r=new Ul;return function(n,s){let{radius:a,center:o}=n,{a:l,b:c,c:h}=s;if(r.start=l,r.end=c,r.closestPointToPoint(o,!0,t).distanceTo(o)<=a||(r.start=l,r.end=h,r.closestPointToPoint(o,!0,t).distanceTo(o)<=a)||(r.start=c,r.end=h,r.closestPointToPoint(o,!0,t).distanceTo(o)<=a))return!0;let u=s.getPlane(i);if(Math.abs(u.distanceToPoint(o))<=a){let d=u.projectPoint(o,e);if(s.containsPoint(d))return!0}return!1}}(),YVe=1e-15;function uv(t){return Math.abs(t)<YVe}var yd=class extends Ws{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new N),this.satBounds=new Array(4).fill().map(()=>new vd),this.points=[this.a,this.b,this.c],this.sphere=new wo,this.plane=new ro,this.needsUpdate=!0}intersectsSphere(t){return XVe(t,this)}update(){let t=this.a,e=this.b,i=this.c,r=this.points,n=this.satAxes,s=this.satBounds,a=n[0],o=s[0];this.getNormal(a),o.setFromPoints(a,r);let l=n[1],c=s[1];l.subVectors(t,e),c.setFromPoints(l,r);let h=n[2],u=s[2];h.subVectors(e,i),u.setFromPoints(h,r);let d=n[3],f=s[3];d.subVectors(i,t),f.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}};yd.prototype.closestPointToSegment=function(){let t=new N,e=new N,i=new Ul;return function(r,n=null,s=null){let{start:a,end:o}=r,l=this.points,c,h=1/0;for(let u=0;u<3;u++){let d=(u+1)%3;i.start.copy(l[u]),i.end.copy(l[d]),fG(i,r,t,e),c=t.distanceToSquared(e),c<h&&(h=c,n&&n.copy(t),s&&s.copy(e))}return this.closestPointToPoint(a,t),c=a.distanceToSquared(t),c<h&&(h=c,n&&n.copy(t),s&&s.copy(a)),this.closestPointToPoint(o,t),c=o.distanceToSquared(t),c<h&&(h=c,n&&n.copy(t),s&&s.copy(o)),Math.sqrt(h)}}();yd.prototype.intersectsTriangle=function(){let t=new yd,e=new Array(3),i=new Array(3),r=new vd,n=new vd,s=new N,a=new N,o=new N,l=new N,c=new Ul,h=new Ul,u=new Ul;return function(d,f=null,p=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(t.copy(d),t.update(),d=t);let m=this.plane,g=d.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let v=this.satBounds,y=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let A=0;A<4;A++){let _=v[A],M=y[A];if(r.setFromPoints(M,i),_.isSeparated(r))return!1}let x=d.satBounds,S=d.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let A=0;A<4;A++){let _=x[A],M=S[A];if(r.setFromPoints(M,e),_.isSeparated(r))return!1}for(let A=0;A<4;A++){let _=y[A];for(let M=0;M<4;M++){let E=S[M];if(s.crossVectors(_,E),r.setFromPoints(s,e),n.setFromPoints(s,i),r.isSeparated(n))return!1}}return f&&(p||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),f.start.set(0,0,0),f.end.set(0,0,0)),!0}else{let v=this.points,y=!1,x=0;for(let O=0;O<3;O++){let L=v[O],H=v[(O+1)%3];c.start.copy(L),c.end.copy(H),c.delta(a);let q=y?h.start:h.end,W=uv(g.distanceToPoint(L));if(uv(g.normal.dot(a))&&W){h.copy(c),x=2;break}if((g.intersectLine(c,q)||W)&&!uv(q.distanceTo(H))){if(x++,y)break;y=!0}}if(x===1&&d.containsPoint(h.end))return f&&(f.start.copy(h.end),f.end.copy(h.end)),!0;if(x!==2)return!1;let S=d.points,A=!1,_=0;for(let O=0;O<3;O++){let L=S[O],H=S[(O+1)%3];c.start.copy(L),c.end.copy(H),c.delta(o);let q=A?u.start:u.end,W=uv(m.distanceToPoint(L));if(uv(m.normal.dot(o))&&W){u.copy(c),_=2;break}if((m.intersectLine(c,q)||W)&&!uv(q.distanceTo(H))){if(_++,A)break;A=!0}}if(_===1&&this.containsPoint(u.end))return f&&(f.start.copy(u.end),f.end.copy(u.end)),!0;if(_!==2)return!1;if(h.delta(a),u.delta(o),a.dot(o)<0){let O=u.start;u.start=u.end,u.end=O}let M=h.start.dot(a),E=h.end.dot(a),T=u.start.dot(a),C=u.end.dot(a),D=E<T,B=M<C;return M!==C&&T!==E&&D===B?!1:(f&&(l.subVectors(h.start,u.start),l.dot(a)>0?f.start.copy(h.start):f.start.copy(u.start),l.subVectors(h.end,u.end),l.dot(a)<0?f.end.copy(h.end):f.end.copy(u.end)),!0)}}}();yd.prototype.distanceToPoint=function(){let t=new N;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}();yd.prototype.distanceToTriangle=function(){let t=new N,e=new N,i=["a","b","c"],r=new Ul,n=new Ul;return function(s,a=null,o=null){let l=a||o?r:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let c=1/0;for(let h=0;h<3;h++){let u,d=i[h],f=s[d];this.closestPointToPoint(f,t),u=f.distanceToSquared(t),u<c&&(c=u,a&&a.copy(t),o&&o.copy(f));let p=this[d];s.closestPointToPoint(p,t),u=p.distanceToSquared(t),u<c&&(c=u,a&&a.copy(p),o&&o.copy(t))}for(let h=0;h<3;h++){let u=i[h],d=i[(h+1)%3];r.set(this[u],this[d]);for(let f=0;f<3;f++){let p=i[f],m=i[(f+1)%3];n.set(s[p],s[m]),fG(r,n,t,e);let g=t.distanceToSquared(e);g<c&&(c=g,a&&a.copy(t),o&&o.copy(e))}}return Math.sqrt(c)}}();var jh=class{constructor(t,e,i){this.isOrientedBox=!0,this.min=new N,this.max=new N,this.matrix=new st,this.invMatrix=new st,this.points=new Array(8).fill().map(()=>new N),this.satAxes=new Array(3).fill().map(()=>new N),this.satBounds=new Array(3).fill().map(()=>new vd),this.alignedSatBounds=new Array(3).fill().map(()=>new vd),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),i&&this.matrix.copy(i)}set(t,e,i){this.min.copy(t),this.max.copy(e),this.matrix.copy(i),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}};jh.prototype.update=function(){return function(){let t=this.matrix,e=this.min,i=this.max,r=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){let u=1*l|2*c|4*h,d=r[u];d.x=l?i.x:e.x,d.y=c?i.y:e.y,d.z=h?i.z:e.z,d.applyMatrix4(t)}let n=this.satBounds,s=this.satAxes,a=r[0];for(let l=0;l<3;l++){let c=s[l],h=n[l],u=1<<l,d=r[u];c.subVectors(a,d),h.setFromPoints(c,r)}let o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();jh.prototype.intersectsBox=function(){let t=new vd;return function(e){this.needsUpdate&&this.update();let i=e.min,r=e.max,n=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(t.min=i.x,t.max=r.x,a[0].isSeparated(t)||(t.min=i.y,t.max=r.y,a[1].isSeparated(t))||(t.min=i.z,t.max=r.z,a[2].isSeparated(t)))return!1;for(let o=0;o<3;o++){let l=s[o],c=n[o];if(t.setFromBox(l,e),c.isSeparated(t))return!1}return!0}}();jh.prototype.intersectsTriangle=function(){let t=new yd,e=new Array(3),i=new vd,r=new vd,n=new N;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(t.copy(s),t.update(),s=t);let a=this.satBounds,o=this.satAxes;e[0]=s.a,e[1]=s.b,e[2]=s.c;for(let u=0;u<3;u++){let d=a[u],f=o[u];if(i.setFromPoints(f,e),d.isSeparated(i))return!1}let l=s.satBounds,c=s.satAxes,h=this.points;for(let u=0;u<3;u++){let d=l[u],f=c[u];if(i.setFromPoints(f,h),d.isSeparated(i))return!1}for(let u=0;u<3;u++){let d=o[u];for(let f=0;f<4;f++){let p=c[f];if(n.crossVectors(d,p),i.setFromPoints(n,e),r.setFromPoints(n,h),i.isSeparated(r))return!1}}return!0}}();jh.prototype.closestPointToPoint=function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();jh.prototype.distanceToPoint=function(){let t=new N;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}();jh.prototype.distanceToBox=function(){let t=["x","y","z"],e=new Array(12).fill().map(()=>new Ul),i=new Array(12).fill().map(()=>new Ul),r=new N,n=new N;return function(s,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(n),this.closestPointToPoint(n,r),s.closestPointToPoint(r,n),o&&o.copy(r),l&&l.copy(n)),0;let c=a*a,h=s.min,u=s.max,d=this.points,f=1/0;for(let m=0;m<8;m++){let g=d[m];n.copy(g).clamp(h,u);let v=g.distanceToSquared(n);if(v<f&&(f=v,o&&o.copy(g),l&&l.copy(n),v<c))return Math.sqrt(v)}let p=0;for(let m=0;m<3;m++)for(let g=0;g<=1;g++)for(let v=0;v<=1;v++){let y=(m+1)%3,x=(m+2)%3,S=g<<y|v<<x,A=1<<m|g<<y|v<<x,_=d[S],M=d[A];e[p].set(_,M);let E=t[m],T=t[y],C=t[x],D=i[p],B=D.start,O=D.end;B[E]=h[E],B[T]=g?h[T]:u[T],B[C]=v?h[C]:u[T],O[E]=u[E],O[T]=g?h[T]:u[T],O[C]=v?h[C]:u[T],p++}for(let m=0;m<=1;m++)for(let g=0;g<=1;g++)for(let v=0;v<=1;v++){n.x=m?u.x:h.x,n.y=g?u.y:h.y,n.z=v?u.z:h.z,this.closestPointToPoint(n,r);let y=n.distanceToSquared(r);if(y<f&&(f=y,o&&o.copy(r),l&&l.copy(n),y<c))return Math.sqrt(y)}for(let m=0;m<12;m++){let g=e[m];for(let v=0;v<12;v++){let y=i[v];fG(g,y,r,n);let x=r.distanceToSquared(n);if(x<f&&(f=x,o&&o.copy(r),l&&l.copy(n),x<c))return Math.sqrt(x)}}return Math.sqrt(f)}}();var dv=new N,fv=new N,pv=new N,VM=new ye,HM=new ye,jM=new ye,yq=new N,xq=new N,bq=new N,WM=new N;function qVe(t,e,i,r,n,s){let a;return s===Ts?a=t.intersectTriangle(r,i,e,!0,n):a=t.intersectTriangle(e,i,r,s!==pa,n),a===null?null:{distance:t.origin.distanceTo(n),point:n.clone()}}function KVe(t,e,i,r,n,s,a,o,l){dv.fromBufferAttribute(e,s),fv.fromBufferAttribute(e,a),pv.fromBufferAttribute(e,o);let c=qVe(t,dv,fv,pv,WM,l);if(c){r&&(VM.fromBufferAttribute(r,s),HM.fromBufferAttribute(r,a),jM.fromBufferAttribute(r,o),c.uv=Ws.getInterpolation(WM,dv,fv,pv,VM,HM,jM,new ye)),n&&(VM.fromBufferAttribute(n,s),HM.fromBufferAttribute(n,a),jM.fromBufferAttribute(n,o),c.uv1=Ws.getInterpolation(WM,dv,fv,pv,VM,HM,jM,new ye)),i&&(yq.fromBufferAttribute(i,s),xq.fromBufferAttribute(i,a),bq.fromBufferAttribute(i,o),c.normal=Ws.getInterpolation(WM,dv,fv,pv,yq,xq,bq,new N),c.normal.dot(t.direction)>0&&c.normal.multiplyScalar(-1));let h={a:s,b:a,c:o,normal:new N,materialIndex:0};Ws.getNormal(dv,fv,pv,h.normal),c.face=h,c.faceIndex=s}return c}function Soe(t,e,i,r,n){let s=r*3,a=t.index.getX(s),o=t.index.getX(s+1),l=t.index.getX(s+2),{position:c,normal:h,uv:u,uv1:d}=t.attributes,f=KVe(i,c,h,u,d,a,o,l,e);return f?(f.faceIndex=r,n&&n.push(f),f):null}function QVe(t,e,i,r,n,s){for(let a=r,o=r+n;a<o;a++)Soe(t,e,i,a,s)}function $Ve(t,e,i,r,n){let s=1/0,a=null;for(let o=r,l=r+n;o<l;o++){let c=Soe(t,e,i,o);c&&c.distance<s&&(a=c,s=c.distance)}return a}function yh(t,e,i,r){let n=t.a,s=t.b,a=t.c,o=e,l=e+1,c=e+2;i&&(o=i.getX(e),l=i.getX(e+1),c=i.getX(e+2)),n.x=r.getX(o),n.y=r.getY(o),n.z=r.getZ(o),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),a.x=r.getX(c),a.y=r.getY(c),a.z=r.getZ(c)}function wq(t,e,i,r,n,s,a){let o=i.index,l=i.attributes.position;for(let c=t,h=e+t;c<h;c++)if(yh(a,c*3,o,l),a.needsUpdate=!0,r(a,c,n,s))return!0;return!1}var _oe=class{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){let t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}};function Ef(t,e){return e[t+15]===65535}function Py(t,e){return e[t+6]}function CS(t,e){return e[t+14]}function PS(t){return t+8}function DS(t,e){return e[t+6]}function JVe(t,e){return e[t+7]}var ay=new _n,cP=new N,ZVe=["x","y","z"];function NN(t,e,i,r,n){let s=t*2,a=Z1,o=ip,l=rp;if(Ef(s,o)){let c=Py(t,l),h=CS(s,o);QVe(e,i,r,c,h,n)}else{let c=PS(t);hP(c,a,r,cP)&&NN(c,e,i,r,n);let h=DS(t,l);hP(h,a,r,cP)&&NN(h,e,i,r,n)}}function UN(t,e,i,r){let n=t*2,s=Z1,a=ip,o=rp;if(Ef(n,a)){let l=Py(t,o),c=CS(n,a);return $Ve(e,i,r,l,c)}else{let l=JVe(t,o),c=ZVe[l],h=r.direction[c]>=0,u,d;h?(u=PS(t),d=DS(t,o)):(u=DS(t,o),d=PS(t));let f=hP(u,s,r,cP)?UN(u,e,i,r):null;if(f){let m=f.point[c];if(h?m<=s[d+l]:m>=s[d+l+3])return f}let p=hP(d,s,r,cP)?UN(d,e,i,r):null;return f&&p?f.distance<=p.distance?f:p:f||p||null}}var e6e=function(){let t,e,i=[],r=new _oe(()=>new _n);return function(...s){t=r.getPrimitive(),e=r.getPrimitive(),i.push(t,e);let a=n(...s);r.releasePrimitive(t),r.releasePrimitive(e),i.pop(),i.pop();let o=i.length;return o>0&&(e=i[o-1],t=i[o-2]),a};function n(s,a,o,l,c=null,h=0,u=0){function d(y){let x=y*2,S=ip,A=rp;for(;!Ef(x,S);)y=PS(y),x=y*2;return Py(y,A)}function f(y){let x=y*2,S=ip,A=rp;for(;!Ef(x,S);)y=DS(y,A),x=y*2;return Py(y,A)+CS(x,S)}let p=s*2,m=Z1,g=ip,v=rp;if(Ef(p,g)){let y=Py(s,v),x=CS(p,g);return Sh(s,m,t),l(y,x,!1,u,h+s,t)}else{let y=PS(s),x=DS(s,v),S=y,A=x,_,M,E,T;if(c&&(E=t,T=e,Sh(S,m,E),Sh(A,m,T),_=c(E),M=c(T),M<_)){S=x,A=y;let q=_;_=M,M=q,E=T}E||(E=t,Sh(S,m,E));let C=Ef(S*2,g),D=o(E,C,_,u+1,h+S),B;if(D===2){let q=d(S),W=f(S)-q;B=l(q,W,!0,u+1,h+S,E)}else B=D&&n(S,a,o,l,c,h,u+1);if(B)return!0;T=e,Sh(A,m,T);let O=Ef(A*2,g),L=o(T,O,M,u+1,h+A),H;if(L===2){let q=d(A),W=f(A)-q;H=l(q,W,!0,u+1,h+A,T)}else H=L&&n(A,a,o,l,c,h,u+1);return!!H}}}(),t6e=function(){let t=new yd,e=new yd,i=new st,r=new jh,n=new jh;return function s(a,o,l,c,h=null){let u=a*2,d=Z1,f=ip,p=rp;if(h===null&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,c),h=r),Ef(u,f)){let m=o,g=m.index,v=m.attributes.position,y=l.index,x=l.attributes.position,S=Py(a,p),A=CS(u,f);if(i.copy(c).invert(),l.boundsTree)return Sh(a,d,n),n.matrix.copy(i),n.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:_=>n.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(c),_.b.applyMatrix4(c),_.c.applyMatrix4(c),_.needsUpdate=!0;for(let M=S*3,E=(A+S)*3;M<E;M+=3)if(yh(e,M,g,v),e.needsUpdate=!0,_.intersectsTriangle(e))return!0;return!1}});for(let _=S*3,M=A+S*3;_<M;_+=3){yh(t,_,g,v),t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let E=0,T=y.count;E<T;E+=3)if(yh(e,E,y,x),e.needsUpdate=!0,t.intersectsTriangle(e))return!0}}else{let m=a+8,g=p[a+6];return Sh(m,d,ay),!!(h.intersectsBox(ay)&&s(m,o,l,c,h)||(Sh(g,d,ay),h.intersectsBox(ay)&&s(g,o,l,c,h)))}}}();function hP(t,e,i,r){return Sh(t,e,ay),i.intersectBox(ay,r)}var zN=[],gC,Z1,ip,rp;function Fb(t){gC&&zN.push(gC),gC=t,Z1=new Float32Array(t),ip=new Uint16Array(t),rp=new Uint32Array(t)}function XM(){gC=null,Z1=null,ip=null,rp=null,zN.length&&Fb(zN.pop())}var $3=Symbol("skip tree generation"),J3=new _n,Z3=new _n,mv=new st,cm=new jh,lb=new jh,cb=new N,YM=new N,i6e=new N,r6e=new N,n6e=new N,Sq=new _n,Zc=new _oe(()=>new yd),gw=class{static serialize(t,e={}){if(e.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),gw.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});e={cloneBuffers:!0,...e};let i=t.geometry,r=t._roots,n=i.getIndex(),s;return e.cloneBuffers?s={roots:r.map(a=>a.slice()),index:n.array.slice()}:s={roots:r,index:n.array},s}static deserialize(t,e,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),gw.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};let{index:r,roots:n}=t,s=new gw(e,{...i,[$3]:!0});if(s._roots=n,i.setIndex){let a=e.getIndex();if(a===null){let o=new Yt(t.index,1,!1);e.setIndex(o)}else a.array!==r&&(a.array.set(r),a.needsUpdate=!0)}return s}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[$3]:!1},e),e.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,e[$3]||(this._roots=jVe(t,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new _n))),this.geometry=t}refit(t=null){t&&Array.isArray(t)&&(t=new Set(t));let e=this.geometry,i=e.index.array,r=e.attributes.position,n,s,a,o,l=0,c=this._roots;for(let u=0,d=c.length;u<d;u++)n=c[u],s=new Uint32Array(n),a=new Uint16Array(n),o=new Float32Array(n),h(0,l),l+=n.byteLength;function h(u,d,f=!1){let p=u*2;if(a[p+15]===65535){let m=s[u+6],g=a[p+14],v=1/0,y=1/0,x=1/0,S=-1/0,A=-1/0,_=-1/0;for(let M=3*m,E=3*(m+g);M<E;M++){let T=i[M],C=r.getX(T),D=r.getY(T),B=r.getZ(T);C<v&&(v=C),C>S&&(S=C),D<y&&(y=D),D>A&&(A=D),B<x&&(x=B),B>_&&(_=B)}return o[u+0]!==v||o[u+1]!==y||o[u+2]!==x||o[u+3]!==S||o[u+4]!==A||o[u+5]!==_?(o[u+0]=v,o[u+1]=y,o[u+2]=x,o[u+3]=S,o[u+4]=A,o[u+5]=_,!0):!1}else{let m=u+8,g=s[u+6],v=m+d,y=g+d,x=f,S=!1,A=!1;t?x||(S=t.has(v),A=t.has(y),x=!S&&!A):(S=!0,A=!0);let _=x||S,M=x||A,E=!1;_&&(E=h(m,d,x));let T=!1;M&&(T=h(g,d,x));let C=E||T;if(C)for(let D=0;D<3;D++){let B=m+D,O=g+D,L=o[B],H=o[B+3],q=o[O],W=o[O+3];o[u+D]=L<q?L:q,o[u+D+3]=H>W?H:W}return C}}}traverse(t,e=0){let i=this._roots[e],r=new Uint32Array(i),n=new Uint16Array(i);s(0);function s(a,o=0){let l=a*2,c=n[l+15]===65535;if(c){let h=r[a+6],u=n[l+14];t(o,c,new Float32Array(i,a*4,6),h,u)}else{let h=a+8,u=r[a+6],d=r[a+7];t(o,c,new Float32Array(i,a*4,6),d)||(s(h,o+1),s(u,o+1))}}}raycast(t,e=Lc){let i=this._roots,r=this.geometry,n=[],s=e.isMaterial,a=Array.isArray(e),o=r.groups,l=s?e.side:e;for(let c=0,h=i.length;c<h;c++){let u=a?e[o[c].materialIndex].side:l,d=n.length;if(Fb(i[c]),NN(0,r,u,t,n),XM(),a){let f=o[c].materialIndex;for(let p=d,m=n.length;p<m;p++)n[p].face.materialIndex=f}}return n}raycastFirst(t,e=Lc){let i=this._roots,r=this.geometry,n=e.isMaterial,s=Array.isArray(e),a=null,o=r.groups,l=n?e.side:e;for(let c=0,h=i.length;c<h;c++){let u=s?e[o[c].materialIndex].side:l;Fb(i[c]);let d=UN(0,r,u,t);XM(),d!=null&&(a==null||d.distance<a.distance)&&(a=d,s&&(d.face.materialIndex=o[c].materialIndex))}return a}intersectsGeometry(t,e){let i=this.geometry,r=!1;for(let n of this._roots)if(Fb(n),r=t6e(0,i,t,e),XM(),r)break;return r}shapecast(t,e,i){let r=this.geometry;if(t instanceof Function){if(e){let u=e;e=(d,f,p,m)=>{let g=f*3;return u(d,g,g+1,g+2,p,m)}}t={boundsTraverseOrder:i,intersectsBounds:t,intersectsTriangle:e,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let n=Zc.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=t;if(o&&l){let u=o;o=(d,f,p,m,g)=>u(d,f,p,m,g)?!0:wq(d,f,r,l,p,m,n)}else o||(l?o=(u,d,f,p)=>wq(u,d,r,l,f,p,n):o=(u,d,f)=>f);let c=!1,h=0;for(let u of this._roots){if(Fb(u),c=e6e(0,r,a,o,s,h),XM(),c)break;h+=u.byteLength}return Zc.releasePrimitive(n),c}bvhcast(t,e,i){let{intersectsRanges:r,intersectsTriangles:n}=i,s=this.geometry.index,a=this.geometry.attributes.position,o=t.geometry.index,l=t.geometry.attributes.position;mv.copy(e).invert();let c=Zc.getPrimitive(),h=Zc.getPrimitive();if(n){let d=function(f,p,m,g,v,y,x,S){for(let A=m,_=m+g;A<_;A++){yh(h,A*3,o,l),h.a.applyMatrix4(e),h.b.applyMatrix4(e),h.c.applyMatrix4(e),h.needsUpdate=!0;for(let M=f,E=f+p;M<E;M++)if(yh(c,M*3,s,a),c.needsUpdate=!0,n(c,h,M,A,v,y,x,S))return!0}return!1};if(r){let f=r;r=function(p,m,g,v,y,x,S,A){return f(p,m,g,v,y,x,S,A)?!0:d(p,m,g,v,y,x,S,A)}}else r=d}t.getBoundingBox(Z3),Z3.applyMatrix4(e);let u=this.shapecast({intersectsBounds:d=>Z3.intersectsBox(d),intersectsRange:(d,f,p,m,g,v)=>(J3.copy(v),J3.applyMatrix4(mv),t.shapecast({intersectsBounds:y=>J3.intersectsBox(y),intersectsRange:(y,x,S,A,_)=>r(d,f,y,x,m,g,A,_)}))});return Zc.releasePrimitive(c),Zc.releasePrimitive(h),u}intersectsBox(t,e){return cm.set(t.min,t.max,e),cm.needsUpdate=!0,this.shapecast({intersectsBounds:i=>cm.intersectsBox(i),intersectsTriangle:i=>cm.intersectsTriangle(i)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,i={},r={},n=0,s=1/0){t.boundingBox||t.computeBoundingBox(),cm.set(t.boundingBox.min,t.boundingBox.max,e),cm.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,c=t.attributes.position,h=t.index,u=Zc.getPrimitive(),d=Zc.getPrimitive(),f=YM,p=i6e,m=null,g=null;r&&(m=r6e,g=n6e);let v=1/0,y=null,x=null;return mv.copy(e).invert(),lb.matrix.copy(mv),this.shapecast({boundsTraverseOrder:S=>cm.distanceToBox(S),intersectsBounds:(S,A,_)=>_<v&&_<s?(A&&(lb.min.copy(S.min),lb.max.copy(S.max),lb.needsUpdate=!0),!0):!1,intersectsRange:(S,A)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:_=>lb.distanceToBox(_),intersectsBounds:(_,M,E)=>E<v&&E<s,intersectsRange:(_,M)=>{for(let E=_*3,T=(_+M)*3;E<T;E+=3){yh(d,E,h,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let C=S*3,D=(S+A)*3;C<D;C+=3){yh(u,C,l,o),u.needsUpdate=!0;let B=u.distanceToTriangle(d,f,m);if(B<v&&(p.copy(f),g&&g.copy(m),v=B,y=C/3,x=E/3),B<n)return!0}}}});{let _=h?h.count:c.count;for(let M=0,E=_;M<E;M+=3){yh(d,M,h,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let T=S*3,C=(S+A)*3;T<C;T+=3){yh(u,T,l,o),u.needsUpdate=!0;let D=u.distanceToTriangle(d,f,m);if(D<v&&(p.copy(f),g&&g.copy(m),v=D,y=T/3,x=M/3),D<n)return!0}}}}}),Zc.releasePrimitive(u),Zc.releasePrimitive(d),v===1/0?null:(i.point?i.point.copy(p):i.point=p.clone(),i.distance=v,i.faceIndex=y,r&&(r.point?r.point.copy(g):r.point=g.clone(),r.point.applyMatrix4(mv),p.applyMatrix4(mv),r.distance=p.sub(r.point).length(),r.faceIndex=x),i)}closestPointToPoint(t,e={},i=0,r=1/0){let n=i*i,s=r*r,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:c=>(cb.copy(t).clamp(c.min,c.max),cb.distanceToSquared(t)),intersectsBounds:(c,h,u)=>u<a&&u<s,intersectsTriangle:(c,h)=>{c.closestPointToPoint(t,cb);let u=t.distanceToSquared(cb);return u<a&&(YM.copy(cb),a=u,o=h),u<n}}),a===1/0)return null;let l=Math.sqrt(a);return e.point?e.point.copy(YM):e.point=YM.clone(),e.distance=l,e.faceIndex=o,e}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(e=>{Sh(0,new Float32Array(e),Sq),t.union(Sq)}),t}},GN=Ip(r2e()),s6e=.5*(Math.sqrt(3)-1),hb=(3-Math.sqrt(3))/6,a6e=1/3,eh=1/6,vw=t=>Math.floor(t)|0,_q=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),eO=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function o6e(t=Math.random){let e=Aoe(t),i=new Float64Array(e).map(n=>_q[n%12*2]),r=new Float64Array(e).map(n=>_q[n%12*2+1]);return function(n,s){let a=0,o=0,l=0,c=(n+s)*s6e,h=vw(n+c),u=vw(s+c),d=(h+u)*hb,f=h-d,p=u-d,m=n-f,g=s-p,v,y;m>g?(v=1,y=0):(v=0,y=1);let x=m-v+hb,S=g-y+hb,A=m-1+2*hb,_=g-1+2*hb,M=h&255,E=u&255,T=.5-m*m-g*g;if(T>=0){let B=M+e[E],O=i[B],L=r[B];T*=T,a=T*T*(O*m+L*g)}let C=.5-x*x-S*S;if(C>=0){let B=M+v+e[E+y],O=i[B],L=r[B];C*=C,o=C*C*(O*x+L*S)}let D=.5-A*A-_*_;if(D>=0){let B=M+1+e[E+1],O=i[B],L=r[B];D*=D,l=D*D*(O*A+L*_)}return 70*(a+o+l)}}function l6e(t=Math.random){let e=Aoe(t),i=new Float64Array(e).map(s=>eO[s%12*3]),r=new Float64Array(e).map(s=>eO[s%12*3+1]),n=new Float64Array(e).map(s=>eO[s%12*3+2]);return function(s,a,o){let l,c,h,u,d=(s+a+o)*a6e,f=vw(s+d),p=vw(a+d),m=vw(o+d),g=(f+p+m)*eh,v=f-g,y=p-g,x=m-g,S=s-v,A=a-y,_=o-x,M,E,T,C,D,B;S>=A?A>=_?(M=1,E=0,T=0,C=1,D=1,B=0):S>=_?(M=1,E=0,T=0,C=1,D=0,B=1):(M=0,E=0,T=1,C=1,D=0,B=1):A<_?(M=0,E=0,T=1,C=0,D=1,B=1):S<_?(M=0,E=1,T=0,C=0,D=1,B=1):(M=0,E=1,T=0,C=1,D=1,B=0);let O=S-M+eh,L=A-E+eh,H=_-T+eh,q=S-C+2*eh,W=A-D+2*eh,I=_-B+2*eh,z=S-1+3*eh,U=A-1+3*eh,X=_-1+3*eh,Q=f&255,re=p&255,ie=m&255,ce=.6-S*S-A*A-_*_;if(ce<0)l=0;else{let _e=Q+e[re+e[ie]];ce*=ce,l=ce*ce*(i[_e]*S+r[_e]*A+n[_e]*_)}let Z=.6-O*O-L*L-H*H;if(Z<0)c=0;else{let _e=Q+M+e[re+E+e[ie+T]];Z*=Z,c=Z*Z*(i[_e]*O+r[_e]*L+n[_e]*H)}let Ae=.6-q*q-W*W-I*I;if(Ae<0)h=0;else{let _e=Q+C+e[re+D+e[ie+B]];Ae*=Ae,h=Ae*Ae*(i[_e]*q+r[_e]*W+n[_e]*I)}let Se=.6-z*z-U*U-X*X;if(Se<0)u=0;else{let _e=Q+1+e[re+1+e[ie+1]];Se*=Se,u=Se*Se*(i[_e]*z+r[_e]*U+n[_e]*X)}return 32*(l+c+h+u)}}function Aoe(t){let e=new Uint8Array(512);for(let i=0;i<512/2;i++)e[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(t()*(256-i)),n=e[i];e[i]=e[r],e[r]=n}for(let i=256;i<512;i++)e[i]=e[i-256];return e}var oc=new Ws,c6e=class{constructor(t){this.weightAttribute=null;let e=t.geometry;if(!e.isBufferGeometry||e.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(e=e.toNonIndexed()),this.geometry=e,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let t=this.positionAttribute,e=new Float32Array(t.count/3);for(let r=0;r<t.count;r+=3){let n=1;oc.a.fromBufferAttribute(t,r),oc.b.fromBufferAttribute(t,r+1),oc.c.fromBufferAttribute(t,r+2),n*=oc.getArea(),e[r/3]=n}this.distribution=new Float32Array(t.count/3);let i=0;for(let r=0;r<e.length;r++)i+=e[r],this.distribution[r]=i;return this}setRandomGenerator(t){return this.randomFunction=t,this}sample(t,e){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,t,e)}}binarySearch(t){if(!this.distribution)return 0;let e=this.distribution,i=0,r=e.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||e[s-1]<=t&&e[s]>t){n=s;break}else t<e[s]?r=s-1:i=s+1}return n}sampleFace(t,e,i){let r=this.randomFunction(),n=this.randomFunction();return r+n>1&&(r=1-r,n=1-n),oc.a.fromBufferAttribute(this.positionAttribute,t*3),oc.b.fromBufferAttribute(this.positionAttribute,t*3+1),oc.c.fromBufferAttribute(this.positionAttribute,t*3+2),e.set(0,0,0).addScaledVector(oc.a,r).addScaledVector(oc.b,n).addScaledVector(oc.c,1-(r+n)),oc.getNormal(i),this}},h6e=Ip(nse()),u6e=new st,d6e=new st,f6e=new st,Wg;(t=>{function e(i){return i&&i.__isSPEObject}t.is=e})(Wg||(Wg={}));var pG=t=>class extends t{constructor(){super(...arguments),this.previousModelViewMatrix=new st,this.copyPreviousMatrix=!0,this.hiddenMatrix=new st,this.matrixWorldRigid=new st,this.shearScale=new st,this.shearScaleInv=new st}get __isSPEObject(){return!0}isDescendantOf(e){e instanceof Ji&&(e=e.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===e)return!0;i=i.parent}return!1}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);for(let i of this.children)i.updateMatrixWorld(e)}updateWorldMatrix(e,i){let r=this.parent;if(e&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseChildren(e,i=0){for(let r of this.children)Wg.is(r)&&r.traverseObject(e,i+1)}traverseObject(e,i=0){if(e(this,i)!==!0)for(let r of this.children)Wg.is(r)&&r.traverseObject(e,i+1)}updateMatrixWorldSVD(){let e=this.matrixWorld.elements,i=[[e[0],e[4],e[8]],[e[1],e[5],e[9]],[e[2],e[6],e[10]]],{u:r,v:n,q:s}=(0,h6e.SVD)(i),a=u6e.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),o=d6e.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),l=f6e.copy(o).transpose();this.shearScale.makeScale(s[0],s[1],s[2]).multiply(l).premultiply(o),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(a,l).copyPosition(this.matrixWorld),s.every(c=>Math.abs(s[0]-c)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(e,i){this.updateWorldMatrix(!0,!1);let r=new st().copy(this.matrixWorld).invert();return e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),r.multiply(e.parent.matrixWorld)),"hiddenMatrix"in e&&e.hiddenMatrix instanceof st?e.hiddenMatrix.premultiply(r):e.applyMatrix4(r),e.updateWorldMatrix(!1,!1),this.add(e),i!==void 0&&(this.children.pop(),this.children.splice(i,0,e)),this}copy(e,i=!1){return super.copy(e,i),this.hasNonUniformScale=e.hasNonUniformScale,this}onAfterRender(e,i,r,n,s,a){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},p6e=class extends pG(Ji){},m6e=t=>t.type==="Mesh",qs=class extends p6e{constructor(t){super(),this.object=t,this.matrixAutoUpdate=!1,this.hasNonUniformScale=t.hasNonUniformScale}raycast(t,e){}expand(){let t=0,e=this.object.entityChildren(t);for(;e;){let i=this.children[t];(i==null?void 0:i.object)!==e&&(i&&this.remove(i),i=new qs(e),this.add(i),this.children.splice(t,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=e.matrix,i.hiddenMatrix=e.hiddenMatrix),i.expand(),t+=1,e=this.object.entityChildren(t)}for(;this.children.length>t;)this.remove(this.children[t])}get visible(){var t;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((t=this.object.dataPatched.cloner)==null?void 0:t.hideBase)===!0}set visible(t){}get castShadow(){return this.object.castShadow}set castShadow(t){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(t){}get isMesh(){return m6e(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(t){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},Im=new N,Lm=new N,Dy=new st,Eoe=[new N(-1,1,1),new N(-1,-1,1),new N(1,-1,1),new N(1,1,1),new N(-1,1,-1),new N(-1,-1,-1),new N(1,-1,-1),new N(1,1,-1)],g6e=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],v6e=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],Aq=(t,e,i)=>{t.updateEntityBoxSize(Im,Lm),Dy.copy(e).multiply(t.matrixWorld),Lm.x===0&&Lm.y===0&&Lm.z===0?i.push(new N(Im.x,Im.y,Im.z).applyMatrix4(Dy)):Eoe.forEach(r=>{i.push(r.clone().multiply(Lm).add(Im).applyMatrix4(Dy))})},Eq=class extends _n{constructor(){super(...arguments),this.matrix=new st,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(t){return super.copy(t),this.matrix.copy(t.matrix),this.vertices=t.vertices.map(e=>e.clone()),this.faces=t.faces.map(e=>e.clone()),this.edges=t.edges.map(e=>e.clone()),this.centerEdges=t.centerEdges.map(e=>e.clone()),this}setFromObjectSize(t,e=!1){t.updateWorldMatrix(!1,e),this.makeEmpty(),this.matrix.copy(t.matrixWorld);let i=new st().copy(t.matrixWorld).invert();return this.expandByObjectSize(t,i,e)}expandByObjectSize(t,e,i=!1){let r=[];return i===!0?t.traverseEntity(n=>{if(n.visible||n.cloner&&n.data.visible){if(!("geometry"in n)){r.push(new N);return}Aq(n,e,r)}}):Aq(t,e,r),this.setFromPoints(r)}getCenter(t){return t=super.getCenter(t),t.applyMatrix4(this.matrix),t}getPositionToCenter(t){return t=super.getCenter(t),t.applyMatrix4(Dy.copy(this.matrix).setPosition(0,0,0)),t}computeVertices(){this.getSize(Lm).multiplyScalar(.5),this.getCenter(Im),Dy.copy(this.matrix).setPosition(Im),this.vertices=Eoe.map(t=>t.clone().multiply(Lm).applyMatrix4(Dy))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=g6e.map(([t,e])=>new Ul(this.vertices[t],this.vertices[e])),this.centerEdges=this.edges.map(t=>t.getCenter(new N))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=v6e.map(([t,e])=>this.vertices[t].clone().add(this.vertices[e]).multiplyScalar(.5))}},kf={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},y6e=class extends Ose{constructor(){super()}getPoints(t=12){let e=[],i,r=this.getCurveLengths(),n=r[r.length-1]/r.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=s===0?r[s]:r[s]-r[s-1],c=Math.ceil(t*l/n),h=o.getPoints(c);for(let u=0;u<h.length;u++){let d=h[u];i&&i.equals(d)||(e.push(d),i=d)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}},VN=.001;function HN(t,e,i){return e.clone().sub(t).cross(e.clone().sub(i)).length()<=VN}function tO(t,e){let i=new N(...t.position),r=new N(...t.controlNext.position),n=new N(...e.controlPrevious.position),s=new N(...e.position);return HN(i,r,s)&&HN(i,n,s)}function Moe(t){let e=t.points.map(h=>new N(...h.data.position)),i=[t.points[0]],r=new N(...i[0].data.position);for(let h=0;h<t.points.length-1;h++)HN(r,e[h],e[h+1])||(i.push(t.points[h]),r=e[h]);i.push(t.points[t.points.length-1]);let n=t.isClosed,s=i.length-(n?0:1),a=i.length,o=[];for(let h=0;h<a;h++){let u=i[h].data,d=new N(...u.position),f=new N(...u.controlPrevious.position),p=new N(...u.controlNext.position),m={position:d,baseRoundness:u.roundness,controlPrevious:f,controlNext:p};if(u.roundness===0||!t.isClosed&&(h===0||h===a-1)){o[h]={...m,removedLength:0};continue}let g=n&&h==0?a-1:h-1,v=n&&h==a-1?0:h+1,y=i[g].data,x=i[v].data,S=new N(...y.position),A=new N(...x.position),_=S.clone().sub(d).normalize(),M=A.clone().sub(d).normalize();Object.assign(m,{prevDir:_,nextDir:M});let E=tO(y,u),T=tO(u,x);if(!E||!T)o[h]={...m,removedLength:0};else{let C=_.clone().add(M).normalize(),D=C.clone().cross(_).length()/_.dot(C);o[h]={...m,tan:D,removedLength:u.roundness/D}}}for(let h=0;h<s;h++){let u=h,d=n&&h===a-1?0:h+1,f=o[u],p=o[d];if(f.removedLength!==0||p.removedLength!==0){let m=f.position.distanceTo(p.position);f.removedLength=Math.min(f.removedLength,m/2),p.removedLength=Math.min(p.removedLength,m/2)}}let l=[];for(let h=0;h<s;h++){let u=h,d=n&&h===a-1?0:h+1,f=o[u],p=o[d],m=null;if(!tO(i[u].data,i[d].data))f.position.distanceTo(p.position)>VN&&(m=new uC(f.position,f.controlNext,p.controlPrevious,p.position));else{let g=f.position.clone(),v=p.position.clone();(f.removedLength!==0||p.removedLength!==0)&&(f.nextDir&&g.add(f.nextDir.clone().setLength(f.removedLength)),p.prevDir&&v.add(p.prevDir.clone().setLength(p.removedLength))),g.distanceTo(v)>VN&&(m=new uC(g,g.clone().lerp(v,.3),v.clone().lerp(g,.3),v))}l[2*h+1]=m}for(let h=0;h<a;h++){let u=o[h];if(u.removedLength===0){l[2*h]=null;continue}let d=u.position,f=u.prevDir.clone().multiplyScalar(u.removedLength).add(d),p=u.nextDir.clone().multiplyScalar(u.removedLength).add(d),m=u.tan*u.removedLength,g=u.prevDir.clone().add(u.nextDir).normalize(),v=f.clone().lerp(p,.5),y=f.distanceTo(p)/2,x=g.clone().multiplyScalar(Math.sqrt(Math.pow(m,2)-Math.pow(y,2))).add(v),S=g.clone().multiplyScalar(-m).add(x),A=d.distanceTo(S)/d.distanceTo(v),_=u.prevDir.clone().multiplyScalar(A*d.distanceTo(f)).add(d),M=_.clone().lerp(S,2),E=f.clone().lerp(_,4/3),T=p.clone().lerp(M,4/3);l[2*h]=new uC(f,E,T,p)}let c=new y6e;return l.forEach(h=>{h&&c.add(h)}),c}var Ti;(t=>{function e(i){return i&&i.__isEntity}t.is=e})(Ti||(Ti={}));var Fu=t=>Ti.is(t),x6e={type:"completeState",isfromEntity:!0},b6e=["x","y","z"],iO=new N,w6e=new N().set(0,1,0),mG=t=>class extends pG(t){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new Eq,this._recursiveBBox=new Eq,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(e){let i=this.children[e];if(Ti.is(i))return i}entityChildrenCount(){let e=this.children.length;for(;e--;)if(Ti.is(this.children[e]))return e+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let e=this;for(;e.data.type!=="Instance";){let i=e.parent;if(Ti.is(i))e=i;else return}return e}forInstancesRec(e){this.instances.forEach(i=>{i.disposed||e(i),i.forInstancesRec(e)})}super_Entity(e,i){typeof e=="string"&&(this.uuid=e),this.identity=e,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(e,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let n of this.data.states)Km.toOps(this.data,n.data).forEach(s=>{let a=H2.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(a,this.data,i)});if(e!==null){let n=this.data.states.data(e);n&&(this.dataPatched=Km.patch(this.data,n),Km.toOps(this.data,n).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched,i),this.stateSelection=e,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(e,i){e.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{Fu(e)&&e.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(e=>{e.resetBBoxNeedsUpdateSelf()})}find(e){let i;return this.traverseEntity(r=>{r.uuid===e&&(i=r)}),i}traverseSortNextHelper(){let e=this.parent;if(e){let i=e.children,r=i.indexOf(this)+1;if(Ti.is(i[r]))return i[r];if(Ti.is(e))return e.traverseSortNextHelper()}}sortNext(){let e=this.children;return this.children.length>0&&Ti.is(this.children[0])?e[0]:this.traverseSortNextHelper()}goUp(e){let i=this;for(;e>0&&i!==null;)i=i.parent,e-=1;return i}hasAnccestorOrSelf(e){return this===e||this.hasAnccestor(e)}hasAnccestor(e){let i=this.parent;for(;i;){if(e===i)return!0;i=i.parent}return!1}countToAccestor(e){let i=0,r=this;for(;r!==e;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(e){for(let i of this.children)Fu(i)&&e(i)}traverseEntityAncestors(e){this.traverseAncestors(i=>{Ti.is(i)&&e(i)})}traverseConcreteEntity(e,i=0){if(e(this,i)!==!0)for(let r of this.children)Fu(r)&&r.isConcreteEntity&&r.traverseEntity(e,i+1)}traverseEntity(e,i=0){if(e(this,i)!==!0)for(let r of this.children)Fu(r)&&r.traverseEntity(e,i+1)}traverseVisibleEntity(e){e(this);for(let i of this.children)Fu(i)&&i.visible&&i.traverseVisibleEntity(e)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.dispatchEvent({type:"updateMatrixWorld"})}copy(e,i=!1){return super.copy(e,i),this.dataPatched=e.dataPatched,this.raycastLock=e.raycastLock,this.scaleLock=e.scaleLock,this.hiddenMatrix.copy(e.hiddenMatrix),this}hasEntityChild(){return this.children.some(e=>Fu(e))}isAncestorOf(e){if(this.uuid===e)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===e&&(i=!0)}),i}toObjectTransformState(e=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*Et.RAD2DEG,this.rotation.y*Et.RAD2DEG,this.rotation.z*Et.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return Qk(i,e)}getTransformValues(e,i,r){return i[e].map((n,s)=>(r==null?void 0:r.shared.getVariable(n,[this.uuid,e,b6e[s]]))??n)}updateTransformState(e,i){let r=!1;return e.position&&(this.position.fromArray(this.getTransformValues("position",e,i)),r=!0),e.rotation&&(iO.fromArray(this.getTransformValues("rotation",e,i)).multiplyScalar(Et.DEG2RAD),this.rotation.setFromVector3(iO),r=!0),e.scale&&(this.scale.fromArray(this.getTransformValues("scale",e,i)),r=!0),e.hiddenMatrix!==void 0&&(r=!0,this.hiddenMatrix.fromArray(e.hiddenMatrix??u1.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(n=>{n.invalidateClonerTransform(this)})),e.position&&e.rotation&&e.scale&&e.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),r}onVariableUpdate(e=!1){if(e){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let e of this.children)Ti.is(e)&&e.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(e=>{Ti.is(e)&&e.disposeRecursively()})}toState(e=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(e)};return Qk(i,e)}updateByObjUpdateOp(e,i){e!==void 0&&this.updateByOp({type:0,props:e,path:[]},{...this.data,...e},i,!1)}updateByOp(e,i,r,n){let s=this.data;this.data=i;let a=e,o=hr(e.path,["states","*"]);if(o!==null){if(e.type===0){let[l]=o;if((this==null?void 0:this.stateSelection)===l){let c={...e.props};if(delete c.name,Object.values(e.props).some(h=>h===void 0)){let h=this.data;if(h!==void 0){let u=es.zoom(h,e.path.slice(2));if(u)for(let d in e.props)e.props[d]===void 0&&d in u&&(c[d]=u[d])}}a={...e,props:c,path:e.path.slice(2)}}}}else if(e.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(e.props.name!==void 0&&l.name){let{name:h,...u}=l;l=u}if(e.props.material!==void 0&&"material"in l){let{material:h,...u}=l;l=u}let c=es.removeOverridden(e.path,e.props,l);a={...e,props:c}}}if(this.updateByPatchedOpBase(a,Km.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),hr(e.path,["overrides"])){let l=[],c=[...e.path];for(l.push(c[1]),c.splice(0,2);c.length>0&&c[0]==="descendants";)l.push(c[1]),c.splice(0,2);if(l[l.length-1]===void 0){if(e.type===0)for(let h of Object.keys(e.props)){l[l.length-1]=h;let u=r.scene.findInstance([this.uuid,...l]);u&&(u.overrideData=e.props[h],u.updateState(ep.apply(u.component.data,u.overrideData),r))}}else{let h=r.scene.findInstance([this.uuid,...l]);if(h){let u=es.zoom(h.component.data,c);if(e={...e,path:c},e.type===0){let d=e.props;if(u)for(let[f,p]of Object.entries(e.props))p===void 0&&(d===e.props&&(d={...e.props}),d[f]=u[f]);e={...e,props:d}}h.overrideData=eP.resolve(i.overrides,l),h.updateByOp(e,As.applySimple(h.data,e),r,!1)}}}else if(this.instances.length>0){let l;if(e.path.length===0&&e.type===0){let c;for(let h of Bf.rootOverrideProps)h in e.props&&(c===void 0&&(c={}),c[h]=e.props[h]);c&&(l={...e,props:c})}else for(let c of Bf.rootOverrideProps)if(hr(e.path,[c])){l=e;break}l!==void 0&&this.instances.forEach(c=>{if(c.isInstanceRoot){let h=ep.filterOp(c.overrideData,l);h&&c.updateByOp(h,As.applySimple(c.data,h),r,!0)}}),this.instances.forEach(c=>{if(!c.isInstanceRoot){let h=ep.filterOp(c.overrideData,e);if(h){let u;s===c.data&&e===h?u=i:u=As.applySimple(c.data,h),c.updateByOp(h,u,r,!0)}}})}}updateByPatchedOpBase(e,i,r){if(this.dataPatched=i,e.path.length===0&&e.type===0)e.props.type!==void 0&&!jg.is(e.props.type)&&kf.changeEntityProptotype(this,i,r);else if(e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&"type"in e.props){kf.changeEntityProptotype(this,i,r);for(let n of this.children)Ti.is(n)&&n.updateVisible(r.scene)}this.updateByPatchedOp(e,i,r)}updateByPatchedOp(e,i,r){var n;if(e.path.length===0&&e.type===0?this.updateState(e.props,r):e.type===0&&("resolutionLevel"in e.props||"useChildrenColors"in e.props)&&this.updateState(i,r),e.path[0]==="morphTargetInfluences"&&e.type===0){let s=(n=i.morphTargetInfluences.get(e.path[1]))==null?void 0:n.data.name;s&&this.updateMorphInfluences(s,r.shared.getVariable(e.props.value,[this.uuid,"morphTargetInfluences",s]))}if(hr(e.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),hr(e.path,["cloner"])!==null){let s=As.drop(e,1);s.path.length===0&&s.type===0&&s.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible(r.scene)}}updatePathSnapping(e=this.dataPatched.pathSnapping){this._updatedPathSnapping=e,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(e){var p,m,g,v,y;let i=((p=this._updatedPathSnapping)==null?void 0:p.pathId)??this.dataPatched.pathSnapping.pathId,r=((m=this._updatedPathSnapping)==null?void 0:m.slide)??this.dataPatched.pathSnapping.slide??0,n=((g=this._updatedPathSnapping)==null?void 0:g.offset)??this.dataPatched.pathSnapping.offset??0,s=((v=this._updatedPathSnapping)==null?void 0:v.orientation)??this.dataPatched.pathSnapping.orientation;if(i===null)return;let a=e.find(i);if(!a||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let o=a.data;if(o.geometry.path.points.length<=1)return;let l=Moe(o.geometry.path),c=(r+n)%1;r+n===1&&c===0&&(c=1);let h=null;try{h=l.curves.length?l.getPointAt(c):null}catch{}if(h===null)return;let u=this.parent?(y=this.parent)==null?void 0:y.matrixWorld:new st;a.updateMatrixWorld();let d=new st().multiplyMatrices(u.clone().invert(),a.matrixWorld);h.applyMatrix4(d);let f={position:h.toArray(),rotation:o.rotation};if(s==="tangential"){let x=new st().extractRotation(a.matrixWorld),S=l.getTangentAt(c).applyMatrix4(x).add(h),A=new st().lookAt(h,S,w6e),_=iO.setFromEuler(new Zn().setFromRotationMatrix(A)).multiplyScalar(Et.RAD2DEG);f={...f,rotation:_.toArray()}}this.updateTransformState(f),this.traverseEntity(x=>{x._cameraType&&x.dispatchEvent(x6e)})}updateVisible(e){var r;if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((r=this.dataPatched.cloner)==null?void 0:r.hideBase)!==!0),!e)return;let i=!1;this.traverseEntity(n=>{if(n.data.type==="Splat")return i=!0,!0}),i&&e.reloadSplats()}updateState_Entity(e,i){e.name!==void 0&&(this.name=e.name),e.raycastLock!==void 0&&(this.raycastLock=e.raycastLock),e.visible!==void 0&&(this.updateVisible(i==null?void 0:i.scene),this.resetBBoxNeedsUpdate()),i&&"cloner"in e&&e.cloner!==void 0&&(this.setFromClonerState(e.cloner,i),this.updateVisible(i.scene)),this.updateTransformState(e,i)}get attachedSurfaceCloners(){return this.children.filter(e=>e instanceof kf.Cloner&&e.parameters.type==="toObject")}setFromClonerState(e,i){this.disposed||(e===null||e.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new kf.Cloner(this,e),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(e,i.scene))}expandCloner(e){!this.disposed&&this.cloner&&this.cloner.expandClones(e)}invalidateClonerTransform(e){this.cloner&&this.cloner.invalidateTransform(e)}requestRender(){this.dispatchEvent({type:"requestRender"})}},Toe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){var l,c;let i=(l=t.parameters)==null?void 0:l.radiusTop,r=(c=t.parameters)==null?void 0:c.radiusBottom,n=Object.assign({},(e==null?void 0:e.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},t.parameters);n.thetaLength=Et.clamp(n.thetaLength,0,360);let s=n.width/2,a=n.radiusTop??s,o=n.radiusBottom??s;if(a===o?(a=s,o=s):a>o?(a=s,o=o*s/a):(a=a*s/o,o=s),n.shapeBlendNode){a=i??s,o=r??s;let h=Math.max(a,o)*2;n.width=h,n.depth=h}return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width),radiusTop:a,radiusBottom:o})}}static build(t){let{width:e,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,radiusTop:c,radiusBottom:h,cornerRadius:u,cornerSegments:d,hollow:f}=t.parameters,p;return l===0?(p=new Nt,p.setAttribute("position",new bt([],3))):u||f?p=new Coe(c,h,r,n,s,a,o,l*Math.PI/180,u,u,d,f):p=new L5(c,h,r,n,s,a,o,l*Math.PI/180),p.scale(1,1,i/e),Object.assign(p,{userData:{...t,type:"CylinderGeometry"}})}};function nf(t,e,i){i.x=t.x*e.x,i.y=t.y,i.z=t.x*e.y}function Mq(t){return new ye(t.y,-t.x)}var Coe=class extends Nt{constructor(t,e,i,r,n,s,a,o,l,c,h,u,d=!1){super(),this.type="RoundedCylinderBufferGeometry",t=t!==void 0?t:1,e=e!==void 0?e:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,s=s!==void 0?s:!1,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2,s&&(l=0,c=0);let f=[],p=[],m=[],g=[],v=0,y=i/2,x=new N,S=new N;d&&t==0&&(t=l),d&&e==0&&(e=c);let A=new ye(t,y),_=new ye(e,-y),M=null,E=null,T=null,C=null,D=A.clone().sub(_),B=0,O=0,L=0;u>0&&(B=Math.min(t,e)*(1-u),O=t-B,L=e-B);let H=A.clone();H.x-=B;let q=Math.PI-D.angle(),W=D.angle(),I=Math.tan(W/2),z=Math.tan(q/2),U=I+z,X=u?U:z,Q=u?U:I;if(l=Math.min(l,(t-O)/X,D.length()/U),c=Math.min(c,(e-L)/Q,D.length()/U),l>0){let Se=l/I;M=A.clone().sub(new ye(Se,l)),u&&(T=M.clone(),T.x-=B-U*l),A.sub(D.clone().setLength(Se))}if(c>0){let Se=c/z;E=_.clone().sub(new ye(Se,-c)),_.add(D.clone().setLength(Se)),u&&(C=E.clone(),C.x-=B-U*c,H.sub(D.clone().setLength(Se)))}D=A.clone().sub(_);let re=D.length()<.5,ie=[];for(let Se=0;Se<=r;Se++){let _e=[],ve=Se/r,Ee=ve*o+a,fe=new ye(Math.sin(Ee),Math.cos(Ee));C&&E?(ce(_e,ve,fe,q,c,C,-1,!0),ce(_e,ve,fe,W,c,E,-1,!1)):E?(Z(_e,fe,E.x,0,-1),ce(_e,ve,fe,W,c,E,-1,!1)):s||Z(_e,fe,e,L,-1);let pe=Mq(D).normalize();if(nf(pe,fe,x),!re)for(let Ie=0;Ie<=n;Ie++){let Le=Ie/n,Ge=D.clone().multiplyScalar(Le).add(_);nf(Ge,fe,S),p.push(S.x,S.y,S.z),m.push(x.x,x.y,x.z),g.push(ve,.5+S.y/i),_e.push(v++)}if(T&&M?(ce(_e,ve,fe,q,l,M,1,!1),ce(_e,ve,fe,W,l,T,1,!0)):M?(ce(_e,ve,fe,q,l,M,1,!1),Z(_e,fe,M.x,0,1)):s||Z(_e,fe,t,O,1),u&&!re){let Ie=Mq(D).multiplyScalar(-1).normalize();nf(Ie,fe,x);for(let Le=0;Le<=n;Le++){let Ge=Le/n,Ke=D.clone().multiplyScalar(-Ge).add(H);nf(Ke,fe,S),p.push(S.x,S.y,S.z),m.push(x.x,x.y,x.z),g.push(ve,.5+S.y/i),_e.push(v++)}}u&&!s&&_e.push(_e[0]),ie.push(_e)}for(let Se=0;Se<ie.length-1;Se++)for(let _e=0;_e<ie[0].length-1;_e++){if(s&&u&&_e==n)continue;let ve=ie[Se][_e],Ee=ie[Se+1][_e],fe=ie[Se+1][_e+1],pe=ie[Se][_e+1],Ie=p[fe*3+0],Le=p[fe*3+2];f.push(ve,Ee,pe),(Ie!=0||Le!=0)&&f.push(Ee,fe,pe)}o<Math.PI*2&&(Ae(-1,ie[0],a),Ae(1,ie[ie.length-1],a+o)),this.setIndex(f),this.setAttribute("position",new bt(p,3)),this.setAttribute("normal",new bt(m,3)),this.setAttribute("uv",new bt(g,2));function ce(Se,_e,ve,Ee,fe,pe,Ie,Le){for(let Ge=0;Ge<h+1;Ge++){let Ke=Ge/h,Ve=Ie<0?Ke:1-Ke;Le&&(Ve-=1),Ve*=Ee;let ke=new ye(Math.sin(Ve),Math.cos(Ve)*Ie),ut=ke.clone().multiplyScalar(fe).add(pe);nf(ut,ve,S),p.push(S.x,S.y,S.z),nf(ke,ve,x),m.push(x.x,x.y,x.z),g.push(_e,.5+S.y/i),Se.push(v++)}}function Z(Se,_e,ve,Ee,fe){let pe=new N,Ie=new ye,Le=[ve,Ee];fe<0&&Le.reverse();for(let Ge of Le)Ie.set(Ge,y*fe),nf(Ie,_e,pe),p.push(pe.x,pe.y,pe.z),m.push(0,fe,0),g.push(.5,.5),Se.push(v++)}function Ae(Se,_e,ve){let Ee=new ye(Math.sin(ve),Math.cos(ve)),fe=new ye(-Math.cos(ve),Math.sin(ve)),pe=new N,Ie=Se<0?(Ke,Ve,ke)=>f.push(Ke,Ve,ke):(Ke,Ve,ke)=>f.push(Ke,ke,Ve),Le=new ye((t+e+O+L)/4,0);nf(Le,Ee,pe),p.push(pe.x,pe.y,pe.z),m.push(fe.x,0,fe.y),g.push(.5,.5);let Ge=v++;for(let Ke of _e){let Ve=p.slice(Ke*3,Ke*3+3);p.push(...Ve),m.push(fe.x,0,fe.y);let ke=g.slice(Ke*2,Ke*2+2);g.push(...ke),v++}for(let Ke=Ge+1;Ke<v-1;Ke++)Ie(Ge,Ke,Ke+1);Ie(Ge,v-1,Ge+1)}}},S6e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},t.parameters);return i.thetaLength=Et.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,cornerRadiusTop:c,cornerRadiusBottom:h,cornerSegments:u}=t.parameters,d;return l===0?(d=new Nt,d.setAttribute("position",new bt([],3))):c>0||h>0||l<360?d=new Coe(0,e/2,r,n,s,a,o,l*Math.PI/180,c,h,u,0,!0):d=new O5(e/2,r,n,s,a),d.scale(1,1,i/e),Object.assign(d,{userData:{...t,type:"ConeGeometry"}})}},_6e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a,cornerRadius:o,cornerSegments:l}=t.parameters,c;return o===0?c=new Bc(e,i,r,n,s,a):c=new A6e(e,i,r,n,s,a,o,l),Object.assign(c,{userData:{...t,type:"CubeGeometry"}})}},rO=Math.PI/2,A6e=class extends Nt{constructor(t=1,e=1,i=1,r=1,n=1,s=1,a=0,o=4){super(),this.type="BoxGeometry",r=Math.floor(r),n=Math.floor(n),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,t/2,e/2,i/2);let l=[],c=[],h=[],u=[],d=0;f("z","y","x",-1,-1,i,e,t,s,n),f("z","y","x",1,-1,i,e,-t,s,n),f("x","z","y",1,1,t,i,e,r,s),f("x","z","y",1,-1,t,i,-e,r,s),f("x","y","z",1,-1,t,e,i,r,n),f("x","y","z",-1,-1,t,e,-i,r,n),a>0&&(p("z","y","x",-1,-1,1,i,e,t,s),p("z","y","x",1,-1,-1,i,e,t,s),p("z","y","x",-1,1,-1,i,e,t,s),p("z","y","x",1,1,1,i,e,t,s),p("x","y","z",-1,-1,-1,t,e,i,r),p("x","y","z",1,-1,1,t,e,i,r),p("x","y","z",-1,1,1,t,e,i,r),p("x","y","z",1,1,-1,t,e,i,r),p("y","x","z",-1,-1,1,e,t,i,n),p("y","x","z",1,-1,-1,e,t,i,n),p("y","x","z",1,1,1,e,t,i,n),p("y","x","z",-1,1,-1,e,t,i,n),m(1,1,1),m(-1,1,1),m(1,-1,1),m(-1,-1,1),m(1,1,-1),m(-1,1,-1),m(1,-1,-1),m(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new bt(c,3)),this.setAttribute("normal",new bt(h,3)),this.setAttribute("uv",new bt(u,2));function f(g,v,y,x,S,A,_,M,E,T){let C=(A-2*a)/E,D=(_-2*a)/T,B=A/2-a,O=_/2-a,L=M/2,H=E+1,q=T+1,W=0,I=new N;for(let z=0;z<q;z++){let U=z*D-O;for(let X=0;X<H;X++){let Q=X*C-B;I[g]=Q*x,I[v]=U*S,I[y]=L,c.push(I.x,I.y,I.z),I[g]=0,I[v]=0,I[y]=M>0?1:-1,h.push(I.x,I.y,I.z),u.push(X/E),u.push(1-z/T),W+=1}}for(let z=0;z<T;z++)for(let U=0;U<E;U++){let X=d+U+H*z,Q=d+U+H*(z+1),re=d+(U+1)+H*(z+1),ie=d+(U+1)+H*z;l.push(X,Q,ie),l.push(Q,re,ie)}d+=W}function p(g,v,y,x,S,A,_,M,E,T){let C=(_-2*a)/T,D=_/2-a,B=M/2-a,O=E/2,L=T+1,H=0,q=new N,W=new N;for(let I=0;I<o+1;I++){let z=I/o*rO,U=Math.sin(z)*a,X=(1-Math.cos(z))*a,Q=Math.sin(z),re=Math.cos(z);q[v]=(B+U)*S,q[y]=(O-X)*A,W[g]=0,W[v]=Q*Math.sign(q[v]),W[y]=re*Math.sign(q[y]);for(let ie=0;ie<L;ie++){let ce=ie*C-D;q[g]=ce*x,c.push(q.x,q.y,q.z),h.push(W.x,W.y,W.z),u.push(ie/T),u.push(0),H+=1}}for(let I=0;I<o;I++)for(let z=0;z<T;z++){let U=d+z+L*I,X=d+z+L*(I+1),Q=d+(z+1)+L*(I+1),re=d+(z+1)+L*I;l.push(U,X,re),l.push(X,Q,re)}d+=H}function m(g,v,y){let x=new N,S=new N(t/2,e/2,i/2);S.subScalar(a);let A=[],_=g*v*y>0?(E,T,C)=>l.push(E,T,C):(E,T,C)=>l.push(E,C,T);for(let E=0;E<=o;E++){let T=[],C=rO*(1-E/o),D=Math.cos(C),B=Math.sin(C),O=0;for(let L=0;L<=E;L++){let H=Math.cos(O),q=Math.sin(O);x.x=D*H,x.y=B,x.z=D*q;let W=S.clone().addScaledVector(x,a);c.push(g*W.x,v*W.y,y*W.z),h.push(g*x.x,v*x.y,y*x.z),u.push(0,0),T.push(d++),O+=rO/E}A.push(T)}let M=A.length-1;for(let E=0;E<M;E++){let T=A[E],C=A[E+1],D=T.length-1;_(T[0],C[1],C[0]);for(let B=1;B<=D;B++)_(T[B-1],T[B],C[B]),_(T[B],C[B+1],C[B])}}}},gG=class extends Nt{constructor(t=[],e=[],i="",r=1,n=.2,s=4){super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];c(),h(),this.setAttribute("position",new bt(a,3)),this.setAttribute("normal",new bt(l,3)),this.setAttribute("uv",new bt(o,2));return;function c(){var W;n=Math.min(1-1e-5,n),n==0&&(s=0);let u={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new N,f=d.clone(),p=new Ws,m=n*r,g=r-m,v=s+1,y=new N,x=(I,z)=>y.subVectors(I,z).normalize(),S=(I,z)=>Array(I).fill(void 0).map(z),A=S(t.length/3,(I,z)=>new N().fromArray(t,z*3).setLength(r)),_=[],M=1e6;for(let I=0;I<A.length;I++){let z=A[I],U=[],X,Q,re,ie=1e10,ce=-1;for(;(ce=e.indexOf(I,ce+1))!=-1;){let _e=ce-ce%3;X=e[_e+(ce+1)%3],Q=e[_e+(ce+2)%3],re=z.distanceToSquared(A[X]),ie=Math.min(ie,re),U.push([X,Q,re])}ie+=1e-6;let Z=[],Ae=0,Se=U.length;for(let _e=0;_e<Se;_e++){[X,Q,re]=U[Ae];let ve=((W=_[X])==null?void 0:W.includes(I))==!0;re<=ie&&Z.push(X+ +ve*M),Ae=U.findIndex(Ee=>Ee[0]==Q)}_.push(Z)}let E=[];{let I=0,z=0,U,X,Q=u==3;for(let re=0;re<=s;re++){U=re*(re+1)/2,X=(re+1)*(re+2)/2;for(let ie=0;ie<s-re;ie++)[I,z]=[U+ie+re+2,X+ie+re+3],E.push(U,X,...Q?[z,U]:[I,X],z,I),[U,X]=[I,z];E.push(U,X,U+s+2)}}let T=d.clone(),C=d.clone(),D=d.clone(),B=d.clone(),O=d.clone(),L=[],H=S(A.length,()=>S(u,()=>d.clone()));for(let I=0;I<A.length;I++){d.copy(A[I]).normalize(),T.copy(d).multiplyScalar(g);let z=_[I];for(let Z=0;Z<z.length;Z++){let Ae=z[Z],Se=z[(Z+1)%u];p.setFromPointsAndIndices(A,I,Ae%M,Se%M),p.b.sub(p.a).setLength(1e10).add(p.a),p.c.sub(p.a).setLength(1e10).add(p.a),p.closestPointToPoint(T,H[I][Z])}let U=[],X=[],Q=[],re=new N;s==0&&[...H[I]].reduce((Z,Ae)=>Z.add(Ae),re).multiplyScalar(1/u);for(let Z=0;Z<u;Z++){let Ae=[],Se=(Z-1+u)%u,_e=H[I][Se],ve=H[I][Z];d.copy(_e).sub(T),f.copy(ve).sub(T);let Ee=T.angleTo(d),fe=d.angleTo(f),pe=Math.cos(Ee)*m;s==0?C.copy(re):C.copy(T).setLength(g+pe),X.push(pe);let Ie=[C,_e,ve];for(let Le=0;Le<2;Le++){let Ge=Ie[Le],Ke=Ie[Le+1];B.subVectors(Ge,T),O.subVectors(Ke,T),D.crossVectors(B,O).normalize();for(let Ve=0;Ve<v;Ve++){let ke=[Ee,fe][Le]*Ve/v;d.copy(B).applyAxisAngle(D,ke).add(T),U.push(d.clone()),Le&&(x(d,T),Ae.push([Ve==0?Ge:d.clone(),y.clone()]))}Le&&(x(Ke,T),Ae.push([Ke,y.clone()]))}Q.push(Ae)}L.push(Q);let ie=2*v,ce=2;for(let Z=0;Z<u;Z++){let Ae=ie*Z,Se=ie*((Z+1)%u),_e=[U[Ae]];for(let Ee=1;Ee<v;Ee++){B=U[Ae+Ee],O=U[Se+Ee],_e.push(B);for(let fe=1,pe=Ee-ce+1;fe<=pe;fe++)d.lerpVectors(B,O,fe/(pe+1)),d.sub(T).setLength(X[Z]).add(T),_e.push(d.clone());_e.push(O)}for(let Ee=0;Ee<v;Ee++)_e.push(U[Ee+v+Ae]);_e.push(U[Se+v]);let ve=E.map(Ee=>_e[Ee]);a.push(...ve.map(Ee=>[Ee.x,Ee.y,Ee.z]).flat()),l.push(...ve.map(Ee=>(x(Ee,T),[y.x,y.y,y.z])).flat())}}let q=[];for(let I=0;I<_.length;I++)for(let z=0;z<u;z++){let U=_[I][z];if(U<M){let X=_[U].findIndex(ie=>ie%M==I),Q=L[I][z],re=L[U][X];for(let ie=0;ie<v;ie++){let ce=Q[ie],Z=re[v-ie],Ae=Q[ie+1],Se=re[v-(ie+1)];[ce,Z,Ae,Ae,Z,Se].forEach(_e=>{a.push(_e[0].x,_e[0].y,_e[0].z),l.push(_e[1].x,_e[1].y,_e[1].z)})}q.push(Q[0][0],re[v][0],Q[v][0],re[0][0])}}for(;q.length;){let I,z,U,X;[I,z]=q.splice(0,2);let Q=[I];for(;I!=z;)Q.push(z),U=q.indexOf(z),X=U%2,z=q.splice(U-X,2)[1-X];y.subVectors(Q[0],Q[1]).cross(d.subVectors(Q[0],Q[2])).normalize();let re=y.dot(Q[0])<0;re&&y.negate();for(let ie=1;ie<=Q.length-2;ie++)[Q[ie+ +re],Q[ie+1-+re],Q[0]].forEach(ce=>{a.push(ce.x,ce.y,ce.z),l.push(y.x,y.y,y.z)})}}function h(){let u=new N;for(let _=0;_<a.length;_+=3){u.x=a[_+0],u.y=a[_+1],u.z=a[_+2];let M=S(u)/2/Math.PI+.5,E=A(u)/Math.PI+.5;o.push(M,1-E)}let d=new N,f=new N,p=new N,m=new N,g=new ye,v=new ye,y=new ye,x=(_,M,E,T)=>{T<0&&_.x===1&&(o[M]=_.x-1),E.x===0&&E.z===0&&(o[M]=T/2/Math.PI+.5)};for(let _=0,M=0;_<a.length;_+=9,M+=6){d.set(a[_+0],a[_+1],a[_+2]),f.set(a[_+3],a[_+4],a[_+5]),p.set(a[_+6],a[_+7],a[_+8]),g.set(o[M+0],o[M+1]),v.set(o[M+2],o[M+3]),y.set(o[M+4],o[M+5]),m.copy(d).add(f).add(p).divideScalar(3);let E=S(m);x(g,M+0,d,E),x(v,M+2,f,E),x(y,M+4,p,E)}for(let _=0;_<o.length;_+=6){let M=o[_+0],E=o[_+2],T=o[_+4],C=Math.max(M,E,T),D=Math.min(M,E,T);C>.9&&D<.1&&(M<.2&&(o[_+0]+=1),E<.2&&(o[_+2]+=1),T<.2&&(o[_+4]+=1))}function S(_){return Math.atan2(_.z,-_.x)}function A(_){return Math.atan2(-_.y,Math.sqrt(_.x*_.x+_.z*_.z))}}}static fromJSON(t){return new gG(t.vertices,t.indices,t.radius,t.corner,t.cornerSides)}},E6e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,detail:0,corner:0,cornerSides:4},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,detail:n,corner:s,cornerSides:a}=t.parameters,o=n===0&&s!==0?new Poe(e*.5,s,a):new Fse(e*.5,n);return o.scale(1,i/e,r/e),Object.assign(o,{userData:{...t,type:"DodecahedronGeometry"}})}},Poe=class extends gG{constructor(t=1,e=.2,i=4){let r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o="DodecahedronGeometry";super(s,a,o,t,e,i),this.type=o}static fromJSON(t){return new Poe(t.radius,t.corner,t.cornerSides)}},ub=1e-12,vG=class{constructor(t){this.position=new ye,this.startPosition=new ye,this.uuid=Et.generateUUID(),this.position=t.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(t){this.position.copy(this.startPosition).add(t)}copy(t){return this.position.copy(t.position),this.startPosition.copy(t.startPosition),this}clone(){return new vG(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},jN=class extends vG{constructor(t){super(t.position),this.parent=t}copy(t){return super.copy(t),this}clone(){return new jN(this.parent).copy(this)}},Ry=class extends vG{constructor(t,e){super(e),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=t,this.controls.push(new jN(this),new jN(this))}static create(t,e){let i=new Ry(t,new ye(...e.position));return i.controls[0].position.set(...e.controlPrevious.position),i.controls[1].position.set(...e.controlNext.position),i.roundness=e.roundness,i.areControlsDirectionsMirrored=e.areControlsDirectionsMirrored,i}getOppositeControl(t){let e=this.controls.indexOf(t);return e===0?this.controls[1]:e===1?this.controls[0]:null}applyOffsetToControls(t,e=1){for(let i=0,r=this.controls.length;i<r;i++){let n=this.controls[i];this.position.distanceTo(n.position)<=e?n.position.copy(this.position):n.applyOffset(t)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(t){return super.copy(t),this.controls[0].copy(t.controls[0]),this.controls[1].copy(t.controls[1]),this.roundness=t.roundness,this.uuid=t.uuid,this}clone(){return new Ry(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var i,r;let t=(i=this.curveBefore)==null?void 0:i.getTangentAt(1),e=(r=this.curveAfter)==null?void 0:r.getTangentAt(0);return[t,e]}computeNormals(t=new ye,e=new ye){let[i,r]=this.computeTangents();return i&&r&&(Tq(i,t),Tq(r,e)),[t,e]}computeTangent(t=new ye){let[e,i]=this.computeTangents();return e&&i&&t.copy(e).add(i).normalize(),t}computeNormal(t=new ye){let[e,i]=this.computeNormals();return t.copy(e).add(i).normalize(),t}};function Tq(t,e=new ye){let i=t.length();return e.set(-t.y/i,t.x/i)}var yG=t=>t,ex=new ye,HD=new ye,M6e=new ye,T6e=new ye,C6e=new ye,P6e=new ye,Doe=new N,Roe=new N;function D6e(t){let e=new ye;e.addVectors(t.v0,ex.subVectors(t.v1,t.v0).multiplyScalar(2/3));let i=new ye;return i.addVectors(t.v2,HD.subVectors(t.v1,t.v2).multiplyScalar(2/3)),new Ac(t.v0,e,i,t.v2)}function kb(t,e,i=Number.EPSILON){return Math.abs(t-e)<i}function R6e(t,e,i=Number.EPSILON){return t.distanceTo(e)<i}function I6e(t,e,i=Number.EPSILON){return t.distanceTo(e)<i}function Ioe(t,e,i){let r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),n=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2));return Math.acos((n*n+r*r-s*s)/(2*n*r))}function L6e(t,e,i){return Pq(t,e)&&Pq(e,i)&&WN(t.position,e.position,i.position)}function WN(t,e,i){return ex.copy(e).sub(t).cross(HD.copy(i).sub(t))===0}function O6e(t,e,i,r,n){let s=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),a=(t.y+e.y)/2,o=(t.x+e.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.y-e.y)/s,c=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.x-t.x)/s;return r.set(o+l,a+c),n.set(o-l,a-c),[r,n]}function B6e(t,e,i){let r=t.distanceTo(i),n=e.distanceTo(i);return r<n?e:t}function F6e(t,e,i,r,n,s){let a=e.x-t.x,o=e.y-t.y,l=i.x-t.x,c=i.y-t.y,h=Math.sqrt((a+l)*(a+l)+(o+c)*(o+c)),u;return Ioe(e,t,i)>Math.PI&&(h*=-1),kb(c,o)?u=(o+c)*(r/h-.5)*8/3/(a-l):u=(a+l)*(r/h-.5)*8/3/(c-o),n.set(e.x-u*o,e.y+u*a),s.set(i.x+u*c,i.y-u*l),[n,s]}function Cq(t,e){return t.position.equals(t.controls[1].position)&&e.position.equals(e.controls[0].position)}function Pq(t,e){return WN(t.position,t.controls[1].position,e.position)&&WN(t.position,e.controls[0].position,e.position)}function k6e(t,e,i,r,n=.5){let s=ex.subVectors(e,t).multiplyScalar(n).add(t),a=HD.subVectors(i,e).multiplyScalar(n).add(e),o=M6e.subVectors(r,i).multiplyScalar(n).add(i),l=s,c=T6e.subVectors(a,s).multiplyScalar(n).add(s),h=C6e.subVectors(o,a).multiplyScalar(n).add(a),u=o,d=P6e.subVectors(h,c).multiplyScalar(n).add(c);return[t.x,t.y,l.x,l.y,c.x,c.y,d.x,d.y,h.x,h.y,u.x,u.y,r.x,r.y]}function N6e(t,e,i=12,r=!0){let n=Roe.set(0,0,0),s,a=0;for(let o=0;o<e.length;o++){let l=yG(e[o]),c=ex,h=wg(l,i);for(let u=0;u<=h;u++)if(l instanceof Ac||l instanceof vp||l instanceof Rc){if(l.getPoint(u/h,c),n.set(c.x,c.y,0),s!==void 0&&I6e(s,n))continue;s===void 0&&(s=Doe),s.copy(n),t.setXYZ(a,n.x,n.y,n.z),a++}}return r&&a>1&&!(t.getX(a-1)===t.getX(0)&&t.getY(a-1)===t.getY(0)&&t.getZ(a-1)===t.getZ(0))&&(t.setXYZ(a,t.getX(0),t.getY(0),t.getZ(0)),a++),t}function U6e(t,e,i,r=12,n=!0){let s=Roe.set(0,0,0),a=0,o=[];for(let l=0;l<e.length;l++){if(i[l]===!1)continue;let c,h=yG(e[l]),u=ex,d=wg(h,r);o.push(d);for(let f=0;f<=d;f++)if(h instanceof Ac||h instanceof vp||h instanceof Rc){if(h.getPoint(f/d,u),s.set(u.x,u.y,0),c==null?void 0:c.equals(s))continue;c===void 0?c=Doe:(t.setXYZ(a,c.x,c.y,c.z),a++,t.setXYZ(a,s.x,s.y,s.z),a++),c.copy(s)}}return n&&a>1&&!(t.getX(a-1)===t.getX(0)&&t.getY(a-1)===t.getY(0)&&t.getZ(a-1)===t.getZ(0))&&(t.setXYZ(a,t.getX(0),t.getY(0),t.getZ(0)),a++),o}function Dq(t,e=12,i=!1){let r=[];for(let n=0,s=t.length;n<s;n++){let a=t[n],o=0;if(i&&a.roundedCurveCorner!==void 0){let l=wg(a.roundedCurveCorner,e)*.5;n>0&&(r[n-1]+=l),o+=l}a.curveAfter!==void 0&&(o+=wg(a.curveAfter,e)),r.push(o)}return t.length>0&&i&&t[0].roundedCurveCorner!==void 0&&(r[t.length-1]+=wg(t[0].roundedCurveCorner,e)*.5),r}function wg(t,e=12){return t&&t instanceof CD?e*2:t&&(t instanceof Rc||t instanceof Lse)?1:t&&t instanceof I5?e*t.points.length:e}function z6e(t,e,i=12,r=!0){let n,s=0;for(let a=0;a<e.length;a++){let o=yG(e[a]),l=wg(o,i),c=ex;for(let h=0;h<=l;h++)if(o instanceof Ac||o instanceof vp||o instanceof Rc){if(o.getPoint(h/l,c),n!==void 0&&R6e(n,c,ub))continue;n===void 0&&(n=HD),n.copy(c),t.push(c.x,c.y),s++}}return kb(t[0],t[t.length-2],ub)&&kb(t[1],t[t.length-1],ub)&&(t.pop(),t.pop()),r&&s>1&&!(kb(t[s-1],t[1],ub)&&kb(t[s-2],t[0],ub))&&(t.push(t[0],t[1]),s++),t}var nO=new ye,G6e=new ye,V6e=new ye,H6e=new ye,j6e=new ye,W6e=new ye,an=class extends C2{constructor(t=100,e=100){super(),this.points=[],this.shapeHoles=[],this.plane=new ro(new N(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=Et.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=t,this._height=e}static createFromState(t,e,i){let r=new an;return r.isClosed=t.isClosed,r.points=t.points.map(n=>Ry.create(n.id,n.data)),typeof t.roundness=="number"&&(r.roundness=t.roundness),r.shapeHoles=t.shapeHoles.map(n=>an.createFromState(n)),e!==void 0&&i!==void 0&&r.applySize(e,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(t){if(this._roundness!==t){this._roundness=t;for(let e=0,i=this.points.length;e<i;e++)this.points[e].roundness=t;this.needsUpdate=!0}}getPointsIndexesByIds(t){return t.map(e=>this.getPointIndexById(e)).filter(e=>e>=0)}getPointIndexById(t){let e=this.points.length,i=this.points.findIndex(r=>r.uuid===t);if(i<0){let r=e;for(let n=0,s=this.shapeHoles.length;n<s;n++){let a=this.shapeHoles[n],o=a.points.length,l=a.getPointIndexById(t);if(l<0)r+=o;else return l+r}}return i}getLineIndexById(t){return this.getPointIndexById(t)}getBezierPoint(t){if(t<=this.points.length-1)return this.points[t];if(this.shapeHoles.length>0){let e=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=t-e;if(s<=n.points.length-1)return n.points[s];e+=n.points.length}}throw new Error("This shape does not have a point for this index: "+t)}getBezierPointIndex(t){let e=this.points.indexOf(t);if(e>=0)return e;if(e=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=n.points.indexOf(t);if(s>=0)return e+s;e+=n.points.length}return-1}getAllPoints(){let t=[].concat(...this.shapeHoles.map(e=>e.points));return[...this.points,...t]}applySize(t,e){t===0&&(t=.001),e===0&&(e=.001),this._width=t,this._height=e}applyScale(t,e){let i=nO.set(t,e);for(let r=0,n=this.points.length;r<n;r++){let s=this.points[r];s.position.multiply(i),s.controls[0].position.multiply(i),s.controls[1].position.multiply(i)}for(let r=0,n=this.shapeHoles.length;r<n;r++)this.shapeHoles[r].applyScale(t,e);this._update()}createPoint(t,e=0,i=Et.generateUUID()){let r;t instanceof ye?r=t:r=new ye(t,e);let n=new Ry(i,r);return n.roundness=this.roundness,n}addPoint(t){this.points.push(t),this.needsUpdate=!0}addPointAt(t,e){this.points.splice(e,0,t),this.needsUpdate=!0}getPointByUuid(t){for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];if(r.uuid===t)return r}for(let e=0,i=this.shapeHoles.length;e<i;e++){let r=this.shapeHoles[e].getPointByUuid(t);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(t){let e=this.points.indexOf(t);e>=0&&this.points.splice(e,1),this.needsUpdate=!0}removePointById(t){let e=this.points.find(i=>i.uuid===t);e&&this.removePoint(e)}update(){for(let t=0,e=this.shapeHoles.length;t<e;t++)this.shapeHoles[t].update();this._update()}extractShapePointsToBuffer(t,e=12,i=!1){this.subdivision=e,this.curveDivisions===void 0&&this.computeCurveDivisions(e);let r=i?this.roundedCurveDivisions:this.curveDivisions;return N6e(t,i?this.roundedCurves:this.curves,e,this.autoClose),r.reduce((n,s)=>n+s,0)+1}computeCurveDivisions(t=12){return this.curveDivisions=Dq(this.points,t,!1),this.roundedCurveDivisions=Dq(this.points,t,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(t,e,i=12){return U6e(t,this.curves,e,i,this.autoClose).reduce((r,n)=>r+n,0)*2}extractShapePointsToFlatArray(t,e=12){return this.subdivision=e,this.curveDivisions===void 0&&this.computeCurveDivisions(e),z6e(t,this.roundedCurves,e,this.autoClose)}getCurveIndexFromVertexId(t,e=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=e?this.roundedCurveDivisions:this.curveDivisions,n=0;e&&this.points[0].roundedCurveCorner!==void 0&&(n=wg(this.points[0].roundedCurveCorner,this.subdivision)*.5);let s=t-n;s<0&&(s+=r.reduce((a,o)=>a+o,0));for(let a=0,o=r.length;a<o;a++){let l=r[a];if(s<i+l)return[a,(s-i+1)/l];i+=l}return[0,1]}getCurveT(t,e,i){let r=this.points[t],n=this.points[t>=this.points.length-1?0:t+1],s=this.curveDivisions,a=s[t];if(Cq(r,n)){let l=r.position.distanceTo(n.position);return r.position.distanceTo(nO.set(i.x,i.y))/l}let o=0;for(let l=0;l<t;l++)o+=s[l];return(e-o)/a}dispose(){}_applyCurveForPoint(t,e){Cq(e,t)?this.lineTo(t.position.x,t.position.y):this.bezierCurveTo(e.controls[1].position.x,e.controls[1].position.y,t.controls[0].position.x,t.controls[0].position.y,t.position.x,t.position.y);let i=this.curves[this.curves.length-1];t.curveBefore=i,e.curveAfter=i;let r=i.clone();t.roundedCurveBefore=r,e.roundedCurveAfter=r,t.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];if(e===0)this.moveTo(r.position.x,r.position.y);else{let n=this.points[e-1];this._applyCurveForPoint(r,n)}}let t=this.getLastPoint();if(t!=null&&t.curveAfter&&(t.curveAfter=void 0),this.isClosed){let e=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(e,i)}if(this.points.length>2){let e=0;for(let i=0,r=this.points.length;i<r;i++){let n=this.points[i],s=this.points[i-1]??this.points[this.points.length-1],a=this.points[i+1]??this.points[0],o=n.roundness,l=s&&a&&L6e(s,n,a);if(!n.controlsMoved()&&o>0&&!l){let c=n.curveBefore,h=n.curveAfter;if(c===void 0||h===void 0)continue;let u=n.roundedCurveBefore,d=n.roundedCurveAfter,f=c.getLength(),p=h.getLength(),m=Math.min(o,f*.499),g=Math.min(o,p*.499),v=Math.min(m,g),y=1-v/f,x=v/p,S=c.getPointAt(y,nO),A=h.getPointAt(x,G6e);this._subSplitCurve(c,u,y,S,void 0),this._subSplitCurve(h,d,x,void 0,A);let _;if(this.useCubicForRoundedCorners){let M=Ioe(S,n.position,A)/2,E=Math.tan(M)*S.distanceTo(n.position),[T,C]=O6e(S,A,E,V6e,H6e),D=B6e(T,C,n.position),[B,O]=F6e(D,S,A,E,j6e,W6e);_=new Ac(S.clone(),B.clone(),O.clone(),A.clone())}else _=new vp(S.clone(),n.position.clone(),A.clone());n.roundedCurveCorner=_,this.roundedCurves.splice(i+e,0,_),e++}}}}_subSplitCurve(t,e,i,r,n){if(t instanceof Rc)r!==void 0&&e.v2.copy(r),n!==void 0&&e.v1.copy(n);else{let s=t,a=e,o=s.getUtoTmapping(i,0),l=k6e(s.v0,s.v1,s.v2,s.v3,o);return r!==void 0&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),n!==void 0&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return e}clone(){let t=new an(this._width,this._height);return t.points=this.points.map(e=>e.clone()),t.isClosed=this.isClosed,t.roundness=this.roundness,t.isMesh2D=this.isMesh2D,t.shapeHoles=this.shapeHoles.map(e=>e.clone()),t}toJSON(){return{points:this.points.reduce((t,e)=>t.concat(e.toJSON()),[]),shapeHoles:this.shapeHoles.map(t=>t.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(t){var i;this.points=[],this.pointIDs=0;let e=t.points.length/7;for(let r=0;r<e;r++){let n=r*7,s=t.points[n+0],a=t.points[n+1],o=t.points[n+2],l=t.points[n+3],c=t.points[n+4],h=t.points[n+5],u=t.points[n+6],d=new Ry(Et.generateUUID(),new ye(s,a));d.controls[0].position.set(o,l),d.controls[1].position.set(c,h),d.roundness=u,this.points.push(d)}return this.shapeHoles=(i=t.shapeHoles)!=null&&i.length?t.shapeHoles.map(r=>{let n=new an;return n.fromJSON(r),n}):[],this.isClosed=t.isClosed,this._roundness=t.roundness,this._update(),this}fromShape(t,e=!1){this.isText=e;let i=(n,s)=>{s instanceof Ac&&s.v3.equals(n.position)&&n.controls[0].position.copy(s.v2)},r=n=>{let s=[],a,o;for(a=0,o=n.length;a<o;a++)n[a]instanceof vp&&(n[a]=D6e(n[a]));for(a=0,o=n.length;a<o;a++){let h=n[a],u=a>0?n[a-1]:null,d;h instanceof Ac?(d=this.createPoint(h.v0),d.controls[1].position.copy(h.v1)):h instanceof Rc&&(d=this.createPoint(h.v1)),d!==void 0&&(u!==null&&i(d,u),s.push(d))}let l=n[n.length-1],c=!1;return l instanceof Ac?l.v3.equals(s[0].position)&&(s[0].controls[0].position.copy(l.v2),c=!0):l instanceof Rc&&l.v2.equals(s[0].position)&&(c=!0),this.isClosed=c,s};return this.points=r(t.curves),t instanceof C2&&(this.shapeHoles=t.holes.map(n=>{let s=new an;return s.fromShape(n),s})),this.update(),this}updatePoint(t,e){let i=this.getPointByUuid(t);i&&(e.position!==void 0&&i.position.fromArray(e.position),e.roundness!==void 0&&(i.roundness=e.roundness),e.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=e.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(t,e){var r;let i=(r=this.getPointByUuid(t))==null?void 0:r.controls[0];i&&(e.position&&i.position.fromArray(e.position),this.needsUpdate=!0)}updateNextControl(t,e){var r;let i=(r=this.getPointByUuid(t))==null?void 0:r.controls[1];i&&(e.position&&i.position.fromArray(e.position),this.needsUpdate=!0)}},XN=Math.PI*2;function sO({x:t,y:e},i,r,n,s){return{x:t*i+n,y:e*r+s}}function X6e(t,e){let i=e===1.5707963267948966?.551915024494:e===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(e/4),r=Math.cos(t),n=Math.sin(t),s=Math.cos(t+e),a=Math.sin(t+e);return[{x:r-n*i,y:n+r*i},{x:s+a*i,y:a-s*i},{x:s,y:a}]}function Rq(t,e,i,r){let n=t*r-e*i<0?-1:1,s=Math.min(1,Math.max(-1,t*i+e*r));return n*Math.acos(s)}function Y6e(t,e,i,r,n,s,a,o,l,c){let h=Math.pow(n,2),u=Math.pow(s,2),d=Math.pow(a,2),f=Math.pow(o,2),p=h*u-h*f-u*d;p<0&&(p=0),p/=h*f+u*d,p=Math.sqrt(p)*(l===c?-1:1);let m=p*n/s*o,g=p*-s/n*a,v=m+(t+i)/2,y=g+(e+r)/2,x=(a-m)/n,S=(o-g)/s,A=(-a-m)/n,_=(-o-g)/s,M=Rq(1,0,x,S),E=Rq(x,S,A,_);return!c&&E>0&&(E-=XN),c&&E<0&&(E+=XN),{centerx:v,centery:y,ang1:M,ang2:E}}function q6e({px:t,py:e,cx:i,cy:r,rx:n,ry:s,largeArcFlag:a,sweepFlag:o}){let l=[];if(n===0||s===0)return[];let c=(t-i)/2,h=(e-r)/2;if(c===0&&h===0)return[];n=Math.abs(n),s=Math.abs(s);let u=Math.pow(c,2)/Math.pow(n,2)+Math.pow(h,2)/Math.pow(s,2);u>1&&(n*=Math.sqrt(u),s*=Math.sqrt(u));let d=Y6e(t,e,i,r,n,s,c,h,a,o),{ang1:f,ang2:p}=d,{centerx:m,centery:g}=d,v=Math.abs(p)/(XN/4);Math.abs(1-v)<1e-7&&(v=1);let y=Math.max(Math.ceil(v),1);p/=y;for(let x=0;x<y;x++)l.push(X6e(f,p)),f+=p;return l.map(x=>{let{x:S,y:A}=sO(x[0],n,s,m,g),{x:_,y:M}=sO(x[1],n,s,m,g),{x:E,y:T}=sO(x[2],n,s,m,g);return{x1:S,y1:A,x2:_,y2:M,x:E,y:T}})}var nr;(function(t){t[t.ODD=0]="ODD",t[t.NONZERO=1]="NONZERO",t[t.POSITIVE=2]="POSITIVE",t[t.NEGATIVE=3]="NEGATIVE",t[t.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(nr||(nr={}));var On;(function(t){t[t.POLYGONS=0]="POLYGONS",t[t.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",t[t.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(On||(On={}));function ti(t,e){if(!t)throw e||"Assertion Failed!"}var jt=function(){function t(){}return t.vertEq=function(e,i){return e.s===i.s&&e.t===i.t},t.vertLeq=function(e,i){return e.s<i.s||e.s===i.s&&e.t<=i.t},t.transLeq=function(e,i){return e.t<i.t||e.t===i.t&&e.s<=i.s},t.edgeGoesLeft=function(e){return t.vertLeq(e.Dst,e.Org)},t.edgeGoesRight=function(e){return t.vertLeq(e.Org,e.Dst)},t.vertL1dist=function(e,i){return Math.abs(e.s-i.s)+Math.abs(e.t-i.t)},t.edgeEval=function(e,i,r){ti(t.vertLeq(e,i)&&t.vertLeq(i,r));var n=i.s-e.s,s=r.s-i.s;return n+s>0?n<s?i.t-e.t+(e.t-r.t)*(n/(n+s)):i.t-r.t+(r.t-e.t)*(s/(n+s)):0},t.edgeSign=function(e,i,r){ti(t.vertLeq(e,i)&&t.vertLeq(i,r));var n=i.s-e.s,s=r.s-i.s;return n+s>0?(i.t-r.t)*n+(i.t-e.t)*s:0},t.transEval=function(e,i,r){ti(t.transLeq(e,i)&&t.transLeq(i,r));var n=i.t-e.t,s=r.t-i.t;return n+s>0?n<s?i.s-e.s+(e.s-r.s)*(n/(n+s)):i.s-r.s+(r.s-e.s)*(s/(n+s)):0},t.transSign=function(e,i,r){ti(t.transLeq(e,i)&&t.transLeq(i,r));var n=i.t-e.t,s=r.t-i.t;return n+s>0?(i.s-r.s)*n+(i.s-e.s)*s:0},t.vertCCW=function(e,i,r){return e.s*(i.t-r.t)+i.s*(r.t-e.t)+r.s*(e.t-i.t)>=0},t.interpolate=function(e,i,r,n){return e=e<0?0:e,r=r<0?0:r,e<=r?r===0?(i+n)/2:i+(n-i)*(e/(e+r)):n+(i-n)*(r/(e+r))},t.intersect=function(e,i,r,n,s){var a,o,l;t.vertLeq(e,i)||(l=e,e=i,i=l),t.vertLeq(r,n)||(l=r,r=n,n=l),t.vertLeq(e,r)||(l=e,e=r,r=l,l=i,i=n,n=l),t.vertLeq(r,i)?t.vertLeq(i,n)?(a=t.edgeEval(e,r,i),o=t.edgeEval(r,i,n),a+o<0&&(a=-a,o=-o),s.s=t.interpolate(a,r.s,o,i.s)):(a=t.edgeSign(e,r,i),o=-t.edgeSign(e,n,i),a+o<0&&(a=-a,o=-o),s.s=t.interpolate(a,r.s,o,n.s)):s.s=(r.s+i.s)/2,t.transLeq(e,i)||(l=e,e=i,i=l),t.transLeq(r,n)||(l=r,r=n,n=l),t.transLeq(e,r)||(l=e,e=r,r=l,l=i,i=n,n=l),t.transLeq(r,i)?t.transLeq(i,n)?(a=t.transEval(e,r,i),o=t.transEval(r,i,n),a+o<0&&(a=-a,o=-o),s.t=t.interpolate(a,r.t,o,i.t)):(a=t.transSign(e,r,i),o=-t.transSign(e,n,i),a+o<0&&(a=-a,o=-o),s.t=t.interpolate(a,r.t,o,n.t)):s.t=(r.t+i.t)/2},t}(),db=function(){function t(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return t}(),qM=function(){function t(e){this.side=e,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(t.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(e){this.Sym.Lface=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(e){this.Sym.Org=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(e){this.Sym.Lnext=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(e){this.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(e){this.Lnext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(e){this.Sym.Onext=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(e){this.Sym.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(e){this.Sym.Lnext.Sym=e},enumerable:!0,configurable:!0}),t}(),Ov=function(){function t(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return t}(),Iq=function(){function t(){var e=new Ov,i=new db,r=new qM(0),n=new qM(1);e.next=e.prev=e,e.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=n,n.next=n,n.Sym=r,this.vHead=e,this.fHead=i,this.eHead=r,this.eHeadSym=n}return t.prototype.makeEdge_=function(e){var i=new qM(0),r=new qM(1);e.Sym.side<e.side&&(e=e.Sym);var n=e.Sym.next;return r.next=n,n.Sym.next=i,i.next=e,e.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},t.prototype.splice_=function(e,i){var r=e.Onext,n=i.Onext;r.Sym.Lnext=i,n.Sym.Lnext=e,e.Onext=n,i.Onext=r},t.prototype.makeVertex_=function(e,i,r){var n=e;ti(n,"Vertex can't be null!");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i;var a=i;do a.Org=n,a=a.Onext;while(a!==i)},t.prototype.makeFace_=function(e,i,r){var n=e;ti(n,"Face can't be null");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i,n.trail=null,n.marked=!1,n.inside=r.inside;var a=i;do a.Lface=n,a=a.Lnext;while(a!==i)},t.prototype.killEdge_=function(e){e.Sym.side<e.side&&(e=e.Sym);var i=e.next,r=e.Sym.next;i.Sym.next=r,r.Sym.next=i},t.prototype.killVertex_=function(e,i){var r=e.anEdge,n=r;do n.Org=i,n=n.Onext;while(n!==r);var s=e.prev,a=e.next;a.prev=s,s.next=a},t.prototype.killFace_=function(e,i){var r=e.anEdge,n=r;do n.Lface=i,n=n.Lnext;while(n!==r);var s=e.prev,a=e.next;a.prev=s,s.next=a},t.prototype.makeEdge=function(){var e=new Ov,i=new Ov,r=new db,n=this.makeEdge_(this.eHead);return this.makeVertex_(e,n,this.vHead),this.makeVertex_(i,n.Sym,this.vHead),this.makeFace_(r,n,this.fHead),n},t.prototype.splice=function(e,i){var r=!1,n=!1;if(e!==i){if(i.Org!==e.Org&&(n=!0,this.killVertex_(i.Org,e.Org)),i.Lface!==e.Lface&&(r=!0,this.killFace_(i.Lface,e.Lface)),this.splice_(i,e),!n){var s=new Ov;this.makeVertex_(s,i,e.Org),e.Org.anEdge=e}if(!r){var a=new db;this.makeFace_(a,i,e.Lface),e.Lface.anEdge=e}}},t.prototype.delete=function(e){var i=e.Sym,r=!1;if(e.Lface!==e.Rface&&(r=!0,this.killFace_(e.Lface,e.Rface)),e.Onext===e)this.killVertex_(e.Org,null);else if(e.Rface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev),!r){var n=new db;this.makeFace_(n,e,e.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(e.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(e)},t.prototype.addEdgeVertex=function(e){var i=this.makeEdge_(e),r=i.Sym;this.splice_(i,e.Lnext),i.Org=e.Dst;var n=new Ov;return this.makeVertex_(n,r,i.Org),i.Lface=r.Lface=e.Lface,i},t.prototype.splitEdge=function(e){var i=this.addEdgeVertex(e),r=i.Sym;return this.splice_(e.Sym,e.Sym.Oprev),this.splice_(e.Sym,r),e.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=e.Rface,r.winding=e.winding,r.Sym.winding=e.Sym.winding,r.idx=e.idx,r.Sym.idx=e.Sym.idx,r},t.prototype.connect=function(e,i){var r=!1,n=this.makeEdge_(e),s=n.Sym;if(i.Lface!==e.Lface&&(r=!0,this.killFace_(i.Lface,e.Lface)),this.splice_(n,e.Lnext),this.splice_(s,i),n.Org=e.Dst,s.Org=i.Org,n.Lface=s.Lface=e.Lface,e.Lface.anEdge=s,!r){var a=new db;this.makeFace_(a,n,e.Lface)}return n},t.prototype.zapFace=function(e){var i=e.anEdge,r,n,s,a,o;n=i.Lnext;do r=n,n=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),s=r.Sym,s.Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(r));while(r!=i);a=e.prev,o=e.next,o.prev=a,a.next=o},t.prototype.countFaceVerts_=function(e){var i=e.anEdge,r=0;do r++,i=i.Lnext;while(i!==e.anEdge);return r},t.prototype.mergeConvexFaces=function(e){var i,r,n,s,a,o,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,a=r.Org;n=r.Lnext,s=r.Sym,s&&s.Lface&&s.Lface.inside&&(o=this.countFaceVerts_(i),l=this.countFaceVerts_(s.Lface),o+l-2<=e&&jt.vertCCW(r.Lprev.Org,r.Org,s.Lnext.Lnext.Org)&&jt.vertCCW(s.Lprev.Org,s.Org,r.Lnext.Lnext.Org)&&(n=s.Lnext,this.delete(s),r=null,s=null)),!(r&&r.Lnext.Org===a);)r=n;return!0},t.prototype.check=function(){var e=this.fHead,i=this.vHead,r=this.eHead,n,s,a,o,l,c;for(s=e,s=e;(n=s.next)!==e;s=n){ti(n.prev===s),l=n.anEdge;do ti(l.Sym!==l),ti(l.Sym.Sym===l),ti(l.Lnext.Onext.Sym===l),ti(l.Onext.Sym.Lnext===l),ti(l.Lface===n),l=l.Lnext;while(l!==n.anEdge)}for(ti(n.prev===s&&n.anEdge===null),o=i,o=i;(a=o.next)!==i;o=a){ti(a.prev===o),l=a.anEdge;do ti(l.Sym!==l),ti(l.Sym.Sym===l),ti(l.Lnext.Onext.Sym===l),ti(l.Onext.Sym.Lnext===l),ti(l.Org===a),l=l.Onext;while(l!==a.anEdge)}for(ti(a.prev===o&&a.anEdge===null),c=r,c=r;(l=c.next)!==r;c=l)ti(l.Sym.next===c.Sym),ti(l.Sym!==l),ti(l.Sym.Sym===l),ti(l.Org!==null),ti(l.Dst!==null),ti(l.Lnext.Onext.Sym===l),ti(l.Onext.Sym.Lnext===l);ti(l.Sym.next===c.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},t}(),Lq=function(){function t(){this.handle=null}return t}(),Oq=function(){function t(){this.key=null,this.node=0}return t}(),K6e=function(){function t(e,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=e,this.nodes=[],this.handles=[];for(var r=0;r<e+1;r++)this.nodes[r]=new Lq,this.handles[r]=new Oq;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return t.prototype.floatDown_=function(e){var i=this.nodes,r=this.handles,n,s,a;for(n=i[e].handle;;){if(a=e<<1,a<this.size&&this.leq(r[i[a+1].handle].key,r[i[a].handle].key)&&++a,ti(a<=this.max),s=i[a].handle,a>this.size||this.leq(r[n].key,r[s].key)){i[e].handle=n,r[n].node=e;break}i[e].handle=s,r[s].node=e,e=a}},t.prototype.floatUp_=function(e){var i=this.nodes,r=this.handles,n,s,a;for(n=i[e].handle;;){if(a=e>>1,s=i[a].handle,a===0||this.leq(r[s].key,r[n].key)){i[e].handle=n,r[n].node=e;break}i[e].handle=s,r[s].node=e,e=a}},t.prototype.init=function(){for(var e=this.size;e>=1;--e)this.floatDown_(e);this.initialized=!0},t.prototype.min=function(){return this.handles[this.nodes[1].handle].key},t.prototype.insert=function(e){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var n,s;for(s=this.nodes.length,this.nodes.length=this.max+1,n=s;n<this.nodes.length;n++)this.nodes[n]=new Lq;for(s=this.handles.length,this.handles.length=this.max+1,n=s;n<this.handles.length;n++)this.handles[n]=new Oq}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=e,this.initialized&&this.floatUp_(i),r},t.prototype.extractMin=function(){var e=this.nodes,i=this.handles,r=e[1].handle,n=i[r].key;return this.size>0&&(e[1].handle=e[this.size].handle,i[e[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),n},t.prototype.delete=function(e){var i=this.nodes,r=this.handles,n;ti(e>=1&&e<=this.max&&r[e].key!==null),n=r[e].node,i[n].handle=i[this.size].handle,r[i[n].handle].node=n,--this.size,n<=this.size&&(n<=1||this.leq(r[i[n>>1].handle].key,r[i[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),r[e].key=null,r[e].node=this.freeList,this.freeList=e},t}(),aO=function(){function t(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return t}(),Bq=function(){function t(){this.key=null,this.next=null,this.prev=null}return t}(),Q6e=function(){function t(e,i){this.frame=e,this.leq=i,this.head=new Bq,this.head.next=this.head,this.head.prev=this.head}return t.prototype.min=function(){return this.head.next},t.prototype.max=function(){return this.head.prev},t.prototype.insert=function(e){return this.insertBefore(this.head,e)},t.prototype.search=function(e){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,e,i.key));return i},t.prototype.insertBefore=function(e,i){do e=e.prev;while(e.key!==null&&!this.leq(this.frame,e.key,i));var r=new Bq;return r.key=i,r.next=e.next,e.next.prev=r,r.prev=e,e.next=r,r},t.prototype.delete=function(e){e.next.prev=e.prev,e.prev.next=e.next},t}(),$6e=function(){function t(){}return t.regionBelow=function(e){return e.nodeUp.prev.key},t.regionAbove=function(e){return e.nodeUp.next.key},t.debugEvent=function(e){},t.addWinding=function(e,i){e.winding+=i.winding,e.Sym.winding+=i.Sym.winding},t.edgeLeq=function(e,i,r){var n=e.event,s=i.eUp,a=r.eUp;if(s.Dst===n)return a.Dst===n?jt.vertLeq(s.Org,a.Org)?jt.edgeSign(a.Dst,s.Org,a.Org)<=0:jt.edgeSign(s.Dst,a.Org,s.Org)>=0:jt.edgeSign(a.Dst,n,a.Org)<=0;if(a.Dst===n)return jt.edgeSign(s.Dst,n,s.Org)>=0;var o=jt.edgeEval(s.Dst,n,s.Org),l=jt.edgeEval(a.Dst,n,a.Org);return o>=l},t.deleteRegion=function(e,i){i.fixUpperEdge&&ti(i.eUp.winding===0),i.eUp.activeRegion=null,e.dict.delete(i.nodeUp)},t.fixUpperEdge=function(e,i,r){ti(i.fixUpperEdge),e.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},t.topLeftRegion=function(e,i){var r=i.eUp.Org,n;do i=t.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(n=e.mesh.connect(t.regionBelow(i).eUp.Sym,i.eUp.Lnext),n===null)return null;t.fixUpperEdge(e,i,n),i=t.regionAbove(i)}return i},t.topRightRegion=function(e){var i=e.eUp.Dst;do e=t.regionAbove(e);while(e.eUp.Dst===i);return e},t.addRegionBelow=function(e,i,r){var n=new aO;return n.eUp=r,n.nodeUp=e.dict.insertBefore(i.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,r.activeRegion=n,n},t.isWindingInside=function(e,i){switch(e.windingRule){case nr.ODD:return(i&1)!==0;case nr.NONZERO:return i!==0;case nr.POSITIVE:return i>0;case nr.NEGATIVE:return i<0;case nr.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},t.computeWinding=function(e,i){i.windingNumber=t.regionAbove(i).windingNumber+i.eUp.winding,i.inside=t.isWindingInside(e,i.windingNumber)},t.finishRegion=function(e,i){var r=i.eUp,n=r.Lface;n.inside=i.inside,n.anEdge=r,t.deleteRegion(e,i)},t.finishLeftRegions=function(e,i,r){for(var n,s=null,a=i,o=i.eUp;a!==r;){if(a.fixUpperEdge=!1,s=t.regionBelow(a),n=s.eUp,n.Org!=o.Org){if(!s.fixUpperEdge){t.finishRegion(e,a);break}n=e.mesh.connect(o.Lprev,n.Sym),t.fixUpperEdge(e,s,n)}o.Onext!==n&&(e.mesh.splice(n.Oprev,n),e.mesh.splice(o,n)),t.finishRegion(e,a),o=s.eUp,a=s}return o},t.addRightEdges=function(e,i,r,n,s,a){var o,l,c,h,u=!0;c=r;do ti(jt.vertLeq(c.Org,c.Dst)),t.addRegionBelow(e,i,c.Sym),c=c.Onext;while(c!==n);for(s===null&&(s=t.regionBelow(i).eUp.Rprev),l=i,h=s;o=t.regionBelow(l),c=o.eUp.Sym,c.Org===h.Org;)c.Onext!==h&&(e.mesh.splice(c.Oprev,c),e.mesh.splice(h.Oprev,c)),o.windingNumber=l.windingNumber-c.winding,o.inside=t.isWindingInside(e,o.windingNumber),l.dirty=!0,!u&&t.checkForRightSplice(e,l)&&(t.addWinding(c,h),t.deleteRegion(e,l),e.mesh.delete(h)),u=!1,l=o,h=c;l.dirty=!0,ti(l.windingNumber-c.winding===o.windingNumber),a&&t.walkDirtyRegions(e,l)},t.spliceMergeVertices=function(e,i,r){e.mesh.splice(i,r)},t.vertexWeights=function(e,i,r){var n=jt.vertL1dist(i,e),s=jt.vertL1dist(r,e),a=.5*s/(n+s),o=.5*n/(n+s);e.coords[0]+=a*i.coords[0]+o*r.coords[0],e.coords[1]+=a*i.coords[1]+o*r.coords[1],e.coords[2]+=a*i.coords[2]+o*r.coords[2]},t.getIntersectData=function(e,i,r,n,s,a){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,t.vertexWeights(i,r,n),t.vertexWeights(i,s,a)},t.checkForRightSplice=function(e,i){var r=t.regionBelow(i),n=i.eUp,s=r.eUp;if(jt.vertLeq(n.Org,s.Org)){if(jt.edgeSign(s.Dst,n.Org,s.Org)>0)return!1;jt.vertEq(n.Org,s.Org)?n.Org!==s.Org&&(e.pq.delete(n.Org.pqHandle),t.spliceMergeVertices(e,s.Oprev,n)):(e.mesh.splitEdge(s.Sym),e.mesh.splice(n,s.Oprev),i.dirty=r.dirty=!0)}else{if(jt.edgeSign(n.Dst,s.Org,n.Org)<0)return!1;t.regionAbove(i).dirty=i.dirty=!0,e.mesh.splitEdge(n.Sym),e.mesh.splice(s.Oprev,n)}return!0},t.checkForLeftSplice=function(e,i){var r=t.regionBelow(i),n=i.eUp,s=r.eUp,a;if(ti(!jt.vertEq(n.Dst,s.Dst)),jt.vertLeq(n.Dst,s.Dst)){if(jt.edgeSign(n.Dst,s.Dst,n.Org)<0)return!1;t.regionAbove(i).dirty=i.dirty=!0,a=e.mesh.splitEdge(n),e.mesh.splice(s.Sym,a),a.Lface.inside=i.inside}else{if(jt.edgeSign(s.Dst,n.Dst,s.Org)>0)return!1;i.dirty=r.dirty=!0,a=e.mesh.splitEdge(s),e.mesh.splice(n.Lnext,s.Sym),a.Rface.inside=i.inside}return!0},t.checkForIntersect=function(e,i){var r=t.regionBelow(i),n=i.eUp,s=r.eUp,a=n.Org,o=s.Org,l=n.Dst,c=s.Dst,h,u,d=new Ov,f,p;if(ti(!jt.vertEq(c,l)),ti(jt.edgeSign(l,e.event,a)<=0),ti(jt.edgeSign(c,e.event,o)>=0),ti(a!==e.event&&o!==e.event),ti(!i.fixUpperEdge&&!r.fixUpperEdge),a===o||(h=Math.min(a.t,l.t),u=Math.max(o.t,c.t),h>u))return!1;if(jt.vertLeq(a,o)){if(jt.edgeSign(c,a,o)>0)return!1}else if(jt.edgeSign(l,o,a)<0)return!1;return t.debugEvent(e),jt.intersect(l,a,c,o,d),ti(Math.min(a.t,l.t)<=d.t),ti(d.t<=Math.max(o.t,c.t)),ti(Math.min(c.s,l.s)<=d.s),ti(d.s<=Math.max(o.s,a.s)),jt.vertLeq(d,e.event)&&(d.s=e.event.s,d.t=e.event.t),f=jt.vertLeq(a,o)?a:o,jt.vertLeq(f,d)&&(d.s=f.s,d.t=f.t),jt.vertEq(d,a)||jt.vertEq(d,o)?(t.checkForRightSplice(e,i),!1):!jt.vertEq(l,e.event)&&jt.edgeSign(l,e.event,d)>=0||!jt.vertEq(c,e.event)&&jt.edgeSign(c,e.event,d)<=0?c===e.event?(e.mesh.splitEdge(n.Sym),e.mesh.splice(s.Sym,n),i=t.topLeftRegion(e,i),n=t.regionBelow(i).eUp,t.finishLeftRegions(e,t.regionBelow(i),r),t.addRightEdges(e,i,n.Oprev,n,n,!0),!0):l===e.event?(e.mesh.splitEdge(s.Sym),e.mesh.splice(n.Lnext,s.Oprev),r=i,i=t.topRightRegion(i),p=t.regionBelow(i).eUp.Rprev,r.eUp=s.Oprev,s=t.finishLeftRegions(e,r,null),t.addRightEdges(e,i,s.Onext,n.Rprev,p,!0),!0):(jt.edgeSign(l,e.event,d)>=0&&(t.regionAbove(i).dirty=i.dirty=!0,e.mesh.splitEdge(n.Sym),n.Org.s=e.event.s,n.Org.t=e.event.t),jt.edgeSign(c,e.event,d)<=0&&(i.dirty=r.dirty=!0,e.mesh.splitEdge(s.Sym),s.Org.s=e.event.s,s.Org.t=e.event.t),!1):(e.mesh.splitEdge(n.Sym),e.mesh.splitEdge(s.Sym),e.mesh.splice(s.Oprev,n),n.Org.s=d.s,n.Org.t=d.t,n.Org.pqHandle=e.pq.insert(n.Org),t.getIntersectData(e,n.Org,a,l,o,c),t.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},t.walkDirtyRegions=function(e,i){for(var r=t.regionBelow(i),n,s;;){for(;r.dirty;)i=r,r=t.regionBelow(r);if(!i.dirty&&(r=i,i=t.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,n=i.eUp,s=r.eUp,n.Dst!==s.Dst&&t.checkForLeftSplice(e,i)&&(r.fixUpperEdge?(t.deleteRegion(e,r),e.mesh.delete(s),r=t.regionBelow(i),s=r.eUp):i.fixUpperEdge&&(t.deleteRegion(e,i),e.mesh.delete(n),i=t.regionAbove(r),n=i.eUp)),n.Org!==s.Org)if(n.Dst!==s.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(n.Dst===e.event||s.Dst===e.event)){if(t.checkForIntersect(e,i))return}else t.checkForRightSplice(e,i);n.Org===s.Org&&n.Dst===s.Dst&&(t.addWinding(s,n),t.deleteRegion(e,i),e.mesh.delete(n),i=t.regionAbove(r))}},t.connectRightVertex=function(e,i,r){var n,s=r.Onext,a=t.regionBelow(i),o=i.eUp,l=a.eUp,c=!1;if(o.Dst!==l.Dst&&t.checkForIntersect(e,i),jt.vertEq(o.Org,e.event)&&(e.mesh.splice(s.Oprev,o),i=t.topLeftRegion(e,i),s=t.regionBelow(i).eUp,t.finishLeftRegions(e,t.regionBelow(i),a),c=!0),jt.vertEq(l.Org,e.event)&&(e.mesh.splice(r,l.Oprev),r=t.finishLeftRegions(e,a,null),c=!0),c){t.addRightEdges(e,i,r.Onext,s,s,!0);return}jt.vertLeq(l.Org,o.Org)?n=l.Oprev:n=o,n=e.mesh.connect(r.Lprev,n),t.addRightEdges(e,i,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,t.walkDirtyRegions(e,i)},t.connectLeftDegenerate=function(e,i,r){var n,s,a,o,l;if(n=i.eUp,jt.vertEq(n.Org,r)){ti(!1),t.spliceMergeVertices(e,n,r.anEdge);return}if(!jt.vertEq(n.Dst,r)){e.mesh.splitEdge(n.Sym),i.fixUpperEdge&&(e.mesh.delete(n.Onext),i.fixUpperEdge=!1),e.mesh.splice(r.anEdge,n),t.sweepEvent(e,r);return}ti(!1),i=t.topRightRegion(i),l=t.regionBelow(i),a=l.eUp.Sym,s=o=a.Onext,l.fixUpperEdge&&(ti(s!==a),t.deleteRegion(e,l),e.mesh.delete(a),a=s.Oprev),e.mesh.splice(r.anEdge,a),jt.edgeGoesLeft(s)||(s=null),t.addRightEdges(e,i,a.Onext,o,s,!0)},t.connectLeftVertex=function(e,i){var r,n,s,a,o,l,c=new aO;if(c.eUp=i.anEdge.Sym,r=e.dict.search(c).key,n=t.regionBelow(r),!!n){if(a=r.eUp,o=n.eUp,jt.edgeSign(a.Dst,i,a.Org)===0){t.connectLeftDegenerate(e,r,i);return}if(s=jt.vertLeq(o.Dst,a.Dst)?r:n,r.inside||s.fixUpperEdge){if(s===r)l=e.mesh.connect(i.anEdge.Sym,a.Lnext);else{var h=e.mesh.connect(o.Dnext,i.anEdge);l=h.Sym}s.fixUpperEdge?t.fixUpperEdge(e,s,l):t.computeWinding(e,t.addRegionBelow(e,r,l)),t.sweepEvent(e,i)}else t.addRightEdges(e,r,i.anEdge,i.anEdge,null,!0)}},t.sweepEvent=function(e,i){e.event=i,t.debugEvent(e);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){t.connectLeftVertex(e,i);return}var n=t.topLeftRegion(e,r.activeRegion);ti(n!==null);var s=t.regionBelow(n),a=s.eUp,o=t.finishLeftRegions(e,s,null);o.Onext===a?t.connectRightVertex(e,n,o):t.addRightEdges(e,n,o.Onext,a,a,!0)},t.addSentinel=function(e,i,r,n){var s=new aO,a=e.mesh.makeEdge();a.Org.s=r,a.Org.t=n,a.Dst.s=i,a.Dst.t=n,e.event=a.Dst,s.eUp=a,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=e.dict.insert(s)},t.initEdgeDict=function(e){e.dict=new Q6e(e,t.edgeLeq);var i=e.bmax[0]-e.bmin[0],r=e.bmax[1]-e.bmin[1],n=e.bmin[0]-i,s=e.bmax[0]+i,a=e.bmin[1]-r,o=e.bmax[1]+r;t.addSentinel(e,n,s,a),t.addSentinel(e,n,s,o)},t.doneEdgeDict=function(e){for(var i,r=0;(i=e.dict.min().key)!==null;)i.sentinel||(ti(i.fixUpperEdge),ti(++r===1)),ti(i.windingNumber===0),t.deleteRegion(e,i)},t.removeDegenerateEdges=function(e){var i,r,n,s=e.mesh.eHead;for(i=s.next;i!==s;i=r)r=i.next,n=i.Lnext,jt.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(t.spliceMergeVertices(e,n,i),e.mesh.delete(i),i=n,n=i.Lnext),n.Lnext===i&&(n!==i&&((n===r||n===r.Sym)&&(r=r.next),e.mesh.delete(n)),(i===r||i===r.Sym)&&(r=r.next),e.mesh.delete(i))},t.initPriorityQ=function(e){var i,r,n,s=0;for(n=e.mesh.vHead,r=n.next;r!==n;r=r.next)s++;for(s+=8,i=e.pq=new K6e(s,jt.vertLeq),n=e.mesh.vHead,r=n.next;r!==n;r=r.next)r.pqHandle=i.insert(r);return r!==n?!1:(i.init(),!0)},t.donePriorityQ=function(e){e.pq=null},t.removeDegenerateFaces=function(e,i){var r,n,s;for(r=i.fHead.next;r!==i.fHead;r=n)n=r.next,s=r.anEdge,ti(s.Lnext!==s),s.Lnext.Lnext===s&&(t.addWinding(s.Onext,s),e.mesh.delete(s));return!0},t.computeInterior=function(e,i){i===void 0&&(i=!0);var r,n;if(t.removeDegenerateEdges(e),!t.initPriorityQ(e))return!1;for(t.initEdgeDict(e);(r=e.pq.extractMin())!==null;){for(;n=e.pq.min(),!(n===null||!jt.vertEq(n,r));)n=e.pq.extractMin(),t.spliceMergeVertices(e,r.anEdge,n.anEdge);t.sweepEvent(e,r)}return e.event=e.dict.min().key.eUp.Org,t.debugEvent(e),t.doneEdgeDict(e),t.donePriorityQ(e),t.removeDegenerateFaces(e,e.mesh)?(i&&e.mesh.check(),!0):!1},t}(),J6e=function(){function t(){this.mesh=new Iq,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=nr.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return t.prototype.dot_=function(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]},t.prototype.normalize_=function(e){var i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),e[0]/=i,e[1]/=i,e[2]/=i},t.prototype.longAxis_=function(e){var i=0;return Math.abs(e[1])>Math.abs(e[0])&&(i=1),Math.abs(e[2])>Math.abs(e[i])&&(i=2),i},t.prototype.computeNormal_=function(e){var i,r,n,s,a,o,l=[0,0,0],c=[0,0,0],h=[0,0,0],u=[0,0,0],d=[0,0,0],f=[null,null,null],p=[null,null,null],m=this.mesh.vHead;i=m.next;for(var g=0;g<3;++g)s=i.coords[g],c[g]=s,p[g]=i,l[g]=s,f[g]=i;for(i=m.next;i!==m;i=i.next)for(var v=0;v<3;++v)s=i.coords[v],s<c[v]&&(c[v]=s,p[v]=i),s>l[v]&&(l[v]=s,f[v]=i);var y=0;if(l[1]-c[1]>l[0]-c[0]&&(y=1),l[2]-c[2]>l[y]-c[y]&&(y=2),c[y]>=l[y]){e[0]=0,e[1]=0,e[2]=1;return}for(o=0,r=p[y],n=f[y],h[0]=r.coords[0]-n.coords[0],h[1]=r.coords[1]-n.coords[1],h[2]=r.coords[2]-n.coords[2],i=m.next;i!==m;i=i.next)u[0]=i.coords[0]-n.coords[0],u[1]=i.coords[1]-n.coords[1],u[2]=i.coords[2]-n.coords[2],d[0]=h[1]*u[2]-h[2]*u[1],d[1]=h[2]*u[0]-h[0]*u[2],d[2]=h[0]*u[1]-h[1]*u[0],a=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],a>o&&(o=a,e[0]=d[0],e[1]=d[1],e[2]=d[2]);o<=0&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(h)]=1)},t.prototype.checkOrientation_=function(){for(var e=this.mesh.fHead,i,r=this.mesh.vHead,n,s=0,a=e.next;a!==e;a=a.next)if(n=a.anEdge,!(n.winding<=0))do s+=(n.Org.s-n.Dst.s)*(n.Org.t+n.Dst.t),n=n.Lnext;while(n!==a.anEdge);if(s<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},t.prototype.projectPolygon_=function(){var e=this.mesh.vHead,i=[0,0,0],r,n,s=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),s=!0),r=this.sUnit,n=this.tUnit;var a=this.longAxis_(i);r[a]=0,r[(a+1)%3]=1,r[(a+2)%3]=0,n[a]=0,n[(a+1)%3]=0,n[(a+2)%3]=i[a]>0?1:-1;for(var o=e.next;o!==e;o=o.next)o.s=this.dot_(o.coords,r),o.t=this.dot_(o.coords,n);s&&this.checkOrientation_();for(var l=!0,c=e.next;c!==e;c=c.next)l?(this.bmin[0]=this.bmax[0]=c.s,this.bmin[1]=this.bmax[1]=c.t,l=!1):(c.s<this.bmin[0]&&(this.bmin[0]=c.s),c.s>this.bmax[0]&&(this.bmax[0]=c.s),c.t<this.bmin[1]&&(this.bmin[1]=c.t),c.t>this.bmax[1]&&(this.bmax[1]=c.t))},t.prototype.addWinding_=function(e,i){e.winding+=i.winding,e.Sym.winding+=i.Sym.winding},t.prototype.tessellateMonoRegion_=function(e,i){var r,n;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;jt.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;jt.vertLeq(r.Org,r.Dst);r=r.Lnext);n=r.Lprev;for(var s=void 0;r.Lnext!==n;)if(jt.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(jt.edgeGoesLeft(n.Lnext)||jt.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)s=e.connect(n.Lnext,n),n=s.Sym;n=n.Lprev}else{for(;n.Lnext!==r&&(jt.edgeGoesRight(r.Lprev)||jt.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)s=e.connect(r,r.Lprev),r=s.Sym;r=r.Lnext}if(n.Lnext===r)throw"Mono region invalid";for(;n.Lnext.Lnext!==r;)s=e.connect(n.Lnext,n),n=s.Sym;return!0},t.prototype.tessellateInterior_=function(e){for(var i,r=e.fHead.next;r!==e.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(e,r))return!1;return!0},t.prototype.discardExterior_=function(e){for(var i,r=e.fHead.next;r!==e.fHead;r=i)i=r.next,r.inside||e.zapFace(r)},t.prototype.setWindingNumber_=function(e,i,r){for(var n,s=e.eHead.next;s!==e.eHead;s=n)n=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?i:-i:r?e.delete(s):s.winding=0},t.prototype.getNeighbourFace_=function(e){return!e.Rface||!e.Rface.inside?-1:e.Rface.n},t.prototype.outputPolymesh_=function(e,i,r,n){var s,a=0,o=0,l;r>3&&e.mergeConvexFaces(r);for(var c=e.vHead.next;c!==e.vHead;c=c.next)c.n=-1;for(var h=e.fHead.next;h!==e.fHead;h=h.next)if(h.n=-1,!!h.inside){s=h.anEdge,l=0;do{var c=s.Org;c.n===-1&&(c.n=o,o++),l++,s=s.Lnext}while(s!==h.anEdge);if(l>r)throw"Face vertex greater that support polygon";h.n=a,++a}this.elementCount=a,i===On.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*r,this.vertexCount=o,this.vertices=[],this.vertices.length=o*n,this.vertexIndices=[],this.vertexIndices.length=o;for(var c=e.vHead.next;c!==e.vHead;c=c.next)if(c.n!==-1){var u=c.n*n;this.vertices[u+0]=c.coords[0],this.vertices[u+1]=c.coords[1],n>2&&(this.vertices[u+2]=c.coords[2]),this.vertexIndices[c.n]=c.idx}for(var d=0,h=e.fHead.next;h!==e.fHead;h=h.next)if(h.inside){s=h.anEdge,l=0;do{var c=s.Org;this.elements[d++]=c.n,l++,s=s.Lnext}while(s!==h.anEdge);for(var f=l;f<r;++f)this.elements[d++]=-1;if(i===On.CONNECTED_POLYGONS){s=h.anEdge;do this.elements[d++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==h.anEdge);for(var p=l;p<r;++p)this.elements[d++]=-1}}},t.prototype.outputContours_=function(e,i){var r,n,s=0,a=0;this.vertexCount=0,this.elementCount=0;for(var o=e.fHead.next;o!==e.fHead;o=o.next)if(o.inside){n=r=o.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==n);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,c=0,h=0;s=0;for(var o=e.fHead.next;o!==e.fHead;o=o.next)if(o.inside){a=0,n=r=o.anEdge;do this.vertices[l++]=r.Org.coords[0],this.vertices[l++]=r.Org.coords[1],i>2&&(this.vertices[l++]=r.Org.coords[2]),this.vertexIndices[c++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,a++,r=r.Lnext;while(r!==n);this.elements[h++]=s,this.elements[h++]=a,s+=a}},t.prototype.addContour=function(e,i){this.mesh===null&&(this.mesh=new Iq),e<2&&(e=2),e>3&&(e=3);for(var r=null,n=0;n<i.length;n+=e)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[n+0],r.Org.coords[1]=i[n+1],e>2?r.Org.coords[2]=i[n+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},t.prototype.tesselate=function(e,i,r,n,s,a){if(e===void 0&&(e=nr.ODD),i===void 0&&(i=On.POLYGONS),a===void 0&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=e,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),$6e.computeInterior(this,a);var o=this.mesh;return i===On.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),a&&o.check(),i===On.BOUNDARY_CONTOURS?this.outputContours_(o,n):this.outputPolymesh_(o,i,r,n),!0},t}();function Nf(t){var e=t.windingRule,i=e===void 0?nr.ODD:e,r=t.elementType,n=r===void 0?On.POLYGONS:r,s=t.polySize,a=s===void 0?3:s,o=t.vertexSize,l=o===void 0?2:o,c=t.normal,h=c===void 0?[0,0,1]:c,u=t.contours,d=u===void 0?[]:u,f=t.strict,p=f===void 0?!0:f,m=t.debug,g=m===void 0?!1:m;if(!d&&p)throw new Error("Contours can't be empty");if(d){var v=new J6e;t.edgeCreateCallback&&(v.edgeCreateCallback=t.edgeCreateCallback),t.vertexIdCallback&&(v.vertexIdCallback=t.vertexIdCallback);for(var y=0;y<d.length;y++)v.addContour(l||2,d[y]);return v.tesselate(i,n,a,l,h,p),{vertices:v.vertices,vertexIndices:v.vertexIndices,vertexCount:v.vertexCount,elements:v.elements,elementCount:v.elementCount,mesh:g?v.mesh:void 0}}}nr.ODD;nr.NONZERO;nr.POSITIVE;nr.NEGATIVE;nr.ABS_GEQ_TWO;On.POLYGONS;On.CONNECTED_POLYGONS;On.BOUNDARY_CONTOURS;var YN=class{constructor(t=256,e=!1){this.capacity=t,this.size=0,this.debug=e,this.debug&&console.log(`allocating with cap ${t}`);let i=t*YN.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,n=0;this.positions=new Float32Array(this.buffer,n*r,3*t),n+=3*t,this.normals=new Float32Array(this.buffer,n*r,3*t),n+=3*t,this.uvs=new Float32Array(this.buffer,n*r,2*t)}realloc(t,e=!1){if(t<this.size)throw Error("cannot shrink buffer");if(t<=this.capacity&&!e)return;this.debug&&console.log(`resizing from ${this.capacity}  ${t}`);let i=t*YN.eSize,r=new ArrayBuffer(i),n=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(r,s*n,3*t);s+=3*t;let o=new Float32Array(r,s*n,3*t);s+=3*t;let l=new Float32Array(r,s*n,2*t);e?(a.set(this.positions.subarray(0,this.size*3)),o.set(this.normals.subarray(0,this.size*3)),l.set(this.uvs.subarray(0,this.size*2))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=r,this.positions=a,this.normals=o,this.uvs=l,this.capacity=t}get(t=1){let e=this.size+t;if(e>this.capacity){let r=this.capacity;for(;e>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=e,i}reserve(t){let e=this.size+t;e>this.capacity&&this.realloc(e)}shrink(){this.debug&&console.log(`shrinking ${this.capacity}  ${this.size}`),this.realloc(this.size,!0)}},Loe=YN;Loe.eSize=8*Float32Array.BYTES_PER_ELEMENT;var Z6e=class{constructor(t=[],e=(i,r)=>i<r?-1:i>r?1:0){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:e,compare:i}=this,r=e[t];for(;t>0;){let n=t-1>>1,s=e[n];if(i(r,s)>=0)break;e[t]=s,t=n}e[t]=r}_down(t){let{data:e,compare:i}=this,r=this.length>>1,n=e[t];for(;t<r;){let s=(t<<1)+1,a=s+1;if(a<this.length&&i(e[a],e[s])<0&&(s=a),i(e[s],n)>=0)break;e[t]=e[s],t=s}e[t]=n}};function e8e(t,e,i=1,r=!1){let n=1/0,s=1/0,a=-1/0,o=-1/0;for(let[y,x]of t[0])y<n&&(n=y),x<s&&(s=x),y>a&&(a=y),x>o&&(o=x);let l=a-n,c=o-s,h=Math.max(i,Math.min(l,c));if(h===i){let y=[n,s];return y.distance=0,y.distance}let u=new Z6e([],(y,x)=>x.max-y.max),d=i8e(t),f=new uP(n+l/2,s+c/2,0,t);f.d>d.d&&(d=f);let p=2;function m(y,x,S){let A=new uP(y,x,S,t);if(p++,A.max>d.d+i&&u.push(A),A.d>d.d&&(d=A,r&&console.log(`found best ${Math.round(1e4*A.d)/1e4} after ${p} probes`),d.d>e))return e}let g=h/2;for(let y=n;y<a;y+=h)for(let x=s;x<o;x+=h)m(y+g,x+g,g);for(;u.length;){let{max:y,x,y:S,h:A}=u.pop();if(y-d.d<=i)break;g=A/2,m(x-g,S-g,g),m(x+g,S-g,g),m(x-g,S+g,g),m(x+g,S+g,g)}r&&console.log(`num probes: ${p}
best distance: ${d.d}`);let v=[d.x,d.y];return v.distance=d.d,v.distance}function uP(t,e,i,r){this.x=t,this.y=e,this.h=i,this.d=t8e(t,e,r),this.max=this.d+this.h*Math.SQRT2}function t8e(t,e,i){let r=!1,n=1/0;for(let s of i)for(let a=0,o=s.length,l=o-1;a<o;l=a++){let c=s[a],h=s[l];c[1]>e!=h[1]>e&&t<(h[0]-c[0])*(e-c[1])/(h[1]-c[1])+c[0]&&(r=!r),n=Math.min(n,r8e(t,e,c,h))}return n===0?0:(r?1:-1)*Math.sqrt(n)}function i8e(t){let e=0,i=0,r=0,n=t[0];for(let a=0,o=n.length,l=o-1;a<o;l=a++){let c=n[a],h=n[l],u=c[0]*h[1]-h[0]*c[1];i+=(c[0]+h[0])*u,r+=(c[1]+h[1])*u,e+=u*3}let s=new uP(i/e,r/e,0,t);return e===0||s.d<0?new uP(n[0][0],n[0][1],0,t):s}function r8e(t,e,i,r){let n=i[0],s=i[1],a=r[0]-n,o=r[1]-s;if(a!==0||o!==0){let l=((t-n)*a+(e-s)*o)/(a*a+o*o);l>1?(n=r[0],s=r[1]):l>0&&(n+=a*l,s+=o*l)}return a=t-n,o=e-s,a*a+o*o}var xG={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},Ooe={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},Boe={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},oO=(t,e)=>([i,r])=>(r<i&&(r+=e),(t>=i?t:t+e)<=r),bG=class extends Nt{constructor(t,e,i=0,r=12,n=3,s=nr.ODD,a=!1){super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=t,this._depth=e,this._curveSegments=r,this._bevelSegmentsInput=n;let o=this._shape.extractShapePointsToFlatArray([],r),l=this._shape.shapeHoles.map(T=>{let C=T.extractShapePointsToFlatArray([],r),D=[];for(let B=C.length-1;B>=1;B-=2){let O=C[B-1],L=C[B-0];D.push(O,L)}return D}),c=[],h=[];for(let T=0;T<o.length;T+=2)h.push([o[T],o[T+1]]);c.push(h);for(let T=0;T<l.length;T++){let C=l[T],D=[];for(let B=0;B<C.length;B+=2)D.push([C[B],C[B+1]]);c.push(D)}let u;t.isText?u=new U5().setFromPoints(t.points.map(T=>T.position)).getSize(new ye).length()*.1:c[0].length===0?u=i:i>0?u=e8e(c,i):u=1e-5,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,u,e/2),this._bevelSegments=Math.floor(n));let d;try{d=Nf({windingRule:s,elementType:On.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{d=xG}let f;try{f=Nf({windingRule:nr.ODD,elementType:On.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{f=Ooe}if(!d)throw new Error("error generating geometry");let p=d.elementCount;if(f){d.elementCount+=f.elementCount;for(let T=0;T<f.elements.length;T++){let C=f.elements[T],D=T%2===0?d.vertexCount:0;d.elements.push(C+D)}for(let T=0;T<f.vertexIndices.length;T++){let C=f.vertexIndices[T],D=d.vertexCount;d.vertexIndices.push(C+D)}for(let T=0;T<f.vertices.length;T++){let C=f.vertices[T];d.vertices.push(C)}}let m=1/0,g=-1/0,v=1/0,y=-1/0;for(let T=0,C=d.vertexCount;T<C;T++){let D=T*2,B=d.vertices[D+0],O=d.vertices[D+1];B<m&&(m=B),B>g&&(g=B),O<v&&(v=O),O>y&&(y=O)}this._minX=m,this._minY=v,this._width=g-m,this._height=y-v,this._buffer=new Loe(this._computeBufferEstimatedSize(d));let x=[],S=[];for(let T=d.elementCount-1;T>=0;T--){let C=T>=p,D=T*2,B=d.elements[D+0],O=d.elements[D+1],L=B+O,H={start:B,count:O,normals:[],continuous:[],concave:[]},q=B,W=L-1,I=B+1,z=this._shape.roundedCurves.length;do{let ie=q-B,ce=d.vertices[W*2+0],Z=d.vertices[W*2+1],Ae=d.vertices[q*2+0],Se=d.vertices[q*2+1],_e=d.vertices[I*2+0],ve=d.vertices[I*2+1],Ee=Ae-ce,fe=Se-Z,pe=Math.sqrt(Ee*Ee+fe*fe);Ee/=pe,fe/=pe;let Ie=Ae-_e,Le=Se-ve,Ge=Math.sqrt(Ie*Ie+Le*Le);Ie/=Ge,Le/=Ge,H.normals[ie*2+0]=-Le,H.normals[ie*2+1]=Ie,H.concave[ie]=Ee*Le-fe*Ie>0;let Ke=d.vertexIndices[q];if(Array.isArray(Ke))H.continuous[ie]=!1;else{let[Ve,ke]=this._shape.getCurveIndexFromVertexId(Ke-1,!0);if(ke>0&&ke<1)H.continuous[ie]=!0;else{let ut=ke===1?Ve+1:Ve-1;ut=(ut+z)%z;let dt=ke===1?0:1,V=this._shape.roundedCurves[Ve].getTangent(ke),F=this._shape.roundedCurves[ut].getTangent(dt);H.continuous[ie]=V.dot(F)>.95}}C&&(H.normals[ie*2+0]*=-1,H.normals[ie*2+1]*=-1),[W,q,I]=[q,I,I+1],I>=L&&(I-=O)}while(I!==B+1);let U=[];U.push({bevelI:0,angle:0,size:0,boundary:{vertices:d.vertices.slice(B*2,L*2),vertexCount:O,vertexIndices:new Array(O).fill(!0).map((ie,ce)=>[ce,ce]),elements:[0,O],elementCount:1,mesh:null},reverseMap:[],insetPoints:d.vertices.slice(B*2,L*2)});let X=0;for(let ie=1;ie<=this._bevelSegments;ie++){let ce=ie/this._bevelSegments*Math.PI/2,Z=(1-Math.cos(ce))*this._bevel,Ae=[],Se=[],_e=0;for(let Ee=0;Ee<O;Ee++){let fe=Ee*2,pe=(Ee-1+O)%O*2,Ie=d.vertices[H.start*2+fe+0],Le=d.vertices[H.start*2+fe+1],Ge=-H.normals[pe+0]*Z,Ke=-H.normals[pe+1]*Z,Ve=-H.normals[fe+0]*Z,ke=-H.normals[fe+1]*Z;if(H.concave[Ee]||!H.concave[Ee]&&C){let ut=Math.atan2(Ke,Ge),dt=Math.atan2(ke,Ve);dt>ut&&(dt-=Math.PI*2);let V=dt-ut;if(H.continuous[Ee]||C){let F=ut+V/2,oe=Math.cos(F)*Z,Ce=Math.sin(F)*Z;Ae[2*_e+0]=Ie+oe*(C?-1:1),Ae[2*_e+1]=Le+Ce*(C?-1:1),Se[_e]=Ee,_e++}else{let F=Math.max(1,Math.floor(r/4*Math.abs(V)/Math.PI));for(let oe=0;oe<=F;oe++){let Ce=ut+V*(oe/F),K=Math.cos(Ce)*Z,Re=Math.sin(Ce)*Z;Ae[2*_e+0]=Ie+K,Ae[2*_e+1]=Le+Re,Se[_e]=Ee,_e++}}}else Ae[2*_e+0]=Ie+Ge,Ae[2*_e+1]=Le+Ke,Se[_e]=Ee,_e++,Ae[2*_e+0]=Ie,Ae[2*_e+1]=Le,Se[_e]=Ee,_e++,Ae[2*_e+0]=Ie+Ve,Ae[2*_e+1]=Le+ke,Se[_e]=Ee,_e++}let ve=Nf({windingRule:nr.POSITIVE,elementType:On.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[Ae],edgeCreateCallback:Ee=>{let fe=Ee.Org.idx,pe=Se[fe],Ie=Se[(fe+1)%Se.length];Ee.idx=[pe,Ie],Ee.Sym.idx=[Ie,pe]},vertexIdCallback:Ee=>{let fe=Ee.Lprev.idx;return[fe?fe[1]:0,Ee.idx?Ee.idx[0]:0]}});if(!ve)throw console.log("Error"),new Error(`error generating bevel geometry for ${ie}'th loop`);if(!ve.vertexCount){let Ee=(ie-1)/this._bevelSegments*Math.PI/2;X=(1-Math.sin(Ee))*this._bevel;break}for(let Ee=0;Ee<ve.vertexIndices.length;Ee++){let[fe,pe]=ve.vertexIndices[Ee];if(fe===pe)continue;let Ie=pe;pe<fe&&(Ie+=O);for(let Le=fe;Le<Ie;Le++){let Ge=Le%O,Ke=(Le+1)%O;if(!H.continuous[Ge]||!H.continuous[Ke]){ve.vertexIndices[Ee]=[fe,Ge],ve.vertexIndices.splice(Ee+1,0,[Ke,pe]),ve.vertices.splice((Ee+1)*2,0,ve.vertices[Ee*2],ve.vertices[Ee*2+1]);break}}}U.push({bevelI:ie,angle:ce,size:Z,boundary:ve,reverseMap:Se,insetPoints:Ae})}let Q=(ie,ce,Z)=>{let Ae=0,Se=ie.boundary.vertexIndices.length;for(;Ae<Se&&Z(ie.boundary.vertexIndices[ce]);)ce=(ce+1)%Se,Ae++;return Ae},re=x.length;for(let ie=1;ie<U.length;ie++){let ce=U[ie-1],Z=U[ie],Ae=ce.boundary.vertexIndices.length,Se=Z.boundary.vertexIndices.length;if(!Ae||!Se)break;let _e=H.concave.length,ve=0,Ee=oO(ve,O);for(;!ce.boundary.vertexIndices.filter(Ee).length||!Z.boundary.vertexIndices.filter(Ee).length;)ve++,Ee=oO(ve,O);let fe=ce.boundary.vertexIndices.findIndex(Ee),pe=Z.boundary.vertexIndices.findIndex(Ee);do fe=(fe+1)%Ae;while(Ee(ce.boundary.vertexIndices[fe]));do pe=(pe+1)%Se;while(Ee(Z.boundary.vertexIndices[pe]));ve=(ve+1)%O;let Ie=ve,Le=0,Ge=this._buildBevelVert(H,ce,(fe-1+Ae)%Ae,void 0,Le),Ke=this._buildBevelVert(H,Z,(pe-1+Se)%Se,void 0,Le),Ve=Ge,ke=Ke,ut,dt,V=!1;do{Le=(ve||_e)/_e,Ee=oO(ve,O);let F=Q(ce,fe,Ee),oe=Q(Z,pe,Ee),Ce=V;if(V=!1,F&&!oe){for(let K=0;K<F;K++)ut=this._buildBevelVert(H,ce,(fe+K)%Ae,K/(F-1),Le),x.push(Ve.topN,ut.topP,ke.topN),a===!1&&x.push(ut.bottomP,Ve.bottomN,ke.bottomN),Ve=ut;V=!0}else if(!F&&oe)for(let K=0;K<oe;K++)dt=this._buildBevelVert(H,Z,(pe+K)%Se,K/(oe-1),Le),x.push(ke.topN,Ve.topP,dt.topP),a===!1&&x.push(Ve.bottomP,ke.bottomN,dt.bottomP),ke=dt;else if(F&&oe)if(ut=this._buildBevelVert(H,ce,fe,0,Le),dt=this._buildBevelVert(H,Z,pe,0,Le),Ce?(x.push(Ve.topN,dt.topP,ke.topN),x.push(Ve.topN,ut.topP,dt.topP),a===!1&&(x.push(dt.bottomP,Ve.bottomN,ke.bottomN),x.push(dt.bottomP,ut.bottomP,Ve.bottomN))):(x.push(ke.topN,Ve.topN,ut.topP),x.push(ke.topN,ut.topP,dt.topP),a===!1&&(x.push(ut.bottomP,Ve.bottomN,ke.bottomN),x.push(ut.bottomP,ke.bottomN,dt.bottomP))),Ve=ut,ke=dt,F===oe)for(let K=1;K<F;K++)ut=this._buildBevelVert(H,ce,(fe+K)%Ae,K/(F-1),Le),dt=this._buildBevelVert(H,Z,(pe+K)%Se,K/(oe-1),Le),x.push(Ve.topN,ut.topP,ke.topN),x.push(ke.topN,ut.topP,dt.topP),a===!1&&(x.push(ut.bottomP,Ve.bottomN,ke.bottomN),x.push(ut.bottomP,ke.bottomN,dt.bottomP)),Ve=ut,ke=dt;else if(F>oe){let K=F/oe,Re=0;for(let Ze=1;Ze<F;Ze++)ut=this._buildBevelVert(H,ce,(fe+Ze)%Ae,Ze/(F-1),Le),x.push(Ve.topN,ut.topP,ke.topN),a===!1&&x.push(ut.bottomP,Ve.bottomN,ke.bottomN),Ve=ut,Ze>(Re+1)*K&&(Re++,dt=this._buildBevelVert(H,Z,(pe+Re)%Se,Re/(oe-1),Le),x.push(ke.topN,ut.topP,dt.topP),a===!1&&x.push(ut.bottomP,ke.bottomN,dt.bottomP),ke=dt)}else{let K=oe/F,Re=0;for(let Ze=1;Ze<oe;Ze++)dt=this._buildBevelVert(H,Z,(pe+Ze)%Se,Ze/(oe-1),Le),x.push(ke.topN,ut.topP,dt.topP),a===!1&&x.push(ut.bottomP,ke.bottomN,dt.bottomP),ke=dt,Ze>(Re+1)*K&&(Re++,ut=this._buildBevelVert(H,ce,(fe+Re)%Ae,Re/(F-1),Le),x.push(Ve.topN,ut.topP,ke.topN),a===!1&&x.push(ut.bottomP,Ve.bottomN,ke.bottomN),Ve=ut)}fe=(fe+F)%Ae,pe=(pe+oe)%Se,ve=(ve+1)%_e}while(ve!==Ie)}if(a===!1&&this._depth>this._bevel*2&&this._buildWall(U,H,x),C){let ie=[];for(let ce=x.length-1;ce>=re+2;ce-=3){let Z=x[ce-2],Ae=x[ce-1],Se=x[ce-0];ie.push(Se,Ae,Z)}x.splice(re,x.length-re,...ie)}if(C){let ie=[];for(let ce=U[U.length-1].boundary.vertices.length-1;ce>=1;ce-=2){let Z=U[U.length-1].boundary.vertices[ce-1],Ae=U[U.length-1].boundary.vertices[ce-0];ie.push(Z,Ae)}S.push(ie)}if(!C){let ie=U[U.length-1],ce;try{ce=Nf({windingRule:U.length>1?nr.POSITIVE:nr.ODD,elementType:On.POLYGONS,vertexSize:2,strict:!0,contours:[ie.insetPoints,...S]})}catch{ce=Boe}if(!ce)throw new Error("Error generating geometry for surface");l.length===0&&this._bevel<u&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let Z=0;Z<ce.elementCount*3;Z+=3){let Ae=this._buildSurfaceVert(ce,ce.elements[Z+0],X),Se=this._buildSurfaceVert(ce,ce.elements[Z+1],X),_e=this._buildSurfaceVert(ce,ce.elements[Z+2],X);x.push(Ae.top,Se.top,_e.top),a===!1&&x.push(_e.bottom,Se.bottom,Ae.bottom)}}this.vertexCache={}}this._buffer.shrink();let A=new Yt(Uint32Array.from(x),1),_=new Yt(this._buffer.positions,3),M=new Yt(this._buffer.normals,3),E=new Yt(this._buffer.uvs,2);_.needsUpdate=!0,M.needsUpdate=!0,E.needsUpdate=!0,A.needsUpdate=!0,this.setAttribute("position",_),this.setAttribute("normal",M),this.setAttribute("uv",E),this.setIndex(A)}_computeBufferEstimatedSize(t){return t.vertexCount*2*(2+this._bevelSegments)}_buildWall(t,e,i){let r=t[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(e,r,n),o=this._buildBevelVert(e,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}_buildSurfaceVert(t,e,i){let r=e.toString();if(r in this.vertexCache)return this.vertexCache[r];let n=t.vertices[e*2+0],s=t.vertices[e*2+1],a=(n-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),c=l*3,h=l*2,u={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=n,this._buffer.positions[c+1]=s,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[h+0]=a,this._buffer.uvs[h+1]=o,this.forPathBevel===!1&&(this._buffer.positions[c+3]=n,this._buffer.positions[c+4]=s,this._buffer.positions[c+5]=i,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[h+2]=a,this._buffer.uvs[h+3]=o),this.vertexCache[r]=u,u}_buildBevelVert(t,e,i,r=1,n){let s=`${e.bevelI}:${i}`;if(s in this.vertexCache&&n!==0&&n!==1&&(!n||n===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let[a,o]=e.boundary.vertexIndices[i],l,c,h,u;a!==o?(c=a,l=o,u=!1,h=t.continuous[c]&&t.continuous[l]):(l=a,c=(l-1+t.count)%t.count,u=t.concave[l]&&e.bevelI>0,h=t.continuous[l]||u);let d=Math.cos(e.angle),f=Math.sin(e.angle),p=i*2,m=l*2,g=c*2,v=e.boundary.vertices[p+0],y=e.boundary.vertices[p+1],x=(1-f)*this._bevel,S=(v-this._minX)/this._width,A=(y-this._minY)/this._height;this.forPathBevel&&(n!==void 0&&(S=n),A=1);let _=t.normals[m+0],M=t.normals[m+1],E=t.normals[g+0],T=t.normals[g+1];if(u){let L=E-_,H=T-M;_=_+L*(1-r),M=M+H*(1-r);let q=Math.sqrt(_*_+M*M);_/=q,M/=q}let C=this.forPathBevel?this._buffer.get(h?1:2):this._buffer.get(h?2:4),D=C*3,B=C*2,O={i,fi:l,topP:C+0,topN:C+0,bottomP:C+1,bottomN:C+1,pathBevelUCoord:n};return this._buffer.positions[D+0]=v,this._buffer.positions[D+1]=y,this._buffer.positions[D+2]=(this.forPathBevel?this._bevel:this._depth)-x,this._buffer.normals[D+0]=_*d,this._buffer.normals[D+1]=M*d,this._buffer.normals[D+2]=f,this._buffer.uvs[B+0]=S,this._buffer.uvs[B+1]=A,this.forPathBevel===!1&&(this._buffer.positions[D+3]=v,this._buffer.positions[D+4]=y,this._buffer.positions[D+5]=x,this._buffer.normals[D+3]=_*d,this._buffer.normals[D+4]=M*d,this._buffer.normals[D+5]=-f,this._buffer.uvs[B+2]=A,this._buffer.uvs[B+3]=S),h||(this.forPathBevel?(C+=1,D+=3,B+=2):(C+=2,D+=6,B+=4),O.topP=C+0,O.bottomP=C+1,this._buffer.positions[D+0]=v,this._buffer.positions[D+1]=y,this._buffer.positions[D+2]=(this.forPathBevel?this._bevel:this._depth)-x,this._buffer.normals[D+0]=E*d,this._buffer.normals[D+1]=T*d,this._buffer.normals[D+2]=f,this._buffer.uvs[B+0]=S,this._buffer.uvs[B+1]=A,this.forPathBevel===!1&&(this._buffer.positions[D+3]=v,this._buffer.positions[D+4]=y,this._buffer.positions[D+5]=x,this._buffer.normals[D+3]=E*d,this._buffer.normals[D+4]=T*d,this._buffer.normals[D+5]=-f,this._buffer.uvs[B+2]=A,this._buffer.uvs[B+3]=S)),this.vertexCache[s]=O,O}clone(){let t=new bG(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return t.userData=FD(this.userData),t}},Foe=class extends Nt{constructor(t,e=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=nr.ODD,this.elementType=On.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=t,this._curveSegments=e,this._triangulationOptions=Object.assign({windingRule:nr.ODD,elementType:On.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),n=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),s,a=!0,o=!0,l,c;for(let d=0,f=r.length/2;d<f;d++){let p=d*2,m=r[p+0],g=r[p+1];if(l!==void 0&&m!==l&&(a=!1),c!==void 0&&g!==c&&(o=!1),l=m,c=g,!a&&!o)break}if(!a&&!o)try{s=Nf({contours:[r,...n],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{s=xG}let h=(s==null?void 0:s.vertexCount)??1,u=(s==null?void 0:s.elementCount)??1;if(this._positionAttribute=new Yt(new Float32Array(h*3),3),this._normalAttribute=new Yt(new Float32Array(h*3),3),this._uvAttribute=new Yt(new Float32Array(h*2),2),this._indexAttribute=new Yt(new Uint32Array(u*3),1),s){let d=1/0,f=-1/0,p=1/0,m=-1/0;for(let y=0,x=h;y<x;y++){let S=y*2,A=s.vertices[S+0],_=s.vertices[S+1];A<d&&(d=A),A>f&&(f=A),_<p&&(p=_),_>m&&(m=_)}let g=f-d,v=m-p;for(let y=0,x=h;y<x;y++){let S=y*2,A=s.vertices[S+0],_=s.vertices[S+1],M=(A-d)/g,E=(_-p)/v;this._positionAttribute.setXYZ(y,A,_,0),this._normalAttribute.setXYZ(y,0,0,1),this._uvAttribute.setXY(y,M,E)}for(let y=0,x=u;y<x;y++){let S=y*3,A=s.elements[S+0],_=s.elements[S+1],M=s.elements[S+2];this._indexAttribute.setX(S+0,A),this._indexAttribute.setX(S+1,_),this._indexAttribute.setX(S+2,M)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((s==null?void 0:s.elementCount)??1)*3)}clone(){let t=new Foe(this._shape,this._curveSegments);return t.userData=FD(this.userData),t}},koe=class extends bG{constructor(t,e,i=0,r=12,n=3,s=nr.ODD){super(t,e,i,r,n,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(t){return t.vertexCount*2*(2+this._bevelSegments)}_buildWall(t,e,i){let r=t[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(e,r,n),o=this._buildBevelVert(e,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}clone(){let t=new koe(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return t.userData=FD(this.userData),t}},o0=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){var c,h;let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:nr.ODD},t.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=t.shape??(e==null?void 0:e.shape),o=(a==null?void 0:a.roundness)??i.roundness;a!==void 0&&(a instanceof an?(a.width!==r||a.height!==n)&&a.applySize(r,n):a=new an(r,n).fromJSON(a),((c=t.parameters)==null?void 0:c.roundness)!==void 0&&((h=t.parameters)==null?void 0:h.roundness)>0&&a.update());let l=a??new an(r,n);return{parameters:Object.assign(i,{width:r,height:n,depth:s,roundness:o}),shape:l}}static build(t){let{depth:e,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:n,roundness:s,windingRule:a}=t.parameters;t.shape.roundness=s;let o;return e<=0?o=new Foe(t.shape,n,{windingRule:a}):o=new koe(t.shape,e,i,n,r,a),Object.assign(o,{userData:{...t,type:"VectorGeometry"}})}},Noe=Math.PI*2,wG=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters);return i.angle=Et.clamp(i.angle,0,360),{shape:t.shape&&t.shape instanceof an?t.shape:new an,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i,spikes:r,angle:n,innerRadius:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=t.parameters,c=t.shape,h=e*.5,u=i*.5,d=n8e(c,h,u,n*Math.PI/180,r,s);c.isClosed=!0,c.update();let f;return n===0?(f=new Nt,f.setAttribute("position",new bt([],3))):f=o0.create({shape:c,parameters:{subdivisions:d,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}}),Object.assign(f,{userData:{...t,type:"EllipseGeometry"}})}};function n8e(t,e,i,r,n,s){if(r>=Noe)return n>30||n%4===0?(a8e(t,e,i,s),Math.round(n/4)):Fq(t,r,n,e,i,s);r=Math.max(r,.001);let a={x:0,y:i},o=r+Math.PI*.5,l={x:Math.cos(o)*e,y:Math.sin(o)*i},c=q6e({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:e,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return n>30||n%c.length===0?s8e(t,a.x,a.y,c,n,e,i,s):Fq(t,r,n,e,i,s)}function s8e(t,e,i,r,n,s,a,o){let l=Math.round(n/r.length);t.addPoint(Iy(e,i));for(let c=0,h=r.length;c<h;c++){let u=r[c],d=t.points[c],f=Iy(u.x,u.y);d.controls[1].position.set(u.x1,u.y1),f.controls[0].position.set(u.x2,u.y2),t.addPoint(f)}return o>0?Uoe(t,s,a,o):t.addPoint(Iy(0,0)),l}function Fq(t,e,i,r,n,s){let a=-e/i;for(let o=0;o<=i;o++){let l=a*o,c=Math.sin(l)*r,h=Math.cos(l)*n;t.addPoint(Iy(c,h))}return e<Noe?s>0?Uoe(t,r,n,s):t.addPoint(Iy(0,0)):(t.removePoint(t.points[t.points.length-1]),s>0&&zoe(t,r,n,s)),1}function a8e(t,e,i,r=0,n=0,s=0){let a=.5522847498,o=e*a,l=i*a;t.addPoint(KM(n-e,s,n-e,s-l,n-e,s+l)),t.addPoint(KM(n,s+i,n-o,s+i,n+o,s+i)),t.addPoint(KM(n+e,s,n+e,s+l,n+e,s-l)),t.addPoint(KM(n,s-i,n+o,s-i,n-o,s-i)),r>0&&zoe(t,e,i,r)}function Iy(t,e){return new Ry(Et.generateUUID(),new ye(t,e))}function KM(t,e,i,r,n,s){let a=Iy(t,e);return a.controls[0].position.set(i,r),a.controls[1].position.set(n,s),a}function Uoe(t,e,i,r){Goe(t,e,i,r).forEach(n=>t.addPoint(n))}function zoe(t,e,i,r){let n=Goe(t,e,i,r),s=new an;n.forEach(a=>s.addPoint(a)),s.isClosed=!0,t.shapeHoles.push(s)}function Goe(t,e,i,r){let n=r*e/100,s=n*(Math.abs(i)/Math.abs(e)),a=new ye(n/e,s/i),o=t.points.map(l=>{let c=l.clone();return c.uuid=Et.generateUUID(),c}).reverse();return o.forEach(l=>{l.position.multiply(a);let c=l.controls[0].position.clone().multiply(a),h=l.controls[1].position.clone().multiply(a);l.controls[0].position.copy(h),l.controls[1].position.copy(c)}),o}var o8e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},t.parameters),r=Math.abs(i.width),n=Math.abs(i.height??r),s=Math.abs(i.depth??r),a=Math.abs(Math.min(r,s))/2;return{parameters:Object.assign(i,{width:r,height:n,depth:s,radius:a,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(t){let{width:e,height:i,depth:r,radius:n,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:c,cornerRadius:h,cornerSegments:u}=t.parameters,d=new Voe(!1,e,i,r,n,s,a,o,l,c,h,u);return Object.assign(d,{userData:{...t,type:"HelixGeometry"}})}},lO=new My([0,0,0],1),Voe=class extends Nt{constructor(t=!0,e=1,i=1,r=1,n=1,s=1,a=1,o=1,l=1,c=1,h=1,u=1){if(super(),s===0)return;let d=t&&s===1;d&&(u=0),h>100&&(h=100),h===0&&(u=0);let f=()=>new N,p=new N,m=f(),g=f(),v=f(),y,x,S,A,_,M,E,T,C=f(),D=f(),B=f(),O=f(),L=f(),H=f(),q=f(),W=f(),I=i-2*o+.001,z=I/s,U=Math.ceil(a*s),X=U+1,Q=I/U,re=-I/2,ie=c+1,ce=2*Math.PI/c,Z=Math.PI/2/u,Ae=.01,Se=Math.min((1-h/100)*o,o-Ae),_e=o-Se,ve=0,Ee=2,fe=u*Ee+Ee,pe=ie*fe/Ee,Ie=pe+ie*X,Le=Math.max(0,ie*(X+fe)),[Ge,Ke,Ve]=[3,3,2].map(me=>Array(Le*me).fill(0)),ke=[],ut=n-o;function dt(me,$e){let Qe=Math.PI/2;M=$e*Q,T=2*Math.PI*(M%z)/z+Qe,M+=re,E=Math.sin(T)*ut,_=Math.cos(T)*ut,t?me.set(_,E,M):me.set(_,M,E)}dt(p,-1e-10),dt(m,0),C.copy(p),dt(p,1);let V=p.distanceTo(m),F=d?0:_e+Se,oe=V*U+2*F,Ce=Se,K=oe-F;for(let me=0;me<=U;me++){dt(g,me),W.subVectors(g,C).normalize(),C.copy(g),H.copy(g).setComponent(+t+1,0).normalize(),q.crossVectors(W,H).normalize();let $e=me===0,Qe=me===U,Je=$e?3*Math.PI/2:Z,ot=$e?Ce:K,nt=$e?ie:Ie,de=$e?0:Le-ie,Xe=W.clone().multiplyScalar($e?-_e:_e).add(g),mt=W.clone().multiplyScalar($e?-1:1).normalize();for(let J=0;J<ie;J++){let he=J*ce;if(D.addVectors(p.copy(H).multiplyScalar(o*Math.cos(he)),m.copy(q).multiplyScalar(o*Math.sin(he))),B.copy(D).normalize(),$e||Qe){d||(ve=de+J,[0,1,2].forEach(Me=>{Ge[ve*3+Me]=Xe.getComponent(Me),Ke[ve*3+Me]=mt.getComponent(Me)}),Ve[ve*2]=+Qe,Ve[ve*2+1]=J/c),m.copy(B).multiplyScalar(Se),v.addVectors(g,m);for(let Me=0;Me<u;Me++){let Ue=Me*Z+Je;O.addVectors(p.copy(W).multiplyScalar(_e*Math.sin(Ue)),m.copy(B).multiplyScalar(_e*Math.cos(Ue))),L.copy(O).normalize(),m.addVectors(v,O),O.normalize(),ve=nt+Me*ie+J,[0,1,2].forEach(Mt=>{Ge[ve*3+Mt]=m.getComponent(Mt),Ke[ve*3+Mt]=L.getComponent(Mt)});let at=+$e+Math.sin(Ue);Ve[ve*2]=(ot+_e*at)/oe,Ve[ve*2+1]=J/c}}m.addVectors(g,D),ve=pe+me*ie+J,[0,1,2].forEach(Me=>{Ge[ve*3+Me]=m.getComponent(Me),Ke[ve*3+Me]=B.getComponent(Me)}),Ve[ve*2]=(F+me*V)/oe,Ve[ve*2+1]=J/c}}let Re=X+2*u+Ee,[Ze,Ne]=[+d,Re-1];for(let me=Ze;me<=Ne-1;me++){let $e=d&&me===Ne-1;for(let Qe=0;Qe<ie-1;Qe++)y=me*ie+Qe,x=y+1,S=($e?Qe:y)+ie,A=($e?Qe+1:x)+ie,me===0?ke.push(x,A,S):me===Re-2?ke.push(y,x,S):ke.push(y,x,S,x,A,S)}this.setIndex(ke),this.setAttribute("position",new bt(Ge,3)),this.setAttribute("normal",new bt(Ke,3)),this.setAttribute("uv",new bt(Ve,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let t=this.userData.parameters,e=Math.ceil(t.tubularSegments),i=t.radialSegments+1,r=Array.from(this.getIndex().array),n,s,a,o,l=6*(e-1)*t.radialSegments,c=e,h=c===e;for(let u=0;u<t.radialSegments;u++)n=c*i+u,s=n+1,a=(h?u:n)+i,o=(h?u+1:s)+i,r[l++]=n,r[l++]=s,r[l++]=a,r[l++]=s,r[l++]=o,r[l++]=a;return r.length=l,lO.array=r,lO.count=r.length,lO}},l8e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,detail:0,corner:0,cornerSides:4},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,detail:n,corner:s,cornerSides:a}=t.parameters,o=n===0&&s!==0?new Hoe(e*.5,s,a):new Gse(e*.5,n);return o.scale(1,i/e,r/e),Object.assign(o,{userData:{...t,type:"IcosahedronGeometry"}})}},Hoe=class extends gG{constructor(t=1,e=.2,i=4){let r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a="IcosahedronGeometry";super(n,s,a,t,e,i),this.type=a}static fromJSON(t){return new Hoe(t.radius,t.corner,t.cornerSides)}},c8e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){var r;(((r=t.parameters)==null?void 0:r.points)??[]).forEach(n=>{Array.isArray(n)&&(n.x=n[0],n.y=n[1])});let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{points:e,segments:i,verticalSegments:r}=t.parameters,n=new C2;n.moveTo(e[0].x,e[0].y),n.bezierCurveTo(e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y);let s=new Bse(n.extractPoints(r).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...t,type:"LatheGeometry"}})}},th=new st,cO=new Ji,QM=new N,dP=class extends Js{constructor(){super(),this.uuid=Et.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(t){let e=new Bn().getNormalMatrix(t);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(t);for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];n.normal.applyMatrix3(e).normalize();for(let s=0,a=n.vertexNormals.length;s<a;s++)n.vertexNormals[s].applyMatrix3(e).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(t){return th.makeRotationX(t),this.applyMatrix4(th),this}rotateY(t){return th.makeRotationY(t),this.applyMatrix4(th),this}rotateZ(t){return th.makeRotationZ(t),this.applyMatrix4(th),this}translate(t,e,i){return th.makeTranslation(t,e,i),this.applyMatrix4(th),this}scale(t,e,i){return th.makeScale(t,e,i),this.applyMatrix4(th),this}lookAt(t){return cO.lookAt(t),cO.updateMatrix(),this.applyMatrix4(cO.matrix),this}fromBufferGeometry(t){let e=this,i=t.index!==null?t.index:void 0,r=t.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let n=r.position,s=r.normal,a=r.color,o=r.uv,l=r.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let u=0;u<n.count;u++)e.vertices.push(new N().fromBufferAttribute(n,u)),a!==void 0&&e.colors.push(new Xt().fromBufferAttribute(a,u));function c(u,d,f,p){let m=a===void 0?[]:[e.colors[u].clone(),e.colors[d].clone(),e.colors[f].clone()],g=s===void 0?[]:[new N().fromBufferAttribute(s,u),new N().fromBufferAttribute(s,d),new N().fromBufferAttribute(s,f)],v=new qN(u,d,f,g,m,p);e.faces.push(v),o!==void 0&&e.faceVertexUvs[0].push([new ye().fromBufferAttribute(o,u),new ye().fromBufferAttribute(o,d),new ye().fromBufferAttribute(o,f)]),l!==void 0&&e.faceVertexUvs[1].push([new ye().fromBufferAttribute(l,u),new ye().fromBufferAttribute(l,d),new ye().fromBufferAttribute(l,f)])}let h=t.groups;if(h.length>0)for(let u=0;u<h.length;u++){let d=h[u],f=d.start,p=d.count;for(let m=f,g=f+p;m<g;m+=3)i!==void 0?c(i.getX(m),i.getX(m+1),i.getX(m+2),d.materialIndex):c(m,m+1,m+2,d.materialIndex)}else if(i!==void 0)for(let u=0;u<i.count;u+=3)c(i.getX(u),i.getX(u+1),i.getX(u+2));else for(let u=0;u<n.count;u+=3)c(u,u+1,u+2);return this.computeFaceNormals(),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(QM).negate(),this.translate(QM.x,QM.y,QM.z),this}normalize(){this.computeBoundingSphere();let t=this.boundingSphere.center,e=this.boundingSphere.radius,i=e===0?1:1/e,r=new st;return r.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let t=new N,e=new N;for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=this.vertices[n.a],a=this.vertices[n.b],o=this.vertices[n.c];t.subVectors(o,a),e.subVectors(s,a),t.cross(e),t.normalize(),n.normal.copy(t)}}computeVertexNormals(t=!0){let e=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)e[i]=new N;if(t){let i=new N,r=new N;for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c];i.subVectors(c,l),r.subVectors(o,l),i.cross(r),e[a.a].add(i),e[a.b].add(i),e[a.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];e[n.a].add(n.normal),e[n.b].add(n.normal),e[n.c].add(n.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)e[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=n.vertexNormals;s.length===3?(s[0].copy(e[n.a]),s[1].copy(e[n.b]),s[2].copy(e[n.c])):(s[0]=e[n.a].clone(),s[1]=e[n.b].clone(),s[2]=e[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let t=0,e=this.faces.length;t<e;t++){let i=this.faces[t],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let e=0,i=this.faces.length;e<i;e++){let r=this.faces[e];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let n=0,s=r.vertexNormals.length;n<s;n++)r.__originalVertexNormals[n]?r.__originalVertexNormals[n].copy(r.vertexNormals[n]):r.__originalVertexNormals[n]=r.vertexNormals[n].clone()}let t=new dP;t.faces=this.faces;for(let e=0,i=this.morphTargets.length;e<i;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];let n=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(let a=0,o=this.faces.length;a<o;a++){let l=new N,c={a:new N,b:new N,c:new N};n.push(l),s.push(c)}}let r=this.morphNormals[e];t.vertices=this.morphTargets[e].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=r.faceNormals[n],l=r.vertexNormals[n];o.copy(a.normal),l.a.copy(a.vertexNormals[0]),l.b.copy(a.vertexNormals[1]),l.c.copy(a.vertexNormals[2])}}for(let e=0,i=this.faces.length;e<i;e++){let r=this.faces[e];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new _n),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new wo),this.boundingSphere.setFromPoints(this.vertices)}merge(t,e,i=0){if(!(t&&t.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);return}let r,n=this.vertices.length,s=this.vertices,a=t.vertices,o=this.faces,l=t.faces,c=this.colors,h=t.colors;e!==void 0&&(r=new Bn().getNormalMatrix(e));for(let u=0,d=a.length;u<d;u++){let f=a[u].clone();e!==void 0&&f.applyMatrix4(e),s.push(f)}for(let u=0,d=h.length;u<d;u++)c.push(h[u].clone());for(let u=0,d=l.length;u<d;u++){let f=l[u],p,m,g=f.vertexNormals,v=f.vertexColors,y=new qN(f.a+n,f.b+n,f.c+n);y.normal.copy(f.normal),r!==void 0&&y.normal.applyMatrix3(r).normalize();for(let x=0,S=g.length;x<S;x++)p=g[x].clone(),r!==void 0&&p.applyMatrix3(r).normalize(),y.vertexNormals.push(p);y.color.copy(f.color);for(let x=0,S=v.length;x<S;x++)m=v[x],y.vertexColors.push(m.clone());y.materialIndex=f.materialIndex+i,o.push(y)}for(let u=0,d=t.faceVertexUvs.length;u<d;u++){let f=t.faceVertexUvs[u];this.faceVertexUvs[u]===void 0&&(this.faceVertexUvs[u]=[]);for(let p=0,m=f.length;p<m;p++){let g=f[p],v=[];for(let y=0,x=g.length;y<x;y++)v.push(g[y].clone());this.faceVertexUvs[u].push(v)}}}mergeMesh(t){if(!(t&&t.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t);return}t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)}mergeVertices(t=4){let e={},i=[],r=[],n=Math.pow(10,t);for(let o=0,l=this.vertices.length;o<l;o++){let c=this.vertices[o],h=Math.round(c.x*n)+"_"+Math.round(c.y*n)+"_"+Math.round(c.z*n);e[h]===void 0?(e[h]=o,i.push(this.vertices[o]),r[o]=i.length-1):r[o]=r[e[h]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let c=this.faces[o];c.a=r[c.a],c.b=r[c.b],c.c=r[c.c];let h=[c.a,c.b,c.c];for(let u=0;u<3;u++)if(h[u]===h[(u+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let l=s[o];this.faces.splice(l,1);for(let c=0,h=this.faceVertexUvs.length;c<h;c++)this.faceVertexUvs[c].splice(l,1)}let a=this.vertices.length-i.length;return this.vertices=i,a}setFromPoints(t){this.vertices=[];for(let e=0,i=t.length;e<i;e++){let r=t[e];this.vertices.push(new N(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let t=this.faces,e=t.length;for(let o=0;o<e;o++)t[o]._id=o;function i(o,l){return o.materialIndex-l.materialIndex}t.sort(i);let r=this.faceVertexUvs[0],n=this.faceVertexUvs[1],s,a;r&&r.length===e&&(s=[]),n&&n.length===e&&(a=[]);for(let o=0;o<e;o++){let l=t[o]._id;s&&s.push(r[l]),a&&a.push(n[l])}s&&(this.faceVertexUvs[0]=s),a&&(this.faceVertexUvs[1]=a)}toJSON(){let t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),this.parameters!==void 0){let f=this.parameters;for(let p in f)f[p]!==void 0&&(t[p]=f[p]);return t}let e=[];for(let f=0;f<this.vertices.length;f++){let p=this.vertices[f];e.push(p.x,p.y,p.z)}let i=[],r=[],n={},s=[],a={},o=[],l={};for(let f=0;f<this.faces.length;f++){let p=this.faces[f],m=!0,g=!1,v=this.faceVertexUvs[0][f]!==void 0,y=p.normal.length()>0,x=p.vertexNormals.length>0,S=p.color.r!==1||p.color.g!==1||p.color.b!==1,A=p.vertexColors.length>0,_=0;if(_=c(_,0,0),_=c(_,1,m),_=c(_,2,g),_=c(_,3,v),_=c(_,4,y),_=c(_,5,x),_=c(_,6,S),_=c(_,7,A),i.push(_),i.push(p.a,p.b,p.c),i.push(p.materialIndex),v){let M=this.faceVertexUvs[0][f];i.push(d(M[0]),d(M[1]),d(M[2]))}if(y&&i.push(h(p.normal)),x){let M=p.vertexNormals;i.push(h(M[0]),h(M[1]),h(M[2]))}if(S&&i.push(u(p.color)),A){let M=p.vertexColors;i.push(u(M[0]),u(M[1]),u(M[2]))}}function c(f,p,m){return m?f|1<<p:f&~(1<<p)}function h(f){let p=f.x.toString()+f.y.toString()+f.z.toString();return n[p]!==void 0||(n[p]=r.length/3,r.push(f.x,f.y,f.z)),n[p]}function u(f){let p=f.r.toString()+f.g.toString()+f.b.toString();return a[p]!==void 0||(a[p]=s.length,s.push(f.getHex())),a[p]}function d(f){let p=f.x.toString()+f.y.toString();return l[p]!==void 0||(l[p]=o.length/2,o.push(f.x,f.y)),l[p]}return t.data={},t.data.vertices=e,t.data.normals=r,s.length>0&&(t.data.colors=s),o.length>0&&(t.data.uvs=[o]),t.data.faces=i,t}clone(){return new dP().copy(this)}copy(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;let e=t.vertices;for(let u=0,d=e.length;u<d;u++)this.vertices.push(e[u].clone());let i=t.colors;for(let u=0,d=i.length;u<d;u++)this.colors.push(i[u].clone());let r=t.faces;for(let u=0,d=r.length;u<d;u++)this.faces.push(r[u].clone());for(let u=0,d=t.faceVertexUvs.length;u<d;u++){let f=t.faceVertexUvs[u];this.faceVertexUvs[u]===void 0&&(this.faceVertexUvs[u]=[]);for(let p=0,m=f.length;p<m;p++){let g=f[p],v=[];for(let y=0,x=g.length;y<x;y++){let S=g[y];v.push(S.clone())}this.faceVertexUvs[u].push(v)}}let n=t.morphTargets;for(let u=0,d=n.length;u<d;u++){let f={};if(f.name=n[u].name,n[u].vertices!==void 0){f.vertices=[];for(let p=0,m=n[u].vertices.length;p<m;p++)f.vertices.push(n[u].vertices[p].clone())}if(n[u].normals!==void 0){f.normals=[];for(let p=0,m=n[u].normals.length;p<m;p++)f.normals.push(n[u].normals[p].clone())}this.morphTargets.push(f)}let s=t.morphNormals;for(let u=0,d=s.length;u<d;u++){let f={};if(s[u].vertexNormals!==void 0){f.vertexNormals=[];for(let p=0,m=s[u].vertexNormals.length;p<m;p++){let g=s[u].vertexNormals[p],v={};v.a=g.a.clone(),v.b=g.b.clone(),v.c=g.c.clone(),f.vertexNormals.push(v)}}if(s[u].faceNormals!==void 0){f.faceNormals=[];for(let p=0,m=s[u].faceNormals.length;p<m;p++)f.faceNormals.push(s[u].faceNormals[p].clone())}this.morphNormals.push(f)}let a=t.skinWeights;for(let u=0,d=a.length;u<d;u++)this.skinWeights.push(a[u].clone());let o=t.skinIndices;for(let u=0,d=o.length;u<d;u++)this.skinIndices.push(o[u].clone());let l=t.lineDistances;for(let u=0,d=l.length;u<d;u++)this.lineDistances.push(l[u]);let c=t.boundingBox;c!==null&&(this.boundingBox=c.clone());let h=t.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}toBufferGeometry(){let t=new h8e().fromGeometry(this),e=new Nt,i=new Float32Array(t.vertices.length*3);if(e.setAttribute("position",$M.call(new Yt(i,3),t.vertices)),t.normals.length>0){let r=new Float32Array(t.normals.length*3);e.setAttribute("normal",$M.call(new Yt(r,3),t.normals))}if(t.colors.length>0){let r=new Float32Array(t.colors.length*3);e.setAttribute("color",kq.call(new Yt(r,3),t.colors))}if(t.uvs.length>0){let r=new Float32Array(t.uvs.length*2);e.setAttribute("uv",Nq.call(new Yt(r,2),t.uvs))}if(t.uvs2.length>0){let r=new Float32Array(t.uvs2.length*2);e.setAttribute("uv2",Nq.call(new Yt(r,2),t.uvs2))}e.groups=t.groups;for(let r in t.morphTargets){let n=[],s=t.morphTargets[r];for(let a=0,o=s.length;a<o;a++){let l=s[a],c=new bt(l.data.length*3,3);c.name=l.name,n.push($M.call(c,l.data))}e.morphAttributes[r]=n}if(t.skinIndices.length>0){let r=new bt(t.skinIndices.length*4,4);e.setAttribute("skinIndex",Uq.call(r,t.skinIndices))}if(t.skinWeights.length>0){let r=new bt(t.skinWeights.length*4,4);e.setAttribute("skinWeight",Uq.call(r,t.skinWeights))}return t.boundingSphere!==null&&(e.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(e.boundingBox=t.boundingBox.clone()),e}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(t){let e=new Nt,i=t.geometry;if(t.isPoints||t.isLine){let r=new bt(i.vertices.length*3,3),n=new bt(i.colors.length*3,3);if(e.setAttribute("position",$M.call(r,i.vertices)),e.setAttribute("color",kq.call(n,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let s=new bt(i.lineDistances.length,1);e.setAttribute("lineDistance",u8e.call(s,i.lineDistances))}i.boundingSphere!==null&&(e.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(e.boundingBox=i.boundingBox.clone())}else t.isMesh&&(e=i.toBufferGeometry());return e}};dP.prototype.isGeometry=!0;var h8e=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(t){let e=[],i,r,n,s=t.faces;for(r=0;r<s.length;r++){let a=s[r];a.materialIndex!==n&&(n=a.materialIndex,i!==void 0&&(i.count=r*3-i.start,e.push(i)),i={start:r*3,materialIndex:n})}i!==void 0&&(i.count=r*3-i.start,e.push(i)),this.groups=e}fromGeometry(t){let e=t.faces,i=t.vertices,r=t.faceVertexUvs,n=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,a=t.morphTargets,o=a.length,l;if(o>0){l=[];for(let g=0;g<o;g++)l[g]={name:a[g].name,data:[]};this.morphTargets.position=l}let c=t.morphNormals,h=c.length,u;if(h>0){u=[];for(let g=0;g<h;g++)u[g]={name:c[g].name,data:[]};this.morphTargets.normal=u}let d=t.skinIndices,f=t.skinWeights,p=d.length===i.length,m=f.length===i.length;i.length>0&&e.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<e.length;g++){let v=e[g];this.vertices.push(i[v.a],i[v.b],i[v.c]);let y=v.vertexNormals;if(y.length===3)this.normals.push(y[0],y[1],y[2]);else{let S=v.normal;this.normals.push(S,S,S)}let x=v.vertexColors;if(x.length===3)this.colors.push(x[0],x[1],x[2]);else{let S=v.color;this.colors.push(S,S,S)}if(n===!0){let S=r[0][g];S!==void 0?this.uvs.push(S[0],S[1],S[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new ye,new ye,new ye))}if(s===!0){let S=r[1][g];S!==void 0?this.uvs2.push(S[0],S[1],S[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new ye,new ye,new ye))}for(let S=0;S<o;S++){let A=a[S].vertices;l[S].data.push(A[v.a],A[v.b],A[v.c])}for(let S=0;S<h;S++){let A=c[S].vertexNormals[g];u[S].data.push(A.a,A.b,A.c)}p&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),m&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),this}},qN=class{constructor(t,e,i,r,n,s=0){this.a=t,this.b=e,this.c=i,this.normal=r&&r.isVector3?r:new N,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new Xt,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}};function u8e(t){return this.array.set(t),this}function kq(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new Xt),e[i++]=s.r,e[i++]=s.g,e[i++]=s.b}return this}function Nq(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new ye),e[i++]=s.x,e[i++]=s.y}return this}function $M(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new N),e[i++]=s.x,e[i++]=s.y,e[i++]=s.z}return this}function Uq(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new si),e[i++]=s.x,e[i++]=s.y,e[i++]=s.z,e[i++]=s.w}return this}var d8e=["a","b","c"];function f8e(t,e){switch(e){case"c":return t.c;case"b":return t.b;case"a":default:return t.a}}function hO(t,e,i){let r=Math.min(t,e),n=Math.max(t,e),s=r+"_"+n;return i.get(s)}function uO(t,e,i,r,n,s){let a=Math.min(t,e),o=Math.max(t,e),l=a+"_"+o,c;if(r.has(l))c=r.get(l);else{let h=i[a],u=i[o];c={a:h,b:u,newEdge:null,faces:[]},r.set(l,c)}c.faces.push(n),s[t].edges.push(c),s[e].edges.push(c)}function p8e(t,e,i,r){let n,s,a;for(n=0,s=t.length;n<s;n++)i[n]={edges:[]};for(n=0,s=e.length;n<s;n++)a=e[n],uO(a.a,a.b,t,r,a,i),uO(a.b,a.c,t,r,a,i),uO(a.c,a.a,t,r,a,i)}function JM(t,e,i,r,n){t.push(new qN(e,i,r,void 0,void 0,n))}function gv(t,e){return Math.abs(e-t)/2+Math.min(t,e)}function ZM(t,e,i,r){t.push([e.clone(),i.clone(),r.clone()])}var m8e=class{constructor(t=1){this.subdivisions=t}modify(t){t instanceof Nt?t=new dP().fromBufferGeometry(t):t=t.clone(),t.mergeVertices();let e=this.subdivisions;for(;e-- >0;)this._smooth(t);return t.computeFaceNormals(),t.computeVertexNormals(),t}_smooth(t){let e=new N,i,r,n,s,a,o=t.vertices,l=t.faces,c=t.faceVertexUvs[0],h=c!==void 0&&c.length>0,u=[],d=new Map;p8e(o,l,u,d);let f=[],p,m,g,v,y,x,S;for(let Ae of Array.from(d.keys())){for(m=d.get(Ae),g=new N,y=3/8,x=1/8,S=m.faces.length,S!=2&&(y=.5,x=0,S!=1),g.addVectors(m.a,m.b).multiplyScalar(y),e.set(0,0,0),s=0;s<S;s++){for(v=m.faces[s],a=0;a<3&&(p=o[f8e(v,d8e[a])],!(p!==m.a&&p!==m.b));a++);p&&e.add(p)}e.multiplyScalar(x),g.add(e),m.newEdge=f.length,f.push(g)}let A,_,M,E,T,C,D,B=[];for(r=0,n=o.length;r<n;r++){for(C=o[r],T=u[r].edges,i=T.length,i==3?A=3/16:i>3&&(A=3/(8*i)),_=1-i*Number(A),M=A,i<=2&&(i==2?(_=3/4,M=1/8):i==1||i==0),D=C.clone().multiplyScalar(_),e.set(0,0,0),s=0;s<i;s++)E=T[s],p=E.a!==C?E.a:E.b,e.add(p);e.multiplyScalar(Number(M)),D.add(e),B.push(D)}let O=B.concat(f),L=B.length,H,q,W,I=[],z=[],U,X,Q,re,ie=new ye,ce=new ye,Z=new ye;for(r=0,n=l.length;r<n;r++)v=l[r],H=Number(hO(v.a,v.b,d).newEdge)+L,q=Number(hO(v.b,v.c,d).newEdge)+L,W=Number(hO(v.c,v.a,d).newEdge)+L,JM(I,H,q,W,v.materialIndex),JM(I,v.a,H,W,v.materialIndex),JM(I,v.b,q,H,v.materialIndex),JM(I,v.c,W,q,v.materialIndex),h&&(U=c[r],X=U[0],Q=U[1],re=U[2],ie.set(gv(X.x,Q.x),gv(X.y,Q.y)),ce.set(gv(Q.x,re.x),gv(Q.y,re.y)),Z.set(gv(X.x,re.x),gv(X.y,re.y)),ZM(z,ie,ce,Z),ZM(z,X,ie,Z),ZM(z,Q,ce,ie),ZM(z,re,Z,ce));t.vertices=O,t.faces=I,h&&(t.faceVertexUvs[0]=z)}},Xn=new N,g8e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=t.geometry??(e==null?void 0:e.geometry)??new Nt().copy(new Bc(100,100,100)),r;e===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(Xn),r={width:Xn.x,height:Xn.y,depth:Xn.z,subdivisions:0}):r=e.parameters;let n={...r,...t.parameters};return{parameters:{width:Math.abs(n.width),height:Math.abs(n.height),depth:Math.abs(n.depth),subdivisions:Math.abs(n.subdivisions)},geometry:i}}static build(t){let{width:e,height:i,depth:r,subdivisions:n}=t.parameters,s=t.geometry??new Nt().copy(new Bc(100,100,100)),a=s.userData.parameters;a===void 0?(s.computeBoundingBox(),s.boundingBox.getSize(Xn)):Xn.set(a.width,a.height,a.depth),(e!==Xn.x||i!==Xn.y||r!==Xn.z)&&s.scale(Xn.x===0?1:e/Xn.x,Xn.y===0?1:i/Xn.y,Xn.z===0?1:r/Xn.z);let o=s.originalGeometry;try{n>0?(o===void 0||(a==null?void 0:a.subdivisions)!==n)&&(o===void 0&&(o=s),s=new m8e(n).modify(o).toBufferGeometry()):(o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals())}catch{o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals()}return o!==void 0&&Object.assign(s,{originalGeometry:o}),delete t.geometry,Object.assign(s,{userData:{...t,type:"NonParametricGeometry"}})}static loadFromUrl(t,e,i){new Qse(i).load(t,r=>{let n=this.normalizeInputs({geometry:r});r.boundingBox.getSize(Xn);let s=100/Xn.x;Object.assign(n.parameters,{width:100,height:Xn.y*s,depth:Xn.z*s}),e(this.build(n))})}},joe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},t.parameters);return{shape:t.shape&&t.shape instanceof an?t.shape:new an,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i,spikes:r,cornerRadius:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=t.parameters,l=t.shape,c=e*.5,h=i*.5,u=0,d=0,f=2*Math.PI/r;for(let m=0;m<r;m++){let g=f*m,v=u+Math.sin(g)*c,y=d+Math.cos(g)*h;l.addPoint(l.createPoint(v,y))}l.isClosed=!0;for(let m=0,g=l.points.length;m<g;m++)l.points[m].roundness=n;l.roundness=n,l.update();let p=o0.create({shape:l,parameters:{roundness:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(p,{userData:{...t,type:"PolygonGeometry"}})}},v8e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,radialSegments:n,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=t.parameters,c=new x8e(e*.5,i,n,s,a,o,l);return c.scale(1,1,r/e),Object.assign(c,{userData:{...t,type:"PyramidGeometry"}})}};function fb(t,e,i){i.x=t.x*e.x,i.y=t.y,i.z=t.x*e.y}function dO(t,e,i,r,n,s){let a=e.clone().sub(t),o=i.clone().sub(t),l=a.angleTo(o);if(a.normalize(),o.normalize(),r===n){let c=a.add(o).normalize();s.copy(t).addScaledVector(c,r/Math.sin(l/2))}else{let c=a.angleTo(o);s.copy(t),s.addScaledVector(a,n/Math.sin(c)),s.addScaledVector(o,r/Math.sin(c))}}function y8e(t,e,i){let r=t.clone().sub(e),n=i.clone().sub(e);return r.projectOnVector(n),r.add(e)}var x8e=class extends Nt{constructor(t=.5,e=1,i=4,r=1,n=!1,s=0,a=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),a=Math.floor(a);let o=[],l=[],c=[],h=[],u=0,d=e/2,f=Math.PI/i,p=t*Math.cos(Math.PI/i),m=2*Math.PI/i,g=(i-2)*Math.PI/i,v=Math.PI-g,y=new N(0,-d,0),x=new N(0,d,0),S=new ye(t,-d),A=new ye(p,-d),_=new ye(0,x.y).sub(A),M=new ye(0,x.y).sub(S),E=new ye(_.y,-_.x).normalize(),T=new ye(M.y,-M.x).normalize(),C=t*Math.cos(Math.PI/i)*Math.tan((Math.PI-_.angle())/2)-1e-8;s=Math.min(s,C);let D;{let W=new N(E.x,E.y,0),I=new N(Math.cos(m)*W.x,W.y,Math.sin(m)*W.x);D=W.angleTo(I)}let B=s/Math.tan((Math.PI-_.angle())/2),O=s/Math.tan((Math.PI-D)/2),L=new N;if(!n){l.push(y.x,y.y,y.z),c.push(0,-1,0),h.push(0,0);let W=u++,I=[],z=S.clone(),U=B/Math.cos(Math.PI/i);z.x-=U;for(let X=0;X<i;X++){let Q=X/i*Math.PI*2+f,re=new ye(Math.sin(Q),Math.cos(Q));fb(z,re,L),l.push(L.x,L.y,L.z),c.push(0,-1,0),h.push(0,0),I.push(u++)}for(let X=0;X<I.length;X++)o.push(I[X],W,I[(X+1)%I.length])}{let W=new N,I=new N,z=new N,U=new N,X=new N,Q=new N;for(let re=0;re<i;re++){let ie=re/i*Math.PI*2+f,ce=(re+.5)/i*Math.PI*2+f,Z=(re+1)/i*Math.PI*2+f,Ae=new ye(Math.sin(ie),Math.cos(ie)),Se=new ye(Math.sin(ce),Math.cos(ce)),_e=new ye(Math.sin(Z),Math.cos(Z));fb(S,Ae,I),fb(S,_e,z),fb(E,Se,W),dO(x,I,z,O,O,U),l.push(U.x,U.y,U.z),dO(I,x,z,O,B,X),l.push(X.x,X.y,X.z),dO(z,I,x,B,O,Q),l.push(Q.x,Q.y,Q.z),c.push(W.x,W.y,W.z),c.push(W.x,W.y,W.z),c.push(W.x,W.y,W.z),h.push(0,0),h.push(0,0),h.push(0,0);let ve=u++,Ee=u++,fe=u++;if(o.push(ve,Ee,fe),s>0){{let Le=I.clone().add(z).multiplyScalar(.5),Ge=x.clone().sub(Le).normalize(),Ke=y.clone().sub(Le).normalize().add(Ge).normalize().multiplyScalar(-1),Ve=Q.clone().sub(X);H(Le,Ve,Ke,_.angle())}let pe,Ie;{let Le=new N;fb(T,_e,Le);let Ge=Q.clone().add(U).multiplyScalar(.5);Ge=y8e(Ge,z,x);let Ke=Q.clone().sub(U);[pe,Ie]=H(Ge,Ke,Le,D,U.y)}{let Le=pe,Ge=Le.clone().setY(0).normalize(),Ke=new N(0,-1,0),Ve=Ge.clone().cross(Ke);q(Le,Ge,Ke,Ve)}{let Le=_.angle(),Ge=Math.PI-Le,Ke=x.clone();Ke.y-=s/Math.sin(Le-Math.PI/2);let Ve=new N,ke=[];for(let dt=0;dt<a;dt++){let V=[],F=Math.PI/2-Ge*dt/a,oe=Math.cos(F),Ce=Math.sin(F),K=ce;for(let Re=0;Re<=dt;Re++){let Ze=Math.cos(K),Ne=Math.sin(K);W.x=oe*Ne,W.y=Ce,W.z=oe*Ze,Ve.copy(Ke).addScaledVector(W,s),l.push(Ve.x,Ve.y,Ve.z),c.push(W.x,W.y,W.z),h.push(0,0),V.push(u++),K+=Math.PI*2/dt/i}ke.push(V)}Ie.reverse(),ke.push(Ie);let ut=ke.length-1;for(let dt=0;dt<ut;dt++){let V=ke[dt],F=ke[dt+1],oe=V.length-1;o.push(F[1],V[0],F[0]);for(let Ce=1;Ce<=oe;Ce++)o.push(V[Ce],V[Ce-1],F[Ce]),o.push(F[Ce+1],V[Ce],F[Ce])}}}}}this.setIndex(o),this.setAttribute("position",new bt(l,3)),this.setAttribute("normal",new bt(c,3)),this.setAttribute("uv",new bt(h,2));function H(W,I,z,U,X){let Q=-U/2,re=(Math.PI-U)/2,ie=I.clone().normalize().cross(z);W.addScaledVector(z,-s/Math.sin(re));let ce=new N,Z=new N,Ae=1,Se=u,_e=[];for(let ve=0;ve<=a;ve++){let Ee=Q+ve/a*U;Z.set(0,0,0),Z.addScaledVector(ie,Math.sin(Ee)),Z.addScaledVector(z,Math.cos(Ee));for(let fe=0;fe<=Ae;fe++){let pe=fe/Ae-.5;if(ce.copy(W),ce.addScaledVector(I,pe),ce.addScaledVector(Z,s),X!=null){let Ie=Math.max(0,ce.y-X);ce.addScaledVector(I,-Ie/I.y)}l.push(ce.x,ce.y,ce.z),c.push(Z.x,Z.y,Z.z),h.push(0,0),fe===0&&_e.push(u),u++}}for(let ve=0;ve<a;ve++)for(let Ee=0;Ee<Ae;Ee++){let fe=Se+Ee+(Ae+1)*ve,pe=fe+(Ae+1),Ie=pe+1,Le=fe+1;o.push(fe,pe,Le),o.push(pe,Ie,Le)}return[W.clone().addScaledVector(I,.5),_e]}function q(W,I,z,U){let X=Math.PI/2,Q=M.angle()-X,re=[],ie=new N,ce=new N;for(let Ae=0;Ae<=a;Ae++){let Se=[],_e=Ae/a;for(let ve=0;ve<=Ae;ve++){let Ee=((Ae?ve/Ae:0)-.5)*v,fe=Math.cos(Ee),pe=Math.sin(Ee),Ie=Math.atan(Math.tan(Q)*fe),Le=(X+Ie)*_e,Ge=Math.cos(Le),Ke=Math.sin(Le);ie.set(0,0,0),ie.addScaledVector(I,Ke*fe),ie.addScaledVector(z,Ge),ie.addScaledVector(U,Ke*pe),ce.copy(W).addScaledVector(ie,s),l.push(ce.x,ce.y,ce.z),c.push(ie.x,ie.y,ie.z),h.push(0,0),Se.push(u++)}re.push(Se)}let Z=re.length-1;for(let Ae=0;Ae<Z;Ae++){let Se=re[Ae],_e=re[Ae+1],ve=Se.length-1;o.push(Se[0],_e[1],_e[0]);for(let Ee=1;Ee<=ve;Ee++)o.push(Se[Ee-1],Se[Ee],_e[Ee]),o.push(Se[Ee],_e[Ee+1],_e[Ee])}}}},SG=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters),r=Object.assign((e==null?void 0:e.ui)??{enabledIndieCorners:!1},t.ui);return{shape:t.shape&&t.shape instanceof an?t.shape:new an,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(t){let e=t.shape,{width:i,height:r,cornerRadius:n,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=t.parameters,c={x:i*.5,y:r*.5},h={x:-c.x,y:-c.y},u={x:c.x,y:c.y};function d(S,A,_){return A>i&&_>r?Math.min(S*i/A,S*r/_):A>i?S*i/A:_>r?S*r/_:S}let f=[];f[0]=n[0]===0?0:d(n[0],n[0]+n[3],n[0]+n[1]),f[1]=n[1]===0?0:d(n[1],n[1]+n[2],n[1]+n[0]),f[2]=n[2]===0?0:d(n[2],n[2]+n[1],n[2]+n[3]),f[3]=n[3]===0?0:d(n[3],n[3]+n[0],n[3]+n[2]);let p=h.x,m=u.x,g=u.y,v=h.y;e.addPoint(e.createPoint(p,g)),e.addPoint(e.createPoint(m,g)),e.addPoint(e.createPoint(m,v)),e.addPoint(e.createPoint(p,v)),e.isClosed=!0;let y=!0;for(let S=0,A=e.points.length;S<A;S++)e.points[S].roundness=f[S],S>0&&f[S]!==f[S-1]&&(y=!1);y&&(e.roundness=f[0]),e.useCubicForRoundedCorners=s!==1,e.update();let x=o0.create({shape:e,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(x,{userData:{...t,type:"RectangleGeometry"}})}},b8e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},t.parameters);return i.thetaLength=Et.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e=100,height:i=e,depth:r=e,widthSegments:n=64,heightSegments:s=64,phiStart:a,phiLength:o,thetaStart:l,thetaLength:c}=t.parameters,h;return c===0?(h=new Nt,h.setAttribute("position",new bt([],3))):h=new Ty(.5*e,n,s,a,o,l,c*Et.DEG2RAD),h.scale(1,i/e,r/e),Object.assign(h,{userData:{...t,type:"SphereGeometry"}})}},w8e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(t){let{width:e=100,height:i=e,widthSegments:r=8,heightSegments:n=8}=t.parameters,s=new Vh(e,i,r,n);return s.scale(1,1,1),Object.assign(s,{userData:{...t,type:"PlaneGeometry"}})}},S8e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,angle:n,cornerRadius:s,cornerSegments:a}=t.parameters,o=new _8e(e,i,r,n,s,a);return Object.assign(o,{userData:{...t,type:"BackdropGeometry"}})}},_8e=class extends Nt{constructor(t=1,e=1,i=1,r=90,n=10,s=24){super(),this.type="BackdropGeometry";let a=[],o=[],l=[],c=.001;n==0&&(s=1),s=Math.max(1,Math.floor(s)),n=Math.min(n,100),r=Math.min(180-c,r),r*=Math.PI/180;let h=[],u=Math.PI/2,d=(Ae=0,Se=0,_e=0)=>new N(Ae,Se,_e),f=d(),p=d(),[m,g,v]=[e/2,t/2,i/2],y=-g,x=+g,[S,A,_]=[d(y,-m,+v),d(y,-m,-v),d(y,+m,-v)],M=(Ae,Se=!1)=>Math.sin(Ae-Math.PI/(1+ +Se)),E=(Ae,Se=!1)=>Math.cos(Ae-Math.PI/(1+ +Se));_.y=Math.sin(r)*e-m;let T=Math.cos(r)*e-v,C=S.z-c;r<=u?(_.z=Math.min(T,C),_.z==C&&(_.y-=(T-C)/Math.tan(u-r))):A.z=Math.min(A.z-T-v,S.z-c),f.subVectors(S,A),p.subVectors(_,A);let D=Math.min(f.length(),p.length())*n/100,B=D*Math.tan(r/2),O=D/Math.cos(r/2),L=f.clone().normalize().add(p.normalize()).setLength(O).add(A);f.set(0,M(r,!0),E(r,!0)),h.push([_,f.clone()]);let H=(Math.PI-r)/s;for(let Ae=0;Ae<=s;Ae++){let Se=u+r+Ae*H;f.set(0,Math.sin(Se)*B,Math.cos(Se)*B),f.add(L),p.set(0,M(Se),E(Se)),h.push([f.clone(),p.clone()])}h.push([S,d(0,1,0)]);let q=Math.sin(H/2)*B*2,W=h.length-1,I=h[0][0].distanceTo(h[1][0]),z=h[W-1][0].distanceTo(h[W][0]),U=I+q*s+z;h[0].push(1);for(let Ae=0;Ae<=s;Ae++)h[Ae+1].push(1-(I+Ae*q)/U);h[W].push(0);let[X,Q,re]=h[0],ie,ce,Z;for(let Ae=1;Ae<h.length;Ae++)[ie,ce,Z]=h[Ae],a.push(y,X.y,X.z,y,ie.y,ie.z,x,X.y,X.z,x,X.y,X.z,y,ie.y,ie.z,x,ie.y,ie.z),o.push(0,Q.y,Q.z,0,ce.y,ce.z,0,Q.y,Q.z,0,Q.y,Q.z,0,ce.y,ce.z,0,ce.y,ce.z),l.push(0,re,0,Z,1,re,1,re,0,Z,1,Z),[X,Q,re]=[ie,ce,Z];this.setAttribute("position",new bt(a,3)),this.setAttribute("normal",new bt(o,3)),this.setAttribute("uv",new bt(l,2))}},Woe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters);return{shape:t.shape&&t.shape instanceof an?t.shape:new an,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i,innerRadiusPercent:r,spikes:n,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=t.parameters,h=t.shape,u=e*.5,d=i*.5,f=0,p=0,m=a*Math.PI/360/n,g=Math.PI/2*3*-1,v=u*r/100,y=d*r/100;if(n===3&&r===50){m=2*Math.PI/n;for(let S=0;S<n;S++){let A=m*S,_=f+Math.sin(A)*u,M=p+Math.cos(A)*d;h.addPoint(h.createPoint(_,M))}}else for(let S=0;S<n;S++){let A=f+Math.cos(g)*u,_=p+Math.sin(g)*d;h.addPoint(h.createPoint(A,_)),g+=m,A=f+Math.cos(g)*v,_=p+Math.sin(g)*y,h.addPoint(h.createPoint(A,_)),g+=m}h.isClosed=!0;for(let S=0,A=h.points.length;S<A;S++)h.points[S].roundness=s;h.roundness=s,h.update();let x=o0.create({shape:h,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(x,{userData:{...t,type:"StarGeometry"}})}},A8e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i}=t.parameters,r=new Vh(e,i);return Object.assign(r,{userData:{...t,type:"TextFrameGeometry"}})}},E8e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},t.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width);i.shapeBlendNode&&(n=r);let s=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:n,depth:s})}}static build(t){let{width:e,height:i,depth:r,radialSegments:n,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=t.parameters,c=M8e(e,i,r,e*.5,a,s,0,0,n,o,l);return c.scale(1,i/e,1),Object.assign(c,{userData:{...t,type:"TorusGeometry"}})}};function M8e(t,e,i,r,n,s,a,o,l,c,h){[e,i]=[i,e],a=e/2;let u=Et.clamp(n/360,0,1);if(u===0){let d=new Nt;return d.setAttribute("position",new bt([],3)),d}return u===1&&(c=0),new Voe(!0,t,e,i,r,u,s,a,o,l,c,h)}var T8e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(t){let{width:e,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a}=t.parameters,o=e*.5;o!==i&&(o-=i);let l=new Hse(o,i,r,n,s,a);return Object.assign(l,{userData:{...t,type:"TorusKnotGeometry"}})}},C8e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},t.parameters);return{shape:t.shape&&t.shape instanceof an?t.shape:new an,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e=100,height:i,cornerRadius:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=t.parameters,l=t.shape,c=e*.5,h=i*.5;o?(l.addPoint(l.createPoint(-c,h)),l.addPoint(l.createPoint(c,-h)),l.addPoint(l.createPoint(-c,-h))):(l.addPoint(l.createPoint(0,h)),l.addPoint(l.createPoint(c,-h)),l.addPoint(l.createPoint(-c,-h))),l.isClosed=!0;for(let d=0,f=l.points.length;d<f;d++)l.points[d].roundness=r;l.roundness=r,l.update();let u=o0.create({shape:l,parameters:{roundness:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(u,{userData:{...t,type:"TriangleGeometry"}})}};function P8e(t,e){let i=2*Math.PI;return(t%i+i)%i===(e%i+i)%i}function D8e(t){return/^(rgba)?\(\s*(\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(t.toLowerCase())}function R8e(t,e,i){let r,n,s,a=Math.floor(t*6),o=t*6-a,l=i*(1-e),c=i*(1-o*e),h=i*(1-(1-o)*e);switch(a%6){case 0:r=i,n=h,s=l;break;case 1:r=c,n=i,s=l;break;case 2:r=l,n=i,s=h;break;case 3:r=l,n=c,s=i;break;case 4:r=h,n=l,s=i;break;case 5:default:r=i,n=l,s=c;break}return{r:r*255,g:n*255,b:s*255}}function I8e(t,e,i){t/=255,e/=255,i/=255;let r=Math.max(t,e,i),n=Math.min(t,e,i),s=r,a=r-n,o=r==0?0:a/r,l;if(r==n)l=0;else{switch(r){case t:l=(e-i)/a+(e<i?6:0);break;case e:l=(i-t)/a+2;break;case i:default:l=(t-e)/a+4;break}l/=6}return{h:l,s:o,v:s}}function L8e(t){return t=Math.floor(t),{r:t>>16&255,g:t>>8&255,b:t&255}}function O8e(t,e,i){return(t<<16)+(e<<8)+i}function B8e(t,e,i){return t=Math.round(t),e=Math.round(e),i=Math.round(i),"#"+[t,e,i].map(r=>r.toString(16).padStart(2,"0")).join("").toUpperCase()}function F8e(t){let e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,(r,n,s,a)=>String(n+n+s+s+a+a));let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}var k8e={parseRgba:D8e,hsvToRgb:R8e,rgbToHsv:I8e,hexToRgb:L8e,rgbToHex:O8e,rgbToHexString:B8e,hexStringToRgb:F8e},N8e=class{add(t,e,i){if(typeof arguments[0]!="string")for(let r in arguments[0])this.add(r,arguments[0][r],arguments[1]);else(Array.isArray(t)?t:[t]).forEach(function(r){this[r]=this[r]||[],e&&this[r][i?"unshift":"push"](e)},this)}run(t,e){this[t]=this[t]||[],this[t].forEach(function(i){i.call(e&&e.context?e.context:e,e)})}},U8e=class{constructor(t){this.jsep=t,this.registered={}}register(...t){t.forEach(e=>{if(typeof e!="object"||!e.name||!e.init)throw new Error("Invalid JSEP plugin format");this.registered[e.name]||(e.init(this.jsep),this.registered[e.name]=e)})}},Ye=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+Ye.version}static addUnaryOp(t){return Ye.max_unop_len=Math.max(t.length,Ye.max_unop_len),Ye.unary_ops[t]=1,Ye}static addBinaryOp(t,e,i){return Ye.max_binop_len=Math.max(t.length,Ye.max_binop_len),Ye.binary_ops[t]=e,i?Ye.right_associative.add(t):Ye.right_associative.delete(t),Ye}static addIdentifierChar(t){return Ye.additional_identifier_chars.add(t),Ye}static addLiteral(t,e){return Ye.literals[t]=e,Ye}static removeUnaryOp(t){return delete Ye.unary_ops[t],t.length===Ye.max_unop_len&&(Ye.max_unop_len=Ye.getMaxKeyLen(Ye.unary_ops)),Ye}static removeAllUnaryOps(){return Ye.unary_ops={},Ye.max_unop_len=0,Ye}static removeIdentifierChar(t){return Ye.additional_identifier_chars.delete(t),Ye}static removeBinaryOp(t){return delete Ye.binary_ops[t],t.length===Ye.max_binop_len&&(Ye.max_binop_len=Ye.getMaxKeyLen(Ye.binary_ops)),Ye.right_associative.delete(t),Ye}static removeAllBinaryOps(){return Ye.binary_ops={},Ye.max_binop_len=0,Ye}static removeLiteral(t){return delete Ye.literals[t],Ye}static removeAllLiterals(){return Ye.literals={},Ye}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(t){this.expr=t,this.index=0}static parse(t){return new Ye(t).parse()}static getMaxKeyLen(t){return Math.max(0,...Object.keys(t).map(e=>e.length))}static isDecimalDigit(t){return t>=48&&t<=57}static binaryPrecedence(t){return Ye.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!Ye.binary_ops[String.fromCharCode(t)]||Ye.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return Ye.isIdentifierStart(t)||Ye.isDecimalDigit(t)}throwError(t){let e=new Error(t+" at character "+this.index);throw e.index=this.index,e.description=t,e}runHook(t,e){if(Ye.hooks[t]){let i={context:this,node:e};return Ye.hooks.run(t,i),i.node}return e}searchHook(t){if(Ye.hooks[t]){let e={context:this};return Ye.hooks[t].find(function(i){return i.call(e.context,e),e.node}),e.node}}gobbleSpaces(){let t=this.code;for(;t===Ye.SPACE_CODE||t===Ye.TAB_CODE||t===Ye.LF_CODE||t===Ye.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let t=this.gobbleExpressions(),e=t.length===1?t[0]:{type:Ye.COMPOUND,body:t};return this.runHook("after-all",e)}gobbleExpressions(t){let e=[],i,r;for(;this.index<this.expr.length;)if(i=this.code,i===Ye.SEMCOL_CODE||i===Ye.COMMA_CODE)this.index++;else if(r=this.gobbleExpression())e.push(r);else if(this.index<this.expr.length){if(i===t)break;this.throwError('Unexpected "'+this.char+'"')}return e}gobbleExpression(){let t=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",t)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,Ye.max_binop_len),e=t.length;for(;e>0;){if(Ye.binary_ops.hasOwnProperty(t)&&(!Ye.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!Ye.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=e,t;t=t.substr(0,--e)}return!1}gobbleBinaryExpression(){let t,e,i,r,n,s,a,o,l;if(s=this.gobbleToken(),!s||(e=this.gobbleBinaryOp(),!e))return s;for(n={value:e,prec:Ye.binaryPrecedence(e),right_a:Ye.right_associative.has(e)},a=this.gobbleToken(),a||this.throwError("Expected expression after "+e),r=[s,n,a];e=this.gobbleBinaryOp();){if(i=Ye.binaryPrecedence(e),i===0){this.index-=e.length;break}n={value:e,prec:i,right_a:Ye.right_associative.has(e)},l=e;let c=h=>n.right_a&&h.right_a?i>h.prec:i<=h.prec;for(;r.length>2&&c(r[r.length-2]);)a=r.pop(),e=r.pop().value,s=r.pop(),t={type:Ye.BINARY_EXP,operator:e,left:s,right:a},r.push(t);t=this.gobbleToken(),t||this.throwError("Expected expression after "+l),r.push(n,t)}for(o=r.length-1,t=r[o];o>1;)t={type:Ye.BINARY_EXP,operator:r[o-1].value,left:r[o-2],right:t},o-=2;return t}gobbleToken(){let t,e,i,r;if(this.gobbleSpaces(),r=this.searchHook("gobble-token"),r)return this.runHook("after-token",r);if(t=this.code,Ye.isDecimalDigit(t)||t===Ye.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===Ye.SQUOTE_CODE||t===Ye.DQUOTE_CODE)r=this.gobbleStringLiteral();else if(t===Ye.OBRACK_CODE)r=this.gobbleArray();else{for(e=this.expr.substr(this.index,Ye.max_unop_len),i=e.length;i>0;){if(Ye.unary_ops.hasOwnProperty(e)&&(!Ye.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!Ye.isIdentifierPart(this.expr.charCodeAt(this.index+e.length)))){this.index+=i;let n=this.gobbleToken();return n||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:Ye.UNARY_EXP,operator:e,argument:n,prefix:!0})}e=e.substr(0,--i)}Ye.isIdentifierStart(t)?(r=this.gobbleIdentifier(),Ye.literals.hasOwnProperty(r.name)?r={type:Ye.LITERAL,value:Ye.literals[r.name],raw:r.name}:r.name===Ye.this_str&&(r={type:Ye.THIS_EXP})):t===Ye.OPAREN_CODE&&(r=this.gobbleGroup())}return r?(r=this.gobbleTokenProperty(r),this.runHook("after-token",r)):this.runHook("after-token",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let e=this.code;for(;e===Ye.PERIOD_CODE||e===Ye.OBRACK_CODE||e===Ye.OPAREN_CODE||e===Ye.QUMARK_CODE;){let i;if(e===Ye.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==Ye.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),e=this.code}this.index++,e===Ye.OBRACK_CODE?(t={type:Ye.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()},this.gobbleSpaces(),e=this.code,e!==Ye.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):e===Ye.OPAREN_CODE?t={type:Ye.CALL_EXP,arguments:this.gobbleArguments(Ye.CPAREN_CODE),callee:t}:(e===Ye.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),t={type:Ye.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),i&&(t.optional=!0),this.gobbleSpaces(),e=this.code}return t}gobbleNumericLiteral(){let t="",e,i;for(;Ye.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(this.code===Ye.PERIOD_CODE)for(t+=this.expr.charAt(this.index++);Ye.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(e=this.char,e==="e"||e==="E"){for(t+=this.expr.charAt(this.index++),e=this.char,(e==="+"||e==="-")&&(t+=this.expr.charAt(this.index++));Ye.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);Ye.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+t+this.char+")")}return i=this.code,Ye.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+t+this.char+")"):(i===Ye.PERIOD_CODE||t.length===1&&t.charCodeAt(0)===Ye.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:Ye.LITERAL,value:parseFloat(t),raw:t}}gobbleStringLiteral(){let t="",e=this.index,i=this.expr.charAt(this.index++),r=!1;for(;this.index<this.expr.length;){let n=this.expr.charAt(this.index++);if(n===i){r=!0;break}else if(n==="\\")switch(n=this.expr.charAt(this.index++),n){case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=n}else t+=n}return r||this.throwError('Unclosed quote after "'+t+'"'),{type:Ye.LITERAL,value:t,raw:this.expr.substring(e,this.index)}}gobbleIdentifier(){let t=this.code,e=this.index;for(Ye.isIdentifierStart(t)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(t=this.code,Ye.isIdentifierPart(t));)this.index++;return{type:Ye.IDENTIFIER,name:this.expr.slice(e,this.index)}}gobbleArguments(t){let e=[],i=!1,r=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let n=this.code;if(n===t){i=!0,this.index++,t===Ye.CPAREN_CODE&&r&&r>=e.length&&this.throwError("Unexpected token "+String.fromCharCode(t));break}else if(n===Ye.COMMA_CODE){if(this.index++,r++,r!==e.length){if(t===Ye.CPAREN_CODE)this.throwError("Unexpected token ,");else if(t===Ye.CBRACK_CODE)for(let s=e.length;s<r;s++)e.push(null)}}else if(e.length!==r&&r!==0)this.throwError("Expected comma");else{let s=this.gobbleExpression();(!s||s.type===Ye.COMPOUND)&&this.throwError("Expected comma"),e.push(s)}}return i||this.throwError("Expected "+String.fromCharCode(t)),e}gobbleGroup(){this.index++;let t=this.gobbleExpressions(Ye.CPAREN_CODE);if(this.code===Ye.CPAREN_CODE)return this.index++,t.length===1?t[0]:t.length?{type:Ye.SEQUENCE_EXP,expressions:t}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:Ye.ARRAY_EXP,elements:this.gobbleArguments(Ye.CBRACK_CODE)}}},z8e=new N8e;Object.assign(Ye,{hooks:z8e,plugins:new U8e(Ye),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});Ye.max_unop_len=Ye.getMaxKeyLen(Ye.unary_ops);Ye.max_binop_len=Ye.getMaxKeyLen(Ye.binary_ops);var y1=t=>new Ye(t).parse(),G8e=Object.getOwnPropertyNames(Ye);G8e.forEach(t=>{y1[t]===void 0&&t!=="prototype"&&(y1[t]=Ye[t])});y1.Jsep=Ye;var V8e="ConditionalExpression",H8e={name:"ternary",init(t){t.hooks.add("after-expression",function(e){if(e.node&&this.code===t.QUMARK_CODE){this.index++;let i=e.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===t.COLON_CODE){this.index++;let n=this.gobbleExpression();if(n||this.throwError("Expected expression"),e.node={type:V8e,test:i,consequent:r,alternate:n},i.operator&&t.binary_ops[i.operator]<=.9){let s=i;for(;s.right.operator&&t.binary_ops[s.right.operator]<=.9;)s=s.right;e.node.test=s.right,s.right=e.node,e.node=i}}else this.throwError("Expected :")}})}};y1.plugins.register(H8e);function jD(t){return{all:t=t||new Map,on:function(e,i){var r=t.get(e);r?r.push(i):t.set(e,[i])},off:function(e,i){var r=t.get(e);r&&(i?r.splice(r.indexOf(i)>>>0,1):t.set(e,[]))},emit:function(e,i){var r=t.get(e);r&&r.slice().map(function(n){n(i)}),(r=t.get("*"))&&r.slice().map(function(n){n(e,i)})}}}var Xoe=class{constructor(t,e,i){var r;this.id=t,this.userAPI=e,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise(n=>n()),this.emitter=jD(),this._innerCallUserAPI=async n=>{var s,a,o;this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await q8e(this.userAPI,n),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(l){let c=((o=(a=(s=l.message)==null?void 0:s.split("_:_"))==null?void 0:a[0])==null?void 0:o.replace("status:",""))??"null";this.error=c,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0},((r=e==null?void 0:e.integration)==null?void 0:r.type)==="OpenAI"?this.result={content:""}:e.method==="GET"&&e.url!==""&&(this.prefetchPromise=this.prefetch(i)),this._debouncedCallUserAPI=this._innerCallUserAPI,this._updateDebouncedCallUserAPI(),this._debouncedPrefetch=bS(this.prefetch,1e3,{trailing:!0})}_updateDebouncedCallUserAPI(){this._debouncedCallUserAPI=this.userAPI.debounce!==void 0&&this.userAPI.debounce>0?bS(this._innerCallUserAPI,this.userAPI.debounce,{leading:!0,trailing:!0}):this._innerCallUserAPI}async prefetch(t){await this.callUserAPI(t)}async callUserAPI(t){await this._debouncedCallUserAPI(t)}update(t,e,i=!0){this.userAPI=t,this._updateDebouncedCallUserAPI(),this.userAPI.url!==""&&this.userAPI.method==="GET"&&i&&this._debouncedPrefetch(e)}retrieveValue(t){if(this.result)try{return es.zoom(this.result,t)}catch(e){console.error(e)}}retrieveZoomedKeyValues(t){if(this.result){let e=t&&t.length?es.zoom(this.result,t):this.result;if(Y8e(e))return Object.entries(e);if(X8e(e))return e.map((i,r)=>[r.toString(),i]);throw W8e(e)?new Error("This path points to a value, use retrieveValue() instead. "+(t==null?void 0:t.join("."))):new Error("Path error"+(t==null?void 0:t.join(".")))}}dispose(){}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}get autostart(){return this.userAPI.autoStart}};function j8e(t){let e=new Headers;return t.headers.forEach(i=>{i.data.key!==""&&e.append(i.data.key,i.data.value)}),e}function W8e(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||t===null}function X8e(t){return Array.isArray(t)}function Y8e(t){return typeof t=="object"&&t!==null}async function q8e(t,e,i=new AbortController){var l,c,h,u;let r,n=t.url,s=((l=t.proxy)==null?void 0:l.enabled)??!1,a;if(((c=t.integration)==null?void 0:c.type)==="OpenAI"){let d=Nb(t.integration.prompt===""?[]:JSON.parse(t.integration.prompt),e),f=t.integration.behavior===""?[]:Nb(JSON.parse(t.integration.behavior),e);a=`{
		"model": "${t.integration.model}",
		"messages": [${t.integration.useBehavior?`
		{
			"role": "system",
			"content": "${f}"
		},`:""}
		{
			"role": "user",
			"content": "${d}"
		}
		]
	}`}if(s){n=`https://apis.spline.design/file/${t.proxy.fileId}/external-api/request?uuidexternalapi=${t.proxy.proxyId}`;let d;a!==void 0?d=a:t.method==="POST"&&t.body&&(d=Nb(JSON.parse(t.body),e)),d!==void 0&&(n+=`&data=${encodeURIComponent(d.replace(/(\r\n|\n|\r|\t)/gm,""))}`)}else((h=t.integration)==null?void 0:h.type)==="OpenAI"?r=a:t.method==="POST"&&t.body&&(r=Nb(JSON.parse(t.body),e));let o=await fetch(n,{method:s?"GET":t.method,headers:s?void 0:j8e(t),signal:i.signal,body:r});if(!o.ok)throw new Error("status:"+o.status+"_:_"+o.statusText);if(((u=t.integration)==null?void 0:u.type)==="OpenAI"){let d=await o.json();return s&&(d=d.response),{content:d.choices[0].message.content}}else{let d=await o.json();return s&&(d=d.response),d}}var Yoe=(t,e)=>{if(typeof t=="string"){let i=e.getVariable(t);if(i)return Yoe(i,e)}return Ys.isBoolean(t)?Ys.getDisplayedValue(t).toLowerCase():Ys.getDisplayedValue(t)},Nb=(t,e)=>t.map((i,r)=>{if("text"in i)return i.text;if("type"in i){if(i.type==="paragraph")return(r>0?`
`:"")+Nb(i.children,e);if(i.type==="variable"){let n=e.getVariable(i.variableId);if(n!==void 0)return Yoe(n,e)}}return""}).join(""),K8e=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],Q8e=["0","1","2","3","4","5","6","7","8","9","."],$8e=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function J8e(t){return typeof t!="string"?!1:!isNaN(t)&&!isNaN(parseFloat(t))}y1.addBinaryOp("^",11,!0);function qoe(t,e,i="number"){let r="";for(let a=0;a<t.length;a++){let o=t[a];if("objType"in o&&o.objType==="api"){let l=JSON.parse(o.id),c=l[0],h=e.getUserAPI(c);if(h!==void 0&&h instanceof Xoe){let u=h.retrieveValue(l.slice(1));u!==void 0&&(r+=u)}continue}if("objType"in o&&o.objType==="webhook"){let l=JSON.parse(o.id),[c,h]=l,u=e.getUserWebhook(c);if(u!==void 0){let d=u.getParameterValue(h);d!==void 0&&(r+=d)}continue}if("objType"in o&&o.objType==="aiAssistant"){let l=e.openAIRealtime;if("objId"in o&&o.objId!==void 0){let c;if(e.scene.data.objects.traverse((h,u)=>{var f;let d=(f=u.events)==null?void 0:f.find(p=>p.id===o.objId);d&&(c=d)}),c!==void 0&&c.data.type==="AIAssistantListener"){let h=l==null?void 0:l.computeAnalysisForListenerEvent(c.data);if(h!==void 0){r+=h;continue}}}r+=(l==null?void 0:l.voice)??0;continue}if("id"in o){let l=t[a-1];if(a>0&&"id"in l){console.error("Two variables in a row",t);return}let c=e.getVariable(o.id),h=Ys.getDisplayedValue(c);i==="number"&&Ys.isTextValue(c)&&Array.isArray(c.textValue)&&c.textValue.length===1?h=parseFloat(h).toString():i==="boolean"&&Ys.isBoolean(c)?h=c?"true":"false":i==="boolean"&&Ys.isTextValue(c)&&!Array.isArray(c.textValue)&&(h='"'+h+'"'),r+=h;continue}else if(i==="string"){o.name!=='"'&&(o.name!=="+"||o.escaped)&&(r+=o.name),o.name==="+"&&!o.escaped&&r[r.length-1]==="\\"&&(r=r.slice(0,-1)+o.name);continue}if(o.name==="and"){r+="&&";continue}if(o.name==="or"){r+="||";continue}if(o.name==="True"){r+="true";continue}if(o.name==="False"){r+="false";continue}if(i==="boolean"&&!J8e(o.name)&&!Q8e.includes(o.name)&&!K8e.includes(o.name)&&!$8e.includes(o.name.replace(/\($/g,""))){r+='"'+o.name+'"';continue}r+=o.name}if(i==="string")return r;if(t.length===0){if(i==="number")return 0;if(i==="boolean")return!1}let n;try{n=y1(r)}catch(a){console.error(r,a);return}let s;try{s=Fi(n)}catch(a){console.error(r,n,a)}return s}function Fi(t){switch(t.type){case"BinaryExpression":switch(t.operator){case"==":return+(Fi(t.left)===Fi(t.right));case"!=":return+(Fi(t.left)!==Fi(t.right));case">":return+(Fi(t.left)>Fi(t.right));case">=":return+(Fi(t.left)>=Fi(t.right));case"<":return+(Fi(t.left)<Fi(t.right));case"<=":return+(Fi(t.left)<=Fi(t.right));case"+":return Fi(t.left)+Fi(t.right);case"-":return Fi(t.left)-Fi(t.right);case"*":return Fi(t.left)*Fi(t.right);case"/":return Fi(t.left)/Fi(t.right);case"%":return Fi(t.left)%Fi(t.right);case"&&":return Fi(t.left)&&Fi(t.right);case"||":return Fi(t.left)||Fi(t.right);case"^":return Math.pow(Fi(t.left),Fi(t.right));default:throw new Error("Unknown operator: "+t.operator)}case"UnaryExpression":switch(t.operator){case"-":return-Fi(t.argument);case"!":return+!Fi(t.argument);default:throw new Error("Unknown operator: "+t.operator)}case"Identifier":throw new Error("Unknown identifier: "+t.name);case"Literal":return t.value;case"CallExpression":if(t.callee.type==="Identifier"){if(t.callee.name==="random"){let e=0,i=1;if(t.arguments.length>=1)try{e=Fi(t.arguments[0])}catch(r){console.warn(r)}if(t.arguments.length>=2)try{i=Fi(t.arguments[1])}catch(r){console.warn(r)}return e=Math.min(i,e),i=Math.max(i,e),e+Math.random()*(i-e)}return Math[t.callee.name].apply(null,t.arguments.map(Fi))}else throw new Error("Unknown node");default:throw new Error("Unknown node type: "+t.type)}}var Z8e=new st,eHe=new st;function tHe(t,e,i){let r=[new N,new N,new N],n=[new N,new N,new N];return t.extractBasis(r[0],r[1],r[2]),e.extractBasis(n[0],n[1],n[2]),r.forEach((s,a)=>{let o=n[a],l=Et.lerp(s.length(),o.length(),i);s.lerp(o,i).setLength(l)}),new st().makeBasis(r[0],r[1],r[2])}var iHe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},t.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=(e==null?void 0:e.shapeData)??wG.create({parameters:goe}).userData.shape;return{path:t.path??$2.defaultData(),parameters:Object.assign(i,{width:r,height:n,depth:s,extrusion:{...voe,...i.extrusion}}),shapeData:a}}static build(t){if(t.path.points.length>=2){let e=new rHe(t);return Object.assign(e,{userData:{...t,type:"PathGeometry"}})}else return Object.assign(new Nt,{userData:{...t,type:"PathGeometry"}})}},rHe=class extends Nt{constructor(t){super(),this.type="PathExtrusionGeometry",this.inputs=t,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let t=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&t.depth===1)||!P8e(t.twist,0)||t.startScale!==t.endScale}build(){let t=this._extractPathPoints();if(t.length<2)return;let e=this._computeBasisMatrices(t),{depth:i,offset:r}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),r=Math.max(0,Math.min(r,1));let n=this.inputs.path.isClosed?t.length:t.length-1,s=Math.floor(r*n),a=this.inputs.path.isClosed?Math.ceil((i+r)*n):Math.ceil(Math.min(1,i+r)*n),o=Math.min(Math.max(2,a-s+1),n+2),l=[],c=[];for(let W=0;W<o;W++){let I=this.inputs.path.isClosed?(W+s)%t.length:Math.min(W+s,t.length-1);l.push(t[I].clone()),c.push(e[I].clone())}let h=(W,I,z)=>{l[W]=l[W].clone().lerp(l[I],z),c[W]=tHe(c[W],c[I],z)},u=0,d=r*n%1;(!this.inputs.path.isClosed||i<=1)&&(d||r===0)&&(u=d,h(0,1,u));let f=0,p=(r+i)*n%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&p&&(f=p,h(l.length-1,l.length-2,1-f)),i===0){let W=l.length-1;l[W].copy(l[0]),c[W].copy(c[0])}this._applyPathModifiers(c,u,f);let{bevel:m,bevelSides:g}=this.inputs.parameters.extrusion,v=m>0?this.inputs.parameters.extrusion.capType:"flat",y=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(y=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:x,infos:S,vertices:A}=this._computeShapePoints(y),_=0,M;v==="round"&&(M=new bG(this.inputs.shapeData,2*m,m,y,g,void 0,!0),_=M.getAttribute("position").count);let E=0,T=0;S.sort((W,I)=>W.start-I.start),S.forEach(W=>{W.verticesStart=E,W.verticesCount=W.continuous.reduce((I,z,U)=>I+(U===0||!z?2:1),0),T+=W.verticesCount,E=T});let C=T*o,D,B=0;if(this._isOpenEnded()&&v==="flat"){try{D=Nf({windingRule:nr.ODD,elementType:On.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:x})}catch{D=Boe}B=D.vertexCount}let O=C+2*B+_*2,L=C+2*B,H={positions:new Float32Array(O*3),normals:new Float32Array(O*3),uvs:new Float32Array(O*2)},q=[];if(S.forEach(W=>{this._extrudeRegion(W,A,c,l,H,q,this._isGeometryClosed()&&!this._isOpenEnded())}),D&&(this._closeEnd(D,C,q,H,c[0],l[0],!1),this._closeEnd(D,C+B,q,H,c[c.length-1],l[l.length-1],!0)),M){H.positions.set(M.getAttribute("position").array,L*3),H.normals.set(M.getAttribute("normal").array,L*3),H.uvs.set(M.getAttribute("uv").array,L*2);for(let U=L;U<L+_;U++)H.uvs[U*2+1]=1e-4;let W=q.length;q.push(...M.getIndex().array.map(U=>U+L)),L+=_,H.positions.set(M.getAttribute("position").array,L*3),H.normals.set(M.getAttribute("normal").array,L*3),H.uvs.set(M.getAttribute("uv").array,L*2);let I=q.length;q.push(...M.getIndex().array.map(U=>U+L)),this.setAttribute("position",new Yt(H.positions,3)),this.setAttribute("normal",new Yt(H.normals,3)),this.setAttribute("uv",new Yt(H.uvs,2)),this.setIndex(q);let z=Z8e;z.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(z,L,O),z.copy(c[0]).setPosition(l[0]).multiply(eHe.makeScale(1,1,-1)),this.applyMatrix4OnRange(z,L-_,L),this.reverseIndicesOnRange(W,I)}else this.setAttribute("position",new Yt(H.positions,3)),this.setAttribute("normal",new Yt(H.normals,3)),this.setAttribute("uv",new Yt(H.uvs,2)),this.setIndex(q)}_extractPathPoints(){let t=Moe(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(t.length<2)return[];let e=[t[0]];return t.forEach(i=>{e[e.length-1].distanceToSquared(i)>.001&&e.push(i)}),this.inputs.path.isClosed&&e[e.length-1].distanceTo(e[0])<.001&&e.pop(),e}_computeBasisMatrices(t){let e=[],i=t.length,r=this.inputs.path.isClosed,n=new N,s=new N,a=new N,o=new N,l=new N(0,1,0);for(let p=0;p<i;p++){let m=t[p],g;p===0?g=r?t[t.length-2]:m.clone().multiplyScalar(2).sub(t[1]):g=t[p-1];let v;p===i-1?v=r?t[1]:m.clone().multiplyScalar(2).sub(t[p-1]):v=t[p+1];let y=m.clone().sub(g).normalize(),x=v.clone().sub(m).normalize(),S=y.clone().add(x).normalize();a.copy(S),p===0&&(S.equals(l)||S.clone().negate().equals(l))&&l.set(0,0,1);let A=l.clone().cross(S).normalize(),_=S.clone().cross(A).normalize();l.copy(_),o.copy(A),p===0&&(n.copy(_),s.copy(S));let M=new st().makeBasis(A,_,S);e.push(M)}let c=r?s:a,h=r?n:new N(0,1,0),u=c.clone().cross(o).normalize(),d=Math.acos(h.dot(u));if(isNaN(d))return e;let f=h.clone().cross(u);c.dot(f)>0&&(d*=-1);for(let p=1;p<e.length;p++){let m=new st().makeRotationZ(d*p/e.length);e[p].multiply(m)}return e}_applyPathModifiers(t,e,i){let r=t.length,{angle:n,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new st,c=new st;return t.forEach((h,u)=>{let d=u===0?0:u===r-1?1:(u-e)/(r-(i===0?0:1)-(e+(1-i)));l.makeRotationZ(Et.lerp(n,n+s,d)*Et.DEG2RAD);let f=Et.lerp(a,o,d);c.makeScale(f,f,f),h.multiply(l).multiply(c)}),t}_computeShapePoints(t=12,e=nr.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],t),n=i.shapeHoles.map(c=>{let h=c.extractShapePointsToFlatArray([],t),u=[];for(let d=h.length-1;d>=1;d-=2){let f=h[d-1],p=h[d-0];u.push(f,p)}return u}),s;try{s=Nf({windingRule:e,elementType:On.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{s=xG}let a;try{a=Nf({windingRule:nr.ODD,elementType:On.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...n]})}catch{a=Ooe}if(!s)throw new Error("error generating geometry");let o=s.elementCount;if(a){s.elementCount+=a.elementCount;for(let c=0;c<a.elements.length;c++){let h=a.elements[c],u=c%2===0?s.vertexCount:0;s.elements.push(h+u)}for(let c=0;c<a.vertexIndices.length;c++){let h=a.vertexIndices[c],u=s.vertexCount;s.vertexIndices.push(h+u)}for(let c=0;c<a.vertices.length;c++){let h=a.vertices[c];s.vertices.push(h)}}for(let c=0,h=s.vertexCount;c<h;c++){let u=c*2;s.vertices[u+0],s.vertices[u+1]}let l=[];for(let c=s.elementCount-1;c>=0;c--){let h=c>=o,u=c*2,d=s.elements[u+0],f=s.elements[u+1],p=d+f,m={start:d,count:f,normals:[],isHole:h,continuous:[],verticesStart:0,verticesCount:0};l.push(m);let g=d,v=p-1,y=d+1,x=i.roundedCurves.length;do{let S=g-d;s.vertices[v*2+0],s.vertices[v*2+1];let A=s.vertices[g*2+0],_=s.vertices[g*2+1],M=s.vertices[y*2+0],E=s.vertices[y*2+1],T=A-M,C=_-E,D=Math.sqrt(T*T+C*C);T/=D,C/=D,m.normals[S*2+0]=-C,m.normals[S*2+1]=T;let B=s.vertexIndices[g];if(Array.isArray(B))m.continuous[S]=!1;else{let[O,L]=i.getCurveIndexFromVertexId(B-1,!0);if(L>0&&L<1)m.continuous[S]=!0;else{let H=L===1?O+1:O-1;H=(H+x)%x;let q=L===1?0:1,W=i.roundedCurves[O].getTangent(L),I=i.roundedCurves[H].getTangent(q);m.continuous[S]=W.dot(I)>.95}}h&&(m.normals[S*2+0]*=-1,m.normals[S*2+1]*=-1),[v,g,y]=[g,y,y+1],y>=p&&(y-=f)}while(y!==d+1)}return{regions:[r,...n],infos:l,vertices:s.vertices}}_insertVertex(t,e,i,r,n){let s=e*2,a=e*3;t.positions[a+0]=i.x,t.positions[a+1]=i.y,t.positions[a+2]=i.z,t.normals[a+0]=r.x,t.normals[a+1]=r.y,t.normals[a+2]=r.z,t.uvs[s+0]=n.x,t.uvs[s+1]=n.y}_extrudeRegion(t,e,i,r,n,s,a){let o=new N,l=new N,c=new N,h=new N,u=new ye;i.forEach((f,p)=>{let m=r[p],g=t.verticesStart*i.length+t.verticesCount*p;for(let v=0;v<t.count;v++){let y=(t.start+v)*2;if(o.set(e[y+0],e[y+1],0),c.copy(o).applyMatrix4(f).add(m),t.continuous[v])h.set(t.normals[v*2+0],t.normals[v*2+1],0);else{let x=v===0?(t.start+t.count-1)*2:y-2;l.set(e[x+0],e[x+1],0),h.copy(o).sub(l),h.set(-h.y,h.x,0),t.isHole||h.negate()}if(h.applyMatrix4(f).normalize(),u.set(v===0?1:v/t.count,p/(i.length-1)),this._insertVertex(n,g,c,h,u),g++,!t.continuous[v]||v===0){if(v===0)h.set(t.normals[v*2+0],t.normals[v*2+1],0),u.set(0,p/(i.length-1));else{let x=v===t.count-1?t.start*2:y+2;l.set(e[x+0],e[x+1],0),h.copy(l).sub(o),h.set(-h.y,h.x,0),t.isHole||h.negate()}h.applyMatrix4(f).normalize(),this._insertVertex(n,g,c,h,u),g++}}});let d=i.length-1;for(let f=0;f<d;f++){let p=t.verticesStart*i.length+t.verticesCount*f,m=t.verticesStart*i.length+t.verticesCount*(f+1),g=0;for(let v=0;v<t.count;v++){(!t.continuous[v]||v===0)&&g++;let y=v===t.count-1?0:g+1,x=p+g,S=p+y,A=m+y,_=m+g;t.isHole?s.push(x,A,S,x,_,A):s.push(x,S,A,x,A,_),g++}}}_closeEnd(t,e,i,r,n,s,a){let o=t.vertexCount,l=new N(0,0,a?-1:1).applyMatrix4(n),c=new N,h=new ye;for(let d=0;d<o;d++){let f=2*d;c.set(t.vertices[f+0],t.vertices[f+1],0).applyMatrix4(n).add(s),this._insertVertex(r,e+d,c,l,h)}let u=t.elements;for(let d=0;d<t.elementCount;d++){let f=3*d,p=u[f+0]+e,m=u[f+(a?1:2)]+e,g=u[f+(a?2:1)]+e;i.push(p,m,g)}}applyMatrix4OnRange(t,e,i){let r=t.elements,n=new Bn().getNormalMatrix(t).elements,s,a,o,l,c=this.attributes.position,h=this.attributes.normal;if(!c||!h)return;let u=c.array,d=h.array,f=c.itemSize;for(let p=e*f,m=i*f;p<m;p+=f){if(p===e)debugger;s=u[p+0],a=u[p+1],o=u[p+2],l=1/(r[3]*s+r[7]*a+r[11]*o+r[15]),u[p+0]=(r[0]*s+r[4]*a+r[8]*o+r[12])*l,u[p+1]=(r[1]*s+r[5]*a+r[9]*o+r[13])*l,u[p+2]=(r[2]*s+r[6]*a+r[10]*o+r[14])*l,s=d[p+0],a=d[p+1],o=d[p+2],d[p+0]=n[0]*s+n[3]*a+n[6]*o,d[p+1]=n[1]*s+n[4]*a+n[7]*o,d[p+2]=n[2]*s+n[5]*a+n[8]*o}c.needsUpdate=!0,h.needsUpdate=!0}reverseIndicesOnRange(t,e){let i=this.index;if(i){for(let r=t;r<e;r+=3){let n=i.getX(r),s=i.getX(r+1),a=i.getX(r+2);i.setXYZ(r,a,s,n)}i.needsUpdate=!0}}};function Koe(){let t=new Nt;return t.setAttribute("position",new Yt(new Float32Array([]),3)),t.setIndex(new Yt(new Uint16Array([]),1)),t}var nHe=Koe().attributes,sHe=12,aHe=1,KN=class extends Nt{constructor(t,e){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,nHe),this.userData={parameters:t,type:"TextGeometry"};let i=e.getFont(t.font);i!=null&&i.isLoaded?(this.font=i,this.update(t)):this.updateFont(t.font,e).then(()=>{this.update(t),e==null||e.requestRender()})}async updateFont(t,e){let i=e.getFont(t);i&&(this.font=i,await i.loadingPromise)}update(t){let e=this.font;if(this.userData={parameters:t,type:"TextGeometry"},!(e!=null&&e.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,text:o,textTransform:l}=t,c=Ys.getDisplayedValue(o),h=l===2?c.toUpperCase():l===3?c.toLowerCase():c,u=oHe(t,e,h),{shapes:d,charWidths:f,charCoords:p}=e.generateShapes(u,t),m=(typeof i=="number"?i:1)*.5,g=(typeof r=="number"?r:1)*.5,v=d.map(S=>new an().fromShape(S,!0));this.vectorShapes=v;let y=v.map(S=>o0.create({shape:S,parameters:{depth:n,extrudeBevelSegments:a,extrudeBevelSize:s,windingRule:n<=0?nr.NONZERO:nr.ODD,subdivisions:this.isLowResolution&&n>0?aHe:sHe}})),x=y.length?Zm(y):Koe();x.translate(-m,g,0),this.dispose(),this.wrappedText=u,this.charCoords=p,this.charWidths=f,this.deleteAttribute("extrudeNormal"),Object.entries(x.attributes).forEach(([S,A])=>{this.setAttribute(S,A)}),this.setIndex(x.index),this.computeBoundingSphere()}clone(){let t=Xl(new Nt,KN.prototype);return t.copy(this),console.log("CloneGeometry",this,t),t}copy(t){return Object.entries(t.attributes).forEach(([e,i])=>{this.setAttribute(e,i)}),this.setIndex(t.index),this.userData={parameters:{...t.userData.parameters},type:"TextGeometry"},this}async setText(t){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:{textValue:t}})}get text(){return this.userData.parameters.text??""}};function oHe(t,e,i){let r=[""],n="";for(let s of i)n+=s,s===" "||s===`
`?(r[r.length-1]+=n,n="",s===`
`&&r.push("")):e.getTextWidth(r[r.length-1]+n,t)>t.width&&(r[r.length-1].length&&r.push(""),e.getTextWidth(r[r.length-1]+n,t)>t.width&&(n.length===1?(r[r.length-1]+=n,n=""):(r[r.length-1]+=n.slice(0,-1),n=n[n.length-1],r.push(""))));return r[r.length-1]+=n,r}var Qoe,$oe=new Promise(t=>{Qoe=t}),zq=!1,eT;function lHe(){if(zq)return;if(eT)return eT;async function t(){let e="https://unpkg.com/@splinetool/modelling-wasm@1.9.82/build",i=Td(()=>import("./process-B9H0U9ag.js"),[]),[r,n]=await Promise.all([i,fetch(`${e}/process.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});Qoe(a),zq=!0}return eT=t(),eT}var cHe=["font"];function RS(t,e,i,r){var c,h;let n,s,a;t.type==="PathGeometry"?(s=JSON.parse(JSON.stringify(t)),a=[[],["extrusion"]]):(s={...t},a=[[]]);for(let u of a){let d=s;for(let f of u)d=d[f];for(n in d){let f=d[n];HY(f)&&!cHe.includes(n)&&(d[n]=e.getVariable(f,[r.uuid,"geometry",...u,n]),HY(d[n])&&(d[n]=1))}}let o={parameters:s,type:s.type};if(s.type==="PathGeometry")o.path=s.path;else if(s.type==="VectorGeometry"){let u=an.createFromState(s.shape,s.width,s.height);o.shape=u}else if(s.type==="NonParametricGeometry"){if(s.data.groups&&((c=s.data.groups)==null||c.forEach(u=>u.materialIndex=Math.max(u.materialIndex??0,0))),o.geometry=new Qse().parse(s),o.geometry.groups.length===0){let u=o.geometry;u.addGroup(0,Math.max(((h=u.getIndex())==null?void 0:h.count)??0,u.getAttribute("position").count),0)}}else if(s.type==="SubdivGeometry"){let u=new Oa(s,i);return u.data=t,u}else{if(s.type==="TextGeometry")return new KN(s,e);if(s.type==="InputGeometry")return new KN(s,e);if(s.type==="UIGeometry")return SG.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}let l;try{l=Wq(o)}catch(u){console.error(u)}if(!l){let u=an.createFromState(Q2.defaultData(),100,100);o.shape=u,l=Wq(o)}return l}var hHe=new st;function QN(t,e,i,r){let n=t.position.array,s=t.normal.array,a=hHe.makeScale(e,i,r).invert().elements,o,l,c;for(var h=0,u=n.length;h<u;h+=3)n[h]*=e,n[h+1]*=i,n[h+2]*=r,o=s[h],l=s[h+1],c=s[h+2],s[h]=a[0]*o+a[4]*l+a[8]*c,s[h+1]=a[1]*o+a[5]*l+a[9]*c,s[h+2]=a[2]*o+a[6]*l+a[10]*c;t.position.needsUpdate=!0,t.normal.needsUpdate=!0}var tT=new _n,vv=new N,qt;$oe.then(t=>{qt=t});var Gq=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),Vq=new Uint32Array([0,1,2,3]),Hq=new Uint8Array([4]),Oa=class extends Nt{constructor(t,e){super(),this.data=t,this.flatShading=e,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(t,e){this.freeSubdivPointer();let i=this.data.scaleBaked,r=xg.div(e,i);this.subdividedGeometry&&QN(this.subdividedGeometry.attributes,...r),this.originalGeometry&&QN(this.originalGeometry.attributes,...r),this.data=t;let n=this.userData.parameters;this.userData.parameters={width:n.width*r[0],height:n.height*r[1],depth:n.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(vv.fromArray(r));let s=vv.set(n.width,n.height,n.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let t,e,i;try{({originalGeometry:t,subdividedGeometry:e,subdivPointer:i}=Oa.build(this.data,void 0,!this.flatShading,void 0))}catch{t=new Bc(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=t,this.subdividedGeometry=e??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(Oa.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let t=this.originalGeometry;t.boundingSphere===null&&(t.boundingSphere=new wo,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=t.boundingSphere));let e=t.attributes.position,i=t.boundingSphere.center;tT.setFromBufferAttribute(e),tT.getCenter(i),t.boundingSphere.radius=i.distanceTo(tT.max),isNaN(t.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),tT.getSize(vv);let r={width:vv.x,height:vv.y,depth:vv.z};return this.userData.parameters=r,r}static build(t,e,i,r){let n,s,a,o=(t==null?void 0:t.phongAngle)??35;i===!1&&(o=-1),e&&(qt.free_bvh(e),qt.free_subdivision_surface(e));try{n=Oa.allocate(t,r)}catch(l){console.error(l,t),n=Oa.allocate({positionWASM:Gq,indexWASM:Vq,verticesPerFaceWASM:Hq},r)}if(qt.set_destination_refinement_level(n,0),s=Oa.buildLevel(n,!0,o),t.subdivisions>0)try{qt.set_destination_refinement_level(n,t.subdivisions),a=Oa.buildLevel(n,!1,o)}catch{try{qt.set_destination_refinement_level(n,t.subdivisions-1),a=Oa.buildLevel(n,!1,o)}catch{a=null}}else a=null;return{subdivPointer:n,originalGeometry:s,subdividedGeometry:a}}static primitiveToQuads(t,e,i){t.widthSegments>16&&(t.widthSegments=16),t.heightSegments>16&&(t.heightSegments=16),t.depthSegments>16&&(t.depthSegments=16),t.radialSegments>16&&(t.radialSegments=16),t.type==="DodecahedronGeometry"&&(t.detail=0);let r=t.shape!==void 0||t.path!==void 0?e.geometry:RS(t,i,!1),n;t.type==="TorusGeometry"&&t.arc===Math.PI*2?n=r.getClosedTorusIndicesForBooleanOrSubdiv():n=r.getIndex();let s,a,o,l;({positions:s,triIndices:l}=WD(r.getAttribute("position"),n));let c;if(t.type==="CylinderGeometry"&&t.cornerRadius===0&&t.hollow===0&&t.openEnded===!1){let h=t.radialSegments*t.heightSegments*3*2,u=h+t.radialSegments*3;c=[h,u]}return{indices:a,verticesPerFace:o}=Joe(s,l,r,c),{positions:s,indices:a,verticesPerFace:o}}static allocate(t,e){var x;let i,r,n,s=[],a=[];t.positionWASM&&t.positionWASM.length>0?(i=t.positionWASM,r=t.indexWASM,n=t.verticesPerFaceWASM):(i=Gq,r=Vq,n=Hq);let o=i.length,l=r.length,c=n.length,h=i.length+s.length+a.length,u=r.length+n.length,d=h*Float32Array.BYTES_PER_ELEMENT+u*Uint32Array.BYTES_PER_ELEMENT,f=h*Float32Array.BYTES_PER_ELEMENT,p=qt._malloc(d),m=new Float32Array(qt.HEAPF32.buffer,p,h),g=new Uint32Array(qt.HEAPU32.buffer,p+f,u);m.set(i,0),m.set(s,i.length),m.set(a,i.length+s.length),g.set(r,0),g.set(n,r.length);let v;(x=t==null?void 0:t.scaleBaked)!=null&&x.some(S=>S!==1)&&(v=new st().makeScale(...t.scaleBaked)),e&&(v?v.premultiply(e):v=e);let y=v?qt.alloc_subdivision_surface2(p,o,p+f,l,p+f+r.length*Uint32Array.BYTES_PER_ELEMENT,c,v.elements):qt.alloc_subdivision_surface(p,o,p+f,l,p+f+r.length*Uint32Array.BYTES_PER_ELEMENT,c);return qt._free(p),y}static buildLevel(t,e,i,r,n){let s=n?qt.get_mesh_data2(t,e?qt.Level.CONTROL:qt.Level.REFINED,i,n.elements):qt.get_mesh_data(t,e?qt.Level.CONTROL:qt.Level.REFINED,i),a=8,o=qt.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(4,8),c=0,h=qt.HEAPU32[o[c]>>2],u=qt.HEAPF32.subarray(h>>2,(h>>2)+l[c]);c++;let d=qt.HEAPU32[o[c]>>2],f=qt.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let p=qt.HEAPU32[o[c]>>2],m=qt.HEAPU32.subarray(p>>2,(p>>2)+l[c]);c++;let g=qt.HEAPU32[o[c]>>2],v=qt.HEAPU32.subarray(g>>2,(g>>2)+l[c]);if(c++,r===void 0){let y=new Nt;if(y.setIndex(new My(v,1)),y.setAttribute("position",new bt(u,3)),y.setAttribute("normal",new bt(f,3)),e){y.setAttribute("faceMap",new My(m,1));let x=new Float32Array(f.length/3*4).fill(0);y.setAttribute("color",new Yt(x,4))}return qt.free_mesh_data(s),y.userData.type="SubdivGeometry",y}r.getAttribute("position").copyArray(u),r.getAttribute("normal").copyArray(f),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,qt.free_mesh_data(s)}static freeSubdivPointer(t){qt.free_bvh(t),qt.free_subdivision_surface(t)}static buildControlCageWireframe(t,e,i){let r=qt.get_wireframe_data_for_base_level(t),n=4,s=qt.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(2,4),o=0,l=qt.HEAPU32[s[o]>>2],c=qt.HEAPF32.subarray(l>>2,(l>>2)+a[o]);o++;let h=qt.HEAPU32[s[o]>>2],u=qt.HEAPU32.subarray(h>>2,(h>>2)+a[o]);if(e===void 0){let d=new Nt;d.setAttribute("position",new bt(c,3));let f=new Float32Array(c.length);for(let p=0,m=c.length;p<m;)f[p++]=i.r,f[p++]=i.g,f[p++]=i.b;return d.setAttribute("color",new Yt(f,3)),d.setIndex(new My(u,1)),qt.free_wireframe_data_for_base_level(r),d}e.getAttribute("position").copyArray(c),e.attributes.position.needsUpdate=!0,qt.free_wireframe_data_for_base_level(r)}static updateCollabMesh(t,e,i){let r=e===0;r||qt.set_destination_refinement_level(t,e);let n=i?qt.get_topological_data2(t,r?qt.Level.CONTROL:qt.Level.REFINED,i.elements):qt.get_topological_data(t,r?qt.Level.CONTROL:qt.Level.REFINED),s=6,a=qt.HEAPU32.subarray(n>>2,(n>>2)+s),o=a.subarray(3,6),l=0,c=qt.HEAPU32[a[l]>>2],h=new Float32Array(qt.HEAPF32.subarray(c>>2,(c>>2)+o[l]));l++;let u=qt.HEAPU32[a[l]>>2],d=new Uint32Array(qt.HEAPU32.subarray(u>>2,(u>>2)+o[l]));l++;let f=qt.HEAPU32[a[l]>>2],p=new Uint8Array(qt.HEAPU32.subarray(f>>2,(f>>2)+o[l]));return qt.free_topological_data(n),{positions:h,indices:d,verticesPerFace:p}}},jq=["getX","getY","getZ"];function WD(t,e){let i={},r=e?e.count:t.count,n=0,s=[],a=[],o=1e4;for(let c=0;c<r;c++){let h=e?e.getX(c):c,u="";for(let d=0;d<3;d++)u+=`${~~(t[jq[d]](h)*o)},`;if(u in i)s.push(i[u]);else{for(let d=0;d<3;d++)a.push(t[jq[d]](h));i[u]=n,s.push(n),n++}}let l=[];for(let c=0;c<s.length;c+=3)s[c]===s[c+1]||s[c]===s[c+2]||s[c+1]===s[c+2]||l.push(s[c],s[c+1],s[c+2]);return{positions:a,triIndices:l}}var iT=new N,fO=new N,pO=new N,mO=new N;function Joe(t,e,i,r){let n=[],s=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let l=i.userData.shape.extractShapePointsToFlatArray([]),c=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&c<=24&&c%4===0&&i.userData.parameters.angle>=360){let d=l.length/2/c;l=l.filter((f,p)=>Math.floor(p/2)%d===0)}let h=0;for(let d=0;d<l.length;d+=2)h+=(l[d]-l[(d===0?l.length:d)-2])*(l[d+1]+l[(d===0?l.length:d)-1]);t.length=0;let u=0;if(h<0)for(let d=0;d<l.length;d+=2)t.push(l[d],l[d+1],0),n.push(u++);else for(let d=l.length-2;d>=0;d-=2)t.push(l[d],l[d+1],0),n.push(u++);return s.push(u),{indices:n,verticesPerFace:s}}let a=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<e.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((t[e[o]*3+2]===a||t[e[o]*3+2]===0)&&l++,(t[e[o+1]*3+2]===a||t[e[o+1]*3+2]===0)&&l++,(t[e[o+2]*3+2]===a||t[e[o+2]*3+2]===0)&&l++,l===3)break}if(e[o+1]===e[o+3]&&e[o+2]===e[o+5]||e[o+0]===e[o+3]&&e[o+2]===e[o+4]){iT.set(t[e[o]*3],t[e[o]*3+1],t[e[o]*3+2]),fO.set(t[e[o+1]*3],t[e[o+1]*3+1],t[e[o+1]*3+2]),pO.set(t[e[o+4]*3],t[e[o+4]*3+1],t[e[o+4]*3+2]),mO.set(t[e[o+5]*3],t[e[o+5]*3+1],t[e[o+5]*3+2]),fO.sub(iT).normalize(),pO.sub(iT).normalize(),mO.sub(iT).normalize();let l=fO.cross(pO).dot(mO);Math.abs(l)>.005||r&&r.some((c,h)=>h%2===1?!1:o>=r[h]&&o<r[h+1])?(n.push(e[o],e[o+1],e[o+2]),s.push(3),o+=3):(n.push(e[o],e[o+1],e[o+4],e[o+5]),s.push(4),o+=6)}else n.push(e[o],e[o+1],e[o+2]),s.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],c=[],h=0;for(let u=0,d=0;u<t.length;u+=3,d++)t[u+2]===0&&(l.push(d),h++),t[u+2]===a&&c.push(d);if(i.userData.parameters.extrudeBevelSize===0){let u=c[0];c[0]=c[1],c[1]=u}l.reverse(),n.push(...l,...c),s.push(h,h)}return{indices:n,verticesPerFace:s}}var Du={};t2e(Du,{calcBoolean:()=>mHe,calcBooleanTopological:()=>pHe,freeMeshSet:()=>xHe,getMeshSet:()=>gHe,hasOpenEdges:()=>vHe,transformMeshSet:()=>yHe});var Zoe,uHe=new Promise(t=>{Zoe=t}),rT;function dHe(){if(rT)return rT;async function t(){let e="https://unpkg.com/@splinetool/boolean-wasm@1.9.82/build",i=Td(()=>import("./boolean-BpCokwB2.js"),[]),[r,n]=await Promise.all([i,fetch(`${e}/boolean.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});Zoe(a)}return rT=t(),rT}var Mi,Ly;uHe.then(t=>Mi=t);function fHe(t,e,i){let r,n;t.userData.parameters.type==="TorusGeometry"&&t.userData.parameters.arc===Math.PI*2?n=t.getClosedTorusIndicesForBooleanOrSubdiv():n=t.getIndex();let{positions:s,triIndices:a}=WD(t.getAttribute("position"),n),o;if(e&&i){let{indices:l,verticesPerFace:c}=Joe(s,a,t);o=c.length,r=[];for(let h=0,u=0;h<o;h++){r.push(c[h]);for(let d=0;d<c[h];d++)r.push(l[u++])}}else{let l=a.length;r=Array(l+l/3),o=0;for(let c=0,h=0;h<r.length;)r[h++]=3,o++,r[h++]=a[c++],r[h++]=a[c++],r[h++]=a[c++]}return{positions:s,faceIndices:r,nFaces:o}}function ele(t){let e=t.length,i=e*Uint32Array.BYTES_PER_ELEMENT,r=e*Float32Array.BYTES_PER_ELEMENT,n=Number.isInteger(t[0])?i:r,s=Mi._malloc(n);return(Number.isInteger(t[0])?new Uint32Array(Mi.HEAPU32.buffer,s,e):new Float32Array(Mi.HEAPF32.buffer,s,e)).set(t,0),s}function tle(t){switch(t){case 0:return Mi.OP.UNION;case 1:return Mi.OP.INTERSECTION;case 2:return Mi.OP.A_MINUS_B;default:throw new Error("Unknown boolean operation "+t)}}function pHe(t,e){Ly===void 0&&(Ly=Mi.init_csg());let i=ele(t),r=Mi.csg_calc_topological(Ly,i,t.length,tle(e));Mi._free(i);let n=6,s=Mi.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(3,6),o=0,l=Mi.HEAPU32[s[o]>>2],c=new Float32Array(Mi.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let h=Mi.HEAPU32[s[o]>>2],u=new Uint32Array(Mi.HEAPU32.subarray(h>>2,(h>>2)+a[o]));o++;let d=Mi.HEAPU32[s[o]>>2],f=new Uint8Array(Mi.HEAPU32.subarray(d>>2,(d>>2)+a[o]));return Mi.free_mesh_data(r),{positions:c,indices:u,verticesPerFace:f}}function mHe(t,e,i,r){Ly===void 0&&(Ly=Mi.init_csg());let n=ele(t),s=Mi.csg_calc(Ly,n,t.length,r,tle(e));Mi._free(n);let a=5,o=Mi.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(2,5),c=0,h=Mi.HEAPU32[o[c]>>2],u=Mi.HEAPF32.subarray(h>>2,(h>>2)+l[c]);c++;let d=Mi.HEAPU32[o[c]>>2],f=Mi.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let p=l[c];i.setAttribute("position",new bt(u,3)),i.setAttribute("normal",new bt(f,3));let m=Mi.HEAPF32.subarray((s>>2)+5,(s>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new wo),i.boundingSphere.center.set(m[0],m[1],m[2]),i.boundingSphere.radius=(m[3]**2+m[4]**2+m[5]**2)**.5,i.userData.parameters={width:m[3]*2,height:m[4]*2,depth:m[5]*2},Mi.free_mesh_data(s),p}function gHe(t,e,i){if(Mi===void 0)return-1;let r,n,s;if(e&&t.userData.positions!==void 0){let g=t.userData;s=g.verticesPerFace.length,r=g.positions,n=Array(g.verticesPerFace.reduce((v,y)=>v+y,0)+s);for(let v=0,y=0,x=0;v<g.verticesPerFace.length;v++){n[x++]=g.verticesPerFace[v];for(let S=0;S<g.verticesPerFace[v];S++)n[x++]=g.indices[y++]}}else({positions:r,faceIndices:n,nFaces:s}=fHe(t,e,i));let a=r.length,o=n.length,l=r.length,c=n.length,h=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,u=l*Float32Array.BYTES_PER_ELEMENT,d=Mi._malloc(h),f=new Float32Array(Mi.HEAPF32.buffer,d,l),p=new Uint32Array(Mi.HEAPU32.buffer,d+u,c);f.set(r,0),p.set(n,0);let m=Mi.get_csg_mesh(d,a,d+u,o,s);return Mi._free(d),m}function vHe(t){return Mi.has_open_edges(t)}function yHe(t,e){Mi.transform_csg_mesh(t,e.elements)}function xHe(t){Mi.free_csg_mesh(t)}var bHe={ConeGeometry:S6e,CubeGeometry:_6e,CylinderGeometry:Toe,DodecahedronGeometry:E6e,EllipseGeometry:wG,HelixGeometry:o8e,IcosahedronGeometry:l8e,LatheGeometry:c8e,NonParametricGeometry:g8e,PolygonGeometry:joe,PyramidGeometry:v8e,RectangleGeometry:SG,SphereGeometry:b8e,PlaneGeometry:w8e,BackdropGeometry:S8e,StarGeometry:Woe,TextFrameGeometry:A8e,TorusGeometry:E8e,TorusKnotGeometry:T8e,TriangleGeometry:C8e,PathGeometry:iHe,VectorGeometry:o0},Wq=t=>bHe[t.type].create(t);function yv(t){return t!==null&&"booleanOp"in t}var ile=class extends mG(vr){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new st}updateVisible(t){super.updateVisible(t),this.visible=!yv(this.parent)&&this.visible,yv(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(Du.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(t=!1){return t?this.booleanWasTransformed=!0:this.freeBooleanPointer(),yv(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let t of this.children)t instanceof ile&&(t.freeBooleanPointer(),yv(t)&&t.invalidateUpstreamBooleanData())}updateTransformState(t,e){let i=super.updateTransformState(t,e);return i&&yv(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(t=!1){super.onVariableUpdate(t),yv(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},nT=new _n;function _G(t,e=0,i=t.count,r,n){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,h=-1/0;for(let u=e;u<i;u++){let d=t.getX(u),f=t.getY(u),p=t.getZ(u);d<s&&(s=d),f<a&&(a=f),p<o&&(o=p),d>l&&(l=d),f>c&&(c=f),p>h&&(h=p)}nT.min.set(s,a,o),nT.max.set(l,c,h),nT.getCenter(r),nT.getSize(n).multiplyScalar(.5)}var wHe=new Nt,SHe=new pd,ja=class extends ile{constructor(t,e){super(wHe,SHe),this.super_Entity(t,e)}updateState(t,e){this.updateState_Entity(t,e)}updateEntityBoxSize(t,e){let i=this.geometry.getAttribute("position");i!==void 0?_G(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,t,e):super.updateEntityBoxSize(t,e)}},yf=class{constructor(t){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},yf.uuidContext===null)throw new Error("plz startContext");yf.uuidContext===yf.globalContext?this.uuid="_gid"+yf.uuidContext.nodeContextUuid++:this.uuid="_uid"+yf.uuidContext.nodeContextUuid++,this.type=t,this.name=""}static startContext(t){this.uuidContext===null||this.uuidContext===yf.globalContext?this.uuidContext=t:console.error("Can't start context twice")}static endContext(t){this.uuidContext!==t&&console.error("Can't end context twice"),this.uuidContext=null}analyze(t,e){e=e??{},t.analyzing=!0,this.build(t.addFlow(e.slot,e.cache,e.context),"v4"),t.clearVertexNodeCode(),t.clearFragmentNodeCode(),t.removeFlow(),t.analyzing=!1}analyzeAndFlow(t,e,i){return i=i??{},this.analyze(t,i),this.flow(t,e,i)}flow(t,e,i){i=i??{},t.addFlow(i.slot,i.cache,i.context);let r={result:this.build(t,e),code:t.clearNodeCode(),extra:t.context.extra};return t.removeFlow(),r}build(t,e,i){e=e??this.getType(t,e);let r=t.getNodeData(i??this);return t.analyzing&&this.appendDepsNode(t,r,e),t.nodes.indexOf(this)===-1&&t.nodes.push(this),this.updateFrame!==void 0&&t.updaters.indexOf(this)===-1&&t.updaters.push(this),this.generate(t,e,i)}updateFrame(t){}generateReadonly(t,e,i,r,n,s){return""}generate(t,e,i,r,n){return""}parse(t,e,i,r){}appendDepsNode(t,e,i){e.deps=(e.deps||0)+1;let r=t.getTypeLength(i);(r>(e.outputMax||0)||this.getType(t,i))&&(e.outputMax=r,e.output=i)}setName(t){this.name=t}getName(){return this.name}getType(t,e){return e==="sampler2D"||e==="samplerCube"?e:this.type}},Jn=yf;Jn.globalContext={nodeContextUuid:0},Jn.uuidContext=yf.globalContext;var Xq=class{constructor(t){t=t??{},this.name=t.name,this.type=t.type,this.node=t.node,this.size=t.size,this.needsUpdate=t.needsUpdate}get value(){return this.node.value}set value(t){this.node.value=t}},_He=class{constructor(){this.nodes={},this.keywords={}}add(t){this.nodes[t.name]=t}addKeyword(t,e,i){i=i!==void 0?i:!0,this.keywords[t]={callback:e,cache:i}}remove(t){delete this.nodes[t.name]}removeKeyword(t){delete this.keywords[t]}get(t){return this.nodes[t]}getKeyword(t,e){return this.keywords[t].callback(e)}getKeywordData(t){return this.keywords[t]}contains(t){return this.nodes[t]!==void 0}containsKeyword(t){return this.keywords[t]!==void 0}},oo=new _He,or=class extends Jn{constructor(t,e){super(t),this.scope="",e=e??{},this.shared=e.shared!==void 0?e.shared:!0,this.unique=e.unique!==void 0?e.unique:!1}build(t,e,i,r){if(e=e??this.getType(t),this.getShared(t,e)){let n=this.getUnique(t,e);n&&this.uuid===void 0&&(this.uuid=Et.generateUUID()),i=t.getUUID(i??this.getUUID(),!n);let s=t.getNodeData(i),a=s.output||this.getType(t);if(t.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(t,s,e),this.generate(t,e,i)):super.build(t,e,i);if(n)return s.name=s.name||super.build(t,e,i),s.name;if(!this.getLabel()&&(!this.getShared(t,a)||t.context.ignoreCache||s.deps===1))return super.build(t,e,i);i=this.getUUID(!1);let o=this.getTemp(t,i);if(o)return t.format(o,a,e);{o=super.generate(t,e,i,s.output,r);let l=this.generate(t,a,i);return t.addNodeCode(o+" = "+l+";"),t.format(o,a,e)}}return super.build(t,e,i)}getShared(t,e){return e!=="sampler2D"&&e!=="samplerCube"&&this.shared}getUnique(t,e){return this.unique}setLabel(t){return this.label=t,this}getLabel(){return this.label}getUUID(t){let e=this.uuid;return typeof this.scope=="string"&&(e=this.scope+"-"+e),e}getTemp(t,e){e=e||this.uuid;let i=t.getVars()[e];return i?i.name:void 0}generate(t,e,i,r,n){return this.getShared(t,e)||console.error("TempNode is not shared"),i=i??this.uuid,t.getTempVar(i,r??this.getType(t),n,this.getLabel()).name}},_o=class extends or{constructor(t,e){e=e??{},e.shared=e.shared!==void 0?e.shared:!1,super(t,e),this.readonly=!1}setReadonly(t){return this.readonly=t,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(t,e,i,r,n,s){i=t.getUUID(i??this.getUUID()),r=r??this.getType(t);let a=t.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(t,e,i,r,n,s):t.isShader("vertex")?(a.vertex||(a.vertex=t.createVertexUniform(r,this,n,s,this.getLabel())),t.format(a.vertex.name,r,e)):(a.fragment||(a.fragment=t.createFragmentUniform(r,this,n,s,this.getLabel())),t.format(a.fragment.name,r,e))}},zs=class extends _o{constructor(t=0,e){super("v2"),this.nodeType="Vector2",this.value=t instanceof ye?t:new ye(t,e)}get x(){return this.value.x}set x(t){this.value.x=t}get y(){return this.value.y}set y(t){this.value.y=t}generateReadonly(t,e,i,r,n,s){return t.format("vec2("+this.value.x+", "+this.value.y+")",r,e)}},bl=class extends _o{constructor(t=0,e,i){super("v3"),this.nodeType="Vector3",this.value=t instanceof N?t:new N(t,e,i)}get x(){return this.value.x}set x(t){this.value.x=t}get y(){return this.value.y}set y(t){this.value.y=t}get z(){return this.value.z}set z(t){this.value.z=t}generateReadonly(t,e,i,r,n,s){return t.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,e)}},Qs=class extends Xt{constructor(t,e,i,r){super(t,e,i),this.isColorA=!0,this.a=r}setRGBA(t,e,i,r){super.setRGB(t,e,i),this.a=r}copy(t){return super.copy(t),this.a="a"in t?t.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(t){return super.equals(t)&&this.a===t.a}setStyle(t,e="srgb"){let i;if(t==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(t)){let r,n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="rgba"?parseFloat(r[4]):1,super.setStyle(t,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="hsla"?parseFloat(r[4]):1,super.setStyle(t,e);break}}return super.setStyle(t,e)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(t){this.r=t}set y(t){this.g=t}set z(t){this.b=t}set w(t){this.a=t}},Ru=class extends _o{constructor(t){super("v4"),this.nodeType="Vector4",this.value=t instanceof Qs?t:new Qs(t.r,t.g,t.b,t.a)}generateReadonly(t,e,i,r,n,s){return t.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,e)}},AHe=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,Yq=/[a-z_0-9]+/gi,xt=class extends or{constructor(t,e,i,r,n){super(n),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=n===void 0,this.isInterface=!1,this.parse(t,e,i,r)}getShared(t,e){return!this.isMethod}getType(t){return t.getTypeByFormat(this.type)}getInputByName(t){if(this.inputs){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}}getIncludeByName(t){if(this.includes){let e=this.includes.length;for(;e--;)if(this.includes[e].name===t)return this.includes[e]}}generate(t,e,i,r,n){let s,a=0,o=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)t.include(this.includes[c],this);for(let c in this.extensions)t.extensions[c]=!0;let l=[];for(;s=Yq.exec(this.src);)l.push(s);for(let c=0;c<l.length;c++){let h=l[c],u=h[0],d=this.isMethod?!this.getInputByName(u):!0,f=u;if(this.keywords[u]||this.useKeywords&&d&&oo.containsKeyword(u)){let p=this.keywords[u];if(!p){let m=oo.getKeywordData(u);m.cache&&(p=t.keywords[u]),p=p||oo.getKeyword(u,t),m.cache&&(t.keywords[u]=p)}f=p.build(t)}u!==f&&o[h.index+a-1]!=="."&&(o=o.substring(0,h.index+a)+f+o.substring(h.index+u.length+a),a+=f.length-u.length),this.getIncludeByName(f)===void 0&&oo.contains(f)&&t.include(oo.get(f))}return e==="source"?o:this.isMethod?(this.isInterface||t.include(this,void 0,o),this.name):t.format("( "+o+" )",this.getType(t),e)}parse(t,e,i,r){if(this.src=t||"",this.includes=e??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let n=AHe.exec(this.src);if(this.inputs=[],n&&n.length==4){this.type=n[1],this.name=n[2];let s=n[3].match(Yq);if(s){let a=0;for(;a<s.length;){let o=s[a++],l;o==="in"||o==="out"||o==="inout"?l=s[a++]:(l=o,o="");let c=s[a++];this.inputs.push({name:c,type:l,qualifier:o})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},EHe=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,rle=class extends or{constructor(t="",e){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(t||rle.PI,void 0,void 0,void 0,e)}getType(t){return t.getTypeByFormat(this.type)}parse(t,e,i,r,n){this.src=t||"";let s,a,o="",l=EHe.exec(t);this.useDefine=n??this.src.charAt(0)==="#",l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(t,e){if(e==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return t.include(this),t.format(this.name,this.getType(t),e)}generate(t,e,i,r,n){return t.format(this.name,this.getType(t),e)}},qi=rle;qi.PI="PI",qi.PI2="PI2",qi.RECIPROCAL_PI="RECIPROCAL_PI",qi.RECIPROCAL_PI2="RECIPROCAL_PI2",qi.LOG2="LOG2",qi.EPSILON="EPSILON";var MHe=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),THe=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),nle=class extends or{constructor(t=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(t)}getType(t){return t.getTypeByFormat(this.name)}getInputByName(t){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}generate(t,e,i,r,n){return e==="source"?this.src+";":t.format("( "+this.src+" )",this.getType(t),e)}parse(t=""){this.src=t,this.inputs=[];let e=MHe.exec(t);if(e){let i=e[2],r;for(;r=THe.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=e[1]}else this.name="";this.type=this.name}},AG=class extends or{constructor(t){super("v2",{shared:!1}),this.nodeType="UV",this.index=t??0}generate(t,e){t.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=t.isShader("vertex")?"uv"+i:"vUv"+i;return t.format(r,this.getType(t),e)}};oo.addKeyword("uv",function(){return new AG});oo.addKeyword("uv2",function(){return new AG(1)});var Bv=class extends or{constructor(t,e){super("v4"),this.nodeType="ColorSpace",this.input=t,this.method=e??Bv.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(t){switch(t){case Oc:return["Linear"];case fi:return["sRGB"];default:return[]}}generate(t,e){var a;let i=this.input.build(t,"v4"),r=this.getType(t),n=Bv.Nodes[this.method],s=t.include(n);if(s===Bv.LINEAR_TO_LINEAR)return t.format(i,r,e);if(((a=n.inputs)==null?void 0:a.length)===2){let o=this.factor.build(t,"f");return t.format(s+"( "+i+", "+o+" )",r,e)}else return t.format(s+"( "+i+" )",r,e)}fromEncoding(t){let e=Bv.getEncodingComponents(t);this.method="LinearTo"+e[0],this.factor=e[1]}fromDecoding(t){let e=Bv.getEncodingComponents(t);this.method=e[0]+"ToLinear",this.factor=e[1]}},Mh=Bv;Mh.Nodes={LinearToLinear:new xt(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new xt(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new xt(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Mh.LINEAR_TO_LINEAR="LinearToLinear",Mh.SRGB_TO_LINEAR="sRGBToLinear",Mh.LINEAR_TO_SRGB="LinearTosRGB";var xr=class extends xt{constructor(t="",e,i,r,n){super(t,n,r,i,e),this.nodeType="Expression"}},Vu=class extends _o{constructor(t=new Kr,e,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=t,this.uv=e??new AG,this.bias=i,this.project=r!==void 0?r:!1}getTexture(t,e){return super.generate(t,e,this.value.uuid,"t")}generate(t,e){if(e==="sampler2D")return this.getTexture(t,e);let i=this.getTexture(t,e),r=this.uv.build(t,this.project?"v4":"v2"),n=this.bias?this.bias.build(t,"f"):void 0;n===void 0&&t.context.bias&&(n=t.context.bias.setTexture(this).build(t,"f"));let s,a;this.project?s="texture2DProj":s=n?"tex2DBias":"tex2D",n?a=s+"( "+i+", "+r+", "+n+" )":a=s+"( "+i+", "+r+" )";let o={include:t.isShader("vertex"),ignoreCache:!0},l=this.getType(t);return t.addContext(o),this.colorSpace=this.colorSpace??new Mh(new xr("",l)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(t,l),t.removeContext(),t.format(a,l,e)}},Pt=class extends _o{constructor(t){super("f"),this.nodeType="Float",this.value=t??0}generateReadonly(t,e,i,r,n,s){return t.format(this.value+(this.value%1?"":".0"),r,e)}},qq=class extends or{constructor(t,e){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=t,this.inputs=e??[]}getFunction(){return this.value}getType(t){return this.value.getType(t)}generate(t,e,i,r,n){r=this.getType(t);let s=this.value,a=s.build(t,e)+"( ",o=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let c=s.inputs[l],h=this.inputs[l]||this.inputs[c.name];o.push(h.build(t,t.getTypeByFormat(c.type)))}a+=o.join(", ")+" )"}return t.format(a,r,e)}},sle=class extends or{constructor(t,e,i=sle.ADD){super(),this.nodeType="Operator",this.type=t.type,this.a=t,this.b=e,this.op=i}getType(t){let e=this.a.getType(t),i=this.b.getType(t);return t.isTypeMatrix(e)?"v4":t.getTypeLength(i)>t.getTypeLength(e)?i:e}generate(t,e){let i=this.getType(t);this.type=i;let r=this.a.build(t,i),n=this.b.build(t,i);return t.format("( "+r+" "+this.op+" "+n+" )",i,e)}},to=sle;to.ADD="+",to.SUB="-",to.MUL="*",to.DIV="/";var er=class extends or{constructor(t,e=er.ABS,i,r){super(),this.nodeType="Math",this.a=t,typeof e!="string"?this.b=e:r=e,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(t){switch(this.method){case er.MIX:case er.CLAMP:case er.REFRACT:case er.SMOOTHSTEP:case er.FACEFORWARD:return 3;case er.MIN:case er.MAX:case er.MOD:case er.STEP:case er.REFLECT:case er.DISTANCE:case er.DOT:case er.CROSS:case er.POW:return 2;default:return 1}}getInputType(t){let e=t.getTypeLength(this.a.getType(t)),i=this.b?t.getTypeLength(this.b.getType(t)):0,r=this.c?t.getTypeLength(this.c.getType(t)):0;return e>i&&e>r?this.a.getType(t):i>r?this.b.getType(t):this.c.getType(t)}getType(t){switch(this.method){case er.LENGTH:case er.DISTANCE:case er.DOT:return"f";case er.CROSS:return"v3"}return this.getInputType(t)}generate(t,e){let i,r,n,s=this.a?t.getTypeLength(this.a.getType(t)):0,a=this.b?t.getTypeLength(this.b.getType(t)):0,o=this.c?t.getTypeLength(this.c.getType(t)):0,l=this.getInputType(t),c=this.getType(t);switch(this.type=c,this.method){case er.NEGATE:return t.format("( -"+this.a.build(t,l)+" )",l,e);case er.INVERT:return t.format("( 1.0 - "+this.a.build(t,l)+" )",l,e);case er.CROSS:i=this.a.build(t,"v3"),r=this.b.build(t,"v3");break;case er.STEP:i=this.a.build(t,s===1?"f":l),r=this.b.build(t,l);break;case er.MIN:case er.MAX:case er.MOD:i=this.a.build(t,l),r=this.b.build(t,a===1?"f":l);break;case er.REFRACT:i=this.a.build(t,l),r=this.b.build(t,l),n=this.c.build(t,"f");break;case er.MIX:i=this.a.build(t,l),r=this.b.build(t,l),n=this.c.build(t,o===1?"f":l);break;default:i=this.a.build(t,l),this.b&&(r=this.b.build(t,l)),this.c&&(n=this.c.build(t,l));break}let h=[];h.push(i),r&&h.push(r),n&&h.push(n);let u=this.getNumInputs(t);if(h.length!==u)throw Error(`Arguments not match used in "${this.method}". Require ${u}, currently ${h.length}.`);return t.format(this.method+"( "+h.join(", ")+" )",c,e)}},hi=er;hi.RAD="radians",hi.DEG="degrees",hi.EXP="exp",hi.EXP2="exp2",hi.LOG="log",hi.LOG2="log2",hi.SQRT="sqrt",hi.INV_SQRT="inversesqrt",hi.FLOOR="floor",hi.CEIL="ceil",hi.NORMALIZE="normalize",hi.FRACT="fract",hi.SATURATE="saturate",hi.SIN="sin",hi.COS="cos",hi.TAN="tan",hi.ASIN="asin",hi.ACOS="acos",hi.ARCTAN="atan",hi.ABS="abs",hi.SIGN="sign",hi.LENGTH="length",hi.NEGATE="negate",hi.INVERT="invert",hi.MIN="min",hi.MAX="max",hi.MOD="mod",hi.STEP="step",hi.REFLECT="reflect",hi.DISTANCE="distance",hi.DOT="dot",hi.CROSS="cross",hi.POW="pow",hi.MIX="mix",hi.CLAMP="clamp",hi.REFRACT="refract",hi.SMOOTHSTEP="smoothstep",hi.FACEFORWARD="faceforward";var Ub=class extends or{constructor(t,e,i){super("v4"),this.nodeType="TextureCubeUV",this.value=t,this.uv=e,this.bias=i}bilinearCubeUV(t,e,i,r){let n=new qq(Ub.Nodes.bilinearCubeUV,[e,i,r]);this.colorSpaceTL=this.colorSpaceTL??new Mh(new xr("","v4")),this.colorSpaceTL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(n.build(t)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Mh(new xr("","v4")),this.colorSpaceTR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(n.build(t)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Mh(new xr("","v4")),this.colorSpaceBL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(n.build(t)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Mh(new xr("","v4")),this.colorSpaceBR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(n.build(t)+".br");let s={include:t.isShader("vertex"),ignoreCache:!0};t.addContext(s),this.colorSpaceTLExp=new xr(this.colorSpaceTL.build(t,"v4"),"v4"),this.colorSpaceTRExp=new xr(this.colorSpaceTR.build(t,"v4"),"v4"),this.colorSpaceBLExp=new xr(this.colorSpaceBL.build(t,"v4"),"v4"),this.colorSpaceBRExp=new xr(this.colorSpaceBR.build(t,"v4"),"v4"),t.removeContext();let a=new xr("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=n,a}generate(t,e){if(t.isShader("fragment")){let i=this.uv,r=this.bias||t.context.roughness,n=new qq(Ub.Nodes.roughnessToMip,[r]),s=new hi(n,Ub.Nodes.m0,Ub.Nodes.cubeUV_maxMipLevel,hi.CLAMP),a=new hi(s,hi.FLOOR),o=new hi(s,hi.FRACT),l=this.bilinearCubeUV(t,this.value,i,a),c=this.bilinearCubeUV(t,this.value,i,new to(a,new Pt(1).setReadonly(!0),to.ADD)),h=new hi(l,c,o,hi.MIX);return t.format(h.build(t),"v4",e)}else return console.warn("TextureCubeUVNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)}},$N=Ub;$N.Nodes=function(){let t=new nle(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),e=new qi("float cubeUV_maxMipLevel 8.0",!0),i=new qi("float cubeUV_minMipLevel 4.0",!0),r=new qi("float cubeUV_maxTileSize 256.0",!0),n=new qi("float cubeUV_minTileSize 16.0",!0),s=new xt(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);s.useKeywords=!1;let a=new xt(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);a.useKeywords=!1;let o=new xt(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[t,s,a,e,i,r,n]);o.useKeywords=!1;let l=new qi("float r0 1.0",!0),c=new qi("float v0 0.339",!0),h=new qi("float m0 -2.0",!0),u=new qi("float r1 0.8",!0),d=new qi("float v1 0.276",!0),f=new qi("float m1 -1.0",!0),p=new qi("float r4 0.4",!0),m=new qi("float v4 0.046",!0),g=new qi("float m4 2.0",!0),v=new qi("float r5 0.305",!0),y=new qi("float v5 0.016",!0),x=new qi("float m5 3.0",!0),S=new qi("float r6 0.21",!0),A=new qi("float v6 0.0038",!0),_=new qi("float m6 4.0",!0),M=[l,c,h,u,d,f,p,m,g,v,y,x,S,A,_],E=new xt(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,M);return{bilinearCubeUV:o,roughnessToMip:E,m0:h,cubeUV_maxMipLevel:e}}();var Fv=class extends or{constructor(t){super("v3"),this.nodeType="Normal",this.scope=t??Fv.VIEW}getShared(){return this.scope===Fv.WORLD}build(t,e,i,r){let n=t.context[this.scope+"Normal"];return n?n.build(t,e,i,r):super.build(t,e,i)}generate(t,e,i,r,n){let s;switch(this.scope){case Fv.VIEW:t.isShader("vertex")?s="transformedNormal":s="geometryNormal";break;case Fv.LOCAL:t.isShader("vertex")?s="objectNormal":(t.requires.normal=!0,s="vObjectNormal");break;case Fv.WORLD:t.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(t.requires.worldNormal=!0,s="vWNormal");break}return t.format(s,this.getType(t),e)}},ho=Fv;ho.LOCAL="local",ho.WORLD="world",ho.VIEW="view",ho.NORMAL="normal";oo.addKeyword("viewNormal",function(){return new ho(ho.VIEW)});oo.addKeyword("localNormal",function(){return new ho(ho.NORMAL)});oo.addKeyword("worldNormal",function(){return new ho(ho.WORLD)});var Au=class extends or{constructor(t){super("v3"),this.nodeType="Position",this.scope=t??Au.LOCAL}getType(){switch(this.scope){case Au.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case Au.LOCAL:case Au.WORLD:return!1}return!0}generate(t,e,i,r,n){let s;switch(this.scope){case Au.LOCAL:t.isShader("vertex")?s="transformed":(t.requires.position=!0,s="vPosition");break;case Au.WORLD:if(t.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";t.requires.worldPosition=!0,s="vWPosition";break;case Au.VIEW:s=t.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Au.PROJECTION:s=t.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return t.format(s,this.getType(),e)}},Ec=Au;Ec.LOCAL="local",Ec.WORLD="world",Ec.VIEW="view",Ec.PROJECTION="projection";oo.addKeyword("position",function(){return new Ec});oo.addKeyword("worldPosition",function(){return new Ec(Ec.WORLD)});oo.addKeyword("viewPosition",function(){return new Ec(Ec.VIEW)});var ch=class extends or{constructor(t){super("v3"),this.nodeType="Reflect",this.scope=t??ch.CUBE}getUnique(t){return!t.context.viewNormal}getType(){switch(this.scope){case ch.SPHERE:return"v2"}return this.type}generate(t,e){let i=this.getUnique(t);if(t.isShader("fragment")){let r;switch(this.scope){case ch.VECTOR:{let n=new ho(ho.VIEW),s=t.context.roughness,a=n.build(t,"v3"),o=new Ec(Ec.VIEW).build(t,"v3"),l=s?s.build(t,"f"):void 0,c=`reflect( -normalize( ${o} ), ${a} )`;l&&(c=`normalize( mix( ${c}, ${a}, ${l} * ${l} ) )`);let h=`inverseTransformDirection( ${c}, viewMatrix )`;i?(t.addNodeCode(`vec3 reflectVec = ${h};`),r="reflectVec"):r=h;break}case ch.CUBE:{let n=new ch(ch.VECTOR).build(t,"v3"),s="vec3( -"+n+".x, "+n+".yz )";i?(t.addNodeCode(`vec3 reflectCubeVec = ${s};`),r="reflectCubeVec"):r=s;break}case ch.SPHERE:{let n="normalize( ( viewMatrix * vec4( "+new ch(ch.VECTOR).build(t,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(t.addNodeCode(`vec2 reflectSphereVec = ${n};`),r="reflectSphereVec"):r=n;break}}return t.format(r,this.getType(),e)}else return console.warn("ReflectNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.type,e)}},Oy=ch;Oy.CUBE="cube",Oy.SPHERE="sphere",Oy.VECTOR="vector";var CHe=class extends or{constructor(t=new Vu,e,i){super("v4"),this.nodeType="TextureCube",this.value=t,this.radianceNode=new $N(this.value,e??new Oy(Oy.VECTOR),i),this.irradianceNode=new $N(this.value,new ho(ho.WORLD),new Pt(1).setReadonly(!0))}generate(t,e){return t.isShader("fragment")?(t.require("irradiance"),t.context.bias&&t.context.bias.setTexture(this.value),(t.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(t,e)):(console.warn("TextureCubeNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e))}},PHe=class extends _o{constructor(t=new T5,e,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=t,this.uv=e??new Oy,this.bias=i}getTexture(t,e){return super.generate(t,e,this.value.uuid,"tc")}generate(t,e){var l;if(e==="samplerCube")return this.getTexture(t,e);let i=this.getTexture(t,e),r=(l=this.uv)==null?void 0:l.build(t,"v3"),n=this.bias?this.bias.build(t,"f"):void 0;n===void 0&&t.context.bias&&(n=t.context.bias.setTexture(this).build(t,"f"));let s;n?s="texCubeBias( "+i+", "+r+", "+n+" )":s="texCube( "+i+", "+r+" )";let a={include:t.isShader("vertex"),ignoreCache:!0},o=this.getType(t);return t.addContext(a),this.colorSpace=this.colorSpace??new Mh(new xr("",o)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(t,o),t.removeContext(),t.format(s,o,e)}},DHe=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,RHe=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,IHe=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,LHe=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,OHe=`
layout(location = 1) out vec4 gVelocity;
`,BHe=`
    // Discard fully transparent pixels 
    if (gl_FragColor.a <= 0.0) discard;

    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);
`,Kq=["x","y","z","w"],FHe=["float","vec2","vec3","vec4"],kHe={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},NHe={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},ale=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function t(e,i){return e.deps.length-i.deps.length}return function(e,i){let r=this.getIncludes(e,i);if(!r)return"";let n="";r=r.sort(t);for(let s=0;s<r.length;s++)r[s].src&&(n+=r[s].src+`
`);return n}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(t,e){this.addVertexParsCode(DHe),this.addFragmentParsCode(RHe),this.buildShader("vertex",t),this.buildShader("fragment",e);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode(`
				#ifndef SHAPEBLEND 
					vObjectNormal = normal;
				#else
					vObjectNormal = objectNormal;
				#endif
			`)),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(IHe),this.addFragmentFinalCode(LHe)),this}buildShader(t,e){this.resultCode[t]=e.build(this.setShader(t),"v4")}setMaterial(t,e){return this.defines={},this}addFlow(t,e,i){return this.addSlot(t).addCache(e).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(t){return this.cache=t??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(t){return this.context=Object.assign({},this.context,t),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(t){return this.slot=t||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(t,e){this.fragmentVariables[t]===void 0&&(this.addFragmentCode(`${e} ${t};`),this.fragmentVariables[t]="")}addFragmentParsVariable(t,e){this.fragmentParsVariables[t]===void 0&&(this.addFragmentParsCode(`${e} ${t};`),this.fragmentParsVariables[t]="")}addVertexParsVariable(t,e){this.vertexParsVariables[t]===void 0&&(this.addVertexParsCode(`${e} ${t};`),this.vertexParsVariables[t]="")}addVertexCode(t){this.addCode(t,"vertex")}addFragmentCode(t){this.addCode(t,"fragment")}addCode(t,e){this.code[e??this.shader]+=t+`
`}addVertexNodeCode(t){this.addNodeCode(t,"vertex")}addFragmentNodeCode(t){this.addNodeCode(t,"fragment")}addNodeCode(t,e){this.nodeCode[e??this.shader]+=t+`
`}clearNodeCode(t){t=t??this.shader;let e=this.nodeCode[t];return this.nodeCode[t]="",e}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(t){this.addFinalCode(t,"vertex")}addFragmentFinalCode(t){this.addFinalCode(t,"fragment")}addFinalCode(t,e){this.finalCode[e??this.shader]+=t+`
`}addVertexParsCode(t){this.addParsCode(t,"vertex")}addFragmentParsCode(t){this.addParsCode(t,"fragment")}addParsCode(t,e){this.parsCode[e??this.shader]+=t+`
`}addVaryCode(t){this.addVertexParsCode(t),this.addFragmentParsCode(t)}isCache(t){return this.caches.indexOf(t)!==-1}isSlot(t){return this.slots.indexOf(t)!==-1}define(t,e){this.defines[t]=e===void 0?1:e}require(t){this.requires[t]=!0}isDefined(t){return this.defines[t]!==void 0}getVar(t,e,i,r="varying",n="V",s=""){let a=this.getVars(r),o=a[t];if(!o){let l=a.length;o={name:i||"node"+n+l+(s?"_"+s:""),type:e},a.push(o),a[t]=o}return o}getTempVar(t,e,i,r){return this.getVar(t,e,i,this.shader,"T",r)}getAttribute(t,e){if(!this.attributes[t]){let i=this.getVar(t,e);this.addVertexParsCode("attribute "+e+" "+t+";"),this.addVertexFinalCode(i.name+" = "+t+";"),this.attributes[t]={varying:i,name:t,type:e}}return this.attributes[t]}getCode(t){return[this.prefixCode,this.parsCode[t],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[t],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[t],"uniform"),this.getIncludesCode("consts",t),this.getIncludesCode("structs",t),this.getIncludesCode("functions",t),"void main() {",this.getVarListCode(this.getVars(t)),this.code[t],this.resultCode[t],this.finalCode[t],"}"].join(`
`)}getVarListCode(t,e){e=e??"";let i="";for(let r=0,n=t.length;r<n;++r){let s=t[r],a=s.type,o=s.name,l=s.size,c=this.getFormatByType(a);if(c===void 0)throw new Error("Node pars "+c+" not found.");c.includes("[]")?i+=e+" "+c.substring(0,c.length-2)+" "+o+`[${l}];
`:i+=e+" "+c+" "+o+`;
`}return i}getVars(t){return this.inputs.vars[t??this.shader]}getNodeData(t){let e=t instanceof Jn?t.uuid:t;return this.nodeData[e]=this.nodeData[e]||{}}createUniform(t,e,i,r,n,s){if(e.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new Xq({type:e,size:i.size,name:r||"nodeUA"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[t].push(l),a[t][l.name]=l,this.uniforms[l.name]=l,l}else{let a=this.inputs.uniforms,o=a.list.length,l=new Xq({type:e,name:r||"nodeU"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[t].push(l),a[t][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(t,e,i,r,n){return this.createUniform("vertex",t,e,i,r,n)}createFragmentUniform(t,e,i,r,n){return this.createUniform("fragment",t,e,i,r,n)}include(t,e,i){var s;let r;if(t=typeof t=="string"?oo.get(t):t,this.context.include===!1)return t.name;t instanceof xt?r=this.includes.functions:t instanceof qi?r=this.includes.consts:t instanceof nle&&(r=this.includes.structs);let n=r[this.shader]=r[this.shader]||[];if(t){let a=n[t.name];if(a||(a=n[t.name]={node:t,deps:[]},n.push(a),a.src=t.build(this,"source")),t instanceof xt&&e&&n[e.name]&&n[e.name].deps.indexOf(t)===-1&&(n[e.name].deps.push(t),(s=t.includes)==null?void 0:s.length)){let o=0;do this.include(t.includes[o++],e);while(o<t.includes.length)}return i&&(a.src=i),t.name}else throw new Error("Include not found.")}colorToVectorProperties(t){return t.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(t){return t.replace(/c/g,"v3")}getIncludes(t,e){return this.includes[t][e||this.shader]}getConstructorFromLength(t){return FHe[t-1]}isTypeMatrix(t){return/^m/.test(t)}getTypeLength(t){return t==="f"?1:parseInt(this.colorToVector(t).substr(1))}getTypeFromLength(t){return t===1?"f":"v"+t}findNode(...t){for(let e=0;e<arguments.length;e++){let i=t[e];if(i!=null&&i.isNode)return i}}resolve(...t){for(let e=0;e<arguments.length;e++){let i=t[e];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case zg:case Gg:return new PHe(i);case __:return new CHe(new Vu(i));default:return new Vu(i)}else{if(i.isVector2)return new zs(i);if(i.isVector3)return new bl(i);if(i.isVector4)return new Ru(i)}}}}format(t,e,i){switch(this.colorToVector(i+" <- "+e)){case"f <- v2":return t+".x";case"f <- v3":return t+".x";case"f <- v4":return t+".x";case"f <- i":case"f <- b":return"float( "+t+" )";case"v2 <- f":return"vec2( "+t+" )";case"v2 <- v3":return t+".xy";case"v2 <- v4":return t+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+t+" ) )";case"v3 <- f":return"vec3( "+t+" )";case"v3 <- v2":return"vec3( "+t+", 0.0 )";case"v3 <- v4":return t+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+t+" ) )";case"v4 <- f":return"vec4( "+t+" )";case"v4 <- v2":return"vec4( "+t+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+t+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+t+" ) )";case"i <- f":case"i <- b":return"int( "+t+" )";case"i <- v2":return"int( "+t+".x )";case"i <- v3":return"int( "+t+".x )";case"i <- v4":return"int( "+t+".x )";case"b <- f":return"( "+t+" != 0.0 )";case"b <- v2":return"( "+t+" != vec2( 0.0 ) )";case"b <- v3":return"( "+t+" != vec3( 0.0 ) )";case"b <- v4":return"( "+t+" != vec4( 0.0 ) )";case"b <- i":return"( "+t+" != 0 )"}return t}getTypeByFormat(t){return kHe[t]||t}getFormatByType(t){return NHe[t]||t}getUUID(t,e){return e=e!==void 0?e:!0,e&&this.cache&&(t=this.cache+"-"+t),t}getElementByIndex(t){return Kq[t]}getIndexByElement(t){return Kq.indexOf(t)}isShader(t){return this.shader===t}setShader(t){return this.shader=t,this}mergeDefines(t){for(let e in t)this.defines[e]=t[e];return this.defines}mergeUniform(t){for(let e in t)this.uniforms[e]=t[e];return this.uniforms}getTextureEncodingFromMap(t){let e;return t?t.isTexture&&(e=t.encoding):e=Oc,e===Oc&&this.context.gamma&&(e=fi),e}},on=class extends _o{constructor(t=0,e,i,r){super("c"),this.nodeType="Color",this.value=t instanceof Qs?t:new Qs(t||0,e,i,r)}setRGBA(t){this.value.setRGBA(t.r,t.g,t.b,t.a)}generate(t,e,i,r,n,s){i=t.getUUID(i??this.getUUID()),r=r??this.getType(t);let a=t.getNodeData(i),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(t,"f");t.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(t,e,i,r,n,s):t.isShader("vertex")?(a.vertex||(a.vertex=t.createVertexUniform(r,this,n,s,this.getLabel())),t.format(a.vertex.name,r,e)):(a.fragment||(a.fragment=t.createFragmentUniform(r,this,n,s,this.getLabel())),t.format(a.fragment.name,r,e))}generateReadonly(t,e,i,r,n,s){return t.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,e)}},cr=class extends _o{constructor(t){super("i"),this.nodeType="Int",this.value=Math.floor(t??0)}generateReadonly(t,e,i,r,n,s){return t.format(this.value.toString(),r,e)}},Fa=class extends _o{constructor(t){super("b"),this.nodeType="Bool",this.value=t??!1}generateReadonly(t,e,i,r){return t.format(this.value?"true":"false",r,e)}},Em=class extends _o{constructor(t=1,e){super("f[]"),this.nodeType="FloatArray",this.size=t,this.value=Array.isArray(e)?e:typeof e=="number"?new Array(t).fill(e):new Array(t).fill(0)}},EG=class extends _o{},UHe=class extends EG{constructor(t){super("v3"),this.image=t,this._value=new N}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},JN=class extends EG{constructor(t,e,i=1008,r=1006){super("t"),this.image=t,this.wrap=e,this.minFilter=i,this.magFilter=r}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},ole=class extends _o{constructor(t){super("m3"),this.nodeType="Matrix3",this.value=t??new Bn}generateReadonly(t,e,i,r,n,s){return t.format("mat3("+this.value.elements.join(", ")+")",r,e)}get elements(){return this.value.elements}set elements(t){this.value.fromArray(t)}},Wh=class extends _o{constructor(t){super("m4"),this.nodeType="Matrix4",this.value=t??new st}generateReadonly(t,e,i,r,n,s){return t.format("mat4("+this.value.elements.join(", ")+")",r,e)}get elements(){return this.value.elements}set elements(t){this.value.fromArray(t)}};function Qq(t,e,i,r=0){t.setUvTransform(i[0],i[1],e[0],e[1],0,0,0).premultiply(new Bn().makeRotation(r*Et.DEG2RAD))}var zHe=class extends ole{constructor(t,e,i=0){super(new Bn),this.repeat=t,this.offset=e,this.rotation=i,Qq(this.value,t,e,i)}updateMatrix(){Qq(this.value,this.repeat,this.offset,this.rotation)}},Mm=class extends _o{constructor(t=1,e){super("v4[]"),this.nodeType="Vector4Array",this.size=t,this.value=Array.isArray(e)?e:e instanceof si?new Array(t).fill(e):new Array(t).fill(new si(0))}},$q=class extends or{constructor(t,e,i,r){super("v3"),this.nodeType="Blend",this.a=t,this.b=e,this.alpha=i,this.mode=r}generate(t,e){if(t.isShader("fragment")){let i=[];return i.push(this.a.build(t,"c")),i.push(this.b.build(t,"c")),i.push(this.alpha.build(t,"f")),i.push(this.mode.build(t,"i")),t.format("spe_blend("+i.join(",")+")",this.getType(t),e)}else return console.warn("BlendNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},lle=class extends or{constructor(t,e){super("v3"),this.nodeType="CustomColor",this.color=t,this.alpha=e,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){let i=t.include(lle.Nodes.customColor);t.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.color.build(t,"v3")),r.push(this.mask?`luminance(${this.mask.build(t,"v3")})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("CustomColorNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},ZN=lle;ZN.Nodes=function(){return{customColor:new xt(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}}();var cle=class extends or{constructor(t,e){super("v3"),this.nodeType="CustomNormal",this.cnormal=t,this.alpha=e,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){let i=t.include(cle.Nodes.customNormal);t.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.cnormal.build(t,"v3")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("CustomNormalNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},hle=cle;hle.Nodes=function(){return{customNormal:new xt(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}}();var zb=class extends or{constructor(t,e,i,r,n,s,a,o,l,c,h,u){super("v3"),this.nodeType="CustomTexture",this.texture=t,this.textureSize=e,this.crop=i,this.projection=r,this.axis=n,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=u,this.alpha=c,this.mode=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){t.require("position"),t.require("normal"),t.require("uv"),t.requires.uv=[!0],t.extensions.shaderTextureLOD=!0,t.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=t.include(zb.Nodes.cylindrical);break;case 2:r=t.include(zb.Nodes.spherical);break;case 1:let s=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],a=["zy","xz","xy"][this.axis.value],o=new xt(`
		vec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${a})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, ${s}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);r=t.include(o);break;case 4:r=t.include(zb.Nodes.triplanar);break;default:r=t.include(zb.Nodes.uv);break}t.addFragmentVariable(this.calpha,"float");let n=[];if(n.push("normal"),n.push(this.texture.generate(t,"t")),n.push(this.textureSize.build(t,"v2")),n.push(this.crop.build(t,"f")),n.push(this.mat.build(t,"mat3")),n.push(this.size.build(t,"v2")),n.push(this.blending.build(t,"f")),n.push(this.isMask.build(t,"b")),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.mode.build(t,"i")),n.push(this.calpha),this.projection.value===4){let s=`${i}_writeUvs`,a=s+"0",o=s+"1",l=s+"2",c=`${i}_triplanarWeights`;t.addFragmentVariable(a,"vec2"),t.addFragmentVariable(o,"vec2"),t.addFragmentVariable(l,"vec2"),t.addFragmentVariable(c,"vec3"),n.push(a),n.push(o),n.push(l),n.push(c)}else{let s=`${i}_writeUvs`;t.addFragmentVariable(s,"vec2"),n.push(s)}return t.format(r+"("+n.join(",")+")",this.getType(t),e)}},MG=zb;MG.Nodes=function(){let t=new xt(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),e=new xt(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new xt(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),r=new xt(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:t,spherical:e,uv:i,triplanar:r}}();var Gb=class extends or{constructor(t,e,i,r,n,s,a,o,l,c,h,u){super("v3"),this.nodeType="Depth",this.gradientType=t,this.smooth=e,this.near=i,this.far=r,this.isVector=n,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=c,this.isMask=u,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new xt(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[Gb.Nodes.vectorLinearWorldSpaceDepth,Gb.Nodes.vectorLinearObjectSpaceDepth,Gb.Nodes.vectorSphericalObjectSpaceDepth,Gb.Nodes.vectorSphericalWorldSpaceDepth]);if(t.isShader("fragment")){t.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&t.define(`${i}_SMOOTH`),this.isVector.value>.5&&t.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&t.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&t.define(`${i}_WORLDSPACE`),t.require("worldPosition"),t.addFragmentVariable(this.calpha,"float");let n=t.include(r),s=[];return s.push(this.near.build(t,"f")),s.push(this.far.build(t,"f")),s.push(this.origin.build(t,"v3")),s.push(this.direction.build(t,"v3")),s.push(this.colors.build(t,"v4[]")),s.push(this.steps.build(t,"f[]")),s.push(this.isMask.build(t,"b")),s.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),s.push(this.alpha.build(t,"f")),s.push(this.calpha),t.format(n+"("+s.join(",")+")",this.getType(t),e)}else return console.warn("DepthNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},ule=Gb;ule.Nodes=function(){let t=new xt(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),e=new xt(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new xt(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new xt(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:t,vectorLinearObjectSpaceDepth:e,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var GHe=class extends or{constructor(t,e,i,r,n,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=t,this.bias=e,this.scale=i,this.intensity=r,this.factor=n,this.isMask=o,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("vWorldViewDir"),t.require("worldNormal"),t.isShader("fragment")){t.addFragmentVariable(this.calpha,"float");let i=new xt(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),r=t.include(i),n=[];return n.push(this.color.build(t,"c")),n.push(this.bias.build(t,"f")),n.push(this.scale.build(t,"f")),n.push(this.intensity.build(t,"f")),n.push(this.factor.build(t,"f")),n.push(this.isMask.build(t,"b")),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.mode.build(t,"i")),n.push(this.calpha),t.format(r+"("+n.join(",")+")",this.getType(t),e)}else return console.warn("FresnelNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},dle=class extends or{constructor(t,e,i,r,n,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=t,this.smooth=e,this.colors=i,this.steps=r,this.offset=n,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){t.define("GRAD_MAX",10),t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let i=t.include(dle.Nodes.gradient),r=[];return r.push(this.gradientType.build(t,"i")),r.push(this.smooth.build(t,"b")),r.push(this.colors.build(t,"v4[]")),r.push(this.steps.build(t,"f[]")),r.push(this.offset.build(t,"v2")),r.push(this.morph.build(t,"v2")),r.push(this.angle.build(t,"f")),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("GradientNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},fle=dle;fle.Nodes=function(){return{gradient:new xt(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}}();var ple=class extends or{constructor(t,e,i,r,n){super("v3"),this.nodeType="Matcap",this.texture=t,this.isMask=r,this.alpha=e,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=n}generate(t,e){if(t.isShader("fragment")){t.addFragmentVariable(this.calpha,"float");let i=t.include(ple.Nodes.matcap);t.require("normal"),t.requires.normal=!0;let r=[];return r.push(this.texture.generate(t,"t")),r.push("normal"),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.mode.build(t,"i")),r.push(this.calpha),r.push(this.rotation.build(t,"f")),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("MatcapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},mle=ple;mle.Nodes=function(){return{matcap:new xt(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) );
					uv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;
					uv = uv * 0.495 + 0.5;
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}}();var no=function(){let t=new xt(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),e=new xt(`float simplexFast(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 mediump vec3 x = p - s + dot(s, vec3(G3));
			 mediump vec3 hs = s;
			 
			 mediump vec3 e = step(vec3(0.0), x - x.yzx);
			 mediump vec3 i1 = e*(1.0 - e.zxy);
			 mediump vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 mediump vec3 x1 = x - i1 + G3;
			 mediump vec3 x2 = x - i2 + 2.0*G3;
			 mediump vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 mediump vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(hs), x);
			 d.y = dot(random3(hs + i1), x1);
			 d.z = dot(random3(hs + i2), x2);
			 d.w = dot(random3(hs + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[t]);e.keywords.F3=new qi("float F3 0.3333333"),e.keywords.G3=new qi("float G3 0.1666667");let i=new xt(`float simplexPrecise(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[t]);i.keywords.F3=new qi("float F3 0.3333333"),i.keywords.G3=new qi("float G3 0.1666667");let r=new xt(`float simplexFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplexFast(m * rot1)
				 + 0.2666667 * simplexFast(2.0 * m * rot2)
				 + 0.1333333 * simplexFast(4.0 * m * rot3)
				 + 0.0666667 * simplexFast(8.0 * m);
		}`,[e]),n=new xt("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new xt("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new xt(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[n,s]),o=new xt("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),l=new xt("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),c=new xt(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[l]),h=new xt(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[c]);h.keywords.NUM_OCTAVES=new qi("int NUM_OCTAVES 5");let u=new xt("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),d=new xt(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[n,s,u]),f=new xt(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),p=new xt(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),m=new xt(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),g=new xt(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),v=new xt(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),y=new xt(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),x=new xt(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			// Second pass for edge distance  
			// skip for styles don't need
			if (style != 0 &&  style != 5 && style != 7)
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[f,p,m,g,v,y]);return{simplexFast:e,simplexPrecise:i,simplexFractal:r,simplexAshima:a,fbm:h,perlin:d,voronoi:x}}(),gle=class extends or{constructor(t,e,i,r,n,s,a,o,l,c,h,u,d,f,p,m,g,v,y){super("v3"),this.nodeType="Noise",this.scale=t,this.size=e,this.move=i,this.fA=r,this.fB=n,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=c,this.noiseType=u,this.voronoiStyle=f,this.highCut=p,this.lowCut=m,this.smoothness=g,this.seed=v,this.quality=y,this.isMask=d,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e,i,r,n){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let s=["simplexFast","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseType.value],a=s=="voronoi"?`
		float v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${s}(st),
					   ${s}(st + vec3(1.0)),
					   ${s}(st + vec3(1.0)));
		vec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${s}(st * q));
		float f = ${s}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,o=new xt(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${a}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[no.simplexFast,no.simplexFractal,no.simplexAshima,no.fbm,no.perlin,no.voronoi]),l=t.include(o),c=[];return c.push(this.scale.build(t,"f")),c.push(this.size.build(t,"v3")),c.push(this.move.build(t,"f")),c.push(this.fA.build(t,"v2")),c.push(this.fB.build(t,"v2")),c.push(this.distortion.build(t,"v2")),c.push(this.colorA.build(t,"v4")),c.push(this.colorB.build(t,"v4")),c.push(this.colorC.build(t,"v4")),c.push(this.colorD.build(t,"v4")),c.push(this.voronoiStyle.build(t,"i")),c.push(this.highCut.build(t,"f")),c.push(this.lowCut.build(t,"f")),c.push(this.smoothness.build(t,"f")),c.push(this.seed.build(t,"f")),c.push(this.quality.build(t,"i")),c.push(this.isMask.build(t,"b")),c.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),c.push(this.alpha.build(t,"f")),c.push(this.calpha),t.format(l+"("+c.join(",")+")",this.getType(t),e)}};gle.numOctaves=5;var vle=class extends or{constructor(t,e,i,r,n,s,a,o,l,c,h,u,d,f,p,m){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=t,this.contourColor=e,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=n,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=c,this.compensation=h,this.resolution=u,this.normalMap=d,this.depthMap=f,this.pixelRatio=p,this.alpha=m,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(t.require("vWorldViewDir"),t.require("worldNormal"),t.extensions.derivatives=!0,this.compensation.value&&t.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let r=this.outlineWidth.build(t,"f"),n=this.resolution.build(t,"v2"),s=this.compensation.build(t,"b"),a=this.pixelRatio.build(t,"f");t.addVertexParsVariable("randomColor","attribute vec3"),t.addVertexParsVariable("extrudeNormal","attribute vec3"),t.addVertexParsVariable(r,"uniform float"),t.addVertexParsVariable(n,"uniform vec2"),t.addVertexParsVariable(s,"uniform bool"),t.addVertexParsVariable(a,"uniform float"),t.addVertexParsVariable("vID","flat out float"),t.addFragmentParsVariable("vID","flat in float"),t.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${i}_offset = vec2(0.0);
                if (${s}) {
                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${n} * (${r} / 2.0) * ${i}_clipPosition.w * 2.0 * ${a};
                    ${i}_clipPosition.xy += ${i}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${i}_clipPosition;
                }
            `)}if(t.isShader("fragment")){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let r=t.include(vle.Nodes.outline),n=[];return n.push(this.outlineColor.build(t,"c")),n.push(this.contourColor.build(t,"c")),n.push(this.outlineWidth.build(t,"f")),n.push(this.contourWidth.build(t,"f")),n.push(this.contourThreshold.build(t,"f")),n.push(this.outlineThreshold.build(t,"f")),n.push(this.contourFrequency.build(t,"f")),n.push(this.outlineSmoothing.build(t,"f")),n.push(this.contourDirection.build(t,"v3")),n.push(this.positionalLines.build(t,"b")),n.push(this.resolution.build(t,"v2")),n.push(this.normalMap.getTexture(t,"t")),n.push(this.depthMap.getTexture(t,"t")),n.push(this.pixelRatio.build(t,"f")),n.push(this.compensation.build(t,"b")),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,t.format(r+"("+n.join(",")+")",this.getType(t),e)}else return console.warn("OutlineNode is not compatible with "+t.shader+" shader."),""}},yle=vle;yle.Nodes=function(){let t=new xt(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new xt(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[t])}}();var Eu=class extends or{constructor(t,e,i,r,n,s,a,o,l,c,h,u,d,f,p,m,g,v){super("v3"),this.nodeType="Pattern",this.style=t,this.projection=e,this.axis=i,this.blending=r,this.offset=n,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=c,this.smoothness=h,this.zigzag=u,this.rotation=d,this.vertical=f,this.horizontal=p,this.sides=m,this.isMask=v,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){t.require("position"),t.require("uv"),t.requires.uv=[!0],t.require("normal"),t.requires.normal=!0,t.addFragmentVariable(this.calpha,"float");let i;switch(this.style.value){case 0:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave";break;default:i="circle";break}let r=`g${this.uuid.toString().replace(/-/g,"")}`,n=new xt(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),s=new xt(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),a="";if(this.projection.value===4){let h=this.style.value===2?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,u=this.style.value===2?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,d=this.style.value===2?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;a=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${h};
				float d1 = ${u};
				float d2 = ${d};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let h=this.style.value===2?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,u="";this.axis.value===0?u=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?u=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,u=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let d="";switch(this.projection.value){case 0:d="custom_uv = vUv.st;";break;case 1:break;case 2:d=`
							vec3 p = position;
							${u}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}a=`
				vec2 custom_uv;
				${d}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${h};
				`}let o=new xt(`vec3 ${r}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${a}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[s,n,Eu.DrawFunctions.circle,Eu.DrawFunctions.ring,Eu.DrawFunctions.polygon,Eu.DrawFunctions.cross,Eu.DrawFunctions.diamond,Eu.DrawFunctions.checkerboard,Eu.DrawFunctions.line,Eu.DrawFunctions.wave]),l=t.include(o),c=[];return c.push("normal"),c.push(this.blending.build(t,"f")),c.push(this.style.build(t,"i")),c.push(this.offset.build(t,"v2")),c.push(this.colorA.build(t,"v4")),c.push(this.colorB.build(t,"v4")),c.push(this.frequency.build(t,"v2")),c.push(this.size.build(t,"f")),c.push(this.variation.build(t,"f")),c.push(this.smoothness.build(t,"f")),c.push(this.zigzag.build(t,"f")),c.push(this.rotation.build(t,"f")),c.push(this.vertical.build(t,"v2")),c.push(this.horizontal.build(t,"v2")),c.push(this.sides.build(t,"i")),c.push(this.isMask.build(t,"b")),c.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),c.push(this.alpha.build(t,"f")),c.push(this.calpha),t.format(l+"("+c.join(",")+")",this.getType(t),e)}else return console.warn("PatterNode is not compatible with "+t.shader+" shader."),t.format("vec3(0.0)",this.getType(t),e)}},xle=Eu;xle.DrawFunctions=function(){let t=new xt(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),e=new xt(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[t]),i=new xt(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[e]),r=new xt(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[e]),n=new xt(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[e]),s=new xt(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[e]),a=new xt(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[e]),o=new xt(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new xt(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[e]),c=new xt(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:e,circle:i,ring:r,polygon:n,cross:s,diamond:a,checkerboard:o,line:l,wave:c}}();var ble=class extends or{constructor(t,e,i,r,n,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=t,this.movement=e,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=n,this.offset=s,this.isMask=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("vWorldViewDir"),t.require("worldNormal"),t.isShader("fragment")){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let i=t.include(ble.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(t,"f")),r.push(this.movement.build(t,"f")),r.push(this.wavelengths.build(t,"v3")),r.push(this.noiseStrength.build(t,"f")),r.push(this.noiseScale.build(t,"f")),r.push(this.offset.build(t,"v3")),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("RainbowNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},wle=ble;wle.Nodes=function(){let t=new xt(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
				float f = 0.0;
				
				if (noiseStrength != 0.0) {
					vec3 st = position / noiseScale;
					float noise = simplexFast(1.6 * st + vec3(1.8, 1.5, 1.9) * simplexFast(st) + vec3(1.7, 9.2, 1.0));
					f = noise * noiseStrength;
				}

				vec3 waves = wavelengths * vec3(1.0, 0.8, 0.6) + 1.0;
				float angle = dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal));

				mediump vec3 color = cos((((filmThickness + f) / waves) * angle) + movement);
				return .5 + .5 * color;
			 }`,[no.simplexFast]);return{rainbow:new xt(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				mediump vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
			 }`,[t])}}();var Sle=class extends or{constructor(t,e,i,r,n,s,a,o,l,c){super("v3"),this.nodeType="Toon",this.positioning=t,this.colors=e,this.steps=i,this.source=r,this.isWorldSpace=n,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("worldNormal"),t.require("worldPosition"),t.isShader("fragment")){t.define("COLORS_MAX",10),t.addFragmentVariable(this.calpha,"float");let i=t.include(Sle.Nodes.toon),r=[];return r.push(this.positioning.build(t,"i")),r.push(this.colors.build(t,"v4[]")),r.push(this.steps.build(t,"f[]")),r.push(this.source.build(t,"v3")),r.push(this.isWorldSpace.build(t,"b")),r.push(this.noiseStrength.build(t,"f")),r.push(this.noiseScale.build(t,"f")),r.push(this.shadowColor.build(t,"v4")),r.push(this.offset.build(t,"v3")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("ToonNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},_le=Sle;_le.Nodes=function(){let t=new xt(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),e=new xt(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new xt(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[e]),r=new xt(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),n=new xt(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new xt(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplexFast(st),
					// 	simplexFast(st + vec3(111.1, 143.89, 217.19)),
					// 	simplexFast(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[no.simplexFast,t,i,n])}}();var VHe=function(){return{textureBicubic:new xt(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}}();function HHe(t,e){return t>=e?new ye(e/t,1):new ye(1,t/e)}var Ale=class extends or{constructor(t,e,i,r,n,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=t,this.ior=e,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=n,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.extensions.shaderTextureLOD=!0,t.extensions.derivatives=!0,t.isShader("fragment")){t.define("NUM_SAMPLES",6),t.define("BLUR_SLOD",Math.pow(2,Kt.transmissionLod.value)),t.require("worldPosition"),t.requires.worldNormal=!0,t.requires.modelMatrix=!0,t.requires.projectionMatrix=!0,t.addFragmentVariable(this.calpha,"float");let i=t.include(Ale.Nodes.transmission),r=[];return r.push(this.thickness.build(t,"f")),r.push(this.ior.build(t,"f")),r.push(this.roughness.build(t,"f")),r.push(this.transmissionSamplerSize.build(t,"v2")),r.push(this.transmissionSamplerMap.getTexture(t,"t")),r.push(this.transmissionDepthMap.getTexture(t,"t")),r.push(this.aspectRatio.build(t,"v2")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("TransmissionNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},Ele=Ale;Ele.Nodes=function(){let t=new xt(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),e=new xt(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new xt(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),r=new xt(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[VHe.textureBicubic,i,t]),n=new xt(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[r,e]);return{transmission:new xt(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[n])}}();var eU=(t=>(t.NOISE="noise",t.MAP="map",t))(eU||{}),Mle=class extends or{constructor(t,e,i,r,n,s,a,o,l,c,h){super("v3"),this.displacementTypeIndex=new cr(0),this.nodeType="VertexDisplacement",this.intensity=t,this.movementOrTexture=e,Object.values(eU)[this.displacementTypeIndex.value]==="map"&&(this.mat=new ole(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=c,this.noiseFunctionIndex=h,this.voronoiStyle=r,this.smoothness=n,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(t,e){if(t.isShader("vertex")){t.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(eU)[this.displacementTypeIndex.value]){case"map":{i=t.include(Mle.Nodes.map),r.push(this.movementOrTexture.getTexture(t,"t")),r.push("uv"),r.push(this.cropOrOffset.build(t,"f")),this.mat&&r.push(this.mat.build(t,"mat3"));break}case"noise":{let n=["simplexPrecise","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseFunctionIndex.value],s=new xt(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),a=n=="voronoi"?`
					float v = ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,o=new xt(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${a}
						}`,[no.simplexPrecise,no.simplexFractal,no.simplexAshima,no.fbm,no.perlin,no.voronoi]),l=new xt(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[o,s]);i=t.include(l),r.push(this.scale.build(t,"f")),r.push(this.cropOrOffset.build(t,"v3")),r.push(this.movementOrTexture.build(t,"f")),r.push(this.voronoiStyle.build(t,"i")),r.push(this.smoothness.build(t,"f")),r.push(this.seed.build(t,"f")),r.push(this.highCut.build(t,"f")),r.push(this.lowCut.build(t,"f")),r.push(this.quality.build(t,"i"));break}}return r.push(this.intensity.build(t,"f")),r.push("displaced_normal"),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("VertexDisplacementNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},Tle=Mle;Tle.Nodes=function(){let t=new xt(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),e=new xt(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new xt(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[t,e])}}();var Kt={normalRenderTarget:new Vu,normalRenderTargetDepth:new Vu,transmissionRenderTarget:new Vu,aspectRatio:new zs,transmissionSize:new zs(2048,2048),transmissionRenderTargetDepth:new Vu,aoRenderTarget:new Vu,aoEnabled:new Fa,pixelRatioNode:new Pt(1),resolution:new zs,penumbraSize:new Em(5,.5),frameIndex:new cr(0),transmissionLod:new cr(2)};for(let t of Object.values(Kt))t.isRenderGlobal=!0;var Cle={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.9.82/build/ui.wasm"},TG=class extends Jn{constructor(){super("basic"),this.nodeType="Basic",this.color=new on(Yo),this.shadingAlpha=new Pt(1),this.shadingBlend=new cr(0),this.previousModelViewMatrix=new Wh,this.previouseProjectionMatrix=new Wh}get category(){return"phong"}generate(t){let e;if(t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:Kt.frameIndex}),t.mergeUniform({resolution:Kt.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(V1.merge([yt.fog])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{this.color===void 0&&(this.color=new on(Yo)),this.color.analyze(t,{slot:"color"}),this.alpha&&this.alpha.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"});let i=this.color.flow(t,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(t,"f"):void 0,n=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0,s=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0;t.requires.transparent=r!==void 0,t.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let a=["#include <normal_fragment_begin>",i.code];r&&a.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),s?a.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):a.push(`vec3 finalColor = ${i.result};`);let o="1.0";this.mask&&(this.mask.analyze(t),o=`luminance(${this.mask.flow(t,"v3").result})`),r?a.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} * ${o} );`):a.push("gl_FragColor = vec4("+i.result+", 1.0 );"),n&&a.push(`gl_FragColor.a *= ${n.result};`),a.push("#include <fog_fragment>","#include <dithering_fragment>"),e=a.join(`
`)}return e}},jHe=class extends Jn{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new on(Yo),this.emissive=new on(0),this.emissiveIntensity=new Pt(1),this.previousModelViewMatrix=new Wh,this.previouseProjectionMatrix=new Wh,this.shadingAlpha=new Pt(1),this.shadingBlend=new cr(0),this.occlusion=new Fa(!0)}get category(){return"lambert"}build(t){let e;if(t.define("LAMBERT"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:Kt.frameIndex}),t.mergeUniform({resolution:Kt.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(V1.merge([yt.fog,yt.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),r.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:Kt.penumbraSize}),t.mergeUniform({frameIndex:Kt.frameIndex}),t.mergeUniform({aoMap:Kt.aoRenderTarget}),t.mergeUniform({aoEnabled:Kt.aoEnabled}),this.color===void 0&&(this.color=new on(Yo)),this.color.analyze(t,{slot:"color"}),this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let i=this.color.flow(t,"c",{slot:"color"}),r=this.emissive.flow(t,"c",{slot:"emissive"}),n=this.emissiveIntensity.flow(t,"f",{slot:"emissive"}),s=this.occlusion.flow(t,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(t,"f"),o=this.shadingBlend.flow(t,"i"),l=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(t,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=c!==void 0,t.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let u=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];u.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&u.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),u.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&u.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+n.result+";"),u.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(t),d=`luminance(${this.mask.flow(t,"v3").result})`),u.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );

					outgoingLight *= ao;
				}
				`),l&&u.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&u.push(`gl_FragColor.a *= ${h.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=u.join(`
`)}return e}},x1=function(){let t=new xt(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),e=new xt(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:t,perturbNormalArb:e}}(),WHe=class extends Jn{constructor(){super("phong"),this.nodeType="Phong",this.color=new on(Yo),this.specular=new on(1118481),this.shininess=new Pt(30),this.previousModelViewMatrix=new Wh,this.previouseProjectionMatrix=new Wh,this.shadingAlpha=new Pt(1),this.shadingBlend=new cr(0),this.occlusion=new Fa(!0)}get category(){return"phong"}build(t){let e;if(t.define("PHONG"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:Kt.frameIndex}),t.mergeUniform({resolution:Kt.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(V1.merge([yt.fog,yt.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:Kt.penumbraSize}),t.mergeUniform({frameIndex:Kt.frameIndex}),t.mergeUniform({aoMap:Kt.aoRenderTarget}),t.mergeUniform({aoEnabled:Kt.aoEnabled}),this.color===void 0&&(this.color=new on(Yo)),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t);let i=this.occlusion.flow(t,"b",{slot:"occlusion"});this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let r=this.color.flow(t,"c",{slot:"color"}),n=this.specular.flow(t,"c"),s=this.shininess.flow(t,"f"),a=this.shadingAlpha.flow(t,"f"),o=this.shadingBlend.flow(t,"i"),l=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(t,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=c!==void 0,t.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let u=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){t.include(x1.dHdxy),t.include(x1.perturbNormalArb);let f=this.bumpMap.texture.flow(t,"t"),p=this.bumpMap.flow(t,"v3"),m=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",g="";this.bumpMap.projection.value===4?g=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${f.result}, uv0, ${m});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${f.result}, uv1, ${m});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${f.result}, uv2, ${m});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:g=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${f.result}, bumpMapCachedUv, ${m});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,u.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${p.result};
					${g}
					`)}u.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",n.code,"	vec3 specular = "+n.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),c&&u.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(t),d=`luminance(${this.mask.flow(t,"v3").result})`),u.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );
					
					outgoingLight *= ao;
				}
				`),l&&u.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result});`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&u.push(`gl_FragColor.a *= ${h.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=u.join(`
`)}return e}},XHe=class extends Jn{constructor(){super("standard"),this.nodeType="Standard",this.color=new on(Yo),this.roughness=new Pt(.3),this.metalness=new Pt(0),this.reflectivity=new Pt(.5),this.previousModelViewMatrix=new Wh,this.previouseProjectionMatrix=new Wh,this.shadingAlpha=new Pt(1),this.shadingBlend=new cr(0),this.occlusion=new Fa(!0)}get category(){return"physical"}build(t){let e;if(t.define("STANDARD"),t.requires.lights=!0,t.extensions.derivatives=!0,t.extensions.shaderTextureLOD=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:Kt.frameIndex}),t.mergeUniform({resolution:Kt.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(V1.merge([yt.fog,yt.lights])),yt.LTC_1&&(t.uniforms.ltc_1={value:void 0},t.uniforms.ltc_2={value:void 0}),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:Kt.penumbraSize}),t.mergeUniform({frameIndex:Kt.frameIndex}),t.mergeUniform({aoMap:Kt.aoRenderTarget}),t.mergeUniform({aoEnabled:Kt.aoEnabled});let i={gamma:!0};this.color===void 0&&(this.color=new on(Yo)),this.color.analyze(t,{slot:"color",context:i}),this.roughness.analyze(t),this.metalness.analyze(t);let r=this.occlusion.flow(t,"b",{slot:"occlusion"});this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t),this.reflectivity&&this.reflectivity.analyze(t);let n=this.color.flow(t,"c",{slot:"color",context:i}),s=this.roughness.flow(t,"f"),a=this.metalness.flow(t,"f"),o=this.shadingAlpha.flow(t,"f"),l=this.shadingBlend.flow(t,"i"),c=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(t,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(t,"f"):void 0;t.requires.transparent=h!==void 0,t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let f=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){t.include(x1.dHdxy),t.include(x1.perturbNormalArb);let m=this.bumpMap.texture.flow(t,"t"),g=this.bumpMap.flow(t,"v3"),v=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",y="";this.bumpMap.projection.value===4?y=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${m.result}, uv0, ${v});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${m.result}, uv1, ${v});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${m.result}, uv2, ${v});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:y=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${m.result}, bumpMapCachedUv, ${v});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,f.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};
					${y}
					`)}if(f.push(n.code,"	vec3 diffuseColor = "+n.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"	float metalnessFactor = "+a.result+";"),this.roughnessMap){let m=this.roughnessMap.texture.flow(t,"t"),g=this.roughnessMap.flow(t,"v3"),v="";this.roughnessMap.projection.value===4?v=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${m.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${m.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${m.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${s.result};
					`:v=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${m.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${s.result};
					`,f.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};

					const float roughnessScale = 1.0;

					${v}
				`)}else f.push(s.code,"	float roughnessFactor = "+s.result+";");h&&f.push(h.code,"#ifdef ALPHATEST","	if ( "+h.result+" <= ALPHATEST ) discard;","#endif"),f.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),f.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?f.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):f.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),f.push("#include <lights_fragment_begin>"),f.push("#include <lights_fragment_end>"),f.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let p="1.0";this.mask&&(this.mask.analyze(t),p=`luminance(${this.mask.flow(t,"v3").result})`),f.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${p} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${p}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),c&&f.push(c.code,`outgoingLight = spe_blend(outgoingLight, ${c.result}, 1.0, SPE_BLENDING_NORMAL);`),h?f.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${h.result} );`):f.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&f.push(`gl_FragColor.a *= ${u.result};`),f.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=f.join(`
`)}return e}},YHe=class extends Jn{constructor(){super("toon"),this.nodeType="Toon",this.color=new on(Yo),this.specular=new on(1118481),this.shininess=new Pt(30),this.previousModelViewMatrix=new Wh,this.previouseProjectionMatrix=new Wh,this.shadingAlpha=new Pt(1),this.shadingBlend=new cr(0)}get category(){return"toon"}build(t){let e;if(t.define("TOON"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:Kt.frameIndex}),t.mergeUniform({resolution:Kt.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(V1.merge([yt.fog,yt.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:Kt.penumbraSize}),t.mergeUniform({frameIndex:Kt.frameIndex}),t.mergeUniform({aoMap:Kt.aoRenderTarget}),t.mergeUniform({aoEnabled:Kt.aoEnabled}),this.color===void 0&&(this.color=new on(Yo)),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t),this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let i=this.color.flow(t,"c",{slot:"color"}),r=this.specular.flow(t,"c"),n=this.shininess.flow(t,"f"),s=this.shadingAlpha.flow(t,"f"),a=this.shadingBlend.flow(t,"i"),o=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(t,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=l!==void 0,t.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){t.include(x1.dHdxy),t.include(x1.perturbNormalArb);let d=this.bumpMap.texture.flow(t,"t"),f=this.bumpMap.flow(t,"v3"),p=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",m="";this.bumpMap.projection.value===4?m=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${d.result}, uv0, ${p});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${d.result}, uv1, ${p});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${d.result}, uv2, ${p});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:m=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${d.result}, bumpMapCachedUv, ${p});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${f.result};
					${m}
					`)}h.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),l&&h.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let u="1.0";this.mask&&(this.mask.analyze(t),u=`luminance(${this.mask.flow(t,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${u} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${u}, ${a.result} );
				}
				`),o&&h.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&h.push(`gl_FragColor.a *= ${c.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=h.join(`
`)}return e}},qHe=class{constructor(t=1e3*10){this.timeout=t,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...t){}remove(t){let e=this.cache.get(t);e&&(this.dispose(t,e.data),this.cache.delete(t),e.prev.next=e.next,e.next.prev=e.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let t=Date.now(),e=this.head.next;for(;e.time<t-this.timeout;)this.dispose(e.src,e.data),this.cache.delete(e.src),e=e.next,e.prev=this.head,this.head.next=e;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(t){var e;return(e=this.cache.get(t))==null?void 0:e.data}load(t){let e=Date.now(),i=this.cache.get(t);return i===void 0?(i={data:this.create(t),src:t,time:e,next:null,prev:null},this.cache.set(t,i)):(i.time=e,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},KHe=class extends qHe{create(t){return URL.createObjectURL(new Blob([t]))}dispose(t,e){URL.revokeObjectURL(e)}},gO;function QHe(t){return typeof t=="string"?t:(gO||(gO=new KHe),gO.load(t))}var $He=class{constructor(t,e){this.data=t,this.cache=e,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},JHe=class{constructor(){this.cache=new Map}remove(t){this.cache.delete(t.data)}load(t){let e=this.cache.get(t);return e===void 0&&(e=this.create(t),this.cache.set(t,e)),e.refCount+=1,e}},Ple=class extends $He{constructor(t,e){super(t,e.imageHolderCache),this.data=t,this.shared=e,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo=t.type==="video",this.isBuffer=t.isWebGLRenderTarget===!0,this.loadPromise=this.updateSrc(this.isBuffer?t:t.data)}async updateSrc(t){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let e=()=>{this.loaded=!0;for(let r of Object.values(this._cache))for(let n of Object.values(r))for(let s of Object.values(n))s&&(s.image=this.img,s.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=t,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof t!="string"){var i=new FileReader;i.readAsDataURL(new Blob([t],{type:"video/mp4"}));let r;await new Promise(n=>{i.onloadend=s=>{var a;r=(a=s.target)==null?void 0:a.result,n(null)}}),this.img.src=r}else this.img.src=t;this.img.onloadeddata=()=>{e()}}else this.img=new Image,this.img.src=QHe(t),this.img.onload=e,await new Promise(r=>{this.img.onload=()=>{e(),r(null)}})}getTexture(t,e=1008,i=1006){var n,s;let r=(s=(n=this._cache[t])==null?void 0:n[e])==null?void 0:s[i];if(r)return r;{let a;return this.isBuffer?a=this.img.texture:this.isVideo?a=new g3e(this.img,void 0,t,t):a=new Kr(this.img,void 0,t,t,i,e),this.loaded&&(a.needsUpdate=!0),this._cache[t]===void 0&&(this._cache[t]={}),this._cache[t][e]===void 0&&(this._cache[t][e]={}),this._cache[t][e][i]=a,a}}setNeedsUpdate(t){for(let e of Object.values(this._cache))for(let i of Object.values(e))for(let r of Object.values(i))r&&(r.needsUpdate=t)}disposeTextures(){for(let[t,e]of Object.entries(this._cache))for(let[i,r]of Object.entries(e))for(let[n,s]of Object.entries(r))s==null||s.dispose(),this._cache[t]!==void 0&&this._cache[t][i]!==void 0&&(this._cache[t][i][n]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},Mf=class extends Ple{};function ZHe(t,e){var i=rje(e);return i.formatToParts?tje(i,t):ije(i,t)}var eje={year:0,month:1,day:2,hour:3,minute:4,second:5};function tje(t,e){try{for(var i=t.formatToParts(e),r=[],n=0;n<i.length;n++){var s=eje[i[n].type];s>=0&&(r[s]=parseInt(i[n].value,10))}return r}catch(a){if(a instanceof RangeError)return[NaN];throw a}}function ije(t,e){var i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[r[3],r[1],r[2],r[4],r[5],r[6]]}var vO={};function rje(t){if(!vO[t]){var e=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i=e==="06/25/2014, 00:00:00"||e==="06/25/2014 00:00:00";vO[t]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:t,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return vO[t]}function Dle(t,e,i,r,n,s,a){var o=new Date(0);return o.setUTCFullYear(t,e,i),o.setUTCHours(r,n,s,a),o}var Jq=36e5,nje=6e4,yO={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function Rle(t,e,i){var r,n;if(!t||(r=yO.timezoneZ.exec(t),r))return 0;var s;if(r=yO.timezoneHH.exec(t),r)return s=parseInt(r[1],10),Zq(s)?-(s*Jq):NaN;if(r=yO.timezoneHHMM.exec(t),r){s=parseInt(r[1],10);var a=parseInt(r[2],10);return Zq(s,a)?(n=Math.abs(s)*Jq+a*nje,s>0?-n:n):NaN}if(oje(t)){e=new Date(e||Date.now());var o=i?e:sje(e),l=tU(o,t),c=i?l:aje(e,l,t);return-c}return NaN}function sje(t){return Dle(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())}function tU(t,e){var i=ZHe(t,e),r=Dle(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),n=t.getTime(),s=n%1e3;return n-=s>=0?s:1e3+s,r-n}function aje(t,e,i){var r=t.getTime(),n=r-e,s=tU(new Date(n),i);if(e===s)return e;n-=s-e;var a=tU(new Date(n),i);return s===a?s:Math.max(s,a)}function Zq(t,e){return-23<=t&&t<=23&&(e==null||0<=e&&e<=59)}var eK={};function oje(t){if(eK[t])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:t}),eK[t]=!0,!0}catch{return!1}}var lje=Ip(n2e(),1),tK=Ip(s2e(),1),cje=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,hje=cje,xO=36e5,iK=6e4,uje=2,ka={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:hje};function dje(t,e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(t===null)return new Date(NaN);var i={},r=i.additionalDigits==null?uje:(0,lje.default)(i.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]")return new Date(t.getTime());if(typeof t=="number"||Object.prototype.toString.call(t)==="[object Number]")return new Date(t);if(!(typeof t=="string"||Object.prototype.toString.call(t)==="[object String]"))return new Date(NaN);var n=fje(t),s=pje(n.date,r),a=s.year,o=s.restDateString,l=mje(o,a);if(isNaN(l))return new Date(NaN);if(l){var c=l.getTime(),h=0,u;if(n.time&&(h=gje(n.time),isNaN(h)))return new Date(NaN);if(n.timeZone||i.timeZone){if(u=Rle(n.timeZone||i.timeZone,new Date(c+h)),isNaN(u))return new Date(NaN)}else u=(0,tK.default)(new Date(c+h)),u=(0,tK.default)(new Date(c+h+u));return new Date(c+h+u)}else return new Date(NaN)}function fje(t){var e={},i=ka.dateTimePattern.exec(t),r;if(i?(e.date=i[1],r=i[3]):(i=ka.datePattern.exec(t),i?(e.date=i[1],r=i[2]):(e.date=null,r=t)),r){var n=ka.timeZone.exec(r);n?(e.time=r.replace(n[1],""),e.timeZone=n[1].trim()):e.time=r}return e}function pje(t,e){var i=ka.YYY[e],r=ka.YYYYY[e],n;if(n=ka.YYYY.exec(t)||r.exec(t),n){var s=n[1];return{year:parseInt(s,10),restDateString:t.slice(s.length)}}if(n=ka.YY.exec(t)||i.exec(t),n){var a=n[1];return{year:parseInt(a,10)*100,restDateString:t.slice(a.length)}}return{year:null}}function mje(t,e){if(e===null)return null;var i,r,n,s;if(t.length===0)return r=new Date(0),r.setUTCFullYear(e),r;if(i=ka.MM.exec(t),i)return r=new Date(0),n=parseInt(i[1],10)-1,nK(e,n)?(r.setUTCFullYear(e,n),r):new Date(NaN);if(i=ka.DDD.exec(t),i){r=new Date(0);var a=parseInt(i[1],10);return xje(e,a)?(r.setUTCFullYear(e,0,a),r):new Date(NaN)}if(i=ka.MMDD.exec(t),i){r=new Date(0),n=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return nK(e,n,o)?(r.setUTCFullYear(e,n,o),r):new Date(NaN)}if(i=ka.Www.exec(t),i)return s=parseInt(i[1],10)-1,sK(e,s)?rK(e,s):new Date(NaN);if(i=ka.WwwD.exec(t),i){s=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return sK(e,s,l)?rK(e,s,l):new Date(NaN)}return null}function gje(t){var e,i,r;if(e=ka.HH.exec(t),e)return i=parseFloat(e[1].replace(",",".")),bO(i)?i%24*xO:NaN;if(e=ka.HHMM.exec(t),e)return i=parseInt(e[1],10),r=parseFloat(e[2].replace(",",".")),bO(i,r)?i%24*xO+r*iK:NaN;if(e=ka.HHMMSS.exec(t),e){i=parseInt(e[1],10),r=parseInt(e[2],10);var n=parseFloat(e[3].replace(",","."));return bO(i,r,n)?i%24*xO+r*iK+n*1e3:NaN}return null}function rK(t,e,i){e=e||0,i=i||0;var r=new Date(0);r.setUTCFullYear(t,0,4);var n=r.getUTCDay()||7,s=e*7+i+1-n;return r.setUTCDate(r.getUTCDate()+s),r}var vje=[31,28,31,30,31,30,31,31,30,31,30,31],yje=[31,29,31,30,31,30,31,31,30,31,30,31];function Ile(t){return t%400===0||t%4===0&&t%100!==0}function nK(t,e,i){if(e<0||e>11)return!1;if(i!=null){if(i<1)return!1;var r=Ile(t);if(r&&i>yje[e]||!r&&i>vje[e])return!1}return!0}function xje(t,e){if(e<1)return!1;var i=Ile(t);return!(i&&e>366||!i&&e>365)}function sK(t,e,i){return!(e<0||e>52||i!=null&&(i<0||i>6))}function bO(t,e,i){return!(t!=null&&(t<0||t>=25)||e!=null&&(e<0||e>=60)||i!=null&&(i<0||i>=60))}function bje(t,e,i){var r=dje(t,i),n=Rle(e,r,!0),s=new Date(r.getTime()-n),a=new Date(0);return a.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),a.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),a}function za(t,e){return e.color(t)}function aK(t=new Date,e){let i=e.format,r=t.getSeconds(),n=t;e&&e.timeZone!==null&&(n=bje(new Date,e.timeZone));let s=n.getHours(),a=n.getMinutes(),o;e.format12h24h==="12ampm"&&(o=s>=12?"PM":"AM");let l=s;e.format12h24h!=="24"&&(l=s%12,l===0&&(l=12));let c,h;switch(i){case"HH:mm:ss":c=[l,a,r];break;case"HH:mm":c=[l,a];break;case"HH":c=[l],o=void 0;break;case"mm":c=[a],o=void 0;break;case"ss":c=[r],o=void 0;break;case"year":h=n.getFullYear();break;case"month":h=n.getMonth()+1;break;case"dayOfYear":h=Math.floor((n.getTime()-new Date(n.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":h=n.getDate();break;case"secondOfDay":h=s*60*60+a*60+r;break;default:console.error("Unknown time format",i),h=0;break}return c!==void 0?{textValue:c,suffix:o}:h}function wje(t,e){switch(t.type){case"fresnel":return Aje(t,e);case"gradient":return Eje(t,e);case"depth":return Mje(t,e);case"normal":return Tje(t,e);case"noise":return Cje(t,e);case"rainbow":return Pje(t,e);case"toon":return Dje(t,e);case"outline":return Rje(t,e);case"transmission":return Ije(t,e);case"color":return _je(t,e);case"pattern":return Lje(t,e)}}function Sje(t){return{type:t.type}}function Gc(t,e){let{alpha:i,mode:r,isMask:n}=t,s=typeof i=="string"?(Number(e.getVariable(i))??100)/100:i;return{...Sje(t),alpha:s,mode:r,isMask:n}}function _je(t,e){return{...Gc(t,e),color:za(t.color,e)}}function Aje(t,e){let{bias:i,scale:r,intensity:n,factor:s,color:a}=t;return{...Gc(t,e),color:za(a,e),bias:i,scale:r,intensity:n,factor:s}}function Eje(t,e){let{gradientType:i,smooth:r,colors:n,steps:s,angle:a,offset:o,morph:l}=t;return{...Gc(t,e),gradientType:i,smooth:r,colors:n.map(c=>new si(c[0],c[1],c[2],c[3])),num:n.length,steps:s,offset:new ye(...o),morph:new ye(...l),angle:a}}function Mje(t,e){let{gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:o,direction:l,colors:c,steps:h,smooth:u}=t;return{...Gc(t,e),gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:new N(...o),direction:l?new N(...l):new N(1,0,0),colors:c.map(d=>d!==void 0?new si(d[0],d[1],d[2],d[3]):new si(0,0,0,0)),steps:h.slice(0,c.length),smooth:u}}function Tje(t,e){let{cnormal:i}=t;return{...Gc(t,e),cnormal:new N(i[0],i[1],i[2])}}function Cje(t,e){return{...Gc(t,e),scale:t.scale,move:t.move,fA:new ye(...t.fA),fB:new ye(...t.fB),size:new N(...t.size),distortion:new ye(...t.distortion),colorA:za(t.colorA,e),colorB:za(t.colorB,e),colorC:za(t.colorC,e),colorD:za(t.colorD,e),noiseType:t.noiseType,voronoiStyle:t.voronoiStyle,highCut:t.highCut,lowCut:t.lowCut,smoothness:t.smoothness,seed:t.seed,quality:t.quality}}function Pje(t,e){return{...Gc(t,e),filmThickness:t.filmThickness,movement:t.movement,wavelengths:new N(...t.wavelengths),noiseStrength:t.noiseStrength,noiseScale:t.noiseScale,offset:new N(...t.offset)}}function Dje(t,e){return{...Gc(t,e),positioning:t.positioning,colors:t.colors.map(i=>new si(i[0],i[1],i[2],i[3])),num:t.colors.length,steps:t.steps,source:new N(...t.source),isWorldSpace:t.isWorldSpace,noiseStrength:t.noiseStrength,noiseScale:t.noiseScale,shadowColor:za(t.shadowColor,e),offset:new N(...t.offset)}}function Rje(t,e){return{...Gc(t,e),outlineColor:za(t.outlineColor,e),contourColor:za(t.contourColor,e),outlineWidth:t.outlineWidth,contourWidth:t.contourWidth,outlineThreshold:t.outlineThreshold,contourThreshold:t.contourThreshold,outlineSmoothing:t.outlineSmoothing,contourFrequency:t.contourFrequency,contourDirection:new N(...t.contourDirection),positionalLines:t.positionalLines,compensation:t.compensation}}function Ije(t,e){return{...Gc(t,e),thickness:t.thickness,ior:t.ior,roughness:t.roughness}}function Lje(t,e){return{...Gc(t,e),style:t.style,projection:t.projection,axis:t.axis,blending:t.blending,offset:new ye(...t.offset),colorA:za(t.colorA,e),colorB:za(t.colorB,e),frequency:new ye(...t.frequency),size:t.size,variation:t.variation,smoothness:t.smoothness,zigzag:t.zigzag,rotation:t.rotation,vertical:new ye(...t.vertical),horizontal:new ye(...t.horizontal),sides:t.sides}}var fP=class extends Qs{},Oje={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},Bje={depth:["colors"]};function Fje(t,e,i){var s,a;if(e==="isMask")return!0;let r=Oje[t.type],n=Bje[t.type];if(n!==void 0){let o=t.color;if(n.includes(e)){let l=(a=(s=o[e])==null?void 0:s.value)==null?void 0:a.length;if(l!==void 0&&l!==i.length)return!0}}return r!==void 0?r.includes(e):!1}function Lle(t,e,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let n=!1,s=t;if("image"in s){let a=s.image,o=e.image(a),l=r;l.image instanceof Mf||l.image.deref(),l.image=o}if("video"in s){let a=s.video,o=e.video(a),l=r;l.image instanceof Mf||l.image.deref(),l.image=o}if("wrapping"in s){let a=r;a.wrap=s.wrapping}if("minFilter"in s){let a=r;a.minFilter=s.minFilter}if("magFilter"in s){let a=r;a.magFilter=s.magFilter}if("rotation"in s&&i.uniforms[`f${i.id}_rotation`])return i.uniforms[`f${i.id}_rotation`].value=(s.rotation??0)*Et.DEG2RAD,n;if("repeat"in s||"offset"in s||"rotation"in s){let a="mat",o=i.uniforms[`f${i.id}_${a}`];"repeat"in s&&(o.repeat=s.repeat),"offset"in s&&(o.offset=s.offset),"rotation"in s&&(o.rotation=s.rotation??0),o.updateMatrix()}return n}function kje(t,e,i,r){let n=!1;for(let[s,a]of Object.entries(t)){if(s==="bumpMap"||s==="roughnessMap"){n=!0;continue}if(!s||a===void 0)continue;if(Ble(s,i,r,e)){s==="visible"&&i.type==="light"&&(n=!0);continue}i.visible=r.visible;let o=i.uniforms[`f${i.id}_${s}`];if(o&&!(o instanceof EG))switch(n=n||Fje(i,s,a),o.constructor){case on:if(typeof a=="string"){let l=e.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof fP?o.value=new Qs(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case Ru:if(typeof a=="string"){let l=e.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof fP?o.value=new Qs(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case zs:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]);break}case bl:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case Vu:{Lle(a,e,i);break}case Mm:{o.value=a.map(l=>new si(...l));break}default:{o.value=a;break}}}return n}var Xg=(t,e,i)=>Math.max(0,Math.min(1,Number(e.getVariable(typeof t=="number"?t*100:t,i)??100)/100))??1,L_=class{constructor(t,e,i,r,n){this.id=t,this.uuid=e,this.data=i,this.uniforms={};for(let s in r)this.uniforms[`f${this.id}_${s}`]=r[s];for(let s in i)Ble(s,this,i,n)}get type(){return this.data.type}static create(t,e,i,r){if(i.type==="light")return ph.createLightLayer(t,e,i,r);if(i.type==="texture"||i.type==="video"){let n=i.type==="texture"?r.uiBuffer(i.texture.image)??r.image(i.texture.image):r.video(i.texture.video),s=new JN(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new UHe(n),o=new zHe(i.texture.repeat,i.texture.offset,i.texture.rotation??0),l=new Pt(i.crop?1:0),c=new cr(i.projection??0),h=new cr(["x","y","z"].indexOf(i.axis)??0),u=new cr(i.side??0),d=new zs(i.size?new ye(i.size[0],i.size[1]):new ye(100,100)),f=new Pt(i.blending??0),p=new Pt(Xg(i.alpha,r)),m=new cr(i.mode??0),g=new Fa(i.isMask??!1),v=new MG(s,a,l,c,h,u,d,f,o,p,m,g),y=new xr(v.calpha,"f");return new tn(t,e,i,{texture:s,textureSize:a,crop:l,projection:c,axis:h,side:u,size:d,blending:f,mat:o,alpha:p,mode:m,isMask:g},v,m,y,g,r)}else if(i.type==="matcap"){let n=r.image(i.texture.image),s=new JN(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new Pt(Xg(i.alpha,r)),o=new cr(i.mode??0),l=new Fa(i.isMask??!1),c=new Pt((i.texture.rotation??0)*Et.DEG2RAD),h=new mle(s,a,o,l,c),u=new xr(h.calpha,"f");return new tn(t,e,i,{texture:s,alpha:a,mode:o,isMask:l,rotation:c},h,o,u,l,r)}else if(i.type==="displace")if(i.displacementType==="noise"){let n=new bl(new N(...i.offset)),s=new Pt(i.scale??10),a=new Pt(i.intensity??8),o=new Pt(i.movement??1),l=new cr(i.noiseType??0),c=new cr(i.voronoiStyle??0),h=new Pt(i.smoothness??.5),u=new Pt(i.seed??0),d=new Pt(i.highCut??1),f=new Pt(i.lowCut??0),p=new cr(i.quality??1),m=new Tle(a,o,n,c,h,u,d,f,p,s,l);return new Ole(t,e,i,{offset:n,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:c,smoothness:h,seed:u,highCut:d,lowCut:f,quality:p},m,r)}else throw new Error;else return zje(t,e,i,r)}updateByOp(t,e,i){let r=t;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props||"noiseType"in r.props?(i.scene.markNeedsUpdateRendererDirty(),!0):kje(r.props,i.shared,this,e)}else if(r.path[0]==="texture")return"texture"in e||"video"in e?Lle(r.props,i.shared,this):!0;return!1}dispose(){if(Nje(this)){let t=this.uniforms[`f${this.id}_texture`];if(!t)return!1;let e=t;e.image instanceof Mf||e.image.deref()}}hasValueByKey(t){return this.uniforms[t]!==void 0}hasValue(t){return this.hasValueByKey(`f${this.id}_${t}`)}setValue(t,e){let i=`f${this.id}_${t}`;this.hasValueByKey(i)&&e!==void 0&&(this.uniforms[i].value=e)}getNode(t){let e=`f${this.id}_${t}`;if(this.hasValueByKey(e))return this.uniforms[e]}getValue(t){let e=`f${this.id}_${t}`;if(this.hasValueByKey(e))return this.uniforms[e].value}getName(t){let e=/f\d+_(.*)/.exec(t);if(e&&e.length>1)return e[1];console.log(`Layer.getName: error ${t}`)}getNames(){let t=[];for(let e in this.uniforms){let i=this.getName(e);i&&t.push(i)}return t}},tn=class extends L_{constructor(t,e,i,r,n,s,a,o,l){super(t,e,i,r,l),this.params=r,this.color=n,this.mode=s,this.alpha=a,this.isMask=o}},Ole=class extends L_{constructor(t,e,i,r,n,s){super(t,e,i,r,s),this.position=n}},ph=class extends L_{constructor(t,e,i,r,n,s){super(t,e,i,n,s),this.node=r}static createLightLayer(t,e,i,r){let n,s=new Pt(Xg(i.alpha,r)),a=new cr(i.mode),o=new Pt(i.bumpMapIntensity),l=new Pt(Xg(i.alphaOverride,r)),c;if(!i.visible)n=new TG,c={};else if(i.category==="lambert"){n=new jHe;let h=new on(r.color(i.emissive)??0),u=new Fa(i.occlusion??!0);c={emissive:h,occlusion:u},n.emissive=h,n.occlusion=u}else if(i.category==="toon"){n=new YHe;let h=new Pt(i.shininess??30),u=new on(r.color(i.specular)??1118481);c={shininess:h,specular:u},n.shininess=h,n.specular=u}else if(i.category==="physical"){n=new XHe;let h=new Pt(i.roughness??.3),u=new Pt(i.metalness??0),d=new Pt(i.reflectivity??.5),f=new Fa(i.occlusion??!0);c={roughness:h,metalness:u,reflectivity:d,occlusion:f},n.roughness=h,n.metalness=u,n.reflectivity=d,n.occlusion=f}else{n=new WHe;let h=new Pt(i.shininess??30),u=new on(i.specular!==void 0?r.color(i.specular)??1118481:1118481),d=new Fa(i.occlusion??!0);c={shininess:h,specular:u,occlusion:d},n.shininess=h,n.specular=u,n.occlusion=d}return n.alpha=new Pt(1),n.shadingAlpha=s,n.shadingBlend=a,n.bumpMapIntensity=o,n.alphaOverride=l,c.alpha=n.shadingAlpha,c.mode=n.shadingBlend,c.bumpMapIntensity=n.bumpMapIntensity,c.alphaOverride=n.alphaOverride,new ph(t,e,i,n,c,r)}get category(){return this.node.category}};function Nje(t){let e=t instanceof L_?t.type:t;return e==="texture"||e==="video"||e==="displace_map"||e==="matcap"}function hl(t){return{alpha:new Pt(t.alpha??1),mode:new cr(t.mode??0),isMask:new Fa(t.isMask??!1)}}function Uje(t,e,i,r,n){switch(t.type){case"color":{let s=new on(r.color??Yo),a=hl(r),o=new ZN(s,a.alpha),l=new xr(o.calpha,"f");return new tn(e,i,t,{color:s,...a},o,a.mode,l,a.isMask,n)}case"fresnel":{let s=new on(r.color??16777215),a=new Pt(r.bias??.1),o=new Pt(r.scale??1),l=new Pt(r.intensity??2),c=new Pt(r.factor??1),h=hl(r),u=new GHe(s,a,o,l,c,h.alpha,h.mode,h.isMask),d=new xr(u.calpha,"f");return new tn(e,i,t,{color:s,bias:a,scale:o,intensity:l,factor:c,...h},u,h.mode,d,h.isMask,n)}case"rainbow":{let s=new Pt(r.filmThickness??30),a=new Pt(r.movement??0),o=new bl(r.wavelengths??new N(0,0,0)),l=new Pt(r.noiseStrength??0),c=new Pt(r.noiseScale??1),h=new bl(r.offset??new N(0,0,0)),u=hl(r),d=new wle(s,a,o,l,c,h,u.alpha,u.isMask),f=new xr(d.calpha,"f");return new tn(e,i,t,{filmThickness:s,movement:a,wavelengths:o,noiseStrength:l,noiseScale:c,offset:h,...u},d,u.mode,f,u.isMask,n)}case"transmission":{let s=new Pt(r.thickness??10),a=new Pt(r.ior??1.5),o=new Pt(r.roughness??.5),l=Kt.transmissionSize,c=Kt.transmissionRenderTarget,h=Kt.transmissionRenderTargetDepth,u=window.innerWidth,d=window.innerHeight,f=u>=d?new zs(d/u,1):new zs(1,u/d),p=hl(r),m=new Ele(s,a,o,l,c,h,f,p.alpha),g=new xr(m.calpha,"f");return new tn(e,i,t,{thickness:s,ior:a,roughness:o,aspectRatio:f,...p},m,p.mode,g,p.isMask,n)}case"toon":{let s=new cr(r.positioning??0),a;r.colors?a=new Mm(r.colors.length,r.colors):(a=new Mm(10,new si(0,0,0,1)),a.value[1]=new si(1,1,1,1));let o;r.steps?o=new Em(r.steps.length,r.steps):(o=new Em(10,1),o.value[0]=0);let l=new bl(r.source??new N(0,0,0)),c=new Fa(r.isWorldSpace??!0),h=new Pt(r.noiseStrength??0),u=new Pt(r.noiseScale??1),d=new Ru(r.shadowColor),f=new bl(r.offset??new N(0,0,0)),p=hl(r),m=new _le(s,a,o,l,c,h,u,d,f,p.alpha),g=new xr(m.calpha,"f");return new tn(e,i,t,{positioning:s,colors:a,steps:o,source:l,isWorldSpace:c,noiseStrength:h,noiseScale:u,shadowColor:d,offset:f,...p},m,p.mode,g,p.isMask,n)}case"outline":{let s=new on(r.outlineColor??16777215),a=new on(r.contourColor??16777215),o=new Pt(r.outlineWidth??.1),l=new Pt(r.contourWidth??.1),c=new Pt(r.outlineThreshold??.1),h=new Pt(r.contourThreshold??.1),u=new Pt(r.outlineSmoothing??.1),d=new Pt(r.contourFrequency??.1),f=new bl(r.contourDirection??new N(0,1,0)),p=new Fa(r.positionalLines??!1),m=new Fa(r.compensation??!0),g=Kt.normalRenderTarget,v=Kt.normalRenderTargetDepth,y=Kt.pixelRatioNode,x=Kt.resolution,S=hl(r),A=new yle(s,a,o,l,c,h,u,d,f,p,m,x,g,v,y,S.alpha),_=new xr(A.calpha,"f");return new tn(e,i,t,{outlineColor:s,contourColor:a,outlineWidth:o,contourWidth:l,outlineThreshold:c,contourThreshold:h,outlineSmoothing:u,contourFrequency:d,contourDirection:f,positionalLines:p,compensation:m,...S},A,S.mode,_,S.isMask,n)}case"depth":{let s=new cr(r.gradientType??0),a=new Fa(r.smooth??!1),o=new Pt(r.near??50),l=new Pt(r.far??200),c=new Pt(r.isVector??1),h=new Pt(r.isWorldSpace??0),u=new bl(r.origin??new N),d=new bl(r.direction??new N),f;r.colors?f=new Mm(r.colors.length,r.colors):(f=new Mm(2,new si(0,0,0,1)),f.value[1]=new si(1,1,1,1));let p;r.steps?p=new Em(r.steps.length,r.steps):(p=new Em(2,1),p.value[0]=0);let m=hl(r),g=new ule(s,a,o,l,c,h,u,d,f,p,m.alpha,m.isMask),v=new xr(g.calpha,"f");return new tn(e,i,t,{gradientType:s,smooth:a,near:o,far:l,isVector:c,isWorldSpace:h,origin:u,direction:d,colors:f,steps:p,...m},g,m.mode,v,m.isMask,n)}case"noise":{let s=new Pt(r.scale??1),a=new bl(r.size??new N(100,100,100)),o=new Pt(r.move??1),l=new zs(r.fA??new ye(1.7,9.2)),c=new zs(r.fB??new ye(8.3,2.8)),h=new zs(r.distortion??new ye(1,1)),u=new Ru(r.colorA),d=new Ru(r.colorB),f=new Ru(r.colorC),p=new Ru(r.colorD),m=new cr(r.noiseType??0),g=new cr(r.voronoiStyle??0),v=new Pt(r.highCut??1),y=new Pt(r.lowCut??0),x=new Pt(r.smoothness??.5),S=new Pt(r.seed??.5),A=new cr(r.quality??1),_=hl(r),M=new gle(s,a,o,l,c,h,u,d,f,p,_.alpha,m,_.isMask,g,v,y,x,S,A),E=new xr(M.calpha,"f");return new tn(e,i,t,{scale:s,size:a,move:o,fA:l,fB:c,distortion:h,colorA:u,colorB:d,colorC:f,colorD:p,noiseType:m,..._,voronoiStyle:g,highCut:v,lowCut:y,smoothness:x,seed:S,quality:A},M,_.mode,E,_.isMask,n)}case"normal":{let s=new bl(r.cnormal??new N(1,1,1)),a=hl(r),o=new hle(s,a.alpha),l=new xr(o.calpha,"f");return new tn(e,i,t,{cnormal:s,...a},o,a.mode,l,a.isMask,n)}case"gradient":{let s=new cr(r.gradientType??0),a=new Fa(r.smooth??!1),o;r.colors?o=new Mm(r.colors.length,r.colors):(o=new Mm(10,new si(0,0,0,1)),o.value[1]=new si(1,1,1,1));let l;r.steps?l=new Em(r.steps.length,r.steps):(l=new Em(10,1),l.value[0]=0);let c=new zs(r.offset??new ye(0,0)),h=new zs(r.morph??new ye(0,0)),u=new Pt(r.angle??0),d=hl(r),f=new fle(s,a,o,l,c,h,u,d.alpha,d.isMask),p=new xr(f.calpha,"f");return new tn(e,i,t,{gradientType:s,smooth:a,colors:o,steps:l,offset:c,morph:h,angle:u,...d},f,d.mode,p,d.isMask,n)}case"pattern":{let s=new cr(r.style??0),a=new cr(r.projection??0),o=new cr(["x","y","z"].indexOf(r.axis)??0),l=new Pt(r.blending??0),c=new zs(r.offset??new ye(0,0)),h=new Ru(r.colorA),u=new Ru(r.colorB),d=new zs(r.frequency??new ye(10,10)),f=new Pt(r.size??.5),p=new Pt(r.variation??0),m=new Pt(r.smoothness??.5),g=new Pt(r.zigzag??0),v=new Pt(r.rotation??0),y=new zs(r.vertical??new ye(0,1)),x=new zs(r.horizontal??new ye(0,1)),S=new cr(r.sides??6),A=hl(r),_=new xle(s,a,o,l,c,h,u,d,f,p,m,g,v,y,x,S,A.alpha,A.isMask),M=new xr(_.calpha,"f");return new tn(e,i,t,{style:s,projection:a,axis:o,blending:l,offset:c,colorA:h,colorB:u,frequency:d,size:f,variation:p,smoothness:m,zigzag:g,rotation:v,vertical:y,horizontal:x,sides:S,...A},_,A.mode,M,A.isMask,n)}default:{let s=new on(1,0,0,1),a=hl(r),o=new ZN(s,a.alpha),l=new xr(o.calpha,"f");return new tn(e,i,t,{color:s,...a},o,a.mode,l,a.isMask,n)}}}function zje(t,e,i,r){let n=wje(i,r);return Uje(i,t,e,n,r)}function Ble(t,e,i,r){if(i.type==="displace"&&(t==="intensity"||t==="visible")){let n=e.uniforms[`f${e.id}_intensity`];return n?(n.value=i.intensity*(i.visible?1:0),n):void 0}if(i.type!=="displace"&&(t==="alpha"||t==="visible")){let n=e.uniforms[`f${e.id}_alpha`];if(!n)return;if(n.value=Xg(i.alpha,r)*(i.visible?1:0),i.type==="outline"&&t==="visible"){let s=e.uniforms[`f${e.id}_compensation`];s&&(s.value=i.compensation&&i.visible)}return n}}function oy(t,e){let i=0,r=t.layers.find(n=>n.data.type==="light");if(r){let n=r.data,s=Number(e.getVariable(n.alphaOverride));if((typeof n.alphaOverride=="string"?s/100:n.alphaOverride)<1)return!0}for(let n of t.layers){if(n.data.type!=="displace"&&n.data.isMask)return!0;if(n.data.type!=="displace"&&"alpha"in n.data&&n.data.type!=="light"&&n.data.type!=="fresnel"&&n.data.type!=="texture"&&n.data.type!=="matcap"&&n.data.type!=="rainbow"&&n.data.type!=="outline"&&n.data.type!=="pattern"){let s=n.data.visible?n.data.alpha:0;if(typeof s=="string"&&(s=Math.max(0,Math.min(1,Number(e.getVariable(s)??100)/100))),s===1&&n.data.type==="depth"||n.data.type==="gradient"){for(let a of n.data.colors)if(a[3]<1){s=a[3];break}}else if(s===1&&n.data.type==="noise"){let a=e.color(n.data.colorA).a,o=e.color(n.data.colorB).a,l=e.color(n.data.colorC).a,c=e.color(n.data.colorD).a,h=Math.min(a,Math.min(o,Math.min(l,c)));h<1&&(s=h)}i+=(1-i)*s}}return i<1}var xp=class extends Ri{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.shadersPatchedForShapeBlend=!1,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},Gje=class extends xp{constructor(t,e,i,r){super(),this.flatShading=t,this.side=e,this.wireframe=i,this.root=r}updateAfterBuild(){let t=this.root;this.lights=t.lights,this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader,Object.assign(this.defines,t.defines),Object.assign(this.uniforms,t.uniforms),this.extensions=t.extensions,this.transparent=t.transparent,this.cacheKey=t.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(t,e){this.root.onBeforeCompile(t)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(t,e,i,r){return this.root.getFlavor(t,e,i,r)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(t){return this.root.getLayersOfType(t)}getLayerByUuid(t){return this.root.getLayerByUuid(t)}updateByOp(t,e,i){this.root.updateByOp(t,e,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},CG=class extends xp{constructor(t,e,i=!0){super(),this.data=t,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=e.shared.needsJitter,Jn.startContext(this),this.reset0(t,e),Jn.endContext(this)}get nodeMaterial(){return this}getFlavor(t,e,i,r){let n=i?6:(t?3:0)+e;if(n+=(((r==null?void 0:r.resolutionLevel)??0)-(r!=null&&r.useChildrenColors?4:0))*7,n===0)return this;this.flavors===void 0&&(this.flavors=[]),n-=1;let s=this.flavors[n];return s===void 0&&(s=new Gje(t,e,i,this),s.needsJitter=this.needsJitter,this.flavors[n]=s,s.flatShading=t,s.side=e,s.updateAfterBuild(),r&&(s.defines.SHAPEBLEND=r.resolutionLevel,s.defines.SHAPEBLEND_C=r.useChildrenColors?1:0)),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var t;return((t=this.lightLayer.getNode("occlusion"))==null?void 0:t.value)??!1}reset(t,e,i=!1){Jn.startContext(this),(this.data!==t||i)&&this.reset0(t,e),Jn.endContext(this)}reset0(t,e){this.data=t;let i=t.layers??Es.defaultTwoLayerData("phong").layers;try{this.layers=i.map(r=>L_.create(this.layerIdGen++,r.id,r.data,e.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=t.name??"Untitled Material",this.onUpdate(e.shared),this.transparent=oy(t,e.shared),this.saveVariableLocations(e)}onVariableUpdate(t,e,i){if(t[0]==="alphaOverride")this.transparent=oy(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(e)/100,1)));else if(t[0]==="layer"){let r=t[1],n=t[2];if(r&&n){let s=this.layers.find(a=>a.uuid===r);s!=null&&s.hasValue(n)&&(n==="alpha"?(this.transparent=oy(this.data,i.shared),s.setValue(n,Math.max(0,Math.min(Number(e)/100,1)))):s.setValue(n,e))}}}saveVariableLocations(t){if(!this.allowVariableSaves)return;let e=this.data.layers.find(i=>i.data.type==="light");e&&t.shared.getVariable(e.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&typeof i.data.alpha=="string"&&t.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"])})}getLayersOfType(t){return this.layers.filter(e=>e.type===t)}getLayerByUuid(t){return this.layers.find(e=>e.uuid===t)}onUpdate(t){this.lightLayer=this.layers.find(e=>e instanceof ph),this.lightLayer===void 0&&(this.lightLayer=new ph(0,"",{...ys.defaultData("light","phong"),visible:!1},new TG,{},t)),this.dispose();for(let e of this.flavors)e&&e.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let t=this.layers.find(n=>n instanceof ph);if(!t)return;let e=t.data,i=e.bumpMap,r=e.roughnessMap;t.node.bumpMap=void 0,t.node.roughnessMap=void 0;for(let n=0;n<this.layers.length;++n){let s=this.layers[n];s instanceof tn&&s.color instanceof MG&&(s.uuid===i&&(t.node.bumpMap=s.color),s.uuid===r&&(t.node.roughnessMap=s.color))}}updateByOp(t,e,i){if(Jn.startContext(this),e!==void 0?this.data=e:e=this.data,this.transparent=oy(e,i.shared),t.path[0]==="layers"){let r=i.shared,n=t.path[1];if(n===void 0)i.scene.markNeedsUpdateRendererDirty(),this.reset0(e,i);else{t.type===0&&t.props.occlusion!==void 0&&i.scene.markNeedsUpdateRendererDirty();let s=this.layers.find(a=>a.uuid===n);if(s){let a=e.layers.data(n),o;t.type===0&&("alpha"in t.props||"alphaOverride"in t.props)&&("alpha"in t.props?o={...t.props,alpha:Xg(t.props.alpha,r,["material",this.uuid,"layer",n,"alpha"])}:o={...t.props,alphaOverride:Xg(t.props.alphaOverride,r,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...t,...o?{props:o}:{},path:t.path.slice(2)},a,i)&&this.reset0(e,i)}}}else this.reset0(e,i);Jn.endContext(this)}applyMasks(){for(let t=0;t<this.layers.length;++t){let e=this.layers[t];e instanceof tn?e.color.mask=void 0:e instanceof ph&&(e.node.mask=void 0)}for(let t=0;t<this.layers.length;++t){let e=this.layers[t];if(e instanceof tn&&e.isMask.value&&e.data.visible&&t>0){let i=t-1,r=this.layers[i];r instanceof ph?r.node.mask=new to(e.color,e.alpha,to.MUL):r instanceof tn&&(r.isMask.value||(r.color.mask=new to(e.color,e.alpha,to.MUL)))}}}blendColors(){let t=this.layers.findIndex(i=>i instanceof tn),e=this.layers.findIndex(i=>i instanceof ph);if(t!==-1&&t<e){let i=this.layers[t].color;for(let r=t+1;r<e;++r){let n=this.layers[r];if(n instanceof tn){if(n.isMask.value)continue;i=new $q(i,n.color,n.alpha,n.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let t=new xr("outgoingLight","f"),e=this.layers.findIndex(i=>i instanceof ph);if(this.layers.length>e+1){for(let i=e+1;i<this.layers.length;++i){let r=this.layers[i];if(r instanceof tn){if(r.isMask.value)continue;t=new $q(t,r.color,r.alpha,r.mode)}}this.fragment.afterColor=t}else this.fragment.afterColor=void 0}blendPositions(){let t=this.layers.filter(e=>e instanceof Ole);if(t.length>0){let e=t[0].position;for(let i=1;i<t.length;++i)t[i]&&(e=new to(e,t[i].position,to.ADD),e=new to(e,new Pt(.5).setReadonly(!0),to.MUL));this.fragment.position=e}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(t){this.shapeBlendhack&&this.shapeBlendhack(this),t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.extensionDerivatives=this.extensions.derivatives===!0,t.extensionFragDepth=this.extensions.fragDepth===!0,t.extensionDrawBuffers=this.extensions.drawBuffers===!0,t.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(t,e){let i=(r,n,s)=>Math.min(Math.max(r,n),s);for(let r of this.layers)if(r.type==="displace"){let n=i(r.uniforms[`f${r.id}_intensity`].value,t,e);r.uniforms[`f${r.id}_intensity`].value=n}}updateFrame(t){for(let e=0;e<this.updaters.length;++e)t.updateNode(this.updaters[e])}build(){let t=new ale;t.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,t.build(this.fragment,this.fragment),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms=t.uniforms,this.extensions=t.extensions,this.updaters=t.updaters;for(let e of this.flavors)e&&e.updateAfterBuild();return this.shadersPatchedForShapeBlend=!1,this}nodeMaterialDispose(){this.layers.forEach(t=>t.dispose()),super.dispose();for(let t of this.flavors)t&&t.dispose()}assetsLoaded(){for(let t of this.layers)if(t instanceof tn){let e=t.params.texture;if(e instanceof JN&&!e.image.loaded)return!1}return!0}};Object.defineProperties(xp.prototype,{properties:{get:function(){return this.fragment.properties}}});var iU=class extends CG{constructor(t,e,i){super(t,e,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(e)}},oK=new Map;function Vje(t){if(typeof t=="string")return t;let e=oK.get(t);return e||(e={url:URL.createObjectURL(new Blob([t]))},oK.set(t,e)),e.url}var Fle,Hje=new Promise(t=>{Fle=t}),lK=!1,sT;function jje(){if(lK)return;if(sT)return sT;async function t(){await Td(()=>import("./howler-BstFmwim.js").then(e=>e.h),[]),Fle(window!==void 0?window:global),lK=!0}return sT=t(),sT}var kle;Hje.then(t=>kle=t);function Wje(t){let e=!1;return t.scene.objects.traverse((i,r)=>{if(r.events===void 0||Array.isArray(r.events)===!1)return!0;let n=[];r.events.forEach(s=>{"dragDropActions"in s.data?(n.push(...s.data.dragDropActions.drag),n.push(...s.data.dragDropActions.drop)):"inActions"in s.data?(n.push(...s.data.inActions),n.push(...s.data.outActions)):"gameActions"in s.data?(n.push(...s.data.gameActions.idle),n.push(...s.data.gameActions.move),n.push(...s.data.gameActions.jump),n.push(...s.data.gameActions.run)):"breakpoints"in s.data?s.data.breakpoints.forEach(a=>{n.push(...a.data.actions)}):"actions"in s.data&&n.push(...s.data.actions),e=e||n.some(a=>a.data.type==="Audio")})}),e}var Vb=class{constructor({src:t,volume:e,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let n;typeof t=="string"?n={src:t}:n={src:Vje(t),format:"wav"},this.sound=new kle.Howl(n),this.sound.on("end",this.onEnd),this.src=t,e!==void 0&&(this.volume=e),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(t){this._volume=t,this.sound.volume(t)}get loop(){return this._loop}set loop(t){this._loop=t,this.loopsRemaining=t}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(t,e=1e3){t?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,e),this.clearFade()},t)):this.sound.fade(this._volume,0,e)}on(t,e,i){this.sound.on(t,e,i)}off(t,e,i){this.sound.off(t,e,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(t=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},Xje=class{constructor(){this.type="ShapePath",this.color=new Xt,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new T2,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){var i;return(i=this.currentPath)==null||i.lineTo(t,e),this}quadraticCurveTo(t,e,i,r){var n;return(n=this.currentPath)==null||n.quadraticCurveTo(t,e,i,r),this}bezierCurveTo(t,e,i,r,n,s){var a;return(a=this.currentPath)==null||a.bezierCurveTo(t,e,i,r,n,s),this}splineThru(t){var e;return(e=this.currentPath)==null||e.splineThru(t),this}toShapes(){let t={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},e={loc:t.ORIGIN,t:0};function i(f,p,m,g){let v=f.x,y=p.x,x=m.x,S=g.x,A=f.y,_=p.y,M=m.y,E=g.y,T=(S-x)*(A-M)-(E-M)*(v-x),C=(y-v)*(A-M)-(_-A)*(v-x),D=(E-M)*(y-v)-(S-x)*(_-A),B=T/D,O=C/D;if(D===0&&T!==0||B<=0||B>=1||O<0||O>1)return null;if(T===0&&D===0){for(let L=0;L<2;L++)if(r(L===0?m:g,f,p),e.loc===t.ORIGIN){let H=L===0?m:g;return{x:H.x,y:H.y,t:e.t}}else if(e.loc===t.BETWEEN){let H=+(v+e.t*(y-v)).toPrecision(10),q=+(A+e.t*(_-A)).toPrecision(10);return{x:H,y:q,t:e.t}}return null}else{for(let q=0;q<2;q++)if(r(q===0?m:g,f,p),e.loc===t.ORIGIN){let W=q===0?m:g;return{x:W.x,y:W.y,t:e.t}}let L=+(v+B*(y-v)).toPrecision(10),H=+(A+B*(_-A)).toPrecision(10);return{x:L,y:H,t:B}}}function r(f,p,m){let g=m.x-p.x,v=m.y-p.y,y=f.x-p.x,x=f.y-p.y,S=g*x-y*v;if(f.x===p.x&&f.y===p.y){e.loc=t.ORIGIN,e.t=0;return}if(f.x===m.x&&f.y===m.y){e.loc=t.DESTINATION,e.t=1;return}if(S<-Number.EPSILON){e.loc=t.LEFT;return}if(S>Number.EPSILON){e.loc=t.RIGHT;return}if(g*y<0||v*x<0){e.loc=t.BEHIND;return}if(Math.sqrt(g*g+v*v)<Math.sqrt(y*y+x*x)){e.loc=t.BEYOND;return}let A;g!==0?A=y/g:A=x/v,e.loc=t.BETWEEN,e.t=A}function n(f,p){let m=[],g=[];for(let v=1;v<f.length;v++){let y=f[v-1],x=f[v];for(let S=1;S<p.length;S++){let A=p[S-1],_=p[S],M=i(y,x,A,_);M!==null&&m.find(E=>E.t<=M.t+Number.EPSILON&&E.t>=M.t-Number.EPSILON)===void 0&&(m.push(M),g.push(new ye(M.x,M.y)))}}return g}function s(f,p,m){let g=new ye;p.getCenter(g);let v=[];return m.forEach(y=>{y.boundingBox.containsPoint(g)&&n(f,y.points).forEach(x=>{v.push({identifier:y.identifier,isCW:y.isCW,point:x})})}),v.sort((y,x)=>y.point.x-x.point.x),v}function a(f,p,m,g,v){(v==null||v==="")&&(v="nonzero");let y=new ye;f.boundingBox.getCenter(y);let x=[new ye(m,y.y),new ye(g,y.y)],S=s(x,f.boundingBox,p);S.sort((C,D)=>C.point.x-D.point.x);let A=[],_=[];S.forEach(C=>{C.identifier===f.identifier?A.push(C):_.push(C)});let M=A[0].point.x,E=[],T=0;for(;T<_.length&&_[T].point.x<M;)E.length>0&&E[E.length-1]===_[T].identifier?E.pop():E.push(_[T].identifier),T++;if(E.push(f.identifier),v==="evenodd"){let C=E.length%2===0,D=E[E.length-2];return{identifier:f.identifier,isHole:C,for:D}}else if(v==="nonzero"){let C=!0,D=null,B=null;for(let O=0;O<E.length;O++){let L=E[O];p[L]&&(C?(B=p[L].isCW,C=!1,D=L):B!==p[L].isCW&&(B=p[L].isCW,C=!0))}return{identifier:f.identifier,isHole:C,for:D}}else console.warn('fill-rule: "'+v+'" is currently not implemented.')}let o=0,l=999999999,c=-999999999,h=[];this.subPaths.forEach(f=>{let p=f.getPoints(),m=-999999999,g=999999999,v=-999999999,y=999999999;for(let x=0;x<p.length;x++){let S=p[x];S.y>m&&(m=S.y),S.y<g&&(g=S.y),S.x>v&&(v=S.x),S.x<y&&(y=S.x)}c<=v&&(c=v+1),l>=y&&(l=y-1),p.length&&h.push({curves:f.curves,points:p,isCW:zse.isClockWise(p),identifier:o++,boundingBox:new U5(new ye(y,g),new ye(v,m))})});let u=h.map(f=>{var p;return a(f,h,l,c,(p=this.userData)==null?void 0:p.style.fillRule)}),d=[];return h.forEach(f=>{let p=u[f.identifier];if(p&&!p.isHole){let m=new C2;m.curves=f.curves,u.filter(g=>(g==null?void 0:g.isHole)&&g.for===f.identifier).forEach(g=>{if(g){let v=h[g.identifier],y=new T2;y.curves=v.curves,m.holes.push(y)}}),d.push(m)}}),d}},Nle=!1,Ule,cK=new Promise(t=>{Ule=t}),hK=!1,aT;function Yje(){if(Nle=!0,hK)return;if(aT)return aT;async function t(){let e=await Td(()=>import("./opentype-D6jUvuOk.js"),[]);Ule(e),hK=!0}return aT=t(),aT}var qje=class{async load(t,e,i=()=>{}){let{load:r}=await cK;r(t,(n,s)=>{n||!s?i(n??"Something went wrong"):e(s)})}async parse(t){let{parse:e,Bidi:i}=await cK;try{let r=e(t),n=new i,s=a=>r.charToGlyphIndex(a.char);return n.registerModifier("glyphIndex",null,s),n.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:n}}catch(r){console.error(r)}}};async function Kje(t){return await(await fetch(t)).arrayBuffer()}var Qje=new qje;async function uK(t){let e,i,r=!1;if(t.url?(e=await Kje(t.url),i=t.url,r=t.url.startsWith("/")):t.data&&(e=t.data.buffer.slice(t.data.byteOffset,t.data.byteOffset+t.data.byteLength)),e)if(Nle){let n=await Qje.parse(e);if(n)return{font:n.font,url:i,intercepted:r,arr:e,bidi:n.bidi}}else return{font:void 0,url:i,intercepted:r,arr:e,bidi:null}}function $je(t,e){return e.state.glyphIndex===t||e.state.fina===t||e.state.medi===t||e.state.init===t}var Jje=class{constructor(t){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=t.isUserFont??!1,this._loadingPromise=uK(t).then(e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)})}update(t){this._isLoaded=!1,this._isUserFont=t.isUserFont??!1,this._loadingPromise=uK(t).then(e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(t,e,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(e);let n=r.tokenizer.tokens,s=[],a=0,o=i.length===n.length;for(let l=0;l<i.length;l++){let c=i[l].index,h=String.fromCharCode(i[l].unicode),u=n[a];if($je(c,u)||o)s.push({char:h,index:c,replacements:[u.state.glyphIndex],replacementChars:[u.char]}),a++;else{let d=u.char,f="",p=[u.state.glyphIndex],m=[],g=!1;for(;!g;)a++,f=e.charAt(a),d+=f,p.push(t.charToGlyphIndex(f)),m=t.stringToGlyphs(d),m.length===1&&m[0].index===c&&(g=!0),a>e.length&&(g=!0);s.push({char:h,index:c,replacements:p,replacementChars:Array.from(d)}),a++}}return s}generateShapes(t,e){if(!this._isLoaded)return;let i=this.font,r=e.fontSize/this.unitsPerEm,n=e.fontSize*e.lineHeight,s=t.map(v=>this.getTextWidth(v,e)),a=e.width,o=this.getCharWidth(`
`,e),l=e.horizontalAlign===1?o:0,c=this.computeSpaceWidthForLine(t,0,e),h=this.getLineInitialOffsetX(s[0],a,e.horizontalAlign,t[0],o),u=this.getLineInitialOffsetY(n,t.length,e.height,r,e.verticalAlign),d=[],f=t.map(v=>[]),p=t.map(v=>[]),m;for(let v=0;v<t.length;v++){let y=t[v],x={features:{liga:!0}},S=[];try{S=i.stringToGlyphs(y,x)}catch(_){console.warn(_)}h=this.getLineInitialOffsetX(s[v],a,e.horizontalAlign,y,o);let A=[];try{A=this.reverseLigaturesTable(i,y,S)}catch(_){console.warn(_)}c=this.computeSpaceWidthForLine(t,v,e);for(let _=0;_<S.length;_++){let M=S[_],E=M.index===0?`
`:M.unicode?String.fromCharCode(M.unicode):void 0,T=A[_],C=0,D=0;_===0&&e.horizontalAlign===2&&M.leftSideBearing!==void 0&&(D=-M.leftSideBearing*r),m&&(C=i.getKerningValue(M,m)*r),h+=D+C;let B=0;if(E===`
`)B=l;else if(E===" ")B=c;else{let O=this.createPath(M,r,h,u,e);O&&(B=O.offsetX-(C+D),d.push(O.path))}if(T.replacements.length===1)p[v].push([h,u]),f[v].push(B);else{let O=T.replacements.map(W=>(i.glyphs.get(W).advanceWidth??0)*r),L=O.reduce((W,I)=>W+=I,0),H=O.map(W=>W/L),q=h;for(let W=0;W<H.length;W++){let I=B*H[W];p[v].push([q,u]),f[v].push(I),q+=I}}h+=B,m=M}u-=n}let g=[];for(let v=0,y=d.length;v<y;v++)g.push(...d[v].toShapes());return{shapes:g,charWidths:f,lineWidths:s,charCoords:p}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var t;return((t=this.font)==null?void 0:t.ascender)??0}get descender(){var t;return((t=this.font)==null?void 0:t.descender)??0}get familyName(){var t;return((t=this.font)==null?void 0:t.names.fontFamily)??""}get subfamilyName(){var t;return((t=this.font)==null?void 0:t.names.fontSubfamily)??""}get unitsPerEm(){var t;return((t=this.font)==null?void 0:t.unitsPerEm)??1}getLineInitialOffsetX(t,e,i,r,n){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(t-=n),i===3?e*.5-t*.5:i===2?e-t:0}getLineInitialOffsetY(t,e,i,r,n){let s=e*t,a=Math.abs(this.ascender-this.descender)*r,o=t-a,l=-this.ascender*r-o/2;return n===3?-(i-s-l):n===2?-(i*.5-s*.5-l):l}createPath(t,e,i,r,n){var l;let s=t.getPath(i,-r,n.fontSize,{kerning:!1,letterSpacing:n.letterSpacing});if(!s){console.error('THREE.Font: character "'+t+'" does not exists in font family '+this.familyName+".");return}let a=new Xje,o=(t.advanceWidth??1)*e;if(t)for(let c of s.commands){let h=(l=a.currentPath)==null?void 0:l.currentPoint;if(!(h&&c.type!=="Z"&&h.x===c.x&&-h.y===c.y))switch(c.type){case"M":a.moveTo(c.x,-c.y);break;case"L":a.lineTo(c.x,-c.y);break;case"Q":a.quadraticCurveTo(c.x1,-c.y1,c.x,-c.y);break;case"C":a.bezierCurveTo(c.x1,-c.y1,c.x2,-c.y2,c.x,-c.y);break}}return a.subPaths.forEach(c=>{let h=Zje(c.curves);h!==void 0&&c.currentPoint.distanceTo(h)>0&&c.lineTo(h.x,h.y)}),{offsetX:o+n.fontSize*n.letterSpacing,path:a}}getCharWidth(t,e){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(t,e.fontSize,{kerning:!0,letterSpacing:e.letterSpacing}))??0}getTextWidth(t,e){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(t,e.fontSize,{kerning:!0,letterSpacing:e.letterSpacing}))??0}computeSpaceWidthForLine(t,e,i){let r=this.getCharWidth(" ",i),n=t[e];if(n){let s=this.countSpaces(n.trimEnd());if(i.horizontalAlign===4&&e<t.length-1&&s){let a=i.width,o=this.getTextWidth(n,i);return(a-(o-s*r))/s}}return r}countSpaces(t){return(t.match(/ /g)||[]).length}};function Zje(t){if(t.length){let e=t[0];if(e instanceof Rc)return e.v1;if(e instanceof Ac||e instanceof vp)return e.v0}}var eWe=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(t){return this.objects.get(t)}get size(){return this.objects.size}get(t,e,i){let r=this.objects.get(t);return r===void 0?(r=this.createObject(t,e,i),this.objects.set(t,r)):r.isShared=!0,r}forceDelete(t){let e=this.objects.get(t);e&&(this.disposeObject(e),this.objects.delete(t))}mutateIfUnique(t,e){let i=this.objects.get(t);if(i&&i.isShared!==!0)return this.objects.delete(t),this.objects.set(e,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(t,e){let i=this.objects.get(t);e===i&&this.unreachable.delete(t)}endGc(){this.unreachable.forEach(t=>{this.disposeObject(this.objects.get(t)),this.objects.delete(t)}),this.unreachable.clear()}dispose(){this.objects.forEach(t=>{this.disposeObject(t)}),this.objects.clear()}},dK=class extends eWe{constructor(t){super(),this.flatShading=t}disposeObject(t){t.dispose()}createObject(t,e,i){let r=RS(t,e,this.flatShading,i);return r.computeBoundingSphere(),r}},tWe={markNeedsUpdateRendererDirty:()=>{}},vC=1e3,fK=512*vC;function iWe(t,e){let i=typeof t;return!!((e==="string"||e==="number")&&i===e||e==="boolean"&&(t==="true"||t==="false"||t===!0||t===!1)||e==="image"&&i==="string"&&t.startsWith("http"))}var rWe="https://hooks.spline.design",nWe=`${rWe}/events?hashFile=`,sWe=class{constructor(e,i){this.id=e,this.userWebhook=i,this.result=void 0,this._connected=!1,this.emitter=jD(),this.reconnectWaitFor=vC,this._onError=r=>{var n,s,a;(n=this.eventSource)==null||n.removeEventListener("message",this._onMessage),(s=this.eventSource)==null||s.removeEventListener("error",this._onError),(a=this.eventSource)==null||a.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=r=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=vC,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=vC,this._connected=!1},this._onMessage=r=>{let n=r.data,s;try{s=JSON.parse(n)}catch(a){console.error("Error parsing webhook message",a)}if(s){let a=!1;this.userWebhook.parametersSchemas.forEach(({data:o})=>{s[o.name]!==void 0&&iWe(s[o.name],o.type)&&(this.result===void 0&&(this.result={}),this.result[o.name]=s[o.name],a=!0)}),a&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(nWe+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){var e,i,r,n;(e=this.eventSource)==null||e.removeEventListener("message",this._onMessage),(i=this.eventSource)==null||i.removeEventListener("error",this._onError),(r=this.eventSource)==null||r.removeEventListener("open",this._onConnected),(n=this.eventSource)==null||n.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>fK&&(this.reconnectWaitFor=fK),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout(()=>{this.scheduledReconnectHandle=void 0,this.connect()},this.reconnectWaitFor)}update(e){this.userWebhook=e}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(e,i){this.emitter.on(e,i)}off(e,i){this.emitter.off(e,i)}getParametersKeys(){return this.userWebhook.parametersSchemas.map(e=>e.data.name)}getParameterValue(e){var i;if(this.getParametersKeys().includes(e)){if(this.result)return(i=this.result)==null?void 0:i[e];for(let r of this.userWebhook.parametersSchemas)if(r.data.name===e)return PN.defaultParameterValueByType(r.data.type)}}},pK=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],aWe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],np=[],PG=[];for(let t=1;t<=8;t++)for(let e=0;e<pK.length;e++){let i=pK[e];np.push(i/Math.pow(2,8-t)),PG.push(aWe[e]+t)}var pP=[32,2e3],mK=np.filter((t,e)=>np[e]>pP[0]&&np[e]<pP[1]),oWe=PG.filter((t,e)=>np[e]>pP[0]&&np[e]<pP[1]),lWe=class{static getFrequencies(t,e,i,r="frequency",n=-100,s=-30){i||(i=new Float32Array(t.frequencyBinCount),t.getFloatFrequencyData(i));let a=e/2,o=1/i.length*a,l,c,h;if(r==="music"||r==="voice"){let d=r==="voice"?mK:np,f=Array(d.length).fill(n);for(let p=0;p<i.length;p++){let m=p*o,g=i[p];for(let v=d.length-1;v>=0;v--)if(m>d[v]){f[v]=Math.max(f[v],g);break}}l=f,c=r==="voice"?mK:np,h=r==="voice"?oWe:PG}else l=Array.from(i),c=l.map((d,f)=>o*f),h=c.map(d=>`${d.toFixed(2)} Hz`);let u=l.map(d=>Math.max(0,Math.min((d-n)/(s-n),1)));return{values:new Float32Array(u),frequencies:c,labels:h}}},cWe="gpt-4o-realtime-preview-2024-12-17",hWe=()=>"https://relayserver.spline.design/";async function uWe(t){try{return(await(await fetch(hWe()+"session?uuidfile="+t)).json()).token}catch(e){console.error("Token generation error:",e)}}var dWe=class{constructor(t){this.value=0,this.frequencies=new Float32Array(0);let e=new AudioContext;this.source=e.createMediaStreamSource(t),this.analyser=e.createAnalyser(),this.source.connect(this.analyser),this.analyser.fftSize=8192,this.analyser.smoothingTimeConstant=.1}getFrequencies(t=-100,e=-30){if(!this.analyser)throw new Error("Not connected, please call .connect() first");return lWe.getFrequencies(this.analyser,44100,void 0,"voice",t,e)}update(){let t=this.getFrequencies(),e=t.values.reduce((i,r)=>i+r,0)/t.values.length;this.value=e,this.frequencies=t.values}disconnect(){this.source.disconnect(),this.analyser.disconnect()}},gK=class{constructor(t,e,i){this.data=t,this.id=e,this.shared=i,this.emitter=jD(),this.rafId=0,this.voice=0,this.frequencies=new Float32Array([0]),this.events=[],this.isConnected=!1,this.isToolsAdded=!1,this.tools=[],this.onMessage=r=>{var s;let n=JSON.parse(r.data);if(this.appendEvent(n),n.type==="session.created"&&this.onSessionCreated(),n.type==="response.done"&&((s=n.response)==null?void 0:s.output)){for(let a of n.response.output)if(a.type==="function_call")for(let[o,l]of this.tools)a.name===o.name&&(l(JSON.parse(a.arguments)),setTimeout(()=>{this.sendClientEvent({type:"response.create",response:{instructions:"notice the user about what you just did"}})}))}},this.onSessionCreated=()=>{this.isToolsAdded||this.registerTools()},this.onOpen=()=>{this.events=[],this.isConnected=!0,this.sendClientEvent({type:"response.create",response:{instructions:"Say hi"}})},this.animate=()=>{if(this.rafId=requestAnimationFrame(this.animate),this.isConnected&&this.analyser){this.analyser.update();let r=this.analyser.value,n=this.analyser.frequencies;this.voice=r,this.frequencies=n,this.emitter.emit("voice",{value:r,frequencies:n})}}}update(t){this.data=t}setColorByName(t,e){let i=this.shared.getColorByName(t);if(i){let{id:r}=i,{r:n,g:s,b:a}=k8e.hexStringToRgb(e)??{r:0,g:0,b:0};this.shared.updateColor(r,{r:n/255,g:s/255,b:a/255})}}async connect(){if(this.isConnected)return;let t=await uWe(this.data.integration.hash);this.pc=new RTCPeerConnection,this.audioElement=document.createElement("audio"),this.audioElement.autoplay=!0,this.pc.ontrack=n=>{let s=n.streams[0];this.audioElement.srcObject=s,this.analyser=new dWe(s)};let e=await navigator.mediaDevices.getUserMedia({audio:!0});this.pc.addTrack(e.getTracks()[0]),this.dc=this.pc.createDataChannel("oai-events"),this.dc.addEventListener("message",this.onMessage),this.dc.addEventListener("open",this.onOpen);let i=await this.pc.createOffer();await this.pc.setLocalDescription(i);let r={type:"answer",sdp:await(await fetch(`https://api.openai.com/v1/realtime?model=${cWe}`,{method:"POST",body:i.sdp,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/sdp"}})).text()};await this.pc.setRemoteDescription(r),this.animate()}appendEvent(t){this.events=[t,...this.events]}sendClientEvent(t){this.dc?(t.event_id=t.event_id||crypto.randomUUID(),this.dc.send(JSON.stringify(t)),this.appendEvent(t)):console.error("Failed to send message - no data channel available",t)}registerTools(){this.isToolsAdded=!0,this.registerTool({type:"function",name:"set_personality_color",description:"returns a color based on the voice personality of the ai assistant. This should be called by the voice assistant each time it is asks to speak differently. If a color cannot be associated to the personality, the color should be a neutral color.",parameters:{type:"object",properties:{color:{type:"string",description:"css hex color string, reflecting the personality"},personality:{type:"string",description:"the personality of the voice assistant"}},required:["color","personality"]}},({color:n})=>{this.setColorByName("Voice Assistant Color",n)});let t=this.shared.getVariablesNames().join(", ");this.registerTool({type:"function",name:"set_variable",description:"Sets a Spline variable value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the variable that needs to be set. Here's a list of available variables: ${t}. It the variable does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"The new value for this variable, should always be a string even for number and boolean variables, assume that the value will be cast to the proper type afterwards."}},required:["name","value","type"]}},({name:n,value:s})=>{let a=this.shared.getVariableByName(n);if(a){let o=this.shared.getVariable(a.id),l;typeof o=="number"?l=parseFloat(s):typeof o=="boolean"?l=s.toLowerCase()==="true":l={textValue:s},this.shared.updateVariable(a.id,l)}});let e=this.shared.getColorNames().join(", ");this.registerTool({type:"function",name:"set_color",description:"Sets a Spline color asset value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the color asset that needs to be set. Here's a list of available color assets: ${e}. It the color asset does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"css hex color string"}},required:["name","value"]}},({name:n,value:s})=>{this.setColorByName(n,s)});let i=this.shared.scene,r=[];i.traverseEntity(n=>{n.data.events.forEach(s=>{if(s.data.type==="AIAssistantTrigger"){let{description:a}=s.data;r.push(a)}})}),this.registerTool({type:"function",name:"trigger_event",description:"Trigger an event by name, here are the available events, please match what the user is asking for to one of these if it applies, otherwise don't call the function and warn the user.",parameters:{type:"object",properties:{description:{type:"string",description:`The name of the event that needs to be triggered. Here's a list of available events: ${JSON.stringify(r)}.`},direction:{type:"string",description:"default is forward, but can be forward or backward. Always set to forward unless the user ask to reverse or cancel the event, then set to backward."}},required:["description","direction"]}},({description:n,direction:s})=>{this.emitter.emit("trigger_event",{description:n,direction:s})}),this.sendClientEvent({type:"session.update",session:{tools:this.tools.map(([n])=>n)}})}registerTool(t,e){this.tools.push([t,e])}disconnect(){var t,e,i,r,n,s;cancelAnimationFrame(this.rafId),(t=this.analyser)==null||t.disconnect(),this.voice=0,this.isConnected=!1,this.isToolsAdded=!1,(e=this.dc)==null||e.removeEventListener("message",this.onMessage),(i=this.dc)==null||i.removeEventListener("open",this.onOpen),(r=this.dc)==null||r.close(),(n=this.pc)==null||n.getSenders().forEach(a=>{a.track&&a.track.stop()}),(s=this.pc)==null||s.close(),this.pc=void 0}computeAnalysisForListenerEvent(t){if(t.analysis==="range"){let e=this.frequencies.slice(...t.analysisRange);return e.reduce((i,r)=>i+r,0)/e.length}return t.analysis==="single"?this.frequencies[t.analysisSingle]:this.voice}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}};function rU(t){return"variable_"+t}var fWe=class extends JHe{constructor(t){super(),this.shared=t}create(t){return new Ple(t,this.shared)}},DG=class{constructor(t,e={},i=!0,r=!1){if(this.data=t,this.needsJitter=i,this.enableLocalStorageForPersistentVariables=r,this.geometryCache=new dK(!0),this.geometryCache2=new dK(!1),this.imageHolderCache=new fWe(this),this.thisContext={scene:tWe,shared:this},this.deletedMaterial=new iU(Es.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new Mf(RN.emptyImage,this),this.deletedVideo=new Mf(K2.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},e.images)for(let[n,s]of Object.entries(e.images))this.addImage(n,s);if(e.videos)for(let[n,s]of Object.entries(e.videos))this.addVideo(n,s);if(e.audios)for(let[n,s]of Object.entries(e.audios))this.addAudio(n,s);if(e.particles)for(let[n,s]of Object.entries(e.particles))this.addParticle(n,s);this.reset(t)}setRequestRender(t){this._requestRender=t}getImageLoadPromises(){return Object.values(this.images).map(t=>t.loadPromise)}setEntityOpContext(t){this.entityOpContext=t}reset(t,e=!1){this.data=t,this.resetLib(t.lib);for(let{id:i,data:r}of t.variables)this.addVariableHolder(i,r),e&&this.updateVariableHolder(i,r);for(let[i,r]of Object.entries(t.userAPIs))this.addUserAPI(i,r);for(let[i,r]of Object.entries(t.userWebhooks))this.addUserWebhook(i,r);for(let[i,r]of Object.entries(t.images))this.addImage(i,r);for(let[i,r]of Object.entries(t.videos))this.addVideo(i,r);for(let[i,r]of Object.entries(t.colors))this.addColor(i,r);for(let[i,r]of Object.entries(t.materials))this.addMaterial(i,r);for(let[i,r]of Object.entries(t.audios))this.addAudio(i,r);for(let[i,r]of Object.entries(t.particles))this.addParticle(i,r);for(let[i,r]of Object.entries(t.fonts))this.addFont(i,r)}addMaterial(t,e){if(this.materials[t]){let i=this.materials[t];i.reset(e,this.thisContext),i.dispose()}else{let i=new iU(e,this.thisContext,t);this.materials[t]=i}}deleteMaterial(t){this.materials[t]&&(this.materials[t].nodeMaterialDispose(),delete this.materials[t])}getMaterial(t){return this.materials[t]}getMaterialOrDeletedPlaceholder(t){return this.materials[t]??this.deletedMaterial}material(t){return typeof t=="string"?this.getMaterialOrDeletedPlaceholder(t):t==null?(console.error("material is undefined or null"),this.deletedMaterial):new CG(t,this.thisContext)}getMaterials(){return this.materials}addImage(t,e){return this.images[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[t].updateSrc(e.data),!0):(this.images[t]=new Mf(e,this),!1)}deleteImage(t){let e=this.images[t];e&&(e.dispose(),delete this.images[t])}getDefaultImage(){return this.images.image_0}getImage(t){return this.images[t]??this.deletedImage}image(t){return typeof t=="string"?this.getImage(t):this.imageHolderCache.load(t)}addUIBuffer(t,e){return this.uiBuffers[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[t].updateSrc(e),!0):(this.uiBuffers[t]=new Mf(e,this),!1)}uiBuffer(t){return this.uiBuffers[t]}addVideo(t,e){return this.videos[t]?(this.videos[t].updateSrc(e.data),!0):(this.videos[t]=new Mf(e,this),!1)}deleteVideo(t){let e=this.videos[t];e&&(e.dispose(),delete this.videos[t])}getVideo(t){return this.videos[t]??this.deletedVideo}video(t){return typeof t=="string"?this.getVideo(t):this.imageHolderCache.load(t)}addColor(t,e){return this.colors[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in e?this.colors[t].setRGBA(e.r,e.g,e.b,e.a):this.colors[t].setRGBA(e.r,e.g,e.b,1),!0):("a"in e?this.colors[t]=new fP(e.r,e.g,e.b,e.a):this.colors[t]=new fP(e.r,e.g,e.b,1),!1)}updateColor(t,e){if(this.colors[t]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[t];return this.colors[t].r=e.r??i.r,this.colors[t].g=e.g??i.g,this.colors[t].b=e.b??i.b,this.colors[t].a=e.a??i.a,!0}return!1}deleteColor(t){this.colors[t]&&delete this.colors[t]}getColor(t){return this.colors[t]}getColorNames(){return Object.values(this.data.colors).map(t=>t.name)}getColorByName(t){for(let e in this.data.colors)if(this.data.colors[e].name===t)return{color:this.colors[e],id:e}}color(t){let e;if(typeof t=="string"){let i=this.getColor(t);i?e=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),e=new Qs(0,0,0,0))}else return"a"in t?new Qs(t.r,t.g,t.b,t.a):new Qs(t.r,t.g,t.b,1);return e}addAudio(t,e){this.audios[t]=e}getAudio(t){let e=this.audios[t];if(e instanceof Vb)return e;{let i=new Vb({src:e.data});return this.audios[t]=i,i}}addParticle(t,e){this.particles[t]=e}getParticle(t){return this.particles[t]}deleteParticle(t){this.particles[t]&&delete this.particles[t]}deleteAudio(t){let e=this.audios[t];e&&(e instanceof Vb&&e.dispose(),delete this.audios[t])}addFont(t,e){this.fonts[t]=new Jje(e),this.fonts[t].loadingPromise.then(()=>this.requestRender())}getFont(t){return this.fonts[t]}deleteFont(t){this.fonts[t]&&delete this.fonts[t]}dispose(){Object.keys(this.materials).forEach(t=>this.deleteMaterial(t)),this._requestRender=void 0,Object.values(this.audios).forEach(t=>{t instanceof Vb&&t.dispose()}),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(t,e){if(this.variables[t]===void 0){let i=e.value;if(this.enableLocalStorageForPersistentVariables&&e.persistent){let r=localStorage.getItem(rU(t));i=r!==null?JSON.parse(r):e.value}return this.variables[t]={value:i,locations:[],persistent:e.persistent},"dynamicVariableType"in e&&(this.variables[t].dynamicVariablePlayState="Playing",this.variables[t].dynamicVariableToggleIsForward=void 0),!0}return this.variables[t].value=e.value,!1}resetDynamicVariablePlayState(){for(let t in this.variables)this.variables[t].dynamicVariablePlayState!==void 0&&(this.variables[t].dynamicVariablePlayState="Playing",this.variables[t].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(t,e){this.updateVariable(t,e.value)}updateVariable(t,e){if(this.variables[t]===void 0)return!1;this.variables[t].value=e,this.enableLocalStorageForPersistentVariables&&this.variables[t].persistent&&localStorage.setItem(rU(t),JSON.stringify(e));let i=e;for(;typeof i=="string";)i=this.variables[i].value;let r=this.entityOpContext.scene;for(let n=this.variables[t].locations.length-1;n>=0;n--){let s=this.variables[t].locations[n];if(s[0]==="material"){let a=s[1],o=i,l={scene:r,shared:this},c=s.slice(2);r.traverseMaterial(u=>{let d=u.root??u;d.uuid===a&&d.onVariableUpdate(c,o,l)});let h=this.materials[a];h&&h.onVariableUpdate(c,o,l)}else{let a=r.find(s[0]);if(a===void 0){this.variables[t].locations.splice(n,1);continue}if(s[1]!=="geometry"&&s[1]!=="particles"){for(let o=1;o<s.length-1;o++)a=a[s[o]];s[1]==="rotation"?a[s[s.length-1]]=i*Et.DEG2RAD:a[s[s.length-1]]=i}if(a=r.find(s[0]),a.type==="ParticleEmitter"&&a.updateVariableState(i,s),Ti.is(a))if(s[1]==="position"||s[1]==="rotation"||s[1]==="scale")a.onVariableUpdate();else if(s[1]==="geometry"){let o=a;a.component&&(o=a.component);let l=o.dataPatched;o.chooseGeoemtryCache(this).forceDelete(l.geometry),o.createGeometryDelayed(this.entityOpContext),o.onVariableUpdate(!0),o.invalidateDownstreamBooleanData(),o.instances.forEach(c=>{let h=c.dataPatched;c.chooseGeoemtryCache(this).forceDelete(h.geometry),c.createGeometryDelayed(this.entityOpContext),c.onVariableUpdate(!0),c.invalidateDownstreamBooleanData()})}else s[1]==="morphTargetInfluences"&&a.updateMorphInfluences(s[2],i)}}return this.requestRender(),!0}deleteVariable(t){this.variables[t]&&delete this.variables[t]}getVariable(t,e){var i,r,n;if(Array.isArray(t)){if(t[0]==="mouse")return((i=this.mouseProperty)==null?void 0:i[t[1]])??0;if(t[0]==="raycast")return((r=this.raycastProperty)==null?void 0:r[t[1]])??0;let s=this.entityOpContext.scene.find(t[0]);if(t[1]==="width"||t[1]==="height"||t[1]==="depth")return s.geometry.userData.parameters[t[1]];for(let a=1;a<t.length;a++)s=s[t[a]];return t[1]==="rotation"&&(s*=Et.RAD2DEG),s}for(let s in this.variables){if(e===void 0)break;let a=this.variables[s],o=(n=a.locations)==null?void 0:n.findIndex(l=>es.equal(l,e));o!==void 0&&o!==-1&&a.locations.splice(o,1)}if(typeof t=="string"){let s=t,a=t;do{if(a=s,this.variables[s]===void 0)break;let o=this.variables[s].value;e&&this.variables[a]!==void 0&&this.variables[a].locations.push(e),s=o}while(typeof s=="string");return s}else return t}getVariables(){return this.variables}getVariablesNames(){return this.data.variables.map(t=>t.data.name)}getVariableByName(t){for(let e of this.data.variables)if(e.data.name===t)return{variable:e.data,id:e.id}}getDynamicVariablePlayState(t){var e;return(e=this.variables[t])==null?void 0:e.dynamicVariablePlayState}setDynamicVariablePlayState(t,e){this.variables[t]!==void 0&&(this.variables[t].dynamicVariablePlayState=e)}getDynamicVariableToggleIsForward(t){var e;return(e=this.variables[t])==null?void 0:e.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(t,e){this.variables[t]!==void 0&&(this.variables[t].dynamicVariableToggleIsForward=e)}resetLib(t){for(let[e,i]of Object.entries(t.images))this.addImage(e,i.asset);for(let[e,i]of Object.entries(t.audios))this.addAudio(e,i.asset);for(let[e,i]of Object.entries(t.particles))this.addParticle(e,i.asset);for(let[e,i]of Object.entries(t.colors))this.addColor(e,i.asset);for(let[e,i]of Object.entries(t.fonts))this.addFont(e,i.asset);for(let[e,i]of Object.entries(t.materials))this.addMaterial(e,i.asset);for(let[e,i]of Object.entries(t.videos))this.addVideo(e,i.asset);for(let[e,i]of Object.entries(t.variables))this.addVariableHolder(e,i.asset)}updateLibByOp(t,e){t.path[0]==="images"?t.path.length===1&&t.type===1?this.addImage(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteImage(t.id):t.path[0]==="videos"?t.path.length===1&&t.type===1?this.addVideo(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteVideo(t.id):t.path[0]==="audios"?t.path.length===1&&t.type===1?this.addAudio(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteAudio(t.id):t.path[0]==="particles"?t.path.length===1&&t.type===1?this.addParticle(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteParticle(t.id):t.path[0]==="colors"?t.path.length===1&&t.type===1?this.addColor(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteColor(t.id):t.path[0]==="materials"?t.path.length===1&&t.type===1?this.addMaterial(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteMaterial(t.id):t.path[0]==="fonts"?t.path.length===1&&t.type===1?this.addFont(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteFont(t.id):t.path[0]==="variables"?t.path.length===1&&t.type===1?this.addVariableHolder(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteVariable(t.id):t.path[0]==="components"&&e.updateByLibOp(t,this)}updateByOp(t,e,i){var r;if(this.data=e,t.path[0]==="images")t.path.length===2&&t.type===0?t.props.data&&this.getImage(t.path[1]).updateSrc(t.props.data):t.path.length===1&&t.type===1?this.addImage(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteImage(t.id);else if(t.path[0]==="videos")t.path.length===2&&t.type===0?t.props.data&&this.getVideo(t.path[1]).updateSrc(t.props.data):t.path.length===1&&t.type===1?this.addVideo(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteVideo(t.id);else if(t.path[0]==="audios")t.path.length===2&&t.type===0?t.props.data&&this.addAudio(t.path[1],e.audios[t.path[1]]):t.path.length===1&&t.type===1?this.addAudio(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteAudio(t.id);else if(t.path[0]==="particles")t.path.length===2&&t.type===0?t.props.data&&this.addParticle(t.path[1],e.particles[t.path[1]]):t.path.length===1&&t.type===1?this.addParticle(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteParticle(t.id);else if(t.path[0]==="colors")t.path.length===2&&t.type===0?this.updateColor(t.path[1],t.props):t.path.length===1&&t.type===1?this.addColor(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteColor(t.id);else if(t.path[0]==="materials")t.path.length===1&&t.type===1?this.addMaterial(t.id,t.data):t.path.length===1&&t.type===2?this.deleteMaterial(t.id):t.path.length>1&&this.getMaterial(t.path[1]).updateByOp(As.drop(t,2),e.materials[t.path[1]],{shared:this,scene:i});else if(t.path[0]==="fonts")t.path.length===2&&t.type===0?this.updateFont(t.path[1],t,i):t.path.length===1&&t.type===1?this.addFont(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteFont(t.id);else if(t.path[0]==="variables")t.path.length===2&&t.type===0?"value"in t.props?this.updateVariable(t.path[1],t.props.value):"persistent"in t.props&&(this.variables[t.path[1]].persistent=t.props.persistent):t.path.length===1&&t.type===4?this.addVariableHolder(t.id,t.data):t.path.length===1&&t.type===5&&this.deleteVariable(t.id);else if(t.path[0]==="userAPIs"){if(t.path.length===1&&t.type===1)this.addUserAPI(t.id,t.data);else if(t.path.length===1&&t.type===2)this.deleteUserAPI(t.id);else if(typeof t.path[1]=="string"){let n=e.userAPIs[t.path[1]];if(n){let s=t.type===0&&t.props.debounce===void 0,a=this.getUserAPI(t.path[1]);a instanceof gK?a.update(n):a==null||a.update(n,this,s)}}}else if(t.path[0]==="userWebhooks"){if(t.path.length===1&&t.type===1)this.addUserWebhook(t.id,t.data);else if(t.path.length===1&&t.type===2)this.deleteUserWebhook(t.id);else if(typeof t.path[1]=="string"){let n=e.userWebhooks[t.path[1]];n&&((r=this.getUserWebhook(t.path[1]))==null||r.update(n))}}else t.path[0]==="lib"&&this.updateLibByOp(As.drop(t,1),i)}updateFont(t,e,i){if(e.props.url){let r=this.getFont(t),n={...this.data.fonts[t],url:e.props.url};r.update(n),r.loadingPromise.then(()=>this.requestRender()),i.updateFont(t,this)}}addUserAPI(t,e){var i,r;return this.userAPIs[t]?(this.userAPIs[t].update(e,this),!0):((i=this.openAIRealtime)==null?void 0:i.id)===t?(this.openAIRealtime.update(e),!0):((r=e.integration)==null?void 0:r.type)==="VoiceAssistant"?(this.openAIRealtime=new gK(e,t,this),!1):(this.userAPIs[t]=new Xoe(t,e,this),!1)}getUserAPI(t){var e;return((e=this.openAIRealtime)==null?void 0:e.id)===t?this.openAIRealtime:this.userAPIs[t]}getUserAPIs(){return this.userAPIs}deleteUserAPI(t){let e=this.userAPIs[t];e&&(e.dispose(),delete this.userAPIs[t])}addUserWebhook(t,e){return this.userWebhooks[t]?(this.userWebhooks[t].update(e),!0):(this.userWebhooks[t]=new sWe(t,e),!1)}getUserWebhook(t){return this.userWebhooks[t]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(t){let e=this.userWebhooks[t];e&&(e.dispose(),delete this.userWebhooks[t])}get scene(){return this.entityOpContext.scene}};new DG(El.emptyData());var tx=class extends ja{updateByPatchedOp(t,e,i){if(super.updateByPatchedOp(t,e,i),EGe(t.path,["materials"])!==null&&t.type===0&&Array.isArray(this.material))for(let[r,n]of Object.entries(t.props)){let s=i.shared.material(n);this.material[Number(r)]=s}else if(hr(t.path,["material"])&&this.material instanceof xp)"material"in e&&typeof e.material!="string"&&this.material.updateByOp(As.drop(t,1),e.material,i);else if(hr(t.path,["materials","*"])&&Array.isArray(this.material)){let r=t.path[1];if("materials"in e&&r<this.material.length){let n=e.materials[r];typeof n!="string"&&this.material[r].updateByOp(As.drop(t,2),n,i)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(t,e){var n,s;super.updateState(t,e),t.castShadow!==void 0&&(this.castShadow=t.castShadow),t.receiveShadow!==void 0&&(this.receiveShadow=t.receiveShadow);let i=this.dataPatched;this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.shapeBlendNode&&this.layers.set(9);let r;if(this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.type==="ShapeBlendGeometry"&&(r={resolutionLevel:this.dataPatched.geometry.resolutionLevel,useChildrenColors:this.dataPatched.geometry.useChildrenColors}),((n=t.geometry)==null?void 0:n.type)!=="NonParametricGeometry"&&"material"in t&&t.material!==void 0&&(this.disposeMaterial(),this.material=e.shared.material(t.material).getFlavor(i.flatShading,i.side,i.wireframe,r),e.scene.markNeedsUpdateRendererDirty()),(((s=t.geometry)==null?void 0:s.type)==="NonParametricGeometry"||"materials"in t)&&("materials"in t&&t.materials!==void 0?(this.disposeMaterial(),this.material=t.materials.map(a=>e.shared.material(a).getFlavor(i.flatShading,i.side,i.wireframe)),e.scene.markNeedsUpdateRendererDirty()):"material"in t&&t.material!==void 0&&(this.disposeMaterial(),this.material=[e.shared.material(t.material).getFlavor(i.flatShading,i.side,i.wireframe)],e.scene.markNeedsUpdateRendererDirty())),t.flatShading!==void 0||t.wireframe!==void 0||t.side!==void 0)if(Array.isArray(this.material))for(let a=0;a<this.material.length;a++)this.material[a]=this.material[a].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe,r)}disposeMaterial(){this.material&&Fae(this.material).forEach(t=>{t instanceof xp&&(t instanceof iU||t.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},vK=new N,yK=new si,xK=new si,pWe=new N,bK=new st,Fn=class extends tx{constructor(t,e,i){super(t,e),this.data=e,this.isSkinnedMesh=!1,this.localGeometry=void 0,e.bindMode&&e.bindMatrix&&(this.bindMode=e.bindMode,this.bindMatrix=new st().fromArray(e.bindMatrix),this.bindMatrixInverse=new st)}chooseGeoemtryCache(t){return t.geometryCache}markGeometryAsReachable(t){this.geometryCreateDeleyed instanceof Nt&&this.chooseGeoemtryCache(t).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof DG){let t=this.geometryCreateDeleyed,e=this.chooseGeoemtryCache(t);this.geometryCreateDeleyed=e.get(this.dataPatched.geometry,t,this)}return this.geometryCreateDeleyed}set geometry(t){this.localGeometry=t}get is2DAndNoDepth(){let t=this.dataPatched.geometry;return J2.is2DParametricMesh(t.type)&&t.depth===0}get is2DType(){return J2.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),hr(t.path,["geometry"])&&this.updateByPatchedOpGeometry(As.drop(t,1),e.geometry,i)}removeInteractionGeometry(t){var e;(e=this.localGeometry)==null||e.dispose(),this.localGeometry=void 0}updateGeometryInteractions(t,e){var r;this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let n=t;if(this.localGeometry===void 0){let c={...this.data.geometry,...n};this.localGeometry=RS(c,e,this.data.flatShading,this)}let s,a,o;n.scaleBaked?[s,a,o]=n.scaleBaked:{width:s,height:a,depth:o}=n;let l=this.localGeometry.userData;l.sxPrev!==void 0&&QN(this.localGeometry.attributes,s/l.sxPrev,a/l.syPrev,o/l.szPrev),l.sxPrev=s,l.syPrev=a,l.szPrev=o}else{let n={...this.data.geometry,...t};(r=this.localGeometry)==null||r.dispose(),this.localGeometry=RS(n,e,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let t of this.attachedSurfaceCloners)t.update()}refreshAttachedCloners(t){for(let e of this.attachedSurfaceCloners)t.scene.addPendingUpdateCloner(e.object)}refreshAttachedPaths(t){for(let e of this.attachedPaths)t.scene.addPendingCommand(()=>e.updateShape())}createGeometryDelayed(t){this.geometryCreateDeleyed=t.shared,this.refreshAttachedCloners(t),this.refreshAttachedPaths(t)}updateByPatchedOpGeometry(t,e,i){var n;let r=!1;t.type===0&&t.path.length===0&&Object.keys(t.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof Oa&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,e)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(e,t.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||((n=i.scene)==null||n.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(t,e){this.createGeometryDelayed(e)}updateState(t,e){t.geometry!==void 0&&this.updateGeometryOnStateUpdate(t.geometry,e);let i=t.morphTargetInfluences;if(i){this.updateMorphTargets(),this.geometry.morphTargetsRelative=!0;for(let{data:{name:r,value:n}}of i)this.updateMorphInfluences(r,e.shared.getVariable(n,[this.uuid,"morphTargetInfluences",r]))}super.updateState(t,e)}updateMorphInfluences(t,e){if(this.morphTargetDictionary===void 0)return;let i=this.morphTargetDictionary[t];i!==void 0&&(this.morphTargetInfluences[i]=e)}updateGeometryGroupsIfNeeded(){var t;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((t=this.geometry.getIndex())==null?void 0:t.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(t,e){let i=this.geometry.userData.parameters;this.is2DType?t.set(0,0,i.depth*.5):this.isNonParametric?(t.setScalar(0),this.geometry.boundingSphere&&t.copy(this.geometry.boundingSphere.center),e.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):i.centerOffset?t.fromArray(i.centerOffset):t.setScalar(0),e.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(t,e){this.skeleton=t,this.isSkinnedMesh=!0,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(t){let e=new si,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){e.fromBufferAttribute(i,r);let s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),i.setXYZW(r,e.x,e.y,e.z,e.w)}}boneTransform(t,e){let i=this.skeleton;if(i===void 0)return;let r=this.geometry;yK.fromBufferAttribute(r.attributes.skinIndex,t),xK.fromBufferAttribute(r.attributes.skinWeight,t),vK.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let n=0;n<4;n++){let s=xK.getComponent(n);if(s!==0){let a=yK.getComponent(n);bK.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),e.addScaledVector(pWe.copy(vK).applyMatrix4(bK),s)}}return e.applyMatrix4(this.bindMatrixInverse)}};function mWe(t){var a,o;if(t.geometry.attributes.extrudeNormal||!t.geometry.attributes.position||!t.geometry.attributes.normal)return;let e=new Map,i=t.geometry.attributes,r=i.position.array,n=i.normal.array,s=new Float32Array(r.length);for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,h=new N(n[l],n[l+1],n[l+2]);e.has(c)?(a=e.get(c))==null||a.normals.push(h):e.set(c,{normals:[h],result:new N})}e.forEach((l,c)=>{for(let h of l.normals)l.result.add(h);l.result.divideScalar(l.normals.length)});for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,h=(o=e.get(c))==null?void 0:o.result;h&&(s[l]=h.x,s[l+1]=h.y,s[l+2]=h.z)}t.geometry.setAttribute("extrudeNormal",new bt(s,3))}function gWe(t){if(t.geometry.attributes.extrudeNormals||!t.geometry.attributes.position)return;let e=t.geometry.attributes.position.array,i=new Float32Array(e.length),r=new N;for(let n=0;n<e.length;n+=3)r.set(e[n],e[n+1],e[n+2]).normalize(),i[n]=r.x,i[n+1]=r.y,i[n+2]=r.z;t.geometry.setAttribute("extrudeNormal",new bt(i,3))}function RG(t){if(Array.isArray(t.material)){for(let e of t.material)if(e.getLayersOfType("outline").length===0)return}else if(!(t.material instanceof xp)||t.material.getLayersOfType("outline").length===0)return;t instanceof Fn&&t.is2DAndNoDepth?gWe(t):mWe(t)}function IG(t){if(!t.geometry.attributes.position)return;let e=t.geometry.attributes.position.array,i=new Float32Array(e.length),r=parseInt(t.uuid.replace(/\D/g,"")),n=[Et.seededRandom(r),Et.seededRandom(r+1e4),Et.seededRandom(r+2e4)];for(let s=0;s<e.length;s++)i[s]=n[s%3];t.geometry.setAttribute("randomColor",new Yt(i,3))}var ih=new _n,pb=new N;function vWe(t){let e=!1;return t.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(e=!0)}),e}var IS=class extends Fn{constructor(t,e,i){super(t,e,i),this.data=e,this.hiddenMatrixOld=new st,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(t){return this.dataPatched.flatShading?t.geometryCache:t.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(t,e){let i=this.geometry.userData.parameters;t.copy(this.originalGeometryNew.boundingSphere.center),e.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(t){var s,a,o;if(this.skipReactionUpdate===!0)return;let e=(s=this.localGeometry)==null?void 0:s.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:n}=Oa.build(t,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=n,i!==void 0&&((a=this.originalGeometry)==null||a.dispose(),this.originalGeometry=i),r!==void 0&&((o=this.subdividedGeometry)==null||o.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,RG(this),IG(this),this.calcBoundingBox(),e&&(this.localGeometry.uuid=e)}updateState(t,e){if(super.updateState(t,e),t.flatShading!==void 0){let i=this.material;this.material=Array.isArray(i)?i.map(r=>r.getFlavor(!1,r.side,r.wireframe)):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!t.flatShading,this.createGeometryDelayed(e)}}updateMesh(t=!1){Oa.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,t&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&Oa.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,t&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=Oa.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=Oa.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(t,e){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,ja.prototype.raycast.call(this,t,e),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let t=this.originalGeometry;t.boundingSphere===null&&(t.boundingSphere=new wo,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=t.boundingSphere));let e=t.attributes.position,i=t.boundingSphere.center;ih.setFromBufferAttribute(e),ih.getCenter(i),t.boundingSphere.radius=i.distanceTo(ih.max),isNaN(t.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),ih.getSize(pb),this.hasNonUniformScale&&pb.divide(this.scale);let r={width:pb.x,height:pb.y,depth:pb.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(t){let e=this.originalGeometry;ih.min.set(t[0],t[2],t[4]),ih.max.set(t[1],t[3],t[5]),this.hasNonUniformScale&&(ih.min.applyMatrix4(this.shearScaleInv),ih.max.applyMatrix4(this.shearScaleInv)),e.boundingSphere===null&&(e.boundingSphere=new wo);let i=e.boundingSphere.center;ih.getCenter(i),e.boundingSphere.radius=i.distanceTo(ih.max)}freeSubdivPointer(){var t,e;this.subdivPointer&&(Oa.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(t=this.originalGeometry)==null||t.dispose(),(e=this.subdividedGeometry)==null||e.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(t,e,i){super.updateByPatchedOpGeometry(t,e,i),this.localGeometry&&this.createGeometryByControls(e)}},wK=-1,yWe=1,xWe={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},bWe={polygon_center:0,edge:1,vertex:2},oT=(t,e)=>(i,r)=>!e||i===0||t===0?0:t*r/100,di=(t,e)=>{let i=Math.abs(e),r=i*-1;return(t-wK)*(i-r)/(yWe-wK)+r},wWe=new N,lT=new N,SWe=new N,_We=new N;function By(t,e){let i=SWe.fromArray(t),r=_We.fromArray(e);lT.copy(r).sub(i);let n=lT.length();return lT.normalize().multiplyScalar(n*.5),wWe.copy(i).add(lT).toArray()}var Dl=new Ws,cT=new N,mP=new N,Om=new N;function AWe(t){let e=[];for(let i=0;i<=t.index.count;i++)if(cT.fromArray(t.index.array,i*3),Dl.setFromAttributeAndIndices(t.attributes.position,cT.x,cT.y,cT.z),Dl.getNormal(mP),Dl.getMidpoint(Om),!(isNaN(Om.x)||isNaN(Om.y)||isNaN(Om.z))){let{a:r,b:n,c:s}=Dl,a=r.toArray(),o=n.toArray(),l=s.toArray(),c=r.distanceTo(n),h=n.distanceTo(s),u=s.distanceTo(r),d=By(a,o),f=By(o,l),p=By(l,a),m=[c,h,u],g=Math.max(...m),v=m.filter(S=>Math.round(S)===Math.round(g)).length>1,y=[],x=Dl.getMidpoint(Om).toArray();g===c&&!v&&(y=[f,p,p],x=d),g===h&&!v&&(y=[d,p,p],x=f),g===u&&!v&&(y=[d,f,f],x=p),v&&(y=[d,f,p]),e.push({vertices:[a,o,l],faceCenters:y,midpoint:x,norm:Dl.getNormal(mP).toArray()})}return e}function EWe(t){let e=[],{position:i}=t.attributes;for(let r=0;r<i.count;r++){Dl.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),Dl.getNormal(mP),Dl.getMidpoint(Om);let n=Dl.a.toArray(),s=Dl.b.toArray(),a=Dl.c.toArray();e.push({vertices:[n,s,a],faceCenters:[By(n,s),By(s,a),By(a,n)],midpoint:Om.toArray(),norm:mP.toArray()})}return e}var MWe=4,TWe=.5,wO=t=>.5*(1-Math.cos(t*Math.PI)),CWe=class{constructor(){this.perlin=new Array(4096)}noise(t,e=0,i=0){if(this.perlin==null){this.perlin=new Array(4096);for(let g=0;g<4096;g++)this.perlin[g]=Math.random()}t<0&&(t=-t),e<0&&(e=-e),i<0&&(i=-i);let r=Math.floor(t),n=Math.floor(e),s=Math.floor(i),a=t-r,o=e-n,l=i-s,c,h,u=0,d=.5,f,p,m;for(let g=0;g<MWe;g++){let v=r+(n<<4)+(s<<8);c=wO(a),h=wO(o),f=this.perlin[v&4095],f+=c*(this.perlin[v+1&4095]-f),p=this.perlin[v+16&4095],p+=c*(this.perlin[v+16+1&4095]-p),f+=h*(p-f),v+=256,p=this.perlin[v&4095],p+=c*(this.perlin[v+1&4095]-p),m=this.perlin[v+16&4095],m+=c*(this.perlin[v+16+1&4095]-m),p+=h*(m-p),f+=wO(l)*(p-f),u+=f*d,d*=TWe,r<<=1,a*=2,n<<=1,o*=2,s<<=1,l*=2,a>=1&&(r++,a--),o>=1&&(n++,o--),l>=1&&(s++,l--)}return u}noiseSeed(t){let e=(()=>{let i,r;return{setSeed(n){r=i=(n??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();e.setSeed(t),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=e.rand()}},PWe=CWe,SK=new N,_K=new st,AK=new G1;function EK(t){let e=!1;return t.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&(r.geometry.type==="TextGeometry"||r.geometry.type==="InputGeometry")&&(e=!0)}),e}var LG=class extends Fn{constructor(t,e,i){super(t,e,i),this.data=e}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var e;let t=this.dataPatched;return((e=this.font)==null?void 0:e.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,t.geometry.height,this.fontScale,t.geometry.verticalAlign))??0}get fontScale(){let t=this.dataPatched;return this.font?t.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var t;return(((t=this.font)==null?void 0:t.ascender)??1)*this.fontScale}get descender(){var t;return(((t=this.font)==null?void 0:t.descender)??1)*this.fontScale}get lineHeight(){let t=this.dataPatched;return t.geometry.fontSize*t.geometry.lineHeight}raycast(t,e){let{matrixWorld:i}=this;if(!(isNaN(t.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(_K.copy(i).invert(),AK.copy(t.ray).applyMatrix4(_K),AK.intersectBox(this.singleBBox,SK))){let r=SK.applyMatrix4(i),n=t.ray.origin.distanceTo(r);e.push({distance:n,point:r.clone(),object:this})}}},Ca=1e-4,rh,zle,Gle,Vle,MK=new N,TK=new N;$oe.then(t=>{rh=t,zle=[rh.get_face_center,rh.get_edge_midpoint,rh.get_vertex_position],Gle=[rh.get_face_normal,rh.get_edge_normal,rh.get_vertex_normal],Vle=[rh.face_count,rh.edge_count,rh.vertex_count]});var DWe=new st,RWe=new st,sf=new N,hT=new N,mb=new N,SO=new N,IWe=new N,LWe=new N,OWe=class{constructor(t,e){this.data=t,this.is3D=e,this.perlin=new PWe,t.noiseType==="perlin"?(this.perlin.noiseSeed(t.seed),e?this.noise=(i,r,n)=>this.perlin.noise(i,r,n):this.noise=i=>this.perlin.noise(i)):e?this.noise=l6e((0,GN.default)(t.seed)):this.noise=o6e((0,GN.default)(t.seed))}},Ol=class extends pG(Ji){constructor(t,e){super(),this.parameters=e,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.random=null,this.object=t}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(t){if(this.parent===null)this.updateState(this.parameters,t);else for(let e of this.children)e instanceof qs&&e.expand()}invalidateTransform(t){this.matrixWorldNeedsUpdate=!0,this.traverse(e=>{e instanceof qs&&e.object===t&&(e.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let t of this.children)t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD())}_updateCount(t){let e;if(t!==void 0?e=t:e=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"){if(!this.parameters.toObject.object)e=0;else if(t===void 0&&this.parameters.toObject.spreadType!=="random")return}if(this.parameters.type==="toObject"&&this.objectForSample){let i=this.children;if(i.length===e)return;if(i.length<e)for(let r=0,n=e-i.length;r<n;++r){let s=new qs(this.object);s.expand(),this.add(s)}else for(let r=0,n=i.length-e;r<n;++r)this.remove(i[r])}else{if(this.children.length===e)return;if(this.children.length<e)for(let i=0,r=e-this.children.length;i<r;++i){let n=new qs(this.object);n.expand(),this.add(n)}else for(let i=0,r=this.children.length-e;i<r;++i)this.remove(this.children[i])}}getRandom(t,e=!1){return(this.random===null||this.random.data.seed!==t.seed||this.random.is3D!==e)&&(this.random=new OWe(t,e)),this.random}_updateRadial(t){let e=t.radial,i=e.start*Et.DEG2RAD,r=e.end*Et.DEG2RAD,n=i-r,s=new Zn(e.rotation[0],e.rotation[1],e.rotation[2]),a;switch(e.axis){case"z":a=new N(0,0,1);break;case"y":a=new N(0,1,0);break;default:case"x":a=new N(1,0,0);break}let o=t.randomnessObject??Of.defaultData([1,1,1]).randomnessObject,l=this.getRandom(o),c=oT(o.strength,this.parameters.randomness);for(let[h,u]of this.children.entries()){let d=h*(o.freqScale/10)+o.movement,f=l.noise(d,d,d),p=h+1;u.scale.x=e.scale[0]+c(p,di(f,o.scale[0]))||Ca,u.scale.y=e.scale[1]+c(p,di(f,o.scale[1]))||Ca,u.scale.z=e.scale[2]+c(p,di(f,o.scale[2]))||Ca,u.position.setScalar(0);let m=n/t.count*h-i;switch(e.axis){case"x":u.rotation.set(0,m,0);break;case"y":u.rotation.set(0,0,m);break;case"z":u.rotation.set(m,0,0);break}u.translateOnAxis(a,e.radius),u.position.x+=e.position[0]+c(p,di(f,o.position[0])),u.position.y+=e.position[1]+c(p,di(f,o.position[1])),u.position.z+=e.position[2]+c(p,di(f,o.position[2]));let g=c(p,di(f,o.rotation[0])),v=c(p,di(f,o.rotation[1])),y=c(p,di(f,o.rotation[2]));e.alignment===!0?(u.rotation.x+=s.x+g,u.rotation.y+=s.y+v,u.rotation.z+=s.z+y):u.rotation.set(s.x+g,s.y+v,s.z+y)}}_updateLinear(t){if(t.type!=="linear")throw new Error;let e=t.linear,i=new Zn(e.rotation[0],e.rotation[1],e.rotation[2]),r=t.randomnessObject??Of.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=oT(r.strength,this.parameters.randomness);for(let[a,o]of this.children.entries()){let l=a*(r.freqScale/10)+r.movement,c=n.noise(l,l,l),h=a+1,u=s(h,di(c,r.rotation[0])),d=s(h,di(c,r.rotation[1])),f=s(h,di(c,r.rotation[2]));o.scale.x=1+(e.scale[0]-1)*a+s(h,di(c,r.scale[0]))||Ca,o.scale.y=1+(e.scale[1]-1)*a+s(h,di(c,r.scale[1]))||Ca,o.scale.z=1+(e.scale[2]-1)*a+s(h,di(c,r.scale[2]))||Ca,o.rotation.x=i.x*a+u,o.rotation.y=i.y*a+d,o.rotation.z=i.z*a+f,o.position.x=e.position[0]*a+s(h,di(c,r.position[0])),o.position.y=e.position[1]*a+s(h,di(c,r.position[1])),o.position.z=e.position[2]*a+s(h,di(c,r.position[2]))}}_updateGrid(t){let e=0,i=t.grid,r=t.randomnessObject??Of.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r,!0),s=oT(r.strength,this.parameters.randomness);if(i.useCenter===!0){let a={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},o=new N(i.size[0]*(i.count[0]-a.x)*.5,i.size[1]*(i.count[1]-a.y)*.5,i.size[2]*(i.count[2]-a.z)*.5);for(let l=0;l<i.count[0];l++)for(let c=0;c<i.count[1];c++)for(let h=0;h<i.count[2];h++){let u=n.noise((l+1)*(r.freqScale/10)+r.movement,(c+1)*(r.freqScale/10)+r.movement,(h+1)*(r.freqScale/10)+r.movement),d=this.children[e++];d.scale.x=1+s(e,di(u,r.scale[0]))||Ca,d.scale.y=1+s(e,di(u,r.scale[1]))||Ca,d.scale.z=1+s(e,di(u,r.scale[2]))||Ca;let f=s(e,di(u,r.rotation[0])),p=s(e,di(u,r.rotation[1])),m=s(e,di(u,r.rotation[2]));d.rotation.set(f,p,m),d.position.x=i.size[0]*l-o.x+s(e,di(u,r.position[0])),d.position.y=i.size[1]*c-o.y+s(e,di(u,r.position[1])),d.position.z=i.size[2]*h-o.z+s(e,di(u,r.position[2]))}}else for(let a=0;a<i.count[0];a++)for(let o=0;o<i.count[1];o++)for(let l=0;l<i.count[2];l++){let c=n.noise((a+1)*(r.freqScale/10)+r.movement,(o+1)*(r.freqScale/10)+r.movement,(l+1)*(r.freqScale/10)+r.movement),h=this.children[e++];h.scale.x=1+s(e,di(c,r.scale[0]))||Ca,h.scale.y=1+s(e,di(c,r.scale[1]))||Ca,h.scale.z=1+s(e,di(c,r.scale[2]))||Ca;let u=s(e,di(c,r.rotation[0])),d=s(e,di(c,r.rotation[1])),f=s(e,di(c,r.rotation[2]));h.rotation.set(u,d,f),h.position.x=i.size[0]*a+s(e,di(c,r.position[0])),h.position.y=-i.size[1]*o+s(e,di(c,r.position[1])),h.position.z=-i.size[2]*l+s(e,di(c,r.position[2]))}}_updateToObject(t){var h;if(t.type!=="toObject")throw new Error;let{toObject:e}=t,i=new Zn(e.rotation[0],e.rotation[1],e.rotation[2]),r=t.randomnessObject??Of.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=oT(r.strength,this.parameters.randomness);if(!e.object){for(let[,u]of this.children.entries())u.position.set(0,0,0),u.scale.setScalar(1),u.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof LG)if(!((h=this.objectForSample.font)!=null&&h.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let a=this.getSubdivData();if(a.length>0){let u=Math.round(a.length*e.count/100);this._updateCount(u)}else{let u=this.objectForSample.geometry.getAttribute("position");if(!u||isNaN(u.count)||u.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let o=new c6e(this.objectForSample).build(),l=xWe[e.axis],c=this.children;o.setRandomGenerator((0,GN.default)(this.object.uuid+e.seed));for(let[u,d]of c.entries()){let f=u*(r.freqScale/10)+r.movement,p=n.noise(f,f,f),m=u+1,g=s(m,di(p,r.rotation[0])),v=s(m,di(p,r.rotation[1])),y=s(m,di(p,r.rotation[2]));e.spreadType==="random"?o.sample(mb,SO):(a.length&&(mb.fromArray(a[u].pos),SO.fromArray(a[u].norm)),this.objectForSample instanceof IS&&mb.applyMatrix4(DWe.copy(this.objectForSample.matrixWorld).invert())),mb.applyMatrix4(this.object.hiddenMatrix.clone().invert()),d.position.copy(mb),sf.fromArray(l);let x=e.align==="normal"?SO:this.object.getWorldDirection(LWe),S=hT.fromArray(e.position);hT.x+=s(m,di(p,r.position[0])),hT.y+=s(m,di(p,r.position[1])),hT.z+=s(m,di(p,r.position[2]));let A=Math.acos(x.dot(sf)),_=IWe.crossVectors(sf,x).normalize(),M=RWe.makeRotationAxis(_,A),E=x.clone().cross(this.object.up).normalize(),T=E.clone().cross(x).normalize(),C=new st().makeBasis(E,x,T),D=new N(sf.y,sf.z,sf.x).normalize(),B=D.clone().cross(sf).normalize(),O=new st().makeBasis(D,sf,B).invert(),L=new st().multiplyMatrices(C,O);d.rotation.setFromRotationMatrix(L),S.applyMatrix4(M),d.position.add(S),d.rotation.x=d.rotation.x+i.x+g,d.rotation.y=d.rotation.y+i.y+v,d.rotation.z=d.rotation.z+i.z+y,d.scale.setScalar(1),d.scale.x=d.scale.x+e.scale[0]+s(m,di(p,r.scale[0]))||Ca,d.scale.y=d.scale.y+e.scale[1]+s(m,di(p,r.scale[1]))||Ca,d.scale.z=d.scale.z+e.scale[2]+s(m,di(p,r.scale[2]))||Ca,d.scale.multiply(this.object.scale),d.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let t=this.parameters.toObject.spreadType,e=new Map,i=(n,s)=>{let a=Math.round(n[0]*1e4)+"_"+Math.round(n[1]*1e4)+"_"+Math.round(n[2]*1e4),o=e.get(a);o?(o.pos[0]+=n[0],o.pos[1]+=n[1],o.pos[2]+=n[2],o.norm[0]+=s[0],o.norm[1]+=s[1],o.norm[2]+=s[2],o.count+=1):e.set(a,{pos:[...n],norm:[...s],count:1})};if(t==="random")return[];if(this.objectForSample instanceof IS){let n=this.objectForSample,s=bWe[t],a=Vle[s],o=zle[s],l=Gle[s],c=a(n.subdivPointerNew);for(let h=0;h<=c-1;h++){let u=o(n.subdivPointerNew,h),d=l(n.subdivPointerNew,h);MK.fromArray(u).applyMatrix4(n.matrixWorld),TK.fromArray(d),i(MK.toArray(),TK.toArray())}}else(this.objectForSample.geometry.index?AWe(this.objectForSample.geometry):EWe(this.objectForSample.geometry)).forEach((n,s)=>{t==="polygon_center"&&i(n.midpoint,n.norm),t==="vertex"&&(i(n.vertices[0],n.norm),i(n.vertices[1],n.norm),i(n.vertices[2],n.norm)),t==="edge"&&(i(n.faceCenters[0],n.norm),i(n.faceCenters[1],n.norm),i(n.faceCenters[2],n.norm))});let r=Array.from(e.values());for(let n of r)n.pos[0]/=n.count,n.pos[1]/=n.count,n.pos[2]/=n.count,n.norm[0]/=n.count,n.norm[1]/=n.count,n.norm[2]/=n.count;return r}updateState(t,e){var i;if(this.parameters=FD(t),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(i=this.object.parent)==null||i.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let r=e.find(this.parameters.toObject.object);r instanceof ja?this.objectForSample=r:this.objectForSample=void 0,this.matrix=new st,this.hiddenMatrix=new st,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,r&&r.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},O_=t=>{var e;return e=class extends t{},e.geometryHelper=new Bc(30,30,30),e},uT=new G1,_O=new wo,CK=new st,B_=(t,e,i,r,n=!1,s=t)=>{let a=e,o=s.matrixWorld;if(a.boundingSphere===null&&a.computeBoundingSphere(),_O.copy(a.boundingSphere),_O.applyMatrix4(o),i.ray.intersectsSphere(_O)===!1||(CK.copy(o).invert(),uT.copy(i.ray).applyMatrix4(CK),a.boundingBox!==null&&uT.intersectsBox(a.boundingBox)===!1))return;let l,c,h,u,d=a.index,f=a.attributes.position,p=a.drawRange,m,g;if(n===!1){let y=Math.max(0,p.start),x=Math.min(d.count,p.start+p.count);for(m=y,g=x;m<g;m+=3)if(c=d.getX(m),h=d.getX(m+1),u=d.getX(m+2),l=v(t,i,uT,f,c,h,u),l){l.faceIndex=Math.floor(m/3),r.push(l);return}}else{let y=a.attributes.position,x=new N,S=new N,A=new N,_=new N,M=2,E=1/((s.scale.x+s.scale.y+s.scale.z)/3),T=E*E,C=Math.max(0,p.start),D=Math.min(y.count,p.start+p.count);for(let B=C,O=D-1;B<O;B+=M){if(x.fromBufferAttribute(y,B),S.fromBufferAttribute(y,B+1),uT.distanceSqToSegment(x,S,_,A)>T)continue;_.applyMatrix4(s.matrixWorld);let L=i.ray.origin.distanceTo(_);L<i.near||L>i.far||r.push({distance:L,point:A.clone().applyMatrix4(s.matrixWorld),object:t})}}function v(y,x,S,A,_,M,E){let T=new N,C=new N,D=new N,B=new N,O=new N;if(T.fromBufferAttribute(A,_),C.fromBufferAttribute(A,M),D.fromBufferAttribute(A,E),S.intersectTriangle(T,C,D,!1,B)===null)return null;O.copy(B),O.applyMatrix4(y.matrixWorld);let L=x.ray.origin.distanceTo(O);return L<x.near||L>x.far?null:{faceIndex:1,distance:L,point:O.clone(),object:y}}},dT=new N,ul=new Lp,BWe=class extends E_{constructor(t){let e=new Nt,i=new Op({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={},a=new Xt(15711266),o=new Xt(15711266),l=new Xt(2857471);c("n1","n2",a),c("n2","n4",a),c("n4","n3",a),c("n3","n1",a),c("f1","f2",a),c("f2","f4",a),c("f4","f3",a),c("f3","f1",a),c("n1","f1",a),c("n2","f2",a),c("n3","f3",a),c("n4","f4",a),c("p","n1",o),c("p","n2",o),c("p","n3",o),c("p","n4",o),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l);function c(u,d,f){h(u,f),h(d,f)}function h(u,d){r.push(0,0,0),n.push(d.r,d.g,d.b),s[u]===void 0&&(s[u]=[]),s[u].push(r.length/3-1)}e.setAttribute("position",new bt(r,3)),e.setAttribute("color",new bt(n,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let t=this.geometry,e=this.pointMap;ul.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,n=.8;lc("n1",e,t,ul,-i,-r,n),lc("n2",e,t,ul,i,-r,n),lc("n3",e,t,ul,-i,r,n),lc("n4",e,t,ul,i,r,n);let s=n;lc("f1",e,t,ul,-i,-r,s),lc("f2",e,t,ul,i,-r,s),lc("f3",e,t,ul,-i,r,s),lc("f4",e,t,ul,i,r,s);let a=s,o=.5;lc("u1",e,t,ul,i*.7*o,r*1.1,a),lc("u2",e,t,ul,-i*.7*o,r*1.1,a),lc("u3",e,t,ul,0,r*(1.1+.9*o),a),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function lc(t,e,i,r,n,s,a){dT.set(n,s,a).unproject(r);let o=e[t];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,h=o.length;c<h;c++)l.setXYZ(o[c],dT.x,dT.y,dT.z)}}var FWe=class extends O_(BWe){constructor(t){super(t),this.object=t,this.object=t,this.name=`CombinedCameraHelper: ${t.uuid}`}updateMatrixWorld(t){super.updateMatrixWorld(t),this.updateTarget()}updateTarget(){let t=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(t)}raycast(t,e){B_(this.object,this.geometry,t,e,!0)}},nU;(t=>t.is=e=>"objectHelper"in e)(nU||(nU={}));var ix=(t,e)=>class extends mG(t){constructor(){super(...arguments),this.objectHelper=new e(this),this.gizmos={}}get geometryHelper(){return e.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof L2&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof Bc?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof L2&&(r.visible=!1)}}},fT=790,xv=new N,AO=new N,EO=new ri,MO=new N,gb=new N,TO=new N,ga=class extends ix(Lp,FWe){constructor(t="",e={...AS.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=d1.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(t,e),this.previousProjectionMatrix=new st,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,r=this.height;this.orthoCamera=new MD(i*-.5,i*.5,r*.5,r*-.5,-5e4,1e4),this.perspCamera=new ua(45,i/r,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(t){this.perspCamera.fov=t}get fov(){return this.perspCamera.fov}setNear(t,e){t==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}setZoom(t,e){e>=0&&(t==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}set cameraType(t){t==="PerspectiveCamera"?this.toPerspective():t==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(t){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(t){t>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}lookAt(t,e,i){typeof t=="number"&&(t=new N(t,e,i)),super.lookAt(t),this.getWorldPosition(xv),this.targetOffset=xv.distanceTo(t)}getTarget(t=new N){return this.getWorldDirection(AO),this.getWorldPosition(xv),AO.multiplyScalar(this.targetOffset),t.copy(xv).add(AO),t}getDistanceToTarget(){let t=this.getTarget();return this.getWorldPosition(xv),xv.distanceTo(t)}updateUp(){this.getWorldQuaternion(EO),MO.set(0,0,1).applyQuaternion(EO),gb.copy(Ji.DEFAULT_UP),this.isUpVectorFlipped&&gb.negate(),gb.applyQuaternion(EO),TO.copy(Ji.DEFAULT_UP).projectOnPlane(MO),this.angleOffsetFromUp=TO.angleTo(gb),this.angleOffsetFromUp*=TO.cross(gb).dot(MO)>=0?1:-1}updateTransformState(t,e){let i=super.updateTransformState(t,e);return t.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=t.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(t){let e=t.getWorldPosition(new N),i=t.getWorldDirection(new N).multiplyScalar(this.targetOffset);return{position:e.clone().add(i),target:e}}getViewToTarget(t){let e=this.getWorldDirection(new N).multiplyScalar(this.targetOffset);return{position:t.clone().sub(e),target:t}}getViewToObject(t){let e=new N;return t.getWorldPosition(e),this.getViewToTarget(e)}setViewplaneSize(t,e,i=!1){if(this.aspect=t/e,i){let r=t>e?this.aspect:1,n=t>e?1:this.aspect;this.left=-fT*.5*r,this.right=fT*.5*r,this.top=fT*.5*(1/n),this.bottom=-fT*.5*(1/n)}else this.left=-t*.5,this.right=t*.5,this.top=e*.5,this.bottom=-e*.5;this.updateProjectionMatrix()}copyViewPlaneSize(t){this.aspect=t.aspect,this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(t){this.perspCamera.setFocalLength(t),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(t,e,i,r,n,s){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(t,e,i,r,n,s):this.orthoCamera.setViewOffset(t,e,i,r,n,s)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(t,e){return super.copy(t,e),this.parent=t.parent,this.orthoCamera.copy(t.orthoCamera),this.perspCamera.copy(t.perspCamera),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.far=t.far,this.view=t.view===null?null:Object.assign({},t.view),this._cameraType=t._cameraType,this.aspect=t.aspect,this.fov=t.fov,this.focus=t.focus,this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this.targetOffset=t.targetOffset,this.updateProjectionMatrix(),this}toCameraState(t=[]){let e={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return Qk(e,t)}updateCameraSubtype(t,e){let i=t==="perspective"?"PerspectiveCamera":"OrthographicCamera";e.zoom!==void 0&&this.setZoom(i,e.zoom),e.near!==void 0&&this.setNear(i,e.near),e.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=e.fov)}updateState(t,e){this.updateCameraState(t,e)}updateCameraState(t,e){this.updateState_Entity(t,e),t.far!==void 0&&(this.far=t.far),t.orthographic!==void 0&&this.updateCameraSubtype("orthographic",t.orthographic),t.perspective!==void 0&&this.updateCameraSubtype("perspective",t.perspective),t.type!==void 0&&(this.cameraType=t.type),t.up!==void 0&&this.up.fromArray(t.up),t.targetOffset!==void 0&&(this.targetOffset=t.targetOffset),t.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=t.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),t.path.length===1&&t.type===0&&this.updateCameraSubtype(t.path[0],t.props)}toState(t){return{...super.toState(t),...this.toCameraState(t),type:this.cameraType}}},bv=new st,kWe=new st;function PK(t){let e=!1;return t.scene.objects.traverse((i,r)=>{var n;((n=r.geometry)==null?void 0:n.type)==="BooleanGeometry"&&(e=!0)}),e}var Yg=class extends tx{constructor(t,e,i){super(t,e),this.data=e,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new Nt,this.onAfterRender=(r,n,s,a,o,l)=>{super.onAfterRender(r,n,s,a,o,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&t.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(t,e=!0){var r;if(this.booleanMeshSetAddress!==-1&&!t)return;for(let n=0;n<this.children.length;n++){let s=this.children[n];s instanceof Yg&&s.dataPatched.visible===!0&&s.recomputeBoolean(t===!0,e)}this.meshSetAddresses=[];for(let n=0;n<this.children.length;n++){let s=this.children[n];if(s instanceof ja&&s.dataPatched.visible===!0&&((r=s.geometry.attributes.position)==null?void 0:r.count)>0&&s.geometry.drawRange.count>0&&s.booleanMeshSetAddress!==0){bv.multiplyMatrices(s.hiddenMatrix,s.matrix);try{if(s.booleanMeshSetAddress===-1){if((s.geometry.index??s.geometry.getAttribute("position")).count/3<15e5&&(s.booleanMeshSetAddress=Du.getMeshSet(s.geometry,t===!0,e)),s.booleanMeshSetAddress===-1)return;Du.transformMeshSet(s.booleanMeshSetAddress,bv),s.booleanMatrixInvOld.copy(bv).invert(),s.booleanWasTransformed=!1}else s instanceof Yg&&s.needsTransformForDownstream===!0?(Du.transformMeshSet(s.booleanMeshSetAddress,bv),s.needsTransformForDownstream=!1):s.booleanWasTransformed===!0&&(Du.transformMeshSet(s.booleanMeshSetAddress,kWe.multiplyMatrices(bv,s.booleanMatrixInvOld)),s.booleanMatrixInvOld.copy(bv).invert(),s.booleanWasTransformed=!1)}catch(a){console.error(a),s.booleanMeshSetAddress=0,s.geometry.userData.booleanOperationDidFail=!0;continue}Du.hasOpenEdges(s.booleanMeshSetAddress)===!1||n===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(s.booleanMeshSetAddress),s.geometry.userData.booleanOperationDidFail=!1):s.geometry.userData.booleanOperationDidFail="openEdges"}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new bt([],0)),this.geometry.setDrawRange(0,0);return}if(t===!0)return Du.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new Nt,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=Du.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(n){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(n)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,RG(this),IG(this)}dispose(){super.dispose(),this.geometry.dispose()}},sU;(t=>{function e(i){return Ti.is(i)&&i instanceof C_}t.is=e})(sU||(sU={}));var OG=(t,e)=>class extends ix(t,e){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},wc=t=>t instanceof ja,Zu=t=>t!==null&&t instanceof Yg,NWe=t=>t instanceof ga,UWe=t=>sU.is(t),aU=t=>nU.is(t),zWe=new N(1,1,1),DK=new N,GWe=new N,RK=new ri,F_=class extends O_(TOe){constructor(t,e=15){super(e),this.object=t,this.dummy=new $u,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${t.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(t,e){B_(this.object,F_.geometryHelper,t,e,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(t){this.object.matrixWorld.decompose(DK,RK,GWe),this.matrix.compose(DK,RK,zWe),super.updateMatrixWorld(t)}updateWorldMatrix(t,e){}},Fy=class extends ix($u,F_){constructor(t,e){super(),this.super_Entity(t,e),this.objectHelper.update()}updateState(t,e){this.updateState_Entity(t,e),"buffer"in t&&Object.keys(t).length===1&&e.scene.reloadSplats()}},yw=class extends ix($u,F_){constructor(t,e,i){super(),this.super_Entity(t,e),this.context=i,this.objectHelper.update()}updateState(t,e){this.updateState_Entity(t,e)}},Hle={RED:0,GREEN:1,BLUE:2,ALPHA:3},k_="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",VWe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}`,pT=class extends Ri{constructor(t=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:t?"2":"1"},uniforms:{kernel64:new et(null),kernel16:new et(null),inputBuffer:new et(null),cocBuffer:new et(null),texelSize:new et(new ye),scale:new et(1)},blending:Nn,depthWrite:!1,depthTest:!1,fragmentShader:VWe,vertexShader:k_}),this.toneMapped=!1,e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}set cocBuffer(t){this.uniforms.cocBuffer.value=t}setCoCBuffer(t){this.uniforms.cocBuffer.value=t}get scale(){return this.uniforms.scale.value}set scale(t){this.uniforms.scale.value=t}getScale(t){return this.uniforms.scale.value=t}setScale(t){this.uniforms.scale.value=t}generateKernel(){let t=2.39996323,e=new Float32Array(128),i=new Float32Array(32),r=0,n=0;for(let o=0;o<80;++o){let l=o*t,c=Math.sqrt(o)/Math.sqrt(80),h=c*Math.cos(l),u=c*Math.sin(l);o%5===0?(i[n++]=h,i[n++]=u):(e[r++]=h,e[r++]=u)}let s=[],a=[];for(let o=0;o<128;)s.push(new si(e[o++],e[o++],e[o++],e[o++]));for(let o=0;o<32;)a.push(new si(i[o++],i[o++],i[o++],i[o++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=a}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e)}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}};function IK(t,e,i){return t*(e-i)-e}function oU(t,e,i){return Math.min(Math.max((t+e)/(e-i),0),1)}var HWe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,jWe=class extends Ri{constructor(t){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new et(null),focusDistance:new et(0),focusRange:new et(0),cameraNear:new et(.3),cameraFar:new et(1e3)},blending:Nn,depthWrite:!1,depthTest:!1,fragmentShader:HWe,vertexShader:k_}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(t)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=Cd){this.depthBuffer=t,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(t){this.uniforms.focusDistance.value=t}get worldFocusDistance(){return-IK(this.focusDistance,this.near,this.far)}set worldFocusDistance(t){this.focusDistance=oU(-t,this.near,this.far)}getFocusDistance(t){this.uniforms.focusDistance.value=t}setFocusDistance(t){this.uniforms.focusDistance.value=t}get focalLength(){return this.focusRange}set focalLength(t){this.focusRange=t}get focusRange(){return this.uniforms.focusRange.value}set focusRange(t){this.uniforms.focusRange.value=t}get worldFocusRange(){return-IK(this.focusRange,this.near,this.far)}set worldFocusRange(t){this.focusRange=oU(-t,this.near,this.far)}getFocalLength(t){return this.focusRange}setFocalLength(t){this.focusRange=t}adoptCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof ua?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},WWe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,XWe="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",LK=class extends Ri{constructor(t=new ye){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new et(null),texelSize:new et(new ye),halfTexelSize:new et(new ye),kernel:new et(0),scale:new et(1)},blending:Nn,depthWrite:!1,depthTest:!1,fragmentShader:WWe,vertexShader:XWe}),this.toneMapped=!1,this.setTexelSize(t.x,t.y)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.inputBuffer=t}get scale(){return this.uniforms.scale.value}set scale(t){this.uniforms.scale.value=t}getScale(){return this.uniforms.scale.value}setScale(t){this.uniforms.scale.value=t}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(t){this.uniforms.kernel.value=t}setKernel(t){this.kernel=t}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e),this.uniforms.halfTexelSize.value.set(t,e).multiplyScalar(.5)}setSize(t,e){let i=this.uniforms;i.texelSize.value.set(1/t,1/e),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},YWe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,qWe=class extends Ri{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new et(null),opacity:new et(1)},blending:Nn,depthWrite:!1,depthTest:!1,fragmentShader:YWe,vertexShader:k_}),this.toneMapped=!1}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}getOpacity(t){return this.uniforms.opacity.value}setOpacity(t){this.uniforms.opacity.value=t}},KWe=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,QWe=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,XD={DEPTH:0,LUMA:1,COLOR:2},$We={DISABLED:0,DEPTH:1,CUSTOM:2},JWe=class extends Ri{constructor(t=new ye,e=XD.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:z1.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new et(null),depthBuffer:new et(null),predicationBuffer:new et(null),texelSize:new et(t)},blending:Nn,depthWrite:!1,depthTest:!1,fragmentShader:KWe,vertexShader:QWe}),this.toneMapped=!1,this.edgeDetectionMode=e}set depthBuffer(t){this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=Cd){this.depthBuffer=t,this.depthPacking=e}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(t){this.defines.EDGE_DETECTION_MODE=t.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(t){this.edgeDetectionMode=t}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(t){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=t.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(t){this.localContrastAdaptationFactor=t}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(t){this.defines.EDGE_THRESHOLD=t.toFixed("6"),this.defines.DEPTH_THRESHOLD=(t*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(t){this.edgeDetectionThreshold=t}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(t){this.defines.PREDICATION_MODE=t.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(t){this.predicationMode=t}set predicationBuffer(t){this.uniforms.predicationBuffer.value=t}setPredicationBuffer(t){this.uniforms.predicationBuffer.value=t}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(t){this.defines.PREDICATION_THRESHOLD=t.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(t){this.predicationThreshold=t}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(t){this.defines.PREDICATION_SCALE=t.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(t){this.predicationScale=t}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(t){this.defines.PREDICATION_STRENGTH=t.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(t){this.predicationStrength=t}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}},ZWe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,e9e="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",cc={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},lU=class extends Ri{constructor(t,e,i,r,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:z1.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new et(null),depthBuffer:new et(null),resolution:new et(new ye),texelSize:new et(new ye),cameraNear:new et(.3),cameraFar:new et(1e3),aspect:new et(1),time:new et(0)},blending:Nn,depthWrite:!1,depthTest:!1,dithering:n}),this.toneMapped=!1,t&&this.setShaderParts(t),e&&this.setDefines(e),i&&this.setUniforms(i),this.adoptCameraSettings(r)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=Cd){this.depthBuffer=t,this.depthPacking=e}setShaderParts(t){return this.fragmentShader=ZWe.replace(cc.FRAGMENT_HEAD,t.get(cc.FRAGMENT_HEAD)).replace(cc.FRAGMENT_MAIN_UV,t.get(cc.FRAGMENT_MAIN_UV)).replace(cc.FRAGMENT_MAIN_IMAGE,t.get(cc.FRAGMENT_MAIN_IMAGE)),this.vertexShader=e9e.replace(cc.VERTEX_HEAD,t.get(cc.VERTEX_HEAD)).replace(cc.VERTEX_MAIN_SUPPORT,t.get(cc.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(t){for(let e of t.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(t){for(let e of t.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(t){this.extensions={};for(let e of t)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(t){this.encodeOutput!==t&&(t?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(t){return this.encodeOutput}setOutputEncodingEnabled(t){this.encodeOutput=t}get time(){return this.uniforms.time.value}set time(t){this.uniforms.time.value=t}setDeltaTime(t){this.uniforms.time.value+=t}adoptCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof ua?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(t,e){let i=this.uniforms;i.resolution.value.set(t,e),i.texelSize.value.set(1/t,1/e),i.aspect.value=t/e}static get Section(){return cc}},t9e=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,i9e=class extends Ri{constructor(t=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:z1.replace(/\D+/g,"")},uniforms:{inputBuffer:new et(null),threshold:new et(0),smoothing:new et(1),range:new et(null)},blending:Nn,depthWrite:!1,depthTest:!1,fragmentShader:t9e,vertexShader:k_}),this.toneMapped=!1,this.colorOutput=t,this.luminanceRange=e}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get threshold(){return this.uniforms.threshold.value}set threshold(t){this.smoothing>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=t}getThreshold(){return this.threshold}setThreshold(t){this.threshold=t}get smoothing(){return this.uniforms.smoothing.value}set smoothing(t){this.threshold>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=t}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(t){this.smoothing=t}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(t){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(t){t?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(t){return this.colorOutput}setColorOutputEnabled(t){this.colorOutput=t}get useRange(){return this.luminanceRange!==null}set useRange(t){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(t){t!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=t,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(t){this.luminanceRange=t}},r9e=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,jle={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},n9e=class extends Ri{constructor(t=null){super({name:"MaskMaterial",uniforms:{maskTexture:new et(t),inputBuffer:new et(null),strength:new et(1)},blending:Nn,depthWrite:!1,depthTest:!1,fragmentShader:r9e,vertexShader:k_}),this.toneMapped=!1,this.setColorChannel(Hle.RED),this.setMaskFunction(jle.DISCARD)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}set maskTexture(t){this.uniforms.maskTexture.value=t,delete this.defines.MASK_PRECISION_HIGH,t.type!==ba&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(t){this.maskTexture=t}set colorChannel(t){this.defines.COLOR_CHANNEL=t.toFixed(0),this.needsUpdate=!0}setColorChannel(t){this.colorChannel=t}set maskFunction(t){this.defines.MASK_FUNCTION=t.toFixed(0),this.needsUpdate=!0}setMaskFunction(t){this.maskFunction=t}get inverted(){return this.defines.INVERTED!==void 0}set inverted(t){this.inverted&&!t?delete this.defines.INVERTED:t&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(t){this.inverted=t}get strength(){return this.uniforms.strength.value}set strength(t){this.uniforms.strength.value=t}getStrength(){return this.strength}setStrength(t){this.strength=t}},s9e=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,a9e="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",o9e=class extends Ri{constructor(t=new ye,e=new ye){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new et(null),searchTexture:new et(null),areaTexture:new et(null),resolution:new et(e),texelSize:new et(t)},blending:Nn,depthWrite:!1,depthTest:!1,fragmentShader:s9e,vertexShader:a9e}),this.toneMapped=!1}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(t){this.uniforms.searchTexture.value=t}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(t){this.uniforms.areaTexture.value=t}setLookupTextures(t,e){this.searchTexture=t,this.areaTexture=e}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(t){let e=Math.min(Math.max(t,0),112);this.defines.MAX_SEARCH_STEPS_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(t){this.orthogonalSearchSteps=t}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(t){let e=Math.min(Math.max(t,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(t){this.diagonalSearchSteps=t}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(t){t?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(t){this.diagonalDetection=t}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(t){let e=Math.min(Math.max(t,0),100);this.defines.CORNER_ROUNDING=e.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(e/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(t){this.cornerRounding=t}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(t){t?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(t){this.cornerDetection=t}setSize(t,e){let i=this.uniforms;i.texelSize.value.set(1/t,1/e),i.resolution.value.set(t,e)}},l9e=new Lp,af=null;function c9e(){if(af===null){let t=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]);af=new Nt,af.setAttribute!==void 0?(af.setAttribute("position",new Yt(t,3)),af.setAttribute("uv",new Yt(e,2))):(af.addAttribute("position",new Yt(t,3)),af.addAttribute("uv",new Yt(e,2)))}return af}var qa=class{constructor(t="Pass",e=new go,i=l9e){this.name=t,this.renderer=null,this.scene=e,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){let e=this.getFullscreenMaterial();e!==null&&(e.needsUpdate=!0),this.rtt=!t}}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let e=this.screen;e!==null?e.material=t:(e=new vr(c9e(),t),e.frustumCulled=!1,this.scene===null&&(this.scene=new go),this.scene.add(e),this.screen=e)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,e=Cd){}render(t,e,i,r,n){throw new Error("Render method not implemented!")}setSize(t,e){}initialize(t,e,i){}dispose(){for(let t of Object.keys(this)){let e=this[t];if(e!==null&&typeof e=="object"&&typeof e.dispose=="function"){if(e instanceof go||e===this.renderer)continue;this[t].dispose()}}}},cU=class extends qa{constructor(t,e=!0){super("CopyPass"),this.fullscreenMaterial=new qWe,this.needsSwap=!1,this.renderTarget=t,t===void 0&&(this.renderTarget=new Di(1,1,{minFilter:mi,magFilter:mi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(t){this.autoResize=t}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(t){this.autoResize=t}render(t,e,i,r,n){this.fullscreenMaterial.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){this.autoResize&&this.renderTarget.setSize(t,e)}initialize(t,e,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==ba?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":t.outputEncoding===fi&&(this.renderTarget.texture.encoding=fi))}},h9e=class extends qa{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(t,e,i,r,n){let s=t.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},CO=new Xt,BG=class extends qa{constructor(t=!0,e=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=t,this.depth=e,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(t,e,i){this.color=t,this.depth=e,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(t){this.overrideClearColor=t}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(t){this.overrideClearAlpha=t}render(t,e,i,r,n){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=t.getClearAlpha(),l=s!==null,c=a>=0;l?(CO.copy(t.getClearColor(CO)),t.setClearColor(s,c?a:o)):c&&t.setClearAlpha(a),t.setRenderTarget(this.renderToScreen?null:e),t.clear(this.color,this.depth,this.stencil),l?t.setClearColor(CO,o):c&&t.setClearAlpha(o)}},of=-1,uo=class extends Js{constructor(t,e=of,i=of,r=1){super(),this.resizable=t,this.base=new ye(1,1),this.preferred=new ye(e,i),this.target=this.preferred,this.s=r}get width(){let{base:t,preferred:e,scale:i}=this,r;return e.width!==of?r=e.width:e.height!==of?r=Math.round(e.height*(t.width/Math.max(t.height,1))):r=Math.round(t.width*i),r}set width(t){this.preferredWidth=t}get height(){let{base:t,preferred:e,scale:i}=this,r;return e.height!==of?r=e.height:e.width!==of?r=Math.round(e.width/Math.max(t.width/Math.max(t.height,1),1)):r=Math.round(t.height*i),r}set height(t){this.preferredHeight=t}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(t){this.s!==t&&(this.s=t,this.preferred.setScalar(of),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(t){this.scale=t}get baseWidth(){return this.base.width}set baseWidth(t){this.base.width!==t&&(this.base.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(t){this.base.width!==t&&(this.base.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(t){this.base.height!==t&&(this.base.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(t){this.baseHeight=t}setBaseSize(t,e){(this.base.width!==t||this.base.height!==e)&&(this.base.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(t){this.preferred.width!==t&&(this.preferred.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(t){this.preferredWidth=t}get preferredHeight(){return this.preferred.height}set preferredHeight(t){this.preferred.height!==t&&(this.preferred.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(t){this.preferredHeight=t}setPreferredSize(t,e){(this.preferred.width!==t||this.preferred.height!==e)&&(this.preferred.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(t){this.base.set(t.getBaseWidth(),t.getBaseHeight()),this.preferred.set(t.getPreferredWidth(),t.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return of}},PO=!1,OK=class{constructor(t=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(t),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let i;if(e.material.flatShading)switch(e.material.side){case pa:i=this.materialsFlatShadedDoubleSide;break;case Ts:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(e.material.side){case pa:i=this.materialsDoubleSide;break;case Ts:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=i[2]:e.isInstancedMesh?e.material=i[1]:e.material=i[0],++this.meshCount}}}setMaterial(t){if(this.disposeMaterials(),this.material=t,t!==null){let e=this.materials=[t.clone(),t.clone(),t.clone()];for(let i of e)i.uniforms=Object.assign({},t.uniforms),i.side=Lc;e[2].skinning=!0,this.materialsBackSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.side=Ts,r}),this.materialsDoubleSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.side=pa,r}),this.materialsFlatShaded=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=Ts,r}),this.materialsFlatShadedDoubleSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=pa,r})}}render(t,e,i){let r=t.shadowMap.enabled;if(t.shadowMap.enabled=!1,PO){let n=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),t.render(e,i);for(let s of n)s[0].material=s[1];this.meshCount!==n.size&&n.clear()}else{let n=e.overrideMaterial;e.overrideMaterial=this.material,t.render(e,i),e.overrideMaterial=n}t.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){let t=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let e of t)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return PO}static set workaroundEnabled(t){PO=t}},u9e=class extends qa{constructor(t,e,i=null){super("RenderPass",t,e),this.needsSwap=!1,this.clearPass=new BG,this.overrideMaterialManager=i===null?null:new OK(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(t){super.renderToScreen=t,this.clearPass.renderToScreen=t}get overrideMaterial(){let t=this.overrideMaterialManager;return t!==null?t.material:null}set overrideMaterial(t){let e=this.overrideMaterialManager;t!==null?e!==null?e.setMaterial(t):this.overrideMaterialManager=new OK(t):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(t){this.overrideMaterial=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getSelection(){return this.selection}setSelection(t){this.selection=t}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(t){this.ignoreBackground=t}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(t){this.skipShadowMapUpdate=t}getClearPass(){return this.clearPass}render(t,e,i,r,n){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,c=s.background,h=t.shadowMap.autoUpdate,u=this.renderToScreen?null:e;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(t.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(t,e),t.setRenderTarget(u),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(t,s,a):t.render(s,a),a.layers.mask=l,s.background=c,t.shadowMap.autoUpdate=h}},BK=class extends qa{constructor(t,e,{resolutionScale:i=1,width:r=uo.AUTO_SIZE,height:n=uo.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new u9e(t,e,new Pse({depthPacking:pse}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new Xt(16777215),o.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new Di(1,1,{minFilter:bi,magFilter:bi,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new uo(this,r,n,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,i,r,n){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(t,s)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height)}},Li={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},d9e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",f9e="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",p9e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",m9e="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",g9e="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",v9e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",y9e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",x9e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",b9e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",w9e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",S9e="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",_9e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",A9e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",E9e="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",M9e="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",T9e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",C9e="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",P9e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",D9e=new Map([[Li.SKIP,null],[Li.ADD,d9e],[Li.ALPHA,f9e],[Li.AVERAGE,p9e],[Li.COLOR_BURN,m9e],[Li.COLOR_DODGE,g9e],[Li.DARKEN,v9e],[Li.DIFFERENCE,y9e],[Li.EXCLUSION,x9e],[Li.LIGHTEN,b9e],[Li.MULTIPLY,w9e],[Li.DIVIDE,S9e],[Li.NEGATION,_9e],[Li.NORMAL,A9e],[Li.OVERLAY,E9e],[Li.REFLECT,M9e],[Li.SCREEN,T9e],[Li.SOFT_LIGHT,C9e],[Li.SUBTRACT,P9e]]),R9e=class extends Js{constructor(t,e=1){super(),this.f=t,this.opacity=new et(e)}getOpacity(){return this.opacity.value}setOpacity(t){this.opacity.value=t}get blendFunction(){return this.f}set blendFunction(t){this.f=t,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(t){this.blendFunction=t}getShaderCode(){return D9e.get(this.blendFunction)}},Bh={NONE:0,DEPTH:1,CONVOLUTION:2},Qh=class extends Js{constructor(t,e,{attributes:i=Bh.NONE,blendFunction:r=Li.SCREEN,defines:n=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=t,this.renderer=null,this.attributes=i,this.fragmentShader=e,this.vertexShader=o,this.defines=n,this.uniforms=s,this.extensions=a,this.blendMode=new R9e(r),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(t){this.renderer=t}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(t){this.attributes=t,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(t){this.fragmentShader=t,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(t){this.vertexShader=t,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(t,e=Cd){}update(t,e,i){}setSize(t,e){}initialize(t,e,i){}dispose(){for(let t of Object.keys(this)){let e=this[t];if(e!==null&&typeof e=="object"&&typeof e.dispose=="function"){if(e instanceof go||e===this.renderer)continue;this[t].dispose()}}}};function FK(t,e,i){for(let r of e){let n="$1"+t+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let a of i.entries())a[1]!==null&&i.set(a[0],a[1].replace(s,n))}}function I9e(t,e,i,r,n,s,a){let o=new Map([["fragment",e.getFragmentShader()],["vertex",e.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),c=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),h=[],u=[],d=!1,f=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",e);else if(c&&a&Bh.CONVOLUTION)console.error("Effects that transform UV coordinates are incompatible with convolution effects",e);else if(!l&&!c)console.error("The fragment shader contains neither a mainImage nor a mainUv function",e);else{let p=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,m=lU.Section;if(c){let v=`	${t}MainUv(UV);
`;i.set(m.FRAGMENT_MAIN_UV,i.get(m.FRAGMENT_MAIN_UV)+v),d=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let v=`	${t}MainSupport(`;v+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,i.set(m.VERTEX_MAIN_SUPPORT,i.get(m.VERTEX_MAIN_SUPPORT)+v),h=h.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(y=>y[1])),u=u.concat(h).concat([...o.get("vertex").matchAll(p)].map(y=>y[1]))}u=u.concat([...o.get("fragment").matchAll(p)].map(v=>v[1])),u=u.concat([...e.defines.keys()].map(v=>v.replace(/\([\w\s,]*\)/g,""))),u=u.concat([...e.uniforms.keys()]),e.uniforms.forEach((v,y)=>s.set(t+y.charAt(0).toUpperCase()+y.slice(1),v)),e.defines.forEach((v,y)=>n.set(t+y.charAt(0).toUpperCase()+y.slice(1),v)),FK(t,u,n),FK(t,u,o);let g=e.blendMode;if(r.set(g.blendFunction,g),l){let v=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,y=`${t}MainImage(color0, UV, `;a&Bh.DEPTH&&v.test(o.get("fragment"))&&(y+="depth, ",f=!0),y+=`color1);
	`;let x=t+"BlendOpacity";s.set(x,g.opacity),y+=`color0 = blend${g.blendFunction}(color0, color1, ${x});

	`,i.set(m.FRAGMENT_MAIN_IMAGE,i.get(m.FRAGMENT_MAIN_IMAGE)+y),y=`uniform float ${x};

`,i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+y)}i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&i.set(m.VERTEX_HEAD,i.get(m.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:h,transformedUv:d,readDepth:f}}var gP=class extends qa{constructor(t,...e){super("EffectPass"),this.fullscreenMaterial=new lU(null,null,null,t),this.effects=e.sort((i,r)=>r.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(t){this.fullscreenMaterial.encodeOutput=t}get dithering(){return this.fullscreenMaterial.dithering}set dithering(t){let e=this.fullscreenMaterial;e.dithering=t,e.needsUpdate=!0}verifyResources(){let t=this.renderer.capabilities,e=Math.min(t.maxFragmentUniforms,t.maxVertexUniforms);this.uniformCount>e&&console.warn("The current rendering context doesn't support more than "+e+" uniforms, but "+this.uniformCount+" were defined"),e=t.maxVaryings,this.varyingCount>e&&console.warn("The current rendering context doesn't support more than "+e+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let t=lU.Section,e=new Map([[t.FRAGMENT_HEAD,""],[t.FRAGMENT_MAIN_UV,""],[t.FRAGMENT_MAIN_IMAGE,""],[t.VERTEX_HEAD,""],[t.VERTEX_MAIN_SUPPORT,""]]),i=new Map,r=new Map,n=new Map,s=new Set,a=0,o=0,l=0,c=!1,h=!1;for(let d of this.effects)if(d.blendMode.blendFunction===Li.SKIP)l|=d.getAttributes()&Bh.DEPTH;else if(l&d.getAttributes()&Bh.CONVOLUTION)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let f="e"+a++,p=I9e(f,d,e,i,r,n,l);if(o+=p.varyings.length,c=c||p.transformedUv,h=h||p.readDepth,d.extensions!==null)for(let m of d.extensions)s.add(m)}let u=/\bblend\b/g;for(let d of i.values()){let f=d.getShaderCode().replace(u,`blend${d.blendFunction}`);e.set(t.FRAGMENT_HEAD,e.get(t.FRAGMENT_HEAD)+f+`
`)}l&Bh.DEPTH?(h&&e.set(t.FRAGMENT_MAIN_IMAGE,`float depth = readDepth(UV);

	`+e.get(t.FRAGMENT_MAIN_IMAGE)),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,c?(e.set(t.FRAGMENT_MAIN_UV,`vec2 transformedUv = vUv;
`+e.get(t.FRAGMENT_MAIN_UV)),r.set("UV","transformedUv")):r.set("UV","vUv"),e.forEach((d,f,p)=>p.set(f,d.trim().replace(/^#/,`
#`))),this.uniformCount=n.size,this.varyingCount=o,this.skipRendering=a===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(e).setExtensions(s).setUniforms(n).setDefines(r)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(t,e=Cd){this.fullscreenMaterial.depthBuffer=t,this.fullscreenMaterial.depthPacking=e;for(let i of this.effects)i.setDepthTexture(t,e)}render(t,e,i,r,n){for(let s of this.effects)s.update(t,e,r);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=e.texture,s.time+=r,t.setRenderTarget(this.renderToScreen?null:i),t.render(this.scene,this.camera)}}setSize(t,e){this.fullscreenMaterial.setSize(t,e);for(let i of this.effects)i.setSize(t,e)}initialize(t,e,i){this.renderer=t;for(let r of this.effects)r.initialize(t,e,i),r.addEventListener("change",n=>this.handleEvent(n));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==ba&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let t of this.effects)t.dispose()}handleEvent(t){switch(t.type){case"change":this.recompile();break}}},L9e=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],FG=class extends qa{constructor({resolutionScale:t=.5,width:e=uo.AUTO_SIZE,height:i=uo.AUTO_SIZE,kernelSize:r=YD.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Di(1,1,{minFilter:mi,magFilter:mi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let n=this.resolution=new uo(this,e,i,t);n.addEventListener("change",s=>this.setSize(n.baseWidth,n.baseHeight)),this.blurMaterial=new LK,this.ditheredBlurMaterial=new LK,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=r}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get scale(){return this.blurMaterial.scale}set scale(t){this.blurMaterial.scale=t}getScale(){return this.blurMaterial.scale}setScale(t){this.blurMaterial.scale=t}getKernelSize(){return this.kernelSize}setKernelSize(t){this.kernelSize=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,i,r,n){let s=this.scene,a=this.camera,o=this.renderTargetA,l=this.renderTargetB,c=L9e[this.kernelSize],h=this.blurMaterial,u=e,d,f;for(this.fullscreenMaterial=h,d=0,f=c.length-1;d<f;++d){let p=d&1?l:o;h.kernel=c[d],h.inputBuffer=u.texture,t.setRenderTarget(p),t.render(s,a),u=p}this.dithering&&(h=this.ditheredBlurMaterial,this.fullscreenMaterial=h),h.kernel=c[d],h.inputBuffer=u.texture,t.setRenderTarget(this.renderToScreen?null:i),t.render(s,a)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e);let r=i.width,n=i.height;this.renderTargetA.setSize(r,n),this.renderTargetB.setSize(r,n),this.blurMaterial.setSize(r,n),this.ditheredBlurMaterial.setSize(r,n)}initialize(t,e,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==ba?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):t.outputEncoding===fi&&(this.renderTargetA.texture.encoding=fi,this.renderTargetB.texture.encoding=fi))}static get AUTO_SIZE(){return uo.AUTO_SIZE}},O9e=class extends qa{constructor({width:t=uo.AUTO_SIZE,height:e=uo.AUTO_SIZE,renderTarget:i,luminanceRange:r,colorOutput:n}={}){super("LuminancePass"),this.fullscreenMaterial=new i9e(n,r),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new Di(1,1,{minFilter:mi,magFilter:mi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new uo(this,t,e);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(t,e,i,r,n){let s=this.fullscreenMaterial;s.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height)}initialize(t,e,i){i!==void 0&&i!==ba&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},B9e=class extends qa{constructor(t,e){super("MaskPass",t,e),this.needsSwap=!1,this.clearPass=new BG(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(t){this.inverse=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(t){this.inverted=t}render(t,e,i,r,n){let s=t.getContext(),a=t.state.buffers,o=this.scene,l=this.camera,c=this.clearPass,h=this.inverted?0:1,u=1-h;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,h,4294967295),a.stencil.setClear(u),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(t,null):(c.render(t,e),c.render(t,i))),this.renderToScreen?(t.setRenderTarget(null),t.render(o,l)):(t.setRenderTarget(e),t.render(o,l),t.setRenderTarget(i),t.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},Rl=class extends qa{constructor(t,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=t,this.inputBufferUniform=null,this.setInput(e)}setInput(t){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let e=this.fullscreenMaterial.uniforms;e!==void 0&&e[t]!==void 0&&(this.inputBufferUniform=e[t])}}render(t,e,i,r,n){this.inputBufferUniform!==null&&e!==null&&(this.inputBufferUniform.value=e.texture),t.setRenderTarget(this.renderToScreen?null:i),t.render(this.scene,this.camera)}initialize(t,e,i){i!==void 0&&i!==ba&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},DO=1/1e3,F9e=1e3,k9e=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(t){return this.fixedDeltaEnabled=t,this}isAutoResetEnabled(t){return this.autoReset}setAutoResetEnabled(t){return typeof document<"u"&&document.hidden!==void 0&&(t?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=t),this}getDelta(){return this.delta*DO}getFixedDelta(){return this.fixedDelta*DO}setFixedDelta(t){return this.fixedDelta=t*F9e,this}getElapsed(){return this.elapsed*DO}getTimescale(){return this.timescale}setTimescale(t){return this.timescale=t,this}update(t){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=t!==void 0?t:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(t){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},YD={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},N9e=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,U9e=class extends Qh{constructor({blendFunction:t=Li.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:i=.025,resolutionScale:r=.5,intensity:n=1,width:s=uo.AUTO_SIZE,height:a=uo.AUTO_SIZE,kernelSize:o=YD.LARGE}={}){super("BloomEffect",N9e,{blendFunction:t,uniforms:new Map([["map",new et(null)],["intensity",new et(n)]])}),this.renderTarget=new Di(1,1,{minFilter:mi,magFilter:mi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new O9e({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new FG({resolutionScale:r,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get dithering(){return this.blurPass.dithering}set dithering(t){this.blurPass.dithering=t}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(t){this.blurPass.kernelSize=t}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(t){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(t){this.uniforms.get("intensity").value=t}getIntensity(){return this.intensity}setIntensity(t){this.intensity=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}update(t,e,i){let r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(t,e,r),this.blurPass.render(t,r,r)):this.blurPass.render(t,e,r)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(t,e,i){this.blurPass.initialize(t,e,i),i!==void 0&&(this.renderTarget.texture.type=i,t.outputEncoding===fi&&(this.renderTarget.texture.encoding=fi))}},z9e="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",G9e=class extends Qh{constructor({blendFunction:t=Li.NORMAL,brightness:e=0,contrast:i=0}={}){super("BrightnessContrastEffect",z9e,{blendFunction:t,uniforms:new Map([["brightness",new et(e)],["contrast",new et(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(t){this.uniforms.get("brightness").value=t}getBrightness(t){return this.brightness}setBrightness(t){this.brightness=t}get contrast(){return this.uniforms.get("contrast").value}set contrast(t){this.uniforms.get("contrast").value=t}getContrast(t){return this.contrast}setContrast(t){this.contrast=t}},V9e="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",H9e=class extends Qh{constructor(t=Li.NORMAL){super("ColorAverageEffect",V9e,{blendFunction:t})}},j9e="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",W9e="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",X9e=class extends Qh{constructor({blendFunction:t=Li.NORMAL,offset:e=new ye(.001,5e-4)}={}){super("ChromaticAberrationEffect",j9e,{vertexShader:W9e,blendFunction:t,attributes:Bh.CONVOLUTION,uniforms:new Map([["offset",new et(e)]])})}get offset(){return this.uniforms.get("offset").value}set offset(t){this.uniforms.get("offset").value=t}getOffset(){return this.offset}setOffset(t){this.offset=t}},Y9e=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,q9e=class extends Qh{constructor(t,{blendFunction:e=Li.NORMAL,worldFocusDistance:i,worldFocusRange:r,focusDistance:n=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=uo.AUTO_SIZE,height:c=uo.AUTO_SIZE}={}){super("DepthOfFieldEffect",Y9e,{blendFunction:e,attributes:Bh.DEPTH,uniforms:new Map([["nearColorBuffer",new et(null)],["farColorBuffer",new et(null)],["nearCoCBuffer",new et(null)],["scale",new et(1)]])}),this.camera=t,this.renderTarget=new Di(1,1,{minFilter:mi,magFilter:mi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new Rl(new jWe(t));let h=this.cocMaterial;h.focusDistance=n,h.focusRange=a,i!==void 0&&(h.worldFocusDistance=i),r!==void 0&&(h.worldFocusRange=r),this.blurPass=new FG({kernelSize:YD.MEDIUM,width:l,height:c});let u=this.blurPass.getResolution();u.addEventListener("change",f=>this.setSize(u.getBaseWidth(),u.getBaseHeight())),this.maskPass=new Rl(new n9e(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=jle.MULTIPLY,d.colorChannel=Hle.GREEN,this.bokehNearBasePass=new Rl(new pT(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new Rl(new pT(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new Rl(new pT(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new Rl(new pT(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(t){let e=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of e)i.fullscreenMaterial.setScale(t);this.maskPass.fullscreenMaterial.setStrength(t),this.uniforms.get("scale").value=t}getBokehScale(){return this.bokehScale}setBokehScale(t){this.bokehScale=t}getTarget(){return this.target}setTarget(t){this.target=t}calculateFocusDistance(t){let e=this.camera,i=e.position.distanceTo(t);return oU(-i,e.near,e.far)}setDepthTexture(t,e=Cd){this.circleOfConfusionMaterial.depthBuffer=t,this.circleOfConfusionMaterial.depthPacking=e}update(t,e,i){let r=this.renderTarget,n=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){let o=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=o}this.cocPass.render(t,null,n),this.blurPass.render(t,n,s),this.maskPass.render(t,e,a),this.bokehFarBasePass.render(t,a,r),this.bokehFarFillPass.render(t,r,this.renderTargetFar),this.bokehNearBasePass.render(t,e,r),this.bokehNearFillPass.render(t,r,this.renderTargetNear)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e);let r=i.width,n=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(a=>a.setSize(t,e)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(a=>a.setSize(r,n)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(a=>a.fullscreenMaterial.setSize(r,n))}initialize(t,e,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(r=>r.initialize(t,e,i)),this.blurPass.initialize(t,e,ba),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,t.outputEncoding===fi&&(this.renderTarget.texture.encoding=fi,this.renderTargetNear.texture.encoding=fi,this.renderTargetFar.texture.encoding=fi,this.renderTargetMasked.texture.encoding=fi))}};new N;new st;var K9e="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",Q9e=class extends Qh{constructor({blendFunction:t=Li.NORMAL,hue:e=0,saturation:i=0}={}){super("HueSaturationEffect",K9e,{blendFunction:t,uniforms:new Map([["hue",new et(new N)],["saturation",new et(i)]])}),this.hue=e}get saturation(){return this.uniforms.get("saturation").value}set saturation(t){this.uniforms.get("saturation").value=t}getSaturation(){return this.saturation}setSaturation(t){this.saturation=t}get hue(){let t=this.uniforms.get("hue").value;return Math.acos((t.x*3-1)/2)}set hue(t){let e=Math.sin(t),i=Math.cos(t);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3)}getHue(){return this.hue}setHue(t){this.hue=t}};new Xt;var $9e=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,J9e=class extends Qh{constructor({blendFunction:t=Li.SCREEN,premultiply:e=!1}={}){super("NoiseEffect",$9e,{blendFunction:t}),this.premultiply=e}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(t){this.premultiply!==t&&(t?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(t){this.premultiply=t}},Z9e="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",e7e=class extends Qh{constructor(t=30){super("PixelationEffect",Z9e,{uniforms:new Map([["active",new et(!1)],["d",new et(new ye)]])}),this.resolution=new ye,this.d=0,this.granularity=t}get granularity(){return this.d}set granularity(t){let e=Math.floor(t);e%2>0&&(e+=1),this.d=e,this.uniforms.get("active").value=e>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(t){this.granularity=t}setSize(t,e){this.resolution.set(t,e),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new N;new N;var kK="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",NK="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",t7e="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",i7e="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",Bm={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},Wle=class extends Qh{constructor({preset:t=Bm.MEDIUM,edgeDetectionMode:e=XD.COLOR,predicationMode:i=$We.DISABLED}={}){super("SMAAEffect",t7e,{vertexShader:i7e,blendFunction:Li.NORMAL,attributes:Bh.CONVOLUTION|Bh.DEPTH,uniforms:new Map([["weightMap",new et(null)]])});let r,n;arguments.length>1&&(r=arguments[0],n=arguments[1],arguments.length>2&&(t=arguments[2]),arguments.length>3&&(e=arguments[3])),this.renderTargetEdges=new Di(1,1,{minFilter:mi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new BG(!0,!1,!1),this.clearPass.overrideClearColor=new Xt(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new Rl(new JWe),this.edgeDetectionMaterial.edgeDetectionMode=e,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new Rl(new o9e);let s=new qse;s.onLoad=()=>{let a=new Kr(r);a.name="SMAA.Search",a.magFilter=bi,a.minFilter=bi,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;let o=new Kr(n);o.name="SMAA.Area",o.magFilter=mi,o.minFilter=mi,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!1,this.weightsMaterial.areaTexture=o,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),r!==void 0&&n!==void 0?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(r=new Image,n=new Image,r.addEventListener("load",()=>s.itemEnd("search")),n.addEventListener("load",()=>s.itemEnd("area")),r.src=kK,n.src=NK),this.applyPreset(t)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(t){this.edgeDetectionMaterial.edgeDetectionThreshold=t}setOrthogonalSearchSteps(t){this.weightsMaterial.orthogonalSearchSteps=t}applyPreset(t){let e=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(t){case Bm.LOW:e.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Bm.MEDIUM:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Bm.HIGH:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case Bm.ULTRA:e.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(t,e=Cd){this.edgeDetectionMaterial.depthBuffer=t,this.edgeDetectionMaterial.depthPacking=e}update(t,e,i){this.clearPass.render(t,this.renderTargetEdges),this.edgeDetectionPass.render(t,e,this.renderTargetEdges),this.weightsPass.render(t,this.renderTargetEdges,this.renderTargetWeights)}setSize(t,e){this.edgeDetectionMaterial.setSize(t,e),this.weightsMaterial.setSize(t,e),this.renderTargetEdges.setSize(t,e),this.renderTargetWeights.setSize(t,e)}dispose(){let{searchTexture:t,areaTexture:e}=this.weightsMaterial;t!==null&&e!==null&&(t.dispose(),e.dispose()),super.dispose()}static get searchImageDataURL(){return kK}static get areaImageDataURL(){return NK}},r7e=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,mT={DEFAULT:0,ESKIL:1},n7e=class extends Qh{constructor({blendFunction:t=Li.NORMAL,technique:e=mT.DEFAULT,eskil:i=!1,offset:r=.5,darkness:n=.5}={}){super("VignetteEffect",r7e,{blendFunction:t,defines:new Map([["VIGNETTE_TECHNIQUE",e.toFixed(0)]]),uniforms:new Map([["offset",new et(r)],["darkness",new et(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(t){this.technique!==t&&(this.defines.set("VIGNETTE_TECHNIQUE",t.toFixed(0)),this.setChanged())}get eskil(){return this.technique===mT.ESKIL}set eskil(t){this.technique=t?mT.ESKIL:mT.DEFAULT}getTechnique(){return this.technique}setTechnique(t){this.technique=t}get offset(){return this.uniforms.get("offset").value}set offset(t){this.uniforms.get("offset").value=t}getOffset(){return this.offset}setOffset(t){this.offset=t}get darkness(){return this.uniforms.get("darkness").value}set darkness(t){this.uniforms.get("darkness").value=t}getDarkness(){return this.darkness}setDarkness(t){this.darkness=t}},Pd=class{constructor(t,e){this.enabled=!1,this.effect=new t(e),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=Li.NORMAL}},s7e=class extends Pd{constructor(){super(U9e),this.blendFunction=Li.SCREEN}set intensity(t){this.effect.intensity=t}get intensity(){return this.effect.intensity}set luminanceThreshold(t){this.effect.luminanceMaterial.threshold=t}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(t){this.effect.luminanceMaterial.smoothing=t}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(t){this.effect.blurPass.scale=t}get blurScale(){return this.effect.blurPass.scale}set kernelSize(t){this.effect.blurPass.kernelSize=t}get kernelSize(){return this.effect.blurPass.kernelSize}},a7e=class extends Pd{constructor(){super(G9e)}set contrast(t){this.effect.uniforms.get("contrast").value=t}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(t){this.effect.uniforms.get("brightness").value=t}get brightness(){return this.effect.uniforms.get("brightness").value}},o7e=class extends Pd{constructor(){super(X9e),this.effect.offset=new ye(.01,.01)}set offset(t){this.effect.offset.set(t[0]/1e3,t[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},l7e=class extends Pd{constructor(){super(H9e)}},c7e=class extends Pd{constructor(){super(Q9e),this._hue=0}set hue(t){this._hue=t,this.effect.setHue(t)}get hue(){return this._hue}set saturation(t){this.effect.uniforms.get("saturation").value=t}get saturation(){return this.effect.uniforms.get("saturation").value}},h7e=class extends Pd{constructor(){super(J9e),this.blendFunction=Li.OVERLAY}},u7e=class extends Pd{constructor(){super(n7e)}get eskil(){return this.effect.eskil}set eskil(t){this.effect.eskil=t}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(t){this.effect.uniforms.get("darkness").value=t}get offset(){return this.effect.uniforms.get("offset").value}set offset(t){this.effect.uniforms.get("offset").value=t}},d7e=class extends Pd{constructor(t){super(q9e)}set focalLength(t){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=t/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(t){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?t/2e3:(t+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(t){this.effect.bokehScale=t}setCamera(t){let e=!1;(t.isPerspectiveCamera&&this.isPerspectiveCamera===!1||!t.isPerspectiveCamera&&this.isPerspectiveCamera===!0)&&(e=!0),t.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(t.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(t),this.isPerspectiveCamera=!1),e&&this.effect.setChanged()}},f7e=class extends Pd{constructor(){super(e7e)}get granularity(){return this.effect.getGranularity()}set granularity(t){this.effect.setGranularity(t)}},p7e=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,m7e=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,g7e=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,v7e=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,hU=class extends Ri{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new et(null)},blending:Nn,depthWrite:!1,depthTest:!1,vertexShader:g7e,fragmentShader:v7e})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}},y7e=class extends qa{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new hU,this.resolutionVector=new ye,this.resolveMaterial=new Ri({name:"TAAResolveMaterial",uniforms:{inputBuffer:new et(null),historyBuffer:new et(null),velocityBuffer:new et(null),depthBuffer:new et(null),resolution:new et(new ye)},blending:Nn,depthWrite:!1,depthTest:!1,vertexShader:p7e,fragmentShader:m7e}),this.historyRenderTarget=new Di(1024,1024,{minFilter:mi,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Di(1024,1024,{minFilter:mi,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(t,e){this.historyRenderTarget.setSize(t,e),this.resultRenderTarget.setSize(t,e)}render(t,e){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=e.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=e.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=e.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(e.width,e.height),t.setRenderTarget(this.resultRenderTarget),t.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,t.setRenderTarget(this.historyRenderTarget),t.render(this.scene,this.camera);let i=this.renderToScreen?null:e;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,t.setRenderTarget(i),t.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},x7e=class extends qa{constructor(t,e,i){super("TransmissionPass",void 0,e),this.MRTCompatible=!0,this.depthPass=new BK(t,e,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new hU,this.splineScene=t,this.needsSwap=!1}updatePasses(t){this.passThroughMaterial=new hU,this.depthPass=new BK(this.splineScene,this.camera,{renderTarget:t.transmissionDepthTarget})}setCamera(t){this.camera=t}setScene(t){this.splineScene=t}render(t,e,i){let r=this.camera.layers.mask,n=t;n.setRenderTarget(n.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=e.texture[0],n.clear(),n.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(t,e,i),n.shadowMap.needsUpdate=!1,n.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:e;this.camera.layers.set(3),t.setRenderTarget(s),t.render(this.splineScene,this.camera),this.camera.layers.mask=r}},UK=new go,b7e=new Ri({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),uU=class extends qa{constructor(t,e,i){super("OpaquePass",e??UK,i),this.MRTCompatible=!0,this.originalMaterials=[],this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.MRTCompatible=t}setCamera(t){this.camera=t}setScene(t){this.scene=t??UK}getScene(){return this.scene}render(t,e){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.length=0,this.scene.traverse(r=>{r.layers.isEnabled(3)&&r instanceof ja&&(this.originalMaterials.push([r,r.material]),r.material=b7e)}),t.shadowMap.needsUpdate=!0,t.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:e;t.setRenderTarget(i),this.clearColorOnly&&t.clear(!0,!1,!0),this.clear&&t.clear(),t.render(this.scene,this.camera),this.clearDepth&&t.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach(r=>{r[0].material=r[1]})}},w7e=class{constructor(t,{depthBuffer:e=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:n=0}={}){this.renderer=t,this.helperStartIndex=0,this.copyPass=new cU,this.depthTexture=null,this.timer=new k9e,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(e,i,n,r,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(e,i,n,r,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(e,i,n,r,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(t)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(t){let e=this.inputBuffer,i=this.multisampling;i>0&&t>0?(this.inputBuffer.samples=t,this.outputBuffer.samples=t,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==t&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,t,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(t){var e;if(this.renderer=t,t!==null){let i=t.getSize(new ye),r=((e=t.getContext().getContextAttributes())==null?void 0:e.alpha)??!1,n=this.inputBuffer.texture[0].type;n===ba&&t.outputEncoding===fi&&(this.inputBuffer.texture[0].encoding=fi,this.outputBuffer.texture[0].encoding=fi,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),t.autoClear=!1,this.setSize(i.width,i.height,!1);for(let s of this.passes)s.initialize(t,r,n)}}replaceRenderer(t,e=!0){let i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(t),e&&r!==null&&(r.removeChild(i.domElement),r.appendChild(t.domElement)),i}createDepthTexture(){let t=this.depthTexture=new o1(this._width,this._height);return this.inputBuffer.depthTexture=t,this.inputBuffer.stencilBuffer?(t.format=Vg,t.type=gg):t.type=Ku,t}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let t of this.passes)t.setDepthTexture(null)}}createBuffer(t,e,i,r,n,s){let a=this.renderer,o=a===null?new ye:a.getDrawingBufferSize(new ye),l={minFilter:mi,magFilter:mi,wrapS:Cr,wrapT:Cr,stencilBuffer:e,depthBuffer:t},c;return r>0?(c=new Di(o.width,o.height,l),c.samples=r):(n?(c=new wse(o.width,o.height,2,l),c.texture[1].type=fd):c=new Di(o.width,o.height,l),c.depthTexture=new o1(2048,2048),c.depthTexture.type=tr),i===ba&&a!==null&&a.outputEncoding===fi&&(Array.isArray(c.texture)?c.texture.forEach(h=>h.encoding=fi):c.texture.encoding=fi),Array.isArray(c.texture)?c.texture.forEach((h,u)=>{h.name=`EffectComposer.Buffer ${n} ${u}`,h.generateMipmaps=!1}):(c.texture.name=`EffectComposer.Buffer ${n}`,c.texture.generateMipmaps=!1),c.name=s,c}addPass(t,e){var o;let i=this.passes,r=this.renderer,n=r.getDrawingBufferSize(new ye),s=((o=r.getContext().getContextAttributes())==null?void 0:o.alpha)??!1,a;if(t.MRTCompatible&&(a=this.inputBuffer.texture[0].type),t.MRTCompatible||(a=this.inputBuffer.texture.type),t.setRenderer(r),t.setSize(n.width,n.height),t.initialize(r,s,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),t.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?i.splice(e,0,t):i.push(t),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),t.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let l=this.createDepthTexture();for(t of i)t.setDepthTexture(l)}else t.setDepthTexture(this.depthTexture)}setHelperStartIndex(t){this.helperStartIndex=t}removePass(t){let e=this.passes,i=e.indexOf(t);if(i!==-1&&e.splice(i,1).length>0){if(this.depthTexture!==null){let r=(n,s)=>n||s.needsDepthTexture;e.reduce(r,!1)||t.getDepthTexture()===this.depthTexture&&t.setDepthTexture(null)}this.autoRenderToScreen&&i===e.length&&(t.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){let t=this.passes;t.length>0&&(this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!1),this.passes=[])}render(t){let e=this.renderer,i=this.copyPass,r=this.inputBuffer,n=this.outputBuffer,s=this.inputBufferSingle,a=this.outputBufferSingle,o=!1,l,c,h,u;t===void 0&&(t=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(e,r,n,t,o):d.render(e,s,a,t,o),d.needsSwap&&(o&&(i.renderToScreen=d.renderToScreen,l=e.getContext(),c=e.state.buffers.stencil,c.setFunc(l.NOTEQUAL,1,4294967295),i.render(e,r,n,t,o),c.setFunc(l.EQUAL,1,4294967295)),h=r,u=s,r=n,s=a,n=h,a=u),d instanceof B9e?o=!0:d instanceof h9e&&(o=!1))}setSize(t,e,i){let r=this.renderer;if(this._width=t,this._height=e,t===void 0||e===void 0){let s=r.getSize(new ye);t=s.width,e=s.height}r.setSize(t,e,i);let n=r.getDrawingBufferSize(new ye);this.inputBuffer.setSize(n.width,n.height),this.outputBuffer.setSize(n.width,n.height),this.inputBufferSingle.setSize(n.width,n.height),this.outputBufferSingle.setSize(n.width,n.height);for(let s of this.passes)s.setSize(n.width,n.height)}reset(){let t=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(t)}dispose(){for(let t of this.passes)t.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},S7e=new Ri({name:"CombineMaterial",uniforms:{inputBufferA:new et(null),inputBufferB:new et(null)},blending:Nn,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),_7e=class extends qa{constructor(t){super("HelperPass",void 0,t),this.MRTCompatible=!1,this.fullscreenMaterial=S7e,this.helperPass=new uU(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new uU(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let e=new Wle({preset:Bm.LOW,edgeDetectionMode:XD.COLOR});this.effectPass=new gP(this.camera,e),this.rt=new Di(10,10,{minFilter:mi,magFilter:mi,wrapS:Cr,wrapT:Cr,depthBuffer:!0})}setSize(t,e){this.rt.setSize(t,e),this.effectPass.setSize(t,e)}set sceneHelpers(t){this.helperPass.setScene(t)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(t){this.helperPassOnTop.setScene(t)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(t){this.helperPass.setCamera(t),this.helperPassOnTop.setCamera(t)}initialize(t,e,i){super.initialize(t,e,i),this.effectPass.initialize(t,e,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(t,e,i){this.rt.depthTexture=e.depthTexture;let r=t.getClearAlpha();t.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(t,this.rt),this.helperPassOnTop.render(t,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(t,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=e.texture,t.setClearAlpha(r),t.setRenderTarget(null),t.clear(),t.render(this.scene,this.camera)}},A7e=`#define GLSLIFY 1
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,E7e=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,M7e=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,T7e=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,C7e=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,P7e=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,vb=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],D7e=new Ri({vertexShader:A7e,fragmentShader:E7e}),wv=new Ri({vertexShader:C7e,fragmentShader:P7e,uniforms:{texture_ao_lrez:new et(null),texture_depth_lrez:new et(null),texture_depth_hrez:new et(null),near:new et(null),far:new et(null)}}),R7e=class extends qa{constructor(t,e){super("AmbientOcclusionPass",void 0,e),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,r=1024;this.gBuffer=new Di(i,r,{type:R_?fd:tr,depthTexture:new o1(i,r),minFilter:mi,magFilter:mi}),this.depthBufferHighRes=new Di(i,r,{depthTexture:new o1(i,r)}),this.aoBuffer=new Di(i,r,{minFilter:mi,magFilter:mi}),this.splineScene=t,this.splineCamera=e;let n=new Float32Array(vb.length*2);for(let a=0;a<vb.length;a++){let o=a*2;n[o+0]=vb[a][0],n[o+1]=vb[a][1]}this.blueNoiseInDiskTexture=new Ua(n,vb.length,1,b2,tr),this.blueNoiseInDiskTexture.wrapS=qu,this.blueNoiseInDiskTexture.wrapT=qu,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new Ri({vertexShader:M7e,fragmentShader:T7e,uniforms:{near:new et(null),far:new et(null),fov:new et(null),proj_info:new et(new si),is_ortho:new et(!1),resolution:new et(new ye),radius_of_influence:new et(8),radius_in_screen_space:new et(1),exponent:new et(1),ao_color:new et(new N),bias:new et(.5),texture_depth:new et(null),texture_normals:new et(null),texture_blue_noise:new et(null),texture_blue_noise_in_disk:new et(this.blueNoiseInDiskTexture),frame_index:new et(0),fog_enabled:new et(!1),fog_near:new et(1),fog_far:new et(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Di(i,r,{minFilter:mi,magFilter:mi,wrapS:Cr,wrapT:Cr,depthBuffer:!1,type:tr});let s=new Wle({preset:Bm.ULTRA,edgeDetectionMode:XD.COLOR});this.effectPass=new gP(this.camera,s)}initialize(t,e,i){super.initialize(t,e,i),this.effectPass.initialize(t,e,i)}setBlueNoiseTexture(t){this.hbaoMaterial.uniforms.texture_blue_noise.value=t}setSize(t,e){this._width=t,this._height=e,this.depthBufferHighRes.setSize(t,e);let i=this._runHalfRes?.5:1,r=t*i,n=e*i;this.gBuffer.setSize(r,n),this.aoBuffer.setSize(r,n),this.hbaoMaterial.uniforms.resolution.value.set(r,n),this.aaBuffer.setSize(r,n),this.effectPass.setSize(r,n)}get runHalfRes(){return this._runHalfRes}set runHalfRes(t){this._runHalfRes=t,this.setSize(this._width,this._height)}setCamera(t){this.splineCamera=t}setScene(t){this.splineScene=t}setDepthTexture(t){this.depthBufferHighRes.depthTexture=t,wv.uniforms.texture_depth_hrez.value=t,wv.needsUpdate=!0}render(t,e,i){this.splineScene.overrideMaterial=D7e;let r=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),t.setRenderTarget(this.gBuffer),t.clear(),t.render(this.splineScene,this.splineCamera),t.setRenderTarget(this.depthBufferHighRes),t.clear(),t.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=r,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let n=this.splineCamera.perspCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1-n[8])/n[0],l=-(1+n[9])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=this.splineCamera.perspCamera.fov*(Math.PI/180),h=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(c*.5)*2),u=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*h;this.hbaoMaterial.uniforms.radius_in_screen_space.value=u,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let n=this.splineCamera.orthoCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1+n[12])/n[0],l=-(1-n[13])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=.5*(this.hbaoMaterial.uniforms.resolution.value.y/a),h=this.hbaoMaterial.uniforms.radius_of_influence.value*c;this.hbaoMaterial.uniforms.radius_in_screen_space.value=h,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,t.setRenderTarget(this.aoBuffer),t.clear(),t.render(this.scene,this.camera),this.fullscreenMaterial=wv,wv.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,wv.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,wv.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,t.setRenderTarget(t.aoRenderTarget),t.clear(),t.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,t.setRenderTarget(this.aaBuffer),t.clear(),t.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(t,this.aaBuffer,t.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},I7e=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,L7e=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,O7e=class extends Rl{constructor(){super(new Ri({vertexShader:I7e,fragmentShader:L7e,uniforms:{tInput:new et(null),tMap:new et(null),uResolution:new et(new ye),uSize:new et(new ye),uCoords:new et(new ye),uScale:new et(1),uSceneColor:new et(new Xt(16711680)),uDPR:new et(1),uCurrent:new et(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(t){this.uniforms.tMap.value=t}},B7e=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,F7e=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,k7e=[],N7e=class extends Rl{constructor(){super(new Ri({vertexShader:B7e,fragmentShader:F7e,uniforms:{toScene:new et(null),fromScene:new et(null),uResolution:new et(new ye),uDPR:new et(1),mixRatio:new et(0),threshold:new et(.1),useTexture:new et(0),tMixTexture:{value:k7e[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(t){this.uniforms.fromScene.value=t}},U7e=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,z7e=`
uniform sampler2D inputBuffer;
uniform sampler2D blurredInputBuffer;
uniform sampler2D overlay;
uniform float blurIntensity;

uniform vec2 uResolution;
uniform float uDPR;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( overlay, screenUv );
	vec4 texel2 = texture2D( inputBuffer, screenUv );
	vec4 texel3 = texture2D( blurredInputBuffer, screenUv );

	float blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;
    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );
}
`,G7e=class extends Rl{constructor(){super(new Ri({vertexShader:U7e,fragmentShader:z7e,uniforms:{inputBuffer:new et(null),blurredInputBuffer:new et(null),overlay:new et(null),uResolution:new et(new ye),uDPR:new et(1),blurIntensity:new et(0)}})),this._blurEnabled=!1,this.blurTarget=new Di(1,1,{minFilter:mi,magFilter:mi,wrapS:Cr,wrapT:Cr}),this.blurPass=new FG({width:window.innerWidth,height:window.innerHeight,kernelSize:YD.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(t){this.uniforms.overlay.value=t}setResolution(t,e,i=1){this.uniforms.uResolution.value.set(t,e),this.uniforms.uDPR.value=i,this.blurPass.setSize(t,e),this.blurTarget.setSize(t,e),this.blurPass.setSize(t,e)}get uiCanvas(){return this._uiCanvas}set uiCanvas(t){this._uiCanvas=t,t.texture&&(this.uniforms.overlay.value=t.texture);let e=t.frame;if(e){let i=e.data.backgroundBlur,r=i.radius;this._blurEnabled=i.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=r/3}}render(t,e,i,r,n){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(t,e,this.blurTarget,r,n)),super.render(t,e,i,r,n)}},V7e=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,H7e=`
uniform sampler2D tInput;
uniform sampler2D tOverlayImage;
varying vec2 vUv;
uniform vec2 uResolution;
uniform vec2 uRightBottom;
uniform vec2 uImageSize;
uniform float uScale;
uniform float uDPR;

vec3 blendNormal(vec3 base, vec3 blend) {
	return blend;
}

vec3 blendNormal(vec3 base, vec3 blend, float opacity) {
	return (blendNormal(base, blend) * opacity + base * (1.0 - opacity));
}

vec4 drawFixedSizeImage(sampler2D image, vec2 screenUV, vec2 imageSize, vec2 imageCoords, vec2 screenSize, float dpr) {
	vec2 uv = (screenUV * screenSize * dpr - imageCoords) / (imageSize * dpr);
	if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
		return vec4(0.0);
	}
	return texture2D(image, uv);
}

void main() {
    vec2 screenUV = gl_FragCoord.xy / (uResolution.xy * uDPR);
	vec2 imageCoords = vec2(uResolution.x * uDPR - uImageSize.x * uScale * uDPR - uRightBottom.x * uDPR, uRightBottom.y * uDPR);
    vec4 background = texture2D(tInput, screenUV);
    vec4 image = drawFixedSizeImage(tOverlayImage, screenUV, uImageSize * uScale, imageCoords, uResolution, uDPR);
    gl_FragColor = vec4(blendNormal(background.rgb, image.rgb, image.a), max(background.a, image.a));
}
`,j7e=class extends Rl{constructor(){super(new Ri({vertexShader:V7e,fragmentShader:H7e,uniforms:{tInput:new et(null),tOverlayImage:new et(null),uResolution:new et(new ye),uImageSize:new et(new ye),uRightBottom:new et(new ye(20,20)),uScale:new et(.25),uDPR:new et(1)}}),"tInput")}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tOverlayImage.value}set texture(t){this.uniforms.tOverlayImage.value=t,this.uniforms.uImageSize.value.set(t.image.width,t.image.height)}};function zK(t,e){return e&&e.enabled&&t.push(e.effect),t}var W7e=t=>Object.values(Li).includes(t)?t:Li.NORMAL,X7e=class extends Js{constructor(t,e){super(),this._needsDOFResize=e,this.postprocessingState=Z2.defaultData,this._scene=new go,this._camera=new ga,this.effects=new Map,this.blueNoiseTexture=new Ua,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new hOe,this.renderer=t,this.debug=!1,this.effects.set("bloom",new s7e),this.effects.set("chromaticAberration",new o7e),this.effects.set("vignette",new u7e),this.effects.set("noise",new h7e),this.effects.set("colorAverage",new l7e),this.effects.set("hueSaturation",new c7e),this.effects.set("brightnessContrast",new a7e),this.effects.set("depthOfField",new d7e),this.effects.set("pixelation",new f7e),this.effectComposer=new w7e(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new uU(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new x7e(this.scene,this.camera,this.renderer),this.aoPass=new R7e(this.scene,this.camera),this.taaPass=new y7e,this.taaPass.renderToScreen=!1,this.helperPass=new _7e(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new O7e,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new G7e,this.uiOverlayPass.enabled=!1,this.logoOverlayPass=new j7e,this.logoOverlayPass.enabled=!1,this.sceneTransitionPass=new N7e,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(t){t!==void 0?(this.stylesOverlayPass.texture=t,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(t){this.helperPass.sceneHelpers=t}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(t){this.helperPass.sceneHelpersOnTop=t}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(t){this._scene=t,this.opaquePass.setScene(t),this.transmissionPass.setScene(t),this.aoPass.setScene(t)}get camera(){return this._camera}set camera(t){let e=this._camera!==t;this._camera=t,this.opaquePass.setCamera(t),this.transmissionPass.setCamera(t),e&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(t),this.helperPass.setCamera(t),this.effects.get("depthOfField").setCamera(t)}updateRenderToScreen(){let t=!1;for(let e=this.effectComposer.passes.length-1;e>=0;e--){let i=this.effectComposer.passes[e];if(i.enabled===!0&&!t&&this._renderToScreen){i.renderToScreen=!0,t=!0;continue}i.renderToScreen=!1}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(t){this.blueNoiseTexture=new Ua(t,128,128),this.blueNoiseTexture.wrapS=qu,this.blueNoiseTexture.wrapT=qu,this.blueNoiseTexture.minFilter=bi,this.blueNoiseTexture.magFilter=bi,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(t,e,i,r,n,s,a,o){this.aoPass.enabled=t,this.aoPass.radius=e,this.aoPass.bias=i,this.aoPass.aoColor=r,this.aoPass.fogEnabled=n,this.aoPass.fogNear=s,this.aoPass.fogFar=a,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(t){this.transmissionPass.enabled=t,this.opaquePass.hasTransmissionPass=t}_initPasses(){var t,e,i;if((t=this.uvEffectPass)==null||t.dispose(),(e=this.effectPass)==null||e.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let r=[this.effects.get("pixelation")].reduce(zK,[]);r.length>0&&(this.uvEffectPass=new gP(this.camera,...r),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let n=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(zK,[]);if(n.length>0&&(this.effectPass=new gP(this.camera,...n),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&((i=this.effects.get("depthOfField"))==null?void 0:i.enabled)&&window!==void 0)){let s=this.renderer.viewportWidth,a=this.renderer.viewportHeight;this.renderer.setSize(s-1,a-1),this.renderer.setSize(s,a)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.logoOverlayPass)}_initCopyPass(){if(this._savePass)return;let t=new ye;this.renderer.getDrawingBufferSize(t),this._rt=new Di(t.x,t.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:qu,wrapT:qu}),this._rt.samples=0,this._savePass=new cU(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(t){this._rt=t,this._savePass=new cU(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(t){if(this._renderToScreen===t)return;let e=this.effectComposer;!e||(t===!0?e.removePass(this._savePass):e.addPass(this._savePass),this._renderToScreen=t,this.updateRenderToScreen())}set sceneTransitionFromTexture(t){t!==this.sceneTransitionPass.texture&&(t!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=t)}setWatermark(t){this.logoOverlayPass.enabled=t!==null,t&&(this.logoOverlayPass.texture=t)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(t){let{enabled:e,...i}=t,r=!1;e!==this.postprocessingState.enabled&&(r=!0);for(let n of Object.entries(i)){let s=n[1],a=this.effects.get(n[0]);if(a){a.enabled!==s.enabled&&(r=!0),a.enabled=s.enabled;for(let[o,l]of Object.entries(s))o==="blendFunction"?a.blendFunction=W7e(l):a[o]=l}}this.postprocessingState=t,r&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(t,e,i,r){t instanceof si?(this.effectComposer.inputBuffer.scissor.set(t.x,t.y,t.z,t.w),this.effectComposer.outputBuffer.scissor.set(t.x,t.y,t.z,t.w)):(this.effectComposer.inputBuffer.scissor.set(t,e,i,r),this.effectComposer.outputBuffer.scissor.set(t,e,i,r));let n=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(n),this.effectComposer.outputBuffer.scissor.multiplyScalar(n),this.renderer.setScissor(t,e,i,r)}setScissorTest(t){this.effectComposer.inputBuffer.scissorTest=t,this.effectComposer.outputBuffer.scissorTest=t,this.renderer.setScissorTest(t)}setViewport(t,e,i,r){t instanceof si?(this.effectComposer.inputBuffer.viewport.copy(t),this.effectComposer.outputBuffer.viewport.copy(t)):(this.effectComposer.inputBuffer.viewport.set(t,e,i,r),this.effectComposer.outputBuffer.viewport.set(t,e,i,r))}resize(t,e,i){if(this.effectComposer.setSize(t,e,i),this._rt){let r=this.renderer.getPixelRatio();this._rt.setSize(t*r,e*r)}}dispose(){var t,e;(t=this.uvEffectPass)==null||t.dispose(),(e=this.effectPass)==null||e.dispose(),this.effectComposer.dispose()}},Y7e=t=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${t};
const int gShadowSamples = ${t};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,q7e=pi.lights_fragment_begin,K7e=pi.shadowmask_pars_fragment,GK=null,Q7e=t=>{switch(t){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},$7e=(t="medium")=>{if(GK===t)return!1;GK=t;let e=Q7e(t);pi.shadowmap_pars_fragment=Y7e(e);let i=q7e.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),pi.lights_fragment_begin=i;let r=K7e.slice();return r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),pi.shadowmask_pars_fragment=r,!0},J7e=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
	
void main()
{
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
vec3 transformed = vec3(position);
#include <morphtarget_vertex>
#include <skinning_vertex>

vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
}
`,Z7e=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,RO=new Ri({vertexShader:J7e,fragmentShader:Z7e,uniforms:{depthContrast:{value:1}}}),VK=new Kr,HK=new ye,eXe=class extends Dse{constructor(t){super(t),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new ye,this.dummyCamera=new ga,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(n=!0,s=!0,a=!0)=>{let o=this.getContext(),l=0;n&&(l|=o.COLOR_BUFFER_BIT),s&&(l|=o.DEPTH_BUFFER_BIT),a&&(l|=o.STENCIL_BUFFER_BIT),o.clear(l),o.clearBufferfv(o.COLOR,1,[0,0,0,1])},this.pipeline=new X7e(this,(t==null?void 0:t.needsDOFResize)??!1),this.autoClear=!1;let e=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=S5,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(n){console.warn(n)}this.setPixelRatio=n=>{this._pixelRatio!==n&&(this._pixelRatio=n,e(n))},this.setSize=(n,s,a=!0)=>{var o,l;(this.viewportWidth!==n||this.viewportHeight!==s)&&(this.viewportWidth=n,this.viewportHeight=s,i(n,s,a),(o=this.normalRenderTarget)==null||o.setSize(n*this._pixelRatio,s*this._pixelRatio),this._resizeTransmission(n,s),(l=this.transmissionDepthTarget)==null||l.setSize(n*this._pixelRatio/2,s*this._pixelRatio/2),this.pipeline.resize(n,s,a))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new Di(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:mi,magFilter:mi,wrapS:Cr,wrapT:Cr,depthBuffer:!1}))}_resizeTransmission(t,e){var i,r;(i=this.transmissionRenderTarget)==null||i.setSize(t*this._pixelRatio/(this.hdTransmission?1:2),e*this._pixelRatio/(this.hdTransmission?1:2)),(r=this.aoRenderTarget)==null||r.setSize(t*this._pixelRatio/1,e*this._pixelRatio/1)}get hdTransmission(){return Kt.transmissionLod.value===1}set hdTransmission(t){Kt.transmissionLod.value=t===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new Di(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:s1,magFilter:mi,wrapS:Cr,wrapT:Cr,depthBuffer:!1}),this.transmissionDepthTarget=new Di(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:bi,magFilter:bi,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new Di(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:bi,magFilter:bi,type:tr,depthTexture:new o1(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(t,e,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),e.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),i instanceof ga?RO.uniforms.depthContrast.value=(i.far-i.near)/1e4:RO.uniforms.depthContrast.value=1,e.overrideMaterial=RO,this.render(e,i),this.setClearColor(e.bgColor,e.bgColor.a),this.setRenderTarget(null),e.overrideMaterial=t.wireframeState?yU:null,i.layers.enable(0),i.layers.enable(3),e.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(t,e,i=1){this.dummyCamera.updateCameraState(e.dataPatched),this.dummyCamera.matrix.copy(e.matrixWorld);let r=e.height,n=e.width,s=this.viewportWidth/this.viewportHeight;n<r?n=r*s:r=n/s,this.dummyCamera.setViewplaneSize(n,r);for(let a=0;a<i;a++)this.renderSplineScene(t,this.dummyCamera)}renderSplineScene(t,e,{sceneHelpers:i=this.sceneHelpers,sceneHelpersOnTop:r=this.sceneHelpersOnTop,overrideTransmission:n=void 0,overrideNormal:s=void 0}={}){var d;let a=t instanceof jG?t.activePage:t,o=a.visible;a.visible=!0;let l=a.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(e)),this.setClearColor(a.bgColor,a.bgColor.a),a.penumbraSizeArray.forEach((f,p)=>{Kt.penumbraSize.value[p]=f}),Kt.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?Kt.resolution.value.set(this.resolution.x,this.resolution.y):Kt.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),s!==void 0?(Kt.normalRenderTarget.value=s,Kt.normalRenderTargetDepth.value=VK):l.needsNormal()&&(this.createNormalRenderTarget(),Kt.normalRenderTarget.value=this.normalRenderTarget.texture,Kt.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,a,e));let c=a.data.ao,h=c.occlusion;if(h&&(this.createAORenderTarget(),Kt.aoRenderTarget.value=this.aoRenderTarget.texture),Kt.aoEnabled.value=h,this.pipeline.setAmbientOcclusionParams(c.occlusion,c.radius,c.bias,a.aoColor,a.fog!==null,a.backupFog.near,a.backupFog.far,c.aoFullRes&&!R_),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&((d=a.uiCanvas)==null?void 0:d.enabled)&&a.uiCanvas.texture&&a.uiCanvas.texture.image.width>0){let f=this.getSize(HK),p=this.getPixelRatio();(a.uiCanvas.width!==this.viewportWidth||a.uiCanvas.height!==this.viewportHeight||a.uiCanvas.dpr!==p)&&a.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},p),a.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=a.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(f.x,f.y,p),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();if(this.pipeline.logoOverlayPass.enabled){let f=this.getSize(HK),p=this.getPixelRatio();this.pipeline.logoOverlayPass.uniforms.uResolution.value.set(f.x,f.y),this.pipeline.logoOverlayPass.uniforms.uDPR.value=p}let u=!1;if(n!==void 0)Kt.transmissionRenderTarget.value=n,Kt.transmissionRenderTargetDepth.value=VK,this.pipeline.setTransmissionPassEnabled(!1);else{let f=l.needsTransmission();f&&(this.transmissionRenderTarget===void 0&&(u=!0),this.createTransmissionRenderTarget(),Kt.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,Kt.aspectRatio.value=HHe(this.viewportWidth,this.viewportHeight),Kt.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(f)}e.layers.enable(3),e.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=r,this.pipeline.scene=a,this.pipeline.camera=e,u&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==a.postprocessing&&(this.pipeline.updatePostprocessing(a.postprocessing),!i&&!r&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),l.shapeBlendIntances.forEach(f=>{f.onBeforeShadowPass(this)}),a.overrideMaterial=l.wireframeState?yU:null,this.pipeline.render(),Kt.frameIndex.value=(Kt.frameIndex.value+1)%16,e instanceof ga&&e.copyHistory(),a.visible=o}renderFromSceneForSceneTransitionPass(t,e,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(t,e),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let r=this.pipeline.sceneTransitionPass.uniforms;r.uDPR.value=window.devicePixelRatio,r.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){var t,e,i,r,n,s;this._superDispose(),this.pipeline.dispose(),(t=this.aoRenderTarget)==null||t.dispose(),(e=this.transmissionRenderTarget)==null||e.dispose(),(i=this.transmissionDepthTarget)==null||i.dispose(),(r=this.normalRenderTarget)==null||r.dispose(),(s=(n=this.normalRenderTarget)==null?void 0:n.depthTexture)==null||s.dispose()}},Xle=class extends O_(MOe){constructor(t,e=15,i=10066329){super(t,e,i),this.object=t,this.added=!1,this.name=`DirectionalLightHelper: ${t.uuid}`}raycast(t,e){B_(this.object,Xle.geometryHelper,t,e)}},Yle=class extends O_(EOe){constructor(t,e=15,i=6710886){super(t,e,i),this.object=t,this.name=`PointLightHelper: ${t.uuid}`}raycast(t,e){B_(this.object,Yle.geometryHelper,t,e)}},dU=class extends O_(AOe){constructor(t,e=6710886){super(t,e),this.object=t,this.name=`SpotLightHelper: ${t.uuid}`}raycast(t,e){B_(this.object,dU.geometryHelper,t,e)}update(){if(this.object!==void 0){let t=dU._vector,e=this.object.distance?this.object.distance:1e3,i=e*Math.tan(this.object.angle);this.cone.scale.set(i,i,e),t.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(t);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let n=0,s=this.cone.material.length;n<s;n++)this.cone.material[n].color.set(r);else this.cone.material.color.set(r)}}},qle=dU;qle._vector=new N;var Kle=class extends $u{constructor(){super(),this.caretIndex=0,this._caretVisibleAlpha=1,this._selectionVisibleAlpha=.3,this.current={start:0,end:void 0},this.matrixAutoUpdate=!1,this.caretMesh=new vr(new Vh(1,1),new pd({transparent:!0,opacity:0,side:pa})),this.add(this.caretMesh),this.selectionMesh=new vr(new Vh(1,1),new pd({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:pa})),this.add(this.selectionMesh),this.hide()}get caretHeight(){var t;return((t=this.object)==null?void 0:t.AD)??0}show(t){this.visible=!0,this.object=t,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=-this.caretHeight*.5,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(this.object===void 0)return;this.updateHelperMatrix();let{depth:t}=this.object.geometry.userData.parameters;this.caretMesh.position.z=t,this.selectionMesh.position.z=t}updateHelperMatrix(){if(this.object===void 0)return;let t=this.object,e=t.parent;e!==null&&e.updateWorldMatrix(!0,!1),t.matrixAutoUpdate&&t.updateMatrix(),e!==null?(this.matrixWorld.multiplyMatrices(e.matrixWorld,t.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,t.matrix)):this.matrixWorld.multiplyMatrices(t.hiddenMatrix,t.matrix),this.matrix.copy(this.matrixWorld);for(let i of this.children)i.matrixWorld.copy(this.matrixWorld);t.updateWorldMatrix(!0,!0)}setCaretColor(t){let e=this.caretMesh.material;e.color.setRGB(t.r,t.g,t.b);let i=this._caretVisibleAlpha===e.opacity;this._caretVisibleAlpha=t.a,i&&(e.opacity=this._caretVisibleAlpha)}setSelectionColor(t){this.selectionMesh.material.color.setRGB(t.r,t.g,t.b)}setCaretPosition(t,e={}){if(this.object===void 0)return;this.caretIndex=t;let i=this.object.wrappedText,[r,n]=vP(i,t),[s,a]=t>0?vP(i,t-1):[null,null];(t>0&&i.length?i[s].charAt(a):null)===`
`&&(r++,n=0),this.current.start=t,this.current.end=void 0;let[o,l]=IO(this.object,r,n),{AD:c,descender:h}=this.object,u=h+c*.5,{width:d,height:f,depth:p}=this.object.geometry.userData.parameters,m=typeof d=="string"?0:d,g=typeof f=="string"?0:f;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(o-m*.5,l+u+g*.5,p),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(t,e){if(this.object===void 0)return;let i=this.object.wrappedText;this.current.start=t,this.current.end=e;let r=[],n=[],s=tXe(i,t,e),{lineHeight:a,AD:o,descender:l}=this.object,c=l+o*.5-a*.5;for(let[g,v,y]of s)if(v!==y){let[x,S]=IO(this.object,g,v),[A,_]=IO(this.object,g,y);S+=c,_+=c,_+=a;let M=r.length/3;r.push(x,S,0),r.push(A,S,0),r.push(A,_,0),r.push(x,_,0),n.push(M+0,M+1,M+2),n.push(M+2,M+3,M+0)}let h=new Nt;h.setIndex(n),h.setAttribute("position",new bt(r,3));let{width:u,height:d,depth:f}=this.object.geometry.userData.parameters,p=typeof u=="string"?0:u,m=typeof d=="string"?0:d;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=h,this.selectionMesh.position.x=-p*.5,this.selectionMesh.position.y=m*.5,this.selectionMesh.position.z=f,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(t,e,i="previous"){if(this.object===void 0||this.object.font===void 0)return;let r=this.object.wrappedText,n=r.length,s=this.object.lineHeight,a=n*s,{height:o,verticalAlign:l}=this.object.geometry.userData.parameters,c=typeof o=="string"?0:o,h=0;l===3?h=c-a:l===2&&(h=c*.5-a*.5);let u=Math.min(Math.floor(Math.max(Math.min(-e-h,a),0)/s),n-1),d=this.object.charCoords[u],f=this.object.charWidths[u],p=0,m=!1;if(i==="previous"){for(let g=0;g<d.length;g++)if(d[g][0]+f[g]*.5-t>0){p=g,m=!0;break}}else if(i==="closest"){let g=1/0;for(let v=0;v<d.length;v++){let y=d[v][0]+f[v]*.5,x=Math.abs(y-t);x<g&&(g=x,p=v,m=!0)}}else for(let g=0;g<d.length;g++){let v=d[g][0],y=d[g][0]+f[g];if(t>=v&&t<y){p=g,m=!0;break}}return m||(p=d.length),{index:this.getGlobalIndexFromLineAndCharIndexes(r,u,p),lineIndex:u,characterIndex:p}}getGlobalIndexFromLineAndCharIndexes(t,e,i){return t.slice(0,e).reduce((r,n)=>r+=n.length,0)+i}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function IO(t,e,i){let{charCoords:r,charWidths:n,initialOffsetY:s,lineHeight:a}=t;if(r[e]&&r[e].length===0||r.length===0){let h=0,{horizontalAlign:u}=t.data.geometry,d=t.wrappedText,{width:f}=t.geometry.userData.parameters;return d.length===1&&d[0].length===0&&(u===3?h=f*.5:u===2&&(h=f)),[h,s-a*e]}let o=r[e];if(o===void 0||o.length===0)return[0,0];let[l,c]=o[Math.min(i,o.length-1)];return i>=o.length&&(l+=n[e][i-1]),[l,c]}function vP(t,e){var r;let i=0;for(let n=0;n<t.length;n++){let s=t[n],a=e-i;if(a<=s.length)return[n,a];i+=s.length}return[Math.max(0,t.length-1),((r=t[t.length-1])==null?void 0:r.length)??0]}function tXe(t,e,i){let[r,n]=vP(t,e),[s,a]=vP(t,i),o=[];n>=t[r].length&&(r++,n=0);for(let l=r;l<=s;l++){let c=t[l],h=l===r?n:0,u=l===s?a:c.length;o.push([l,h,u])}return o}function iXe(t,e){let i=Hs.fromHex(3223857),r=.8;for(let n of t.layers){if(n.data.type==="light"||n.data.type==="displace"||n.data.type==="fresnel"||n.data.type==="matcap"||n.data.type==="texture"||n.data.type==="toon"||n.data.type==="outline"||n.data.type==="transmission"||n.data.type==="noise")continue;let s=typeof n.data.alpha=="string"?Number(e.getVariable(n.data.alpha)):n.data.alpha;if(n.data.type==="color"&&s>.3){i=rXe(n.data.color,e),r=s;break}else if((n.data.type==="depth"||n.data.type==="gradient")&&s>.3){let a=nXe(n.data);i={r:a[0],g:a[1],b:a[2]},r=typeof n.data.alpha=="string"?1:n.data.alpha;break}}return{...i,a:r}}function rXe(t,e){return typeof t=="string"?e.data.colors[t]:t}function nXe(t){return t.colors[0]}function sXe(t,e){t.shadow.camera.right=e/2,t.shadow.camera.left=-e/2,t.shadow.camera.top=e/2,t.shadow.camera.bottom=-e/2,t.shadow.needsUpdate=!0}var Qle=class extends OG(cOe,Xle){constructor(t,e,i){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let n=new I2(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n}update(){this.shadow.camera.updateProjectionMatrix();for(let t in this.gizmos){let e=this.gizmos[t];e instanceof I2&&e.update()}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e);let i=t.depth!==void 0&&t.depth!==this.shadow.camera.far||t.size!==void 0&&t.size/2!==this.shadow.camera.right;t.size!==void 0&&sXe(this,t.size),t.shadowRadius!==void 0&&(this.shadow.radius=t.shadowRadius),t.shadowResolution!==void 0&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),t.penumbraSize!==void 0&&e.scene.markPenumbraSizeDirty(),i&&this.update()}},jK=new N,WK=new N,XK=new ri,$le=class extends OG(sOe,qle){constructor(t,e,i){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=Et.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let n=new I2(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let t in this.gizmos){let e=this.gizmos[t];e instanceof I2&&e.update()}}updateMatrixWorld(t){super.updateMatrixWorld(t),WK.setFromMatrixPosition(this.matrixWorld),XK.setFromRotationMatrix(this.matrixWorld),jK.copy(this.up).applyQuaternion(XK).negate().multiplyScalar(this.distance),this.target.position.copy(WK).add(jK),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e),t.distance!==void 0&&(this.distance=t.distance),t.decay!==void 0&&(this.decay=t.decay),t.angle!==void 0&&(this.angle=t.angle),t.penumbra!==void 0&&(this.penumbra=t.penumbra),t.shadowRadius!==void 0&&(this.shadow.radius=t.shadowRadius),t.penumbraSize!==void 0&&e.scene.markPenumbraSizeDirty(),t.shadowResolution!==void 0&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function aXe(t){let e=(t[0][0]+t[1][1])/2,i=(t[0][0]-t[1][1])/2,r=(t[1][0]+t[0][1])/2,n=(t[1][0]-t[0][1])/2,s=Math.sqrt(e*e+n*n),a=Math.sqrt(i*i+r*r),o=s+a,l=s-a,c=Math.atan2(r,i),h=Math.atan2(n,e),u=(h-c)/2,d=(h+c)/2,f=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]],p=[[o,0],[0,l]],m=[[Math.cos(u),Math.sin(u)],[-Math.sin(u),Math.cos(u)]];return f[0][0]*=-1,f[0][1]*=-1,m[0][0]*=-1,m[1][0]*=-1,[f,p,m]}function yC(t,e){return[[t[0][0]*e[0][0]+t[0][1]*e[1][0],t[0][0]*e[0][1]+t[0][1]*e[1][1]],[t[1][0]*e[0][0]+t[1][1]*e[1][0],t[1][0]*e[0][1]+t[1][1]*e[1][1]]]}function YK(t){return[[t[0][0],t[1][0]],[t[0][1],t[1][1]]]}function oXe(t){let[e,i,r]=aXe(t),n=yC(e,YK(r)),s=yC(yC(r,i),YK(r)),a=Math.atan2(n[1][0],n[0][0]),o=[s[0][0],s[1][1]],l=[s[0][1]/s[1][1],s[1][0]/s[0][0]];return{rotation:a,scale:o,shear:l}}function lXe({rotation:t,scale:e,shear:i}){let r=Math.cos(t),n=Math.sin(t),s=[[r,-n],[n,r]],a=[[e[0],i[0]*e[1]],[i[1]*e[0],e[1]]],o=yC(s,a);return[o[0][0],o[1][0],o[0][1],o[1][1]]}var Ni;(t=>{function e(){return[1,0,0,0,1,0,0,0,1]}t.identity=e;function i(_,M=t.identity()){for(let E=0,T=_.length;E<T;E++)M[E]=_[E];return M}t.copy=i;function r(_,M,E,T,C,D){return t.setAbcdef(t.identity(),_,M,E,T,C,D)}t.create=r;function n(_,M,E,T,C,D,B){return _[0]=M,_[1]=T,_[2]=D,_[3]=E,_[4]=C,_[5]=B,_}t.setAbcdef=n;function s(_,M){let[E,T,C,D,B,O]=o(_),[L,H,q,W,I,z]=o(M),U=L*E+H*C,X=L*T+H*D,Q=q*E+W*C,re=q*T+W*D,ie=I*E+z*C+B,ce=I*T+z*D+O;return t.create(U,X,Q,re,ie,ce)}t.append=s;function a(_,M){let[E,T,C,D,B,O]=o(_),[L,H,q,W,I,z]=o(M),U=E,X=T,Q=C,re=D;(L!==1||H!==0||q!==0||W!==1)&&(U=E*L+T*q,X=E*H+T*W,Q=C*L+D*q,re=C*H+D*W);let ie=B*L+O*q+I,ce=B*H+O*W+z;return t.create(U,X,Q,re,ie,ce)}t.prepend=a;function o(_){return[_[0],_[3],_[1],_[4],_[2],_[5]]}t.getAbcdef=o;function l(_){let[M,E,T,C,D,B]=t.getAbcdef(_),O=M*C-E*T,L=C/O,H=-E/O,q=-T/O,W=M/O,I=(T*B-C*D)/O,z=-(M*B-E*D)/O;return t.create(L,H,q,W,I,z)}t.invert=l;function c([_,M],E){let[T,C,D,B,O,L]=t.getAbcdef(E);return[T*_+D*M+O,C*_+B*M+L]}t.apply=c;function h(_,M){let[E,T,C,D,B,O]=t.getAbcdef(M),L=1/(E*D+C*-T),[H,q]=_;return[D*L*H+-C*L*q+(O*C-B*D)*L,E*L*q+-T*L*H+(-O*E+B*T)*L]}t.applyInverse=h;function u(_,M,E=M){let[T,C,D,B,O,L]=t.getAbcdef(_);return t.setAbcdef(_,T*M,C*E,D*M,B*E,O*M,L*E),_}t.scale=u;function d(_,M){let E=Math.cos(M),T=Math.sin(M),[C,D,B,O,L,H]=t.getAbcdef(_);return t.setAbcdef(_,C*E-D*T,C*T+D*E,B*E-O*T,B*T+O*E,L*E-H*T,L*T+H*E),_}t.rotate=d;function f(_,M,E){let[T,C]=E,D=t.translate(_,-T,-C);return D=t.rotate(D,M),D=t.translate(D,T,C),D}t.rotateAround=f;function p(_,M,E){let[T,C,D,B,O,L]=t.getAbcdef(_);return t.setAbcdef(_,T,C,D,B,O+M,L+E),_}t.translate=p;function m(_,M,E){let[T,C,D,B]=t.getAbcdef(_);return t.setAbcdef(_,T,C,D,B,M,E),_}t.setTranslate=m;function g(_,M,E){let[T,C,D,B]=t.getAbcdef(_);return t.setAbcdef(_,T,C,D,B,M,E),_}t.setPosition=g;function v(_){let[M,E,T,C]=t.getAbcdef(_),D=Math.sqrt(M*M+E*E),B=Math.sqrt(T*T+C*C);return[D,B]}t.getScale=v;function y(_){let[,,,,M,E]=t.getAbcdef(_);return[M,E]}t.getPosition=y;function x(_,M){return t.decompose(_,M).rotation}t.getRotation=x;function S(_,M){let[E,T,C,D,B,O]=t.getAbcdef(_),{rotation:L,scale:H,shear:q}=oXe([[E,C],[T,D]]);return{position:[B+(M[0]*E+M[1]*C)-M[0],O+(M[0]*T+M[1]*D)-M[1]],scale:H,rotation:L,shear:q,pivot:M}}t.decompose=S;function A(_,M,E,T,C=[0,0]){let[D,B]=_,[O,L]=T,[H,q,W,I]=lXe({rotation:E,scale:M,shear:C}),z=D-(O*H+L*W)+O,U=B-(O*q+L*I)+L;return t.create(H,q,W,I,z,U)}t.compose=A})(Ni||(Ni={}));var cXe=Math.PI/180;function hXe(t,e,i,r,n,s){let a=t-i,o=e-r;return a*a/(n*n)+o*o/(s*s)<=1}function uXe(t){return t*cXe}var Rs=class{constructor(t,e,i){this.uuid=t,this.data=e,this.localMatrix=Ni.identity(),this.worldMatrix=Ni.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new fU,this._recursiveBBox=new fU,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=jD(),this.dpr=i.dpr??1,this.dataPatched=e}project(t,e){let i=this.worldMatrix;return e&&(i=Ni.append(e.worldMatrix,i)),Ni.applyInverse(t,i)}intersects(t,e,i,r=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([t,e],i),r)}intersectsInLocalSpace(t,e,i=!1){let{min:r,max:n}=i?this.recursiveBBox:this.singleBBox;return t>=r[0]&&t<=n[0]&&e>=r[1]&&e<=n[1]}applyTransforms(t){t.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=Ni.compose(this.position,this.scale,uXe(this.rotation),bg.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(t,e,i){let r=this.parent;e&&r!==null&&r!==void 0&&r.updateWorldMatrix(t,!0,!1),t&&this.updateLocalMatrix(),this.parent?this.worldMatrix=Ni.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=Ni.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return bg.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{t.resetBBoxNeedsUpdateSelf()})}updateTransformState(t){let e=!1;t.position!==void 0&&(e=!0,this.position=t.position),t.rotation!==void 0&&(e=!0,this.rotation=t.rotation),t.scale!==void 0&&(e=!0,this.scale=t.scale),t.shear!==void 0&&(e=!0,this.shear=t.shear),e&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(t,e,i){t.type===0&&t.props.visible!==void 0&&(this.visible=t.props.visible),this.data=e,this.data=e;let r=t,n=hr(t.path,["states","*"]);if(n!==null){if(t.type===0){let[s]=n;if((this==null?void 0:this.stateSelection)===s){let a={...t.props};if(delete a.name,Object.values(t.props).some(o=>o===void 0)){let o=this.data;if(o!==void 0){let l=es.zoom(o,t.path.slice(2));if(l)for(let c in t.props)t.props[c]===void 0&&c in l&&(a[c]=l[c])}}r={...t,props:a,path:t.path.slice(2)}}}}else if(t.type===0){let s=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(s!==void 0){if(t.props.name!==void 0&&s.name){let{name:o,...l}=s;s=l}let a=es.removeOverridden(t.path,t.props,s);r={...t,props:a}}}this.updateByPatchedOpBase(r,Jm.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(t,e,i=!1){if(!(this.data.states.length===0&&!i)){for(let r of this.data.states)Jm.toOps(this.data,r.data).forEach(n=>{let s=H2.replaceProps(n,this.data);this.dataPatched=this.data,this.updateByPatchedOp(s,this.data,e)});if(t!==null){let r=this.data.states.data(t);r&&(this.dataPatched=Jm.patch(this.data,r),Jm.toOps(this.data,r).forEach(n=>{this.updateByPatchedOp(n,this.dataPatched,e)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=t}}updateState(t,e){t.name!==void 0&&(this.name=t.name),t.visible!==void 0&&(this.visible=t.visible),this.updateTransformState(t)}updateByPatchedOpBase(t,e,i){this.dataPatched=e,this.updateByPatchedOp(t,e,i)}updateByPatchedOp(t,e,i){t.path.length===0&&t.type===0&&this.updateState(t.props,i),this.requestRender()}traverseFrameAncestors(t){this.traverseAncestors(e=>{e.data.type==="frame2d"&&t(e)})}traverseAncestors(t){let e=this.parent;for(;e;)t(e),e=e.parent}requestRender(){this.traverseFrameAncestors(t=>{t.requestRender()})}clone(t){let e=new Rs(this.uuid,this.data,t);return e.parent=void 0,e}addEventListener(t,e){this.emitter.on(t,e)}removeEventListener(t,e){this.emitter.off(t,e)}dispatchEvent(t){this.emitter.emit(t.type,{...t,target:t.target??this})}traverseSortNextHelper(){let t=this.parent;if(t){let e=t.children;if(e){let i=e.indexOf(this)+1;return e[i]?e[i]:t.traverseSortNextHelper()}}}sortNext(){let t=this.children;return t&&t.length>0&&t[0]?t[0]:this.traverseSortNextHelper()}isDescendantOf(t){t instanceof Rs&&(t=t.uuid);let e=this;for(;e.parent;){if(e.parent.uuid===t)return!0;e=e.parent}return!1}},Sc=class extends Rs{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.context=i,this.children=[]}add(t){t.parent&&t.parent instanceof Sc&&t.parent.remove(t),this.children.push(t),t.parent=this}remove(t){let e=this.children.indexOf(t);e>=0&&(this.children.splice(e,1),t.parent=void 0)}traverse(t){let e=t(this);if(e!==!0)for(let i of this.children)i instanceof Sc?i.traverse(t):e=t(i)}intersectsChildrenHelper(t,e,i,r,n){for(let s of this.children)if(s.intersects(t,e,i,!1)&&(n.push(s),r)||s instanceof Sc&&s.intersectsChildrenHelper(t,e,i,r,n))return!0;return!1}intersectsChildren(t,e,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelper(t,e,i,r,n),n}intersectsChildrenHelperReverse(t,e,i,r,n){for(let s of this.children)if(s instanceof Sc&&s.intersectsChildrenHelperReverse(t,e,i,r,n)||s.intersects(t,e,i,!1)&&(n.push(s),r))return!0;return!1}intersectsChildrenReverse(t,e,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelperReverse(t,e,i,r,n),n}updateWorldMatrix(t,e,i){if(super.updateWorldMatrix(t,e,i),i&&this.children)for(let r of this.children)r.updateWorldMatrix(t,!1,!0)}find(t){let e;return this.traverse(i=>{i.uuid===t&&(e=i)}),e}innerDrawChildren(t){for(let e=this.children.length-1;e>=0;e--)this.children[e].draw(t)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse(t=>{t.resetBBoxNeedsUpdateSelf()})}clone(t){let e=new Sc(this.uuid,this.data,t);e.parent=void 0;for(let i of this.children)e.add(i.clone(t));return e}},bp=class extends Sc{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.updateState(e,i)}draw(t){!this.visible||(t.save(),this.applyTransforms(t),this.innerDrawChildren(t),t.restore())}clone(t){let e=new bp(this.uuid,this.data,t);e.parent=void 0;for(let i of this.children)e.add(i.clone(t));return e}};function dXe(t,e){let[[i,r],[n,s]]=t,[[a,o],[l,c]]=e,h=(i-n)*(o-c)-(r-s)*(a-l);if(h===0)return!1;let u=((i-a)*(o-c)-(r-o)*(a-l))/h,d=-((i-n)*(r-o)-(r-s)*(i-a))/h;return u>=0&&u<=1&&d>=0&&d<=1}var Jle=[[-1,1],[-1,-1],[1,-1],[1,1]],qK=(t,e,i)=>{let r=t.getCenter(),n=t.getHalfSize(),s=Ni.append(e,t.worldMatrix);n[0]===0&&n[1]===0?i.push(Ni.apply(r,s)):Jle.forEach(a=>{let o=[a[0]*n[0]+r[0],a[1]*n[1]+r[1]];i.push(Ni.apply(o,s))})},fU=class{constructor(){this.matrix=Ni.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(t,e=!1){t.updateWorldMatrix(),this.makeEmpty(),Ni.copy(t.worldMatrix,this.matrix);let i=Ni.invert(t.worldMatrix);this.expandByObjectSize(t,i,e)}expandByObjectSize(t,e,i=!1){let r=[];i===!0&&t instanceof Sc?t.traverse(n=>{n.visible&&qK(n,e,r)}):qK(t,e,r),this.setFromPoints(r)}setFromSize(t,e,i){this.makeEmpty(),Ni.copy(i,this.matrix),this.expandBySize(t,e,i)}expandBySize(t,e,i){[Ni.apply([0,0],i),Ni.apply([0,e],i),Ni.apply([t,e],i),Ni.apply([t,0],i)].forEach(r=>this.expandByPoint(r))}getCenter(){let[t,e]=this.min,[i,r]=this.getHalfSize();return Ni.apply([t+i,e+r],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[(this.max[0]-this.min[0])*.5,(this.max[1]-this.min[1])*.5]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(t){this.makeEmpty();for(let e of t)this.expandByPoint(e)}expandByPoint(t){this.min=[Math.min(this.min[0],t[0]),Math.min(this.min[1],t[1])],this.max=[Math.max(this.max[0],t[0]),Math.max(this.max[1],t[1])]}computeVertices(){let[t,e]=this.getHalfSize(),i=this.getCenter(),[r,n,s,a]=Ni.getAbcdef(this.matrix),o=Ni.create(r,n,s,a,i[0],i[1]);this.vertices=Jle.map(([l,c])=>Ni.apply([l*t,c*e],o))}computeEdges(){this.edges=[];for(let t=0,e=this.vertices.length;t<e;++t)this.edges.push([this.vertices[t],this.vertices[(t+1)%e]])}project(t,e){let i=this.matrix;return e&&(i=Ni.append(e.worldMatrix,i)),Ni.applyInverse(t,i)}intersects(t,e,i){return this.intersectsInLocalSpace(...this.project([t,e],i))}intersectsInLocalSpace(t,e){let{min:i,max:r}=this;return t>=i[0]&&t<=r[0]&&e>=i[1]&&e<=r[1]}containsPoint(t){let[e,i]=t,[r,n]=this.min,[s,a]=this.max;return e>=r&&e<=s&&i>=n&&i<=a}intersectsBBox2D(t){for(let e=0,i=this.edges.length;e<i;e++){let r=this.edges[e];for(let n=0,s=t.edges.length;n<s;n++){let a=t.edges[n];if(dXe(r,a))return!0}}for(let e=0,i=t.vertices.length;e<i;e++){let r=t.vertices[e];if(this.containsPoint(r))return!0}return!1}ensureMinMax(){let t=this.min,e=this.max;this.min=[Math.min(t[0],e[0]),Math.min(t[1],e[1])],this.max=[Math.max(t[0],e[0]),Math.max(t[1],e[1])]}copy(t){this.min=[...t.min],this.max=[...t.max],Ni.copy(t.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let t=new fU;return t.copy(this),t}},Zle,fXe=new Promise(t=>{Zle=t}),KK=!1,gT;function pXe(){if(KK)return;if(gT)return gT;async function t(){let e=await Td(()=>import("./ui-L7l3pL7d.js"),[]);Zle(e.default??e),KK=!0}return gT=t(),gT}function QK(t){let e=!1;return t.scene.objects.traverse((i,r)=>{(r.type==="Mesh"&&r.geometry.type==="UIGeometry"||r.type==="Page"&&r.uiFrame!==void 0)&&(e=!0)}),e}var li,LO;async function mXe(t){let e=await fXe;li||(LO||(LO=e({locateFile:()=>t})),li=await LO)}var $K=Ni.identity(),ece=class{constructor(t,e=1){this.canvas=t,this._dpr=e,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=sr.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=sr.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let i=t.getBoundingClientRect();t.width=i.width*e,t.height=i.height*e}catch{console.log(t.width,e)}this._currentM3Transform=$K,this._currentTransform=new Float32Array($K)}get dpr(){return this._dpr}set dpr(t){this._dpr=t,this._isSizeDirty=!0}async init(){var t,e;if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await mXe(this.wasmURL),this._surface=li.MakeWebGLCanvasSurface(this.canvas),this.ctx=(t=this._surface)==null?void 0:t.getCanvas(),this._paint=new li.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(li.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(li.PaintStyle.Stroke),(e=this.ctx)==null||e.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(t){this._currentM3Transform=t,this._currentTransform.set(t)}async loadFont(t,e){let i=await(await fetch(t)).arrayBuffer();this.registerFont(i,e)}registerFont(t,e){if(this._fonts.has(e))return;let i=li.FontMgr.FromData(t);if(i)this._fonts.set(e,i);else throw new Error("Invalid font data for "+e)}get width(){return this._width}get height(){return this._height}set strokeColor(t){this._paintStroke&&this._paintStroke.setColor(vT(t),li.ColorSpace.DISPLAY_P3)}set fillColor(t){this._paintFill&&this._paintFill.setColor(vT(t),li.ColorSpace.DISPLAY_P3)}set lineWidth(t){this._paintStroke&&this._paintStroke.setStrokeWidth(this._strokeMode==="center"?t:t*2)}set strokeMode(t){this._strokeMode=t}set dropShadowBlur(t){this._dropShadowBlur=t}set dropShadowColor(t){this._dropShadowColor=t}set dropShadowOffsetX(t){this._dropShadowOffsetX=t}set dropShadowOffsetY(t){this._dropShadowOffsetY=t}set innerShadowBlur(t){this._innerShadowBlur=t}set innerShadowColor(t){this._innerShadowColor=t}set innerShadowOffsetX(t){this._innerShadowOffsetX=t}set innerShadowOffsetY(t){this._innerShadowOffsetY=t}set innerShadowSpread(t){this._innerShadowSpread=t}set layerBlur(t){this._layerBlur=t}set backgroundBlur(t){this._backgroundBlur=t}clear(){var t;(t=this.ctx)==null||t.clear(li.TRANSPARENT)}save(){var t;(t=this.ctx)==null||t.save()}restore(){var t;(t=this.ctx)==null||t.restore()}beginPath(){var t;(t=this._currentPath)==null||t.delete(),this._currentPath=new li.Path}closePath(){let t=this._currentPath;if(t){if(t.isEmpty())return;let e=t.getBounds();(e[3]-e[1]||e[2]-e[0])&&t.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(t,e,i,r,n=0,s=0,a=0,o=0){var c,h;let l=li.XYWHRect(t,e,i,r);if(n===0&&s===0&&o===0&&a===0)(c=this.ctx)==null||c.clipRect(l,li.ClipOp.Intersect,!0);else{let u=li.RRectXY(l,n,n);u[4]=u[5]=n,u[6]=u[7]=s,u[8]=u[9]=a,u[10]=u[11]=o,(h=this.ctx)==null||h.clipRRect(u,li.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let t=Ni.invert(this.currentTransform);this.ctx.concat(t);let e=Ni.translate(Ni.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(e),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(t,e,i=!0){var r,n,s,a;if(this.ctx&&this._currentPath){let o,l=!1;if(i&&this._hasDropShadow()){let c=t.copy();c.setColor(vT(this._dropShadowColor));let h;this._dropShadowBlur>0&&(h=li.MaskFilter.MakeBlur(li.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(((r=this.camera)==null?void 0:r.scale)??1),!1),c.setMaskFilter(h)),this.ctx.save(),this.ctx.clipPath(this._currentPath,li.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),e(c),this.ctx.restore(),c.delete(),h==null||h.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,li.ClipOp.Intersect,!0);let c=li.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,li.TileMode.Clamp,null),h=t.copy();h.setImageFilter(c),h.setAlphaf(1);let u=this._currentPath.computeTightBounds();this.ctx.saveLayer(h,u,null,li.SaveLayerInitWithPrevious),this.ctx.drawColor(t.getColor()),this.ctx.restore(),this.ctx.restore(),h.delete(),c.delete(),l=!0}if(this._layerBlur>0){let c=t.copy();o=li.MaskFilter.MakeBlur(li.BlurStyle.Normal,this._layerBlur*this.dpr*(((n=this.camera)==null?void 0:n.scale)??1),!1),c.setMaskFilter(o),e(c),c.delete(),o.delete(),l=!0}if(l||e(t),i&&this._hasInnerShadow()){let c=new li.Paint;c.setAntiAlias(!0),c.setStyle(li.PaintStyle.Fill),c.setColor(vT(this._innerShadowColor));let h;this._innerShadowBlur>0&&(h=li.MaskFilter.MakeBlur(li.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(((s=this.camera)==null?void 0:s.scale)??1),!1),c.setMaskFilter(h));let u=this._currentPath.computeTightBounds(),[d,f,p,m]=u,g=p-d,v=m-f;this.ctx.save(),this.ctx.clipPath(this._currentPath,li.ClipOp.Intersect,!0),this.ctx.saveLayer(c,u,null,li.SaveLayerInitWithPrevious),(a=this.ctx)==null||a.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(li.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+g+Math.abs(this._innerShadowOffsetX*2),2e3+v+Math.abs(this._innerShadowOffsetY*2)),c),c.setBlendMode(li.BlendMode.Clear),this.ctx.drawPath(this._currentPath,c),this.ctx.restore(),this.ctx.restore(),c.delete(),h==null||h.delete()}}}_paintInner(t,e=!0){if(this.ctx&&this._currentPath&&t){let i=this.ctx,r=this._currentPath;this._applyEffectsToPaint(t,n=>{let s=!1;!e&&this._strokeMode!=="center"&&(i.save(),i.clipPath(r,this._strokeMode==="outside"?li.ClipOp.Difference:li.ClipOp.Intersect,!0),s=!0),i.drawPath(r,n),s&&i.restore()},e)}}_hasDropShadow(){var t;return((t=this._dropShadowColor)==null?void 0:t.a)>0}_hasInnerShadow(){var t;return((t=this._innerShadowColor)==null?void 0:t.a)>0}path(t){var e;(e=this._currentPath)==null||e.addPath(li.Path.MakeFromSVGString(t))}ellipse(t,e,i,r,n,s,a,o){var c;if(!JK([t,e,i,r])||!this._currentPath)return;if(i<0||r<0)throw Error("radii cannot be negative");let l=li.XYWHRect(t-i,e-r,i*2,r*2);(c=this._currentPath)==null||c.addOval(l)}rect(t,e,i,r,n=0,s=0,a=0,o=0){var c,h;let l=li.XYWHRect(t,e,i,r);if(JK(l))if(n===0&&s===0&&o===0&&a===0)(c=this._currentPath)==null||c.addRect(l);else{let u=li.RRectXY(l,n,n);u[4]=u[5]=n,u[6]=u[7]=s,u[8]=u[9]=a,u[10]=u[11]=o,(h=this._currentPath)==null||h.addRRect(u)}}getHorizontalAlign(t){switch(t){case 2:return li.TextAlign.Right;case 3:return li.TextAlign.Center;case 4:return li.TextAlign.Justify;case 1:default:return li.TextAlign.Left}}drawTextInner(t,e,i,[r,n,s,a],o,l,c=!0){let h=0,{ctx:u}=this;if(!u)return h;let d=l.copy(),f=l.copy();return f.setAlphaf(0),this._applyEffectsToPaint(d,p=>{e.pushPaintStyle(i,p,f),e.addText(t);let m=e.build();m.layout(s);let g=n;o===2?g+=(a-m.getHeight())/2:o===3&&(g+=a-m.getHeight()),u.drawParagraph(m,r,g),h=m.getHeight(),e.reset(),m.delete()},c),d.delete(),f.delete(),h}drawText(t,e){let i=0,r=this._fonts.get(e.font),{ctx:n,_paintFill:s,_paintStroke:a}=this;if(r&&n){let o=new li.TextStyle({fontFamilies:[e.font],fontSize:e.fontSize,heightMultiplier:e.lineHeight,letterSpacing:e.letterSpacing}),l=new li.ParagraphStyle({textStyle:o,textAlign:this.getHorizontalAlign(e.horizontalAlign)}),c=li.XYWHRect(e.x,e.y,e.width,e.height),h=li.ParagraphBuilder.Make(l,r);s&&(i=this.drawTextInner(t,h,o,c,e.verticalAlign,s,!0)),a&&(i=this.drawTextInner(t,h,o,c,e.verticalAlign,a,!1)),h.delete()}return{height:i}}render(){var t;(t=this._surface)==null||t.flush()}moveTo(t,e){var i;(i=this._currentPath)==null||i.moveTo(t,e)}lineTo(t,e){var i;(i=this._currentPath)==null||i.lineTo(t,e)}bezierCurveTo(t,e,i,r,n,s){var a;(a=this._currentPath)==null||a.cubicTo(t,e,i,r,n,s)}quadraticCurveTo(t,e,i,r){var n;(n=this._currentPath)==null||n.quadTo(t,e,i,r)}setTransform(t,e=!1){var n,s,a,o,l;if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),r=Ni.invert(i);if(r&&this.ctx.concat(r),(n=this.ctx)==null||n.scale(this.dpr,this.dpr),((s=this.camera)==null?void 0:s.enabled)&&((a=this.ctx)==null||a.concat(this.camera.worldMatrix),e)){let c=Ni.getScale(this.camera.worldMatrix);(o=this.ctx)==null||o.scale(1/c[0],1/c[1])}(l=this.ctx)==null||l.concat(t),this.currentTransform=t}transform(t){var e;(e=this.ctx)==null||e.concat(t)}setSize(t,e){var i;!this._isSizeDirty&&t===this._width&&e===this._height||(this._isSizeDirty=!1,this._width=t,this._height=e,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.canvas.width=t*this.dpr,this.canvas.height=e*this.dpr,this._surface&&(this._surface=li.MakeWebGLCanvasSurface(this.canvas),this.ctx=(i=this._surface)==null?void 0:i.getCanvas()))}};function JK(t){for(let e=0;e<t.length;e++)if(t[e]!==void 0&&!Number.isFinite(t[e]))return!1;return!0}function vT({r:t,g:e,b:i,a:r}){return li.Color4f(t,e,i,r)}var ZK=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.color=sr.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(e)}update(t){t.color!==void 0&&(this.color=t.color),t.enabled!==void 0&&(this.enabled=t.enabled),t.blurRadius!==void 0&&(this.blurRadius=t.blurRadius),t.offset!==void 0&&(this.offset=t.offset),t.spread!==void 0&&(this.spread=t.spread)}},eQ=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.radius=0,this.update(e)}update(t){t.enabled!==void 0&&(this.enabled=t.enabled),t.radius!==void 0&&(this.radius=t.radius)}},gXe=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.color=sr.transparent,this.update(e)}update(t){t.enabled!==void 0&&(this.enabled=t.enabled),t.color!==void 0&&(this.color=t.color)}},vXe=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.color=sr.transparent,this.thickness=0,this.mode="inside",this.update(e)}update(t){t.enabled!==void 0&&(this.enabled=t.enabled),t.color!==void 0&&(this.color=t.color),t.thickness!==void 0&&(this.thickness=t.thickness),t.mode!==void 0&&(this.mode=t.mode)}},Ss=class extends Rs{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.autoClose=!0,this.fill=new gXe(t+"-fill",e.fill,i),this.stroke=new vXe(t+"-stroke",e.stroke,i),this.dropShadow=new ZK(t+"-dropShadow",e.dropShadow,i),this.innerShadow=new ZK(t+"-innerShadow",e.innerShadow,i),this.backgroundBlur=new eQ(t+"-backgroundBlur",e.backgroundBlur,i),this.layerBlur=new eQ(t+"-layerBlur",e.layerBlur,i)}applyFillStroke(t){t.fillColor=this.fill.enabled?this.fill.color:sr.transparent,t.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:sr.transparent,t.strokeMode=this.stroke.mode,t.lineWidth=this.stroke.thickness}applyFilters(t){this.layerBlur.enabled?t.layerBlur=this.layerBlur.radius*5:t.layerBlur=0,this.backgroundBlur.enabled?t.backgroundBlur=this.backgroundBlur.radius*5:t.backgroundBlur=0,this.dropShadow.enabled?(t.dropShadowBlur=this.dropShadow.blurRadius*5,t.dropShadowColor=this.dropShadow.color,t.dropShadowOffsetX=this.dropShadow.offset[0],t.dropShadowOffsetY=this.dropShadow.offset[1]):t.dropShadowColor=sr.transparent,this.innerShadow.enabled?(t.innerShadowSpread=this.innerShadow.spread,t.innerShadowBlur=this.innerShadow.blurRadius*5,t.innerShadowColor=this.innerShadow.color,t.innerShadowOffsetX=this.innerShadow.offset[0],t.innerShadowOffsetY=this.innerShadow.offset[1]):t.innerShadowColor=sr.transparent}innerDraw(t){}draw(t){!this.visible||(t.save(),this.applyTransforms(t),this.applyFilters(t),this.applyFillStroke(t),t.beginPath(),this.innerDraw(t),this.autoClose&&t.closePath(),this.fill.enabled&&t.fill(),this.stroke.enabled&&t.stroke(),t.restore())}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),t.type===0&&(hr(t.path,["fill"])?this.fill.update(t.props):hr(t.path,["stroke"])?this.stroke.update(t.props):hr(t.path,["dropShadow"])?this.dropShadow.update(t.props):hr(t.path,["innerShadow"])?this.innerShadow.update(t.props):hr(t.path,["layerBlur"])?this.layerBlur.update(t.props):hr(t.path,["backgroundBlur"])?this.backgroundBlur.update(t.props):this.resetBBoxNeedsUpdate())}updateState(t,e){super.updateState(t,e),t.fill!==void 0&&this.fill.update(t.fill),t.stroke!==void 0&&this.stroke.update(t.stroke),t.dropShadow!==void 0&&this.dropShadow.update(t.dropShadow),t.innerShadow!==void 0&&this.innerShadow.update(t.innerShadow),t.layerBlur!==void 0&&this.layerBlur.update(t.layerBlur),t.backgroundBlur!==void 0&&this.backgroundBlur.update(t.backgroundBlur)}clone(t){let e=new Ss(this.uuid,this.data,t);return e.parent=void 0,e}},kG=class extends Ss{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.width=0,this.height=0,this.updateState(e,i)}innerDraw(t){t.ellipse(this.width*.5,this.height*.5,this.width*.5,this.height*.5,0,0,Math.PI*2)}intersectsInLocalSpace(t,e){return hXe(t,e,this.width*.5,this.height*.5,this.width*.5,this.height*.5)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(t){let e=!1;t.width!==void 0&&(this.width=typeof t.width=="number"?t.width:this.width,e=!0),t.height!==void 0&&(this.height=typeof t.height=="number"?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateState(t,e){super.updateState(t,e),this.updateSizeState(t)}clone(t){let e=new kG(this.uuid,this.data,t);return e.parent=void 0,e}},N_=class extends Ss{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(e,i)}innerDraw(t){t.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(t){t.cornerRadius!==void 0&&(this.cornerRadius=t.cornerRadius)}updateSizeState(t){let e=!1;t.width!==void 0&&(this.width=typeof t.width=="number"?t.width:this.width,e=!0),t.height!==void 0&&(this.height=typeof t.height=="number"?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateState(t,e){super.updateState(t,e),this.updateSizeState(t),this.updateCornerState(t)}clone(t){let e=new N_(this.uuid,this.data,t);return e.parent=void 0,e}},NG=class extends Ss{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(e,i)}get textHeight(){return this._textHeight}applyFillStroke(t){t.fillColor=this.fill.enabled?this.fill.color:sr.transparent,t.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:sr.transparent,t.strokeMode="center",t.lineWidth=this.stroke.thickness}innerDraw(t){var s;(s=this._fontHolder)!=null&&s.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&t.registerFont(this._fontHolder.arrayBuffer,this.data.font);let e=this.data.textTransform,i=this.data.text.textValue.toString(),r=e===2?i.toUpperCase():e===3?i.toLowerCase():i,{height:n}=t.drawText(r,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=n}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(t){let e=!1;t.width!==void 0&&(this.width=typeof t.width=="number"?t.width:this.width,e=!0),t.height!==void 0&&(this.height=typeof t.height=="number"?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(t,{shared:e}){t.font!==void 0&&(this._fontHolder=e.getFont(t.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then(()=>{this.requestRender()}))}updateState(t,e){super.updateState(t,e),this.updateSizeState(t),this.updateFontState(t,e)}clone(t){let e=new NG(this.uuid,this.data,t);return e.parent=void 0,e}},tce=class extends Ss{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(e,i)}computeExtremas(){this.curves.length===0&&this.computeCurves();let t=this.curves.map(r=>yP.extremas(r)),e=[1/0,1/0],i=[-1/0,-1/0];for(let r=0,n=t.length;r<n;r++){let s=t[r];s[0][0]<e[0]&&(e[0]=s[0][0]),s[0][1]<e[1]&&(e[1]=s[0][1]),s[1][0]>i[0]&&(i[0]=s[1][0]),s[1][1]>i[1]&&(i[1]=s[1][1])}return this.extremasBBox.min=[e[0],e[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,r=this.data.points.length;i<r;i++){let n=this.data.points[i].data,s=this.data.points[i-1].data,a={start:s.position,cp1:s.controlNext.position,cp2:n.controlPrevious.position,end:n.position};this.curves.push(a)}let t=this.data.points[0].data,e=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:e.position,cp1:e.controlNext.position,cp2:t.controlPrevious.position,end:t.position};this.curves.push(i)}}getCenter(){let[t,e]=this.extremasBBox.min,[i,r]=this.getHalfSize();return[t+i,e+r]}getHalfSize(){let{min:t,max:e}=this.extremasBBox;return[(e[0]-t[0])*.5,(e[1]-t[1])*.5]}innerDraw(t){for(let r=0,n=this.data.points.length;r<n;r++){let s=this.data.points[r].data;if(r===0){let[a,o]=s.position;t.moveTo(a,o)}else{let a=this.data.points[r-1].data,[o,l]=a.controlNext.position,[c,h]=s.controlPrevious.position,[u,d]=s.position,f={start:a.position,cp1:a.controlNext.position,cp2:s.controlPrevious.position,end:s.position};yP.derive(f),t.bezierCurveTo(o,l,c,h,u,d)}}let e=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[r,n]=i.controlNext.position,[s,a]=e.controlPrevious.position,[o,l]=e.position;t.bezierCurveTo(r,n,s,a,o,l)}}updateState(t,e){super.updateState(t,e),this.computeExtremas()}clone(t){let e=new tce(this.uuid,this.data,t);return e.parent=void 0,e}},yP;(t=>{function e(a){let o=a.start,l=a.cp1,c=a.cp2,h=a.end,u=[3*(l[0]-o[0]),3*(l[1]-o[1])],d=[3*(c[0]-l[0]),3*(c[1]-l[1])],f=[3*(h[0]-c[0]),3*(h[1]-c[1])],p={start:u,cp:d,end:f};return a.derivative=p,p.derivative=pU.derive(p),p}t.derive=e;function i(a,o,l,c=!1){let h=a-2*o+l;if(h!==0){let u=-Math.sqrt(Math.abs(o*o-a*l)),d=-a+o,f=-(u+d)/h,p=-(-u+d)/h;return[f,p]}else if(o!==l&&h===0)return[(2*o-l)/(2*(o-l))];return[]}function r(a){let o=a.derivative??t.derive(a),l=o.start,c=o.cp,h=o.end;return[i(l[0],c[0],h[0]),i(l[1],c[1],h[1])]}t.droot=r;function n(a){let[o,l]=t.droot(a),c=[a.start[0],a.end[0]],h=[a.start[1],a.end[1]];for(let u of o)c.push(t.compute(a,Math.min(1,Math.max(0,u)))[0]);for(let u of l)h.push(t.compute(a,Math.min(1,Math.max(0,u)))[1]);return c.sort((u,d)=>u-d),h.sort((u,d)=>u-d),[[c[0],h[0]],[c[c.length-1],h[h.length-1]]]}t.extremas=n;function s(a,o){if(o===0)return[...a.start];if(o===1)return[...a.end];let l=1-o,c=l*l,h=o*o,u=c*l,d=c*o*3,f=l*h*3,p=o*h;return[u*a.start[0]+d*a.cp1[0]+f*a.cp2[0]+p*a.end[0],u*a.start[1]+d*a.cp1[1]+f*a.cp2[1]+p*a.end[1]]}t.compute=s})(yP||(yP={}));var pU;(t=>{function e(n){let s=n.start,a=n.cp,o=n.end,l=[2*(a[0]-s[0]),2*(a[1]-s[1])],c=[2*(o[0]-a[0]),2*(o[1]-a[1])],h={start:l,end:c};return h.derivative=mU.derive(h),n.derivative=h,h}t.derive=e;function i(n){let s=n.derivative??t.derive(n),a=s.start,o=s.end;return[a[0]!==o[0]?a[0]/(a[0]-o[0]):0,a[1]!==o[1]?a[1]/(a[1]-o[1]):0]}t.droot=i;function r(n,s){if(s===0)return[...n.start];if(s===1)return[...n.end];let a=1-s,o=a*a,l=s*s,c=o,h=a*s*2,u=l;return[c*n.start[0]+h*n.cp[0]+u*n.end[0],c*n.start[1]+h*n.cp[1]+u*n.end[1]]}t.compute=r})(pU||(pU={}));var mU;(t=>{function e(r){let n=r.start,s=r.end,a=[s[0]-n[0],s[1]-n[1]];return r.derivative=a,r.derivative}t.derive=e;function i(r,n){if(n===0)return[...r.start];if(n===1)return[...r.end];let s=r.start,a=r.end;return[s[0]+(a[0]-s[0])*n,s[1]+(a[1]-s[1])*n]}t.compute=i})(mU||(mU={}));var Fh=class extends Sc{constructor(t,e,i){super(t,e,i),this.uuid=t,this.width=0,this.height=0,this.clipped=!0,this.background=new N_(t+"-background",TS.defaultData,i),this.background.parent=this,this.updateState(e,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(t){this.background.cornerRadius=t}updateLocalMatrix(){var t;super.updateLocalMatrix(),(t=this.background)==null||t.updateLocalMatrix()}updateWorldMatrix(t,e,i){var r;super.updateWorldMatrix(t,e,i),(r=this.background)==null||r.updateWorldMatrix(t,e,i)}draw(t){if(!this.visible)return;t.save();let e=this.width,i=this.height;this.applyTransforms(t),this.background.width=e,this.background.height=i,this.background.draw(t),this.clipped&&t.clipRect(0,0,e,i,...this.cornerRadius),this.innerDrawChildren(t),t.restore()}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(t){t.cornerRadius!==void 0&&(this.cornerRadius=t.cornerRadius)}updateSizeState(t){let e=!1;t.width!==void 0&&(this.width=typeof t.width=="number"?t.width:this.width,e=!0),t.height!==void 0&&(this.height=typeof t.height=="number"?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateState(t,e){super.updateState(t,e),this.updateSizeState(t),this.updateCornerState(t),t.fill!==void 0&&this.fill.update(t.fill),t.stroke!==void 0&&this.stroke.update(t.stroke),t.dropShadow!==void 0&&this.dropShadow.update(t.dropShadow),t.innerShadow!==void 0&&this.innerShadow.update(t.innerShadow),t.layerBlur!==void 0&&this.layerBlur.update(t.layerBlur),t.backgroundBlur!==void 0&&this.backgroundBlur.update(t.backgroundBlur),t.clipped!==void 0&&(this.clipped=t.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),t.type===0&&(hr(t.path,["fill"])?this.fill.update(t.props):hr(t.path,["stroke"])?this.stroke.update(t.props):hr(t.path,["dropShadow"])?this.dropShadow.update(t.props):hr(t.path,["innerShadow"])?this.innerShadow.update(t.props):hr(t.path,["layerBlur"])?this.layerBlur.update(t.props):hr(t.path,["backgroundBlur"])?this.backgroundBlur.update(t.props):this.resetBBoxNeedsUpdate())}clone(t){let e=new Fh(this.uuid,this.data,t);e.parent=void 0;for(let i of this.children)e.add(i.clone(t));return e}},yXe=Ip(sse(),1),qD=class extends Ss{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this._pathBBox=new DOMRect,this.path="",this.updateState(e,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(t),e.setAttribute("d",this.path),t.appendChild(e),this._pathBBox=e.getBBox(),t.remove()}innerDraw(t){t.path(this.path)}intersectsInLocalSpace(t,e){return t>=this._pathBBox.x&&t<=this._pathBBox.x+this._pathBBox.width&&e>=this._pathBBox.y&&e<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(t,e){super.updateState(t,e),t.path!==void 0&&(this.path=t.path,this.computeSVGBBox())}clone(t){let e=new qD(this.uuid,this.data,t);return e.parent=void 0,e}};function xXe(t,e=1,i=1){if(e<=0||i<=0)return t;let r=(0,yXe.parseSVG)(t).map(n=>{let s={...n};return"x"in s&&(s.x=s.x*e),"y"in s&&(s.y=s.y*i),"x1"in s&&(s.x1=s.x1*e),"x2"in s&&(s.x2=s.x2*e),"y1"in s&&(s.y1=s.y1*i),"y2"in s&&(s.y2=s.y2*i),"rx"in s&&(s.rx=s.rx*e),"ry"in s&&(s.ry=s.ry*i),s});return bXe(r)}function bXe(t){let e=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"],i;return t.map(r=>{let n=[];e.forEach(a=>{if(a in r){let o=r[a]*1;n.length&&o>=0&&n.push(","),n.push(o)}});let s=(i===r.code?n[0]<0?"":",":r.code)+n.join("");return i=r.code,s}).join("")}function wXe(t,e,i){switch(e.type){case"ellipse2d":return new kG(t,e,i);case"rectangle2d":return new N_(t,e,i);case"text2d":return new NG(t,e,i);case"vector2d":return new tce(t,e,i);case"path2d":return new qD(t,e,i);case"frame2d":return new Fh(t,e,i);case"group2d":default:return new bp(t,e,i)}}var ice=class{constructor(t,e,i){this.uuid=t,this.data=e,this.group=new bp(ice.GROUP_ID,{...lP.defaultData},i),this.createChildrenObjects(e.objects,this.group,i)}createObject(t,e,i,r,n,s){let a=wXe(t,e,s);a&&(r.add(a),r.children.splice(n,0,r.children.pop()),a.updateWorldMatrix(),i.length>0&&(a instanceof bp||a instanceof Fh)&&this.createChildrenObjects(i,a,s))}createChildrenObjects(t,e,i){let r=0;for(let n of t)this.createObject(n.id,n.data,n.children,e,r,i),r+=1}draw(t){this.group.draw(t)}updateEntityByOp(t,e,i,r){let n=this.find(t);if(n)try{n.updateByOp(e,i,{shared:r})}catch(s){console.error(s)}}updateTreeByOp(t,e){if(t.path.length===0&&t.type===7){let i=t.parent===null?this.group:this.find(t.parent);i!==void 0&&i instanceof Sc&&(this.createObject(t.id,t.data,t.children,i,t.localIndex,e),i.requestRender())}else if(t.path.length===0&&t.type===8){let i=this.find(t.id);if(i!==void 0&&i.parent!==void 0&&i.parent instanceof Sc){let r=i.parent;i.resetBBoxNeedsUpdate(),r==null||r.remove(i),r==null||r.requestRender()}}else if(t.path.length===0&&t.type===9){let i=this.find(t.id);if(i!==void 0){let r=i.parent,n=t.parent===null?this:this.find(t.parent);if(n instanceof Sc||n===this){n.add(i);let s=t.localIndex;n.children.splice(s,0,n.children.pop()),i.updateWorldMatrix(!0,!1,!0),r==null||r.requestRender(),i.requestRender()}i.resetBBoxNeedsUpdate()}}}add(t){this.group.add(t)}remove(t){this.group.remove(t)}traverse(t){this.group.traverse(e=>{e!==this.group&&t(e)})}intersectsChildren(t,e,i,r=!1,n=[]){return this.group.intersectsChildren(t,e,i,r,n,!0)}intersectsChildrenReverse(t,e,i,r=!1,n=[]){return this.group.intersectsChildrenReverse(t,e,i,r,n,!0)}find(t){return this.group.find(t)}get children(){return this.group.children}project(t,e){return this.group.project(t,e)}getWithSortKey(t){let e=this.find(t);if(e===void 0)return;let i=[],r=e;for(;r!==this.group;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:e,sortKey:i}}getAllSorted(t){let e=[];for(let i of t){let r=this.getWithSortKey(i.id);r!==void 0&&e.push(r)}return e.sort((i,r)=>kae(i.sortKey,r.sortKey)),e.map(i=>i.entity)}},UG=ice;UG.GROUP_ID="scene2d";function rce({constraints:t,newParentWidth:e,newParentHeight:i,initialParentWidth:r,initialParentHeight:n,objectInitialWidth:s,objectInitialHeight:a,objectInitialPosition:o}){let{horizontalConstraint:l,verticalConstraint:c}=t,h=e-r,u=i-n,d=s,f=a,p=o[0],m=o[1];if(l!==0){if(l===1)p+=h;else if(l===3)p+=h/2;else if(l===2)d=Math.max(1,d+h);else if(l===4){let g=e/r;d*=g,p*=g}}if(c!==0){if(c===1)m+=u;else if(c===3)m+=u/2;else if(c===2)f=Math.max(1,f+u);else if(c===4){let g=i/n;f*=g,m*=g}}return{width:d,height:f,position:[p,m]}}Ip(sse(),1);var SXe=`
	varying vec2 vUv;
	void main() {
		vUv = uv;
		gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
	}`,_Xe=`
	uniform sampler2D tDiffuse;
	varying vec2 vUv;
	void main() {
		vec4 texel = texture2D( tDiffuse, vUv );
		gl_FragColor = texel;
	}`,AXe=new MD(-1,1,1,-1,0,1),EXe=class extends Nt{constructor(){super(),this.setAttribute("position",new bt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new bt([0,2,0,0,2,0],2))}},MXe=new EXe,TXe=class{constructor(t){this._mesh=new vr(MXe,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,AXe)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}},nce=new Ri({defines:{},uniforms:{tDiffuse:new et(null)},vertexShader:SXe,fragmentShader:_Xe}),CXe=new TXe(nce),OO=null,BO=null,PXe=()=>(OO===null&&(OO=document.createElement("canvas")),OO),DXe=t=>(BO===null&&(BO=new ece(t)),BO),RXe=Ni.identity(),sce=class{constructor(t,e,i,r){this.uuid=t,this.width=e,this.height=i,this.context=r,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let n=this.width,s=this.height,a=this.dpr;this.renderer.dpr=this.isScreenSpace?a:Math.floor(2048/Math.max(n,s)),this.renderer.setSize(n,s)},this.onFrameOverrideObjectEvent=n=>{var s,a;if(((s=n.target)==null?void 0:s.uuid)!==void 0){let o=(a=this.frameRoot)==null?void 0:a.find(n.target.uuid);o&&o.dispatchEvent({...n,target:o})}},this.scene2d=new UG(Et.generateUUID(),kN.defaultData,{dpr:window.devicePixelRatio,shared:r.shared}),this.canvas=PXe(),this.renderer=DXe(this.canvas),this.promise=this.init(),this.renderTarget=new Di(1,1,{type:fd,stencilBuffer:!1,depthBuffer:!1}),r.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=r.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new v3e(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof ece&&(this.renderer.wasmURL=Cle.skiaWasmUrl),await this.renderer.init()}render(t){var e,i;if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),(e=this.frameOverride)==null||e.draw(this.renderer),this.renderer.render(),nce.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let r=t.getRenderTarget();t.setRenderTarget(this.renderTarget),t.clear(),CXe.render(t),t.setRenderTarget(r),(i=this.textureHolder)==null||i.setNeedsUpdate(!0)}}updateEntity2DByOp(t,e,i,r){this.scene2d.updateEntityByOp(t,e,i,r),this.applySize()}updateTreeByOp(t,e){this.scene2d.updateTreeByOp(t,e),this.applySize()}applyOverrides(t){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let e=(t==null?void 0:t.width)??this.width,i=(t==null?void 0:t.height)??this.height;this.frameOverride.width=e,this.frameOverride.height=i,this.frameOverride.localMatrix=RXe,this.isScreenSpace&&(this.frameOverride.fill.color=sr.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:e,height:i},ace({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(t,e=window.devicePixelRatio){var o,l;let i=Math.max(1,(t==null?void 0:t.width)??this.width),r=Math.max(1,(t==null?void 0:t.height)??this.height);this.dpr=e,this.width=i,this.height=r,this._innerApplySize();let n=1,s=512,a=512;(i*e<s||r*e<a)&&(n=Math.max(s/(i*e),a/(r*e))),this.renderTarget.setSize(i*e*n,r*e*n),(o=this._canvasTexture)==null||o.dispose(),this._canvasTexture=void 0,this.applyOverrides(t),(l=this.frameOverride)==null||l.requestRender()}applyFrame(t){var i,r;let e=this.context.scene.find2D(t);if(!(!e||!(e instanceof Fh)))return this.disposeFrameOverride(),this.frameRoot=e,this.frameOverride=e.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),(i=this.frame)==null||i.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse(n=>{n.addEventListener("beginState",this.onFrameOverrideObjectEvent)}),this.frameOverride.traverse(n=>{n.addEventListener("completeState",this.onFrameOverrideObjectEvent)}),(r=this.frame)==null||r.requestRender(),e}get frame(){return this.frameOverride}get frameId(){var t;return(t=this.frame)==null?void 0:t.uuid}find(t){return this.scene2d.find(t)}get texture(){var t;return(t=this.textureHolder)==null?void 0:t.getTexture(1001)}disposeFrameOverride(){var t,e,i;(t=this.frameOverride)==null||t.removeEventListener("render",this.onRenderRequestedDownstream),(e=this.frameOverride)==null||e.traverse(r=>{r.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)}),(i=this.frameOverride)==null||i.traverse(r=>{r.removeEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function ace({objectOverride:t,objectRoot:e,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){if(t instanceof Fh&&e instanceof Fh||t instanceof bp&&e instanceof bp)for(let a=0,o=t.children.length;a<o;a++){let l=t.children[a],c=e.children[a];l&&c&&l.uuid===c.uuid&&LXe({objectOverride:l,objectRoot:c,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s})}}function IXe(t){if(gU(t))return[t.width,t.height];if(t instanceof qD){let[e,i]=t.getHalfSize();return[e*2,i*2]}else if(t instanceof bp){let[e,i]=t.recursiveBBox.getHalfSize();return[e*2,i*2]}return[0,0]}function LXe({objectOverride:t,objectRoot:e,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){let[a,o]=IXe(e),{width:l,height:c,position:h}=rce({constraints:t.data,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s,objectInitialWidth:a,objectInitialHeight:o,objectInitialPosition:e.position});if(t.position=h,t.data={...t.data,position:h},t.states)for(let u in t.states)OXe({stateId:u,objectOverride:t,objectRoot:e,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s});if(gU(t)||t instanceof bp)gU(t)&&(t.width=l,t.height=c,t.data={...t.data,width:l,height:c}),ace({objectOverride:t,objectRoot:e,newParentWidth:l,newParentHeight:c,initialParentWidth:a,initialParentHeight:o});else if(t instanceof qD){let u=e,d=a!==0?l/a:1,f=o!==0?c/o:1;t.path=xXe(u.path,d,f),t.data={...t.data,path:t.path}}}function OXe({stateId:t,objectOverride:e,objectRoot:i,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a}){var c,h;let o=(c=e.states)==null?void 0:c[t],l=(h=i.states)==null?void 0:h[t];if(o&&l){let{width:u,height:d,position:f}=rce({constraints:e.data,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a,objectInitialWidth:bg.isResizeable(l)?l.width:0,objectInitialHeight:bg.isResizeable(l)?l.height:0,objectInitialPosition:l.position});Object.assign(e.states[t],{position:f}),bg.isResizeable(o)&&Object.assign(e.states[t],{width:u,height:d})}}function gU(t){return t instanceof N_||t instanceof Fh||t instanceof kG||t instanceof NG}var ws=class extends mG(go){constructor(t,e,i){super(),this.data=e,this.bgColor=new Qs(1,1,1,1),this.fog=null,this.backupFog=new Rse(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new Xt,this.penumbraSizeArrayCache=null,this.super_Entity(t,e),this.personalCamera=new ga(J1,{...AS.defaultData,...e.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new rOe(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),e.uiScene?this.uiScene=new UG((Array.isArray(t)?t[0]:t)+"-ui",e.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):e.uiFrame&&this.createUICanvas(e.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){var t;return(t=this.uiCanvas)==null?void 0:t.frame}createUICanvas(t,e){this.uiCanvas=new sce(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,e),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then(()=>{var i,r;(i=this.uiCanvas)==null||i.applyFrame(t),(r=this.uiCanvas)==null||r.applySize()})}updateVisible(){}setBackgroundColor(t){this.bgColor=t,this.fogUseBGColor===!0&&(this.backupFog.color=t)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(t,e){t.color!==void 0&&(this.ambientLight.color=za(t.color,e)),t.intensity!==void 0&&(this.ambientLight.intensity=t.intensity),t.enabled!==void 0&&(t.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(t){this.isActive=!0,t.fog=this.fog,this.traverseEntity(e=>{e instanceof Yg&&e.recomputeBoolean()}),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(t=>{if(t instanceof tx)if(Array.isArray(t.material))for(let e of t.material)e.needsUpdate=!0;else t.material.needsUpdate=!0,t.material.dispose()})}updateShadow(t){t.softShadowQuality!==void 0&&this.isActive&&$7e(t.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(t,e){if(t.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let i=this.scene;i.fog=this.fog}this.fogUseBGColor=t.useBackgroundColor,t.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=za(t.color,e),this.backupFog.near=t.near,this.backupFog.far=t.far}updateAo(t,e){t.aoColor!==void 0&&(this.aoColor=za(t.aoColor,e))}updateByOp(t,e,i,r){let n=this.data.uiFrame;super.updateByOp(t,e,i,r);let s=e;hr(t.path,["fog"])?this.updateFog(s.fog,i.shared):hr(t.path,["ao"])?this.updateAo(s.ao,i.shared):hr(t.path,["ambient"])?this.updateAmbientLight(s.ambient,i.shared):hr(t.path,["shadow"])?this.updateShadow(s.shadow):t.type===0&&t.path.length===0&&(t.props.uiFrame!==void 0||n!==s.uiFrame)&&this.updateUIFrame(t.props.uiFrame,i)}updateUIFrame(t,e){t?(this.uiCanvas||this.createUICanvas(t,e),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(t)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(t,e){this.updateState_Entity(t,e),t.backgroundColor!==void 0&&this.setBackgroundColor(za(t.backgroundColor,e.shared)),t.fog!==void 0&&this.updateFog(t.fog,e.shared),t.ambient!==void 0&&this.updateAmbientLight(t.ambient,e.shared),t.ao!==void 0&&this.updateAo(t.ao,e.shared),t.shadow!==void 0&&this.updateShadow(t.shadow)}createFrame(t,e){}raycast(t,e){super.raycast(t,e)}switchActiveCamera(t){t&&t.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=t,t.objectHelper.visible=!1)}get playCamera(){var t;return((t=this.scene)==null?void 0:t.find(this.data.publish.playCamera))??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let t=0,e=0;this.traverseEntity(i=>{if(!i.visible)return!0;i instanceof Qle&&i.visible&&t<3&&(this.penumbraSizeArrayCache[t]=i.data.penumbraSize??.5,t+=1),i instanceof $le&&i.visible&&t<2&&(this.penumbraSizeArrayCache[3+e]=i.data.penumbraSize??.5,e+=1)})}raycastWithClones(t){let e=[],i=r=>{for(let n of r.children){let s=n.cloner;Ti.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((wc(n)||aU(n)&&this.scene.enableHelpers&&n.objectHelper.visible)&&(t.intersectObject(n,!1,e),vU(n,t,e,!0)),i(n))}};return i(this),e}updateEntity2DByOp(t,e,i,r){var n;(n=this.uiCanvas)==null||n.updateEntity2DByOp(t,e,i,r)}},BXe=class extends OG(oOe,Yle){constructor(t,e,i){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let n=new N(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),s=new N(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),a=new _n(n,s),o=new L2(a,new Xt(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let t in this.gizmos){let e=this.gizmos[t];if(e instanceof L2){let i=this.shadow.camera,r=new N(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),n=new N(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);e.box.set(r,n),e.updateMatrixWorld(!0)}}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e),t.distance!==void 0&&(this.distance=t.distance),t.decay!==void 0&&(this.decay=t.decay),t.shadowRadius!==void 0&&(this.shadow.radius=t.shadowRadius),t.shadowResolution!==void 0&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},FXe=class extends Fn{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(t,e){let i=this.geometry.getAttribute("position");i!==void 0?_G(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,t,e):super.updateEntityBoxSize(t,e)}},zG=class extends Fn{constructor(t,e,i){super(t,e,i),this._shapeId=null,this._context=i}updateState(t,e){super.updateState(t,e),this.updateShape(),this.refreshAttachedCloners(e)}updateShape(){var r;let t={...this.data.geometry.extrusion.shape};for(let n in t)typeof t[n]=="string"&&(t[n]=this._context.shared.getVariable(t[n],[this.uuid,"geometry","extrusion","shape",n]));let e;if(t.type==="Custom"){let n=t.shapeId;if(n!==this._shapeId&&this.detachShape(),n){this._shapeId=n;let s=this._context.scene.find(n);s!=null&&s.data&&(s.attachedPaths.add(this),e=(r=s.geometry.userData)==null?void 0:r.shape),e||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let n;switch(t.type){case"Rectangle":n=SG;break;case"Ellipse":n=wG;break;case"Polygon":n=joe;break;case"Star":n=Woe;break;default:throw new Error(`Unknown shape type: ${t.type}`)}e=n.create({parameters:t}).userData.shape}let i=this.geometry;e&&i.inputs&&(i.inputs.shapeData=e,i.build())}detachShape(){var t;this._shapeId!==null&&((t=this._context.scene.find(this._shapeId))==null||t.attachedPaths.delete(this))}createGeometryDelayed(t){this.geometryCreateDeleyed=t.shared,this.updateShape(),this.refreshAttachedPaths(t)}updateTransformState(t,e){return super.updateTransformState(t,e)}updateGeometryInteractions(t,e){super.updateGeometryInteractions(t,e),this.updateShape()}updateEntityBoxSize(t,e){let i=this.geometry.getAttribute("position");i!==void 0?_G(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,t,e):super.updateEntityBoxSize(t,e)}},GG=class extends LG{constructor(t,e,i){super(t,e,i),this.data=e}},ky=class extends ix($u,F_){constructor(t,e,i){super(),e.type==="Instance"&&typeof t=="string"&&(e=this.transformAssignData(e,i)),this.super_Entity(t,e),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(t,e){let i=nP.getComponentData({scene:e.scene.data,shared:e.shared.data},t.component);if(i){let r,n;for(let s of Bf.rootOverrideProps)t[s]===void 0?(r===void 0&&(r={...t}),r[s]=i.data[s]):(n===void 0&&(n={}),n[s]=t[s],r===void 0&&(r={...t}),r[s]=ep.apply(i.data[s],t[s]));return this.overrideData=n,r}else return{...ts.defaultData,...t,...Oh(ts.defaultData,Bf.rootOverrideProps)}}updateByOp(t,e,i,r){let n;if(this.isInstanceRoot&&!r){if(e=this.transformAssignData(e,i),t.type===0&&t.path.length===0&&this.component)for(let s of Bf.rootOverrideProps)s in t.props&&t.props[s]===void 0&&(n===void 0&&(n={...t,props:{...t.props}}),n.props[s]=this.component.data[s]);else if(t.type===0&&t.path.length>0&&Bf.rootOverrideProps.includes(t.path[0])){let s=t.path[0];n===void 0&&(n={...t,path:[],props:{[s]:e[s]}})}}super.updateByOp(n??t,e,i,r)}updateState(t,e){this.updateState_Entity(t,e)}expandInstanceChildren(t){let e=this.data;if(this.component===void 0){let i=t.scene.find(e.component)??null,r=!1;if(i!==this.oldComponent){if(this.oldComponent){let n=0;for(let s of this.children)if(Ti.is(s))t.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),VG(s),n+=1;else break;this.children.splice(0,n)}r=!0}if(i){let n={};oce(t,[this.uuid],e.overrides,this,i,i,0,r,n);for(let s of this.children)if(Ti.is(s)){let a=s.data;a.type==="Empty"&&a.animations&&s.traverseEntity(o=>{let l=o.dataPatched;if(o instanceof Fn&&l.bones&&l.boneInverses){let c=o.dataPatched;if(c.bones&&c.boneInverses){let h=c.bones.map(f=>t.scene.find(n[f])),u=c.boneInverses.map(f=>new st().fromArray(f)),d=new D5(h,u);o.bind(d,o.bindMatrix)}}else o.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function VG(t){if(t.component){let e=t.component.instances.indexOf(t);e>=0&&t.component.instances.splice(e,1);for(let i of t.children)Ti.is(i)&&VG(i)}}function tQ(t,e,i,r){return t.component===e&&iG(t.identity,r)?t.overrideData===i?2:1:0}function oce(t,e,i,r,n,s,a,o,l){if(a>50)return!1;if(r.component!==n){if(r.component){let h=r.component.instances.indexOf(r);h>=0&&r.component.instances.splice(h,1)}n.instances.find(h=>h===r)||n.instances.push(r),r.component=n}n instanceof ky&&n.isInstanceRoot&&n.expandInstanceChildren(t);let c=0;for(let h of n.children)if(Ti.is(h)){let u=[...e,...typeof h.identity=="string"?[h.identity]:h.identity],d=eP.resolve(i,u,1);d!=null&&!(d instanceof Un)&&(Object.setPrototypeOf(d,Un.prototype),console.error("wrong prototype"));let f=null,p;if(!o){let m=r.children[c];if(f=Ti.is(m)?m:null,f!==null){let g=tQ(f,h,d,u);p=g>=1?f.stateSelection:void 0,g!==2&&(f=null)}if(f===null&&(f=t.scene.findInstance(u)??null,f!==null)){let g=tQ(f,h,d,u);if(p=g>=1?f.stateSelection:void 0,g!==2)f=null;else{let v=f.parent.children.indexOf(f);f.parent.children.splice(v,1),r.children.splice(c,0,f),f.parent===r?v<=c&&console.error("not possible"):(f.parent=r,f.matrixWorldNeedsUpdate=!0,f.resetBBoxNeedsUpdate(),f.updateVisible(),t.pendingDeletes.delete(f))}}}if(f===null){let m=d?ep.apply(h.data,d):h.data;jg.is(m.type)&&(m={...m,type:"Empty"}),f=kf.createEntity(u,m,t),f.overrideData=d,r.add(f),r.children.splice(r.children.length-1,1),r.children.splice(c,0,f),f.updateState(f.data,t),p&&f.changeSelectedState(p,t),t.scene.registerInstanceAndSetUuid(f)}if(f.isBone){let m=f.identity[f.identity.length-1];l[m]=f.uuid}c+=1,oce(t,e,i,f,h,s,a+1,o,l)}if(!o){let h=c;for(;;){let u=r.children[c];if(Ti.is(u))t.pendingDeletes.add(u);else break;c+=1}r.children.splice(h,c-h)}return!0}var kXe=class extends ix(Ise,F_){constructor(t,e){super(),this.super_Entity(t,e),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(t,e){this.updateState_Entity(t,e)}},da=class extends Fn{constructor(t,e,i){super(t,e,i),this.onBeforeRender=r=>{this.uiCanvas.render(r)},this.uiCanvas=new sce(t+"-canvas",e.geometry.width,e.geometry.height,i),this.uiCanvas.promise.then(()=>{this.applyFrame(this.dataPatched.geometry.frame,i.shared)})}updateByPatchedOpGeometry(t,e,i){super.updateByPatchedOpGeometry(t,e,i),t.type===0&&(t.props.frame!==void 0&&this.applyFrame(t.props.frame,i.shared),(t.props.width!==void 0||t.props.height!==void 0)&&this.applySize(t.props,i.shared))}applySize(t,e){let i=(t==null?void 0:t.width)??this.dataPatched.geometry.width,r=(t==null?void 0:t.height)??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:i,height:r}),this.applyGeometryParametersFromFrame(e)}applyFrame(t,e){this.uiCanvas.applyFrame(t),this.applyGeometryParametersFromFrame(e),this.applyMaterialParametersFromFrame({shared:e})}applyGeometryParametersFromFrame(t){var i;let e=this.frame;e&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:e.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:e.cornerRadius,cornerType:0})}),(i=this.localGeometry)==null||i.dispose(),this.localGeometry=RS(this.dataPatched.geometry,t,this.data.flatShading,this))}applyMaterialParametersFromFrame(t){let e=this.frame;if(e){let i=e.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),this.material.reset(this.dataPatched.material,t,!0)}}updateEntity2DByOp(t,e,i,r){this.uiCanvas.updateEntity2DByOp(t,e,i,r),t===this.frameId&&e.type===0&&(e.props.cornerRadius!==void 0?this.applyGeometryParametersFromFrame(r):hr(e.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:r}))}get frame(){return this.uiCanvas.frame}get frameId(){var t;return(t=this.frame)==null?void 0:t.uuid}removeInteractionGeometry(t){super.removeInteractionGeometry(t),this.applySize({},t)}updateGeometryInteractions(t,e){super.updateGeometryInteractions(t,e),this.applySize({width:t.width,height:t.height},e)}},NXe=class{constructor(t,e,i){this.variables=[],this.currentTextureIndex=0;let r=tr,n=new go,s=new Lp;s.position.z=1;let a={passThruTexture:{value:null}},o=h(d(),a),l=new vr(new Vh(2,2),o);n.add(l),this.setDataType=function(f){return r=f,this},this.addVariable=function(f,p,m){let g=this.createShaderMaterial(p),v={name:f,initialValueTexture:m,material:g,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:bi,magFilter:bi};return this.variables.push(v),v},this.setVariableDependencies=function(f,p){f.dependencies=p},this.init=function(){if(i.capabilities.isWebGL2===!1&&i.extensions.has("OES_texture_float")===!1)return"No OES_texture_float support for float textures.";if(i.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let f=0;f<this.variables.length;f++){let p=this.variables[f];p.renderTargets[0]=this.createRenderTarget(t,e,p.wrapS,p.wrapT,p.minFilter,p.magFilter),p.renderTargets[1]=this.createRenderTarget(t,e,p.wrapS,p.wrapT,p.minFilter,p.magFilter),this.renderTexture(p.initialValueTexture,p.renderTargets[0]),this.renderTexture(p.initialValueTexture,p.renderTargets[1]);let m=p.material,g=m.uniforms;if(p.dependencies!==null)for(let v=0;v<p.dependencies.length;v++){let y=p.dependencies[v];if(y.name!==p.name){let x=!1;for(let S=0;S<this.variables.length;S++)if(y.name===this.variables[S].name){x=!0;break}if(!x)return"Variable dependency not found. Variable="+p.name+", dependency="+y.name}g[y.name]={value:null},m.fragmentShader=`
uniform sampler2D `+y.name+`;
`+m.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let f=this.currentTextureIndex,p=this.currentTextureIndex===0?1:0;for(let m=0,g=this.variables.length;m<g;m++){let v=this.variables[m];if(v.dependencies!==null){let y=v.material.uniforms;for(let x=0,S=v.dependencies.length;x<S;x++){let A=v.dependencies[x];y[A.name].value=A.renderTargets[f].texture}}this.doRenderTarget(v.material,v.renderTargets[p])}this.currentTextureIndex=p},this.getCurrentRenderTarget=function(f){return f.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(f){return f.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let f=this.variables;for(let p=0;p<f.length;p++){let m=f[p];m.initialValueTexture&&m.initialValueTexture.dispose();let g=m.renderTargets;for(let v=0;v<g.length;v++)g[v].dispose()}};function c(f){f.defines.resolution="vec2( "+t.toFixed(1)+", "+e.toFixed(1)+" )"}this.addResolutionDefine=c;function h(f,p){p=p||{};let m=new Ri({uniforms:p,vertexShader:u(),fragmentShader:f});return c(m),m}this.createShaderMaterial=h,this.createRenderTarget=function(f,p,m,g,v,y){return f=f||t,p=p||e,m=m||Cr,g=g||Cr,v=v||bi,y=y||bi,new Di(f,p,{wrapS:m,wrapT:g,minFilter:v,magFilter:y,format:Fr,type:r,depthBuffer:!1})},this.createTexture=function(){let f=new Float32Array(t*e*4),p=new Ua(f,t,e,Fr,tr);return p.needsUpdate=!0,p},this.renderTexture=function(f,p){a.passThruTexture.value=f,this.doRenderTarget(o,p),a.passThruTexture.value=null},this.doRenderTarget=function(f,p){let m=i.getRenderTarget(),g=i.xr.enabled,v=i.shadowMap.autoUpdate,y=i.outputEncoding,x=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=Oc,i.toneMapping=Lh,l.material=f,i.setRenderTarget(p),i.render(n,s),l.material=o,i.xr.enabled=g,i.shadowMap.autoUpdate=v,i.outputEncoding=y,i.toneMapping=x,i.setRenderTarget(m)};function u(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function d(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}},Fs=new Ws,yT=new N,UXe=class{constructor(t){let e=t.geometry;if(!e.isBufferGeometry||e.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),e=e.toNonIndexed()),this.geometry=e,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(t){return this.weightAttribute=t?this.geometry.getAttribute(t):null,this}build(){let t=this.positionAttribute,e=this.weightAttribute,i=new Float32Array(t.count/3);for(let n=0;n<t.count;n+=3){let s=1;e&&(s=e.getX(n)+e.getX(n+1)+e.getX(n+2)),Fs.a.fromBufferAttribute(t,n),Fs.b.fromBufferAttribute(t,n+1),Fs.c.fromBufferAttribute(t,n+2),s*=Fs.getArea(),i[n/3]=s}this.distribution=new Float32Array(t.count/3);let r=0;for(let n=0;n<i.length;n++)r+=i[n],this.distribution[n]=r;return this}setRandomGenerator(t){return this.randomFunction=t,this}sample(t,e,i){let r=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*r);return this.sampleFace(n,t,e,i)}binarySearch(t){let e=this.distribution,i=0,r=e.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||e[s-1]<=t&&e[s]>t){n=s;break}else t<e[s]?r=s-1:i=s+1}return n}sampleFace(t,e,i,r){let n=this.randomFunction(),s=this.randomFunction();return n+s>1&&(n=1-n,s=1-s),Fs.a.fromBufferAttribute(this.positionAttribute,t*3),Fs.b.fromBufferAttribute(this.positionAttribute,t*3+1),Fs.c.fromBufferAttribute(this.positionAttribute,t*3+2),e.set(0,0,0).addScaledVector(Fs.a,n).addScaledVector(Fs.b,s).addScaledVector(Fs.c,1-(n+s)),i!==void 0&&Fs.getNormal(i),r!==void 0&&this.colorAttribute!==void 0&&(Fs.a.fromBufferAttribute(this.colorAttribute,t*3),Fs.b.fromBufferAttribute(this.colorAttribute,t*3+1),Fs.c.fromBufferAttribute(this.colorAttribute,t*3+2),yT.set(0,0,0).addScaledVector(Fs.a,n).addScaledVector(Fs.b,s).addScaledVector(Fs.c,1-(n+s)),r.r=yT.x,r.g=yT.y,r.b=yT.z),this}};function zXe(t){let e=new Float32Array(t*t*2);for(let i=0;i<t;i++)for(let r=0;r<t;r++){let n=i*t+r;e[n*2+0]=i/(t-1),e[n*2+1]=r/(t-1)}return e}function GXe(t){let e=Math.ceil(Math.sqrt(t));return Math.max(e,1)}function VXe(t,e){let i=new vr(t.geometry,t.material),r=[],n=[],s=new N,a=new N;i.geometry.index!==null&&(i.geometry=i.geometry.toNonIndexed());let o=new UXe(i).build();for(let h=0;h<e;h++)o.sample(s,a),r.push(s.x,s.y,s.z),n.push(a.x,a.y,a.z);let l=new Float32Array(r),c=new Float32Array(n);return{positions:l,normals:c}}function iQ(t,e){let i=t,r=new Float32Array(4*e*e);for(let s=0;s<e*e;s++)r[4*s]=i[3*s],r[4*s+1]=i[3*s+1],r[4*s+2]=i[3*s+2],r[4*s+3]=0;let n=new Ua(r,e,e,Fr,tr);return n.needsUpdate=!0,n}function HXe({size:t}){let e=new Float32Array(4*t*t);for(let r=0;r<t*t;r++)e[4*r]=r,e[4*r+1]=0,e[4*r+2]=0,e[4*r+3]=0;let i=new Ua(e,t,t,Fr,tr);return i.needsUpdate=!0,i}function jXe(t){let e=new Float32Array(4*t*t);for(let r=0;r<t*t;r++)e[4*r]=0,e[4*r+1]=0,e[4*r+2]=0,e[4*r+3]=0;let i=new Ua(e,t,t,Fr,tr);return i.needsUpdate=!0,i}var WXe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform float uTime;
uniform float uSpeed;     // update speed of the particles
uniform vec3 uWorldOffset;    
uniform vec4 uWorldQuaternion;
uniform float uMaxLifeTime;
uniform vec3 uEmitterSize;
uniform float uFPSRatio;     // 1  for 60 FPS

float random (vec2 st) {
    return fract(sin(dot(st.xy,
        vec2(12.9898,78.233)))*
        43758.5453123);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
    vec3 acceleration = force / mass;
    
    return acceleration;
  }
  

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted
    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided
    float lifeTime = uMaxLifeTime;

    // Calculate the position adjustment based on collision
    //     if (collisionFlag > .5) {  
    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0
    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise
    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);

    // Update position based on collision or normal movement
    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);
    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);

    // EMISSION RATE - BIRTH
    // if (isSpawning == 1.0) {
    // Better Approach to avoid If statement
    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;
    originalPosition = mix(originalPosition, newPosition, isSpawning);
    position = mix(position, originalPosition, isSpawning);;
    timeStart = mix(timeStart, uTime, isSpawning);

    // Calculate timeLeft for life normalization
    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);
    float life_Normalize = timeLeft / lifeTime;

    // Use isActive to blend between the calculated color and black
    vec4 activeColor = vec4(position, life_Normalize);
    // if (isActive == 1.0) {
    gl_FragColor = mix(vec4(0.0), activeColor, isActive);

}
`,XXe=`

    vec3 mod289(vec3 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 mod289(vec4 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 permute(vec4 x) {
        return mod289(((x*34.0)+1.0)*x);
    }
    
    vec4 taylorInvSqrt(vec4 r)
    {
    return 1.79284291400159 - 0.85373472095314 * r;
    }
    
    vec3 fade(vec3 t) {
  return t*t*t*(t*(t*6.0-15.0)+10.0);
}

    float snoise(vec3 v)
    {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
    
    // Permutations
    i = mod289(i);
    vec4 p = permute( permute( permute(
                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
    
    // Gradients: 7x7 points over a square, mapped onto an octahedron.
    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
    
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
    
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
    
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
    
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
    
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
    
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
    
    //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
    
    // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
    }
    
    vec3 snoiseVec3( vec3 x ){
    
      float s  = snoise(vec3( x ));
      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));
      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));
      vec3 c = vec3( s , s1 , s2 );
      return c;
    
    }
    
      
    vec3 curlNoise( vec3 p, float seed){
      p += seed;
      const float e = .1;
      vec3 dx = vec3( e   , 0.0 , 0.0 );
      vec3 dy = vec3( 0.0 , e   , 0.0 );
      vec3 dz = vec3( 0.0 , 0.0 , e   );
    
      vec3 p_x0 = snoiseVec3( p - dx );
      vec3 p_x1 = snoiseVec3( p + dx );
      vec3 p_y0 = snoiseVec3( p - dy );
      vec3 p_y1 = snoiseVec3( p + dy );
      vec3 p_z0 = snoiseVec3( p - dz );
      vec3 p_z1 = snoiseVec3( p + dz );
    
      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;
      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;
      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;
    
      const float divisor = 1.0 / ( 2.0 * e );
      return normalize( vec3( x , y , z ) * divisor );
    
    }


// Classic Perlin noise
float cnoise(vec3 P)
{
  vec3 Pi0 = floor(P); // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P); // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
  return 2.2 * n_xyz;
}


vec3 fbm_vec3(vec3 p, float frequency, float offset)
{
  return vec3(
    cnoise((p+vec3(offset))*frequency),
    cnoise((p+vec3(offset+20.0))*frequency),
    cnoise((p+vec3(offset-30.0))*frequency)
  );
}

`,YXe=`
  #ifdef USE_COLLIDER
    float restitution = max(uBounce * 2., .01); // Energy Loss
    // SPHERE COLLIDER
    // **************************************************************
    #ifdef USE_SPHERE_COLLIDER       
      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
      vec3 radii = uColliderSize;
      // Adjust position relative to collider
      vec3 relPos = position - uColliderPos;
      // Apply rotation of the collider to the relative position
      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
      // Scale relative position by radii (for ellipsoid collision detection)
      vec3 scaledPos = relPos / radii;
      // Calculate ellipsoidal distance
      float dist = length(scaledPos); // Distance in terms of ellipsoid
      
      // Check for collision
      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {
          // Compute the normal at the collision point, accounting for particle size
        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          
        // Compute the normal at the collision point
        vec3 normal = ellipsoidNormal(adjustedPos, radii);
        // Rotate the normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);
        // Reflect the velocity vector off the normal
        velocity = reflect(velocity, normal) * restitution;

        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif

    // BOX COLLIDER or PLANE COLLIDER 
    // **************************************************************
    #ifdef USE_BOX_COLLIDER
      // Box dimensions and repulsion variables
      vec3 boxHalfSize = uColliderSize / 2.0;
      // Convert world position to box's local space
      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
      // Collision detection
      vec3 localDistance = abs(localPos) - boxHalfSize;
      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    

      // Collision Detected
      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      
        // Find the nearest face normal for bounce direction
        vec3 normal;
        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {
            normal = vec3(sign(localPos.x), 0.0, 0.0);
        } else if (localDistance.y > localDistance.z) {
            normal = vec3(0.0, sign(localPos.y), 0.0);
        } else {
            normal = vec3(0.0, 0.0, sign(localPos.z));
        }            
        // Rotate normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);      
        // Reflect velocity and apply repulsion force
        velocity = reflect(velocity, normal) * restitution;
        
        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif      
  #endif      
  // END COLLIDER    
`,qXe=`
  #ifdef USE_ATTRACTOR

      #ifdef USE_SPHERE_COLLIDER      
        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
        vec3 radii = uColliderSize;
        // Adjust position relative to collider
        vec3 relPos = position - uColliderPos;
        // Apply rotation of the collider to the relative position
        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
        // Scale relative position by radii (for ellipsoid collision detection)
        vec3 scaledPos = relPos / radii;
        // Calculate ellipsoidal distance
        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid
        float insideCheck = 1.0;

      #endif


      #ifdef USE_BOX_COLLIDER
        // Box dimensions
        vec3 boxHalfSize = uColliderSize / 2.0;
        // Convert world position to box's local space
        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
        vec3 localDistance = abs(localPos) - boxHalfSize;
        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));
        float insideCheck = particleSize;
      #endif      
  
      // Apply vortex force inside the Helper
      #ifdef USE_FORCE_LOCAL_SPACE
        if (distToSurface <= insideCheck ) {    
            // Define parameters for the attractor field
            #ifdef USE_SPHERE_COLLIDER      
              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed
            #endif

            #ifdef USE_BOX_COLLIDER
              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed
              #endif

            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)
          
            // Use the same radii calculation code as for the collider
            vec3 attractorRadii = uColliderSize;
            // Adjust position relative to attractor center
            vec3 relPos = position - uColliderPos;
            // Apply rotation of the collider to the relative position
            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
            // Scale relative position by radii (for ellipsoid attraction)
            vec3 scaledPos = relPos / attractorRadii;

            // Calculate ellipsoidal distance as attractor radius
            float attractorRadius = length(scaledPos);
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * attractorStrength;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= attractorDamping;
        }
      #else 
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= uForceDamping;
      #endif    
  #endif      
`,KXe=`
  #ifdef USE_VORTEX
    // Box dimensions
    vec3 boxHalfSize = uColliderSize / 2.0;
    // Convert world position to box's local space
    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
    vec3 localDistance = abs(localPos) - boxHalfSize;
    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));

    // Apply vortex force inside the box
    if (distToSurface <= particleSize) {
      float vortexStrength = uForceIntensity;
      vec3 localTopCenter = vec3(0.0, 0., 0.0);

      // Transform the local top center to the world space
      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);
      // Calculate the vector from particle to vortex center
      vec3 vortexVector = vortexCenter - position;

      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector
      // Note: important to add a tiny z component to the up vector to avoid instability
      vec3 upVector = vec3(0.0, 1.0, 0.01);
      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));
      rotationAxis = normalize(rotationAxis);

      // Add rotational component to velocity
      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; 

      vec3 rotationVelocity = rotationAxis * rotationSpeed;
      // velocity += rotationVelocity * 0.005 ;
      velocity = rotationVelocity * 0.005 ;

      // Calculate vortex force
      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;
      // Apply the vortex force to the particle
      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);
      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);
    }
  #endif      
`,QXe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform sampler2D uDirections;     
uniform vec3 uDirectionsAxis;
uniform vec4 uWorldQuaternion;
uniform vec3 uGravity;        
uniform float uNoiseStrength;     // Variation of the noise
uniform float uNoiseScale;        // Scale of the noise
uniform float uNoiseSeed;         // Seed of the noise
uniform float particleSize;
uniform float uSpeed;     // update speed of the particles
uniform float uRandomMassFactor;

// COLLIDER
uniform vec3 uColliderPos;                // Collider Position
uniform vec3 uColliderSize;               // Collider Dimension
uniform vec4 uColliderQuaternion;         // Collider Rotation
uniform vec4 uColliderQuaternionInvert;   // Collider Rotation
uniform float uBounce;                    // Bounce factor
uniform float uForceDamping;
uniform float uForceIntensity;


`+XXe+`
float rand(vec2 co){
    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
 } 
vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
  
  return acceleration;
}

vec4 conjugate(vec4 q) {
  return vec4(q.w, -q.x, -q.y, -q.z);
}

// Function to compute the normal of the ellipsoid at a given point
vec3 ellipsoidNormal(vec3 p, vec3 radii) {
  return normalize(p / (radii * radii));
}

float friction = .3;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    vec3 directions = texture2D( uDirections, vUv ).xyz;    
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float mass = rand(originalPosition.xy) * 0.5 + 0.5;
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active
    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision

    // Randomness Mass
    mass = (1.0 - (uRandomMassFactor * mass));
    
    if (isActive == 1.0) {
      // **************************************************************
      // FORCES NOISES
      // **************************************************************
      #ifdef USE_CURL_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {
          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;
        }
      #endif
      // **************************************************************
      #ifdef USE_SIMPLEX_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {
          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);
        }
      #endif
      // ************************************************************** 
      #ifdef USE_FBM_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      
          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;
        }
      #endif

      // COLLIDER
      ${YXe}
      // ATTRACTION
      ${qXe}  
      // VORTEX
      ${KXe}
    } 
    // End isActive

    // SPAWN BIRTH 
    // **************************************************************
    // if (isSpawning == 1.)
    #ifdef USE_NORMALS
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);
    #else
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    
    #endif
    
    // if (collisionFlag == 0.0)
    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);

    gl_FragColor = vec4(velocity, collisionFlag);
}
`,lce=`

  // Linear Fade In
  float linearFadeIn(float t) {
    return t;
  }


  // linear fade out
  float linearFadeOut(float t) {
    return 1.0 - t;
  }
  
  float linearInOut(float t) {
    return t < 0.5 ? t :  (1.0 - t);  
  }

    // lerp
    float lerp(float a, float b, float t) {
      return a + (b - a) * t;
    }

  // Ease In Out Quart
  float exponentialInOut(float t) {
    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :
    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :
    1.0;
   }

  // constant
  float constant(float t) {
    return 1.0;
  } 
`,$Xe=`

float rand(vec3 co){
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

vec3 applyQuaternionToVector( vec4 q, vec3 v ){
  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
    
  return acceleration;
}
`,JXe=`
vec3 rgb2xyz (in vec3 rgb) {
    float r = rgb.r;
	float g = rgb.g;
	float b = rgb.b;

	r = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);
	g = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);
	b = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);

	float x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);
	float y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);
	float z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);
    
    vec3 xyz = vec3(
        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,
        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,
        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0
    );
    return(xyz);
}

vec3 xyz2lab (in vec3 xyz) {
	float x = xyz.x / 95.047;
	float y = xyz.y / 100.0;
	float z = xyz.z / 108.883;

	x = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);
	y = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);
	z = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);

    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));
    return(lab);
}

vec3 rgb2lab(in vec3 rgb) {
    vec3 xyz = rgb2xyz(rgb);
    vec3 lab = xyz2lab(xyz);
    return(lab);
}

vec3 xyz2rgb (in vec3 xyz) {
	float x = xyz.x / 100.0;
	float y = xyz.y / 100.0;
	float z = xyz.z / 100.0;
	
    
	float r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);
	float g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);
	float b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);

	r = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;
	g = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;
	b = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;

	r = min(max(0.0, r), 1.0);
	g = min(max(0.0, g), 1.0);
	b = min(max(0.0, b), 1.0);

	return(vec3(r, g, b));
}

vec3 lab2xyz (in vec3 lab) {
    float l = lab.x;
	float a = lab.y;
	float b = lab.z;

  	float y = (l + 16.0) / 116.0;
	float x = a / 500.0 + y;
	float z = y - b / 200.0;

	float y2 = pow(y, 3.0);
	float x2 = pow(x, 3.0);
	float z2 = pow(z, 3.0);

  	y = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;
	x = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;
	z = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;

	x *= 95.047;
	y *= 100.0;
	z *= 108.883;

	return(vec3(x, y, z));
}
vec3 lab2rgb (in vec3 lab) {
    vec3 xyz = lab2xyz(lab);
    vec3 rgb = xyz2rgb(xyz);
    return(rgb);
}

`,ZXe=`
  uniform sampler2D uPosition;
  uniform float uSize;
  uniform float uSizeEnd;
  uniform vec3 uWorldOffset;
  uniform vec4 uWorldQuaternion;
  // Billboard Behavior - Currently at Zero, but we can change that
  uniform float uRotation;
  uniform float uRotationEnd;
  uniform vec2 center;

  // Randomness
  uniform float uRandScaleFactor;
  uniform float uRandRotationFactor;

  attribute vec2 ref;

  varying float v_LifeLeft;    // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  ${$Xe}
  ${lce}
`,eYe=({easeSize:t="linearFadeOut"})=>`
  vUv = uv;  
  vRef = ref;
  // Normalized LifeTime 1 to 0
  float lifeLeft = texture2D(uPosition, ref).w;
  v_LifeLeft = lifeLeft;
  // Position From DataTexture Simulation
  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;
  // Apply World Quaternion
  pos = applyQuaternionToVector(uWorldQuaternion, pos);  
            
  #ifdef  USE_SIZE_END
    // Scaled Over Time
    float t = 1. - lifeLeft;
    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd
    vec3 scaledPosition = position * vec3(currentSize);
  #else
    // Change Size Behavior over LifeTime
    float easeSize = ${t}(1. - lifeLeft);
    // Scaled Over Time
    vec3 scaledPosition = position * vec3(uSize * easeSize);
  #endif

  // Billboard Behavior
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    
  // Randomness 
  float randRef = rand(ref);
  scale *= (1.0 - (uRandScaleFactor * randRef));
  // Rotation
  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);
  float originalRotation = (1.0 - uRotation) * 2.0 * PI;
  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;
  // OverTime
  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);

  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;
  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;
  
  mat4 instanceMatrix = mat4(
    vec4(1.0, 0.0, 0.0, 0.0),
    vec4(0.0, 1.0, 0.0, 0.0),
    vec4(0.0, 0.0, 1.0, 0.0),
    vec4(pos.x, pos.y, pos.z, 1.0)
  );  

  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  mvPosition.xy += rotatedPosition;
  gl_Position = projectionMatrix  * mvPosition;   
`,tYe=`
  uniform vec4 uColor;                // start color
  uniform vec4 uColor2;               // end color
  uniform sampler2D uTexture;         // texture
  varying float v_LifeLeft;   // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  float random(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
  }
  `+lce+`  
  ${JXe}

`,iYe=({easeOpacity:t="linearFadeOut"})=>`  
  // if Particle is dead, hide it
  if (v_LifeLeft <= 0.005 ) {
    discard;
  }

  #ifdef USE_RANDOM_COLORING
    float randVal = random(vRef); // Generate a random value based on the reference
    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors
  #else
    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);
  #endif

  // Opacity over Life Time
  float finalAlpha = ${t}(1. - v_LifeLeft);  
  vec4 textureColor = texture2D(uTexture, vUv).rgba; 
  finalColor = textureColor.rgb * color.rgb;
  finalAlpha = color.a * textureColor.a * finalAlpha;
  
  gl_FragColor = vec4(finalColor, finalAlpha);     

`,rYe=class extends Ri{constructor(t,e){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(t,e),this.context=e}reset(){}init(t,e){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=t.ease,this.easeSize=t.easeSize,this.layers=[],Jn.startContext(Jn.globalContext),this.lightLayer=new ph(0,"",{...ys.defaultData("light","phong"),visible:!1},new TG,{},e.shared),Jn.endContext(Jn.globalContext),this.build()}updateState(t){t.coloring!==void 0&&(this.isColoringRandom=t.coloring==="random"),t.color!==void 0&&(t.color instanceof Array?this.uniforms.uColor.value=t.color:this.uniforms.uColor.value=this.context.shared.color(t.color)),t.color2!==void 0&&(t.color2 instanceof Array?this.uniforms.uColor2.value=t.color2:this.uniforms.uColor2.value=this.context.shared.color(t.color2)),t.size!==void 0&&(this.uniforms.uSize.value=t.size[0],this.uniforms.uSizeEnd.value=t.size[1],t.size[0]!==t.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),t.ease!==void 0&&(this.easeOpacity=t.ease,this.build()),t.easeSize!==void 0&&(this.easeSize=t.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(t){this.build(),t.defines=this.defines,t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader}build(){let t=new ale;return t.needsJitter=this.needsJitter,t.addFragmentParsCode(OHe),t.buildShader("vertex",this.fragment),t.buildShader("fragment",this.fragment),t.addFragmentFinalCode(BHe),this.isColoringRandom&&t.define("USE_RANDOM_COLORING"),this.useSizeEnd&&t.define("USE_SIZE_END"),t.addVertexParsCode(ZXe),t.addFragmentParsCode(tYe),t.addVertexFinalCode(eYe({easeSize:this.easeSize})),t.addFragmentFinalCode(iYe({easeOpacity:this.easeOpacity})),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms={...t.uniforms,...this.uniforms},this.extensions=t.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach(t=>t.dispose()),super.dispose()}},FO=class{constructor(t,e,i,r){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=t,this.type=i,this.textureSize=GXe(e);let n=1;this.targetMesh=(r==null?void 0:r.type)==="Mesh"&&r?r:this.getMesh(i,n);let{positions:s,dataTexture:a,dataTextureNormals:o}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,n));this.positionsTexture=a,this.positionsAttribute=s,this.directionsTexture=o}createPositions(t,e){let{positions:i,normals:r}=VXe(e,t*t),n=iQ(i,t),s=iQ(r,t);return{dataTexture:n,positions:i,dataTextureNormals:s}}getMesh(t,e){let i=null;switch(t){case"SphereEmitterShape":{i=new Ty(e*.5,32,32);break}case"TorusEmitterShape":{i=new Vse(e*.5,.3,15,40);break}case"ConeEmitterShape":{i=new O5(e,e,15);break}case"BoxEmitterShape":{i=new Bc(e,e,e);break}case"PlaneEmitterShape":{i=new Vh(e,e),i.rotateX(-Math.PI/2);break}case"MeshEmitterShape":{i=new Ty(e,32,32);break}default:{i=new Ty(e,32,32);break}}return new vr(i,new pd({color:16711680}))}applyToShader(t,e){this.size=new N().fromArray(e.size),t.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function kv(t){let e={...t},i=q2.defaultData;e.forceFieldObjectId&&(e.colliderEntityId=e.forceFieldObjectId);let r={...i.shape,...e.shape},n={...i.renderMaterial,...e.renderMaterial};return{...i,...e,shape:r,renderMaterial:n}}var nYe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU

uniform sampler2D uIndex; // Texture with corresponding index
uniform float uLastIndexEmitted; // Last emitted index
uniform float uParticlesToEmit; // Number of particles to emit on that frame
uniform float uTime;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    float particleIndex = texture(uIndex, vUv).x;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;


    // ********** Detect Colision to Create a flag and use it in position **********
    // We are doing this here, so

    // ********** Emit Particles **********
    // X = isSpawning 0.0 or 1.0
    // Y = isActive 0.0 or 1.0
    // Check if the vertex index is between the first value and the last value
    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {
    //     // Emit a particle by writing 1 to the red channel of the color output
    //     // r: 1. == emit the particle
    //     // g: 1. == particle is now active
    //     timeStart = uTime;
    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);
    // } else {
    //     // The Particle is either already emitted or not in the range of the particles to emit
    //     // Do not emit a particle by writing 0 to the red channel of the color output        
    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);
    // }
    // Determine if the particle is within the emission range
    float emitLowerBound = step(uLastIndexEmitted, particleIndex);
    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);
    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise

    // Set timeStart and color
    timeStart = mix(timeStart, uTime, emitParticle);
    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);


}
`,kO=10,sYe=class extends Ji{constructor(t,e){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new iOe,this.currentWorldPosition=new N,this.systemQuaternion=new ri,this.worldGravity=new N(0,0,0),this.directionAxis=new N(0,0,0),this.colliderV3=new N(0,0,0),this.colliderQuaternion=new ri(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=t,this.system=e,this.shared=e.context.shared;let i=e.data;this.material=new rYe(i.renderMaterial,e.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new N(0,0,0)},uEmissionData:{value:new N(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new N(0,0,0)},uWorldQuaternion:{value:new si(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(t,e){let i=e.data;if(typeof e=="string"){let r=this.shared.image(e),n=new Kr(r.img);n.needsUpdate=!0,t.uTexture.value=n;return}if(typeof i!="string"){let r=new Image;r.onload=()=>{let a=new Kr(r);a.needsUpdate=!0,t.uTexture.value=a};let n=new Blob([i],{type:"image/*"}),s=URL.createObjectURL(n);r.src=s}}updateGeometryAttributes(t,e){var r;let i=zXe(e);!((r=this.emitterShape)!=null&&r.positionsAttribute)||t.geometry.setAttribute("ref",new fS(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let t=this.system;t.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),t.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(t,e){var a;if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset){this.reset();return}this.applyWorldSpace(),this.globalTime=t,this.positionSimRT.material.uniforms.uTime.value=t,this.emissionRateSimRT.material.uniforms.uTime.value=t;let i=1e3/e,r=this.targetFPS/i,n=this.previousRatio+(r-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=n,this.previousRatio=n;let s=this.isEmitting?this.GoEmitSomeParticles(t,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=(a=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT))==null?void 0:a.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let t=this.system.colliderEntities[0],e=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(t.destroyedInAction&&e&&this.init(kv({...this.system.data,colliderEntityId:null})),!t||t.destroyedInAction)return;t.getWorldPosition(this.colliderV3),this.colliderV3.y===0&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let i=t.data.size;this.colliderV3.fromArray(i),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),t.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(t){!this.velocitySimRT||!this.positionSimRT||(t.renderMaterial&&this.updateMaterialState(t.renderMaterial),this.updateParticleState(t))}updateVariableState(t,e){if(!this.velocitySimRT||!this.positionSimRT)return;e[2]==="size"&&this.material.updateState({size:[t,this.material.uniforms.uSizeEnd.value]}),e[2]==="sizeEnd"&&this.material.updateState({size:[this.material.uniforms.uSize.value,t]});let i=(r,n)=>{let s=[...this.system.data.shape.size];s[r]=n,this.updateParticleState({shape:{...this.system.data.shape,size:s}})};e[2]==="shape_size_0"&&i(0,t),e[2]==="shape_size_1"&&i(1,t),e[2]==="shape_size_2"&&i(2,t),e[2]==="speed"&&(this.velocitySimRT.material.uniforms.uSpeed.value=t/kO),e[2]==="gravity"&&this.worldGravity.set(0,t/100,0),e[2]==="noiseStrength"&&(this.noiseStrength=t,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),e[2]==="noiseScale"&&(this.noiseScale=t,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),e[2]==="direction_x"&&(this.directionAxis=this.getDirectionAxis([Number(t),this.system.data.direction[1],this.system.data.direction[2]])),e[2]==="direction_y"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(t),this.system.data.direction[2]])),e[2]==="direction_z"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(t)]))}updateMaterialState(t){this.material.updateState({...t,size:t.size?[Number(this.shared.getVariable(t.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(t.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),t.texture&&(this.setTexture(this.material.uniforms,t.texture),this.material.needsUpdate=!0)}updateParticleState(t){var e,i,r;if(!(!this.positionSimRT||!this.velocitySimRT)){if(this.shouldReInitGPUCompute(t)&&this.init(kv(this.system.data)),t.life!==void 0&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=t.life),t.speed!==void 0&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(t.speed,[this.uuid,"particles","speed"]))/kO),t.collisionBounce!==void 0&&(this.velocitySimRT.material.uniforms.uBounce.value=t.collisionBounce),t.noiseStrength!==void 0&&(this.noiseStrength=Number(this.shared.getVariable(t.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),t.noiseScale!==void 0&&(this.noiseScale=Number(this.shared.getVariable(t.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),t.noiseSeed!==void 0&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=t.noiseSeed),t.randomMass!==void 0&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=t.randomMass),((e=t.renderMaterial)==null?void 0:e.size)!==void 0){let n=this.shared.getVariable(t.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(n)}if(((i=t.renderMaterial)==null?void 0:i.spriteRotation)!==void 0&&(this.material.uniforms.uRotation.value=t.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=t.renderMaterial.spriteRotation[1]),t.shape!==void 0){let n=t.shape.size??this.system.data.shape.size,s=[Number(this.shared.getVariable(n[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(n[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(n[2],[this.uuid,"particles","shape_size_2"]))],a={...kv(this.system.data).shape,size:s};(r=this.emitterShape)==null||r.applyToShader(this.positionSimRT.material.uniforms,a)}if(t.gravity!==void 0&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),t.direction!==void 0){let n=this.getDirectionFromVariable(t.direction);this.directionAxis=this.getDirectionAxis(n),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}t.randomRotation!==void 0&&(this.material.uniforms.uRandRotationFactor.value=t.randomRotation),t.randomScale!==void 0&&(this.material.uniforms.uRandScaleFactor.value=t.randomScale)}}updateForceFieldParameters(t){!this.velocitySimRT||(t.forceIntensity!==void 0&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=t.forceIntensity),t.forceDambing!==void 0&&(this.velocitySimRT.material.uniforms.uForceDamping.value=t.forceDambing))}getDirectionAxis(t){let e=[Number(t[0])*Et.DEG2RAD,Number(t[1])*Et.DEG2RAD,Number(t[2])*Et.DEG2RAD],i=new Zn(e[0],e[1],e[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(t){let{birthRatePerSec:e,rootObjectType:i,colliderEntityId:r,shape:n,emitTimeDuration:s,emitTimeCycle:a,life:o,directionMode:l,noiseType:c}=t;return e!==void 0||i!==void 0||r||r===null||a!==void 0||n!==void 0||o!==void 0||s!==void 0||l!==void 0||c!==void 0}init(t){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:t.birthRatePerSec,particleMaxLifeTime:t.life,loopDuration:t.emitTimeCycle==="infinity"?0:t.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(t.shape,this.particlesAmount);let e=setInterval(()=>{if(this.emitterShape)if(isNaN(this.emitterShape.positionsTexture.source.data.data[0])){this.init(t);return}else clearInterval(e)},100);if(!this.emitterShape)return;let i=new NXe(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),r=this.updateSimulationDefinition(t),n=i.addVariable("uCurrentPosition",r+WXe,this.emitterShape.positionsTexture),s=i.addVariable("uCurrentVelocity",r+QXe,this.emitterShape.directionsTexture),a=i.addVariable("uCurrentEmissionRate",nYe,jXe(this.emitterShape.textureSize));i.setVariableDependencies(n,[n,s,a]),i.setVariableDependencies(s,[n,s,a]),i.setVariableDependencies(a,[n,s,a]);let o=HXe({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new N(0,0,0)},uWorldQuaternion:{value:new si(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:t.life},uEmitterSize:{value:new N(Number(this.shared.getVariable(t.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};n.material.uniforms=l;let c=this.getDirectionFromVariable(t.direction);this.directionAxis=this.getDirectionAxis(c),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(t.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(t.noiseScale,[this.uuid,"particles","noiseScale"]));let h=t.colliderEntityId&&this.system.getColliderData(t.colliderEntityId),u={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new si(0,0,0,1)},uColliderPos:{value:new N(0,0,0)},uColliderSize:{value:new N(0,0,0)},uForceIntensity:{value:h?h.forceIntensity:0},uForceDamping:{value:h?h.forceDambing:0},uColliderQuaternion:{value:new si(0,0,0,1)},uColliderQuaternionInvert:{value:new si(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:t.noiseSeed},uRandomMassFactor:{value:t.randomMass},uBounce:{value:t.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(t.speed,[this.uuid,"particles","speed"]))/kO}};s.material.uniforms=u;let d={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};a.material.uniforms=d;let f=[Number(this.shared.getVariable(t.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t.shape.size[2],[this.uuid,"particles","shape_size_2"]))],p={...kv(this.system.data).shape,size:f};this.emitterShape.applyToShader(n.material.uniforms,p),i.init(),this.gpuCompute=i,this.positionSimRT=n,this.velocitySimRT=s,this.emissionRateSimRT=a,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(t){let e=Number(this.shared.getVariable(t[0],[this.uuid,"particles","direction_x"])),i=Number(this.shared.getVariable(t[1],[this.uuid,"particles","direction_y"])),r=Number(this.shared.getVariable(t[2],[this.uuid,"particles","direction_z"]));return[e,i,r]}updateSimulationDefinition(t){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,t.colliderEntityId&&this.system.colliderEntities.length>0){let i=this.system.getColliderData(t.colliderEntityId);switch(i==null?void 0:i.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0;break}let r=i==null?void 0:i.colliderType;r==="sphere"&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),r==="box"&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),(i==null?void 0:i.forceRange)==="helper"&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}t.directionMode==="normals"&&(this.simFeaturesDefinition.USE_NORMALS=!0),t.noiseType==="curl"&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),t.noiseType==="simplex"&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),t.noiseType==="fbm"&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let e="";for(let[i,r]of Object.entries(this.simFeaturesDefinition))r&&(e+=`#define ${i}
`);return e}createShape(t,e){this.emitterShape&&this.emitterShape.dispose();let i=new N(Number(this.shared.getVariable(t.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t.size[2],[this.uuid,"particles","shape_size_2"])));if(t.type==="MeshEmitterShape"){let r=null;return this.system.context.scene.traverseEntity(n=>{n.uuid===t.fromMeshId&&(r=n)}),r?new FO(i,e,t.type,r):new FO(i,e,"SphereEmitterShape")}else return new FO(i,e,t.type)}createPrimaryEmitter(t){let e,i=t*t;return e=new m3e(new Vh(1,1,1),this.material,i),this.updateGeometryAttributes(e,t),this.material.needsUpdate=!0,e.onBeforeRender=()=>{this.applyWorldSpace()},e}getMaxParticlesAmount({birthRatePerSecond:t,particleMaxLifeTime:e,loopDuration:i=0}){return Math.ceil(t*(e+i))}dispose(){var t,e,i;!this.gpuCompute||((e=(t=this.rootObject)==null?void 0:t.parent)==null||e.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),(i=this.emitterShape)==null||i.dispose())}GoEmitSomeParticles(t,e){let i=t-this.lastEmitTime,r=1/e;if(i>=r){let n=Math.max(1,Math.floor(i/r));return this.lastEmitTime=t,this.emittedParticlesAmount+n>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=n,n}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(kv(this.system.data))}startEmitting(t){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=t}stopEmitting(){this.isEmitting=!1}},xw=class extends ja{constructor(t,e,i){super(t,e),this.type="ParticleSystem",this.geometry=new Nt,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=r=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(r))},this.context=i,this.data={...e,...kv(e)},this.geometry.setAttribute("position",new bt([],3)),this.material=new pd({colorWrite:!1}),this.frustumCulled=!1}init(t){this.renderer=t,this.emitter=new sYe(t,this),this.add(this.emitter),this.updateParticleState(this.data)}update(t){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=t,this.stopped||(this.currentLoopTime+=t);let e=this.data.emitTimeCycle==="one_time";if((this.data.emitTimeCycle==="loop"||e)&&this.currentLoopTime>this.data.emitTimeDuration*1e3&&(this.stopped||(this.stop(),e||this.start(this.data.emitTimeDelay*1e3))),this.emitter&&this.started){let i=this.actualTime/1e3;this.emitter.update(i,t)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(t){return this.colliderEntities.some(e=>e.identity===t)}getColliderData(t){let e=this.colliderEntities.find(i=>i.identity===t);return e?e.data:null}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),hr(t.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...As.drop(t,1).props}}),hr(t.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...As.drop(t,1).props}})}updateState(t,e){super.updateState(t,e),this.updateParticleState(t)}updateParticleState(t){if(this.emitter){if(t.colliderEntityId!==void 0&&t.colliderEntityId!==null){let e=this.context.scene.find(t.colliderEntityId);this.colliderEntities=e?[e]:[]}t.colliderEntityId===null&&(this.colliderEntities=[]),this.emitter.updateState(t),t.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(t){!this.emitter||(this.emitter.updateForceFieldParameters(t),this.stop(),this.start())}start(t=0){var e;if(this.currentLoopTime=0,t){this.timeoutId=window.setTimeout(()=>{this.start(0)},t);return}this.started=!0,this.stopped=!1,this.isFrozen=!1,(e=this.emitter)==null||e.startEmitting(this.actualTime/1e3)}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){var t;this.stopped=!0,this.currentLoopTime=0,(t=this.emitter)==null||t.stopEmitting(),clearTimeout(this.timeoutId)}reset(){var t;this.started=!1,this.stopped=!1,(t=this.emitter)==null||t.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function aYe(){try{let t=window.location.href;if(t.includes("reducesubdiv=")){let e=t.indexOf("reducesubdiv=")+13;return parseInt(t.slice(e,e+1))}}catch{}}var NO=aYe();function oYe(t,e,i){var n;NO!==void 0&&(((n=e==null?void 0:e.geometry)==null?void 0:n.subdivisions)??0)>NO&&(console.log("reducing subdivisions",e.name,e.geometry.subdivisions),e.geometry.subdivisions=NO);let r;return e.geometry.type==="TextGeometry"?new LG(t,e,i):e.geometry.type==="InputGeometry"?new GG(t,e,i):(e.geometry.type==="SubdivGeometry"?r=new IS(t,e,i):e.geometry.type==="PathGeometry"?r=new zG(t,e,i):e.geometry.type==="VectorGeometry"?r=new FXe(t,e,i):e.geometry.type==="BooleanGeometry"?r=new Yg(t,e,i):e.geometry.type==="ShapeBlendGeometry"?r=new qg(t,e,i):e.geometry.type==="UIGeometry"?r=new da(t,e,i):r=new Fn(t,e,i),r)}function HG(t,e,i){return console.assert(e.type!==void 0),e.type==="Mesh"?oYe(t,e,i):e.type==="Empty"?new Fy(t,e):e.type==="Particle"?new xw(t,e,i):e.type==="ParticleCollider"?new yw(t,e,i):e.type==="Splat"?new Fy(t,e):e.type==="Bone"?new kXe(t,e):e.type==="Page"?new ws(t,e,i):e.type==="PointLight"?new BXe(t,e,i):e.type==="SpotLight"?new $le(t,e,i):e.type==="DirectionalLight"?new Qle(t,e,i):e.type==="Component"||e.type==="Instance"?new ky(t,e,i):jg.is(e.type)?new ga(t,e):(console.error(e),new Fy(t,e))}kf.createEntity=HG;function lYe(t,e,i){let r=HG(t.identity,e,i),n=t.children,s=t.attachedPaths,a=t.parent,o=t.component,l=t.instances,c=t.overrideData,h=t.uuid,u=t.stateSelection;t.dispose();for(let d of Object.keys(t))delete t[d];Object.setPrototypeOf(t,Object.getPrototypeOf(r));for(let d of Object.keys(r))t[d]=r[d];t.children=[...t.children,...n],t.attachedPaths=s,t.parent=a,t.component=o,t.instances=l,t.uuid=h,t.overrideData=c,t.updateState(t.data,i),u&&t.changeSelectedState(u,i),t.resetBBoxNeedsUpdate()}kf.changeEntityProptotype=lYe;kf.Cloner=Ol;function cYe(t,e,i,r){t.updateByOp(e,i,r,!1)}var Fm=5,bw=new Nt;bw.setAttribute("position",new Yt(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),3));var xC=class extends X3e{constructor(t){super({...t,depthTest:!1,depthWrite:!1,glslVersion:Lk,vertexShader:`
				precision highp float;
				in vec3 position;
				void main() {
					gl_Position = vec4(position, 1);
				}
			`})}customProgramCacheKey(){return""}};function hYe(){return{shapeInput:()=>`
			const float posRowCoord = ${.5/Fm};  // vec4: px py pz opType
			const float quatRowCoord = ${1.5/Fm};  // vec4: qx qy qz qw
			const float param1RowCoord = ${2.5/Fm};// vec4: type param1 param2 param3
			const float param2RowCoord = ${3.5/Fm};// vec4: blendRange roundness scale param4
			const float colorRowCoord = ${4.5/Fm}; // vec4: r g b a
			uniform sampler2D shapesDataTexture;
			vec4 shapePos(float iin) { 
				vec4 r = texture(shapesDataTexture, vec2(iin, posRowCoord));
				return r;
			}
			vec4 shapeQuat(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, quatRowCoord));
				return r;
			}
			vec4 shapeParams1(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param1RowCoord));
				return r;
			}
			vec4 shapeParams2(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param2RowCoord));
				return r;
			}
			vec4 shapeColor(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, colorRowCoord));
				return r;
			}
		`,getxyzi:`
			// this code must complement lookup
			float xi = mod(gl_FragCoord.x - 0.5, VOXEL_RESOLUTION);
			float yi = mod(gl_FragCoord.y - 0.5, VOXEL_RESOLUTION);
			float zi = floor((gl_FragCoord.x - 0.5) * INV_VOXEL_RESOLUTION) + floor((gl_FragCoord.y - 0.5) * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
		`,lookup:`
			uniform sampler2D potentialPassTexture;
			uniform sampler2D voxelPassTexture; // includes normal (in xyz) and key (in w)
			
			// box or marching cube lookup value in value texture, integer box coord inputs
			// this code must complement codebits.getxyzi
			vec4 look(float xi, float yi, float zi, sampler2D rt) {// range 0 .. numv etc
				vec2 uv = vec2(
					mod(zi, Z_LAYERS_PER_ROW) + (xi + 0.5) / VOXEL_RESOLUTION,
					floor(zi / Z_LAYERS_PER_ROW) + (yi + 0.5) / VOXEL_RESOLUTION
				); 
				uv /= Z_LAYERS_PER_ROW;
				return texture(rt, uv);
			}
		`,getpart:`
			float getpart(inout float a, float b) {
				float t = floor(a/b);
				float r = a - t*b;
				a = t;
				return r;
			}
		`,triTable:new Float32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,1,8,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,9,9,2,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,2,8,10,2,8,9,10,-1,-1,-1,-1,-1,-1,-1,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,0,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,1,11,9,1,11,8,9,-1,-1,-1,-1,-1,-1,-1,1,10,3,3,10,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,10,0,10,8,0,10,11,8,-1,-1,-1,-1,-1,-1,-1,0,9,3,9,11,3,9,10,11,-1,-1,-1,-1,-1,-1,-1,10,8,9,11,8,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,4,3,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,4,1,7,4,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,2,1,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,3,4,0,3,10,2,1,-1,-1,-1,-1,-1,-1,-1,10,2,9,2,0,9,7,4,8,-1,-1,-1,-1,-1,-1,-1,9,10,2,7,9,2,3,7,2,4,9,7,-1,-1,-1,-1,7,4,8,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,11,4,2,11,4,0,2,-1,-1,-1,-1,-1,-1,-1,1,0,9,7,4,8,11,3,2,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,9,2,11,9,1,2,9,-1,-1,-1,-1,1,10,3,10,11,3,4,8,7,-1,-1,-1,-1,-1,-1,-1,10,11,1,11,4,1,4,0,1,4,11,7,-1,-1,-1,-1,8,7,4,11,0,9,10,11,9,3,0,11,-1,-1,-1,-1,11,7,4,9,11,4,10,11,9,-1,-1,-1,-1,-1,-1,-1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,9,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,0,0,5,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,8,5,3,8,5,1,3,-1,-1,-1,-1,-1,-1,-1,10,2,1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,10,2,1,5,9,4,-1,-1,-1,-1,-1,-1,-1,10,2,5,2,4,5,2,0,4,-1,-1,-1,-1,-1,-1,-1,5,10,2,5,2,3,4,5,3,8,4,3,-1,-1,-1,-1,4,5,9,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,11,8,0,5,9,4,-1,-1,-1,-1,-1,-1,-1,4,5,0,5,1,0,11,3,2,-1,-1,-1,-1,-1,-1,-1,5,1,2,8,5,2,11,8,2,5,8,4,-1,-1,-1,-1,11,3,10,3,1,10,4,5,9,-1,-1,-1,-1,-1,-1,-1,5,9,4,1,8,0,1,10,8,10,11,8,-1,-1,-1,-1,0,4,5,11,0,5,10,11,5,3,0,11,-1,-1,-1,-1,8,4,5,10,8,5,11,8,10,-1,-1,-1,-1,-1,-1,-1,8,7,9,9,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,9,3,5,9,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,7,0,7,1,0,7,5,1,-1,-1,-1,-1,-1,-1,-1,3,5,1,7,5,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,9,7,5,9,2,1,10,-1,-1,-1,-1,-1,-1,-1,2,1,10,0,5,9,0,3,5,3,7,5,-1,-1,-1,-1,2,0,8,5,2,8,7,5,8,2,5,10,-1,-1,-1,-1,5,10,2,3,5,2,7,5,3,-1,-1,-1,-1,-1,-1,-1,5,9,7,9,8,7,2,11,3,-1,-1,-1,-1,-1,-1,-1,7,5,9,2,7,9,0,2,9,11,7,2,-1,-1,-1,-1,11,3,2,8,1,0,8,7,1,7,5,1,-1,-1,-1,-1,1,2,11,7,1,11,5,1,7,-1,-1,-1,-1,-1,-1,-1,8,5,9,7,5,8,3,1,10,11,3,10,-1,-1,-1,-1,0,7,5,9,0,5,0,11,7,10,0,1,0,10,11,-1,0,10,11,3,0,11,0,5,10,7,0,8,0,7,5,-1,5,10,11,5,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,9,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,8,9,1,6,10,5,-1,-1,-1,-1,-1,-1,-1,5,6,1,1,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,1,6,2,1,8,0,3,-1,-1,-1,-1,-1,-1,-1,5,6,9,6,0,9,6,2,0,-1,-1,-1,-1,-1,-1,-1,8,9,5,2,8,5,6,2,5,8,2,3,-1,-1,-1,-1,11,3,2,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,11,0,2,11,5,6,10,-1,-1,-1,-1,-1,-1,-1,9,1,0,11,3,2,6,10,5,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,9,1,2,11,9,11,8,9,-1,-1,-1,-1,11,3,6,3,5,6,3,1,5,-1,-1,-1,-1,-1,-1,-1,11,8,0,5,11,0,1,5,0,6,11,5,-1,-1,-1,-1,6,11,3,6,3,0,5,6,0,9,5,0,-1,-1,-1,-1,9,5,6,11,9,6,8,9,11,-1,-1,-1,-1,-1,-1,-1,6,10,5,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,3,7,4,10,5,6,-1,-1,-1,-1,-1,-1,-1,0,9,1,6,10,5,7,4,8,-1,-1,-1,-1,-1,-1,-1,5,6,10,7,9,1,3,7,1,4,9,7,-1,-1,-1,-1,2,1,6,1,5,6,8,7,4,-1,-1,-1,-1,-1,-1,-1,5,2,1,6,2,5,4,0,3,7,4,3,-1,-1,-1,-1,7,4,8,5,0,9,5,6,0,6,2,0,-1,-1,-1,-1,9,3,7,4,9,7,9,2,3,6,9,5,9,6,2,-1,2,11,3,4,8,7,5,6,10,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,7,4,0,2,4,11,7,2,-1,-1,-1,-1,9,1,0,8,7,4,11,3,2,6,10,5,-1,-1,-1,-1,1,2,9,2,11,9,11,4,9,4,11,7,6,10,5,-1,7,4,8,5,11,3,1,5,3,6,11,5,-1,-1,-1,-1,11,1,5,6,11,5,11,0,1,4,11,7,11,4,0,-1,9,5,0,5,6,0,6,3,0,3,6,11,7,4,8,-1,9,5,6,11,9,6,9,7,4,9,11,7,-1,-1,-1,-1,9,4,10,10,4,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,4,10,9,4,3,8,0,-1,-1,-1,-1,-1,-1,-1,1,0,10,0,6,10,0,4,6,-1,-1,-1,-1,-1,-1,-1,1,3,8,6,1,8,4,6,8,10,1,6,-1,-1,-1,-1,9,4,1,4,2,1,4,6,2,-1,-1,-1,-1,-1,-1,-1,8,0,3,9,2,1,9,4,2,4,6,2,-1,-1,-1,-1,4,2,0,6,2,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,4,2,8,6,2,4,-1,-1,-1,-1,-1,-1,-1,9,4,10,4,6,10,3,2,11,-1,-1,-1,-1,-1,-1,-1,2,8,0,11,8,2,10,9,4,6,10,4,-1,-1,-1,-1,2,11,3,6,1,0,4,6,0,10,1,6,-1,-1,-1,-1,1,4,6,10,1,6,1,8,4,11,1,2,1,11,8,-1,4,6,9,6,3,9,3,1,9,3,6,11,-1,-1,-1,-1,1,11,8,0,1,8,1,6,11,4,1,9,1,4,6,-1,6,11,3,0,6,3,4,6,0,-1,-1,-1,-1,-1,-1,-1,8,4,6,8,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,7,10,8,7,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,7,0,7,10,0,10,9,0,10,7,6,-1,-1,-1,-1,7,6,10,7,10,1,8,7,1,0,8,1,-1,-1,-1,-1,7,6,10,1,7,10,3,7,1,-1,-1,-1,-1,-1,-1,-1,6,2,1,8,6,1,9,8,1,7,6,8,-1,-1,-1,-1,9,6,2,1,9,2,9,7,6,3,9,0,9,3,7,-1,0,8,7,6,0,7,2,0,6,-1,-1,-1,-1,-1,-1,-1,2,3,7,2,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,3,2,8,6,10,9,8,10,7,6,8,-1,-1,-1,-1,7,0,2,11,7,2,7,9,0,10,7,6,7,10,9,-1,0,8,1,8,7,1,7,10,1,10,7,6,11,3,2,-1,1,2,11,7,1,11,1,6,10,1,7,6,-1,-1,-1,-1,6,9,8,7,6,8,6,1,9,3,6,11,6,3,1,-1,1,9,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,6,0,7,0,11,3,0,6,11,-1,-1,-1,-1,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,8,1,3,8,6,7,11,-1,-1,-1,-1,-1,-1,-1,2,1,10,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,8,0,3,7,11,6,-1,-1,-1,-1,-1,-1,-1,0,9,2,9,10,2,7,11,6,-1,-1,-1,-1,-1,-1,-1,7,11,6,3,10,2,3,8,10,8,9,10,-1,-1,-1,-1,3,2,7,7,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,7,0,6,7,0,2,6,-1,-1,-1,-1,-1,-1,-1,6,7,2,7,3,2,9,1,0,-1,-1,-1,-1,-1,-1,-1,2,6,1,6,8,1,8,9,1,6,7,8,-1,-1,-1,-1,6,7,10,7,1,10,7,3,1,-1,-1,-1,-1,-1,-1,-1,6,7,10,10,7,1,7,8,1,8,0,1,-1,-1,-1,-1,7,3,0,10,7,0,9,10,0,7,10,6,-1,-1,-1,-1,10,6,7,8,10,7,9,10,8,-1,-1,-1,-1,-1,-1,-1,4,8,6,6,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,3,6,0,3,6,4,0,-1,-1,-1,-1,-1,-1,-1,11,6,8,6,4,8,1,0,9,-1,-1,-1,-1,-1,-1,-1,6,4,9,3,6,9,1,3,9,6,3,11,-1,-1,-1,-1,4,8,6,8,11,6,1,10,2,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,0,3,11,6,0,6,4,0,-1,-1,-1,-1,8,11,4,11,6,4,9,2,0,9,10,2,-1,-1,-1,-1,3,9,10,2,3,10,3,4,9,6,3,11,3,6,4,-1,3,2,8,2,4,8,2,6,4,-1,-1,-1,-1,-1,-1,-1,2,4,0,2,6,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,4,3,2,6,4,2,8,3,4,-1,-1,-1,-1,4,9,1,2,4,1,6,4,2,-1,-1,-1,-1,-1,-1,-1,3,1,8,1,6,8,6,4,8,1,10,6,-1,-1,-1,-1,0,1,10,6,0,10,4,0,6,-1,-1,-1,-1,-1,-1,-1,3,6,4,8,3,4,3,10,6,9,3,0,3,9,10,-1,4,9,10,4,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,9,4,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,5,9,4,6,7,11,-1,-1,-1,-1,-1,-1,-1,1,0,5,0,4,5,11,6,7,-1,-1,-1,-1,-1,-1,-1,6,7,11,4,3,8,4,5,3,5,1,3,-1,-1,-1,-1,4,5,9,2,1,10,11,6,7,-1,-1,-1,-1,-1,-1,-1,7,11,6,10,2,1,3,8,0,5,9,4,-1,-1,-1,-1,11,6,7,10,4,5,10,2,4,2,0,4,-1,-1,-1,-1,8,4,3,4,5,3,5,2,3,2,5,10,6,7,11,-1,3,2,7,2,6,7,9,4,5,-1,-1,-1,-1,-1,-1,-1,4,5,9,6,8,0,2,6,0,7,8,6,-1,-1,-1,-1,2,6,3,6,7,3,0,5,1,0,4,5,-1,-1,-1,-1,8,2,6,7,8,6,8,1,2,5,8,4,8,5,1,-1,4,5,9,6,1,10,6,7,1,7,3,1,-1,-1,-1,-1,10,6,1,6,7,1,7,0,1,0,7,8,4,5,9,-1,10,0,4,5,10,4,10,3,0,7,10,6,10,7,3,-1,10,6,7,8,10,7,10,4,5,10,8,4,-1,-1,-1,-1,5,9,6,9,11,6,9,8,11,-1,-1,-1,-1,-1,-1,-1,11,6,3,3,6,0,6,5,0,5,9,0,-1,-1,-1,-1,8,11,0,11,5,0,5,1,0,11,6,5,-1,-1,-1,-1,3,11,6,5,3,6,1,3,5,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,5,9,8,11,9,6,5,11,-1,-1,-1,-1,3,11,0,11,6,0,6,9,0,9,6,5,10,2,1,-1,5,8,11,6,5,11,5,0,8,2,5,10,5,2,0,-1,3,11,6,5,3,6,3,10,2,3,5,10,-1,-1,-1,-1,9,8,5,8,2,5,2,6,5,2,8,3,-1,-1,-1,-1,6,5,9,0,6,9,2,6,0,-1,-1,-1,-1,-1,-1,-1,8,5,1,0,8,1,8,6,5,2,8,3,8,2,6,-1,6,5,1,6,1,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,3,1,10,6,1,6,8,3,9,6,5,6,9,8,-1,0,1,10,6,0,10,0,5,9,0,6,5,-1,-1,-1,-1,8,3,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,5,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,11,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,5,7,11,0,3,8,-1,-1,-1,-1,-1,-1,-1,7,11,5,11,10,5,0,9,1,-1,-1,-1,-1,-1,-1,-1,5,7,10,7,11,10,1,8,9,1,3,8,-1,-1,-1,-1,2,1,11,1,7,11,1,5,7,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,2,1,5,7,1,11,2,7,-1,-1,-1,-1,5,7,9,7,2,9,2,0,9,7,11,2,-1,-1,-1,-1,2,5,7,11,2,7,2,9,5,8,2,3,2,8,9,-1,10,5,2,5,3,2,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,2,8,2,5,8,5,7,8,5,2,10,-1,-1,-1,-1,1,0,9,3,10,5,7,3,5,2,10,3,-1,-1,-1,-1,2,8,9,1,2,9,2,7,8,5,2,10,2,5,7,-1,5,3,1,5,7,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,1,7,0,5,7,1,-1,-1,-1,-1,-1,-1,-1,3,0,9,5,3,9,7,3,5,-1,-1,-1,-1,-1,-1,-1,7,8,9,7,9,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,5,8,10,5,8,11,10,-1,-1,-1,-1,-1,-1,-1,4,0,5,0,11,5,11,10,5,0,3,11,-1,-1,-1,-1,9,1,0,10,4,8,11,10,8,5,4,10,-1,-1,-1,-1,4,11,10,5,4,10,4,3,11,1,4,9,4,1,3,-1,1,5,2,5,8,2,8,11,2,8,5,4,-1,-1,-1,-1,11,4,0,3,11,0,11,5,4,1,11,2,11,1,5,-1,5,2,0,9,5,0,5,11,2,8,5,4,5,8,11,-1,5,4,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,2,2,5,3,5,4,3,4,8,3,-1,-1,-1,-1,2,10,5,4,2,5,0,2,4,-1,-1,-1,-1,-1,-1,-1,2,10,3,10,5,3,5,8,3,8,5,4,9,1,0,-1,2,10,5,4,2,5,2,9,1,2,4,9,-1,-1,-1,-1,5,4,8,3,5,8,1,5,3,-1,-1,-1,-1,-1,-1,-1,5,4,0,5,0,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,4,8,3,5,8,5,0,9,5,3,0,-1,-1,-1,-1,5,4,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,11,4,11,9,4,11,10,9,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,9,4,7,11,9,11,10,9,-1,-1,-1,-1,11,10,1,4,11,1,0,4,1,11,4,7,-1,-1,-1,-1,4,1,3,8,4,3,4,10,1,11,4,7,4,11,10,-1,7,11,4,4,11,9,11,2,9,2,1,9,-1,-1,-1,-1,4,7,9,7,11,9,11,1,9,1,11,2,3,8,0,-1,4,7,11,2,4,11,0,4,2,-1,-1,-1,-1,-1,-1,-1,4,7,11,2,4,11,4,3,8,4,2,3,-1,-1,-1,-1,10,9,2,9,7,2,7,3,2,9,4,7,-1,-1,-1,-1,7,10,9,4,7,9,7,2,10,0,7,8,7,0,2,-1,10,7,3,2,10,3,10,4,7,0,10,1,10,0,4,-1,2,10,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,3,1,7,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,1,8,0,1,7,8,-1,-1,-1,-1,3,0,4,3,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,10,9,8,11,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,10,9,11,-1,-1,-1,-1,-1,-1,-1,10,1,0,8,10,0,11,10,8,-1,-1,-1,-1,-1,-1,-1,10,1,3,10,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,1,9,11,1,8,11,9,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,9,2,1,9,11,2,-1,-1,-1,-1,11,2,0,11,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,9,8,10,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,8,1,0,8,10,1,-1,-1,-1,-1,2,10,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),numTrisTable:new Float32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0])}}var bC=new Lp,uYe=class{constructor(){this.pyramidPassScene=new go,this.pyramidPassMaterial=new xC({name:"PyramidPass"}),this.pyramidPassUniforms={inputTexture:{value:void 0},inputWidth:{value:0},inputHeight:{value:0},inputShiftX:{value:0},outputShiftX:{value:0}},this.pyramidTopLevelReadPixelBuffer=new Float32Array(4);let t=`
			precision highp float;
			precision highp sampler2D;
			layout(location = 0) out vec4 pc_FragColor;
			uniform sampler2D inputTexture;
			uniform float inputWidth;
			uniform float inputHeight;
			uniform float inputShiftX;
			uniform float outputShiftX;
			const vec2 half_unit_coord = vec2(0.5);
			const vec4 one = vec4(1.0);
			void main() {
				vec2 inputSize = vec2(inputWidth, inputHeight);
				vec2 input_pixel_uv = 1. / inputSize;
				vec2 coord = gl_FragCoord.xy - half_unit_coord;
				coord.x -= outputShiftX;
				coord = coord * 2. + half_unit_coord;
				coord.x += inputShiftX;

				// sample bottom left corner
				vec2 input_uv = coord / inputSize;
				float bl = texture(inputTexture, input_uv).r;

				// sample bottom right corner
				input_uv.x += input_pixel_uv.x;
				float br = texture(inputTexture, input_uv).r;

				// sample top right corner
				input_uv.y += input_pixel_uv.y;
				float tr = texture(inputTexture, input_uv).r;

				// sample top left corner
				input_uv.x -= input_pixel_uv.x;
				float tl = texture(inputTexture, input_uv).r;

				pc_FragColor.a = bl;
				pc_FragColor.b = pc_FragColor.a + br;
				pc_FragColor.g = pc_FragColor.b + tr;
				pc_FragColor.r = pc_FragColor.g + tl; 
			}
		`;this.pyramidPassMaterial.fragmentShader=t,this.pyramidPassMaterial.uniforms=this.pyramidPassUniforms,this.pyramidPassMaterial.depthTest=!1,this.pyramidPassMaterial.depthWrite=!1;let e=new vr(bw,this.pyramidPassMaterial);e.frustumCulled=!1,this.pyramidPassScene.add(e)}renderPyramid(t,e,i,r,n){new U5().min.setScalar(0);let s=e.length-1,a=new si;i.getViewport(a),this.pyramidPassUniforms.inputShiftX.value=0,this.pyramidPassUniforms.outputShiftX.value=0;let o=s-1;for(let c=o;c>=0;c--){let h=c%2===o%2?n[0]:n[1],u=c===o?r:c%2===o%2?n[1]:n[0];this.pyramidPassUniforms.inputTexture.value=Array.isArray(u.texture)?u.texture[1]:u.texture,this.pyramidPassUniforms.inputWidth.value=u.width,this.pyramidPassUniforms.inputHeight.value=u.height,i.setRenderTarget(h);let d=e[c],f=i.getPixelRatio();i.setViewport(this.pyramidPassUniforms.outputShiftX.value/f,0,d/f,d/f),c===2&&t%2!==0&&i.setViewport(this.pyramidPassUniforms.outputShiftX.value/f,0,3/f,3/f),i.render(this.pyramidPassScene,bC);let p=this.pyramidPassUniforms.inputShiftX.value;this.pyramidPassUniforms.inputShiftX.value=this.pyramidPassUniforms.outputShiftX.value,this.pyramidPassUniforms.outputShiftX.value=p,c<o&&(this.pyramidPassUniforms.outputShiftX.value+=e[c+1])}i.setViewport(a);let l=e.length%2===0?0:1;return i.readRenderTargetPixelsAsync(n[l],n[l].width-1,0,1,1,this.pyramidTopLevelReadPixelBuffer).then(()=>this.pyramidTopLevelReadPixelBuffer[0])}},hc=24,Ns=96,nh=hYe(),yu=2,cce=class extends Fn{constructor(t,e,i){super(t,e,i),this.data=e,this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!1,this._npart=-1,this.spatialn=1,this.drawRangeNeedsForceUpdate=!0,this._resolutionLevel=-1,this.resolution=64,this.spatialDivisions=25,this.zLayersPerRow=8,this.basePyramidSize=512,this.pyramidTexture1Width=341,this.pyramidTexture1Height=256,this.pyramidTexture2Width=170,this.pyramidTexture2Height=128,this.numLevels=9,this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=0,this.bboxOffset=0,this.shapesDataTexture={value:void 0},this.spatialscene=new go,this.potentialPassScene=new go,this.voxelPassScene=new go,this._spatialPassRenderTargets=[],this._potentialPassRenderTargets=[],this._voxelPassRenderTargets=[],this._pyramidRenderTargets=[],this.geometry=new Nt,this.geometry.drawRange.count=0,this.spatialPassUniforms={span:{value:-1},shapesDataTexture:this.shapesDataTexture,npart:{value:this.npart},spatialn:{value:this.spatialn}},this.spatialMesh=new vr(bw,this.spatialPassMaterial()),this.spatialMesh.frustumCulled=!1,this.spatialscene.add(this.spatialMesh);let r=new Ua(nh.triTable,16,256,lC,tr);r.needsUpdate=!0;let n=new Ua(nh.numTrisTable,256,1,lC,tr);n.needsUpdate=!0,this.voxelPassUniforms={potentialPassTexture:{value:void 0},numTrisTable:{value:n}},this.voxelMesh=new vr(bw,this.voxelPassMaterial()),this.voxelMesh.frustumCulled=!1,this.voxelPassScene.add(this.voxelMesh),this.potentialPassUniforms={shapesDataTexture:this.shapesDataTexture,spatialPassTexture:{value:void 0},npart:{value:this.npart},spatialn:{value:this.spatialn}},this.potentialMesh=new vr(bw,this.potentialPassMaterial()),this.potentialMesh.frustumCulled=!1,this.potentialPassScene.add(this.potentialMesh),this.marchPassUniforms={triTable:{value:r},potentialPassTexture:{value:void 0},voxelPassTexture:{value:void 0},pyramidTexture1:{value:void 0},pyramidTexture1Size:{value:void 0},pyramidTexture2:{value:void 0},pyramidTexture2Size:{value:void 0}},this.frustumCulled=!1,this.onBeforeShadowPass=s=>{if(gYe.call(this),this.npart===0){this.geometry.drawRange.count=0;return}let a=this.material.root;if(!a.shadersPatchedForShapeBlend)this.patchVertexShaderForShapeBlend(a),a.shadersPatchedForShapeBlend=!0,this.customDepthMaterialNeedsUpdate=!0;else if(this.customDepthMaterialNeedsUpdate){this.customDepthMaterialNeedsUpdate=!1,this.customDepthMaterial=new Ri({vertexShader:a.vertexShader,fragmentShader:`
						#include <packing>
						void main()
						{
							gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
						}
					`,uniforms:a.uniforms,defines:this.material.defines}),this.isMeshDepthMaterial=!0,this.customDistanceMaterial=new Ri({vertexShader:a.vertexShader,fragmentShader:`
					#include <common>
					#include <packing>
					uniform vec3 referencePosition;
					uniform float nearDistance;
					uniform float farDistance;
					// World-space position
					varying vec3 vWPosition;
					void main()
					{
						float dist = length(vWPosition - referencePosition);
						dist = (dist - nearDistance) / (farDistance - nearDistance);
						dist = saturate(dist);
						// Required by Three.js for this to work
						gl_FragColor = packDepthToRGBA( dist );
					}`,uniforms:{nearDistance:{value:0},farDistance:{value:0},referencePosition:{value:new N},opacity:{value:0},...a.uniforms},defines:this.material.defines});let c=this.customDistanceMaterial;c.referencePosition=new N,c.nearDistance=0,c.farDistance=0,c.opacity=1,c.isMeshDistanceMaterial=!0}if(this.spatialPassUniforms.npart.value=this.npart,this.spatialPassUniforms.spatialn.value=this.spatialn,this.potentialPassUniforms.npart.value=this.npart,this.potentialPassUniforms.spatialn.value=this.spatialn,this.needsRebuild){this.needsRebuild=!1,this.spatialMesh.material.defines.RES=this.resolutionLevel,this.spatialMesh.material.needsUpdate=!0,this.potentialMesh.material.defines.RES=this.resolutionLevel,this.potentialPassUniforms.spatialPassTexture.value=this.spatialPassRenderTarget.texture,this.potentialMesh.material.needsUpdate=!0,this.voxelMesh.material.defines.RES=this.resolutionLevel,this.voxelMesh.material.needsUpdate=!0,this.voxelPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.voxelPassTexture.value=this.voxelPassRenderTarget.texture[0],this.material.defines.RES=this.resolutionLevel,this.material.defines.LEVELS=this.pyramidLevelSizes.length,this.material.defines.LOOP=this.pyramidLevelSizes.length%2===0?this.pyramidLevelSizes.length-3:this.pyramidLevelSizes.length-2,this.material.defines.HALF=this.pyramidLevelSizes.length%2===0?1:0,this.material.needsUpdate=!0;let c=this.pyramidLevelSizes.length%2===0?0:1,h=this.pyramidLevelSizes.length%2===0?1:0;this.marchPassUniforms.pyramidTexture2.value=this.pyramidRenderTarget[c].texture,this.marchPassUniforms.pyramidTexture2Size.value=new ye(this.pyramidRenderTarget[c].width,this.pyramidRenderTarget[c].height),this.marchPassUniforms.pyramidTexture1.value=this.pyramidRenderTarget[h].texture,this.marchPassUniforms.pyramidTexture1Size.value=new ye(this.pyramidRenderTarget[h].width,this.pyramidRenderTarget[h].height),Object.assign(this.material.uniforms,this.marchPassUniforms)}let o=s.shadowMap.enabled;s.shadowMap.enabled=!1;let l=s.getRenderTarget();s.setRenderTarget(this.spatialPassRenderTarget),s.render(this.spatialscene,bC),s.setRenderTarget(this.potentialPassRenderTarget),s.render(this.potentialPassScene,bC),s.setRenderTarget(this.voxelPassRenderTarget),s.render(this.voxelPassScene,bC),cce.streamCompaction.renderPyramid(this.resolutionLevel,this.pyramidLevelSizes,s,this.voxelPassRenderTarget,this.pyramidRenderTarget).then(c=>{this.material.wireframe&&(c*3>this.geometry.attributes.position.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.dispose(),this.geometry=new Nt,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.geometry.attributes.position=new Yt(new Float32Array(c*3*2),3)),(c*3>this.geometry.drawRange.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.drawRange.count=Math.floor(c*1.2)*3),this.drawRangeNeedsForceUpdate=!1}),s.shadowMap.enabled=o,s.setRenderTarget(l)}}set npart(t){t!==this._npart&&(this.drawRangeNeedsForceUpdate=!0,this._npart=t,this.spatialn=Math.ceil(t/(4*hc)))}get npart(){return this._npart}set resolutionLevel(t){let e=Math.min(8,Math.max(5,t));if(e!==this._resolutionLevel){switch(this._resolutionLevel=e,this.resolution=Math.pow(2,e),this.resolutionLevel){case 5:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192],this.bboxSize=31*8*yu,this.bboxOffset=8*yu*-1/2;break;case 6:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=63*4*yu,this.bboxOffset=4*yu*-1/2;break;case 7:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192,384,768,1536],this.bboxSize=127*2*yu,this.bboxOffset=2*yu*-1/2;break;case 8:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096],this.bboxSize=255*yu,this.bboxOffset=yu*-1/2;break}this.pyramidTexture1Width=0,this.pyramidTexture2Width=0,this.pyramidTexture1Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-2],this.pyramidTexture2Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-3];for(let i=this.pyramidLevelSizes.length-2;i>=0;i--)(this.pyramidLevelSizes.length-2)%2===i%2?this.pyramidTexture1Width+=this.pyramidLevelSizes[i]:this.pyramidTexture2Width+=this.pyramidLevelSizes[i];this.basePyramidSize=this.pyramidLevelSizes[this.pyramidLevelSizes.length-1],this.zLayersPerRow=this.basePyramidSize/this.resolution,this.numLevels=this.pyramidLevelSizes.length-1,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.needsRebuild=!0}}get resolutionLevel(){return this._resolutionLevel}get spatialPassRenderTarget(){let t=this._spatialPassRenderTargets[this.resolutionLevel];return t||(t=new Di(this.spatialDivisions*this.spatialn,this.spatialDivisions**2,{format:Fr,type:tr,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:bi,magFilter:bi}),this._spatialPassRenderTargets[this.resolutionLevel]=t),t}get potentialPassRenderTarget(){let t=this._potentialPassRenderTargets[this.resolutionLevel];return t||(t=new Di(this.basePyramidSize,this.basePyramidSize,{format:Fr,type:tr,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:bi,magFilter:bi}),this._potentialPassRenderTargets[this.resolutionLevel]=t),t}get voxelPassRenderTarget(){let t=this._voxelPassRenderTargets[this.resolutionLevel];return t||(t=new wse(this.basePyramidSize,this.basePyramidSize,2,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:bi,magFilter:bi}),t.texture[0].format=Fr,t.texture[0].type=tr,t.texture[1].format=lC,t.texture[1].type=tr,this._voxelPassRenderTargets[this.resolutionLevel]=t),t}get pyramidRenderTarget(){let t=this._pyramidRenderTargets[this.resolutionLevel];if(!t){let e=new Di(this.pyramidTexture1Width,this.pyramidTexture1Height,{format:Fr,type:tr,stencilBuffer:!1,depthBuffer:!1,magFilter:bi,minFilter:bi}),i=new Di(this.pyramidTexture2Width,this.pyramidTexture2Height,{format:Fr,type:tr,stencilBuffer:!1,depthBuffer:!1,magFilter:bi,minFilter:bi});t=[e,i],this._pyramidRenderTargets[this.resolutionLevel]=t}return t}updateState(t,e){let i=this.material;super.updateState(t,e),i!==this.material&&(this.needsRebuild=!0),t.geometry&&(this.resolutionLevel=t.geometry.resolutionLevel,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]}),t.wireframe&&!this.geometry.getAttribute("position")?this.geometry.setAttribute("position",new Yt(new Float32Array(this.geometry.drawRange.count*3),3)):!t.wireframe&&this.geometry.getAttribute("position")&&this.geometry.deleteAttribute("position")}spatialPassMaterial(){let t=`
			precision highp float;
			out vec4 pc_FragColor;
			const float spatialDivisions = ${this.spatialDivisions}.;
			uniform float span;
			uniform float npart;
			uniform float spatialn;
			${nh.shapeInput()}

			vec3 low, high;     // range of current div; subset of -1 .. 1 with span border

			// lookup one element/channel's worth of spheres for current division
			// stating with low sphere number lowi
			// gives a key to which spheres from lowi..lowi+23 are active within given div (low..high)
			float spatialKey(float lowi) {
				float t = 0.;
				for (float ii = ${hc-1}.; ii >= 0.; ii--) {
					float i = ii + lowi;
					float iin = (i + 0.5) / ${Ns}.;
					vec4 shape = shapePos(iin);
					vec3 d = shape.xyz;
					float op = shape.w;
	
					t *= 2.;
					t += (
						low.x < d.x && d.x < high.x &&
						low.y < d.y && d.y < high.y &&
						low.z < d.z && d.z < high.z &&
						i < npart || op == -2. // always include if op is -2, which is the intersection operation
					) ? 1. : 0.;
				}
				return t;
			}

			${nh.getpart}

			void main() {               // spatialial fragment shader
				// find active div
				vec3 div;                               // which div is current
				// out holds x=> x, lowi faster moving and y=> z, y faster moving
				float yz = float(gl_FragCoord.y - 0.5);     // contains  z, y faster moving
				div.y = getpart(yz, spatialDivisions);
				div.z = yz; // getpart(yz, spatialDivisions.z); // what's left, should be the same as getpart

				float lx = float(gl_FragCoord.x - 0.5);     // contains x, lowi faster moving
				float lowi = getpart(lx, spatialn) * ${4*hc}.;
				div.x = lx;

				low = div / spatialDivisions * 2. - 1. - span;
				high = (div+1.) / spatialDivisions * 2. - 1. + span;

				// find active range of spheres
				pc_FragColor.x = spatialKey(lowi);
				pc_FragColor.y = spatialKey(lowi+${hc}.);
				pc_FragColor.z = spatialKey(lowi+${2*hc}.);
				pc_FragColor.w = spatialKey(lowi+${3*hc}.);
			}
		`;return new xC({name:"Spatial Pass",fragmentShader:t,uniforms:this.spatialPassUniforms})}potentialPassMaterial(){let t=`
			precision highp float;
			out vec4 pc_FragColor;

			${nh.shapeInput()}
			uniform sampler2D spatialPassTexture;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.;
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			uniform float npart;
			uniform float spatialn;
			const float spatialDivisions = ${this.spatialDivisions}.;
			const float spatialDivisions2 = spatialDivisions * spatialDivisions;
			const float spatialDivisionsSub1 = spatialDivisions - 1.;

			${nh.getpart}

			vec3 packRGBAToVec3(vec4 color) {
				uint r = uint(color.r * 255.);
				uint g = uint(color.g * 255.);
				uint combined = (r << 8) | g; 
				return vec3(float(combined) * 0.00001525902, color.b, color.a); // 1/65535
			}

			void applyQuaternionToVector(in vec4 q, inout vec3 v) {
				v += 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);
			}

			/**
			 * SDF functions (reference: https://iquilezles.org/articles/distfunctions/)
			 */

			// branchless version of "Smooth Union, Subtraction and Intersection - bound, bound, bound" in above reference
			float smoothOperation(float op, float sdf, float d, float k) {
			  //        union: op =  1 => signSubtract =  1, signIntersection =  1
			  //     subtract: op = -1 => signSubtract = -1, signIntersection =  1
				// intersection: op = -2 => signSubtract = -1, signIntersection = -1

				float signSubtract = clamp(op, -1., 1.);
				float signIntersection = 2. * (op - signSubtract) + 1.;
				float h = clamp(
					0.5 + signSubtract * 0.5 * (sdf - signSubtract * signIntersection * d) / k,
					0.0,
					1.0
				);
				return mix(sdf, signSubtract * signIntersection * d, h) - 
							 signSubtract * k * h * (1.0 - h);
			}

			float sdSphere( vec3 p, float s )
			{
				return length(p)-s;
			}

			float sdEllipsoid( vec3 p, vec3 r )
			{
				float k0 = length(p/r);
				float k1 = length(p/(r*r));
				return k0*(k0-1.0)/k1;
			}

			float sdBox( vec3 p, vec3 b )
			{
				vec3 q = abs(p) - b;
				return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);
			}

			float sdTorus( vec3 p, vec2 t )
			{
				vec2 q = vec2(length(p.xy)-t.x,p.z);
				return length(q)-t.y;
			}

			float sdCappedTorus( vec3 p, vec2 sc, float ra, float rb)
			{
				p.x = abs(p.x);
				float k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);
				return sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;
			}

			float dot2( in vec2 v ) { return dot(v,v); }
			float sdCappedCone( vec3 p, float h, float r1, float r2 )
			{
				vec2 q = vec2( length(p.xz), p.y );
				vec2 k1 = vec2(r2,h);
				vec2 k2 = vec2(r2-r1,2.0*h);
				vec2 ca = vec2(q.x-min(q.x,(q.y<0.0)?r1:r2), abs(q.y)-h);
				vec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );
				float s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0;
				return s*sqrt( min(dot2(ca),dot2(cb)) );
			}

			float sdCappedCylinder( vec3 p, float h, float r )
			{
				vec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);
				return min(max(d.x,d.y),0.0) + length(max(d,0.0));
			}

			float maxBlend = 0.0;
			// compute potential from A (=24) spheres, using the bit flags in 'activeKey'
			// to avoid lookup/compute for inactive spheres
			// return field potential, side effect updates track,
			// compute and return +ve and -ve values separately
			void fillSpatialInner(
				float ii,
				float activeKey,
				vec3 corner,
				inout float sdf,
				inout float colorDivisor,
				inout vec4 trackColor
			) {
				for (float i = 0.; i < ${hc}.; i++) {
					if (activeKey < 1.) break; // activeKey exhausted, no more active spheres
					activeKey *= 0.5;
					if (fract(activeKey) < 0.5) continue;

					float iin = (i + ii + 0.5) * ${1/Ns};
					vec4 shape = shapePos(iin);
					vec4 quat = shapeQuat(iin);
					vec4 params1 = shapeParams1(iin);
					vec4 params2 = shapeParams2(iin);

					vec3 p = corner - shape.xyz;
					applyQuaternionToVector(quat, p);
					p /= params2.z; // scale
					float d; // d in -1..1 coordinates
					switch (int(params1.x)) {
						case 0: d = sdSphere(p, params1.y); break;
						case 1: d = sdEllipsoid(p, params1.yzw); break;
						case 2: d = sdBox(p, params1.yzw); break;
						case 3: d = sdCappedCylinder(p, params1.y, params1.z); break;
						case 4: d = sdCappedCone(p, params1.y, params1.z, params1.w); break;
						case 5: d = sdTorus(p, params1.yz); break;
						case 6: d = sdCappedTorus(p, params1.yz, params1.w, params2.w); break;
					}
					d -= params2.y; // rounded edge
					d *= params2.z; // scale

					float k = params2.x;
					float op = shape.w;

					sdf = smoothOperation(shape.w, sdf, d, k);

					float isNegativeOne = step(-1.5, op) * step(op, -0.5); // 1 when op == -1, 0 otherwise
					float colorCull = smoothstep(maxBlend, 0., -d);
					float cullFactor = mix(1.0, colorCull, isNegativeOne);
					trackColor *= cullFactor;
					colorDivisor *= cullFactor;

					maxBlend = max(maxBlend, k);

					k += 2. * INV_VOXEL_RESOLUTION; // avoid division by zero, and other color artifacts with very small k
					float nearness = smoothstep(k, 0., d);

					vec4 color = shapeColor(iin);
					nearness *= float(color.a >= 0.);

					colorDivisor += nearness;
					trackColor += color * nearness;
				}
			}

			vec3 div;
			// compute potential from all spheres; collect +ve and =ve values separately
			// work in blocks of A*4 (=96) spheres, using the bit flags in 4 float channel 'activeKey' values
			// TODO check if extra vec3 output useful, not really used at present
			float fillSpatial(vec3 corner, inout vec4 trackColor) {
				float sdf = 1e3; // hack: initialize to large value
				float colorDivisor = 0.;
				// spatialPassTexture holds x=> lowi, x faster moving and y=> z, y faster moving
				float divyz = (div.y + div.z * spatialDivisions + 0.5) / (spatialDivisions2);
				for (float ii = 0.; ii < spatialn; ii++) {
					float i = ii * ${4*hc}.;

					vec4 activeKey = texture(spatialPassTexture, vec2((div.x * spatialn + ii + 0.5)/(spatialn * spatialDivisions), divyz));
					fillSpatialInner(i, activeKey.x, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${hc}., activeKey.y, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${2*hc}., activeKey.z, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${3*hc}., activeKey.w, corner, sdf, colorDivisor, trackColor);
				}

				trackColor /= colorDivisor;
				return mix(sdf, 0.0, step(1e20 - 0.1, sdf));
			}

			void main() {
				${nh.getxyzi}    // get xi yi zi from 2d position

				vec3 xyzi = vec3(xi,yi,zi);
				vec3 corner = xyzi / VOXEL_RESOLUTION_SUB1 * 2. - 1.;  // -1..1 coords

				div = floor(xyzi / VOXEL_RESOLUTION_SUB1 * spatialDivisionsSub1);

				vec4 c = vec4(0.);
				float t = fillSpatial(corner, c);

				pc_FragColor = vec4(t, packRGBAToVec3(c)); // RGB texture
			}
		`;return new xC({name:"PotentialPass",fragmentShader:t,uniforms:this.potentialPassUniforms})}voxelPassMaterial(){let t=`
			precision highp float;
			layout(location = 0) out vec4 pc_FragColor;
			layout(location = 1) out vec4 numTris;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.; 
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;
			uniform sampler2D numTrisTable; // 256 x 1

			float keyi(float f000, float f100, float f010, float f110, float f001, float f101, float f011, float f111) {
				return (float(f000 < 0.) * 1.) +
							 (float(f100 < 0.) * 2.) +
							 (float(f010 < 0.) * 8.) +
							 (float(f110 < 0.) * 4.) +
							 (float(f001 < 0.) * 16.) +
							 (float(f101 < 0.) * 32.) +
							 (float(f011 < 0.) * 128.) +
							 (float(f111 < 0.) * 64.);
			}

			${nh.lookup}

			vec3 compNormi(float xi, float yi, float zi) {
				float dx = look(xi + 1., yi, zi, potentialPassTexture).r - look(xi - 1., yi, zi, potentialPassTexture).r;
				float dy = look(xi, yi + 1., zi, potentialPassTexture).r - look(xi, yi - 1., zi, potentialPassTexture).r;
				float dz = look(xi, yi, zi + 1., potentialPassTexture).r - look(xi, yi, zi - 1., potentialPassTexture).r;
				// if we allow (common) 0,0,0 case through then NaN can spread
				// eg r = vec4(compNorm i(???), 1.) will pollute r.w
				if (dx == 0.0 && dy == 0.0 && dz == 0.0) {
					return vec3(0.199, 0.299, 0.399);
				}
				return normalize(vec3(dx, dy, dz));
			}

			void main() {
				${nh.getxyzi}    // get xi yi zi from 2d

				vec3 normal = compNormi(xi, yi, zi);  // even if our key is -1 this may be needed by a neighbouring voxel

				if (xi >= VOXEL_RESOLUTION_SUB1 || yi >= VOXEL_RESOLUTION_SUB1 || zi >= VOXEL_RESOLUTION_SUB1) {
					pc_FragColor = vec4(normal, 0.);
					numTris = vec4(0.);
					return;
				}

				float
					f000 = look(xi, yi, zi, potentialPassTexture).r,
					f100 = look(xi+1., yi, zi, potentialPassTexture).r,
					f010 = look(xi, yi+1., zi, potentialPassTexture).r,
					f110 = look(xi+1., yi+1., zi, potentialPassTexture).r,
					f001 = look(xi, yi, zi+1., potentialPassTexture).r,
					f101 = look(xi+1., yi, zi+1., potentialPassTexture).r,
					f011 = look(xi, yi+1., zi+1., potentialPassTexture).r,
					f111 = look(xi+1., yi+1., zi+1., potentialPassTexture).r;
				float key = keyi(f000, f100, f010, f110, f001, f101, f011, f111);

				pc_FragColor = vec4(normal, key);

				numTris = texture(numTrisTable, vec2((key + 0.5) / 256., 0.5));
			}
		`;return new xC({name:"VoxelPass",fragmentShader:t,uniforms:this.voxelPassUniforms})}patchVertexShaderForShapeBlend(t){let e=`
		#ifdef SHAPEBLEND 
			precision highp sampler2D;

			uniform float isol;

			uniform sampler2D triTable;     // 256 x 16
			uniform sampler2D pyramidTexture1;
			uniform vec2 pyramidTexture1Size;
			uniform sampler2D pyramidTexture2;
			uniform vec2 pyramidTexture2Size;

			const vec2 halfPixelOffset = vec2(0.5, 0.5);

			const vec2 rShift = vec2(0., 1.);
			const vec2 gShift = vec2(1., 1.);
			const vec2 bShift = vec2(1., 0.);

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			const float scale_factor = ${yu}.;

			#if SHAPEBLEND == 5
				const float levelShiftX[7] = float[7](4., 6., 12., 24., 48., 96., 192.);
				const float scale = 8. * scale_factor;
				const vec3 originOffset = vec3(16.);
			#elif SHAPEBLEND == 7
				const float levelShiftX[10] = float[10](4., 6., 12., 24., 48., 96., 192., 384., 768., 1536.); 
				const float scale = 2. * scale_factor;
				const vec3 originOffset = vec3(64.);
			#elif SHAPEBLEND == 8
				const float levelShiftX[11] = float[11](4., 8., 16., 32., 64., 128., 256., 512., 1024., 2048., 4096.);
				const float scale = scale_factor;
				const vec3 originOffset = vec3(128.);
			#else
				const float levelShiftX[8] = float[8](4., 8., 16., 32., 64., 128., 256., 512.);
				const float scale = 4. * scale_factor;
				const vec3 originOffset = vec3(32.);
			#endif

			${nh.lookup}

			const vec3 offsets[24] = vec3[](
				vec3(0., 0., 0.), vec3(1., 0., 0.),
				vec3(1., 0., 0.), vec3(1., 1., 0.),
				vec3(0., 1., 0.), vec3(1., 1., 0.),
				vec3(0., 0., 0.), vec3(0., 1., 0.),
				vec3(0., 0., 1.), vec3(1., 0., 1.),
				vec3(1., 0., 1.), vec3(1., 1., 1.),
				vec3(0., 1., 1.), vec3(1., 1., 1.),
				vec3(0., 0., 1.), vec3(0., 1., 1.),
				vec3(0., 0., 0.), vec3(0., 0., 1.),
				vec3(1., 0., 0.), vec3(1., 0., 1.),
				vec3(1., 1., 0.), vec3(1., 1., 1.),
				vec3(0., 1., 0.), vec3(0., 1., 1.)
			);

			vec2 computeShiftedPosition1(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture1Size;
			}

			vec2 computeShiftedPosition2(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture2Size;
			}

			vec4 unpackVec3ToRGBA(vec3 vec) {
				uint combined = uint(vec.x * 65535.0 + 0.5); // Add 0.5 for rounding
				float g = float(combined & uint(0xFF)) * 0.00392156862; // 1/255
				float r = float((combined >> 8) & uint(0xFF)) * 0.00392156862; 
		
				return vec4(r, g, vec.y, vec.z);
			}

			out vec4 marchColor;
			// end of marchvertPre
		#endif
		`,i=`
		#ifdef SHAPEBLEND
			float triIndex = floor(float(gl_VertexID/3));
			float vertexIndex = float(gl_VertexID);
			
			// Initial pyramid lookup
			float levelOriginX1 = pyramidTexture1Size.x - 2.;
			float levelOriginX2 = pyramidTexture2Size.x - 1.;
			vec2 xy = vec2(0.);
			vec4 lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));
			
			// Early exit check
			if (triIndex >= lookUp.r) return;
			
			// Optimize loop variables
			float start = 0.;
			vec4 triIndexVec = vec4(triIndex);
			
			// Main position computation loop
			for (int i = 0; i < LOOP;) {
				// Compute boundaries
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX2 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture1, computeShiftedPosition1(xy, levelOriginX1));
				i++;

				ends = lookUp + vec4(start);
				starts = vec4(ends.gba, start);
				check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX1 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));

				i++;
			}

			#if HALF == 1
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * vec4(lessThan(triIndexVec, ends));
			
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
			
				// Update loop variables
				start = dot(check, starts);
			#endif
			
			// Compute final coordinates
			vec3 gridPos;
			gridPos.x = mod(xy.x, VOXEL_RESOLUTION);
			gridPos.y = mod(xy.y, VOXEL_RESOLUTION);
			gridPos.z = floor(xy.x * INV_VOXEL_RESOLUTION) + 
									floor(xy.y * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
			
			// Vertex key computation
			vertexIndex -= start * 3.;
			float vk = vertexIndex * 0.0625 + 0.03125; // Optimized division by 16 and addition of 1/32
			
			// Voxel lookup and edge computation
			vec4 voxel = look(gridPos.x, gridPos.y, gridPos.z, voxelPassTexture);
			float key = (voxel.w + 0.5) * 0.00390625; // Optimized division by 256
			
			// Edge lookup and offset computation
			float edgeNum = texture(triTable, vec2(vk, key)).x;
			int edgeIndex = int(edgeNum) * 2;
			
			// Compute edge positions
			vec3 p1 = gridPos + offsets[edgeIndex];
			vec3 p2 = gridPos + offsets[edgeIndex + 1];
			
			// Compute potentials and normals
			vec4 potential1 = look(p1.x, p1.y, p1.z, potentialPassTexture);
			vec4 potential2 = look(p2.x, p2.y, p2.z, potentialPassTexture);
			
			// Final position and normal computation
			float mu = potential1.r / (potential1.r - potential2.r);

			marchColor = mix(
				unpackVec3ToRGBA(potential1.gba),
				unpackVec3ToRGBA(potential2.gba),
				mu
			);

			transformed = p1 + (p2 - p1) * mu;
			transformed -= originOffset;
			transformed *= scale;
			vec4 data1 = look(p1.x, p1.y, p1.z, voxelPassTexture);
			vec4 data2 = look(p2.x, p2.y, p2.z, voxelPassTexture);
			objectNormal = normalize(mix(data1.xyz, data2.xyz, mu));
			transformedNormal = normalMatrix * objectNormal;
			#ifndef FLAT_SHADED
				vNormal = transformedNormal;
			#endif
		#endif
		`;t.vertexShader=e+t.vertexShader.replace("#include <project_vertex>",i+`
#include <project_vertex>`);let r=t.fragmentShader.match(/vec3 diffuseColor[^\n]*\n/);if(!r)return;let n=`
		#ifdef SHAPEBLEND_C
			#if SHAPEBLEND_C == 1
				${r[0].replace(/nodeU0,/g,"marchColor.rgb,").replace(/nodeU\d+(?=,g_uid\d+_calpha\))/g,"marchColor.a")}
			#else
				${r[0]}
			#endif
		#else
			${r[0]}
		#endif
		`;t.fragmentShader=`in vec4 marchColor;
`+t.fragmentShader.replace(r[0],n),Object.assign(t.uniforms,this.marchPassUniforms)}initDebugPass(t){console.log("fboToDebug.width",t.width,t.height),this.geometry=new Vh(t.width,t.height),this.geometry.userData={parameters:{width:4,height:4}};let e={inputTexture:{value:Array.isArray(t.texture)?t.texture[1]:t.texture},pyramidTextureSize:{value:void 0}},i=r=>{r.vertexShader=`
				precision highp float;

				varying vec2 vUv;

				void main() {
						gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
						vUv = uv;
				}
			`,r.fragmentShader=`
				layout(location = 1) out vec4 gVelocity;

				precision highp float;
				
				uniform sampler2D inputTexture;
				varying vec2 vUv;

				uniform vec2 pyramidTextureSize;

				void main() {
						// Sample the input texture using UV coordinates
						gl_FragColor = texture(inputTexture, vUv);
						gVelocity = vec4(0.0);
				}
			`,e.pyramidTextureSize.value=new ye(this.pyramidRenderTarget.width,this.pyramidRenderTarget.height),Object.assign(r.uniforms,e)};this.material.shapeBlendhack=i,this.material.root.shapeBlendhack=i}},qg=cce;qg.streamCompaction=new uYe;var dYe=new st,fYe=new st,Sv=new ri,lf=new N,xT=new N,pYe=new ri;function mYe(t,e=0){let i=this.children.length;for(;i--;){let r=this.children[i];Wg.is(r)&&hce.call(r,t,e+1)}}function hce(t,e=0){if(t(this,e)!==!0){let i=this.children.length;for(;i--;){let r=this.children[i];Wg.is(r)&&hce.call(r,t,e+1)}}}function gYe(){if(this.shapesDataTexture.value===void 0){let a=new Ua(new Float32Array(4*Ns*Fm),Ns,Fm,Fr,tr);this.shapesDataTexture.value=a}let t=this.shapesDataTexture.value,e=t.image.data;t.needsUpdate=!0;let i=0,r=this.data.geometry.blendRange,n=dYe.copy(this.matrixWorld).invert(),s=0;mYe.call(this,a=>{var v;if(a.visible===!1)return!0;let o;if(a instanceof Ol||a instanceof yw||a instanceof xw)return;a instanceof qs?o=a.object:o=a;let l=(v=a.data)==null?void 0:v.cloner;if(Ti.is(a)&&l&&!l.hideBase&&l.type!=="radial"&&l.disabled!==!0||!(o instanceof Fn))return;let c=o.geometry.userData.parameters,h=c.shapeBlendNode;if(h===void 0)return;if(fYe.multiplyMatrices(n,a.matrixWorld).decompose(xT,Sv,lf),c.type==="TorusGeometry"&&c.arc!==360){let y=c.arc*Math.PI/180;y=y/4,Sv.multiply(pYe.set(0,0,Math.sin(y),Math.cos(y)))}let u=h.overrideGlobalBlend?h.blendRange:r;u=u/this.bboxSize*2,e[s*4]=(xT.x-this.bboxOffset)/this.bboxSize*2,e[s*4+1]=(xT.y-this.bboxOffset)/this.bboxSize*2,e[s*4+2]=(xT.z-this.bboxOffset)/this.bboxSize*2,e[s*4+3]=h.operation===0?1:h.operation===2?-1:-2,e[Ns*4+s*4]=-Sv.x,e[Ns*4+s*4+1]=-Sv.y,e[Ns*4+s*4+2]=-Sv.z,e[Ns*4+s*4+3]=Sv.w;let d=new Float32Array(4),f=0;if(c.type==="SphereGeometry")c.width===c.height&&c.width===c.depth?d[0]=0:d[0]=1,d[1]=c.width/this.bboxSize,d[2]=c.height/this.bboxSize,d[3]=c.depth/this.bboxSize,i=Math.max(i,d[1]*lf.x+u,d[2]*lf.x+u,d[3]*lf.x+u);else if(c.type==="CubeGeometry"){f=c.cornerRadius;let y=c.width,x=c.height,S=c.depth;d[0]=2,d[1]=(y-2*f)/this.bboxSize,d[2]=(x-2*f)/this.bboxSize,d[3]=(S-2*f)/this.bboxSize,i=Math.max(i,Math.sqrt(y**2+x**2+S**2)/this.bboxSize*lf.x+u)}else if(c.type==="CylinderGeometry"){f=c.cornerRadius;let y=c.height,x=c.radiusBottom,S=c.radiusTop;if(S>=x){let A=Math.atan2(S-x,y),_=(Math.PI/2-A)/2;S-=f/Math.tan(_),x-=f*Math.tan(_)}else if(x>S){let A=Math.atan2(x-S,y),_=(Math.PI/2-A)/2;S-=f*Math.tan(_),x-=f/Math.tan(_)}d[1]=(c.height-2*f)/this.bboxSize,x===S?(d[0]=3,d[2]=x/this.bboxSize*2):(d[0]=4,d[2]=x/this.bboxSize*2,d[3]=S/this.bboxSize*2),i=Math.max(i,d[1]*4*lf.x+u)}else if(c.type==="TorusGeometry"){if(d[0]=5,d[1]=(c.width-c.depth)/this.bboxSize,d[2]=c.depth/this.bboxSize,c.arc!==360){d[0]=6,d[3]=d[1],e[Ns*12+s*4+3]=d[2];let y=2*Math.atan2(d[2]/2,d[1]),x=c.arc*Math.PI/180/2-y;d[1]=Math.sin(x),d[2]=Math.cos(x)}i=Math.max(i,c.width*lf.x/this.bboxSize+u)}e.set(d,Ns*8+s*4),e[Ns*12+s*4]=u,e[Ns*12+s*4+1]=f/this.bboxSize*2,e[Ns*12+s*4+2]=lf.x;let p=o.material,m=p.uniforms.nodeU0.node.value,g=p.uniforms.nodeU1.value;h.operation!==0&&!h.useColor&&(g=-1),e[Ns*16+s*4]=m.r,e[Ns*16+s*4+1]=m.g,e[Ns*16+s*4+2]=m.b,e[Ns*16+s*4+3]=g,g<1&&this.material.defines.SHAPEBLEND_C===1&&(this.material.transparent=!0),s++}),this.npart=s,this.spatialPassUniforms.span.value=i*1.4}var uce=512;function rQ(t,e){let i=!1,r=t.layers.mask&uce,n=e.getLayersOfType("transmission"),s=e.getLayersOfType("outline");return s.length>0&&(t.layers.set(8),n.length>0&&t.layers.enable(3),i=!0,IG(t),RG(t)),n.length===0&&s.length===0&&t.layers.set(0),r&&t.layers.set(9),t instanceof tx&&t.needsAO&&t.layers.enable(5),i}function nQ(t,e){if(!e.layers)return!1;let i=t.layers.mask&uce,r=!1,n=e.getLayersOfType("transmission").filter(a=>a.data.visible),s=e.getLayersOfType("outline").filter(a=>a.data.visible);return n.length>0&&(t.layers.set(3),s.length>0&&t.layers.enable(8),r=!0),n.length===0&&s.length===0&&t.layers.set(0),i&&t.layers.set(9),t.needsAO&&t.layers.enable(5),r}function vYe(t){let e=!1;return t.traverseEntity(i=>{if(i instanceof tx)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)rQ(i,i.material[r])&&(e=!0);else rQ(i,i.material)&&(e=!0)}),e}function yYe(t){let e=!1;return t.traverseEntity(i=>{if(i instanceof tx)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)nQ(i,i.material[r])&&(e=!0);else nQ(i,i.material)&&(e=!0)}),e}var xYe=new $se,bYe=new st,wYe=new G1;function vU(t,e,i,r=!1){let n=t.cloner;if(n)for(let s of n.children){let a=bYe.copy(s.matrixWorld).invert(),o=wYe.copy(e.ray).applyMatrix4(a),l=t.matrixWorld;o.applyMatrix4(l);let c=xYe;c.set(o.origin,o.direction),c.near=e.near,c.far=e.far;let h=c.intersectObject(t,!1);h.length>0&&i.push({...h[0],object:r?s:t})}}var SYe=class{constructor(){this._constraints=new Map}setConstraint(t,e){e===null?this._constraints.delete(t):this._constraints.set(t,e)}removeDependencies(t){this._constraints.delete(t)}applyConstraints(t){let e=new Set;this._constraints.forEach((i,r)=>{let n=[r,i],s=i;for(;this._constraints.has(s);){if(s=this._constraints.get(s),n.includes(s)){console.warn(`circular dependency detected: ${n.join(" -> ")}`);break}e.has(s)||n.push(s)}for(let a=n.length-2;a>=0;a--)if(!e.has(n[a])){let o=t.find(n[a]);o?o.applyPathSnapping(t):console.warn(`missing entity ${n[a]}`),e.add(n[a])}})}findDependency(t,e){let i=t;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===e)return!0;return!1}},_Ye="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL",Uf=class{};Ib(Uf,"DepthMapRange",65536),Ib(Uf,"MemoryPageSize",65536),Ib(Uf,"BytesPerFloat",4),Ib(Uf,"BytesPerInt",4);function AYe(t){let e,i,r,n,s,a,o,l,c,h,u,d,f,p,m,g;function v(D){let B=new Float64Array(h,a,16);for(let L=0;L<16;L++)B[L]=D[L];let O;if(r>1){e.exports.sortIndexes(n,s,c,a,o,l,d.DepthMapRange,r);let L=new Uint32Array(r);O=L.buffer,L.set(new Uint32Array(h,l,r))}else if(r===1){let L=new Uint32Array(r);L[0]=new Uint32Array(h,n,i)[0],O=L.buffer}else O=new ArrayBuffer(0);t.postMessage({sortDone:!0,indexesBuffer:O},[O])}function y(D,B,O){let L=new Float32Array(h,s,i*3);r=0;let H=new Uint32Array(h,n,i);for(let q=0;q<O.length-1;q++){let W=B[q],I=D[q].elements,z=W.filter(X=>X.enabled&&X.mode==="Include").map(X=>X.type==="Box"?_(X):T(X)),U=W.filter(X=>X.enabled&&X.mode==="Exclude").map(X=>X.type==="Box"?_(X):T(X));for(let X=O[q];X<O[q+1];X++){let Q=f[X*3],re=f[X*3+1],ie=f[X*3+2];if((z.length===0||S(Q,re,ie,z))&&(U.length===0||!S(Q,re,ie,U))){let ce=1/(I[3]*Q+I[7]*re+I[11]*ie+I[15]);L[r*3]=(I[0]*Q+I[4]*re+I[8]*ie+I[12])*ce,L[r*3+1]=(I[1]*Q+I[5]*re+I[9]*ie+I[13])*ce,L[r*3+2]=(I[2]*Q+I[6]*re+I[10]*ie+I[14])*ce,H[r]=X,r++}}}}function x(D,B){let O=[],L=B.filter(W=>W.enabled&&W.mode==="Include").map(W=>W.type==="Box"?_(W):T(W)),H=B.filter(W=>W.enabled&&W.mode==="Exclude").map(W=>W.type==="Box"?_(W):T(W)),q=D.length;for(let W=0;W<q;W+=3){let I=D[W],z=D[W+1],U=D[W+2];(L.length===0||S(I,z,U,L))&&(H.length===0||!S(I,z,U,H))||O.push(W/3)}return O}function S(D,B,O,L,H){return L.some(q=>{let W=A(D,B,O,q.invRotationMatrix,q.cropCenter);return Array.isArray(q)?E(W.x,W.y,W.z,q):C(W.x,W.y,W.z,q)})}function A(D,B,O,L,H){let q=D-H[0],W=B-H[1],I=O-H[2],z=1/(L[3]*q+L[7]*W+L[11]*I+L[15]);return{x:(L[0]*q+L[4]*W+L[8]*I+L[12])*z+H[0],y:(L[1]*q+L[5]*W+L[9]*I+L[13])*z+H[1],z:(L[2]*q+L[6]*W+L[10]*I+L[14])*z+H[2]}}function _(D){let B=D.cropSize[0]/2,O=D.cropSize[1]/2,L=D.cropSize[2]/2,H=[D.cropCenter[0]-B,D.cropCenter[1]-O,D.cropCenter[2]-L,D.cropCenter[0]+B,D.cropCenter[1]+O,D.cropCenter[2]+L],q=M(D.cropRotation);return Object.assign(H,{invRotationMatrix:q,cropCenter:D.cropCenter})}function M(D){let B=[],O=D[0]*Math.PI/180,L=D[1]*Math.PI/180,H=D[2]*Math.PI/180,q=Math.cos(O),W=Math.sin(O),I=Math.cos(L),z=Math.sin(L),U=Math.cos(H),X=Math.sin(H),Q=q*U,re=q*X,ie=W*U,ce=W*X;return B[0]=I*U,B[1]=-I*X,B[2]=z,B[4]=re+ie*z,B[5]=Q-ce*z,B[6]=-W*I,B[8]=ce-Q*z,B[9]=ie+re*z,B[10]=q*I,B[12]=0,B[13]=0,B[14]=0,B[3]=0,B[7]=0,B[11]=0,B[15]=1,B}function E(D,B,O,L){return D>=L[0]&&D<=L[3]&&B>=L[1]&&B<=L[4]&&O>=L[2]&&O<=L[5]}function T(D){let B=2/D.cropSize[0],O=2/D.cropSize[1],L=2/D.cropSize[2],H=M(D.cropRotation);return{invRadiusX:B,invRadiusY:O,invRadiusZ:L,cropCenter:D.cropCenter,invRotationMatrix:H}}function C(D,B,O,L){let H=(D-L.cropCenter[0])*L.invRadiusX,q=(B-L.cropCenter[1])*L.invRadiusY,W=(O-L.cropCenter[2])*L.invRadiusZ;return H*H+q*q+W*W<=1}t.onmessage=D=>{if(D.data.getCroppedIndexes){let B=new Uint32Array(x(new Float32Array(D.data.positions),D.data.crops)).buffer;t.postMessage({outOfBoundsIndexes:B},[B])}else if(D.data.positions)u=D.data.positions,f=new Float32Array(u),m=D.data.meshMatrixWorlds,g=D.data.cropsArray,p=D.data.meshIndexIntervals,y(m,g,p),t.postMessage({sortSetupComplete:!0});else if(D.data.sort||D.data.newMatrixWorlds||D.data.newCropsArray)(D.data.newMatrixWorlds||D.data.newCropsArray)&&(g=D.data.newCropsArray||g,m=D.data.newMatrixWorlds||m,y(m,g,p)),v(D.data.sort.view,D.data.sort.cameraPosition);else if(D.data.init){d=D.data.init.Constants,i=D.data.init.splatCount;let B=d.BytesPerInt,O=d.BytesPerFloat*3,L=new Uint8Array(D.data.init.sorterWasmBytes),H=B+O,q=i*H,W=i*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2,I=d.MemoryPageSize*32,z=q+W+I,U=Math.floor(z/d.MemoryPageSize)+1,X={module:{},env:{memory:new WebAssembly.Memory({initial:U*2,maximum:U*3,shared:!0})}};WebAssembly.compile(L).then(Q=>WebAssembly.instantiate(Q,X)).then(Q=>{e=Q,n=0,s=i*B,a=s+i*O,c=a+16*d.BytesPerFloat*2,o=c+i*d.BytesPerInt,l=o+d.DepthMapRange*d.BytesPerInt,h=X.env.memory.buffer,t.postMessage({sortSetupPhase1Complete:!0})})}}}function EYe(t){let e=new Worker(URL.createObjectURL(new Blob(["(",AYe.toString(),")(self)"],{type:"application/javascript"}))),i=atob(_Ye),r=new Uint8Array(i.length);for(let n=0;n<i.length;n++)r[n]=i.charCodeAt(n);return e.postMessage({init:{sorterWasmBytes:r.buffer,splatCount:t,Constants:{BytesPerFloat:Uf.BytesPerFloat,BytesPerInt:Uf.BytesPerInt,DepthMapRange:Uf.DepthMapRange,MemoryPageSize:Uf.MemoryPageSize}}}),e}var UO=function(){let t=new Float32Array(1),e=new Int32Array(t.buffer);return function(i){return t[0]=i,e[0]}}(),MYe=function(t,e,i,r){return t+(e<<8)+(i<<16)+(r<<24)},bT=new ye;function sQ(t){let e=!1;return t.scene.objects.traverse((i,r)=>{if(r.visible===!1)return!0;r.type==="Splat"&&(e=!0)}),e}var wC=class extends vr{constructor(t,e,i,r,n=!1,s=1,a,o){super(i,r),this.splatCount=e,this.meshIndexIntervals=a,this.meshMatrixWorlds=o,this.splatBuffers=t,this.geometry=i,this.material=r,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=n,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(t,e,i=!1,r=1,n,s){let a=wC.buildGeomtery(e),o=wC.buildMaterial(n);return new wC(t,e,a,o,i,r,n,s)}static buildMaterial(t){let e=`
            precision highp float;
            #include <common>

            attribute uint splatIndex;

            uniform highp sampler2D covariancesTexture;
            uniform highp usampler2D centersColorsTexture;
            uniform vec2 focal;
            uniform vec2 viewport;
            uniform vec2 basisViewport;
            uniform vec2 covariancesTextureSize;
            uniform vec2 centersColorsTextureSize;
						uniform highp sampler2D meshMatrixWorldsTexture;
						uniform uint meshIndexIntervals[257];
						uniform float orthoZoom;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;

            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);
            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));
            const uvec4 shift4 = uvec4(0, 8, 16, 24);
            vec4 uintToRGBAVec (uint u) {
               uvec4 urgba = mask4 & u;
               urgba = urgba >> shift4;
               vec4 rgba = vec4(urgba) * encodeNorm4;
               return rgba;
            }

            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {
                vec2 samplerUV = vec2(0.0, 0.0);
                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;
                samplerUV.y = float(floor(d)) / dimensions.y;
                samplerUV.x = fract(d);
                return samplerUV;
            }

            void main () {
                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));
                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));
                vColor = uintToRGBAVec(sampledCenterColor.r);

                vPosition = position.xy * 2.0;

								uint meshIndex;
								for (int i = 1; i < 257; i++) {
									if (splatIndex < meshIndexIntervals[i]) {
										meshIndex = uint(i - 1);
										break;
									}
								}

								float strideMulmeshIndex = float(4u*meshIndex);
								float meshMatrixWorldsTextureLength = float(256*4);

								mat4 modelMat = mat4(
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))
								);
								mat4 modelViewMat = viewMatrix * modelMat;
								vec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); 
                vec4 clipCenter = projectionMatrix * viewCenter;

                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;
                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;
                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;

                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);
                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);

                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix
                mat3 Vrk = mat3(
                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,
                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,
                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z
                );
                float s = 1.0 / (viewCenter.z * viewCenter.z);

                mat3 W = transpose(mat3(modelViewMat));
                mat3 T = orthoZoom > 0.0 ? W : W * mat3(
									focal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,
									0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,
									0., 0., 0.
								);
                mat3 cov2Dm = transpose(T) * Vrk * T;
                cov2Dm[0][0] += 0.3;
                cov2Dm[1][1] += 0.3;

                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because
                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],
                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't
                // need cov2Dm[1][0] because it is a symetric matrix.
                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);

                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;

                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix
                // so that we can determine the 2D basis for the splat. This is done using the method described
                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html
                //
                // This is a different approach than in the original work at INRIA. In that work they compute the
                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle
                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance
                // matrix (called 'conic') to determine fragment opacity.
                float a = cov2Dv.x;
                float d = cov2Dv.z;
                float b = cov2Dv.y;
                float D = a * d - b * b;
                float trace = a + d;
                float traceOver2 = 0.5 * trace;
                float term2 = sqrt(trace * trace / 4.0 - D);
                float eigenValue1 = traceOver2 + term2;
								float eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value

                const float maxSplatSize = 1024.0;
                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));
                // since the eigen vectors are orthogonal, we derive the second one from the first
                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);
                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);
                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);

                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;

								if (orthoZoom > 0.0) {
									ndcOffset *= orthoZoom;
								}

                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            }`,i=`
            precision highp float;
            #include <common>

            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;
						layout(location = 1) out vec4 gVelocity; 

            void main () {
                // compute the negative squared distance from the center of the splat to the
                // current fragment in the splat's local space.
                float A = -dot(vPosition, vPosition);
                if (A < -4.0) discard;
                vec3 color = vColor.rgb;
                A = exp(A) * vColor.a;
                gl_FragColor = vec4(color.rgb, A);
								gVelocity = vec4(0.0); // so it is ignored by TAA
            }`,r={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:t},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new ye},viewport:{type:"v2",value:new ye},basisViewport:{type:"v2",value:new ye},debugColor:{type:"v3",value:new Xt},covariancesTextureSize:{type:"v2",value:new ye(1024,1024)},centersColorsTextureSize:{type:"v2",value:new ye(1024,1024)},orthoZoom:{type:"f",value:-1}};return new Ri({uniforms:r,vertexShader:e,fragmentShader:i,transparent:!0,alphaTest:1,blending:mg,depthTest:!0,depthWrite:!1,side:pa})}static buildGeomtery(t){let e=new Nt;e.setIndex([0,1,2,0,2,3]);let i=new Float32Array(4*3),r=new Yt(i,3);e.setAttribute("position",r),r.setXYZ(0,-1,-1,0),r.setXYZ(1,-1,1,0),r.setXYZ(2,1,1,0),r.setXYZ(3,1,-1,0),r.needsUpdate=!0;let n=new Kse().copy(e),s=new Uint32Array(t),a=new fS(s,1,!1);return a.setUsage(ePe),n.setAttribute("splatIndex",a),n.instanceCount=t,n}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(r=>r.buildPreComputedBuffers()),this.covariances=new Float32Array(this.splatCount*6),this.colors=new Uint8Array(this.splatCount*4),this.centers=new Float32Array(this.splatCount*3);let t=0,e=0,i=0;for(let r of this.splatBuffers){let n=r.nsplats;this.colors.subarray(t,t+n*4).set(r.colorsA),t+=n*4,this.centers.subarray(e,e+n*3).set(r.decoded.xyz.denormDequant().data),e+=n*3,this.covariances.subarray(i,i+n*6).set(new Float32Array(r.precomputedCovarianceBufferData)),i+=n*6}}allocateAndStoreLocalSplatDataInTextures(){let t=this.splatCount,e=new ye(4096,1024);for(;e.x*e.y*2<t*6;)e.y*=2;let i=new ye(4096,1024);for(;i.x*i.y*4<t*4;)i.y*=2;let r,n;if(this.halfPrecisionCovariancesOnGPU){n=new Uint16Array(e.x*e.y*2);for(let h=0;h<this.covariances.length;h++)n[h]=ROe.toHalfFloat(this.covariances[h]);r=new Ua(n,e.x,e.y,b2,fd)}else n=new Float32Array(e.x*e.y*2),n.set(this.covariances),r=new Ua(n,e.x,e.y,b2,tr);r.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=r,this.material.uniforms.covariancesTextureSize.value.copy(e);let s=new Uint32Array(i.x*i.y*4);for(let h=0;h<t;h++){let u=h*4,d=h*3,f=h*4;s[f]=MYe(this.colors[u],this.colors[u+1],this.colors[u+2],this.colors[u+3]),s[f+1]=UO(this.centers[d]),s[f+2]=UO(this.centers[d+1]),s[f+3]=UO(this.centers[d+2])}let a=new Ua(s,i.x,i.y,use,Ku);a.internalFormat="RGBA32UI",a.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=a,this.material.uniforms.centersColorsTextureSize.value.copy(i);let o=256*4,l=new Float32Array(256*16);for(let h=0;h<this.meshMatrixWorlds.length;h++)l.set(this.meshMatrixWorlds[h].elements,h*16);let c=new Ua(l,o,1,Fr,tr);c.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=c,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:n,texture:r,size:e},centerColors:{data:s,texture:a,size:i},meshMatrixWorlds:{data:l,texture:c}}}updateIndexes(t){let e=this.geometry;e.attributes.splatIndex.set(t),e.attributes.splatIndex.needsUpdate=!0,e.instanceCount=t.length}updateUniforms(t,e,i,r){this.splatCount>0&&(bT.set(t.x*this.devicePixelRatio,t.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(bT),this.material.uniforms.basisViewport.value.set(2/bT.x,2/bT.y),this.material.uniforms.focal.value.set(e,i),this.material.uniforms.orthoZoom.value=r,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},dce,TYe=new Promise(t=>{dce=t}),aQ=!1,wT;function CYe(){if(aQ)return;if(wT)return wT;async function t(){let e=await Td(()=>import("./gaussian-splat-compression-ro4O0smp.js"),[]);dce(e),aQ=!0}return wT=t(),wT}var fce;TYe.then(t=>fce=t);var PYe=class{constructor(t={}){Ib(this,"updateView",function(){let e=new st,i=[],r=new N(0,0,-1),n=new N(0,0,-1),s=new N,a=new N;return function(o=!1,l){let c=this.updateMatrixWorldsInWorkerIfNeeded(),h=this.cropsChanged();if(!o){n.set(0,0,-1).applyQuaternion(l.quaternion);let d=!1,f=!1;if(n.dot(r)<=.95&&(d=!0),a.copy(l.position).sub(s).length()>=1&&(f=!0),!d&&!f&&!c&&!h&&!this.needsInitialRender)return}this.needsInitialRender=!1,s.copy(l.position),r.copy(n),e.copy(l.matrixWorld).invert(),e.premultiply(this.dummyPerspectiveMatrix),i[0]=l.position.x,i[1]=l.position.y,i[2]=l.position.z;let u={sort:{view:e.elements,cameraPosition:i,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...c?{newMatrixWorlds:this.meshMatrixWorlds}:{},...h?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=u:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(u))}}()),this.scene=t.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=new st().makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(t,e){let i=new ye;this.splatMesh!==null&&this.splatMesh.getSplatCount()>0&&(t.getSize(i),this.cameraFocalLengthX=e.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=e.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,e.isPerspectiveCamera?-1:e.zoom*this.devicePixelRatio))}loadSplat(t={}){this.activePage=this.scene.activePage,t.position&&(t.position=new N().fromArray(t.position)),t.orientation&&(t.orientation=new ri().fromArray(t.orientation)),t.halfPrecisionCovariances=!!t.halfPrecisionCovariances;let e=[];if(this.splatEntries=e,this.activePage.traverseVisibleEntity(s=>{s.data.type==="Splat"&&e.push(s)}),this.splatMesh&&this.splatMesh.dispose(),e.length===0)return this.splatMesh=null,!1;this.meshMatrixWorlds=e.map(s=>s.matrixWorld),this.meshMatrixWorldsOld=e.map(s=>s.matrixWorld.clone()),this.cropsArray=e.map(s=>s.data.crops.map(a=>a.data));let i=e.map(s=>new fce.GSplineBuffer(new Uint8Array(s.data.buffer).buffer)),r=0,n=[0];for(let s of i)r+=s.getSplatCount(),n.push(r);return this.setupSplatMesh(i,r,t.position,t.orientation,t.halfPrecisionCovariances,this.devicePixelRatio,n,this.meshMatrixWorlds),this.setupSortWorker(r),!0}updateMatrixWorldsInWorkerIfNeeded(){let t=this.splatDataTextures.meshMatrixWorlds.data;for(let e=0;e<this.meshMatrixWorlds.length;e++)t.set(this.meshMatrixWorlds[e].elements,e*16);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,this.meshMatrixWorlds.every((e,i)=>e.equals(this.meshMatrixWorldsOld[i]))?!1:(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(e=>e.clone()),!0)}cropsChanged(){let t=!1;return this.splatEntries.forEach((e,i)=>{var r;e.data.crops.forEach((n,s)=>{this.cropsArray[i][s]===void 0?(t=!0,this.cropsArray[i][s]=n.data):Object.entries(n.data).forEach(([a,o])=>{var l;Array.isArray(o)&&o.some((c,h)=>c!==this.cropsArray[i][s][a][h])?(t=!0,this.cropsArray[i][s][a]=o):o!==((l=this.cropsArray[i][s])==null?void 0:l[a])&&(t=!0,this.cropsArray[i][s][a]=o)})}),e.data.crops.length!==((r=this.cropsArray[i])==null?void 0:r.length)&&(this.cropsArray[i].length=e.data.crops.length,t=!0)}),t}setupSplatMesh(t,e,i=new N,r=new ri,n=!1,s=1,a,o){this.splatMesh=wC.buildMesh(t,e,n,s,a,o),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(r),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=e,this.splatMesh.onBeforeRender=(l,c,h)=>this.update(l,h)}setupSortWorker(t){this.sortWorker=EYe(t),this.sortWorker.onmessage=e=>{var i;e.data.sortDone?(this.sortRunning=!1,(i=this.splatMesh)==null||i.updateIndexes(new Uint32Array(e.data.indexesBuffer)),this.lastSortTime=e.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):e.data.sortCanceled?this.sortRunning=!1:e.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):e.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(t,e){this.splatMesh!==null&&(this.updateSplatMeshUniforms(t,e),this.updateView(!1,e))}getSplatMesh(){return this.splatMesh}},yU=new pd;yU.wireframe=!0;var oQ=new N,jG=class extends go{constructor(t,e){super(),this.data=t,this.sharedAssets=e,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.shapeBlendIntances=[],this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new SYe,this.invisibleObjects=new Fy("jflkdsafjasdifjaslk",{...AN.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(t,e),this.matrixAutoUpdate=!1,this.errorPage=new ws("fdasfa",{...g1.defaultData,name:""},{shared:e,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=yYe(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=vYe(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(t){let e=t.identity.join("-"),i=this.entityIdentityToEntity[e];i&&(t.uuid=i.uuid),this.entityIdentityToEntity[e]=t,this.entityByUuid[t.uuid]=t}markPenumbraSizeDirty(){for(let t of this.children)t instanceof ws&&(t.penumbraSizeArrayCache=null)}findInstance(t){return this.entityIdentityToEntity[t.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(t){let e=this.find(t);if(e===void 0)return;let i=[],r=e;for(;r!==this;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:e,sortKey:i}}getAllSorted(t){let e=[];for(let i of t){let r=this.getWithSortKey(i.id);r!==void 0&&e.push(r)}return e.sort((i,r)=>kae(i.sortKey,r.sortKey)),e.map(i=>i.entity)}nonExistOrDescendantOf(t,e){let i=this.find(t);if(i===void 0)return!0;for(;i;){if(i.uuid===e)return!0;i=i.parent}return!1}find(t){if(this.activePage&&this.activePage.personalCamera.parent){if(t==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(t===J1)return this.activePage.personalCamera}if(t===""||t===void 0)return;let e=this.entityByUuid[t];return e===void 0?this.getObjectByProperty("uuid",t):e}find2D(t){for(let e of this.children)if(e instanceof ws&&e.uiScene){let i=e.uiScene.find(t);if(i)return i}}findScene2DfromObject2D(t){for(let e of this.children)if(e instanceof ws&&e.uiScene&&e.uiScene.find(t))return e.uiScene}find2DInUIObjects(t){let e;return this.traverseEntity(i=>{e===void 0&&i instanceof da&&(e=i.uiCanvas.find(t))}),e}traverse2D(t){for(let e of this.children)e instanceof ws&&e.uiScene&&e.uiScene.traverse(t)}debugEnsureEntity(t){let e=this.find(t);if(e){if(Array.isArray(e.identity)&&this.findInstance(e.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(t){this.toExpandCloner.add(t)}addPendingUpdateCloner(t){this.toUpdateCloner.add(t)}markToExpandCloner(t){this.toExpandCloner.add(t),t.traverseEntityAncestors(e=>{this.toExpandCloner.add(e)})}doPendingExpandCloner(){this.toExpandCloner.forEach(t=>{t.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(t=>{var e;(e=t.cloner)==null||e.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(t){this.pendingCommands.push(t)}applyPendingCommands(){this.pendingCommands.forEach(t=>t()),this.pendingCommands.length=0}updateByLibOp(t,e){t.path.length===1&&t.path[0]==="components"&&t.type===1&&this.createChildrenObjects([{...t.data.asset,id:t.id}],this.invisibleObjects,e)}updateTreeByOp(t,e){var i;if(t.path.length===0&&t.type===7){let r=t.parent===null?this:this.find(t.parent);if(r===void 0)throw new Error("unexpected");let n=this.createObject(t.id,t.data,t.children,r,t.localIndex,e);n.updateVisible(this),n.resetBBoxNeedsUpdate(),wc(n)&&Zu(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n),this.markPenumbraSizeDirty(),n.updatePathSnapping()}else if(t.path.length===0&&t.type===8){let r=this.find(t.id);if(r===void 0)throw new Error("unexpected");r.traverseEntity(s=>{s instanceof qg&&(this.shapeBlendIntances=this.shapeBlendIntances.filter(a=>a!==s))}),this.markToExpandCloner(r),r.resetBBoxNeedsUpdate(),this.unregisterObject(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(r),this.markPenumbraSizeDirty(),r.parent.remove(r),Zu(r.parent)&&(r.parent.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),wc(r)&&(r.freeBooleanPointer(),n instanceof Yg&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r instanceof zG&&r.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),this.pathConstraints.removeDependencies(r.uuid),r.updatePathSnapping()}else if(t.path.length===0&&t.type===9){let r=this.find(t.id);if(r===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),(i=r.cloner)==null||i.resetOnMove(),this.markToExpandCloner(r);let s=t.parent===null?this:this.find(t.parent);if(s===void 0)throw new Error("unexpected");s.add(r),this.markNeedsRecomputeInstancesForAncessors(s),this.markToExpandCloner(r),r.invalidateClonerTransform(r),r.updateVisible(this),r.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let a=t.localIndex;s.children.splice(a,0,s.children.pop()),wc(r)&&(r.invalidateUpstreamBooleanData(),Zu(r.parent)?r.parent.invalidateDownstreamBooleanData().recomputeBoolean():n instanceof Yg&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(t){var e;this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let i of this.children)i instanceof ws&&(i.visible=i.uuid===t,i.visible&&(this.activePage=i,this.activePage.onActive(this)));this.activePage!==((e=this.splatViewer)==null?void 0:e.activePage)&&this.reloadSplats()}updateEntityByOp(t,e,i,r){if(e.type===0){if(("overrides"in e.props||"component"in e.props)&&this.markNeedsRecomputeInstances(),"visible"in e.props&&this.markPenumbraSizeDirty(),e.path.includes("overrides")&&"states"in e.props){let{rest:s}=e.props;e={...e,props:s},this.markNeedsRecomputeInstances()}e.path[0]==="pathSnapping"&&e.props.pathId!==void 0&&this.pathConstraints.setConstraint(t,e.props.pathId)}let n=this.find(t);if(n)try{cYe(n,e,i,{scene:this,shared:r}),n instanceof Fn&&n.updateGeometryGroupsIfNeeded()}catch(s){console.error(s)}}updateEntity2DByOp(t,e,i,r,n,s=[]){t.updateEntityByOp(e,i,r,n),this.traverseEntity(a=>{(a instanceof da||a instanceof ws)&&(s.includes(a.frameId??"")||a.frameId===e)&&a.updateEntity2DByOp(e,i,r,n)})}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(t){this.activePage.switchActiveCamera(t)}isInvisibleObjects(t){return t===this.invisibleObjects||t.hasAnccestor(this.invisibleObjects)}init(t,e){let i=Object.entries(e.data.lib.components).map((r,n)=>({data:r[1].asset.data,children:r[1].asset.children,id:r[0],fi:n}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:e}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,e),this.createChildrenObjects(t.objects,this,e),this.updatePage(t.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(e,!0),this.traverseEntity(r=>{r instanceof ga&&r.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(t){t.traverseEntity(e=>{(e.data.type==="Component"||e.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(t){Ti.is(t)&&(t.data.type==="Component"&&this.markNeedsRecomputeInstances(),t.traverseAncestors(e=>{Ti.is(e)&&e.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(t,e,i,r,n,s,a){if(t){let o=r.find(t);o&&o!==r&&n.forInstancesRec(l=>{l.data=_S(l.data,c=>{let h=c.events.data(a.id),u=l.goUp(s);if(u){let d=[...Fae(u.identity),t].join("-"),f=this.entityIdentityToEntity[d];if(f){let p=f.uuid,m=es.zoom(h,e);m[i]=p}else console.warn("cannot find instance")}}).data})}}rewriteActions(t,e,i,r,n,s){t.forEach(a=>{a.data.type==="Transition"?this.relativeizeInner(a.data.object,[...e,a.id],"object",i,r,n,s):a.data.type==="Animation"?this.relativeizeInner(a.data.object,[...e,a.id],"object",i,r,n,s):a.data.type==="Conditional"&&(this.rewriteActions(a.data.ifActions,[...e,a.id,"ifActions"],i,r,n,s),this.rewriteActions(a.data.elseActions,[...e,a.id,"elseActions"],i,r,n,s))})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(t=>{if(t instanceof ky&&typeof t.identity=="string"&&t.data.type==="Component")return t.traverseEntity((e,i)=>{e.data.events.forEach(r=>{if(r.data.type==="GameControl"){let n=!1;if(e.forInstancesRec(s=>{s.data=_S(s.data,a=>{s.isInstanceRoot||(a.events.delete(r.id),n=!0)}).data}),n===!1)for(let s of iP.list)this.rewriteActions(r.data.gameActions[s],["gameActions",s],t,e,i,r)}else r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",t,e,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",t,e,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",t,e,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,t,e,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,t,e,i,r)),this.rewriteActions(r.data.inActions,["inActions"],t,e,i,r),this.rewriteActions(r.data.outActions,["outActions"],t,e,i,r)):"actions"in r.data&&this.rewriteActions(r.data.actions,["actions"],t,e,i,r)})}),!0})}expandInstances(t,e,i){let r=new Set;this.traverseEntity(n=>{if(n instanceof ky&&n.isInstanceRoot)return n.expandInstanceChildren({scene:this,shared:t,pendingDeletes:r}),e||n.resetBBoxNeedsUpdate(),i&&n.traverseEntity(s=>{i.addClip(s)}),!0});for(let n of r)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),VG(n)}recomputeInstances(t,e){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof ky&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(t,!1,e))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(t){t.traverseEntity(e=>{let i=typeof e.identity=="string"?e.identity:e.identity.join("-");this.entityIdentityToEntity[i]===e&&(delete this.entityByUuid[e.uuid],delete this.entityIdentityToEntity[i]),e.dispose()})}clearScene(){for(let t of this.children)Ti.is(t)&&t.disposeRecursively();this.children.length=0}resetAfterClear(t,e){this.init(t,e)}raycast(t){return this.raycast1(t,!1)}raycast1(t,e){let i=[],r=n=>{for(let s of n.children){let a=s.cloner;if(Ti.is(s)&&!s.raycastLock&&(s.visible||a!=null&&a.object.data.visible))if(e===!0&&s.isInstanceRoot){let o=[];if(t.intersectObject(s,!0,o),o.length){let l=o[0];l.object=s,l.point.applyMatrix4(l.object.matrixWorld);let c=s.matrixWorld.clone().invert();l.point.applyMatrix4(c),i.push(l)}}else(wc(s)||aU(s)&&this.enableHelpers&&s.objectHelper.visible)&&(t.intersectObject(s,!1,i),vU(s,t,i)),r(s)}};return r(this.activePage),i}raycastWithClones(t){let e=[],i=r=>{for(let n of r.children){let s=n.cloner;Ti.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((wc(n)||aU(n)&&this.enableHelpers&&n.objectHelper.visible)&&(t.intersectObject(n,!1,e),vU(n,t,e,!0)),i(n))}};return i(this),e}forEachEntity(t){for(let e of this.children)Ti.is(e)&&t(e)}traverseConcreteEntity(t){for(let e of this.children)Ti.is(e)&&e.isConcreteEntity&&e.traverseEntity(t)}traverseEntity(t){for(let e of this.children)Ti.is(e)&&e.traverseEntity(t)}updateFont(t,e){this.traverseEntity(i=>{if(i instanceof Fn&&i.data.type==="Mesh"&&(i.data.geometry.type==="TextGeometry"||i.data.geometry.type==="InputGeometry")&&i.data.geometry.font===t){let r=i.geometry,n=i.data.geometry;r.updateFont(t,e).then(()=>{r.update(n);let s=i.invalidateDownstreamBooleanData();Zu(s)&&s.recomputeBoolean()})}})}traverseObject(t){for(let e of this.children)Wg.is(e)&&e.traverseObject(t)}traverseVisibleEntity(t){for(let e of this.children)Ti.is(e)&&e.visible&&e.traverseVisibleEntity(t)}dispose(){this.clearScene()}createChildrenObjects(t,e,i){let r=0;for(let n of t)this.createObject(n.id,n.data,n.children,e,r,i),r+=1}registerObjectCreatedInLegacy(t){this.entityByUuid[t.uuid]=t}unregisterObject(t){delete this.entityByUuid[t.uuid];for(let e of t.children)this.unregisterObject(e)}createObject(t,e,i,r,n,s){var l;let a={scene:this,shared:s},o=HG(t,e,a);return o instanceof qg&&this.shapeBlendIntances.push(o),o&&(this.entityByUuid[t]=o,r.add(o),r.children.splice(n,0,r.children.pop()),i.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,o,s)),o.updateState(e,a),o instanceof Fn&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(this),o.cloner&&this.toExpandCloner.add(o),(l=e.pathSnapping)!=null&&l.pathId&&this.pathConstraints.setConstraint(t,e.pathSnapping.pathId)),e.type==="Empty"&&e.animations&&o.traverseEntity(c=>{let h=c.dataPatched;if(c instanceof Fn&&h.bones&&h.boneInverses){let u=h.bones.map(p=>this.find(p)),d=h.boneInverses.map(p=>new st().fromArray(p)),f=new D5(u,d);c.bind(f,c.bindMatrix)}else c.matrixAutoUpdate=!0}),o}getCenter(t){let e=[];for(let r=0,n=t.length;r<n;++r){let{id:s,recursive:a}=t[r],o=this.find(s),l=a?o.recursiveBBox:o.singleBBox;e.push(...l.vertices)}let i=new _n;return i.setFromPoints(e),i.getCenter(oQ),oQ}copyMatrixWorld(t,e){if(t===null){e.identity();return}let i=this.find(t);i?e.copy(i.matrixWorld):e.identity()}copyParentMatrixWorld(t,e){var r;if(t===null){e.identity();return}let i=(r=this.find(t))==null?void 0:r.parent;i?e.copy(i.matrixWorld):e.identity()}traverseMaterial(t){this.traverseEntity(e=>{if(e instanceof ja)if(Array.isArray(e.material))for(let i=0;i<e.material.length;i++)e.material[i]instanceof xp&&t(e.material[i]);else e.material instanceof xp&&t(e.material)})}updateViewPlaneSize(t,e,i=!1){this.traverseConcreteEntity(r=>{r instanceof ga&&r.setViewplaneSize(t,e,i)})}initializeSplatViewer(){this.splatViewer=new PYe({scene:this}),this.reloadSplats()}reloadSplats(){var t;(t=this.splatViewer)==null||t.loadSplat()}},SC=(t,e)=>{let i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)},DYe=(t,e)=>{let i=e.x-t.x,r=e.y-t.y;return IYe(Math.atan2(r,i))},RYe=(t,e,i)=>{let r={x:0,y:0};return i=xU(i),r.x=t.x-e*Math.cos(i),r.y=t.y-e*Math.sin(i),r},xU=t=>t*(Math.PI/180),IYe=t=>t*(180/Math.PI),LYe=t=>isNaN(t.buttons)?t.pressure!==0:t.buttons!==0,zO=new Map,lQ=t=>{zO.has(t)&&clearTimeout(zO.get(t)),zO.set(t,setTimeout(t,100))},xP=(t,e,i)=>{let r=e.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],t.addEventListener?t.addEventListener(n,i,!1):t.attachEvent&&t.attachEvent(n,i)},cQ=(t,e,i)=>{let r=e.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],t.removeEventListener?t.removeEventListener(n,i):t.detachEvent&&t.detachEvent(n,i)},pce=t=>(t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t),hQ=()=>{if(typeof window>"u")return;let t=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:t,y:e}},bU=(t,e)=>{e.top||e.right||e.bottom||e.left?(t.style.top=e.top,t.style.right=e.right,t.style.bottom=e.bottom,t.style.left=e.left):(t.style.left=e.x+"px",t.style.top=e.y+"px")},WG=(t,e,i)=>{let r=mce(t);for(let n in r)if(r.hasOwnProperty(n))if(typeof e=="string")r[n]=e+" "+i;else{let s="";for(let a=0,o=e.length;a<o;a+=1)s+=e[a]+" "+i+", ";r[n]=s.slice(0,-2)}return r},OYe=(t,e)=>{let i=mce(t);for(let r in i)i.hasOwnProperty(r)&&(i[r]=e);return i},mce=t=>{let e={};return e[t]="",["webkit","Moz","o"].forEach(function(i){e[i+t.charAt(0).toUpperCase()+t.slice(1)]=""}),e},GO=(t,e)=>{for(let i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},BYe=(t,e)=>{let i={};for(let r in t)t.hasOwnProperty(r)&&e.hasOwnProperty(r)?i[r]=e[r]:t.hasOwnProperty(r)&&(i[r]=t[r]);return i},wU=(t,e)=>{if(t.length)for(let i=0,r=t.length;i<r;i+=1)e(t[i]);else e(t)},FYe=(t,e,i)=>({x:Math.min(Math.max(t.x,e.x-i),e.x+i),y:Math.min(Math.max(t.y,e.y-i),e.y+i)});typeof window<"u"&&(gce="ontouchstart"in window,vce=!!window.PointerEvent,yce=!!window.MSPointerEvent);var gce,vce,yce,yb={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},ly,LS={};vce?ly=yb.pointer:yce?ly=yb.MSPointer:gce?(ly=yb.touch,LS=yb.mouse):ly=yb.mouse;function l0(){}l0.prototype.on=function(t,e){var i=this,r=t.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(e);return i};l0.prototype.off=function(t,e){var i=this;return i._handlers_=i._handlers_||{},t===void 0?i._handlers_={}:e===void 0?i._handlers_[t]=null:i._handlers_[t]&&i._handlers_[t].indexOf(e)>=0&&i._handlers_[t].splice(i._handlers_[t].indexOf(e),1),i};l0.prototype.trigger=function(t,e){var i=this,r=t.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(a){a.call(i,{type:n,target:i},e)})};l0.prototype.config=function(t){var e=this;e.options=e.defaults||{},t&&(e.options=BYe(e.options,t))};l0.prototype.bindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){typeof i["on"+e]=="function"?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},xP(t,ly[e],i._domHandlers_[e]),LS[e]&&xP(t,LS[e],i._domHandlers_[e]),i};l0.prototype.unbindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},cQ(t,ly[e],i._domHandlers_[e]),LS[e]&&cQ(t,LS[e],i._domHandlers_[e]),delete i._domHandlers_[e],this};var XG=l0;function os(t,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=os.id,os.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}os.prototype=new XG;os.constructor=os;os.id=0;os.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};os.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",e=OYe("borderRadius","50%"),i=WG("transition","opacity",t),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},GO(r.el,i),this.options.shape==="circle"&&GO(r.back,e),GO(r.front,e),this.applyStyles(r),this};os.prototype.applyStyles=function(t){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in t[e])this.ui[e].style[i]=t[e][i];return this};os.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};os.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};os.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};os.prototype.show=function(t){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),typeof t=="function"&&t.call(this)},e.options.fadeTime)),e};os.prototype.hide=function(t){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var i=e.options.mode==="dynamic"?"none":"block";e.ui.el.style.display=i,typeof t=="function"&&t.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick){let i=e.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:e.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:e.instance.frontPosition.y,e.setPosition(t,r)}return e};os.prototype.setPosition=function(t,e){var i=this;i.frontPosition={x:e.x,y:e.y};var r=i.options.fadeTime+"ms",n={};n.front=WG("transition",["top","left"],r);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(n),i.applyStyles(s),i.restTimeout=setTimeout(function(){typeof t=="function"&&t.call(i),i.restCallback()},i.options.fadeTime)};os.prototype.restCallback=function(){var t=this,e={};e.front=WG("transition","none",""),t.applyStyles(e),t.trigger("rested",t.instance)};os.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};os.prototype.computeDirection=function(t){var e=t.angle.radian,i=Math.PI/4,r=Math.PI/2,n,s,a;if(e>i&&e<i*3&&!t.lockX?n="up":e>-i&&e<=i&&!t.lockY?n="left":e>-i*3&&e<=-i&&!t.lockX?n="down":t.lockY||(n="right"),t.lockY||(e>-r&&e<r?s="left":s="right"),t.lockX||(e>0?a="up":a="down"),t.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var c={};this.direction={x:s,y:a,angle:n},t.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return t;(!c.x||!c.y)&&this.trigger("plain",t),c.x||this.trigger("plain:"+s,t),c.y||this.trigger("plain:"+a,t),c.angle||this.trigger("dir dir:"+n,t)}else this.resetDirection();return t};var kYe=os;function An(t,e){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=t,i.id=An.id,An.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(e),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}An.prototype=new XG;An.constructor=An;An.id=0;An.prototype.prepareNipples=function(){var t=this,e=t.nipples;e.on=t.on.bind(t),e.off=t.off.bind(t),e.options=t.options,e.destroy=t.destroy.bind(t),e.ids=t.ids,e.id=t.id,e.processOnMove=t.processOnMove.bind(t),e.processOnEnd=t.processOnEnd.bind(t),e.get=function(i){if(i===void 0)return e[0];for(var r=0,n=e.length;r<n;r+=1)if(e[r].identifier===i)return e[r];return!1}};An.prototype.bindings=function(){var t=this;t.bindEvt(t.options.zone,"start"),t.options.zone.style.touchAction="none",t.options.zone.style.msTouchAction="none"};An.prototype.begin=function(){var t=this,e=t.options;if(e.mode==="static"){var i=t.createNipple(e.position,t.manager.getIdentifier());i.add(),t.idles.push(i)}};An.prototype.createNipple=function(t,e){var i=this,r=i.manager.scroll,n={},s=i.options,a={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(t.x&&t.y)n={x:t.x-a.x,y:t.y-a.y};else if(t.top||t.right||t.bottom||t.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=t.top,o.style.right=t.right,o.style.bottom=t.bottom,o.style.left=t.left,o.style.position="absolute",s.zone.appendChild(o);var l=o.getBoundingClientRect();s.zone.removeChild(o),n=t,t={x:l.left+r.x,y:l.top+r.y}}var c=new kYe(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:e,position:t,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(bU(c.ui.el,n),bU(c.ui.front,c.frontPosition)),i.nipples.push(c),i.trigger("added "+c.identifier+":added",c),i.manager.trigger("added "+c.identifier+":added",c),i.bindNipple(c),c};An.prototype.updateBox=function(){var t=this;t.box=t.options.zone.getBoundingClientRect()};An.prototype.bindNipple=function(t){var e=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,e.trigger(i,s)};t.on("destroyed",e.onDestroyed.bind(e)),t.on("shown hidden rested dir plain",r),t.on("dir:up dir:right dir:down dir:left",r),t.on("plain:up plain:right plain:down plain:left",r)};An.prototype.pressureFn=function(t,e,i){var r=this,n=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval((function(){var s=t.force||t.pressure||t.webkitForce||0;s!==n&&(e.trigger("pressure",s),r.trigger("pressure "+e.identifier+":pressure",s),n=s)}).bind(r),100)};An.prototype.onstart=function(t){var e=this,i=e.options,r=t;t=pce(t),e.updateBox();var n=function(s){e.actives.length<i.maxNumberOfNipples?e.processOnStart(s):r.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach(function(a){if(Object.values(r.touches).findIndex(function(l){return l.identifier===a})<0){var o=[t[0]];o.identifier=a,e.processOnEnd(o)}}),e.actives.length<i.maxNumberOfNipples&&e.processOnStart(s))};return wU(t,n),e.manager.bindDocument(),!1};An.prototype.processOnStart=function(t){var e=this,i=e.options,r,n=e.manager.getIdentifier(t),s=t.force||t.pressure||t.webkitForce||0,a={x:t.pageX,y:t.pageY},o=e.getOrCreate(n,a);o.identifier!==n&&e.manager.removeIdentifier(o.identifier),o.identifier=n;var l=function(h){h.trigger("start",h),e.trigger("start "+h.id+":start",h),h.show(),s>0&&e.pressureFn(t,h,h.identifier),e.processOnMove(t)};if((r=e.idles.indexOf(o))>=0&&e.idles.splice(r,1),e.actives.push(o),e.ids.push(o.identifier),i.mode!=="semi")l(o);else{var c=SC(a,o.position);if(c<=i.catchDistance)l(o);else{o.destroy(),e.processOnStart(t);return}}return o};An.prototype.getOrCreate=function(t,e){var i=this,r=i.options,n;return/(semi|static)/.test(r.mode)?(n=i.idles[0],n?(i.idles.splice(0,1),n):r.mode==="semi"?i.createNipple(e,t):(console.warn("Coudln't find the needed nipple."),!1)):(n=i.createNipple(e,t),n)};An.prototype.processOnMove=function(t){var e=this,i=e.options,r=e.manager.getIdentifier(t),n=e.nipples.get(r),s=e.manager.scroll;if(!LYe(t)){this.processOnEnd(t);return}if(!n){console.error("Found zombie joystick with ID "+r),e.manager.removeIdentifier(r);return}if(i.dynamicPage){var a=n.el.getBoundingClientRect();n.position={x:s.x+a.left,y:s.y+a.top}}n.identifier=r;var o=n.options.size/2,l={x:t.pageX,y:t.pageY};i.lockX&&(l.y=n.position.y),i.lockY&&(l.x=n.position.x);var c=SC(l,n.position),h=DYe(l,n.position),u=xU(h),d=c/o,f={distance:c,position:l},p,m;if(n.options.shape==="circle"?(p=Math.min(c,o),m=RYe(n.position,p,h)):(m=FYe(l,n.position,o),p=SC(m,n.position)),i.follow){if(c>o){let x=l.x-m.x,S=l.y-m.y;n.position.x+=x,n.position.y+=S,n.el.style.top=n.position.y-(e.box.top+s.y)+"px",n.el.style.left=n.position.x-(e.box.left+s.x)+"px",c=SC(l,n.position)}}else l=m,c=p;var g=l.x-n.position.x,v=l.y-n.position.y;n.frontPosition={x:g,y:v},i.dataOnly||bU(n.ui.front,n.frontPosition);var y={identifier:n.identifier,position:l,force:d,pressure:t.force||t.pressure||t.webkitForce||0,distance:c,angle:{radian:u,degree:h},vector:{x:g/o,y:-v/o},raw:f,instance:n,lockX:i.lockX,lockY:i.lockY};y=n.computeDirection(y),y.angle={radian:xU(180-h),degree:180-h},n.trigger("move",y),e.trigger("move "+n.id+":move",y)};An.prototype.processOnEnd=function(t){var e=this,i=e.options,r=e.manager.getIdentifier(t),n=e.nipples.get(r),s=e.manager.removeIdentifier(n.identifier);!n||(i.dataOnly||n.hide(function(){i.mode==="dynamic"&&(n.trigger("removed",n),e.trigger("removed "+n.id+":removed",n),e.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(e.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),e.trigger("end "+n.id+":end",n),e.ids.indexOf(n.identifier)>=0&&e.ids.splice(e.ids.indexOf(n.identifier),1),e.actives.indexOf(n)>=0&&e.actives.splice(e.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?e.idles.push(n):e.nipples.indexOf(n)>=0&&e.nipples.splice(e.nipples.indexOf(n),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[s.id]=s.identifier))};An.prototype.onDestroyed=function(t,e){var i=this;i.nipples.indexOf(e)>=0&&i.nipples.splice(i.nipples.indexOf(e),1),i.actives.indexOf(e)>=0&&i.actives.splice(i.actives.indexOf(e),1),i.idles.indexOf(e)>=0&&i.idles.splice(i.idles.indexOf(e),1),i.ids.indexOf(e.identifier)>=0&&i.ids.splice(i.ids.indexOf(e.identifier),1),i.manager.removeIdentifier(e.identifier),i.manager.unbindDocument()};An.prototype.destroy=function(){var t=this;t.unbindEvt(t.options.zone,"start"),t.nipples.forEach(function(i){i.destroy()});for(var e in t.pressureIntervals)t.pressureIntervals.hasOwnProperty(e)&&clearInterval(t.pressureIntervals[e]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()};var NYe=An;function Ls(t){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=hQ(),e.config(t),e.prepareCollections();var i=function(){var n;e.collections.forEach(function(s){s.forEach(function(a){n=a.el.getBoundingClientRect(),a.position={x:e.scroll.x+n.left,y:e.scroll.y+n.top}})})};if(typeof window>"u")return e.collections;xP(window,"resize",function(){lQ(i)});var r=function(){e.scroll=hQ()};return xP(window,"scroll",function(){lQ(r)}),e.collections}Ls.prototype=new XG;Ls.constructor=Ls;Ls.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(e){var i;return t.collections.every(function(r){return i=r.get(e),!i}),i}};Ls.prototype.create=function(t){return this.createCollection(t)};Ls.prototype.createCollection=function(t){var e=this,i=new NYe(e,t);return e.bindCollection(i),e.collections.push(i),i};Ls.prototype.bindCollection=function(t){var e=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,e.trigger(i,s)};t.on("destroyed",e.onDestroyed.bind(e)),t.on("shown hidden rested dir plain",r),t.on("dir:up dir:right dir:down dir:left",r),t.on("plain:up plain:right plain:down plain:left",r)};Ls.prototype.bindDocument=function(){var t=this;t.binded||(t.bindEvt(document,"move").bindEvt(document,"end"),t.binded=!0)};Ls.prototype.unbindDocument=function(t){var e=this;(!Object.keys(e.ids).length||t===!0)&&(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)};Ls.prototype.getIdentifier=function(t){var e;return t?(e=t.identifier===void 0?t.pointerId:t.identifier,e===void 0&&(e=this.latest||0)):e=this.index,this.ids[e]===void 0&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]};Ls.prototype.removeIdentifier=function(t){var e={};for(var i in this.ids)if(this.ids[i]===t){e.id=i,e.identifier=this.ids[i],delete this.ids[i];break}return e};Ls.prototype.onmove=function(t){var e=this;return e.onAny("move",t),!1};Ls.prototype.onend=function(t){var e=this;return e.onAny("end",t),!1};Ls.prototype.oncancel=function(t){var e=this;return e.onAny("end",t),!1};Ls.prototype.onAny=function(t,e){var i=this,r,n="processOn"+t.charAt(0).toUpperCase()+t.slice(1);e=pce(e);var s=function(o,l,c){c.ids.indexOf(l)>=0&&(c[n](o),o._found_=!0)},a=function(o){r=i.getIdentifier(o),wU(i.collections,s.bind(null,o,r)),o._found_||i.removeIdentifier(r)};return wU(e,a),!1};Ls.prototype.destroy=function(){var t=this;t.unbindDocument(!0),t.ids={},t.index=0,t.collections.forEach(function(e){e.destroy()}),t.off()};Ls.prototype.onDestroyed=function(t,e){var i=this;if(i.collections.indexOf(e)<0)return!1;i.collections.splice(i.collections.indexOf(e),1)};var UYe=Ls,uQ=new UYe,zYe={create:function(t){return uQ.create(t)},factory:uQ},xce=new Map,ww=new Map,eg=class{constructor(t,e,i,r){this.data=e;let{audio:n,volume:s,delay:a,loop:o}=e;if(!n)throw new Error("Missing property");let l=typeof n=="string"?r.getAudio(n).src:n.data;this.audioPlayer=new Vb({src:l,volume:s,delay:a,loop:o}),ww.has(i.uuid)?ww.get(i.uuid).push(this):ww.set(i.uuid,[this]),xce.set(t,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},SU=class{constructor(t){this.data=t}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(t){let e=xce.get(t);!e||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):e.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(t){let e=ww.get(t);!(e!=null&&e.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):e.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let t=[...ww.values()];!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(e=>{e.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):t.forEach(e=>{e.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},bce=class{constructor(t,e,i,r,n){if(this.data=e,this.shared=r,this.condition=n,e.interaction==="play")this.interaction=new eg(t,e,i,r);else if(e.interaction==="pause"||e.interaction==="stop")this.interaction=new SU(e);else throw new Error("Missing property")}dispatchBasic(){if(Ar(this.shared,this.condition)===!1)return!1;this.interaction instanceof eg?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Ar(this.shared,this.condition)===!1)return!1;this.interaction instanceof eg?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(t){if(Ar(this.shared,this.condition)===!1)return!1;this.interaction instanceof eg&&(t==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},wce=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r,this.delay=0,this.emission=t.emission,t.delay!==void 0&&(this.delay=t.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(t=0){if(t){this.delayTimerId=window.setTimeout(()=>{this.start(0),this.clearDelay()},t);return}this.particleSystem.start()}stop(t=0){if(t){this.delayTimerId=window.setTimeout(()=>{this.stop(0),this.clearDelay()},t);return}this.particleSystem.stop()}freeze(t=0){if(t){this.delayTimerId=window.setTimeout(()=>{this.freeze(0),this.clearDelay()},t);return}this.particleSystem.froze()}unFreeze(t=0){if(t){this.delayTimerId=window.setTimeout(()=>{this.unFreeze(0),this.clearDelay()},t);return}this.particleSystem.unFroze()}reset(t=0){if(t){this.delayTimerId=window.setTimeout(()=>{this.reset(0),this.clearDelay()},t);return}this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze();break}}dispatchBasic(){if(Ar(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchConditional(){if(Ar(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchGameControl(t){if(Ar(this.shared,this.condition)===!1||!this.particleSystem)return!1;t==="start"?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},GYe="text/plain",VYe="us-ascii",dQ=(t,e)=>e.some(i=>i instanceof RegExp?i.test(t):i===t),HYe=(t,{stripHash:e})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(t);if(!i)throw new Error(`Invalid URL: ${t}`);let{type:r,data:n,hash:s}=i.groups,a=r.split(";");s=e?"":s;let o=!1;a[a.length-1]==="base64"&&(a.pop(),o=!0);let l=(a.shift()||"").toLowerCase(),c=[...a.map(h=>{let[u,d=""]=h.split("=").map(f=>f.trim());return u==="charset"&&(d=d.toLowerCase(),d===VYe)?"":`${u}${d?`=${d}`:""}`}).filter(Boolean)];return o&&c.push("base64"),(c.length>0||l&&l!==GYe)&&c.unshift(l),`data:${c.join(";")},${o?n.trim():n}${s?`#${s}`:""}`};function jYe(t,e){if(e={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...e},t=t.trim(),/^data:/i.test(t))return HYe(t,e);if(/^view-source:/i.test(t))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=t.startsWith("//");!i&&/^\.*\//.test(t)||(t=t.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));let r=new URL(t);if(e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(e.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),e.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),e.stripAuthentication&&(r.username="",r.password=""),e.stripHash?r.hash="":e.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,a=0,o="";for(;;){let c=s.exec(r.pathname);if(!c)break;let h=c[0],u=c.index,d=r.pathname.slice(a,u);o+=d.replace(/\/{2,}/g,"/"),o+=h,a=u+h.length}let l=r.pathname.slice(a,r.pathname.length);o+=l.replace(/\/{2,}/g,"/"),r.pathname=o}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(e.removeDirectoryIndex===!0&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let s=r.pathname.split("/"),a=s[s.length-1];dQ(a,e.removeDirectoryIndex)&&(s=s.slice(0,-1),r.pathname=s.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(e.removeQueryParameters))for(let s of[...r.searchParams.keys()])dQ(s,e.removeQueryParameters)&&r.searchParams.delete(s);if(e.removeQueryParameters===!0&&(r.search=""),e.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}e.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let n=t;return t=r.toString(),!e.removeSingleSlash&&r.pathname==="/"&&!n.endsWith("/")&&r.hash===""&&(t=t.replace(/\/$/,"")),(e.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&e.removeSingleSlash&&(t=t.replace(/\/$/,"")),i&&!e.normalizeProtocol&&(t=t.replace(/^http:\/\//,"//")),e.stripProtocol&&(t=t.replace(/^(?:https?:)?\/\//,"")),t}var WYe=class{constructor({url:t,context:e},i,r,n){if(this.controlsManager=i,this.shared=r,this.condition=n,!t)throw new Error("Missing property");this.url=t.startsWith("mailto:")?t:jYe(t,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=e??"tab"}dispatch(){var t;if(Ar(this.shared,this.condition)===!1)return!1;R_?window.location.assign(this.url):(this.context==="tab"||Bae&&this.context==="none"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),(t=this.controlsManager.orbitControls)==null||t.onPointerUp($t[0]),oGe())}},Sce=class{constructor(t,e,i,r,n){this.data=t,this.page=e,this.controlsManager=i,this.shared=r,this.condition=n,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=s=>{var c,h;this.timeoutIdQueue.shift();let a=this.page.scene.find(s);if(a===void 0)return;let o=this.controlsManager.sharedGameControlGlobals.rapierWorld,l=o?(c=a.dataPatched.physics)==null?void 0:c.fusedBody:!0;if(a.cloner){for(let u of a.cloner.children)l?(u.playModeVisible=!1,u.rigidBody&&((h=a.dataPatched.physics)==null?void 0:h.rigidBody)==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(u.rigidBody.collider(0).handle),o.removeRigidBody(u.rigidBody),u.rigidBody=void 0),u.bvhGeometry&&(u.bvhGeometry=void 0)):this.clone===void 0||this.clone===u?(u.playModeVisible=!1,u.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(u.rigidBody.collider(0).handle),o.removeRigidBody(u.rigidBody),u.rigidBody=void 0)):u.playModeVisible===void 0&&(u.playModeVisible=!0);(l||this.clone===void 0||this.clone===!1)&&(a.visible=!1,a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0))}else a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0),a.visible=!1;o===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(u=>u.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(u=>u.rigidBody!==void 0),a.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...t.objects]}dispatch(t){if(Ar(this.shared,this.condition)===!1)return!1;this.clone=t,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if(Ar(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(t=>window.clearTimeout(t))}},_ce=class{constructor(t,e,i,r,n){this.data=t,this.page=e,this.shared=i,this.eventManager=r,this.condition=n,this.shared=i}dispatch(){if(Ar(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{var t;this.shared.reset(this.shared.data,!0),rV(this.page,this.shared,!0),this.eventManager.reset(),(t=this.eventManager.controlsManager.gameControl)==null||t.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},Ace={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},YG={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},XYe=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],bP={CSS:{},springs:{}};function Mc(t,e,i){return Math.min(Math.max(t,e),i)}function Sw(t,e){return t.indexOf(e)>-1}function VO(t,e){return t.apply(null,e)}var ni={arr:function(t){return Array.isArray(t)},obj:function(t){return Sw(Object.prototype.toString.call(t),"Object")},pth:function(t){return ni.obj(t)&&t.hasOwnProperty("totalLength")},svg:function(t){return t instanceof SVGElement},inp:function(t){return t instanceof HTMLInputElement},dom:function(t){return!("isNode"in t)&&(t.nodeType||ni.svg(t))},str:function(t){return typeof t=="string"},fnc:function(t){return typeof t=="function"},und:function(t){return typeof t>"u"},hex:function(t){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)},rgb:function(t){return/^rgb/.test(t)},hsl:function(t){return/^hsl/.test(t)},col:function(t){return ni.hex(t)||ni.rgb(t)||ni.hsl(t)},key:function(t){return!Ace.hasOwnProperty(t)&&!YG.hasOwnProperty(t)&&t!=="targets"&&t!=="keyframes"}};function Ece(t){var e=/\(([^)]+)\)/.exec(t);return e?e[1].split(",").map(function(i){return parseFloat(i)}):[]}function Mce(t,e){var i=Ece(t),r=Mc(ni.und(i[0])?1:i[0],.1,100),n=Mc(ni.und(i[1])?100:i[1],.1,100),s=Mc(ni.und(i[2])?10:i[2],.1,100),a=Mc(ni.und(i[3])?0:i[3],.1,100),o=Math.sqrt(n/r),l=s/(2*Math.sqrt(n*r)),c=l<1?o*Math.sqrt(1-l*l):0,h=1,u=l<1?(l*o+-a)/c:-a+o;function d(p){var m=e?e*p/1e3:p;return l<1?m=Math.exp(-m*l*o)*(h*Math.cos(c*m)+u*Math.sin(c*m)):m=(h+u*m)*Math.exp(-m*o),p===0||p===1?p:1-m}function f(){var p=bP.springs[t];if(p)return p;for(var m=1/6,g=0,v=0;;)if(g+=m,d(g)===1){if(v++,v>=16)break}else v=0;var y=g*m*1e3;return bP.springs[t]=y,y}return e?d:f}function YYe(t){return t===void 0&&(t=10),function(e){return Math.ceil(Mc(e,1e-6,1)*t)*(1/t)}}var qYe=function(){var t=11,e=1/(t-1);function i(h,u){return 1-3*u+3*h}function r(h,u){return 3*u-6*h}function n(h){return 3*h}function s(h,u,d){return((i(u,d)*h+r(u,d))*h+n(u))*h}function a(h,u,d){return 3*i(u,d)*h*h+2*r(u,d)*h+n(u)}function o(h,u,d,f,p){var m,g,v=0;do g=u+(d-u)/2,m=s(g,f,p)-h,m>0?d=g:u=g;while(Math.abs(m)>1e-7&&++v<10);return g}function l(h,u,d,f){for(var p=0;p<4;++p){var m=a(u,d,f);if(m===0)return u;var g=s(u,d,f)-h;u-=g/m}return u}function c(h,u,d,f){if(!(0<=h&&h<=1&&0<=d&&d<=1))return;var p=new Float32Array(t);if(h!==u||d!==f)for(var m=0;m<t;++m)p[m]=s(m*e,h,d);function g(v){for(var y=0,x=1,S=t-1;x!==S&&p[x]<=v;++x)y+=e;--x;var A=(v-p[x])/(p[x+1]-p[x]),_=y+A*e,M=a(_,h,d);return M>=.001?l(v,_,h,d):M===0?_:o(v,y,y+e,h,d)}return function(v){return h===u&&d===f||v===0||v===1?v:s(g(v),u,f)}}return c}(),Tce=function(){var t={linear:function(){return function(r){return r}}},e={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var n,s=4;r<((n=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((n*3-2)/22-r,2)}},Elastic:function(r,n){r===void 0&&(r=1),n===void 0&&(n=.5);var s=Mc(r,1,10),a=Mc(n,.1,2);return function(o){return o===0||o===1?o:-s*Math.pow(2,10*(o-1))*Math.sin((o-1-a/(Math.PI*2)*Math.asin(1/s))*(Math.PI*2)/a)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,n){e[r]=function(){return function(s){return Math.pow(s,n+2)}}}),Object.keys(e).forEach(function(r){var n=e[r];t["easeIn"+r]=n,t["easeOut"+r]=function(s,a){return function(o){return 1-n(s,a)(1-o)}},t["easeInOut"+r]=function(s,a){return function(o){return o<.5?n(s,a)(o*2)/2:1-n(s,a)(o*-2+2)/2}}}),t}();function qG(t,e){if(ni.fnc(t))return t;var i=t.split("(")[0],r=Tce[i],n=Ece(t);switch(i){case"spring":return Mce(t,e);case"cubicBezier":return VO(qYe,n);case"steps":return VO(YYe,n);default:return VO(r,n)}}function Cce(t){try{var e=document.querySelectorAll(t);return e}catch{return}}function KD(t,e){for(var i=t.length,r=arguments.length>=2?arguments[1]:void 0,n=[],s=0;s<i;s++)if(s in t){var a=t[s];e.call(r,a,s,t)&&n.push(a)}return n}function QD(t){return t.reduce(function(e,i){return e.concat(ni.arr(i)?QD(i):i)},[])}function fQ(t){return ni.arr(t)?t:(ni.str(t)&&(t=Cce(t)||t),t instanceof NodeList||t instanceof HTMLCollection?[].slice.call(t):[t])}function KG(t,e){return t.some(function(i){return i===e})}function QG(t){var e={};for(var i in t)e[i]=t[i];return e}function _U(t,e){var i=QG(t);for(var r in t)i[r]=e.hasOwnProperty(r)?e[r]:t[r];return i}function $D(t,e){var i=QG(t);for(var r in e)i[r]=ni.und(t[r])?e[r]:t[r];return i}function KYe(t){var e=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(t);return e?"rgba("+e[1]+",1)":t}function QYe(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=t.replace(e,function(o,l,c,h){return l+l+c+c+h+h}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),n=parseInt(r[1],16),s=parseInt(r[2],16),a=parseInt(r[3],16);return"rgba("+n+","+s+","+a+",1)"}function $Ye(t){var e=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(t),i=parseInt(e[1],10)/360,r=parseInt(e[2],10)/100,n=parseInt(e[3],10)/100,s=e[4]||1;function a(d,f,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?d+(f-d)*6*p:p<1/2?f:p<2/3?d+(f-d)*(2/3-p)*6:d}var o,l,c;if(r==0)o=l=c=n;else{var h=n<.5?n*(1+r):n+r-n*r,u=2*n-h;o=a(u,h,i+1/3),l=a(u,h,i),c=a(u,h,i-1/3)}return"rgba("+o*255+","+l*255+","+c*255+","+s+")"}function JYe(t){if(ni.rgb(t))return KYe(t);if(ni.hex(t))return QYe(t);if(ni.hsl(t))return $Ye(t)}function nd(t){var e=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(t);if(e)return e[1]}function ZYe(t){if(Sw(t,"translate")||t==="perspective")return"px";if(Sw(t,"rotate")||Sw(t,"skew"))return"deg"}function AU(t,e){return ni.fnc(t)?t(e.target,e.id,e.total):t}function Th(t,e){return t.getAttribute(e)}function $G(t,e,i){var r=nd(e);if(KG([i,"deg","rad","turn"],r))return e;var n=bP.CSS[e+i];if(!ni.und(n))return n;var s=100,a=document.createElement(t.tagName),o=t.parentNode&&t.parentNode!==document?t.parentNode:document.body;o.appendChild(a),a.style.position="absolute",a.style.width=s+i;var l=s/a.offsetWidth;o.removeChild(a);var c=l*parseFloat(e);return bP.CSS[e+i]=c,c}function Pce(t,e,i){if(e in t.style){var r=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=t.style[e]||getComputedStyle(t).getPropertyValue(r)||"0";return i?$G(t,n,i):n}}function JG(t,e){if(ni.dom(t)&&!ni.inp(t)&&(Th(t,e)||ni.svg(t)&&t[e]))return"attribute";if(ni.dom(t)&&KG(XYe,e))return"transform";if(ni.dom(t)&&e!=="transform"&&Pce(t,e))return"css";if(t[e]!=null)return"object"}function Dce(t){if(ni.dom(t)){for(var e=t.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,n;n=i.exec(e);)r.set(n[1],n[2]);return r}}function eqe(t,e,i,r){var n=Sw(e,"scale")?1:0+ZYe(e),s=Dce(t).get(e)||n;return i&&(i.transforms.list.set(e,s),i.transforms.last=e),r?$G(t,s,r):s}function ZG(t,e,i,r){switch(JG(t,e)){case"transform":return eqe(t,e,r,i);case"css":return Pce(t,e,i);case"attribute":return Th(t,e);default:return t[e]||0}}function eV(t,e){var i=/^(\*=|\+=|-=)/.exec(t);if(!i)return t;var r=nd(t)||0,n=parseFloat(e),s=parseFloat(t.replace(i[0],""));switch(i[0][0]){case"+":return n+s+r;case"-":return n-s+r;case"*":return n*s+r}}function Rce(t,e){if(ni.col(t))return JYe(t);if(/\s/g.test(t))return t;var i=nd(t),r=i?t.substr(0,t.length-i.length):t;return e?r+e:r}function tV(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function tqe(t){return Math.PI*2*Th(t,"r")}function iqe(t){return Th(t,"width")*2+Th(t,"height")*2}function rqe(t){return tV({x:Th(t,"x1"),y:Th(t,"y1")},{x:Th(t,"x2"),y:Th(t,"y2")})}function Ice(t){for(var e=t.points,i=0,r,n=0;n<e.numberOfItems;n++){var s=e.getItem(n);n>0&&(i+=tV(r,s)),r=s}return i}function nqe(t){var e=t.points;return Ice(t)+tV(e.getItem(e.numberOfItems-1),e.getItem(0))}function Lce(t){if(t.getTotalLength)return t.getTotalLength();switch(t.tagName.toLowerCase()){case"circle":return tqe(t);case"rect":return iqe(t);case"line":return rqe(t);case"polyline":return Ice(t);case"polygon":return nqe(t)}}function sqe(t){var e=Lce(t);return t.setAttribute("stroke-dasharray",e),e}function aqe(t){for(var e=t.parentNode;ni.svg(e)&&ni.svg(e.parentNode);)e=e.parentNode;return e}function Oce(t,e){var i=e||{},r=i.el||aqe(t),n=r.getBoundingClientRect(),s=Th(r,"viewBox"),a=n.width,o=n.height,l=i.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:r,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function oqe(t,e){var i=ni.str(t)?Cce(t)[0]:t,r=e||100;return function(n){return{property:n,el:i,svg:Oce(i),totalLength:Lce(i)*(r/100)}}}function lqe(t,e){function i(o){o===void 0&&(o=0);var l=e+o>=1?e+o:0;return t.el.getPointAtLength(l)}var r=Oce(t.el,t.svg),n=i(),s=i(-1),a=i(1);switch(t.property){case"x":return(n.x-r.x)*r.w;case"y":return(n.y-r.y)*r.h;case"angle":return Math.atan2(a.y-s.y,a.x-s.x)*180/Math.PI}}function pQ(t,e){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=Rce(ni.pth(t)?t.totalLength:t,e)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:ni.str(t)||e?r.split(i):[]}}function Bce(t){var e=t?QD(ni.arr(t)?t.map(fQ):fQ(t)):[];return KD(e,function(i,r,n){return n.indexOf(i)===r})}function Fce(t){var e=Bce(t);return e.map(function(i,r){return{target:i,id:r,total:e.length,transforms:{list:Dce(i)}}})}function cqe(t,e){var i=QG(e);if(/^spring/.test(i.easing)&&(i.duration=Mce(i.easing)),ni.arr(t)){var r=t.length,n=r===2&&!ni.obj(t[0]);n?t={value:t}:ni.fnc(e.duration)||(i.duration=e.duration/r)}var s=ni.arr(t)?t:[t];return s.map(function(a,o){var l=ni.obj(a)&&!ni.pth(a)?a:{value:a};return ni.und(l.delay)&&(l.delay=o?0:e.delay),ni.und(l.endDelay)&&(l.endDelay=o===s.length-1?e.endDelay:0),l}).map(function(a){return $D(a,i)})}function hqe(t){for(var e=KD(QD(t.map(function(s){return Object.keys(s)})),function(s){return ni.key(s)}).reduce(function(s,a){return s.indexOf(a)<0&&s.push(a),s},[]),i={},r=function(s){var a=e[s];i[a]=t.map(function(o){var l={};for(var c in o)ni.key(c)?c==a&&(l.value=o[c]):l[c]=o[c];return l})},n=0;n<e.length;n++)r(n);return i}function uqe(t,e){var i=[],r=e.keyframes;r&&(e=$D(hqe(r),e));for(var n in e)ni.key(n)&&i.push({name:n,tweens:cqe(e[n],t)});return i}function dqe(t,e){var i={};for(var r in t){var n=AU(t[r],e);ni.arr(n)&&(n=n.map(function(s){return AU(s,e)}),n.length===1&&(n=n[0])),i[r]=n}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function fqe(t,e){var i;return t.tweens.map(function(r){var n=dqe(r,e),s=n.value,a=ni.arr(s)?s[1]:s,o=nd(a),l=ZG(e.target,t.name,o,e),c=i?i.to.original:l,h=ni.arr(s)?s[0]:c,u=nd(h)||nd(l),d=o||u;return ni.und(a)&&(a=c),n.from=pQ(h,d),n.to=pQ(eV(a,h),d),n.start=i?i.end:0,n.end=n.start+n.delay+n.duration+n.endDelay,n.easing=qG(n.easing,n.duration),n.isPath=ni.pth(s),n.isColor=ni.col(n.from.original),n.isColor&&(n.round=1),i=n,n})}var kce={css:function(t,e,i){return t.style[e]=i},attribute:function(t,e,i){return t.setAttribute(e,i)},object:function(t,e,i){return t[e]=i},transform:function(t,e,i,r,n){if(r.list.set(e,i),e===r.last||n){var s="";r.list.forEach(function(a,o){s+=o+"("+a+") "}),t.style.transform=s}}};function Nce(t,e){var i=Fce(t);i.forEach(function(r){for(var n in e){var s=AU(e[n],r),a=r.target,o=nd(s),l=ZG(a,n,o,r),c=o||nd(l),h=eV(Rce(s,c),l),u=JG(a,n);kce[u](a,n,h,r.transforms,!0)}})}function pqe(t,e){var i=JG(t.target,e.name);if(i){var r=fqe(e,t),n=r[r.length-1];return{type:i,property:e.name,animatable:t,tweens:r,duration:n.end,delay:r[0].delay,endDelay:n.endDelay}}}function mqe(t,e){return KD(QD(t.map(function(i){return e.map(function(r){return pqe(i,r)})})),function(i){return!ni.und(i)})}function Uce(t,e){var i=t.length,r=function(s){return s.timelineOffset?s.timelineOffset:0},n={};return n.duration=i?Math.max.apply(Math,t.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+l+s.duration*(s.loop??1)})):e.duration,n.delay=i?Math.min.apply(Math,t.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0;return r(s)+a+o+s.delay})):e.delay,n.endDelay=i?n.duration-Math.max.apply(Math,t.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+s.duration*(s.loop??1)-s.endDelay-l})):e.endDelay,n}var mQ=0;function gqe(t){var e=_U(Ace,t),i=_U(YG,t),r=uqe(i,t),n=Fce(t.targets),s=mqe(n,r),a=Uce(s,i),o=mQ;return mQ++,$D(e,{id:o,children:[],animatables:n,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var zl=[],gQ=[],_C,vqe=function(){function t(){_C=requestAnimationFrame(e)}function e(i){var r=zl.length;if(r){for(var n=0;n<r;){var s=zl[n];s.paused?(zl.splice(n,1),r-=1):(s.tick(i),n++)}t()}else _C=cancelAnimationFrame(_C)}return t}();function yqe(t){document.hidden?(zl.forEach(function(e){return e.pause(t.timeStamp)}),gQ=zl.slice(0),Sn.running=zl=[]):gQ.forEach(function(e){return e.play(t.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",yqe);function Sn(t){t===void 0&&(t={});var e=0,i=0,r=0,n,s,a=0,o=null;function l(_){var M=window.Promise&&new Promise(function(E){return o=E});return _.finished=M,M}var c=gqe(t);l(c);function h(){var _=c.direction;_!=="alternate"&&(c.direction=_!=="normal"?"normal":"reverse"),c.reversed=!c.reversed,s.forEach(function(M){(M.loop===1||M.loop%2===0)&&(M.reversed=c.reversed)})}function u(){c.direction="normal",c.reversed=!1,s.forEach(function(_){return _.reversed=!1})}function d(_){return c.reversed?c.duration-_:_}function f(){e=0,i=d(c.currentTime)*(1/Sn.speed)}function p(_,M,E=!1){M&&(c.reversed?M.seek(M.duration*M.loop-(_-M.timelineOffset-M.pingPongDelayCorrection),E):M.seek(_-M.timelineOffset-M.startOnceDelay-M.pingPongDelayCorrection,E))}function m(_,M=!1){if(c.reversed)for(var E=a;E--;)p(_,s[E],M);else for(var T=0;T<a;T++)p(_,s[T],M)}function g(_){var Ae,Se,_e,ve,Ee,fe,pe,Ie,Le,Ge;var M=0,E=c.animations,T=E.length;for(c.direction!=="alternate"&&((Ae=c.parent)==null?void 0:Ae.direction)==="alternate"?((Se=c.parent)==null?void 0:Se.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1&&((_e=c.parent)!=null&&_e.reversed&&c.direction==="alternate"?_=c.duration-c.delay+c.endDelay-_:_=c.duration+c.delay-c.endDelay-_):S(!1,(ve=c.parent)==null?void 0:ve.rewind,c.rewind,(Ee=c.parent)==null?void 0:Ee.reversePlayback,c.reversePlayback)&&((fe=c.parent)!=null&&fe.reversed&&c.direction==="alternate"?_=c.duration-c.delay+c.endDelay-_:_=c.duration+c.delay-c.endDelay-_);M<T;){var C=E[M],D=C.animatable,B=C.tweens,O=B.length-1,L=B[O];O&&(L=KD(B,function(Ve){return _<Ve.end})[0]||L);let Ke;(pe=c.parent)!=null&&pe.reversed&&c.direction==="alternate"?Ke=Mc(_-L.start-L.endDelay,0,L.duration)/L.duration:Ke=Mc(_-L.start-L.delay,0,L.duration)/L.duration;for(var H=isNaN(Ke)?1:L.easing(Ke),q=L.to.strings,W=L.round,I=[],z=L.to.numbers.length,U=void 0,X=0;X<z;X++){var Q=void 0;let Ve,ke;c.direction!=="alternate"?((Ie=c.parent)==null?void 0:Ie.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1?(Ve=L.to.numbers[X],ke=L.from.numbers[X]||0):(ke=L.to.numbers[X],Ve=L.from.numbers[X]||0):S(!0,(Le=c.parent)==null?void 0:Le.rewind,c.rewind,(Ge=c.parent)==null?void 0:Ge.reversePlayback,c.reversePlayback)?(Ve=L.to.numbers[X],ke=L.from.numbers[X]||0):(ke=L.to.numbers[X],Ve=L.from.numbers[X]||0),L.isPath?Q=lqe(L.value,H*ke):Q=Ve+H*(ke-Ve),W&&(L.isColor&&X>2||(Q=Math.round(Q*W)/W)),I.push(Q)}var re=q.length;if(!re)U=I[0];else{U=q[0];for(var ie=0;ie<re;ie++){q[ie];var ce=q[ie+1],Z=I[ie];isNaN(Z)||(ce?U+=Z+ce:U+=Z+" ")}}kce[C.type](D.target,C.property,U,D.transforms),C.currentValue=U,M++}}function v(_){c[_]&&!c.passThrough&&c[_](c)}function y(){c.remaining&&c.remaining!==!0&&c.remaining--}let x={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function S(_,M,E,T,C){return x[_<<4|M<<3|E<<2|T<<1|C]}function A(_,M=!1){var B;var E=c.duration;let T=c.delay,C=E-c.endDelay;(B=c.parent)!=null&&B.reversed&&c.direction==="alternate"&&(T=c.endDelay,C=E-c.delay);var D=d(_);if(c.progress=Mc(D/E*100,0,100),M||(c.reversePlayback=D<c.currentTime),a&&m(D,M),!c.began&&c.currentTime>=0&&(c.began=!0,v("begin")),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,v("loopBegin")),(c.reversed||D>=0)&&D<=T&&c.currentTime!==0&&(g(0),v("change")),(D>=C&&c.currentTime!==E+c.pingPongDelayCorrection||!E)&&(g(E),v("change")),D>T&&D<C?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,v("changeBegin")),g(D),v("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,v("change"),a&&v("timelineChangeComplete")):c.began&&D>C&&v("changeComplete"),c.currentTime=Mc(D,0,E+c.pingPongDelayCorrection),c.began&&v("update"),_>=E)if(y(),!c.remaining)c.paused=!0,c.completed||(c.completed=!0,v("loopComplete"),v("complete"),!c.passThrough&&"Promise"in window&&(o(),l(c)));else{a?e+=c.duration/Sn.speed:e+=c.duration;for(let O of s)O.setStartTime(0),O.remaining=O.loop;v("loopComplete"),c.loopBegan=!1,c.direction==="alternate"?h():a&&u()}}return c.reset=function(){var _=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed=_==="reverse",c.remaining=c.loop,s=c.children,a=s.length;for(var M=a;M--;)c.children[M].reset();g(c.reversed?c.duration:0)},c.setStartTime=function(_){e=_},c.set=function(_,M){return Nce(_,M),c},c.tick=function(_){r=_,e||(e=r),A((r+(i-e))*Sn.speed)},c.seek=function(_,M=!1){A(_-e,M)},c.pause=function(_){c.paused=!0,a&&(n=_??performance.now())},c.play=function(_){!c.paused||(c.completed&&c.reset(),c.paused=!1,zl.push(c),a&&n!==void 0&&(e+=(_??performance.now())-n),_C||vqe())},c.reverse=function(){h(),c.completed=!c.reversed,f()},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function vQ(t,e){for(var i=e.length;i--;)KG(t,e[i].animatable.target)&&e.splice(i,1)}function xqe(t){for(var e=Bce(t),i=zl.length;i--;){var r=zl[i],n=r.animations,s=r.children;vQ(e,n);for(var a=s.length;a--;){var o=s[a],l=o.animations;vQ(e,l),!l.length&&!o.children.length&&s.splice(a,1)}!n.length&&!s.length&&r.pause()}}function bqe(t,e){e===void 0&&(e={});var i=e.direction||"normal",r=e.easing?qG(e.easing):null,n=e.grid,s=e.axis,a=e.from||0,o=a==="first",l=a==="center",c=a==="last",h=ni.arr(t),u=parseFloat(h?t[0]:t),d=h?parseFloat(t[1]):0,f=nd(h?t[1]:t)||0,p=e.start||0+(h?u:0),m=[],g=0;return function(v,y,x){if(o&&(a=0),l&&(a=(x-1)/2),c&&(a=x-1),!m.length){for(var S=0;S<x;S++){if(!n)m.push(Math.abs(a-S));else{var A=l?(n[0]-1)/2:a%n[0],_=l?(n[1]-1)/2:Math.floor(a/n[0]),M=S%n[0],E=Math.floor(S/n[0]),T=A-M,C=_-E,D=Math.sqrt(T*T+C*C);s==="x"&&(D=-T),s==="y"&&(D=-C),m.push(D)}g=Math.max.apply(Math,m)}r&&(m=m.map(function(O){return r(O/g)*g})),i==="reverse"&&(m=m.map(function(O){return s?O<0?O*-1:-O:Math.abs(g-O)}))}var B=h?(d-u)/g:u;return p+B*(Math.round(m[y]*100)/100)+f}}function wqe(t){t===void 0&&(t={});var e=Sn(t);return e.duration=0,e.add=function(i,r){var n=zl.indexOf(e),s=e.children;n>-1&&zl.splice(n,1);function a(d){d.passThrough=!0}for(var o=0;o<s.length;o++)a(s[o]);var l=$D(i,_U(YG,t));l.targets=l.targets||t.targets;var c=e.duration;l.autoplay=!1,l.timelineOffset=ni.und(r)?c:eV(r,c),a(e);var h=Sn(l);a(h),s.push(h),h.parent=e;var u=Uce(s,t);return e.delay=u.delay,e.endDelay=u.endDelay,e.duration=u.duration,h.loop===!0&&(e.duration=1/0),e.seek(0),e.reset(),e.autoplay&&e.play(),e},e}Sn.version="3.2.0";Sn.speed=1;Sn.running=zl;Sn.remove=xqe;Sn.get=ZG;Sn.set=Nce;Sn.convertPx=$G;Sn.path=oqe;Sn.setDashoffset=sqe;Sn.stagger=bqe;Sn.timeline=wqe;Sn.easing=qG;Sn.penner=Tce;Sn.random=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};var zce=Sn,yQ=new N,xQ=new N,bQ=new ri;function Sqe(t,e,i,r){if(r===0)return i.copy(t);if(r===1)return i.copy(e);let n=t.w*e.w+t.x*e.x+t.y*e.y+t.z*e.z;if(n>=1)return i.copy(t);let s=1-n*n;if(s<=Number.EPSILON){let h=1-r;return i.w=h*t.w+r*e.w,i.x=h*t.x+r*e.x,i.y=h*t.y+r*e.y,i.z=h*t.z+r*e.z,i.normalize(),i}let a=Math.sqrt(s),o=Math.atan2(a,n),l=Math.sin((1-r)*o)/a,c=Math.sin(r*o)/a;return i.w=t.w*l+e.w*c,i.x=t.x*l+e.x*c,i.y=t.y*l+e.y*c,i.z=t.z*l+e.z*c,i}function Vs(t,e,i,r,n,s){let a=i[t]!==void 0?i[t]:void 0,o=r[t];if(o==null)return;let l=a!=null?typeof a=="string"?Number(n.getVariable(a)??0):a:e[t],c=typeof o=="string"?Number(n.getVariable(o)??0):o;if(l!==c)return{update:h=>{let u=Et.lerp(l,c,h);s?e[t]=Math.trunc(u):e[t]=u},start:()=>{e[t]=l},end:()=>{e[t]=c}}}function iV(t,e,i,r,n,s){let a=i[t]?i[t]:void 0,o=r[t];if(!o)return;let l=e[t],c=[...a??l].map(u=>typeof u=="string"?Number(n.getVariable(u)??0):u),h=[...o].map(u=>typeof u=="string"?Number(n.getVariable(u)??0):u);if(!(c.length!==h.length||iG(c,h)))return{update:u=>{c.forEach((d,f)=>{let p=Et.lerp(d,h[f],u);e[t][f]=s?Math.trunc(p):p})},start:()=>{Object.assign(e[t],c)},end:()=>{Object.assign(e[t],h)}}}function wP(t,e,i){return e.forEach((r,n)=>{t.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),t}function wQ(t,e,i,r,n){let s=i[t]?i[t]:void 0,a=r[t];if(!a)return;let o=e[t],l=s?wP(new N,s,n):o.clone(),c=wP(new N,a,n);if(!l.equals(c))return{update:h=>{o.lerpVectors(l,c,h)},start:()=>{o.copy(l)},end:()=>{o.copy(c)}}}function SQ(t,e,i){return e.forEach((r,n)=>{t.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),t}function SP(t,e,i,r,n){let s=i[t]?i[t]:void 0,a=r[t];if(!a)return;let o=e[t],l=!(o instanceof ye),c=o instanceof ye?o:new ye().fromArray(o),h=s?SQ(new ye,s,n):c.clone(),u=SQ(new ye,a,n);if(!h.equals(u))return{update:d=>{c.lerpVectors(h,u,d),l&&(e[t]=c.toArray())},start:()=>{c.copy(h),l&&(e[t]=c.toArray())},end:()=>{c.copy(u),l&&(e[t]=c.toArray())}}}function _qe(t,e,i,r){let n=i[t]?i[t]:void 0,s=r[t];if(!s)return;let a=e[t],o=n?new st().fromArray(n):a.clone(),l=new N,c=new ri,h=new N;o.decompose(l,c,h);let u=new st().fromArray(s),d=new N,f=new ri,p=new N;if(u.decompose(d,f,p),!o.equals(u))return{update:m=>{bQ.slerpQuaternions(c,f,m),yQ.lerpVectors(l,d,m),xQ.lerpVectors(h,p,m),a.compose(yQ,bQ,xQ)},start:()=>{a.compose(l,c,h)},end:()=>{a.compose(d,f,p)}}}function Aqe(t,e,i,r,n){let s=i[t]?i[t]:void 0,a=r[t];if(!a)return;let o=e[t],l=s?typeof s=="string"?n.getColor(s).clone():new Xt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new Xt().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let h=o.clone();return{update:u=>{var d,f;h.lerpColors(l,c,u),(f=(d=e[t])==null?void 0:d.copy)==null||f.call(d,h)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function ST(t,e,i,r,n){let s=i[t]?i[t]:void 0,a=r[t];if(!a)return;let o=e[t],l=new Qs(o.r,o.g,o.b,o.a),c=s?typeof s=="string"?n.getColor(s).clone():new Qs(s.r,s.g,s.b,s.a):l.clone(),h=typeof a=="string"?n.getColor(a).clone():new Qs(a.r,a.g,a.b,a.a);if(!c.equals(h))return{update:u=>{l.lerpColors(c,h,u);let d=Et.lerp(c.a,h.a,u);l.a=d,e[t]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(c)},end:()=>{l.copy(h)}}}function Bp(t,e,i,r,n){if(typeof e[t]=="number")return Vs(t,e,i??{},r,n);if(Array.isArray(e[t]))return iV(t,e,i??{},r,n)}function Eqe(t,e,i,r){var o,l,c,h;let n=[],s=t.cameraType==="OrthographicCamera"?(o=e.orthographic)==null?void 0:o.zoom:(l=e.perspective)==null?void 0:l.zoom,a=t.cameraType==="OrthographicCamera"?(c=i.orthographic)==null?void 0:c.zoom:(h=i.perspective)==null?void 0:h.zoom;if(a!==void 0){let u=s??t.zoom,d=a;u!==d&&n.push({update:f=>{t.zoom=Et.lerp(u,d,f),t.updateProjectionMatrix()},start:()=>{t.zoom=u,t.updateProjectionMatrix()},end:()=>{t.zoom=d,t.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let u=Vs("targetOffset",t,e,i,r);u&&n.push(u)}return n}function Mqe(t,e,i,r){if(i.scaleBaked===void 0)return;let n=(e.scaleBaked??t.data.geometry.scaleBaked).map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o),s=i.scaleBaked.map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o);if(xg.isEqual(n,s))return;let a=[];return a.push({update:o=>{t.updateGeometryInteractions({scaleBaked:[Et.lerp(n[0],s[0],o),Et.lerp(n[1],s[1],o),Et.lerp(n[2],s[2],o)]},r),t.invalidateDownstreamBooleanData(),t.refreshAttachedClonersInteractions()},start:()=>{t.updateGeometryInteractions({scaleBaked:n},r),t.invalidateDownstreamBooleanData(),t.refreshAttachedClonersInteractions()},end:()=>{t.updateGeometryInteractions({scaleBaked:s},r),t.invalidateDownstreamBooleanData(),t.refreshAttachedClonersInteractions()}}),a}function Tqe(t,e,i,r){if(!i.extrusion)return;let n=t.extrusion,s=e.extrusion??{},a=i.extrusion,o=[];return yoe.forEach(l=>{let c=Bp(l,n,s,a,r);c&&o.push(c)}),o}function Cqe(t,e,i,r){let n=[];if(!("geometry"in i))return n;let s=t.geometry.userData.parameters,a="geometry"in e?e.geometry:{},o=i.geometry;if(t instanceof IS){let l=Mqe(t,a,o,r);l&&n.push(...l)}else{let l={};if(Object.assign(l,Oh(s,q3),Oh(a,q3)),q3.forEach(c=>{let h=Bp(c,l,a,o,r);h&&n.push(h)}),t instanceof zG){Object.assign(l,{extrusion:{...s.extrusion}});let c=Tqe(l,a,o,r);c&&n.push(...c)}n.length&&n.push({update:c=>{t.updateGeometryInteractions(l,r),t.updateGeometryGroupsIfNeeded(),t.refreshAttachedClonersInteractions()},start:c=>{t.updateGeometryInteractions(l,r),t.updateGeometryGroupsIfNeeded(),t.refreshAttachedClonersInteractions()},end:c=>{t.updateGeometryInteractions(l,r),t.updateGeometryGroupsIfNeeded(),t.refreshAttachedClonersInteractions()}})}return n}function Pqe(t,e,i,r){let n=[];if(i.intensity!==void 0){let s=Vs("intensity",t,e,i,r);s&&n.push(s)}if(i.color!==void 0){let s=Aqe("color",t,e,i,r);s&&n.push(s)}return n}function Dqe(t,e,i,r){let n=[];if(Array.isArray(t.material)){if(!("materials"in i&&i.materials))return n;let s="materials"in e&&e.materials?e.materials:[],a=i.materials;t.material.forEach((o,l)=>{if(!a[l])return;let c=s[l]??{},h=a[l];typeof c=="string"||typeof h=="string"||n.push(..._Q(o,c,h,r))})}else{if(!("material"in i&&i.material))return n;let s="material"in e&&e.material?e.material:{},a=i.material;if(typeof s=="string"||typeof a=="string")return n;n.push(..._Q(t.material,s,a,r))}return n}function _Q(t,e,i,r){var a;let n=[],s=oy(i,r)||!!e.layers&&oy(e,r);n.push(Uqe(t,s));for(let o of t.layers){let l=(a=e.layers)==null?void 0:a.data(o.uuid),c=i.layers.data(o.uuid);if(!c||o.type!=="light"&&(!(o.visible??!0)||!(c.visible??!0)))continue;let h=o.getNames().filter(u=>!moe.some(d=>u.includes(d)));for(let u of h)try{let d=o.getValue(u),f;if(u==="colors")f=kqe(o,l,c,u);else if(Array.isArray(d))u==="steps"&&(f=Fqe(o,l,c,u));else if(typeof d=="number")f=Rqe(o,l,c,u,r);else{if(typeof d=="boolean")continue;d instanceof ye?f=Iqe(o,l,c,u):d instanceof N?f=Lqe(o,l,c,u,r):d instanceof Qs?f=Bqe(o,l,c,u,r):d instanceof Xt?f=Oqe(o,l,c,u,r):"isTexture"in d&&(f=Nqe(o,l,c,u))}f&&(Array.isArray(f)?n.push(...f):n.push(f))}catch(d){console.error(`lerpMaterial: unexpected material layer for ${u}`,d)}}return n}function Rqe(t,e,i,r,n){if(!t.hasValue(r)||!(r in i))return;let s=e?e[r]:t.getValue(r),a=i[r],o=typeof s=="string"?Number(n.getVariable(s)??0):s,l=typeof a=="string"?Number(n.getVariable(a)??0):a;if(o!==l)return{update:c=>{t.setValue(r,Et.lerp(o,l,c))},start:()=>{t.setValue(r,o)},end:()=>{t.setValue(r,l)}}}function Iqe(t,e,i,r){if(!t.hasValue(r)||!(r in i))return;let n=t.getValue(r),s=e?new ye().fromArray(e[r]):n.clone(),a=new ye().fromArray(i[r]);if(!s.equals(a))return{update:o=>{n.lerpVectors(s,a,o)},start:()=>{n.copy(s)},end:()=>{n.copy(a)}}}function Lqe(t,e,i,r,n){if(!t.hasValue(r)||!(r in i))return;let s=t.getValue(r),a=e?e[r]:void 0,o=i[r],l=a?wP(new N,a,n):s.clone(),c=wP(new N,o,n);if(!l.equals(c))return{update:h=>{s.lerpVectors(l,c,h)},start:()=>{s.copy(l)},end:()=>{s.copy(c)}}}function Oqe(t,e,i,r,n){if(!t.hasValue(r)||!(r in i))return;let s=e?e[r]:void 0,a=i[r],o=t.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new Xt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new Xt().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let h=o.clone();return{update:u=>{t.getValue(r)!==h&&t.setValue(r,h),h.lerpColors(l,c,u)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function Bqe(t,e,i,r,n){if(!t.hasValue(r)||!(r in i))return;let s=e?e[r]:void 0,a=i[r],o=t.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new Xt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new Qs(a.r,a.g,a.b,a.a);if(l.equals(c))return;let h=o.clone();return{update:u=>{t.getValue(r)!==h&&t.setValue(r,h),h.lerpColors(l,c,u)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function Fqe(t,e,i,r="steps"){if(!t.hasValue(r)||!(r in i))return;let n=[],s=t.getValue(r),a=e?e[r]:s,o=i[r];return iG(a,o)||n.push({update:l=>{let c=[...s];for(let h=0;h<s.length;++h){let u=a[h],d=o[h];c[h]=Et.lerp(u,d,l)}t.setValue(r,c)},start:()=>{t.setValue(r,a)},end:()=>{t.setValue(r,o)}}),n.length?n:void 0}function kqe(t,e,i,r="colors"){if(!t.hasValue(r)||!(r in i))return;let n=[],s=t.getValue(r),a=e?e[r]:s.map(l=>l.toArray()),o=i[r];for(let l=0;l<s.length;++l){let c=[...a[l]],h=[...o[l]];Y2.isEqual(c,h)||n.push({update:u=>{s[l].fromArray(Y2.lerp(c,h,u))},start:()=>{s[l].fromArray(c)},end:()=>{s[l].fromArray(h)}})}return n.length?n:void 0}function Nqe(t,e,i,r="texture"){var g,v;if(!t.hasValue(r)||!(r in i))return;let n=t.getNode("rotation"),s=((g=e==null?void 0:e[r])==null?void 0:g.rotation)??0,a=((v=i[r])==null?void 0:v.rotation)??0;if(n&&s!==a)return{update:y=>{n.value=Et.lerp(s,a,y)*Et.DEG2RAD},start:()=>{n.value=s*Et.DEG2RAD},end:()=>{n.value=a*Et.DEG2RAD}};let o=t.getNode("mat");if(!o)return;let l=e?e[r]:o,c=i[r],h=[...l.repeat],u=[...l.offset],d=[...c.repeat],f=[...c.offset],p=l.rotation??0,m=c.rotation??0;if(!Ju.isEqual(h,d)||!Ju.isEqual(u,f)||p!==m)return{update:y=>{o.repeat=Ju.lerp(h,d,y),o.offset=Ju.lerp(u,f,y),o.rotation=Et.lerp(p,m,y),o.updateMatrix()},start:()=>{o.repeat=[...h],o.offset=[...u],o.rotation=p,o.updateMatrix()},end:()=>{o.repeat=[...d],o.offset=[...f],o.rotation=m,o.updateMatrix()}}}function Uqe(t,e){return{update:()=>{t.transparent=e}}}var HO=new N,AQ=new Zn;function zqe(t,e,i,r,n){var p,m,g,v,y,x;let s=[],a,o,l,c,h,u,d,f;if(t instanceof Rs?(a=SP("position",t,e,i,n),a&&s.push(a),l=Vs("rotation",t,e,i,n),l&&s.push(l),c=SP("shear",t,e,i,n),c&&s.push(c)):(f={slide:((p=e.pathSnapping)==null?void 0:p.slide)??((m=t.updatedPathSnapping)==null?void 0:m.slide)??((g=t.dataPatched.pathSnapping)==null?void 0:g.slide)??0,offset:((v=e.pathSnapping)==null?void 0:v.offset)??((y=t.updatedPathSnapping)==null?void 0:y.offset)??((x=t.dataPatched.pathSnapping)==null?void 0:x.offset)??0},u=Vs("slide",f,e.pathSnapping??t.updatedPathSnapping??t.dataPatched.pathSnapping,i.pathSnapping??t.dataPatched.pathSnapping,n),u&&s.push(u),d=Vs("offset",f,e.pathSnapping??t.updatedPathSnapping??t.dataPatched.pathSnapping,i.pathSnapping??t.dataPatched.pathSnapping,n),d&&s.push(d),!u&&!d&&(a=wQ("position",t,e,i,n),a&&s.push(a),o=wQ("scale",t,e,i,n),o&&s.push(o),l=Gqe(t,e,i,r,n),l&&s.push(l),h=_qe("hiddenMatrix",t,e,i),h&&s.push(h))),a||o||l||h||u||d){let S=t instanceof Rs?()=>{t.updateWorldMatrix(!0,!1,!0),t.resetBBoxNeedsUpdate()}:()=>{var A;t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),(A=t.parent)!=null&&A.matrixWorldFusedFalse&&(t.matrixWorld.multiplyMatrices(t.parent.matrixWorldFusedFalse,t.matrix),t.matrixWorldNeedsUpdate=!1),wc(t)&&Zu(t.parent)&&t.invalidateDownstreamBooleanData(!0),t.updatePathSnapping(Object.assign({},e.pathSnapping,f))};s.push({update:S,start:S,end:S})}return s}function Gqe(t,e,i,r,n){var h;let s=e!=null&&e.rotation?e.rotation.map(u=>(typeof u=="string"?Number(n.getVariable(u)??0):u)*Et.DEG2RAD):void 0,a=(h=i.rotation)==null?void 0:h.map(u=>(typeof u=="string"?Number(n.getVariable(u)??0):u)*Et.DEG2RAD);if(!a)return;let o=s?new N().fromArray(s):new N().setFromEuler(t.rotation),l=new N().fromArray(a);if(o.equals(l))return;let c=HO.subVectors(l,o);if(r&&c.toArray().every(u=>Math.abs(u)<2*Math.PI)){let u=new ri().setFromEuler(AQ.setFromVector3(o)),d=new ri().setFromEuler(AQ.setFromVector3(l));return{update:f=>{Sqe(u,d,t.quaternion,f)},start:()=>{t.rotation.setFromVector3(o)},end:()=>{t.rotation.setFromVector3(l)}}}else return{update:u=>{HO.lerpVectors(o,l,u),t.rotation.setFromVector3(HO)},start:()=>{t.rotation.setFromVector3(o)},end:()=>{t.rotation.setFromVector3(l)}}}function Vqe(t,e,i,r){let n=[];if(!("cloner"in i)||!t.cloner)return n;let s=t.cloner,a="cloner"in e?e.cloner:{},o=i.cloner;coe.forEach(f=>{let p;f==="count"?p=Vs("count",s.parameters,a,o,r,!0):p=Bp(f,s.parameters,a??{},o,r),p&&n.push(p)});let l=Hqe(s,a,o,r);l!=null&&l.length&&n.push(...l);let c=jqe(s,a,o,r);c!=null&&c.length&&n.push(...c);let h=Wqe(s,a,o,r);h!=null&&h.length&&n.push(...h);let u=Xqe(s,a,o,r);u!=null&&u.length&&n.push(...u);let d=Yqe(s,a,o,r);return d!=null&&d.length&&n.push(...d),n.length&&n.push({update:()=>{s.update()}}),n}function Hqe(t,e,i,r){if(t.parameters.type!=="radial")return;let n=e.radial,s=i.radial;if(!s)return;let a=t.parameters.radial,o=[];return hoe.forEach(l=>{let c=Bp(l,a,n??{},s,r);c&&o.push(c)}),o}function jqe(t,e,i,r){if(t.parameters.type!=="linear")return;let n=e.linear,s=i.linear;if(!s)return;let a=[],o=t.parameters.linear;return uoe.forEach(l=>{let c=Bp(l,o,n??{},s,r);c&&a.push(c)}),a}function Wqe(t,e,i,r){if(t.parameters.type!=="grid")return;let n=e.grid,s=i.grid;if(!s)return;let a=[],o=t.parameters.grid;return doe.forEach(l=>{let c;l==="count"?c=iV(l,o,n??{},s,r,!0):c=Bp(l,o,n??{},s,r),c&&a.push(c)}),a}function Xqe(t,e,i,r){if(t.parameters.type!=="toObject")return;let n=e.toObject,s=i.toObject;if(!s)return;let a=[],o=t.parameters.toObject;return foe.forEach(l=>{let c;l==="count"?c=Vs(l,o,n??{},s,r,!0):c=Bp(l,o,n??{},s,r),c&&a.push(c)}),a}function Yqe(t,e,i,r){if(!t.parameters.randomness)return;let n=e.randomnessObject,s=i.randomnessObject;if(!s)return;let a=[],o=t.parameters.randomnessObject;return poe.forEach(l=>{let c=Bp(l,o,n??{},s,r);c&&a.push(c)}),a}function qqe(t,e){return{update:()=>{t instanceof Ss&&(t.fill.enabled=e)}}}function Kqe(t,e){return{update:()=>{t instanceof Ss&&(t.stroke.enabled=e)}}}function Qqe(t,e){return{update:()=>{t instanceof Ss&&(t.dropShadow.enabled=e)}}}function $qe(t,e){return{update:()=>{t instanceof Ss&&(t.innerShadow.enabled=e)}}}function Jqe(t,e){return{update:()=>{t instanceof Ss&&(t.backgroundBlur.enabled=e)}}}function Zqe(t,e){return{update:()=>{t instanceof Ss&&(t.layerBlur.enabled=e)}}}function eKe(t,e,i,r,n){let s=[],a,o,l,c,h,u,d,f,p,m,g,v,y,x,S;if("width"in t&&(a=Vs("width",t,e,i,n),a&&s.push(a)),"height"in t&&(o=Vs("height",t,e,i,n),o&&s.push(o)),t instanceof Ss||t instanceof Fh){let A={...e.fill},_={...i.fill};A.enabled!==void 0&&A.enabled!==_.enabled&&(s.push(qqe(t,!0)),A.enabled||Object.assign(A,{enabled:!0,color:{...A.color,a:0}}),_.enabled||Object.assign(_,{enabled:!0,color:{..._.color,a:0}})),l=ST("color",t.fill,A,_,n),l&&s.push(l)}if(t instanceof Ss){let A={...e.stroke},_={...i.stroke};(A.enabled||_.enabled)&&(s.push(Kqe(t,!0)),A.enabled||Object.assign(A,{enabled:!0,color:{...A.color,a:0}}),_.enabled||Object.assign(_,{enabled:!0,color:{..._.color,a:0}})),c=ST("color",t.stroke,A,_,n),c&&s.push(c),h=Vs("thickness",t.stroke,A,_,n),h&&s.push(h)}if(t instanceof Ss){let A={...e.dropShadow},_={...i.dropShadow};(A.enabled||_.enabled)&&(s.push(Qqe(t,!0)),A.enabled||Object.assign(A,{enabled:!0,color:{...A.color,a:0}}),_.enabled||Object.assign(_,{enabled:!0,color:{..._.color,a:0}})),u=ST("color",t.dropShadow,A,_,n),u&&s.push(u),d=Vs("blurRadius",t.dropShadow,A,_,n),d&&s.push(d),p=Vs("spread",t.dropShadow,A,_,n),p&&s.push(p),f=SP("offset",t.dropShadow,A,_,n),f&&s.push(f)}if(t instanceof Ss){let A={...e.innerShadow},_={...i.innerShadow};(A.enabled||_.enabled)&&(s.push($qe(t,!0)),A.enabled||Object.assign(A,{enabled:!0,color:{...A.color,a:0}}),_.enabled||Object.assign(_,{enabled:!0,color:{..._.color,a:0}})),m=ST("color",t.innerShadow,A,_,n),m&&s.push(m),g=Vs("blurRadius",t.innerShadow,A,_,n),g&&s.push(g),y=Vs("spread",t.innerShadow,A,_,n),y&&s.push(y),v=SP("offset",t.innerShadow,A,_,n),v&&s.push(v)}if(t instanceof Ss||t instanceof Fh){let A={...e.backgroundBlur},_={...i.backgroundBlur};(A.enabled||_.enabled)&&(s.push(Jqe(t,!0)),A.enabled||Object.assign(A,{enabled:!0,radius:0}),_.enabled||Object.assign(_,{enabled:!0,radius:0})),x=Vs("radius",t.backgroundBlur,A,_,n),x&&s.push(x)}if(t instanceof Ss){let A={...e.layerBlur},_={...i.layerBlur};(A.enabled||_.enabled)&&(s.push(Zqe(t,!0)),A.enabled||Object.assign(A,{enabled:!0,radius:0}),_.enabled||Object.assign(_,{enabled:!0,radius:0})),S=Vs("radius",t.layerBlur,A,_,n),S&&s.push(S)}if(t instanceof Fh||t instanceof N_){let A=iV("cornerRadius",t,e,i,n);A&&s.push(A)}return s}function EQ(t,e,i,r,n){let s=[];return t.data.visible&&s.push(...zqe(t,e,i,n,r)),t instanceof Rs?s.push(...eKe(t,e,i,n,r)):(t.data.visible&&s.push(...Vqe(t,e,i,r)),wc(t)?(t instanceof Fn&&t.data.visible&&s.push(...Cqe(t,e,i,r)),t.data.visible&&s.push(...Dqe(t,e,i,r))):UWe(t)?t.data.visible&&s.push(...Pqe(t,e,i,r)):NWe(t)&&s.push(...Eqe(t,e,i,r))),s.length?{update:a=>{s.forEach(o=>o.update(a))},start:a=>{s.forEach(o=>{var l;return(l=o.start)==null?void 0:l.call(o,a)})},end:a=>{s.forEach(o=>{var l;return(l=o.end)==null?void 0:l.call(o,a)})}}:void 0}var MQ=new N;function rV(t,e,i=!1){var s;let r=[],n=a=>{let o=a.data;delete a.states,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let l of o.states){let c={...l.data};a.states||(a.states={}),a.states[l.id]=Jm.patch(o,c)}CQ(t.scene,a,null,e,o.events.find(l=>l.data.type==="Follow"||l.data.type==="LookAt")!==void 0),TQ(t)};t.scene.traverse2D(n),t.traverseChildren(a=>{var h,u,d,f,p,m;if(i&&((h=a.rigidBody)==null||h.setTranslation(a.position0,!0),(u=a.rigidBody)==null||u.setRotation(a.rotation0,!0),(d=a.rigidBody)==null||d.setLinvel(MQ,!0),(f=a.rigidBody)==null||f.setAngvel(MQ,!0)),!Ti.is(a))return;let o=a.uuid,l=a.data;if(delete a.states,a.uuid===J1)return;let c=!1;r.some(g=>{var v;return(v=t.scene.find(o))==null?void 0:v.isDescendantOf(g)})?c=!0:((p=l.physics)==null?void 0:p.fusedBody)===!0&&l.physics.rigidBody==="dynamic"&&r.push(o),a.data=l,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let g of l.states){let v={...g.data};t.data.globalPhysics.usePhysics===!0&&l.physics&&(l.physics.rigidBody==="dynamic"||c)&&(g.data.position!==void 0&&delete v.position,g.data.rotation!==void 0&&delete v.rotation,g.data.hiddenMatrix!==void 0&&delete v.hiddenMatrix),a.states||(a.states={}),a.states[g.id]=Km.patch(l,v)}CQ(t.scene,a,null,e,l.events.find(g=>g.data.type==="Follow"||g.data.type==="LookAt")!==void 0),a instanceof da&&a.frame&&(a.frame.traverse(g=>n(g)),(m=a.uiCanvas)==null||m.applySize())}),TQ(t),t.frame&&(t.frame.traverse(a=>n(a)),(s=t.uiCanvas)==null||s.applySize())}function TQ(t){t.traverseEntity(e=>{for(let i of e.data.events){let r=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":r.push(...i.data.actions);break;case"GameControl":for(let n of Object.values(i.data.gameActions))r.push(...n);break;case"DragDrop":r.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":r.push(...i.data.inActions,...i.data.outActions);break}for(let n of r)if(n.data.type==="Create"&&n.data.hideBase==="Yes"){let s=t.scene.find(n.data.object);s&&(s.visible=!1)}}})}function CQ(t,e,i,r,n=!1){if(e instanceof Fn&&!(e instanceof qg)&&e.removeInteractionGeometry(r),e instanceof Rs?e.changeSelectedState(i,{shared:r},n):e.changeSelectedState(i,{scene:t,shared:r},n),e instanceof Fn&&e.updateGeometryGroupsIfNeeded(),e instanceof ga&&e.updateCameraState(e.dataPatched,{scene:t,shared:r}),!(e instanceof Rs)){if(e.cloner)for(let s of e.cloner.children)s.playModeVisible=void 0;e.updateVisible()}}function Gce(t){let e;if(t.easing===5){let{control1:i,control2:r}=t;e=`cubicBezier(
			${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
		)`}else if(t.easing===6){let{mass:i,stiffness:r,damping:n,velocity:s}=t;e=`spring( ${i}, ${r}, ${n}, ${s} )`}else{let i;switch(t.easing){case 0:i=vf.linear;break;case 1:i=vf.ease;break;case 2:i=vf.easeIn;break;case 3:i=vf.easeOut;break;case 4:i=vf.easeInOut;break;default:i=vf.linear}let[r,n,s,a]=i;e=`cubicBezier( ${r}, ${n}, ${s}, ${a} )`}return{duration:Math.max(t.duration,1e-4),easing:e}}function EU(t){let e={delay:0,loop:t.repeat===-1?!0:t.repeat+1};if(t.repeat===0)e.direction="normal",e.rewind=!1;else switch(t.direction){case"pingpong":e.direction="alternate",e.rewind=!1;break;case"pingpong-rewind":e.direction="alternate",e.rewind=!0;break;default:e.direction="normal",e.rewind=!1;break}switch(e.delay=0,e.endDelay=0,e.startOnceDelay=0,e.pingPongDelayCorrection=0,e.pingPongEndDelayCorrection=0,t.delayDirection){case"start-once":e.startOnceDelay=t.delay;break;case"start":e.delay=t.delay;break;case"end":e.endDelay=t.delay;break;case"start-end":case void 0:e.delay=t.delay,e.endDelay=t.delay;break}return e.direction==="alternate"&&(e.delay/=2,e.endDelay/=2,t.delayDirection==="start"?(e.pingPongDelayCorrection=e.delay,typeof e.loop=="number"&&e.loop%2===0&&(e.pingPongEndDelayCorrection=e.delay)):t.delayDirection==="end"?typeof e.loop=="number"&&e.loop%2!==0&&(e.pingPongEndDelayCorrection=e.endDelay):t.delayDirection==="start-end"&&(e.pingPongDelayCorrection=e.delay,e.pingPongEndDelayCorrection=e.endDelay)),e}var tKe={type:"beginState"},iKe={type:"completeState",isfromEntity:!1},PQ=class{constructor(t,e,i,r,n,s){if(this.object=t,this.data=r,this.sharedAssets=n,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let a=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"beginState",state:a}),this.object instanceof Rs||this.object.traverseEntity(o=>{o!==this.object&&o instanceof ga&&o.dispatchEvent(tKe)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let a=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"completeState",state:a}),this.object instanceof Rs||this.object.traverseEntity(o=>{o!==this.object&&o instanceof ga&&o.dispatchEvent(iKe)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=EQ(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},e===void 0){let a=AC(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!a)throw new Error("Missing property");this.from=a}else{let a=AC(this.object,e);if(!a)throw new Error("Missing property");this.from=a}if(i===void 0)throw new Error("Missing property");{let a=AC(this.object,i);if(!a)throw new Error("Missing property");this.to=a}this.useCurrentState=e===void 0||i===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...EU(r),...Gce(r),change:this.onChange},this.callback=EQ(this.object,e===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},Vce=class extends Js{constructor(t,e,i,r,n){var a;if(super(),this.eventType=t,this.data=e,this.page=i,this.shared=r,this.condition=n,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.hasPlayedOnce=!1,this.onTimelineChangeComplete=()=>{var o;this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&((o=this.timeline)==null||o.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!e.object)throw new Error("Missing property");let s=this.page.scene.find(e.object)??((a=this.page.uiCanvas)==null?void 0:a.find(e.object))??this.page.scene.find2DInUIObjects(e.object);if(!s)throw new Error("Missing property");if(!s.states)throw new Error("Missing property");if(this.object=s,e.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=e.tweens[0].data.delayDirection==="start-once"?e.tweens[0].data.delay:0,this.init()}get playing(){var t;return((t=this.timeline)==null?void 0:t.paused)===!1}get changeBegan(){return this.tweens.some(t=>t.changeBegan)??!1}init(){this.initialCurrentState=AC(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.data.runMode==="Toggle"&&MY(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:t=!0,needsRebuild:e=!1,isRebuild:i=!1}={}){var r,n,s,a;try{let o=EU(this.data.tweens[0].data);i&&typeof o.loop=="number"&&o.loop--,(r=this.timeline)==null||r.pause(),this.timeline=zce.timeline({autoplay:!1,...o,...o.loop===!0||o.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let l=this.tweens.findIndex(c=>c==null?void 0:c.changeBegan);if(e===!0&&(this.timelineNeedsRebuild=!0),t){let c=l===-1?0:l;for(let h=c;h<this.data.tweens.length-1;h++){let u=this.data.tweens[h],d=this.data.tweens[h+1],f;h===c&&(this.object.wasMovedByUser===!0||((n=this.object.previousAction)==null?void 0:n.changeBegan)===!0)?(f=void 0,this.object instanceof ga&&(this.object.wasMovedByUser=!1)):f=u.data.state===void 0?this.currentState:u.data.state;let p=new PQ(this.object,f,d.data.state===void 0?this.currentState:d.data.state,d.data,this.shared,this.data.allowSlerp??!1);l!==-1&&h===c&&Object.assign(p.params,{startOnceDelay:0}),this.tweens[h]=p,this.timeline.add(p.params,this.timeline.duration+(h===c?o.delay:0))}this.timeline.duration+=o.endDelay}else{let c=l===-1?this.data.tweens.length-1:l+1;for(let h=c;h>0;h--){let u=this.data.tweens[h],d=this.data.tweens[h-1],f;h===c&&(this.object.wasMovedByUser===!0||((s=this.object.previousAction)==null?void 0:s.changeBegan)===!0)?(f=void 0,this.object instanceof ga&&(this.object.wasMovedByUser=!1)):f=u.data.state===void 0?this.currentState:u.data.state;let p=new PQ(this.object,f,d.data.state===void 0?this.currentState:d.data.state,u.data,this.shared,this.data.allowSlerp??!1);l!==-1&&h===c&&Object.assign(p.params,{startOnceDelay:0}),this.tweens[h-1]=p,this.timeline.add(p.params,this.timeline.duration+(h===c?o.endDelay:0))}this.timeline.duration+=o.delay}}catch(o){o instanceof Error&&console.error(o.message)}((a=this.object.previousAction)==null?void 0:a.playing)===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(Ar(this.shared,this.condition)===!1||MY(this.eventType)&&this.data.runMode==="Once"&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;clearTimeout(this.timeoutId);let t=EU(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(e){e instanceof Error&&console.error(e.message)}},this.startOnceDelay+t)}pause(){var t;(t=this.timeline)==null||t.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let t=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof Rs?this.object.changeSelectedState(t,{shared:this.shared}):this.object.changeSelectedState(t,{scene:this.page.scene,shared:this.shared}),this.object.currentState=t}seek(t){var e;if(Ar(this.shared,this.condition)===!1)return!1;this.timeline===void 0&&this.buildTimeline(),(e=this.timeline)==null||e.seek(t*this.timeline.duration,!0)}toggle(t){var e;if(Ar(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),this.toggleIsForward=t??!this.toggleIsForward,this.playing?((e=this.timeline)==null||e.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{var i;(i=this.timeline)==null||i.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function AC(t,e){var n;let i,r;if(typeof e=="string"?(i=e,r=(n=t.states)==null?void 0:n[i]):e===null&&(i=null,r=t.data),!(i===void 0||r===void 0))return{id:i,data:r}}var rKe={type:"beginState"},DQ={type:"completeState",isfromEntity:!1},RQ={type:"requestRender"},Hce=class extends Js{constructor(t,e,i,r){super(),this.data=t,this.page=e,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.posStart=new N,this.posEnd=new N,this.qStart=new ri,this.qEnd=new ri,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(t=!1){if(!this.data.animate)return;let e=this.page.scene.find(this.data.targetCamera);if(!e||!e.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=zce({targets:i,t:1,...Gce(this.data),update:()=>{i.t===0&&(this.data.runMode==="Toggle"&&!this.toggleIsForward?this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(e.position),this.qEnd.copy(e.quaternion),this.zoomEnd=e.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(e.uuid)),this.page.activeCamera.dispatchEvent(rKe));let r=this.page.activeCamera;r.position.lerpVectors(this.posStart,this.posEnd,i.t),r.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),r.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,r.wasMovedBySwitchCameraAction=!0,r.updateMatrix(),r.updateMatrixWorld(),r.updateProjectionMatrix(),r.dispatchEvent(RQ),i.t===1&&r.dispatchEvent(DQ)}})}switchCamera(t){let e=this.page.activeCamera,i=this.page.scene.find(t);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),e.dispatchEvent({type:"cameraChange",camera:i})}play(){if(Ar(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var t;delete this.timeoutId,this.data.animate?(this.buildAnimation(),(t=this.animation)==null||t.play()):this.switchCamera(this.data.targetCamera)},this.data.delay*1e3)}catch{}}pause(){var t;(t=this.animation)==null||t.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(t){var e,i;if(Ar(this.shared,this.condition)===!1)return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,t!==this.toggleIsForward)try{this.playing?((e=this.animation)==null||e.pause(),this.toggleIsForward=t??!this.toggleIsForward,this.buildAnimation(!0),(i=this.animation)==null||i.play()):this.timeoutId=window.setTimeout(()=>{var r,n;this.toggleIsForward=t??!this.toggleIsForward,this.data.animate?((r=this.animation)==null||r.pause(),this.buildAnimation(),(n=this.animation)==null||n.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(DQ),this.page.activeCamera.dispatchEvent(RQ))},this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}};function jce(t){let e=t==null?void 0:t.tracks.filter(i=>i.ValueTypeName==="vector"||i.ValueTypeName==="quaternion").map(i=>i.times.length);if(e!=null&&e.length){let i=R5e(e);return i&&i>2?i:2}return 2}var Wce=class extends Js{constructor(t,e,i,r,n){var l,c,h;super(),this.data=t,this.page=e,this.animationControls=i,this.shared=r,this.condition=n,this.startOnceDelay=0,this.toggleIsForward=!1;let s=t.object,a=e.scene.find(t.object);a&&Array.isArray(a.identity)&&(s=a.identity[0]),this.data={...t,object:s};let o=this.animationControls.clipIdToAction[t.clipId+"/"+s];if(this.duration=((l=o==null?void 0:o.getClip())==null?void 0:l.duration)??1,this.data.crop2){let u=jce(o==null?void 0:o.getClip());this.leftFrameTime=this.data.crop2[0]/(u-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(u-1)*this.duration}else{let u=(h=(c=o==null?void 0:o.getClip())==null?void 0:c.tracks[0])==null?void 0:h.times.length;u&&u>1?(this.leftFrameTime=this.data.crop[0]/u*this.duration,this.rightFrameTime=this.data.crop[1]/u*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=t.delay}get playing(){var t;return((t=this.threeAnimAction)==null?void 0:t.isRunning())??!1}play(t=!1){if(Ar(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let e=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([r,n])=>{let s=r.split("/")[1];this.threeAnimAction!==n&&s===e&&n.isRunning()&&(t?n.fadeOut(.2):n.stop())}),t&&((i=this.threeAnimAction)==null||i.fadeIn(.2))},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){var t;(t=this.threeAnimAction)==null||t.fadeOut(.2)}seek(t){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=Et.clamp(this.threeAnimAction.time+1/60*t,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(t,e=!1){if(Ar(this.shared,this.condition)===!1)return!1;this.toggleIsForward=t??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let r=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([n,s])=>{let a=n.split("/")[1];this.threeAnimAction!==s&&a===r&&s.isRunning()&&(e?s.fadeOut(.2):s.stop())}),e&&((i=this.threeAnimAction)==null||i.fadeIn(.2))}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){var e;let t=(e=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object])==null?void 0:e.getClip();t&&(t.duration=this.duration),this.pause()}},Xce=class{constructor(t,e,i,r,n){this.data=t,this.page=e,this.eventManager=i,this.shared=r,this.condition=n,this.timeOutId=-1,this.scene=e.scene}dispatch(){if(Ar(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(e=>e.uuid!==this.data.target||e.data.uiScene))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let t=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity(e=>{e.type==="ParticleSystem"&&(e.sleep(),e.wakeUp(),e.data.autoPlay?e.start():e.stop())}),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(t),rV(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},Yce=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=Ar(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let t=this.shared.getVariable(this.data.variableId),e=qoe(this.data.expression,this.shared,Ys.typeOfVariable(t));e!==void 0&&this.shared.updateVariable(this.data.variableId,typeof e=="string"?{textValue:e}:e)}dispose(){}},qce=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r,this.timeoutId=null}dispatchInner(){if(Ar(this.shared,this.condition)===!1)return!1;let t=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,t==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&t!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&t!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&t!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let e=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);t==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,e===void 0?!1:!e):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!e),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let t=this.data.delay,e=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&e==="Playing"&&(t=this.data.pauseDelay),t!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},t)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}},nKe=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r}dispatch(){if(Ar(this.shared,this.condition)===!1)return!1;(this.data.target==="single"?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach(t=>{var i;this.shared.getVariable(t);let e=(i=this.shared.data.variables.data(t))==null?void 0:i.value;e!==void 0&&this.shared.updateVariable(t,e),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(rU(t))})}dispose(){}},sKe=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r}dispatch(){var t;if(Ar(this.shared,this.condition)===!1)return!1;this.data.userAPIId&&((t=this.shared.getUserAPI(this.data.userAPIId))==null||t.callUserAPI(this.shared))}dispose(){}};function Ar(t,e){if(e===void 0)return!0;if(e.expression.length===0)return!1;let i=qoe(e.expression,t,"boolean");return e.negate?!i:!!i}function Gn(t,e,i,r,n,s){let a={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},o=l=>({id:c,data:h})=>{try{h.type==="Audio"?oa[t.type].includes("Audio")&&a.Audio.push(new bce(c,h,s,r,l)):h.type==="Video"&&!(s instanceof Rs)?oa[t.type].includes("Video")&&a.Video.push(new Qce(c,h,s,r,l)):h.type==="Particles"?oa[t.type].includes("Particles")&&a.Particles.push(new wce(h,i,r,l)):h.type==="Link"?oa[t.type].includes("Link")&&a.Link.push(new WYe(h,n.controlsManager,r,l)):h.type==="Create"?oa[t.type].includes("Create")&&a.Create.push(new $ce(h,i,n.controlsManager,r,l)):h.type==="Destroy"?oa[t.type].includes("Destroy")&&a.Destroy.push(new Sce(h,i,n.controlsManager,r,l)):h.type==="Reset"?oa[t.type].includes("Reset")&&a.Reset.push(new _ce(h,i,r,n,l)):h.type==="Transition"?oa[t.type].includes("Transition")&&a.Transition.push(new Vce(t.type,h,i,r,l)):h.type==="SwitchCamera"?oa[t.type].includes("SwitchCamera")&&a.SwitchCamera.push(new Hce(h,i,r,l)):h.type==="SceneTransition"?oa[t.type].includes("SceneTransition")&&a.SceneTransition.push(new Xce(h,i,n,r,l)):h.type==="Animation"?oa[t.type].includes("Animation")&&a.Animation.push(new Wce(h,i,n.animationControls,r,l)):h.type==="SetVariable"?oa[t.type].includes("SetVariable")&&a.SetVariable.push(new Yce(h,i,r,l)):h.type==="DynamicVariablePlay"?oa[t.type].includes("DynamicVariablePlay")&&a.DynamicVariablePlay.push(new qce(h,i,r,l)):h.type==="Conditional"?oa[t.type].includes("Conditional")&&(h.ifActions.forEach(o({expression:h.condition,negate:!1})),h.elseActions.forEach(o({expression:h.condition,negate:!0}))):h.type==="ClearLocalStorage"?oa[t.type].includes("ClearLocalStorage")&&a.ClearLocalStorage.push(new nKe(h,i,r,l)):h.type==="UserAPI"&&oa[t.type].includes("UserAPI")&&a.UserAPI.push(new sKe(h,i,r,l))}catch{}};return e.forEach(o()),a}function Cs(t){Object.values(t).forEach(e=>{e.forEach(i=>{(i instanceof bce||i instanceof Qce||i instanceof wce||i instanceof Wce||i instanceof Vce||i instanceof $ce||i instanceof Sce||i instanceof Hce||i instanceof Xce||i instanceof _ce||i instanceof Yce||i instanceof qce)&&i.dispose()})})}function aKe(t,e){let i;if("material"in t){let r=t.material;Array.isArray(r)?i=t.material[0].layers.find(n=>n.uuid===e):i=t.material.layers.find(n=>n.uuid===e)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var Kce=new Map,_w=new Map,Ny=class{constructor(t,e,i){this.data=e,this.delay=0,this.status="stopped";let{layerId:r,loop:n,volume:s,delay:a}=e;if(this.object=i,r===void 0)throw new Error("Missing property");let o=aKe(i,r);o&&(this.videoElement=o,this.videoElement.loop=n===1/0,R_&&(this.videoElement.autoplay=!0),s!==void 0&&(this.videoElement.volume=s)),a!==void 0&&(this.delay=a),_w.has(i.uuid)?_w.get(i.uuid).push(this):_w.set(i.uuid,[this]),Kce.set(t,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(t){if(!this.videoElement)return;let e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);t?(this.mute(),this.delay+=150):e?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();i!==void 0&&i.then(r=>{}).catch(r=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},MU=class{constructor(t){this.data=t}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(t){let e=Kce.get(t);!e||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e[this.data.interaction](),this.disposeDelay()},this.data.delay)):e[this.data.interaction]())}pauseAllVideosFromObject(t){let e=_w.get(t);!(e!=null&&e.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):e.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let t=[..._w.values()];!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(e=>{e.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):t.forEach(e=>{e.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},Qce=class{constructor(t,e,i,r,n){if(this.data=e,this.shared=r,this.condition=n,e.interaction==="play")this.interaction=new Ny(t,e,i);else if(e.interaction==="pause"||e.interaction==="stop")this.interaction=new MU(e);else throw new Error("Missing property")}dispatchBasic(){if(Ar(this.shared,this.condition)===!1)return!1;this.interaction instanceof Ny?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Ar(this.shared,this.condition)===!1)return!1;this.interaction instanceof Ny?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},IQ=(()=>{let t,e,i,r;function n(o){!t&&!LQ()&&(e==null?void 0:e.sharedGameControlGlobals.createdObjects.length)>0&&(t=requestAnimationFrame(s)),o&&(e=o,r=o.requestRender)}function s(o){let l=i?o-i:0,c=e.sharedGameControlGlobals.createdObjects,h=e.sharedGameControlGlobals.nCreatedPerAction,u=c.length,d=0;for(;d<u;){let f=c[d];f.userData.createdTime===void 0&&(f.userData.createdTime=o),f.userData.lifetime===void 0&&f.userData.quantity===void 0||f.userData.lifetime&&o-f.userData.createdTime<f.userData.lifetime||f.userData.quantity&&h[f.userData.actionId]<=f.userData.quantity?(f.userData.velocity&&(f.position.addScaledVector(f.userData.velocity,l/1e3),f.updateMatrix(),r()),d++):(h[f.userData.actionId]>f.userData.quantity&&h[f.userData.actionId]--,c.splice(d,1),f.removeFromParent(),e.sharedGameControlGlobals.rapierWorld&&f.rigidBody?(e.sharedGameControlGlobals.colliderToEntity.delete(f.rigidBody.collider(0).handle),e.sharedGameControlGlobals.rapierWorld.removeRigidBody(f.rigidBody)):(f.bvhGeometry=void 0,e.sharedGameControlGlobals.entitiesWithTransformAnim=e.sharedGameControlGlobals.entitiesWithTransformAnim.filter(p=>p.bvhGeometry!==void 0)),u--,r())}t=d>0?requestAnimationFrame(s):void 0,i=d>0?o:void 0}function a(){LQ()?t&&(cancelAnimationFrame(t),t=void 0,i=void 0):n()}return typeof document<"u"&&document.addEventListener("visibilitychange",a),n})();function LQ(){return!!document&&document.hidden}var OQ=new ri,oKe=new N,lKe=new N,$ce=class{constructor(t,e,i,r,n){this.data=t,this.page=e,this.controlsManager=i,this.shared=r,this.condition=n,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=Et.generateUUID(),this.dispatch=()=>{if(Ar(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{if(Ar(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=K5e(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let a=new qs(this.object);if(a.playModeVisible=!0,a.expand(),this.data.coordinateSystem!=="world"){let l=this.data.coordinateSystem,c=this.page.scene.find(l);c&&(c.updateMatrixWorldSVD(),a.hiddenMatrix.copy(c.matrixWorldRigid))}a.scale.copy(this.object.scale),a.position.fromArray(this.data.position),a.rotation.fromArray(this.data.rotation),a.updateMatrix(),this.page.add(a);let o=this.controlsManager.sharedGameControlGlobals;o.createdObjects.push(a),o.nCreatedPerAction[this.uniqueId]===void 0?o.nCreatedPerAction[this.uniqueId]=1:o.nCreatedPerAction[this.uniqueId]++,a.updateWorldMatrix(!0,!0),a.traverseObject(this.traverseObjectCB),IQ(),this.controlsManager.requestRender()},this.traverseObjectCB=a=>{var h,u,d,f;a.hasNonUniformScale&&a.updateMatrixWorldSVD();let o;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(a instanceof Ol)if(a.objectForSample){if(a.objectForSample.dataPatched.physics.fusedBody)return;o=a.object}else return a.object.dataPatched.physics.fusedBody===!0&&a.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(a instanceof qs)o=a.object;else if(o=a,(h=o.dataPatched.cloner)==null?void 0:h.hideBase)return!0}else{if(a instanceof Ol)return;a instanceof qs?o=a.object:o=a}this.data.destroy==="Time"?a.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(a.userData.quantity=this.data.destroyAfterQuantity,a.userData.actionId=this.uniqueId);let l=new N().fromArray(this.data.velocity),c=o.dataPatched;if(!(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(a,o,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&((u=a.rigidBody)==null||u.collider(0).setActiveEvents(1),a.userData.hasCollisionDestroy=!0),a.matrixWorld.decompose(oKe,OQ,lKe),l.applyQuaternion(OQ),this.data.velocity.some(p=>p!==0)&&this.data.dynamic&&((d=a.rigidBody)==null||d.setLinvel(l.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in a.object&&this.controlsManager.addBoundsTree(a),this.data.velocity.some(p=>p!==0)&&this.data.dynamic&&(a.userData.velocity=l)),((f=o.dataPatched.physics)==null?void 0:f.fusedBody)===!0))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");IQ(i)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(t=>window.clearTimeout(t)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},Jce=200,jO=.02,WO=.3,cKe=65;new N;var BQ=new N,FQ=new N,hKe=new N,Pa=new N,Ja=new N,cf=new N,XO=new st,kQ=new st,uKe=new st;new st;var uc=new ri,xu=new ri,sh=new Zn(0,0,0,"YXZ"),dKe=new N(1,0,0),dc=new N(0,1,0),fKe=new N(0,0,1),NQ=new N(1,1,1);new wo;var pKe=1,mKe=.025,gKe=16e-6,UQ=12,vKe=20,gs=new Ul,dl=new _n,yKe={type:"requestRender"},xKe={type:"updateMatrix"},zQ=Math.PI/6,TU=class extends Js{constructor(t,e,i,r,n,s,a,o,l){var p;super(),this.object=t,this.domElement=e,this.data=i,this.gloabalPhysics=r,this.controlsManager=n,this.cameraFollow=s,this.camera=a,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new st,this.target0=new N,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=Jce,this.euler0=new Zn(0,0,0,"YXZ"),this.position0Cam=new N,this.quat0Cam=new ri,this.scale0Cam=new N,this.hiddenMatrix0Cam=new st,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new Ul(new N(0,-40,0),new N(0,40,0)),matrix:new st,position:new N,rotation:new ri},this.euler=new Zn(0,0,0,"YXZ"),this.eulerDelta=new N,this.lastPosition=new N,this.lastCameraQuaternion=new ri,this.lastCameraPosition=new N,this.PI_2=Math.PI/2,this.prevMouse=new ye,this.velocityTarget=new N,this.velocity=new N,this.directionXZ=new N,this.rotVelocityStick=new N,this.rotVelocityTarget=new N,this.rotVelocity=new N,this.rotDirection=new N,this.nonColliderRotOffset=new st,this.nonColliderPosOffset=new st,this.firstPointerId=-1,this.rot=new N,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new st,this.objectToTarget=new N,this.objectToTarget0=new N,this.objectToCamXZ=new N,this.objectToCamXZ0=new N,this.targetToCamera=new N,this.targetToCamera0=new N,this.cameraPolarAxis0=new N,this.targetPos=new N,this.targetQuat=new ri,this.lerpFactorPos=new N().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new ri,this.objXZQuatInv=new ri,this.objXZRotMat=new st,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new N,this.pushedVelocity=new N,this.groundYRotation=0,this.objectRealQuat=new ri,this.colliderWorldQuat=new ri,this.groundNormal=new N,this.groundTilt=new ri,this.groundTiltInv=new ri,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new N,this.quaternion=new ri,this.scale=new N,this.initialAction=!0,this.onPointerDown=m=>{var g;!(m.target===this.domElement||m.target instanceof HTMLElement&&m.target.tagName==="SPLINE-VIEWER"&&((g=m.target.shadowRoot)!=null&&g.contains(this.domElement)))||this.firstPointerId!==-1||(this.firstPointerId=m.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!No&&!uY&&this.domElement.requestPointerLock(),this.prevMouse.set(m.clientX,m.clientY))},this.onPointerUp=m=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),m.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=m=>{if(m.pointerId!==this.firstPointerId)return;let g=m.clientX-this.prevMouse.x,v=m.clientY-this.prevMouse.y;this.prevMouse.set(m.clientX,m.clientY),m.pointerType==="mouse"&&this.rotBy!=="keys"&&(uY&&sGe<15.5&&!No?(this.eulerDelta.y=-g*this.mouseOrbitSensitivity,this.eulerDelta.x=-v*this.mouseOrbitSensitivity):(this.eulerDelta.y=-m.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-m.movementY*this.mouseOrbitSensitivity)),m.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-g*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-v*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=m=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?TU.isLocked=!0:TU.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document!=null&&document.hidden)for(let m in this.movementState)this.movementState[m]=0},this.onKeyDown=m=>{!(m.target instanceof HTMLInputElement)&&(m.code==="ArrowLeft"||m.code==="ArrowUp"||m.code==="ArrowRight"||m.code==="ArrowDown"||m.code==="Space")&&m.preventDefault();for(let g of this.keyAssignments)if(m.key.toUpperCase()===g[1]||m.key===g[1]){this.movementState[g[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=m=>{for(let g of this.keyAssignments)if(m.key.toUpperCase()===g[1]||m.key===g[1]||m.code.slice(3,m.code.length).toUpperCase()===g[1]){this.movementState[g[0]]=0;break}},this.copyVRGamePadValues=(m,g)=>{for(let v=2;v<4;v++){let y=m.axes[v];g===0?v===2?this.movementState.movePosX=y:this.movementState.movePosZ=y:(m.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,v===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(y)>=.3&&(this.vrEulerYOffset+=y<0?1:-1),this.movementState.rotPosY=y):this.moveMode==="fly"&&(this.movementState.moveNegY=y))}},this.sharedGameControlGlobals=n.sharedGameControlGlobals,t===a&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let c=this.euler0.clone(),h=c.y;if(this.objectRealQuat.copy(this.quaternion),c.y=0,this.quaternion.setFromEuler(c),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),c.set(0,h,0),this.quaternion.setFromEuler(c),this.rot.setFromEuler(c),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy((p=this.camera)==null?void 0:p.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let m=new N(0,0,-1).applyQuaternion(this.camera.quaternion),g=new N().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(g),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let v,y;Math.abs(m.y)<1e-6?(g.y=0,m.y=0,y=g.projectOnVector(m)):g.y/m.y>0?y=m.multiplyScalar(g.y/m.y):y=m.multiplyScalar(g.length()),this.targetToCamera0.copy(y).negate(),v=this.camera.position.clone().add(y),this.objectToTarget0.subVectors(v,this.position);let x=new Zn().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-x.x,x.x=0,x.z=0,x.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(x)}if(this.object instanceof ga&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=(i.speedTranslate??250)*pKe,this.speedOrbit=(i.speedRotate??100)*mKe,this.mouseOrbitSensitivity=(i.speedRotate??100)*gKe,this.keyAssignments=i.keyAssignments.map(m=>{let g=[m[0],m[1]];return g[1]===""?g[1]="ArrowUp":g[1]===""?g[1]="ArrowLeft":g[1]===""?g[1]="ArrowDown":g[1]===""?g[1]="ArrowRight":g[1]===""?g[1]="Shift":g[1]===""?g[1]="Enter":g[1]==="Space"?g[1]=" ":g[1]===""?g[1]="Meta":g[1]==="Ctrl"?g[1]="Control":g[1]==="Esc"&&(g[1]="Escape"),g}),i.rotBy==="mouse"){let m;m=this.keyAssignments.findIndex(g=>g[0]==="rotNegX"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(g=>g[0]==="rotPosX"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(g=>g[0]==="rotPosY"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(g=>g[0]==="rotNegY"),m!==-1&&(this.keyAssignments[m][1]="")}this.lerpFactorPosStart=1-.02**(1/((i.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((i.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((i.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((i.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((i.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((i.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??p1.defaultData.gravity)*UQ,this.usePhysics=this.gloabalPhysics.usePhysics??p1.defaultData.usePhysics,this.jumpPower=i.jumpPower*vKe,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??rP.defaultDataThirdPerson.orientWith,this.slopeThresh=cKe*Math.PI/180,i.collider.type==="capsule"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*jO/this.pixelsPerMeter,this.stepThresh=i.collider.height*WO/this.pixelsPerMeter,this.colliderHeight=i.collider.height):i.collider.type==="sphere"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*jO/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*WO/this.pixelsPerMeter,this.colliderHeight=i.collider.radius*2):(this.offset=i.collider.height*jO/this.pixelsPerMeter,this.stepThresh=i.collider.height*WO/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let u=new N().fromArray(i.collider.position),d=new ri().setFromEuler(new Zn().fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(u).multiply(this.scale),this.collider.rotation.copy(d),this.collider.matrix.compose(u,d,NQ),i.cameraXAxis!==void 0&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=i.runMultiplier??2;let f=i.navmesh.destinationHelperRadius*2;if(f>0){let m=new Ut;m.push({fi:0,data:{...ys.defaultData("light","phong"),alpha:0},id:"layer1"}),m.push({fi:0,data:{...ys.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let g=new CG({layers:m},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new vr(Toe.create({parameters:{width:f,height:f/10,hollow:.7}}),g),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(t=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),t){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let e=new Zn().setFromQuaternion(this.quaternion,"YXZ"),i=e.y;this.objectRealQuat.copy(this.quaternion),e.y=0,this.quaternion.setFromEuler(e),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),e.set(0,i,0),this.quaternion.setFromEuler(e),this.rot.setFromEuler(e),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof ga?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){var t;this.deactivate(),(t=this.navMeshPathDest)!=null&&t.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let t=this.data,e=this.sharedAssets;t.gameActions!==void 0&&(this.actions={},iP.list.forEach(i=>{this.actions[i]=Gn({...t,disabled:!1,type:"GameControl"},t.gameActions[i],this.page,e,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),Cs(this.actions.idle),Cs(this.actions.move),Cs(this.actions.run),Cs(this.actions.jump)}dispatchStartEvent(t){this.actions[t]!==void 0&&(this.actionState[t]||(this.actionState[t]=!0,this.actions[t].Transition.forEach(e=>{e.play()}),this.actions[t].Animation.forEach(e=>{e.play(this.initialAction===!1)}),this.actions[t].Create.forEach(e=>{e.dispatchStart()}),this.actions[t].Audio.forEach(e=>{e.dispatchGameControl("start")}),this.actions[t].Particles.forEach(e=>{e.dispatchGameControl("start")})))}dispatchStopEvent(t){this.actions[t]!==void 0&&(!this.actionState[t]||(this.actionState[t]=!1,this.actions[t].Transition.forEach(e=>{e.stop(),e.object.currentState!==null&&e.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[t].Create.forEach(e=>{e.dispatchStop()}),this.actions[t].Audio.forEach(e=>{e.dispatchGameControl("stop")}),this.actions[t].Particles.forEach(e=>{e.dispatchGameControl("stop")})))}get colliderWorldPosition(){return Pa.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(t,e,i){var o,l,c,h,u,d,f,p,m;if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:t)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let n=r*60,s=!1;if(this.usePhysics&&this.collisionEnabled){let g=Ja.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*UQ),1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),v=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,g,(o=this.object.rigidBody)==null?void 0:o.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(v){this.onObject=!0,this.groundNormal.set(v.normal2.x,v.normal2.y,v.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),((l=v.collider.parent())==null?void 0:l.bodyType())===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let y=v.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let x of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(x.rigidBody===y&&x.userData.isFollowingObj!==this.object.uuid){(x.hasNonUniformScale?x.matrixWorldRigid:x.matrixWorld).decompose(Pa,xu,Ja),this.groundVelocity.subVectors(Pa,x.prevT),this.object.getWorldPosition(Ja).add(this.collider.position).sub(Pa),this.groundYRotation=sh.setFromQuaternion(xu).y-x.prevR.y,cf.copy(Ja).applyAxisAngle(dc,this.groundYRotation),this.groundVelocity.add(cf.sub(Ja)).divideScalar(r);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*n),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let g=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let v=Pa.subVectors(this.path[1],this.position),y=Ja.subVectors(this.path[1],this.path[0]);v.dot(y)<0?this.path.shift():(this.directionXZ.x=y.x,this.directionXZ.z=y.z),g.opacity=g.userData.opacity0}else g.opacity-=.05*g.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**n),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**n),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**n)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let a=hKe.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let g=Ja.copy(a);g.y=0,a.set(0,a.y,g.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none"&&this.isFirstPerson===!1)if(this.orientWith==="camera"&&this.path.length<=1){let g=Pa;this.camera.getWorldDirection(g);let v=cf.copy(dc).multiplyScalar(g.dot(dc));g.sub(v);let y=Ja.copy(this.directionXZ);y.x*=-1,this.rot.y=g.angleTo(y)*(g.cross(y).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(sh.setFromVector3(this.rot),this.moveMode==="walk"&&(sh.x=0),a.applyEuler(sh),s&&(xu.setFromUnitVectors(dc,this.groundNormal),a.applyQuaternion(xu)),i){let g=sh.set(0,this.vrEulerYOffset*zQ,0);i.applyEuler(g),a.x+=i.x,a.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*r}if(this.usePhysics===!0){let g=Ja;this.pushedVelocity.set(0,0,0);for(let v of this.sharedGameControlGlobals.entitiesWithTransformAnim){let y=cf.setFromMatrixPosition(v.matrixWorld).sub(v.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),x=v.rigidBody.collider(0).castCollider(y,this.object.rigidBody.collider(0),Pa.copy(a).divideScalar(this.pixelsPerMeter),r,!1);y.multiplyScalar(this.pixelsPerMeter);let S=Ti.is(v)?v:v.object;if(x!==null&&this.lastHitObj!==S){let A;v instanceof qs&&(A=v);let _=this.sharedGameControlGlobals.entityToCollisionEvents[S.uuid];if(_)for(let M of _)M.data.target==="character"&&(M.dispatch(A),S.dispatchEvent(PU));this.lastHitObj=S}if(x!==null){this.pushedVelocity.copy(y),g.copy(x.normal1).applyQuaternion(v.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let v=g.dot(a);v<0&&a.addScaledVector(g,-v),a.add(this.pushedVelocity)}else a.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**n):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**n),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(dc,this.euler.y-this.euler0.y);let g=Ja.copy(this.objectToCamXZ).normalize(),v=cf.copy(a).multiplyScalar(r);v.y=0;let y=v.sub(Pa.copy(g).multiplyScalar(v.dot(g))).cross(g).y;this.euler.y-=Math.atan2(y,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=Et.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=Et.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=Et.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(e?(sh.copy(e),sh.y=0):(sh.copy(this.euler),sh.y=0),this.nonColliderRotOffset.makeRotationFromEuler(sh)),e&&(this.moveMode==="walk"?(this.rot.y=e.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(e),this.rot.y+=this.vrEulerYOffset*zQ),uc.setFromAxisAngle(dKe,this.rot.x),xu.setFromAxisAngle(dc,this.rot.y),xu.multiply(uc),uc.setFromAxisAngle(fKe,this.rot.z),xu.multiply(uc),this.quaternion.copy(xu),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let g=Ja.copy(a).multiplyScalar(r/this.pixelsPerMeter),v=null;this.didHit=!1;let y=new N;for(let x=0;x<5;x++){let S=g.length(),A=cf.copy(g).normalize();if(v=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(y),this.colliderWorldQuat,A,(c=this.object.rigidBody)==null?void 0:c.collider(0).shape,S,!1,24,void 0,void 0,this.object.rigidBody),v!==null){this.didHit=!0;let _=this.sharedGameControlGlobals.colliderToEntity.get(v.collider.handle);if(_!==this.lastHitObj&&x===0){this.lastHitObj=_;let C=this.sharedGameControlGlobals.entityToCollisionEvents[_==null?void 0:_.uuid];if(C){for(let D of C)if(D.data.target==="character"){let B=((h=this.sharedGameControlGlobals.rapierWorld)==null?void 0:h.getCollider(v.collider.handle))._parent,O;if(_.cloner){for(let L of _.cloner.children)if(L.rigidBody===B){O=L;break}}D.dispatch(O),_.dispatchEvent(PU)}}}let M=BQ.set(v.normal2.x,v.normal2.y,v.normal2.z).applyQuaternion(this.colliderWorldQuat),E=FQ.copy(A).multiplyScalar(v.toi).dot(M),T=v.toi;if(T===0&&(this.position.y+=this.offset*this.pixelsPerMeter),E>this.offset&&(T=v.toi*(E-this.offset)/E,y.addScaledVector(A,T)),g.copy(A).multiplyScalar(S-T),Math.acos(-M.y)>this.slopeThresh){let C=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(y),D=cf.copy(v.witness2).applyQuaternion(this.colliderWorldQuat);D.y=0;let B=C.add(D);B.y+=this.stepThresh;let O=this.sharedGameControlGlobals.rapierWorld.castShape(B,this.colliderWorldQuat,g,(u=this.object.rigidBody)==null?void 0:u.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);O!==null&&O.toi===0&&(M.y=0,M.normalize())}g.addScaledVector(M,-g.dot(M))}else{x===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),y.add(g);break}}this.position.addScaledVector(y,this.pixelsPerMeter),(d=this.object.rigidBody)==null||d.setTranslation(Pa.copy(this.position).divideScalar(this.pixelsPerMeter),!0),(f=this.object.rigidBody)==null||f.setRotation(uc.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let g=this.onObject?1:5,v=a.multiplyScalar(r/g);for(let y=0;y<g;y++)this.position.add(v),this.collisionAdjustment(r/g)}else this.position.addScaledVector(a,r);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let g=this.objectToTarget.add(this.position),v=this.targetToCamera.add(g);XO.lookAt(v,g,dc).setPosition(v),XO.decompose(this.targetPos,this.targetQuat,Pa),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**n),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**n),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=Et.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=Et.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(xKe),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*((m=(p=this.navMeshPathDest)==null?void 0:p.material)==null?void 0:m.userData.opacity0))?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(yKe),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let t=uc.setFromAxisAngle(dc,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?Et.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(t);let e;this.cameraXAxis==="Limit"?e=Et.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):e=Et.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=Pa.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(t);let r=xu.setFromAxisAngle(i,e);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(t),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(r)}groundTiltAdjustment(t){dc.angleTo(t)*180/Math.PI<15||dc.angleTo(t)*180/Math.PI>85?uc.identity():uc.setFromUnitVectors(dc,t),this.groundTilt.slerp(uc,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(t){var n;let e=FQ.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=XO.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(Pa,uc,Ja).compose(Pa,uc,NQ);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(s=>{if(s===this.object||s.isDescendantOf(this.object))return;dl.makeEmpty(),s.updateMatrixWorldSVD();let a=s.matrixWorldRigid,o=kQ.copy(a).invert(),l=uKe.copy(kQ).multiply(i);gs.copy(this.collider.segment),gs.start.applyMatrix4(l),gs.end.applyMatrix4(l);let c=BQ.copy(this.position).applyMatrix4(o);dl.expandByPoint(gs.start),dl.expandByPoint(gs.end),dl.min.addScalar(-this.collider.radius),dl.max.addScalar(this.collider.radius),s.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(h){return h.distanceToPoint(gs.end)},intersectsBounds:h=>h.intersectsBox(dl),intersectsTriangle:h=>{let u=Pa,d=Ja,f=h.closestPointToSegment(gs,u,d);if(f<this.collider.radius){let p=this.collider.radius-f,m=d.sub(u).normalize(),g=cf.copy(c);g.addScaledVector(m,p);let v=g.applyMatrix4(a).sub(this.position);e.add(v),gs.start.addScaledVector(m,p),gs.end.addScaledVector(m,p)}}})}),dl.makeEmpty(),gs.copy(this.collider.segment),gs.start.applyMatrix4(i),gs.end.applyMatrix4(i),dl.expandByPoint(gs.start),dl.expandByPoint(gs.end),dl.min.addScalar(-this.collider.radius),dl.max.addScalar(this.collider.radius),(n=this.sharedGameControlGlobals.staticMeshBVH)==null||n.shapecast({traverseBoundsOrder(s){return s.distanceToPoint(gs.end)},intersectsBounds:s=>s.intersectsBox(dl),intersectsTriangle:s=>{let a=Pa,o=Ja,l=s.closestPointToSegment(gs,a,o);if(l<this.collider.radius){let c=this.collider.radius-l,h=o.sub(a).normalize();this.alignToGround&&this.groundTiltAdjustment(h),e.addScaledVector(h,c),gs.start.addScaledVector(h,c),gs.end.addScaledVector(h,c)}}}),this.onObject=Math.abs(e.y)>Math.abs(t*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,e.length()-1e-5);e.normalize().multiplyScalar(r),this.position.add(e)}},Zce=TU;Zce.isLocked=!1;var bKe=Ip(nse());function ehe(t){let e=t.elements,i=e[0]**2+e[1]**2+e[2]**2,r=e[4]**2+e[5]**2+e[6]**2,n=e[8]**2+e[9]**2+e[10]**2,s=e[0]**2+e[4]**2+e[8]**2,a=e[1]**2+e[5]**2+e[9]**2,o=e[2]**2+e[6]**2+e[10]**2,l=1e-8;return i<l||r<l||n<l||s<l||a<l||o<l}function ku(t,e){let i=new Nt;if(e&&ehe(e))return i.setAttribute("position",new bt([],3)),i.setIndex([]),i;if(!t.getAttribute("position"))return i.setAttribute("position",new bt([],3)),i.setIndex([]),i;let{positions:r,triIndices:n}=WD(t.getAttribute("position"),t.getIndex());return i.setAttribute("position",new bt(r,3)),i.setIndex(n),e&&i.applyMatrix4(e),i}var wKe=new st,SKe=new st,ah=[[0,0,0],[0,0,0],[0,0,0]];function the(t){let e=t.elements;ah[0][0]=e[0],ah[0][1]=e[4],ah[0][2]=e[8],ah[1][0]=e[1],ah[1][1]=e[5],ah[1][2]=e[9],ah[2][0]=e[2],ah[2][1]=e[6],ah[2][2]=e[10];let{u:i,v:r}=(0,bKe.SVD)(ah),n=wKe.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=SKe.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1);return n.multiply(s.transpose())}var _Ke=class extends $se{constructor(){super(),this.layers.enable(3),this.layers.enable(8),this.layers.enable(9)}setFromCamera(t,e){e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):e.isPerspectiveCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(e),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(t,e=!0,i=[]){return t.forEach(r=>{r.visible&&this.intersectObject(r,e,i)}),i}createRaycastLineHelper(){let t=new Op({color:65280,linewidth:10}),e=new N(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new N(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,n=new N().addVectors(e,i.multiplyScalar(r)),s=new Nt;return s.setFromPoints([e,n]),new M2(s,t)}},ihe=t=>t instanceof Fy||t instanceof ky;function AKe(t,e){return t.distance-e.distance}function rhe(t,e,i){if(!(!Fu(e)||!e.visible)){wc(e)&&e.raycast(t,i);for(let r of e.children)rhe(t,r,i)}}function EC(t,e,i,r=!1){if(!r&&!i.some(s=>_P(t,s)!==void 0))return[];let n=[];return e.children.forEach(s=>rhe(t,s,n)),n.sort(AKe),n}function CU(t){let e=[];if(t.length){let i=t[0].object;Fu(i)&&e.push(i);let r=i.parent;for(;r;)ihe(r)&&e.push(r),r=r.parent}return e}function Nu(t,e,i,r){let n=t.frame;if(n){let s=e[0]*n.width,a=(1-e[1])*n.height;for(let o of i){let l=o===n.uuid?n:n.find(o);if(l!=null&&l.intersects(s,a))return r(l),!0}}return!1}function _P(t,e){if(wc(e)){if(e.visible){let i=[];return e.raycast(t,i),i.length?i[0]:void 0}}else if(ihe(e))return nhe(t,e)}function nhe(t,e){if(!(!Fu(e)||!e.visible)){if(wc(e)){let i=[];if(e.raycast(t,i),i.length)return i[0]}for(let i of e.children){let r=nhe(t,i);if(r)return r}}}function EKe(t,e,i){return{x:(t-(i.left+window.scrollX))/i.width*2-1,y:-((e-(i.top+window.scrollY))/i.height)*2+1}}function MKe(t,e,i){return{x:(t-(i.left+window.scrollX))/i.width,y:1-(e-(i.top+window.scrollY))/i.height}}var TKe=class{constructor(t,e,i,r,n,s,a,o){this.renderer=t,this.publish=e,this.scene=i,this.getCamera=r,this.sharedAssets=n,this.requestRender=s,this.isExport=a,this.frame=o,this.raycaster=new _Ke,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents=e.mouseEventTarget==="window",this.domElement=t.domElement,this.eventElement=this._useWindowEvents?window:t.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(t){this._useWindowEvents=t,this.eventElement=t?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(t){this._domRect=t}get domRect(){return this._domRect}updateRaycaster(t){var r;let{pageX:e,pageY:i}=((r=t.touches)==null?void 0:r.length)>0?t.touches[0]:t;this.pointerWorld=EKe(e,i,this._domRect),this.pointerScreen=MKe(e,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},Sa=class{constructor(t){this.eventContext=t,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},nV=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],she=t=>{var e;return(e=nV.find(([i,r])=>r===t))==null?void 0:e[0]},U_=t=>{var e;return(e=nV.find(([i])=>i===t))==null?void 0:e[1]},CKe=(t,e)=>{let i=she(t);if(i){let r=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:e}),r}},PKe=class extends Sa{constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=t=>{var r;if(!t.eventName||!t.target||t.eventName==="Scroll")return;let e=(r=this.splineEvents[she(t.eventName)])==null?void 0:r[t.target.uuid];if(!e)return;t.eventName==="Scroll"&&t.deltaY!==void 0&&Object.assign(e,{deltaY:t.deltaY});let{domElement:i}=this.eventContext;i.dispatchEvent(e)}}connect(){let{page:t}=this.eventContext;t.traverseEntity(e=>{var i,r;if((i=e.data)!=null&&i.events.length){for(let[n,s]of nV)if(e.data.events.some(a=>a.data.type===s&&!a.data.disabled)){this.objectsPerEvents.has(n)?(r=this.objectsPerEvents.get(n))==null||r.push(e):this.objectsPerEvents.set(n,[e]);let a={id:e.uuid,name:e.name},o=CKe(s,a),l=this.splineEvents[n];l?l[e.uuid]=o:this.splineEvents[n]={[e.uuid]:o}}}}),this.objectsPerEvents.forEach(e=>{e.forEach(i=>{i.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(t=>{t.forEach(e=>{e.removeEventListener("beginEvent",this.onBeginEvent)})})}},DKe=class{constructor(t,e,i,r,n,s){if(this.id=t,this.data=e,this.object=i,this.entered=!1,(e.type==="KeyDown"||e.type==="KeyUp"||e.type==="KeyPress")&&!e.key)throw new Error("Missing property");this.actions=Gn(e,e.actions,r,n,s,i)}disconnect(){Cs(this.actions)}dispatchHeld(t){this.actions.Create.forEach(e=>{t&&e.dispatchThrottled.cancel(),e.dispatchThrottled()})}dispatch(t=!1){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStart())):(this.actions.Transition.some(e=>e.playing&&e.data.runMode!=="Toggle")||this.actions.Transition.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.SwitchCamera.some(e=>e.playing&&e.data.runMode!=="Toggle")||this.actions.SwitchCamera.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Animation.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()})),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),t===!1&&this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStop()))}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent())),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}},RKe=class extends Sa{constructor(t,e,i){super(t),this.eventManager=e,this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=r=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(r);let{raycaster:n,page:s}=this.eventContext,a=EC(n,s,[],!0);this.sceneInterects=a,a.length&&(this.eventContext.sharedAssets.raycastProperty={x:a[0].point.x,y:a[0].point.y,z:a[0].point.z,objX:a[0].object.matrixWorld.elements[12],objY:a[0].object.matrixWorld.elements[13],objZ:a[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{(n.data.type==="MouseDown"||n.data.type==="MousePress")&&(this.onCanvasRaycast(r),n.dispatch())})},this.onCanvasMouseUp=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{n.data.type==="MouseUp"?(this.onCanvasRaycast(r),n.dispatch()):n.data.type==="MousePress"&&n.dispatchRelease()})},this.onMouseDown=r=>{$t.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseDown"))},this.onMouseUp=r=>{$t.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=r=>{$t.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent())},this.onMousePressRelease=r=>{$t.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent(!0))},this.onKeyDown=r=>{this.heldKeys[r.key]||(this.handleKeyEvent(r,"KeyDown"),this.handleKeyEventHeld(r,"KeyDown",!0)),this.heldKeys[r.key]=!0},this.onKeyUp=r=>{this.handleKeyEvent(r,"KeyUp"),this.handleKeyEventHeld(r,"KeyUp",!0)},this.onKeyPressDown=r=>{this.heldKeysPress[r.key]?this.handleKeyEventHeld(r,"KeyPress"):(this.handleKeyEvent(r,"KeyPress"),this.handleKeyEventHeld(r,"KeyPress",!0)),this.heldKeysPress[r.key]=!0},this.onKeyPressUp=r=>{this.handleKeyEvent(r,"KeyPress",!0)},this.releaseHeldKey=r=>{delete this.heldKeys[r.key]},this.releaseHeldKeyPress=r=>{delete this.heldKeysPress[r.key]},this._onUserEvent=({eventName:r,target:n,reverse:s})=>{var o,l,c,h;if(!r||!n)return;let a=U_(r);a&&(a==="MouseDown"||a==="MouseUp"||a==="MousePress"?(n.dispatchEvent({type:"beginEvent",eventName:a}),(l=(o=this.eventsPerObjects[a])==null?void 0:o[n.uuid])==null||l.forEach(u=>{u.dispatchUserEvent(s)})):(a==="KeyDown"||a==="KeyUp"||a==="KeyPress")&&(n.dispatchEvent({type:"beginEvent",eventName:a}),(h=(c=this.eventsPerObjects[a])==null?void 0:c[n.uuid])==null||h.forEach(u=>{u.dispatchUserEvent()})))}}connect(){var n,s,a,o,l,c;let{page:t,sharedAssets:e,domElement:i}=this.eventContext,r=(h,u)=>{var f,p;if(!((f=h.data)!=null&&f.events.length))return;let d=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let m of d){let g=this.eventsPerObjects[m];if(h.data.events.filter(({data:v})=>v.type===m&&v.disabled!==!0).forEach(({id:v,data:y})=>{try{let x=new DKe(v,y,h,t,e,this.eventManager);x.actions.Video.length&&(this.hasVideoAction=!0),(y.type==="MouseDown"||y.type==="MouseUp"||y.type==="MousePress")&&(y.mode==="Canvas"||y.mode==="Window")?this.canvasMouseEvents.push(x):(g[h.uuid]?g[h.uuid].some(S=>S.id===x.id)||g[h.uuid].push(x):g[h.uuid]=[x],h instanceof qg&&h.traverseChildren(S=>{var A;if(!S.visible)return!0;S instanceof Fn&&((A=S.data.geometry.shapeBlendNode)==null?void 0:A.operation)!==2&&(g[S.uuid]?g[S.uuid].push(x):g[S.uuid]=[x])}))}catch{}}),((p=g[h.uuid])==null?void 0:p.length)&&(this.objectsPerTypes[m].push(h instanceof Rs&&(m==="MouseDown"||m==="MouseUp"||m==="MousePress")?u:h),h instanceof qg)){let v=this.objectsPerTypes[m];h.traverseChildren(y=>{if(!y.visible)return!0;y instanceof Fn&&v.indexOf(y)===-1&&v.push(y)})}}};t.traverseEntity(h=>{var u;(h instanceof da||h instanceof ws)&&((u=h.frame)==null||u.traverse(d=>{r(d,h)})),r(h)}),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),i.addEventListener("pointerdown",this.onCanvasMouseDown),i.addEventListener("pointerup",this.onCanvasMouseUp),((n=this.objectsPerTypes.MouseDown)!=null&&n.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMouseDown)),(s=this.objectsPerTypes.MouseUp)!=null&&s.length&&(this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMouseUp)),(a=this.objectsPerTypes.MousePress)!=null&&a.length&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMousePressRelease)),(o=this.objectsPerTypes.KeyDown)!=null&&o.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),(l=this.objectsPerTypes.KeyUp)!=null&&l.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),(c=this.objectsPerTypes.KeyPress)!=null&&c.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([h,u])=>{u.forEach(d=>{d.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:t}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},t.removeEventListener("pointerdown",this.onCanvasMouseDown),t.removeEventListener("pointerup",this.onCanvasMouseUp),t.removeEventListener("pointerdown",this.onMouseDown),t.removeEventListener("pointerdown",this.onMousePressDown),t.removeEventListener("pointerup",this.onMouseUp),t.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(e=>{Object.values(e).forEach(i=>{i.forEach(r=>{r.disconnect()})})}),this.canvasMouseEvents.forEach(e=>{e.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([e,i])=>{i.forEach(r=>{r.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(t){var o,l,c,h;let{stopRaycast:e,raycaster:i,page:r,pointerScreen:n}=this.eventContext,s=this.objectsPerTypes[t],a=s.filter(u=>!(u instanceof Rs));if(!(!s.length&&!this.useForRaycastProperty)&&!(r.uiCanvas&&Nu(r,[n.x,n.y],Object.keys(this.eventsPerObjects[t]),u=>{this.handleObjectMouseEventDispatch(u,t)}))){if(e||this.useForRaycastProperty){let u;if(this.sceneInterects===null?u=EC(i,r,a,this.useForRaycastProperty):(u=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&u.length&&(this.eventContext.sharedAssets.raycastProperty={x:u[0].point.x,y:u[0].point.y,z:u[0].point.z,objX:u[0].object.matrixWorld.elements[12],objY:u[0].object.matrixWorld.elements[13],objZ:u[0].object.matrixWorld.elements[14]}),e){let d=[((l=(o=u[0])==null?void 0:o.uv)==null?void 0:l.x)??0,((h=(c=u[0])==null?void 0:c.uv)==null?void 0:h.y)??0];CU(u).forEach(f=>{f instanceof da&&Nu(f,d,Object.keys(this.eventsPerObjects[t]),p=>{this.handleObjectMouseEventDispatch(p,t)}),this.eventsPerObjects[t][f.uuid]&&this.handleObjectMouseEventDispatch(f,t)})}}e||a.forEach(u=>{var f,p;let d=_P(i,u);d&&(this.handleObjectMouseEventDispatch(u,t),u instanceof da&&Nu(u,[((f=d==null?void 0:d.uv)==null?void 0:f.x)??0,((p=d==null?void 0:d.uv)==null?void 0:p.y)??0],Object.keys(this.eventsPerObjects[t]),m=>{this.handleObjectMouseEventDispatch(m,t)}))})}}handleMousePressEvent(t=!1){let e="MousePress",i=this.objectsPerTypes[e],r=i.filter(s=>!(s instanceof Rs)),n=[];if(i.length){if(!t){let{stopRaycast:s,raycaster:a,page:o,pointerScreen:l}=this.eventContext,c=!1;if(o.uiCanvas&&(c=Nu(o,[l.x,l.y],Object.keys(this.eventsPerObjects[e]),h=>{n.push(h)})),s&&!c){let h=EC(a,o,r);n=CU(h),h.forEach(u=>{var d,f;u.object instanceof da&&Nu(u.object,[((d=u==null?void 0:u.uv)==null?void 0:d.x)??0,((f=u==null?void 0:u.uv)==null?void 0:f.y)??0],Object.keys(this.eventsPerObjects[e]),p=>{n.push(p)})})}else r.forEach(h=>{var d,f;let u=_P(a,h);u&&(n.push(h),h instanceof da&&Nu(h,[((d=u==null?void 0:u.uv)==null?void 0:d.x)??0,((f=u==null?void 0:u.uv)==null?void 0:f.y)??0],Object.keys(this.eventsPerObjects[e]),p=>{n.push(p)}))})}this._prevObjects.length&&this._prevObjects.forEach(s=>{n.includes(s)||this.handleObjectMouseEventDispatchRelease(s,e)}),n.length&&n.forEach(s=>{this.handleObjectMouseEventDispatch(s,e)}),this._prevObjects=n}}handleObjectMouseEventDispatch(t,e){var i,r;t.dispatchEvent({type:"beginEvent",eventName:e}),(r=(i=this.eventsPerObjects[e])==null?void 0:i[t.uuid])==null||r.forEach(n=>{n.dispatch()})}handleObjectMouseEventDispatchRelease(t,e){var i,r;t.dispatchEvent({type:"beginEvent",eventName:e}),(r=(i=this.eventsPerObjects[e])==null?void 0:i[t.uuid])==null||r.forEach(n=>{n.dispatchRelease()})}handleKeyEvent(t,e,i=!1){this.objectsPerTypes[e].forEach(r=>{let n=this.eventsPerObjects[e][r.uuid];n.some(({data:s})=>"key"in s&&s.key===t.key)&&r.dispatchEvent({type:"beginEvent",eventName:e}),n.forEach(s=>{"key"in s.data&&s.data.key===t.key&&(i?s.dispatchRelease():s.dispatch(!0))})})}handleKeyEventHeld(t,e,i=!1){this.objectsPerTypes[e].forEach(r=>{this.eventsPerObjects[e][r.uuid].forEach(n=>{"key"in n.data&&n.data.key===t.key&&n.dispatchHeld(i)})})}},IKe=new N,LKe=new N,ahe=class{constructor(t,e,i,r,n){this.actionsIn=Gn(t,t.inActions,i,r,n,e),this.actionsOut=Gn(t,t.outActions,i,r,n,e)}disconnect(){Cs(this.actionsIn),Cs(this.actionsOut)}},OKe=class extends ahe{constructor(t,e,i,r,n,s){super(e,i,r,n,s),this.id=t,this.data=e,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let d of this.objects)if(!d.visible)return;let c=IKe.setFromMatrixPosition(this.objects[0].matrixWorld),h=LKe.setFromMatrixPosition(this.objects[1].matrixWorld),u=c.distanceTo(h)<=this.distance?"in":"out";if(this.stage!==u){this.stage=u;let d=u==="in"?this.actionsIn:this.actionsOut;d.Audio.forEach(f=>f.dispatchConditional()),d.Particles.forEach(f=>f.dispatchConditional()),d.Video.forEach(f=>f.dispatchConditional()),d.Link.forEach(f=>f.dispatch()),d.Create.forEach(f=>f.dispatch()),d.Destroy.forEach(f=>f.dispatch()),d.Reset.forEach(f=>f.dispatch()),d.Transition.forEach(f=>{f.object.currentTransitionEvent!==this&&(f.object.currentTransitionEvent=this),f.init()}),d.Transition.forEach(f=>f.play()),d.Animation.forEach(f=>f.play()),d.SwitchCamera.forEach(f=>f.play()),d.SceneTransition.forEach(f=>f.dispatch()),d.SetVariable.forEach(f=>f.checkConditions()),d.SetVariable.forEach(f=>f.dispatch()),d.DynamicVariablePlay.forEach(f=>f.dispatch()),d.ClearLocalStorage.forEach(f=>f.dispatch()),d.UserAPI.forEach(f=>f.dispatch())}};let{distance:a,fromObject:o,toObject:l}=e.condition;this.distance=a;for(let c of[o,l]){if(!c)throw new Error("Missing property");let h=r.find(c);if(!h)throw new Error("Missing property");this.objects.push(h)}}connect(){window.setTimeout(()=>{this.objects.forEach(t=>{t.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(t=>{t.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},BKe=class extends ahe{constructor(t,e,i,r,n,s){var l;super(e,i,r,n,s),this.id=t,this.data=e,this.object=i,this.onBegin=({target:c,state:h})=>{this.toState!==h&&(this.actionsOut.Audio.forEach(u=>u.dispatchConditional()),this.actionsOut.Particles.forEach(u=>u.dispatchConditional()),this.actionsOut.Video.forEach(u=>u.dispatchConditional()),this.actionsOut.Link.forEach(u=>u.dispatch()),this.actionsOut.Create.forEach(u=>u.dispatch()),this.actionsOut.Destroy.forEach(u=>u.dispatch()),this.actionsOut.Reset.forEach(u=>u.dispatch()),this.actionsIn.Transition.forEach(u=>u.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(u=>u.play()),this.actionsOut.Animation.forEach(u=>u.play()),this.actionsIn.SwitchCamera.forEach(u=>u.pause()),this.actionsOut.SwitchCamera.forEach(u=>u.play()),this.actionsOut.SceneTransition.forEach(u=>u.dispatch()),this.actionsOut.SetVariable.forEach(u=>u.checkConditions()),this.actionsOut.SetVariable.forEach(u=>u.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(u=>u.dispatch()),this.actionsOut.ClearLocalStorage.forEach(u=>u.dispatch()),this.actionsOut.UserAPI.forEach(u=>u.dispatch()))},this.onComplete=({target:c,state:h})=>{this.toState===h&&(this.actionsIn.Audio.forEach(u=>u.dispatchConditional()),this.actionsIn.Particles.forEach(u=>u.dispatchConditional()),this.actionsIn.Video.forEach(u=>u.dispatchConditional()),this.actionsIn.Link.forEach(u=>u.dispatch()),this.actionsIn.Create.forEach(u=>u.dispatch()),this.actionsIn.Destroy.forEach(u=>u.dispatch()),this.actionsIn.Reset.forEach(u=>u.dispatch()),this.actionsOut.Transition.forEach(u=>u.pause()),this.actionsOut.Transition.forEach(u=>u.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(u=>u.play()),this.actionsIn.Animation.forEach(u=>u.play()),this.actionsOut.SwitchCamera.forEach(u=>u.pause()),this.actionsIn.SwitchCamera.forEach(u=>u.play()),this.actionsIn.SceneTransition.forEach(u=>u.dispatch()),this.actionsIn.SetVariable.forEach(u=>u.checkConditions()),this.actionsIn.SetVariable.forEach(u=>u.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(u=>u.dispatch()),this.actionsOut.ClearLocalStorage.forEach(u=>u.dispatch()),this.actionsOut.UserAPI.forEach(u=>u.dispatch()))};let{condition:a}=e;if(!a.object)throw new Error("Missing property");let o=r.find(a.object)??r.scene.find2D(a.object);if(!o)throw new Error("Missing property");if(this.toObject=o,a.state&&!((l=this.toObject.states)!=null&&l[a.state]))throw new Error("Missing property");this.toState=a.state}connect(){qm(this.actionsOut).forEach(t=>{var e;(e=this.actionsOut[t])!=null&&e.length&&this.toObject.addEventListener("beginState",this.onBegin)}),qm(this.actionsIn).forEach(t=>{var e;(e=this.actionsIn[t])!=null&&e.length&&this.toObject.addEventListener("completeState",this.onComplete)})}disconnect(){super.disconnect(),qm(this.actionsOut).forEach(t=>{var e;(e=this.actionsIn[t])!=null&&e.length&&this.toObject.removeEventListener("beginState",this.onBegin)}),qm(this.actionsIn).forEach(t=>{var e;(e=this.actionsIn[t])!=null&&e.length&&this.toObject.removeEventListener("completeState",this.onComplete)})}},FKe=class extends Sa{constructor(t,e){super(t),this.eventManager=e,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:t,sharedAssets:e}=this.eventContext;t.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length){for(let{id:n,data:s}of i.data.events)if(!s.disabled&&s.type==="Conditional")try{let a;s.condition.type==="Comparison"||(s.condition.type==="Distance"?a=new OKe(n,s,i,t,e,this.eventManager):s.condition.type==="State"&&(a=new BKe(n,s,i,t,e,this.eventManager))),a&&(this.eventsPerConditions[s.condition.type].push(a),(a.actionsIn.Video.length||a.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}}),Object.values(this.eventsPerConditions).forEach(i=>i.forEach(r=>r.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(t=>t.forEach(e=>e.disconnect()))}},xb=new N,hf=new N,hm=new N,GQ=new ro,kKe=.01,Yi=new N,qn=new N,VQ=new N,tg=new ri,YO=new Zn,NKe=new st,qO=new Bn,_v=new N,oh=new N,Av=.2;function KO(t,e){!e||(e[0]<e[1]&&(t.x=Math.min(Math.max(t.x,e[0]),e[1])),e[2]<e[3]&&(t.y=Math.min(Math.max(t.y,e[2]),e[3])),e[4]<e[5]&&(t.z=Math.min(Math.max(t.z,e[4]),e[5])))}var UKe=function(){let t=new st;return(e,i,r)=>{let n=e.obj;t.copy(n.hiddenMatrix),n.parent!==null&&t.premultiply(n.parent.matrixWorld),t.invert(),n.position.copy(i),e.reference==="global"&&KO(n.position,e.limits),n.position.applyMatrix4(t),e.reference==="parent"?KO(n.position,e.limits):e.reference==="local"&&(tg.copy(e.quat0).invert(),n.position.sub(e.position0),n.position.applyQuaternion(tg),KO(n.position,e.limits),tg.invert(),n.position.applyQuaternion(tg),n.position.add(e.position0)),t.multiply(r??n.matrixWorld).decompose(Yi,n.quaternion,qn),n.updateMatrix(),n.hasNonUniformScale&&(n.updateMatrixWorld(),n.updateMatrixWorldSVD()),n instanceof ja&&Zu(n.parent)&&n.invalidateDownstreamBooleanData(!0)}}(),zKe=class{constructor(t,e,i,r,n,s,a){this.object=t,this.id=e,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=Gn(i,i.dragDropActions.drag,r,n,s,this.object),this.actionsDrop=Gn(i,i.dragDropActions.drop,r,n,s,this.object);let o=[];this.data.objects.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(o.push(c),a[c.uuid]&&a[c.uuid].forEach(h=>{let u=r.find(h);!u||u.data.visible!==!1&&o.push(u)}))}),this.data.dropDestinations.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(this.dropDestIds.push(c.uuid),a[c.uuid]&&a[c.uuid].forEach(h=>{let u=r.find(h);!u||u.data.visible!==!1&&this.dropDestIds.push(u.uuid)}))}),this.dragItems=o.map(l=>(this.data.planeMode==="locked"&&(l.userData.lockedPlane=!0),l.userData.worldPosition0=new N().setFromMatrixPosition(l.matrixWorld),{obj:l,fromPosition:new N().setFromMatrixPosition(l.matrixWorld),pointStart:new N,pointEnd:new N,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new N().copy(l.position),quat0:new ri().copy(l.quaternion),snapped:!1,orientationMatrix:new st,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){Cs(this.actionsDrag),Cs(this.actionsDrop),this.dragItems.forEach(t=>{t.fromPosition.copy(t.obj.userData.worldPosition0),t.pointStart.copy(t.fromPosition),t.pointEnd.copy(t.pointStart),t.obj.recursiveBBoxNeedsUpdate=!0,t.obj.userData.lockedPlane=void 0,t.obj.position.copy(t.position0),t.obj.quaternion.copy(t.quat0),t.obj.updateMatrix()})}},GKe=class extends Sa{constructor(t,e){super(t),this.eventManager=e,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=i=>{var a;if($t.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(this.lastDropDestination=null,s.length===0){this.activeEvent=null;return}for(let o of this.events){let l=0;for(let{obj:c,pointEnd:h,pointStart:u}of o.dragItems){if(c===s[0].object||c===s[0].object.object||Ti.is(c)&&c.isAncestorOf(s[0].object.uuid)){if(o.activeIdx=l,o.activeDragItem.reset=!1,o.activeDragItem.currentDampingFactor=o.data.dampingFactor,o.activeDragItem.snapped=!1,o.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){o.activeDragItem.obj.rigidBody&&o.activeDragItem.obj.rigidBody.setBodyType(2,!0);let d=o.activeDragItem.obj;c.hasNonUniformScale&&c.updateMatrixWorldSVD(),(d.hasNonUniformScale?d.matrixWorldRigid:d.matrixWorld).decompose(Yi,tg,qn),YO.setFromQuaternion(tg),d.prevR===void 0?(d.prevR=YO.clone(),d.prevT=Yi.clone()):(d.prevR.copy(YO),d.prevT.copy(Yi)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(o.activeDragItem.obj)}this.calcPlaneIntersectPos(c,u,o.data.plane,o.data.referenceFrame),h.copy(u),(this.eventManager.controlsManager.usePhysics&&((a=c.data.physics)==null?void 0:a.rigidBody)==="dynamic"||o.data.drop===!1||o.data.resetOnSnapFail===!1)&&o.activeDragItem.fromPosition.setFromMatrixPosition(o.activeDragItem.obj.matrixWorld),this.activeEvent=o,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}l++}}this.activeEvent=null},this.onPointerMove=i=>{var a,o,l,c;if($t.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if($t.length===0){let h=!1;for(let u of this.events){for(let{obj:d}of u.dragItems)if(d===((a=s[0])==null?void 0:a.object)||d===((l=(o=s[0])==null?void 0:o.object)==null?void 0:l.object)||Ti.is(d)&&d.isAncestorOf((c=s[0])==null?void 0:c.object.uuid)){switch(h=!0,u.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(h)break}h||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let h=this.activeEvent.activeDragItem;h.snapped=!1;let u;if(this.activeEvent.data.drop&&(u=s.filter(d=>h.obj!==d.object&&!h.obj.isAncestorOf(d.object.uuid)&&!(d.object instanceof Fy)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(f=>f===d.object.uuid||n.scene.find(f).isAncestorOf(d.object.uuid))))[0]),u){let d=VQ.copy(u.face.normal).applyMatrix3(qO.getNormalMatrix(u.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")h.fromPosition.setFromMatrixPosition(u.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(h.fromPosition.copy(u.point),this.activeEvent.data.snapSurfaceMode==="bbox"){Yi.copy(d).applyMatrix3(qO.setFromMatrix4(h.obj.matrixWorld).transpose());let f=h.obj;Yi.x>Av?qn.x=-f.recursiveBBox.min.x:Yi.x<-Av&&(qn.x=-f.recursiveBBox.max.x),Yi.y>Av?qn.y=-f.recursiveBBox.min.y:Yi.y<-Av&&(qn.y=-f.recursiveBBox.max.y),Yi.z>Av?qn.z=-f.recursiveBBox.min.z:Yi.z<-Av&&(qn.z=-f.recursiveBBox.max.z),qn.applyMatrix3(qO.invert())}else qn.copy(d).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);h.fromPosition.add(qn)}this.activeEvent.data.autoOrient&&(Yi.set(0,1,0).cross(d),Yi.length()<1e-4&&Yi.set(-1,0,0).cross(d),qn.crossVectors(VQ,Yi),h.orientationMatrix.makeBasis(Yi,qn,d)),h.pointStart.copy(h.fromPosition),h.pointEnd.copy(h.pointStart),h.currentDampingFactor=this.activeEvent.snapDampingFactor,h.snapped=!0,this.lastDropDestination!==u.object&&(this.lastDropDestination=u.object,this.activeEvent.actionsDrop.Transition.forEach(f=>{f.play()}),this.activeEvent.actionsDrop.Animation.forEach(f=>{f.play()}),this.activeEvent.actionsDrop.Audio.forEach(f=>{f.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Particles.forEach(f=>{f.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(f=>{f.dispatchThrottled()}))}else h.orientationMatrix.makeRotationFromQuaternion(h.quat0),this.lastDropDestination=null,h.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(h.obj,h.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(d=>{d.stop()}),this.activeEvent.actionsDrop.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.Particles.forEach(d=>{d.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(d=>{d.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.ClearLocalStorage.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.UserAPI.forEach(d=>d.dispatch()),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("start")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.stop()}))},500),this.updateDragItem(h),h.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=i=>{var r;if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let n=((r=this.activeEvent.activeDragItem.obj.data.physics)==null?void 0:r.rigidBody)==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!n)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&n&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(s=>{s.stop(),s.object.currentState!==null&&s.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(s=>{s.stop()}),this.activeEvent.actionsDrag.Audio.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.ClearLocalStorage.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.UserAPI.forEach(s=>s.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let t={};if(this.eventContext.page.traverseEntity(i=>{i.component&&(t[i.component.uuid]?t[i.component.uuid].push(i.uuid):t[i.component.uuid]=[i.uuid])}),this.eventContext.page.traverseEntity(i=>{var r;(r=i.data)==null||r.events.filter(n=>n.data.type==="DragDrop"&&!n.data.disabled).forEach(n=>{this.events.push(new zKe(i,n.id,n.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,t))})}),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let e=this.eventContext.domElement;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let t=this.eventContext.domElement;t.removeEventListener("pointerdown",this.onPointerDown),t.removeEventListener("pointermove",this.onPointerMove),t.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(e=>e.dispose())}setCursor(t){this.eventContext.domElement.style.cursor=t}onAnimationFrameDamping(){for(let t of this.events)for(let e of t.dragItems)e.paused||this.updateDragItem(e,!0)}calcPlaneIntersectPos(t,e,i,r){let{getCamera:n,raycaster:s}=this.eventContext;n().getWorldDirection(hf),hf.negate();let a=tg.identity();switch(r==="parent"?NKe.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix).decompose(Yi,a,qn):r==="local"&&t.matrixWorld.decompose(Yi,a,qn),i){case"x":Yi.set(1,0,0).applyQuaternion(a),_v.copy(hf).cross(Yi),oh.copy(Yi).cross(_v);break;case"y":Yi.set(0,1,0).applyQuaternion(a),_v.copy(hf).cross(Yi),oh.copy(Yi).cross(_v);break;case"z":Yi.set(0,0,1).applyQuaternion(a),_v.copy(hf).cross(Yi),oh.copy(Yi).cross(_v);break;case"xy":oh.set(0,0,1).applyQuaternion(a);break;case"yz":oh.set(1,0,0).applyQuaternion(a);break;case"xz":oh.set(0,1,0).applyQuaternion(a);break;case"adaptive":hf.angleTo(qn.set(0,1,0))>Math.PI/6?(Yi.crossVectors(qn.set(0,1,0),hf),oh.crossVectors(Yi,qn)):oh.set(0,1,0);break;default:oh.copy(hf);break}hm.setFromMatrixPosition(t.matrixWorld);let o=t.userData.lockedPlane?t.userData.worldPosition0:hm;if(GQ.setFromNormalAndCoplanarPoint(oh,o),!!s.ray.intersectPlane(GQ,e)&&(i==="x"||i==="y"||i==="z")){let l=qn.subVectors(e,o).dot(Yi);e.copy(o).addScaledVector(Yi,l)}}updateDragItem(t,e=!1){var i,r;hm.setFromMatrixPosition(t.obj.matrixWorld),t.reset==="current"?xb.subVectors(t.fromPosition,hm).divideScalar(t.currentDampingFactor):t.reset==="original"?(xb.subVectors(t.obj.userData.worldPosition0,hm).divideScalar(t.currentDampingFactor),t.fromPosition.copy(t.obj.userData.worldPosition0),t.pointStart.copy(t.fromPosition),t.pointEnd.copy(t.pointStart)):xb.subVectors(t.pointEnd,t.pointStart).add(t.fromPosition).sub(hm).divideScalar(t.currentDampingFactor),t.paused=t.currentDampingFactor>1?xb.length()<kKe:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||e)&&UKe(t,xb.add(hm),(i=this.activeEvent)!=null&&i.data.drop&&((r=this.activeEvent)!=null&&r.data.autoOrient)?t.orientationMatrix:null),t.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},Ev=new N,QO=new N,bu=new N,wu=new N,HQ=new ro,VKe=.01,HKe={type:"requestRender"},jKe=function(){let t=new N,e=new N;return(i,r,n)=>n>0?(t.subVectors(i,r),t.length()<=n?i:e.copy(r).add(t.normalize().multiplyScalar(n))):r}(),jQ=function(){let t=new st;return(e,i)=>{e.position.copy(i),e.parent!==null&&(t.copy(e.parent.matrixWorld).invert(),e.position.applyMatrix4(t)),t.copy(e.hiddenMatrix).invert(),e.position.applyMatrix4(t),e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),e instanceof ja&&Zu(e.parent)&&e.invalidateDownstreamBooleanData(!0)}}(),WKe=class{constructor(t,e,i,r,n,s){this.data=t,this.id=e,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new N,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...nN.defaultData,...t,...t.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},t.target===void 0||t.target==="cursor"||(this.target=r.find(t.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=Gn(t,t.actions,r,n,s,i)}},XKe=class extends Sa{constructor(t,e){super(t),this.eventManager=e,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=i=>{if(!($t.length>1)){this.eventContext.updateRaycaster(i);for(let r of this.events)r.target===void 0&&this.updateSingleEvent(r)}},this.onMouseEnter=i=>{for(let r of this.events)r.target===void 0&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=i=>{for(let r of this.events)r.target===void 0&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)}}connect(){let{page:t}=this.eventContext;if(t.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="Follow"&&!o.data.disabled);n&&(!t.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new WKe(n.data,n.id,r,t,this.eventContext.sharedAssets,this.eventManager))}),!this.events.length)return;let{domElement:e,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),No&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events)if(r.target!==void 0){let n=r.target,s=this.onTargetChange(r);this.pairOfEventListeners.push([n,s]),n.addEventListener("requestRender",s)}}disconnect(){if(!this.events.length)return;let{domElement:t,eventElement:e}=this.eventContext;this.domEventsNeeded.clear(),No&&t.removeEventListener("pointerdown",this.onMouseMove),e.removeEventListener("pointermove",this.onMouseMove),t.removeEventListener("pointerenter",this.onMouseEnter),t.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let i of this.events)i.paused=!0,i.isReset=!1,Cs(i.actions)}onAnimationFrameDamping(){for(let t of this.events)t.paused||this.updateSingleEvent(t,!0)}updateSingleEvent(t,e=!1){var a;this.events.forEach(o=>{o.actions.Create.forEach(l=>{l.dispatchThrottled()})});let{plane:i,limitDistance:r,limitDistanceEnabled:n}=t.data;if(t.object.getWorldPosition(bu),t.isReset)wu.copy(t.worldPosition0);else if(t.target)t.target.getWorldPosition(wu);else{let{getCamera:o,raycaster:l}=this.eventContext;if(i==="custom"?(o().getWorldDirection(QO),QO.negate(),Ev.copy(QO)):i==="xy"?Ev.set(0,0,1):i==="xz"?Ev.set(0,1,0):i==="yz"&&Ev.set(1,0,0),HQ.setFromNormalAndCoplanarPoint(Ev,bu),!l.ray.intersectPlane(HQ,wu))return}if(!t.isReset){if(wu.distanceTo(t.worldPosition0)>r&&n&&t.target)if(t.snapComplete=!1,t.data.snapDelay&&(t.delayFinished=!1,typeof window<"u"&&t.timeoutId!==null&&(window.clearTimeout(t.timeoutId),t.timeoutId=null)),t.wasOutside=!0,t.data.resetAfterDistanceLimit)wu.copy(t.worldPosition0),t.currentDampingFactor=t.resetDampingFactor;else return;else if(t.wasOutside&&(t.data.snapDelay&&typeof window<"u"&&(t.timeoutId=window.setTimeout(()=>{t.delayFinished=!0,t.paused=!1,this.updateSingleEvent(t)},t.data.snapDelay*1e3)),t.currentDampingFactor=t.data.dampingFactor,t.wasOutside=!1),t.delayFinished===!1)return}t.data.enabledTranslation[0]===!1&&(wu.x=bu.x),t.data.enabledTranslation[1]===!1&&(wu.y=bu.y),t.data.enabledTranslation[2]===!1&&(wu.z=bu.z);let s=jKe(bu,wu,t.wasOutside?0:t.data.maxDelta);if(t.currentDampingFactor>1){let o=Ev.subVectors(s,bu).divideScalar(t.currentDampingFactor);bu.add(o),e&&jQ(t.object,bu),t.paused=o.length()<VKe}else jQ(t.object,s),t.paused=!0;(a=t.object)==null||a.dispatchEvent({type:"beginEvent",eventName:"Follow"}),t.object.dispatchEvent(HKe)}},bb=new N,_T=new N,wb=new st,Mv=new ri,uf=new ri,Sb=new N,_b=new N,um=new N,Su=new N,$O=new ro,YKe=1e-6,qKe={type:"requestRender"},KKe={type:"changeRotation"},WQ=function(){let t=new st;return function(e,i){e.parent!==null?t.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix):t.copy(e.hiddenMatrix),i.premultiply(the(t).invert()),e.rotation.setFromRotationMatrix(i),e.updateMatrix(),e instanceof ja&&Zu(e.parent)&&e.invalidateDownstreamBooleanData(!0)}}(),QKe=class{constructor(t,e,i,r){this.id=e,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new ri,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...sN.defaultData,...t,...t.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},t.target===void 0||t.target==="cursor"||(this.target=r.find(t.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},$Ke=class extends Sa{constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=t=>{if(!($t.length>1)){this._lastMouseEvent=t,this.eventContext.updateRaycaster(t);for(let e of this.events)e.target===void 0&&this.updateSingleEvent(e)}},this.onMouseEnter=t=>{for(let e of this.events)e.target===void 0&&(e.isReset=!1,e.currentDampingFactor=e.data.dampingFactor)},this.onMouseLeave=t=>{for(let e of this.events)e.target===void 0&&(e.data.resetOnPointerLeave&&(e.isReset=!0,e.currentDampingFactor=e.resetDampingFactor),this.updateSingleEvent(e))},this.onScroll=t=>{if(this._lastMouseEvent){let e=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(e)}},this.onTargetChange=t=>()=>{this.updateSingleEvent(t)},this.createUserEventListener=t=>({eventName:e,target:i})=>{if(!e||!i)return;let r=U_(e);r&&r==="LookAt"&&this.updateSingleEvent(t)}}connect(){let{page:t}=this.eventContext;if(t.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="LookAt"&&!o.data.disabled);n&&(!t.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new QKe(n.data,n.id,r,t))}),!this.events.length)return;let{domElement:e,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),No&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events){if(r.target!==void 0){let a=this.onTargetChange(r),o=r.target;this.pairOfEventListeners.push([o,a]),o.addEventListener("requestRender",a)}let n=this.createUserEventListener(r),s=r.object;this.pairOfUserEventListeners.push([s,n]),s.addEventListener("userEvent",n)}}disconnect(){if(!this.events.length)return;let{domElement:t,eventElement:e}=this.eventContext;this.domEventsNeeded.clear(),No&&t.removeEventListener("pointerdown",this.onMouseMove),e.removeEventListener("pointermove",this.onMouseMove),t.removeEventListener("pointerenter",this.onMouseEnter),t.removeEventListener("pointerleave",this.onMouseLeave),e.removeEventListener("scroll",this.onScroll);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let[i,r]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",r);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let t of this.events)t.paused||this.updateSingleEvent(t)}updateSingleEvent(t){var d;let{tilt:e,axis:i,distance:r,plane:n,limitDistance:s,enabledRotation:a,limitDistanceEnabled:o}=t.data,{getCamera:l,raycaster:c}=this.eventContext,{object:h,target:u}=t;if(h.getWorldPosition(Sb),!t.isReset)if(t.target)t.target.getWorldPosition(_b);else{if(n==="custom"?(l().getWorldDirection(_T),_T.negate(),$O.setFromNormalAndCoplanarPoint(_T,Sb)):(n==="xy"?bb.set(0,0,1):n==="xz"?bb.set(0,1,0):n==="yz"&&bb.set(1,0,0),$O.setFromNormalAndCoplanarPoint(bb,Sb)),!c.ray.intersectPlane($O,_b))return;r>0&&(n==="custom"||n===void 0)&&_b.addScaledVector(_T,r)}if(t.isReset||(u?e==="target"?um.copy(u.up).applyMatrix4(wb.extractRotation(u.matrixWorld)).normalize():a.some(f=>f===!1)?(i==="x"?(Su.set(0,0,1),a[2]===!1&&Su.set(0,1,0)):i==="y"?(Su.set(1,0,0),a[0]===!1&&Su.set(0,0,1)):(Su.set(0,1,0),a[1]===!1&&Su.set(1,0,0)),um.copy(Su).applyQuaternion(t.worldQuaternion0).normalize()):um.set(0,1,0):n==="custom"?um.set(0,1,0):um.copy(bb)),t.isReset)uf.copy(t.worldQuaternion0);else if(Sb.distanceTo(_b)>s&&o&&u)if(t.data.snapDelay&&(t.delayFinished=!1,typeof window<"u"&&t.timeoutId!==null&&(window.clearTimeout(t.timeoutId),t.timeoutId=null)),t.wasOutside=!0,t.data.resetAfterDistanceLimit)uf.copy(t.worldQuaternion0),t.currentDampingFactor=t.resetDampingFactor;else return;else{if(t.wasOutside&&(t.data.snapDelay&&typeof window<"u"&&(t.timeoutId=window.setTimeout(()=>{t.delayFinished=!0,t.paused=!1,this.updateSingleEvent(t)},t.data.snapDelay*1e3)),t.currentDampingFactor=t.data.dampingFactor,t.wasOutside=!1),t.delayFinished===!1)return;JKe(wb,_b,Sb,um,i,Su),uf.setFromRotationMatrix(wb),Mv.setFromUnitVectors(Su.applyQuaternion(uf),um),a.some(f=>f===!1)&&e!=="target"&&uf.premultiply(Mv).normalize()}t.currentDampingFactor>1?(h.updateWorldMatrix(!0,!1),Mv.setFromRotationMatrix(the(h.matrixWorld)),Mv.slerp(uf,1/t.currentDampingFactor),WQ(h,wb.makeRotationFromQuaternion(Mv)),t.paused=8*(1-Mv.dot(uf))<YKe):(WQ(h,wb.makeRotationFromQuaternion(uf)),t.paused=!0),(d=t.object)==null||d.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),h.dispatchEvent(qKe),h.dispatchEvent(KKe)}},fl=new N,Yn=new N,mn=new N;function JKe(t,e,i,r,n,s){let a=t.elements;mn.subVectors(e,i),mn.lengthSq()===0&&(mn.z=1),mn.normalize(),Yn.crossVectors(r,mn),Yn.lengthSq()===0&&(Math.abs(r.z)===1?mn.x+=1e-4:mn.z+=1e-4,mn.normalize(),Yn.crossVectors(r,mn)),Yn.normalize(),fl.crossVectors(mn,Yn),n==="x"?s.z===1?[Yn,fl,mn]=[mn,Yn,fl]:(Yn.negate(),[Yn,mn]=[mn,Yn]):n==="y"?s.x===1?[Yn,fl,mn]=[fl,mn,Yn]:(Yn.negate(),[fl,mn]=[mn,fl]):s.x===1&&(Yn.negate(),[Yn,fl]=[fl,Yn]),a[0]=Yn.x,a[4]=fl.x,a[8]=mn.x,a[1]=Yn.y,a[5]=fl.y,a[9]=mn.y,a[2]=Yn.z,a[6]=fl.z,a[10]=mn.z}var ZKe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.entered=!1,this.actions=Gn(e,e.actions,r,n,s,i)}disconnect(){Cs(this.actions)}dispatchEnter(){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.play()),this.actions.Create.forEach(t=>t.dispatchStart()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.entered&&(this.entered=!1,this.actions.Create.forEach(t=>t.dispatchStop()),this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent()))}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent())),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}},eQe=class extends Sa{constructor(t,e){super(t),this.eventManager=e,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=i=>{$t.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onMouseUp=i=>{$t.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=i=>{$t.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a;if(!i||!r)return;let s=U_(i);s&&s==="MouseHover"&&(r.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(a=this.eventsPerObjects[r.uuid])==null||a.forEach(o=>o.dispatchUserEvent(n)))}}connect(){let{page:t,sharedAssets:e}=this.eventContext,i=(n,s)=>{var a,o;if(!(!n.visible||!((a=n.data)!=null&&a.events.length))){for(let{id:l,data:c}of n.data.events)if(!c.disabled&&c.type==="MouseHover")try{let h=new ZKe(l,c,n,t,e,this.eventManager);this.eventsPerObjects[n.uuid]?this.eventsPerObjects[n.uuid].push(h):this.eventsPerObjects[n.uuid]=[h]}catch{}(o=this.eventsPerObjects[n.uuid])!=null&&o.length&&this.objects.push(n instanceof Rs?s:n)}};if(t.traverseEntity(n=>{var s;(n instanceof da||n instanceof ws)&&((s=n.frame)==null||s.traverse(a=>{i(a,n)})),i(n)}),!this.objects.length)return;let{domElement:r}=this.eventContext;this.domEventsNeeded.clear(),No&&(this.domEventsNeeded.add("pointerdown"),r.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),r.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),r.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(n=>{n.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:t}=this.eventContext;this.domEventsNeeded.clear(),No&&(t.removeEventListener("pointerdown",this.onMouseDown),t.removeEventListener("pointerup",this.onMouseUp)),t.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(e=>{e.forEach(i=>{i.disconnect()})}),this.objects.forEach(e=>{e.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(t=!1){let e=[];if(!t){let{stopRaycast:i,raycaster:r,page:n,pointerScreen:s}=this.eventContext,a=!1;if(n.uiCanvas&&(a=Nu(n,[s.x,s.y],Object.keys(this.eventsPerObjects),o=>{e.push(o)})),i&&!a){let o=EC(r,n,this.objects);e=CU(o),o.forEach(l=>{var c,h;l.object instanceof da&&Nu(l.object,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((h=l==null?void 0:l.uv)==null?void 0:h.y)??0],Object.keys(this.eventsPerObjects),u=>{e.push(u)})})}else this.objects.forEach(o=>{var c,h;let l=_P(r,o);l&&(e.push(o),o instanceof da&&Nu(o,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((h=l==null?void 0:l.uv)==null?void 0:h.y)??0],Object.keys(this.eventsPerObjects),u=>{e.push(u)}))})}this._prevObjects.length&&this._prevObjects.forEach(i=>{var r;e.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchLeave()))}),e.length&&e.forEach(i=>{var r;i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchEnter())}),this._prevObjects=e}},tQe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.scrollCounter=0,this.actions=Gn(e,e.actions,r,n,s,i)}connect(){this.scrollCounter=0}disconnect(){Cs(this.actions)}dispatch(t){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let e=t>0?1:-1;this.scrollCounter+=e,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(r=>r.seek(i)),this.actions.Animation.forEach(r=>r.seek(e)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch()),this.actions.ClearLocalStorage.forEach(r=>r.dispatch()),this.actions.UserAPI.forEach(r=>r.dispatch())}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>{e.playFromCurrent()}),this.actions.Animation.forEach(e=>{e.playFromCurrent()})),this.actions.Create.forEach(e=>e.dispatchThrottled()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}},iQe=class{constructor(t,e,i,r,n,s,a){this.id=t,this.data=e,this.object=i,this.domElement=s,this.eventManager=a,this.scrollStart=0,this.scrollEnd=0,this.actions=Gn(e,e.actions,r,n,a,i)}getStickyParentElement(){let t=this.domElement;for(;t;){if(window.getComputedStyle(t).position==="sticky")return t;t=t.parentElement}return null}computeScrollBounds(){let t=this.getStickyParentElement(),e=t==null?void 0:t.parentElement,i=this.domElement.getBoundingClientRect(),r={top:i.top,bottom:i.bottom,left:i.left,right:i.right,width:i.width,height:i.height};if(e){let c=e.getBoundingClientRect(),h=window.getComputedStyle(t),u=parseFloat(h.marginTop)+parseFloat(h.marginBottom),d=parseFloat(h.top),f=parseFloat(h.bottom),p=c.height-u;if(!isNaN(d))i.top===d?(r.top+=c.top-d,r.bottom+=c.top-d):i.top<0&&(r.top-=p-i.height,r.bottom-=p-i.height);else if(!isNaN(f)){let m=document.body.clientHeight??window.innerHeight,g=window.innerWidth-(document.documentElement.clientWidth??window.innerWidth);i.bottom===m-f?(r.top+=c.top-i.height+f+g,r.bottom+=c.top-i.height+f+g):i.bottom<m-f&&(r.top-=p-i.height,r.bottom-=p-i.height)}}let n=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||n.scrollTop,o=s.clientTop||n.clientTop||0,l=Math.round(r.top+a-o);if(this.data.startFrom==="enter"){let c=window.innerHeight,h=r.height,u=this.data.enterAnchor,d=u==="top"?c:u==="bottom"?c-h:c-h*.5;this.scrollStart=l-d}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=r,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){Cs(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:t,y:e}){this.actions.Transition.forEach(n=>{n.object.currentTransitionEvent!==this&&(n.object.currentTransitionEvent=this,n.init())});let i=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(e-this.scrollStart)/i));this.actions.Transition.forEach(n=>n.seek(r)),this.actions.Animation.forEach(n=>n.seek(r)),this.actions.Create.forEach(n=>n.dispatchThrottled()),this.actions.SetVariable.forEach(n=>n.checkConditions()),this.actions.SetVariable.forEach(n=>n.dispatch()),this.actions.DynamicVariablePlay.forEach(n=>n.dispatch()),this.actions.ClearLocalStorage.forEach(n=>n.dispatch()),this.actions.UserAPI.forEach(n=>n.dispatch())}dispatch(t){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(t)}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>{e.playFromCurrent()}),this.actions.Animation.forEach(e=>{e.playFromCurrent()})),this.actions.Create.forEach(e=>e.dispatchThrottled()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}},rQe=class extends Sa{constructor(t,e){super(t),this.managers=e,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([i,r])=>{r.forEach(n=>n.handleResize())})},this.onScroll=i=>{if(!this.isInview)return;let r={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([n,s])=>{n.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:r}),s.forEach(a=>a.dispatch(r))})},this.onWheel=i=>{!this.isInview||i.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:i.deltaY}),n.forEach(s=>s.dispatch(i.deltaY))})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a;if(!i||!r)return;let s=U_(i);s&&s==="Scroll"&&(r.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),(a=this.wheelEventsPerObject.get(r))==null||a.forEach(o=>{o.dispatchUserEvent(n)}))}}connect(){let{page:t,sharedAssets:e,domElement:i,isExport:r}=this.eventContext,n=s=>{var a,o,l;if((a=s.data)!=null&&a.events.length){for(let{id:c,data:h}of s.data.events)if(!h.disabled&&h.type==="Scroll")if(h.trigger==="load"||!r){let u=new tQe(c,h,s,t,e,this.managers);this.wheelEventsPerObject.has(s)?(o=this.wheelEventsPerObject.get(s))==null||o.push(u):this.wheelEventsPerObject.set(s,[u])}else{let u=new iQe(c,h,s,t,e,i,this.managers);this.scrollEventsPerObject.has(s)?(l=this.scrollEventsPerObject.get(s))==null||l.push(u):this.scrollEventsPerObject.set(s,[u])}}};t.traverseEntity(s=>{var a;(s instanceof da||s instanceof ws)&&((a=s.frame)==null||a.traverse(o=>{n(o)})),n(s)}),this.intersectionObserver=new IntersectionObserver(s=>{let a=s[0];a&&(this.isInview=a.isIntersecting)},{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([t,e])=>{e.forEach(i=>i.disconnect()),t.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([t,e])=>{e.forEach(i=>i.disconnect()),t.removeEventListener("userEvent",this.onUserEvent)})}},nQe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.actions=Gn(e,e.actions,r,n,s,i)}disconnect(){Cs(this.actions)}dispatch(){this.actions.Transition.forEach(t=>{t.play()}),this.actions.Animation.forEach(t=>{t.play()}),this.actions.SwitchCamera.forEach(t=>{t.play()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatchFromStart()}),this.actions.Destroy.forEach(t=>{t.dispatchFromStart()})}dispatchAfter(t){this.actions.Audio.forEach(e=>{(e.interaction.data.triggerAfter??"any")===t&&(e.interaction instanceof eg?e.interaction.audioPlayer.play():e.interaction instanceof SU&&e.interaction.dispatch())}),this.actions.Video.forEach(e=>{let i=e.interaction.data.triggerAfter??"autoplay";i===t&&(e.interaction instanceof Ny?e.interaction.play(i==="autoplay"):e.interaction instanceof MU&&e.interaction.dispatch())}),this.actions.Particles.forEach(e=>{(e.data.triggerAfter??"any")===t&&e.dispatchBasic()})}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent())),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch()}),this.actions.Audio.forEach(e=>{e.interaction instanceof eg?e.interaction.audioPlayer.play():e.interaction instanceof SU&&e.interaction.dispatch()}),this.actions.Video.forEach(e=>{e.interaction instanceof Ny?e.interaction.play():e.interaction instanceof MU&&e.interaction.dispatch()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()})}},sQe=class extends Sa{constructor(t,e){super(t),this.eventManager=e,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:r}=this.eventContext,n=r?document:i;n.removeEventListener("pointerdown",this.onAny),n.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,a])=>{s.dispatchEvent({type:"beginEvent",eventName:"Start"}),a.forEach(o=>{o.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.actions.Audio.forEach(s=>{s.interaction instanceof eg&&s.interaction.audioPlayer.play()}),n.actions.Video.forEach(s=>{let a=s.interaction.data.triggerAfter??"autoplay";s.interaction instanceof Ny&&s.interaction.play(a==="autoplay")}),n.actions.Particles.forEach(s=>{s.dispatchBasic()})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a,o;if(!i||!r)return;let s=U_(i);s&&s==="Start"&&(r instanceof Rs||r.dispatchEvent({type:"beginEvent",eventName:"Start"}),(a=this.eventsPerObject.get(r))==null||a.forEach(l=>{l.dispatchUserEvent(n)}),(o=this.eventsAfterPerObject.get(r))==null||o.forEach(l=>{l.dispatchUserEvent(n)}))}}connect(){let{sharedAssets:t,page:e}=this.eventContext,i=r=>{var n,s,a,o,l;if((n=r.data)!=null&&n.events.length)for(let{id:c,data:h}of r.data.events){if(h.disabled||h.type!=="Start")continue;let u=new nQe(c,h,r,e,t,this.eventManager);(u.actions.Transition.length||u.actions.Animation.length||u.actions.SwitchCamera.length||u.actions.Create.length||u.actions.Destroy.length||u.actions.SceneTransition.length||u.actions.Reset.length||u.actions.SetVariable.length||u.actions.DynamicVariablePlay.length||u.actions.ClearLocalStorage.length||u.actions.UserAPI.length)&&(this.eventsPerObject.has(r)?(s=this.eventsPerObject.get(r))==null||s.push(u):this.eventsPerObject.set(r,[u])),u.actions.Audio.length&&(this.eventsAfterPerObject.has(r)?(a=this.eventsAfterPerObject.get(r))==null||a.push(u):this.eventsAfterPerObject.set(r,[u])),u.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(r)?(o=this.eventsAfterPerObject.get(r))==null||o.push(u):this.eventsAfterPerObject.set(r,[u])),u.actions.Particles.length&&(this.eventsAfterPerObject.has(r)?(l=this.eventsAfterPerObject.get(r))==null||l.push(u):this.eventsAfterPerObject.set(r,[u]))}};if(e.traverseEntity(r=>{var n;(r instanceof da||r instanceof ws)&&((n=r.frame)==null||n.traverse(s=>{i(s)})),i(r)}),[...this.eventsAfterPerObject.values()].some(r=>r.length)){if(this.eventManager.activateCount===0){let{domElement:r,isExport:n}=this.eventContext,s=n?document:r;s.addEventListener("pointerdown",this.onMouseDown,{once:!0}),s.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),s.addEventListener("pointerdown",this.onAny),s.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,o])=>{a.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(s=>s.dispatch()),r.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(t=>t.length)){let{domElement:t,isExport:e}=this.eventContext,i=e?document:t;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,n])=>{r.removeEventListener("userEvent",this.onUserEvent),n.forEach(s=>s.disconnect())})}[...this.eventsPerObject.entries()].forEach(([t,e])=>{t.removeEventListener("userEvent",this.onUserEvent),e.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},aQe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.initialDisabled=!1,this.actions=Gn(e,e.actions,r,n,s,i),this.target=e.target}disconnect(){Cs(this.actions)}dispatch(t){this.initialDisabled||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Animation.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(t??!1)}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}},oQe=class extends Sa{constructor(t,e,i,r,n){super(t),this.sharedVariables=e,this.eventManager=i,this.needsMouse=r,this.needsRaycast=n,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=s=>{let a=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let o=new Date,l=[],c=[];for(let d=0;d<this.propertiesToWatch.length;d++){let{objectId:f,property:p,prevValue:m}=this.propertiesToWatch[d],g=this.eventContext.scene.find(f),v=oN.propertyPaths[p];if(v[0]==="width"||v[0]==="height"||v[0]==="depth")g=g.geometry.userData.parameters[v[0]];else for(let y=0;y<v.length;y++)g=g[v[y]];m===null?this.propertiesToWatch[d].prevValue=g instanceof N?g.clone():g:(g instanceof N?!g.equals(m):m!==g)&&(c.push({objId:f,property:p}),g instanceof N?this.propertiesToWatch[d].prevValue.copy(g):this.propertiesToWatch[d].prevValue=g)}for(let d=0;d<this.variablesToWatch.length;d++){let{id:f,prevValue:p}=this.variablesToWatch[d],m=a.getVariable(f);m!==p&&(l.push(f),this.variablesToWatch[d].prevValue=m)}for(let d=0;d<this.dynamicVars.length;d++){let{id:f,expectedTime:p,last:m,data:g,timerSeconds:v,startValue:y}=this.dynamicVars[d],x=1e3;if((g.dynamicVariableType==="timer"||g.dynamicVariableType==="stopwatch")&&g.format==="number3decimal"?x=1:g.dynamicVariableType==="counter"?x=g.updateInterval:g.dynamicVariableType==="random"&&(x=g.isStatic?1/0:g.updateInterval),p===-1){this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+x;continue}if(!((a.getDynamicVariablePlayState(f)==="Stopped"||a.getDynamicVariablePlayState(f)==="Restarted")&&(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+x,g.dynamicVariableType==="counter"&&a.getVariable(f)!==y&&(a.updateVariable(f,y),this.eventManager.requestRender()),(g.dynamicVariableType==="timer"||g.dynamicVariableType==="stopwatch")&&this.dynamicVars[d].timerSeconds!==y&&(this.dynamicVars[d].timerSeconds=y,a.updateVariable(f,El.getFormattedTimerTime(y,g)),this.eventManager.requestRender()),a.getDynamicVariablePlayState(f)==="Restarted"&&a.setDynamicVariablePlayState(f,"Playing"),a.getDynamicVariablePlayState(f)==="Stopped"))){if(a.getDynamicVariablePlayState(f)==="Paused"){this.dynamicVars[d].deltaToExpectedTime===void 0&&(this.dynamicVars[d].deltaToExpectedTime=Math.max(this.dynamicVars[d].expectedTime-s,0)),this.dynamicVars[d].last=s-(x-this.dynamicVars[d].deltaToExpectedTime),this.dynamicVars[d].expectedTime=s+this.dynamicVars[d].deltaToExpectedTime;continue}else this.dynamicVars[d].deltaToExpectedTime=void 0;if(s>=p)if(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime+=x,g.dynamicVariableType==="random"){let S=g.min+Math.random()*(g.max-g.min),A=g.decimals;S=Math.round(S*Math.pow(10,A))/Math.pow(10,A),a.updateVariable(f,S),l.push(f),this.eventManager.requestRender()}else if(g.dynamicVariableType==="counter"){let S=a.getVariable(f),A=a.getDynamicVariableToggleIsForward(f)??!0,_=a.getVariable(f)+g.increment*(A?1:-1);g.hasEnd&&(_=g.increment>0?Et.clamp(_,y,g.endValue):Et.clamp(_,g.endValue,y),_===y&&a.setDynamicVariableToggleIsForward(f,void 0),g.repeat?_===g.endValue&&(_=y):(_===y||_===g.endValue)&&a.setDynamicVariablePlayState(f,"Paused")),_!==S&&(l.push(f),a.updateVariable(f,_),this.eventManager.requestRender())}else if(g.dynamicVariableType==="time"){let S=a.getVariable(f),A=aK(o,g);if(typeof S=="object"&&"textValue"in S&&typeof A=="object"&&"textValue"in A){if(Array.isArray(S.textValue)&&Array.isArray(A.textValue)){if(S.textValue.every((_,M)=>_===A.textValue[M]))continue}else if(S.textValue===A.textValue)continue}else if(S===A)continue;a.updateVariable(f,A),l.push(f),this.eventManager.requestRender()}else{let S=Ys.isTextValue(g.endValue)?XQ(g.endValue.textValue):g.endValue,A=a.getDynamicVariableToggleIsForward(f)??!0,_=v+(s-m)/1e3*(g.dynamicVariableType==="timer"?-1:1)*(A?1:-1);_=Math.max(_,0),g.hasEnd&&(_=g.dynamicVariableType==="stopwatch"?Et.clamp(_,y,S):Et.clamp(_,S,y),_===y&&a.setDynamicVariableToggleIsForward(f,void 0),g.repeat?Math.abs(_-S)<(g.format==="number3decimal"?1e-4:.1)&&(_=y):(Math.abs(_-y)<(g.format==="number3decimal"?1e-4:.1)||Math.abs(_-S)<(g.format==="number3decimal"?1e-4:.1))&&a.setDynamicVariablePlayState(f,"Paused")),_!==v&&(l.push(f),this.dynamicVars[d].timerSeconds=_,a.updateVariable(f,El.getFormattedTimerTime(_,g)),this.eventManager.requestRender())}}}let h=!1;a.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=a.mouseProperty,h=!0);let u=!1;a.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=a.raycastProperty,u=!0),this.events.forEach(d=>{(l.includes(d.data.variableId)||c.find(f=>f.objId===d.data.objectId&&f.property===d.data.property)||d.data.variableId==="mouseProperty"&&h||d.data.variableId==="raycastProperty"&&u)&&(d.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let t=Date.now()-this.pauseTime;for(let e=0;e<this.dynamicVars.length;e++)this.dynamicVars[e].last+=t,this.dynamicVars[e].expectedTime+=t}connect(){this.eventContext.page.traverseEntity(e=>{var i;(i=e.data)==null||i.events.filter(r=>r.data.type==="VariableChange"&&!r.data.disabled).forEach(r=>{this.events.push(new lQe(r.id,r.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.propertiesToWatch=this.events.filter(e=>e.data.variableId==="objectProperty"&&e.data.objectId!==null).map(e=>({objectId:e.data.objectId,property:e.data.property,prevValue:null}));let t=this.eventContext.sharedAssets;this.sharedVariables.forEach(({id:e,data:i})=>{if(!("dynamicVariableType"in i)){this.events.find(n=>n.data.variableId===e)&&this.variablesToWatch.push({id:e,prevValue:t.getVariable(e)});return}let r;if(i.dynamicVariableType==="timer"||i.dynamicVariableType==="stopwatch"){let n;if(Ys.isTextValue(i.value)&&Array.isArray(i.value.textValue)){let s=i.value.textValue;s.length===3?n=s[2]+s[1]*60+s[0]*3600:n=s[1]+s[0]*60}else n=i.value;r=n,this.dynamicVars.push({id:e,last:-1,expectedTime:-1,data:i,timerSeconds:n,startValue:r})}else i.dynamicVariableType==="time"&&t.updateVariable(e,aK(new Date,i)),i.dynamicVariableType==="counter"&&(r=Ys.isTextValue(i.value)?XQ(i.value.textValue):i.value),this.dynamicVars.push({id:e,last:-1,expectedTime:-1,data:i,startValue:r})}),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(t=>t.dispose())}},lQe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.actions=Gn(e,e.actions,r,n,s,i)}dispatch(){let t=this.actions;t.Audio.forEach(e=>e.dispatchConditional()),t.Particles.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch()),t.ClearLocalStorage.forEach(e=>e.dispatch()),t.UserAPI.forEach(e=>e.dispatch())}dispose(){Cs(this.actions)}};function XQ(t){return t.length===3?t[2]+t[1]*60+t[0]*3600:t[1]+t[0]*60}var cQe="https://unpkg.com/@splinetool/runtime@1.9.82/build/",hQe="https://unpkg.com/@splinetool/navmesh-wasm@1.9.82/build/",uQe=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${cQe}' + 'navmesh.js'),
		fetch('${hQe}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,dQe=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,fQe=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,pQe=.001,mQe={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},ohe,Ei,ks;hGe.then(t=>{ohe=t,Ei=new t.Vec3,ks=new t.Vec3});var gQe=new N,vQe=class{constructor(t=!1,e=!1){this.usePhysics=t,this.isExport=e,this.onPointerDown=i=>{if($t.length!==1)return;let{raycaster:r,page:n}=this.eventContext;this.eventContext.updateRaycaster(i);let s=n.raycastWithClones(r);if(s.length!==0){if(this.gameControl){let a=gQe.copy(this.gameControl.colliderWorldPosition);a.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(a,s[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,r)=>n=>{var d,f,p,m,g,v,y;let s;if(n instanceof Ol)if(n.objectForSample){if(n.objectForSample.dataPatched.physics.fusedBody)return;s=n.object}else return n.object.dataPatched.physics.fusedBody===!0&&n.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(n instanceof qs)s=n.object;else if(s=n,((d=s.dataPatched.cloner)==null?void 0:d.disabled)===!1&&((f=s.dataPatched.cloner)==null?void 0:f.hideBase)&&((p=s.dataPatched.physics)==null?void 0:p.fusedBody)!==!0)return!0;if(r&&!s.userData.navmesh)return;let a=s.dataPatched;if(!a.visible&&((m=a.physics)==null?void 0:m.enabled)!==!0)return!0;n.updateMatrixWorldSVD();let o=AP(a),l=s.userData.hasDestroy,c=s.userData.hasDrag,h=!1,u=!1;for(let x of a.events)x.data.disabled!==!0&&(x.data.type==="GameControl"?h=!0:x.data.type==="Follow"&&(u=!0));if(h||o||u||l||c)return!0;if(this.usePhysics&&((g=a.physics)==null?void 0:g.rigidBody)==="dynamic"){if(this.usePhysics&&((v=a.physics)!=null&&v.fusedBody))return!0}else if("geometry"in n&&n.geometry&&i.push(ku(n.geometry,n.matrixWorld)),this.usePhysics&&((y=a.physics)==null?void 0:y.fusedBody))return n.traverseObject((x,S)=>{var M,E;if(S===0)return;let A;if(x instanceof Ol)if(x.objectForSample){if(x.objectForSample.dataPatched.physics.fusedBody)return;A=x.object}else return x.object.dataPatched.physics.fusedBody===!0&&x.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(x instanceof qs)A=x.object;else if(A=x,(M=x.dataPatched.cloner)==null?void 0:M.hideBase)return!0;let _=A.dataPatched;if(!_.visible&&((E=_.physics)==null?void 0:E.enabled)!==!0)return!0;"geometry"in x&&x.geometry&&i.push(ku(x.geometry,x.matrixWorld))}),!0},this.traverseNoPhysics=(i,r)=>n=>{let s;if(n instanceof Ol)return;n instanceof qs?s=n.object:s=n;let a=s.dataPatched;if(a.physics.enabled==="visibility"?!a.visible:!a.physics.enabled)return!0;if(r&&!s.userData.navmesh)return;let o=n.geometry,l=s.userData.hasDestroy===!0,c=s.userData.hasDrag===!0;if(AP(a)||l||c||s.dataPatched.events.some(h=>h.data.disabled!==!0&&h.data.type==="GameControl"))return!0;o&&i.push(ku(o,n.matrixWorld))},this.navmeshWasm=ohe,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(e?uQe:dQe)+fQe])),this._worker=new Worker(this._workerURL)}init(t,e,i){this.gameControl=e,this.eventContext=i,this.setDefaultQueryExtent(new N().setScalar(t.ch*t.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,t,r=>{this.buildFromNavmeshData(r.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(t,e,i){e.objects.forEach(l=>{var h;let c=t.scene.find(l);c.traverseEntity(u=>{u.userData.navmesh=!0}),(h=c.cloner)==null||h.traverseObject(u=>{u.userData.navmesh=!0})});let r=[],n=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(r,e.zones==="custom");if(t.traverseChildren(n),e.objects.forEach(l=>{var h;let c=t.scene.find(l);c.traverseEntity(u=>{u.userData.navmesh=void 0}),(h=c.cloner)==null||h.traverseObject(u=>{u.userData.navmesh=void 0})}),r.length===0)return!1;let s=Zm(r),{positions:a,triIndices:o}=WD(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([a,a.length/3,o,o.length,{...mQe,...e}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let t,e,i=this.navMesh.getDebugNavMesh(),r=i.getTriangleCount(),n=new Uint32Array(r*3),s=new Float32Array(r*3*3);for(t=0;t<r*3;t++)n[t]=t;for(t=0;t<r;t++)for(e=0;e<3;e++){let o=i.getTriangle(t).getPoint(e);s[t*9+e*3+0]=o.x,s[t*9+e*3+1]=o.y,s[t*9+e*3+2]=o.z}let a=new Nt;return a.setIndex(new Yt(n,1)),a.setAttribute("position",new Yt(s,3)),a}getClosestPoint(t){return Ei.x=t.x,Ei.y=t.y,Ei.z=t.z,this.navMesh.getClosestPoint(Ei)}getClosestPointToRef(t,e){Ei.x=t.x,Ei.y=t.y,Ei.z=t.z;let i=this.navMesh.getClosestPoint(Ei);e.set(i.x,i.y,i.z)}getRandomPointAround(t,e){return Ei.x=t.x,Ei.y=t.y,Ei.z=t.z,this.navMesh.getRandomPointAround(Ei,e)}getRandomPointAroundToRef(t,e,i){Ei.x=t.x,Ei.y=t.y,Ei.z=t.z;let r=this.navMesh.getRandomPointAround(Ei,e);i.set(r.x,r.y,r.z)}moveAlong(t,e){return Ei.x=t.x,Ei.y=t.y,Ei.z=t.z,ks.x=e.x,ks.y=e.y,ks.z=e.z,this.navMesh.moveAlong(Ei,ks)}moveAlongToRef(t,e,i){return Ei.x=t.x,Ei.y=t.y,Ei.z=t.z,ks.x=e.x,ks.y=e.y,ks.z=e.z,this.navMesh.moveAlong(Ei,ks)}computePath(t,e){let i=this.getClosestPoint(e);if(ks.x=i.x,ks.y=i.y,ks.z=i.z,Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)+Math.pow(e.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(t);let r=this.navMesh.computePath(Ei,ks),n=r.getPointCount(),s=[];for(let a=0;a<n;a++){let o=r.getPoint(a);s.push(new N(o.x,o.y,o.z))}return s}createCrowd(t,e){return new yQe(this,t,e)}setDefaultQueryExtent(t){Ei.x=t.x,Ei.y=t.y,Ei.z=t.z,this.navMesh.setDefaultQueryExtent(Ei)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(t){let e=t.length*t.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(e),r=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,e);r.set(t);let n=new this.navmeshWasm.NavmeshData;n.dataPointer=r.byteOffset,n.size=t.length,this.navMesh.buildFromNavmeshData(n),this.navmeshWasm._free(r.byteOffset)}getNavmeshData(){let t=this.navMesh.getNavmeshData(),e=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,t.dataPointer,t.size),i=new Uint8Array(t.size);return i.set(e),this.navMesh.freeNavmeshData(t),i}getDefaultQueryExtentToRef(t){let e=this.navMesh.getDefaultQueryExtent();t.set(e.x,e.y,e.z)}dispose(){var t;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),(t=this.eventContext)==null||t.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(t,e,i){return Ei.x=t.x,Ei.y=t.y,Ei.z=t.z,this.navMesh.addCylinderObstacle(Ei,e,i)}addBoxObstacle(t,e,i){return Ei.x=t.x,Ei.y=t.y,Ei.z=t.z,ks.x=e.x,ks.y=e.y,ks.z=e.z,this.navMesh.addBoxObstacle(Ei,ks,i)}removeObstacle(t){this.navMesh.removeObstacle(t)}isSupported(){return this.navmeshWasm!==void 0}},yQe=class{constructor(t,e,i){this.navmeshWasmWrapper=t,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(e,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(t,e){}addAgent(t,e,i){let r=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;r.radius=e.radius,r.height=e.height,r.maxAcceleration=e.maxAcceleration,r.maxSpeed=e.maxSpeed,r.collisionQueryRange=e.collisionQueryRange,r.pathOptimizationRange=e.pathOptimizationRange,r.separationWeight=e.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;let n=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z),r);return this.transforms.push(i),this.agents.push(n),this.reachRadii.push(e.reachRadius?e.reachRadius:e.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new N(0,0,0)),n}getAgentPosition(t){return this.crowd.getAgentPosition(t)}getAgentPositionToRef(t,e){let i=this.crowd.getAgentPosition(t);e.set(i.x,i.y,i.z)}getAgentVelocity(t){return this.crowd.getAgentVelocity(t)}getAgentVelocityToRef(t,e){let i=this.crowd.getAgentVelocity(t);e.set(i.x,i.y,i.z)}getAgentNextTargetPath(t){return this.crowd.getAgentNextTargetPath(t)}getAgentNextTargetPathToRef(t,e){let i=this.crowd.getAgentNextTargetPath(t);e.set(i.x,i.y,i.z)}getAgentState(t){return this.crowd.getAgentState(t)}overOffmeshConnection(t){return this.crowd.overOffmeshConnection(t)}agentGoto(t,e){this.crowd.agentGoto(t,new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z));let i=this.agents.indexOf(t);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(e.x,e.y,e.z))}agentTeleport(t,e){this.crowd.agentTeleport(t,new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z))}updateAgentParameters(t,e){let i=this.crowd.getAgentParameters(t);e.radius!==void 0&&(i.radius=e.radius),e.height!==void 0&&(i.height=e.height),e.maxAcceleration!==void 0&&(i.maxAcceleration=e.maxAcceleration),e.maxSpeed!==void 0&&(i.maxSpeed=e.maxSpeed),e.collisionQueryRange!==void 0&&(i.collisionQueryRange=e.collisionQueryRange),e.pathOptimizationRange!==void 0&&(i.pathOptimizationRange=e.pathOptimizationRange),e.separationWeight!==void 0&&(i.separationWeight=e.separationWeight),this.crowd.setAgentParameters(t,i)}removeAgent(t){this.crowd.removeAgent(t);let e=this.agents.indexOf(t);e>-1&&(this.agents.splice(e,1),this.transforms.splice(e,1),this.reachRadii.splice(e,1),this._agentDestinationArmed.splice(e,1),this._agentDestination.splice(e,1))}getAgents(){return this.agents}update(t){if(this.navmeshWasmWrapper.navMesh.update(),t<=pQe)return;let e=1/60,i=10;{let r=Math.floor(t/e);r>i&&(r=i),r<1&&(r=1);let n=t/r;for(let s=0;s<r;s++)this.crowd.update(n)}for(let r=0;r<this.agents.length;r++){let n=this.agents[r],s=this.getAgentPosition(n);if(this.transforms[r].copy(s),this._agentDestinationArmed[r]){let a=s.x-this._agentDestination[r].x,o=s.z-this._agentDestination[r].z,l=this.reachRadii[r],c=this._agentDestination[r].y-this.reachRadii[r],h=this._agentDestination[r].y+this.reachRadii[r],u=a*a+o*o;s.y>c&&s.y<h&&u<l*l&&(this.onReachTarget(n,this._agentDestination[r]),this._agentDestinationArmed[r]=!1)}}}setDefaultQueryExtent(t){let e=new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z);this.crowd.setDefaultQueryExtent(e)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(t){let e=this.crowd.getDefaultQueryExtent();t.set(e.x,e.y,e.z)}getCorners(t){let e,i=this.crowd.getCorners(t),r=i.getPointCount(),n=[];for(e=0;e<r;e++){let s=i.getPoint(e);n.push(new N(s.x,s.y,s.z))}return n}dispose(){this.crowd.destroy()}};function xQe(t){let e=!1;return t.scene.objects.forEach(i=>{i.data.type==="Page"&&!e&&i.data.publish.gameControlObject&&ES.traverseModuleInstances(t,i.id,(r,n,s)=>{for(let a of s)a.data.type==="GameControl"&&a.data.navmesh.enabled&&(e=!0)})}),e}var bQe={type:"change"},YQ={type:"changeZoom"},wQe={type:"changePan"},dm={type:"start"},fm={type:"end",changed:!0},SQe={type:"end",changed:!1},JO=new ri,qQ=new ye,_Qe=2*Math.PI,AQe=1e-8,EQe=.01,ZO=new N,AT=new ye,eB=new N,ET=new ri,KQ=new st,MQe={type:"requestRender"},lhe=class extends Js{constructor(t,e,i={isPlayMode:!1,isExport:!1}){super(),this.object=t,this.domElement=e,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,ll.DOLLY_ROTATE,ll.PAN],this.offset=new N,this.eye=new N,this.lastPosition=new N,this.lastQuaternion=new ri,this.current=new ye,this.overShoot=new ye,this.overRatio=new ye,this.spherical=new _X,this.sphericalDelta=new _X,this.panOffset=new N,this.panLeftV=new N,this.panUpV=new N,this.panV=new N,this.rotateStart=new ye,this.rotateEnd=new ye,this.rotateDelta=new ye,this.panStart=new ye,this.panEnd=new ye,this.panDelta=new ye,this.dollyStart=new ye,this.dollyEnd=new ye,this.dollyDelta=new ye,this.rotationRangeFactor=new ye,this.panRangeFactor=new ye,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=r=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=r.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(eB,ET,ZO),this.offset.copy(eB).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(JO.copy(ET).invert()),this.panOffset.applyQuaternion(JO),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(ET),this.panOffset.applyQuaternion(ET)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),eB.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(KQ.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(KQ));let r=this.spherical.phi%_Qe;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(Ji.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),r>0&&r>Math.PI||r<0&&r>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let n=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-n,this.sphericalDelta.phi*=1-n}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>EQe||8*(1-this.lastQuaternion.dot(this.object.quaternion))>AQe?(this.dispatchEvent(bQe),this.object.dispatchEvent(MQe),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=r=>{this.enabled!==!1&&(r.pointerType==="touch"||r.pointerType==="pen"&&No?this.onPointerDownTouch(r):this.onPointerDownMouse(r),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(dm),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&No||this.domElement.setPointerCapture(r.pointerId)))},this.onPointerLeave=r=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,ZO.subVectors(this.position0,this.target0),this.spherical.setFromVector3(ZO),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=r},this.onPointerEnter=r=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?AT.set(r.clientX-this.domElement.clientWidth/2,r.clientY-this.domElement.clientHeight/2):AT.set(r.clientX-this.pointerLeaveEvent.clientX,r.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(AT).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(qQ,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(r.clientX,r.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(AT).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(r.clientX,r.clientY)),this.update()},this.onPointerMove=r=>{this.enabled!==!1&&(this.checkRaycastLock()||(r.pointerType==="touch"||r.pointerType==="pen"&&No?this.onPointerMoveTouch(r):this.onPointerMoveMouse(r),r.stopPropagation()))},this.onPointerUp=r=>{this.isPointerDown=!1,$t.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),$t.length>1&&r.preventDefault(),this.hasChange?this.dispatchEvent(fm):this.dispatchEvent(SQe),this.state=-1,r&&(r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&No||this.domElement.releasePointerCapture(r.pointerId))},this.onPointerDownMouse=r=>{let n;switch(this.useKeyEvents?n=this.mouseButtons[r.button]:n=this.mouseButtonsPlay[r.button],n){case 0:if(r.altKey===!0&&!r.shiftKey&&!BM(r)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2;break;case 3:if(BM(r)||r.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}break;case 5:if(BM(r)||r.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=r=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(r);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(r);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(r);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=r=>{switch($t.length>1&&r.preventDefault(),this.touches[$t.length-1]){case ll.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case ll.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case ll.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case ll.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=r=>{switch($t.length>1&&r.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(r),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(r),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(r),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(r),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=bS(()=>this.dispatchEvent(fm),33),this.onMouseWheel=r=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&r.preventDefault(),this.dispatchEvent(dm),this.handleMouseWheel(r),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=r=>{if(r.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!R_)if(r.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(dm),r.scale>this.prevScale?this.dollyIn(this.getZoomScale()):r.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=r.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(fm)},this.onContextMenu=r=>{r.preventDefault()},this.onTouchEnd=r=>{r.preventDefault()},this.onKeyDown=r=>{this.enabled!==!1&&(this.key=r.key,r.key===" "&&this.dispatchEvent(dm))},this.onKeyUp=r=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&r.key==="Alt"&&this.onPointerUp($t[0]),r.key===" "&&this.dispatchEvent(fm))},this.onPointerHover=r=>{r.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(r,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(r,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=r=>{r.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(t){t.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(t)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(t){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=t,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(t,e){this.setEnableDampingSpeed(t.enableDamping),this.enablePan=t.enablePan,this.enableZoom=t.enableZoom,this.enableRotate=t.enableRotate,this.rotationLimitsMode=t.rotationLimitsMode,this.thetaIsFree=t.rotationHorizontalOffset.min===t.rotationHorizontalOffset.max&&t.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=t.rotationVerticalOffset.min===t.rotationVerticalOffset.max&&t.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=t.panLimitsMode,this.panSoftLimit=t.panSoftLimit,this.rotationSoftLimit=t.rotationSoftLimit,this.hoverRotatePanMode=t.hoverRotatePanMode,this.hoverRotateDamping=t.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=e==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=t.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=t.zoomLimitsEnabled,this.minZoom=t.zoomLimits.min,this.maxZoom=Math.max(t.zoomLimits.min,t.zoomLimits.max),this.minDistance=1e3/this.maxZoom,this.maxDistance=Math.max(this.minDistance,1e3/t.zoomLimits.min),this.autoRotate=t.autoRotate,this.autoRotateSpeed=t.autoRotateSpeed,this.autoRotateClockwise=t.autoRotateClockwise;let r=this.object.getTarget().applyQuaternion(JO.copy(this.object.quaternion).invert());this.minV=-t.panVerticalOffset.min+r.y,this.maxV=t.panVerticalOffset.max+r.y,this.minH=-t.panHorizontalOffset.min+r.x,this.maxH=t.panHorizontalOffset.max+r.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=lh(this.spherical.phi-t.rotationVerticalOffset.min),this.maxPhi=lh(this.spherical.phi+t.rotationVerticalOffset.max),this.minTheta=lh(lh(this.spherical.theta)-t.rotationHorizontalOffset.min),this.maxTheta=lh(lh(this.spherical.theta)+t.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,t.orbitTouches===1&&(this.touches[0]=ll.ROTATE),t.panTouches===1&&(this.touches[0]=ll.PAN),t.orbitTouches===2&&(this.touches[1]=ll.DOLLY_ROTATE),t.panTouches===2&&(this.touches[1]=ll.DOLLY_PAN),t.orbitTouches===3&&(this.touches[2]=ll.ROTATE),t.panTouches===3&&(this.touches[2]=ll.PAN),this.isTouchZoom=t.isTouchZoom,this.resetHoverEffectOnPointerLeave=t.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(t,e,i,r,n,s,a,o){this.overShoot.set(0,0);let l,c,h;t instanceof N?(l=t.x,c=t.y,this.current.set(this.target.x,this.target.y),h=!0):(l=t.theta,c=t.phi,this.current.set(lh(this.spherical.theta),lh(this.spherical.phi)),h=!1),i===0&&(this.current.x+=l,this.current.y+=c),(e===3||e===2)&&(!h&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<n&&this.current.x>0&&(this.overShoot.x=n-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<n&&(this.overShoot.x=n-this.current.x)),(e===3||e===1)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y)),h||(this.overShoot.x=lh(this.overShoot.x),this.overShoot.y=lh(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=QQ(Math.abs(this.overRatio.x)),this.overRatio.y=QQ(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):i===2&&(!h&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||h&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=this.overShoot.x*.05),this.phiIsFree||(c=this.overShoot.y*.05),h?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):h?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),t instanceof N?(t.x=l,t.y=c):(this.thetaIsFree||(t.theta=l),this.phiIsFree||(t.phi=c))}setEnableDampingSpeed(t){this.enableDamping=t,this.rotateSpeed=t===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(t){this.sphericalDelta.theta-=t}rotateUp(t){this.sphericalDelta.phi-=t}panLeft(t,e){this.panLeftV.setFromMatrixColumn(e,0),this.panLeftV.multiplyScalar(-t),this.panOffset.add(this.panLeftV)}panUp(t,e){this.panUpV.setFromMatrixColumn(e,1),this.panUpV.multiplyScalar(t),this.panOffset.add(this.panUpV)}pan(t,e){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let r=this.object.position;this.panV.copy(r).sub(this.target);let n=this.panV.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*t*n/i.clientHeight,this.object.matrixWorld),this.panUp(2*e*n/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(t*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(wQe)}dollyOut(t){this.object.isPerspectiveCamera?this.scale/=t:this.object.isOrthographicCamera&&(this.object.zoom*=t,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(YQ)}dollyIn(t){this.object.isPerspectiveCamera?this.scale*=t:this.object.isOrthographicCamera&&(this.object.zoom/=t,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(YQ)}zoomOut(t=this.getZoomScale()){this.dispatchEvent(dm),this.dollyOut(t),this.dispatchEvent(fm)}zoomIn(t=this.getZoomScale()){this.dispatchEvent(dm),this.dollyIn(t),this.dispatchEvent(fm)}setZoom(t){if(this.dispatchEvent(dm),this.object.isPerspectiveCamera){let e=this.initialSphericalRadius/t/this.spherical.radius;this.scale=e}else this.object.isOrthographicCamera&&(this.object.zoom=t,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(fm)}handleMouseDownRotate(t){this.rotateStart.set(t.clientX,t.clientY)}handleMouseDownDolly(t){this.dollyStart.set(t.clientX,t.clientY)}handleMouseDownPan(t){this.panStart.set(t.clientX,t.clientY)}handleMouseMoveRotate(t,e=1){t.movementX!==void 0?this.rotateDelta.set(t.movementX,t.movementY):(this.rotateEnd.set(t.clientX,t.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*e).rotateAround(qQ,-this.object.angleOffsetFromUp);let i=this.domElement,r=this.useWindowEvents?window.innerHeight:i.clientHeight,n=2*Math.PI*this.rotateDelta.x/r,s=2*Math.PI*this.rotateDelta.y/r;this.rotateLeft(n),this.rotateUp(s),this.update()}handleMouseMoveDolly(t){this.dollyEnd.set(t.clientX,t.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(t,e=1){t.movementX!==void 0?this.panDelta.set(t.movementX,t.movementY):(this.panEnd.set(t.clientX,t.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*e),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(t){if(nGe===!1&&BM(t)===!1&&aGe(t)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-t.deltaX,-t.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),t.altKey?this.pan(0,this.panDelta.y):t.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1||this.gesture)return;t.deltaY===0?t.deltaX<0?this.dollyIn(this.getZoomScale()):t.deltaX>0&&this.dollyOut(this.getZoomScale()):t.deltaY<0?this.dollyIn(this.getZoomScale()):t.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if($t.length===2){let t=.5*($t[0].pageX+$t[1].pageX),e=.5*($t[0].pageY+$t[1].pageY);this.rotateStart.set(t,e)}else this.rotateStart.set($t[0].pageX,$t[0].pageY)}handleTouchStartPan(){if($t.length===2){let t=.5*($t[0].pageX+$t[1].pageX),e=.5*($t[0].pageY+$t[1].pageY);this.panStart.set(t,e)}else this.panStart.set($t[0].pageX,$t[0].pageY)}handleTouchStartDolly(){let t=$t[0].pageX-$t[1].pageX,e=$t[0].pageY-$t[1].pageY,i=Math.sqrt(t*t+e*e);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(t){if($t.length===2){let i=H3(t),r=.5*(t.pageX+i.x),n=.5*(t.pageY+i.y);this.rotateEnd.set(r,n)}else{if(t.pointerId!==$t[0].pointerId)return;this.rotateEnd.set(t.pageX,t.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let e=this.domElement;e&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/e.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/e.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(t){if($t.length===2){let e=H3(t),i=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this.panEnd.set(i,r)}else{if(t.pointerId!==$t[0].pointerId)return;this.panEnd.set(t.pageX,t.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(t){let e=H3(t),i=t.pageX-e.x,r=t.pageY-e.y,n=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,n),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(t){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(t),this.enablePan&&this.handleTouchMovePan(t)}handleTouchMoveDollyRotate(t){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(t),this.enableRotate&&this.handleTouchMoveRotate(t)}checkRaycastLock(){var t;if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let e=(t=this.options)==null?void 0:t.showCameraLock;return e&&e(),!0}}else return!1}};function lh(t){let e=Math.PI*2;for(;t<=-Math.PI;)t+=e;for(;t>Math.PI;)t-=e;return t}function QQ(t){return 1-Math.pow(1-t,4)}var $Q=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.page=r,this.currentIntersectedObjects=[],this.actions=Gn(e,e.actions,r,n,s,i),this.target=e.target,this.triggeringObjects=[];for(let a of e.triggeringObjects){let o=r.scene.find(a);o&&this.triggeringObjects.push(o)}}isValidTriggeringObject(t){return this.target==="all"?!0:this.triggeringObjects.some(e=>e===t||e.isAncestorOf(t.uuid)||t.isAncestorOf(e.uuid))}disconnect(){Cs(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.SwitchCamera.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(!1)}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()))}},Ii;dGe.then(t=>Ii=t);var Dn=new N,fc=new ri,df=new N,tB=new Zn(0,0,0,"YXZ"),JQ=new Zn(0,0,0,"XYZ"),pc=new N,iB=new N,rB=new N(1,1,1),Tv=new ri,MT=new st,ZQ=new st,TQe={type:"updateMatrix"},e$=new ri,nB=new wo,PU={type:"beginEvent",eventName:"Collision"},CQe={type:"beginEvent",eventName:"Trigger"};function PQe(t){if(ES.physicsEnabled(t.scene.objects))return!0;let e=!1;return t.scene.objects.traverse((i,r)=>{if(r.events){if(Array.isArray(r.events)){for(let n of r.events)if(n.data.disabled!==!0&&n.data.type==="GameControl"&&n.data.collisionEnabled){e=!0;break}}else for(let n of Object.values(r.events))if(n.disabled!==!0&&n.type==="GameControl"&&n.collisionEnabled){e=!0;break}}}),e}var AP=t=>t.states.some(e=>e.data.position!==void 0||e.data.rotation!==void 0||e.data.hiddenMatrix!==void 0||e.data.cloner!==void 0||e.data.pathSnapping!==void 0),DQe=class{constructor(t){this.eventContext=t,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=e=>{if(e.bodyType()!==Ii.RigidBodyType.Dynamic)return;e.isSleeping()||this.nActiveRigidBodies++;let[i,r,n]=this.rigidBodyToMesh.get(e.handle);if(Dn.copy(e.translation()).multiplyScalar(this.pixelsPerMeter),fc.copy(e.rotation()),i.matrixWorld.compose(Dn,fc,r),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(TQe),n){let s=i.cloner;if(s&&s.objectForSample===void 0){s.matrixWorld.copy(i.matrixWorld);for(let a of s.children)a.updateMatrixWorld(!0)}for(let a of i.children)a.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(e,i,r)=>{var a,o,l,c;if(r===!1)return;let n,s;if(this.sensorToTriggerEvent[e]?(n=this.sensorToTriggerEvent[e],s=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(n=this.sensorToTriggerEvent[i],s=this.sharedGameControlGlobals.colliderToEntity.get(e)),n&&s&&n.isValidTriggeringObject(s)){n.dispatch();return}for(let h=this.sharedGameControlGlobals.createdObjects.length-1;h>=0;h--){let u=this.sharedGameControlGlobals.createdObjects[h];if(u.userData.hasCollisionDestroy&&(((a=u.rigidBody)==null?void 0:a.collider(0).handle)===e||((o=u.rigidBody)==null?void 0:o.collider(0).handle)===i)){this.sharedGameControlGlobals.createdObjects.splice(h,1),u.removeFromParent(),requestAnimationFrame(()=>{var d;return(d=this.sharedGameControlGlobals.rapierWorld)==null?void 0:d.removeRigidBody(u.rigidBody)});break}}if(((l=this.gameControl)==null?void 0:l.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(e)){let h=this.sharedGameControlGlobals.colliderToEntity.get(i),u=this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid];if(u===void 0)return;for(let d of u)d.data.target==="character"&&this.dispatchCollisionEvent(d,h,i)}else if(((c=this.gameControl)==null?void 0:c.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(i)){let h=this.sharedGameControlGlobals.colliderToEntity.get(e),u=this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid];if(u===void 0)return;for(let d of u)d.data.target==="character"&&this.dispatchCollisionEvent(d,h,e)}else{let h=this.sharedGameControlGlobals.colliderToEntity.get(e),u=this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid];if(u!==void 0)for(let p of u)p.data.target==="scene"&&this.dispatchCollisionEvent(p,h,e);let d=this.sharedGameControlGlobals.colliderToEntity.get(i),f=this.sharedGameControlGlobals.entityToCollisionEvents[d==null?void 0:d.uuid];if(f!==void 0)for(let p of f)p.data.target==="scene"&&this.dispatchCollisionEvent(p,d,i)}},this.isExport=t.isExport,this.sharedAssets=t.sharedAssets,this.renderer=t.renderer,this.requestRender=t.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=Jce,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(t){t.forEach(e=>{e.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(t=>{var i,r;let e=t.dataPatched;for(let n of e.events){if(n.data.disabled===!0)continue;let s=(r=(i=n.data.actions)==null?void 0:i.find(a=>a.data.type==="Destroy"))==null?void 0:r.data;if(s)for(let a of s.objects){let o=this.page.scene.find(a);o&&(o.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(t=>{let e=t.dataPatched;for(let i of e.events)if(!(i.data.disabled===!0||i.data.type!=="DragDrop"))for(let r of i.data.objects){let n=this.page.scene.find(r);n&&(n.userData.hasDrag=!0)}})}initBVH(){let t=[];if(this.page.traverseChildren(e=>{var c,h;let i,r=e instanceof yw,n=e instanceof xw;if(e instanceof Ol||r||n)return;e instanceof qs?i=e.object:i=e;let s=i.dataPatched;if(((c=s.physics)==null?void 0:c.enabled)==="visibility"?!s.visible:!((h=s.physics)!=null&&h.enabled))return!0;let a=e.geometry,o=i.userData.hasDestroy===!0,l=i.userData.hasDrag===!0;if(AP(s)||o||l||i.dataPatched.events.some(u=>u.data.disabled!==!0&&(u.data.type==="GameControl"||u.data.type==="Follow")))return e.updateMatrixWorldSVD(),this.addBoundsTree(e),!0;a&&t.push(ku(a,e.matrixWorld))}),t.length>0){let e=Zm(t,!1);this.sharedGameControlGlobals.staticMeshBVH=new gw(e)}}addRigidBody(t,e,i){if(ehe(t.matrixWorld))return;let r=[],n="geometry"in t?t.geometry:void 0,s=e.dataPatched;if((n==null?void 0:n.getAttribute("position"))!==void 0&&r.push(ku(n,t.shearScale)),s.physics.fusedBody){let a=this.gatherChildrenGeom(t,r);t.traverseObject(a),t.children.forEach(l=>l.updateMatrixWorld(!0));let o=t.cloner;o&&o.objectForSample===void 0&&s.physics.rigidBody==="dynamic"&&(o.traverseObject(a),o.children.forEach(l=>l.updateMatrixWorld(!0)))}if(r.length>0){let a,o=!i.fromCreate&&s.physics.rigidBody==="dynamic"||i.fromCreate&&i.dynamic;o?(a=Ii.RigidBodyDesc.dynamic(),a.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(a=Ii.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(t)):a=Ii.RigidBodyDesc.fixed();let l=Zm(r);(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(Dn,fc,df),t.position0=Dn.clone().divideScalar(this.pixelsPerMeter),t.rotation0=fc.clone(),Dn.divideScalar(this.pixelsPerMeter),a.setTranslation(Dn.x,Dn.y,Dn.z).setRotation(fc),n?l==null||l.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l==null||l.scale(df.x/this.pixelsPerMeter,df.y/this.pixelsPerMeter,df.z/this.pixelsPerMeter);let c=this.sharedGameControlGlobals.rapierWorld.createRigidBody(a);o&&this.rigidBodyToMesh.set(c.handle,[t,df.clone(),s.physics.fusedBody]);let h=!(s.geometry===void 0||s.geometry.type==="SubdivGeometry"||s.geometry.type==="NonParametricGeometry"||s.geometry.type==="BooleanGeometry"||s.geometry.type==="VectorGeometry"||s.geometry.type==="StarGeometry"||s.geometry.type==="RectangleGeometry"||s.geometry.type==="EllipseGeometry"||s.geometry.type==="TriangleGeometry"||s.geometry.type==="TorusGeometry"||s.geometry.type==="HelixGeometry");try{this.addCollider(c,s.physics,l,e,h)}catch{try{this.addCollider(c,s.physics,l,e,!1)}catch(u){console.error(u)}}t.rigidBody=c}}addBoundsTree(t){var i,r;let e=[];if(((i=t.geometry)==null?void 0:i.getAttribute("position"))!==void 0&&((r=t.geometry)==null?void 0:r.getAttribute("position").count)>0&&e.push(ku(t.geometry,t.shearScale)),t.traverseObject(this.gatherChildrenGeom(t,e)),t.children.forEach(n=>n.updateMatrixWorld(!0)),e.length>0){let n=Zm(e,!1);t.bvhGeometry=n,n.getAttribute("position").count>0&&(t.bvhGeometry.boundsTree=new gw(n),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(t))}}addCollider(t,e,i,r,n=!0){var o,l;if((i==null?void 0:i.getAttribute("position").count)===0||((o=i==null?void 0:i.getIndex())==null?void 0:o.count)===0)return;let s;i&&(e.colliderType==="trimesh"?s=Ii.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):s=Ii.ColliderDesc.convexMesh(i.getAttribute("position").array,n?i.getIndex().array:void 0)),s.setFrictionCombineRule(Ii.CoefficientCombineRule.Average).setRestitutionCombineRule(Ii.CoefficientCombineRule.Average).setDensity(e.density).setFriction(e.friction).setRestitution(e.restitution);let a=this.sharedGameControlGlobals.rapierWorld.createCollider(s,t);this.sharedGameControlGlobals.colliderToEntity.set(a.handle,r),(l=this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid])!=null&&l.some(c=>c.target==="scene")&&a.setActiveEvents(Ii.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(t,e){return(i,r)=>{var o;if(r===0)return;let n;if(i instanceof Ol)if(i.objectForSample){if(i.objectForSample.dataPatched.physics.fusedBody)return;n=i.object}else return i.object.dataPatched.physics.fusedBody===!0&&i.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(i instanceof qs)n=i.object;else if(n=i,(o=n.dataPatched.cloner)==null?void 0:o.hideBase)return!0;let s=n.dataPatched;if(s.physics.enabled==="visibility"?!s.visible:!s.physics.enabled)return!0;r===1?t.hasNonUniformScale?i.matrixWorld.multiplyMatrices(t.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let a=i.geometry;(a==null?void 0:a.getAttribute("position"))!==void 0&&e.push(ku(a,i.matrixWorld))}}activate(t){var d,f;if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=t,this.usePhysics=this.page.data.globalPhysics.usePhysics;let e=this.page.playCamera,i=!1,r=5,n=8,s=9,a="drag",o=this.page.data.publish.gameControlObject,l=o!==null?this.page.find(o):null,c=null;if(l)for(let p of l.data.events){if(p.data.disabled||p.data.type!=="GameControl")continue;let m=l;for(;this.usePhysics&&((d=m=m.parent)==null?void 0:d.parent)!==null;)(f=m.data.physics)==null||f.fusedBody;p.data.collisionEnabled&&(this.needsCollisionDetection=!0),c===null&&(c=p.data)}if(this.page.traverseEntity(p=>{for(let m of p.dataPatched.events)if(m.data.disabled===!1&&m.data.type==="Trigger")return this.needsCollisionDetection=!0,!0}),l&&c&&(l.data.visible===!0||l.data.physics.enabled===!0)){i=i||c.camera===e.uuid||l.uuid===e.uuid;let p=new Zce(l,this.renderer.domElement,c,this.eventContext.page.data.globalPhysics,this,l.uuid!==e.uuid&&c.camera===e.uuid,e,this.page,this.sharedAssets);this.gameControl=p,r=c.joystickPosLoc,n=c.joystickRotLoc,s=c.jumpTouchButtonLoc,a=c.rotByTouch,No&&c.touchControl&&(this.joystickToGameControls[r]="pos",c.moveMode==="walk"&&(this.joystickToGameControls[s]="jmp"),a==="joystick"&&(this.joystickToGameControls[n]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let p=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new vQe(this.usePhysics,this.isExport);let m;p.collider.type==="sphere"?m=p.collider.radius*2:m=p.collider.height,m=Math.floor(m/p.navmesh.ch-1),this.navigationMeshWrapper.init({...p.navmesh,walkableHeight:m},this.gameControl,this.eventContext)}}if(i===!1){let{enableRotate:p,enablePan:m,enableZoom:g,autoRotate:v,hoverRotatePanMode:y}=this.eventManager.publish.orbitControls;(p||m||g||v||y!==0)&&(this.orbitControls=new lhe(e,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let h=this.renderer.domElement.width/this.renderer.getPixelRatio(),u=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((p,m)=>{let g=document.body.appendChild(document.createElement("div")),[v,y,x]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[m],S=(h-5*v)/4+v,A={},_=p==="jmp",M=_?0:v;m<10?(m<5?A.top=M/2:A.bottom=M/2,A.left=M/2+m%5*S):m===10?(A.left=M/2,A.top=u/2):(A.right=M/2,A.top=u/2),A.top?A.top-=y[1]:A.bottom+=y[1],A.left?A.left+=y[0]:A.right-=y[0];for(let C in A)A[C]+="px";if(_){let C=g.appendChild(document.createElement("div"));Object.assign(C.style,A,{position:"absolute",width:v+"px",height:v+"px",backgroundColor:`rgba(255,255,255,${x==="show"?.4:0})`,zIndex:"9999",borderRadius:v+"px",border:x==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let D=v/16*16*.4;x==="show"&&(C.innerHTML=`
						<svg width="${D}" height="${v*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),C.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),C.addEventListener("touchend",B=>B.preventDefault()),this.joysticks[m]=[void 0,g];return}let E={zone:g,mode:"static",position:A,size:v};x==="hide"&&(E.restOpacity=0);let T=zYe.create(E);T.on("move",(C,D)=>{let B=this.gameControl;p==="pos"?D.force<.2?B.moveForce=0:(B.movementState.movePosZ=Math.sin(-D.angle.radian),B.movementState.movePosX=Math.cos(-D.angle.radian),D.force>1.2?B.movementState.run=1:B.movementState.run=0,D.force<.3?B.moveForce=(D.force-.2)/.1:B.moveForce=1):p==="rot"&&(D.force<.2?B.rotForce=0:(B.movementState.rotPosX=D.vector.y,B.movementState.rotPosY=-D.vector.x,D.force<.3?B.rotForce=(D.force-.2)/.1:B.rotForce=1)),this.requestRender()}),T.on("end",(C,D)=>{let B=this.gameControl;p==="pos"?(B.movementState.movePosZ=0,B.movementState.movePosX=0,B.moveForce=1):p==="rot"&&(B.movementState.rotPosX=0,B.movementState.rotPosY=0,B.rotForce=1)}),this.joysticks[m]=[T,g]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(p=>p.initialDisabled=!1)},80)}initPhysics(){var a;(a=this.sharedGameControlGlobals.rapierWorld)==null||a.free(),this.sharedGameControlGlobals.rapierWorld=new Ii.World(new Ii.Vector3(0,this.gravity,0)),this.events=new Ii.EventQueue(!0);let t=[],e=[];if(this.page.traverseChildren(o=>{var v,y,x,S;let l;if(o instanceof Ol)if(o.objectForSample){if(o.objectForSample.dataPatched.physics.fusedBody)return;l=o.object}else return o.object.dataPatched.physics.fusedBody===!0&&o.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(o instanceof qs)l=o.object;else{if(o instanceof xw||o instanceof yw)return;if(l=o,((v=l.dataPatched.cloner)==null?void 0:v.disabled)===!1&&((y=l.dataPatched.cloner)==null?void 0:y.hideBase)&&((x=l.dataPatched.physics)==null?void 0:x.fusedBody)!==!0)return!0}let c=l.dataPatched,h;for(let A of c.events)A.data.disabled!==!0&&A.data.type==="GameControl"&&(h=A.data);if(!c.physics||(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled))return!0;o.updateMatrixWorldSVD();let u=AP(c),d=!1,f=l.userData.hasDestroy,p=l.userData.hasDrag,m=!1;for(let A of c.events)if(A.data.disabled!==!0){if(A.data.type==="Collision"){d=!0;let _=new aQe(A.id,A.data,l,this.page,this.sharedAssets,this.eventManager);_.initialDisabled=!0,this.collisionEvents.push(_),this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].every(M=>M.id!==A.id)?this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].push(_):this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]=[_]}else if(A.data.type==="Follow"){m=!0;let _=A.data.target;o.traverseVisible(M=>{M.userData.isFollowingObj=_})}}c.physics.rigidBody==="dynamic"&&c.physics.fusedBody===!1&&(o.matrixWorldFusedFalse=o.matrixWorld.clone());let g=o.geometry;if(h!==void 0){let A=Ii.RigidBodyDesc.kinematicPositionBased();(o.hasNonUniformScale?o.matrixWorldRigid:o.matrixWorld).decompose(Dn,fc,df),o.position0=Dn.clone().divideScalar(this.pixelsPerMeter),o.rotation0=fc.clone(),Dn.divideScalar(this.pixelsPerMeter),A.setTranslation(Dn.x,Dn.y,Dn.z).setRotation(fc);let _=this.sharedGameControlGlobals.rapierWorld.createRigidBody(A);o.rigidBody=_;let M;h.collider.type==="sphere"?M=Ii.ColliderDesc.ball(h.collider.radius/this.pixelsPerMeter):h.collider.type==="capsule"?M=Ii.ColliderDesc.capsule((h.collider.height/2-h.collider.radius)/this.pixelsPerMeter,h.collider.radius/this.pixelsPerMeter):M=Ii.ColliderDesc.cuboid(h.collider.width/this.pixelsPerMeter/2,h.collider.height/this.pixelsPerMeter/2,h.collider.depth/this.pixelsPerMeter/2),M.setFrictionCombineRule(Ii.CoefficientCombineRule.Average).setRestitutionCombineRule(Ii.CoefficientCombineRule.Average).setDensity(c.physics.density).setFriction(c.physics.friction).setRestitution(c.physics.restitution);let E=this.sharedGameControlGlobals.rapierWorld.createCollider(M,_);this.sharedGameControlGlobals.colliderToEntity.set(E.handle,l),Dn.fromArray(h.collider.position).multiply(df.setFromMatrixScale(l.matrixWorld)).divideScalar(this.pixelsPerMeter),E.setTranslationWrtParent(Dn);let T=new ri().setFromEuler(new Zn().setFromVector3(new N().fromArray(h.collider.rotation)));E.setRotationWrtParent(T),E.setActiveEvents(Ii.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(l,!0)}else c.physics.rigidBody==="dynamic"||u||m||f||p||d?(this.addRigidBody(o,l,{hasFollow:m,hasTransformAnim:u,hasDrag:p}),this.generateSensorColliderDescs(l,c.physics.fusedBody)):(g&&t.push(ku(g,o.matrixWorld)),c.physics.fusedBody&&o.traverseObject((A,_)=>{var C;if(_===0)return;let M;if(A instanceof Ol)if(A.objectForSample){if(A.objectForSample.dataPatched.physics.fusedBody)return;M=A.object}else return A.object.dataPatched.physics.fusedBody===!0&&A.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else{if(A instanceof xw||A instanceof yw)return;if(A instanceof qs)M=A.object;else if(M=A,(C=M.dataPatched.cloner)==null?void 0:C.hideBase)return!0}let E=M.dataPatched;if(E.physics.enabled==="visibility"?!E.visible:!E.physics.enabled)return!0;let T=A.geometry;(T==null?void 0:T.getAttribute("position"))!==void 0&&t.push(ku(T,A.matrixWorld))}),this.generateSensorColliderDescs(l,c.physics.fusedBody,e));if(((S=c.physics)==null?void 0:S.fusedBody)===!0||h)return!0}),t.length===0)return;let i=Zm(t);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let r=Ii.RigidBodyDesc.fixed(),n=this.sharedGameControlGlobals.rapierWorld.createRigidBody(r),s=Ii.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(Ii.CoefficientCombineRule.Multiply).setRestitutionCombineRule(Ii.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,n);for(let[o,l]of e){let c=this.sharedGameControlGlobals.rapierWorld.createCollider(o,n);this.sensorToTriggerEvent[c.handle]=l}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(t=>{for(let e of t.dataPatched.events)if(e.data.type==="Trigger"&&e.data.disabled!==!0){let i=new $Q(e.id,e.data,t,this.page,this.sharedAssets,this.eventManager),r=new st().compose(pc.fromArray(e.data.position),Tv.setFromEuler(JQ.fromArray(e.data.rotation)),rB);if(e.data.triggerZone==="box"){let n=new _n;n.min.fromArray(e.data.size).multiplyScalar(-.5),n.max.fromArray(e.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([n,r,t,i])}else this.sharedGameControlGlobals.triggers.push([e.data.radius,r,t,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(t=>t.disconnect()),this.sharedGameControlGlobals.triggers.forEach(t=>t[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){var t,e,i,r;if(this.isEnabled){this.isEnabled=!1,this.page.traverse(n=>{let s=n;s.matrixWorldFusedFalse&&(s.matrixWorldFusedFalse=void 0),s.rigidBody&&(s.rigidBody=void 0),s.position0&&(s.position0=void 0),s.rotation0&&(s.rotation0=void 0)}),(t=this.sharedGameControlGlobals.rapierWorld)==null||t.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),(e=this.gameControl)==null||e.reset(),(i=this.gameControl)==null||i.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([n,s])=>{n==null||n.destroy(),s.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),(r=this.navigationMeshWrapper)==null||r.dispose(),this.navigationMeshWrapper=void 0;for(let n of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))n.forEach(s=>s.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(t,e,i){if(!this.isEnabled)return!0;let r=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(r=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,r=!1):this.initializationCounter===2&&this.gameControl&&(r=!this.gameControl.update(t,e,i)&&r),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let n=.016666666666666666;if(t===0)r=this.stepPhysics()&&r;else{let s=t/1e3;s<n&&s>n*.55&&(s=n),this.accumulator+=s;let a=performance.now(),o=0,l=6;for(;this.accumulator>=n&&o<l&&(r=this.stepPhysics()&&r,this.accumulator-=n,o++,!(performance.now()-a>n*1e3)););this.accumulator=this.accumulator%n}}return r}stepPhysics(){var t;for(let e of this.sharedGameControlGlobals.entitiesWithTransformAnim){(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(Dn,fc,df),tB.setFromQuaternion(fc);let i=e;i.prevR===void 0?(i.prevR=tB.clone(),i.prevT=Dn.clone()):(i.prevR.copy(tB),i.prevT.copy(Dn)),e.rigidBody&&(e.rigidBody.setNextKinematicTranslation(Dn.divideScalar(this.pixelsPerMeter)),e.rigidBody.setNextKinematicRotation(fc))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),(t=this.events)==null||t.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(t,e,i){var s;let r=((s=this.sharedGameControlGlobals.rapierWorld)==null?void 0:s.getCollider(i))._parent,n;if(e.cloner){for(let a of e.cloner.children)if(a.rigidBody===r){n=a;break}}t.dispatch(n),e.dispatchEvent(PU)}updateUseWindowEvents(t){var e;(e=this.orbitControls)==null||e.updateUseWindowEvents(t)}generateSensorColliderDescs(t,e,i){let r=ZQ.copy(t.matrixWorld).invert();t.traverseEntity((n,s)=>{if(e===!1&&s===1)return!0;for(let a of n.dataPatched.events)if(a.data.type==="Trigger"&&a.data.disabled!==!0){let o=new $Q(a.id,a.data,n,this.page,this.sharedAssets,this.eventManager),l;if(a.data.triggerZone==="box"?l=Ii.ColliderDesc.cuboid(...a.data.size.map(c=>c/(2*this.pixelsPerMeter))):l=Ii.ColliderDesc.ball(a.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents(Ii.ActiveEvents.COLLISION_EVENTS),pc.fromArray(a.data.position),Tv.setFromEuler(JQ.fromArray(a.data.rotation)),MT.compose(pc,Tv,rB).premultiply(n.matrixWorld),i?(MT.decompose(pc,Tv,iB),l.setActiveCollisionTypes(Ii.ActiveCollisionTypes.KINEMATIC_FIXED|Ii.ActiveCollisionTypes.DYNAMIC_FIXED)):(MT.premultiply(r).decompose(pc,Tv,iB),t.rigidBody.bodyType()===Ii.RigidBodyType.Dynamic||(t.rigidBody.bodyType()===Ii.RigidBodyType.Fixed?l.setActiveCollisionTypes(Ii.ActiveCollisionTypes.KINEMATIC_FIXED|Ii.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes(Ii.ActiveCollisionTypes.KINEMATIC_KINEMATIC|Ii.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),pc.divideScalar(this.pixelsPerMeter),l.setTranslation(pc.x,pc.y,pc.z),l.setRotation(Tv),i)i.push([l,o]);else{let c=this.sharedGameControlGlobals.rapierWorld.createCollider(l,t.rigidBody);this.sensorToTriggerEvent[c.handle]=o}}})}checkTrigger(){let t;for(let e=0;e<this.sharedGameControlGlobals.triggers.length;e++){let[i,r,n,s]=this.sharedGameControlGlobals.triggers[e];for(let a=0;a<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;a++){let o=this.sharedGameControlGlobals.entitiesWithTransformAnim[a];if(n===o||s.isValidTriggeringObject(Ti.is(o)?o:o.object)===!1)continue;let l=ZQ.copy(n.matrixWorld).decompose(pc,e$,iB).compose(pc,e$,rB).multiply(r),c=MT.copy(o.matrixWorld).invert().multiply(l);i instanceof _n?t=o.bvhGeometry.boundsTree.intersectsBox(i,c):(nB.radius=i,nB.center.setFromMatrixPosition(c),t=o.bvhGeometry.boundsTree.intersectsSphere(nB)),t?s.currentIntersectedObjects.indexOf(o)===-1&&(s.currentIntersectedObjects.push(o),s.dispatch(),n.dispatchEvent(CQe)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter(h=>h!==o)}}}};function RQe(t){let e=this._clip.duration,i=this._clip.start??0,r=this.loop,n=this.time+t,s=this._loopCount,a=r===_5;if(t===0)return s===-1?n:a&&(s&1)===1?e-(n-i):n;if(r===dse){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=e)n=e;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(s===-1&&(t>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=e||n<i){let o=Math.floor((n-i)/(e-i));n-=(e-i)*o,s+=Math.abs(o);let l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a||(n=t>0?e:i,this.repetitions===1&&(n=e)),this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(l===1){let c=t<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return e-(n-i)}return n}var t$=!1,IQe=class{constructor(t,e,i,r){this.scene=t,this.requestRender=e,this.updateDisplayProgress=i,this.animationInspectorState=r,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=n=>{n.data.type==="Empty"&&n.data.animations&&n.data.animations.forEach((s,a)=>{let o=s[0]+"/";if(Array.isArray(n.identity)?o+=n.identity[0]:o+=n.uuid,this.clipIdToAction[o])return;let l=zk.parse(JSON.parse(s[2]));n.animations[a]=l;let c=this.mixer.clipAction(l,n);t$===!1&&(Object.getPrototypeOf(c)._updateTime=RQe,t$=!0),c.clampWhenFinished=!0,this.clipIdToAction[o]=c})},this.mixer=new _Oe(t),this.scene.traverseEntity(this.addClip)}deleteClip(t,e){let i=this.scene.find(e);if(!i)return;let r=i.animations.find(s=>s.uuid===t);if(!r)return;let n=this.clipIdToAction[t];!n||(n.stop(),this.mixer.uncacheClip(r),delete this.clipIdToAction[t],i.animations=i.animations.filter(s=>s.uuid!==t))}get isPlaying(){return Object.values(this.clipIdToAction).some(t=>t.isRunning())}playFromInspector(t){this.mixer.stopAllAction();let e=this.clipIdToAction[t];!e||(e.play(),this.activeClip=e.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(t=>{t.repetitions=1/0,t.loop=fse}),this.mixer.stopAllAction(),this.requestRender()}play(t){let e=t.clipId+"/"+t.object,i=this.clipIdToAction[e];if(i)return t&&(t.repeat>=0&&(i.repetitions=t.repeat+1),t.direction==="pingpong"&&t.repeat!==0&&(i.loop=_5)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(t){let e=this.clipIdToAction[t];!e||(e.play(),e.paused=!1,this.requestRender())}pauseFromInspector(t){let e=this.clipIdToAction[t];!e||(e.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(t){var e;if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||(e=this.animationInspectorState)!=null&&e.isScrubbing)return;this.mixer.update(t/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){return jce(this.activeClip??void 0)}setProgressFromInspector(t,e){if(!this.clipIdToAction[e])return;this.activeClip!==this.clipIdToAction[e].getClip()&&this.playFromInspector(e);let i=this.clipIdToAction[e].paused;this.clipIdToAction[e].paused=!1,this.mixer.setTime(Math.min(t/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[e].paused=!0)}},sB=new WeakMap,LQe=class extends T_{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,i,r){let n=new Gk(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(t,s=>{this.decodeDracoFile(s,e).catch(r)},i,r)}decodeDracoFile(t,e,i,r){let n={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(t,n).then(e)}decodeGeometry(t,e){let i=JSON.stringify(e);if(sB.has(t)){let o=sB.get(t);if(o.key===i)return o.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,n=this.workerNextTaskID++,s=t.byteLength,a=this._getWorker(n,s).then(o=>(r=o,new Promise((l,c)=>{r._callbacks[n]={resolve:l,reject:c},r.postMessage({type:"decode",id:n,taskConfig:e,buffer:t},[t])}))).then(o=>this._createGeometry(o.geometry));return a.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),sB.set(t,{key:i,promise:a}),a}_createGeometry(t){let e=new Nt;t.index&&e.setIndex(new Yt(t.index.array,1));for(let i=0;i<t.attributes.length;i++){let r=t.attributes[i],n=r.name,s=r.array,a=r.itemSize;e.setAttribute(n,new Yt(s,a))}return e}_loadLibrary(t,e){let i=new Gk(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise((r,n)=>{i.load(t,r,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(i=>{let r=i[0];t||(this.decoderConfig.wasmBinary=i[1]);let n=OQe.toString(),s=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(t,e){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(n){let s=n.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,n){return r._taskLoad>n._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[t]=e,i._taskLoad+=e,i})}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function OQe(){let t,e;onmessage=function(a){let o=a.data;switch(o.type){case"init":t=o.decoderConfig,e=new Promise(function(h){t.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(t)});break;case"decode":let l=o.buffer,c=o.taskConfig;e.then(h=>{let u=h.draco,d=new u.Decoder,f=new u.DecoderBuffer;f.Init(new Int8Array(l),l.byteLength);try{let p=i(u,d,f,c),m=p.attributes.map(g=>g.array.buffer);p.index&&m.push(p.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:p},m)}catch(p){console.error(p),self.postMessage({type:"error",id:o.id,error:p.message})}finally{u.destroy(f),u.destroy(d)}});break}};function i(a,o,l,c){let h=c.attributeIDs,u=c.attributeTypes,d,f,p=o.GetEncodedGeometryType(l);if(p===a.TRIANGULAR_MESH)d=new a.Mesh,f=o.DecodeBufferToMesh(l,d);else if(p===a.POINT_CLOUD)d=new a.PointCloud,f=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());let m={index:null,attributes:[]};for(let g in h){let v=self[u[g]],y,x;if(c.useUniqueIDs)x=h[g],y=o.GetAttributeByUniqueId(d,x);else{if(x=o.GetAttributeId(d,a[h[g]]),x===-1)continue;y=o.GetAttribute(d,x)}m.attributes.push(n(a,o,d,g,v,y))}return p===a.TRIANGULAR_MESH&&(m.index=r(a,o,d)),a.destroy(d),m}function r(a,o,l){let c=l.num_faces()*3,h=c*4,u=a._malloc(h);o.GetTrianglesUInt32Array(l,h,u);let d=new Uint32Array(a.HEAPF32.buffer,u,c).slice();return a._free(u),{array:d,itemSize:1}}function n(a,o,l,c,h,u){let d=u.num_components(),f=l.num_points()*d,p=f*h.BYTES_PER_ELEMENT,m=s(a,h),g=a._malloc(p);o.GetAttributeDataArrayForAllPoints(l,u,m,p,g);let v=new h(a.HEAPF32.buffer,g,f).slice();return a._free(g),{name:c,array:v,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}var zf;function BQe(){return zf||(zf=new LQe,zf.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),zf.decoderPending}async function FQe(t){if(zf){let e={attributeIDs:zf.defaultAttributeIDs,attributeTypes:zf.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await zf.decodeGeometry(new Int8Array(t).buffer,e)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,n])=>({name:r,itemSize:n.itemSize,array:n.array}))}}return null}async function kQe(t,e){let[i,r]=Qae(iN.deserialize(new Uint8Array(t)));return woe(i),r.result().data}function NQe(t){let e=[];return t.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="NonParametricGeometry"&&r.geometry.data.draco!==void 0&&e.push(r)}),e}async function UQe(t){for(let e of t){let i=await FQe(e.geometry.data.draco);if(i){let r=e.geometry.data;i.index&&(r.index={array:i.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let n={};i.attributes.forEach(({name:s,array:a,itemSize:o})=>{n[s]={array:a,itemSize:o,type:"Float32Array",normalized:!1}}),r.attributes=n,r.draco=void 0}}}var zQe=class{constructor(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0],this._delay=500,this._distance=2,this._onMouseDown=t=>{let e=[t.clientX,t.clientY],i=new Date().getTime();if(this._clickCount>0){let r=e[0]-this._lastPosition[0],n=e[1]-this._lastPosition[1];Math.sqrt(r*r+n*n)>this._distance&&(this._clickCount=0)}this._lastPosition=e,this._clickCount=i-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=i},this._onMouseUp=t=>{}}start(t,e=500,i=2){this._target&&this.stop(),this.reset(),this._delay=e,this._distance=i,this._target=t,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}},GQe=class{constructor(t,e,i,r,n,s,a,o){this.eventId=t,this.id=e,this.data=i,this.dataEvent=r,this.object=n,this.stage=!1,this.actions=Gn(r,i.actions,s,a,o,n)}disconnect(){Cs(this.actions)}dispatchIn(){this.actions.Audio.forEach(t=>t.dispatchBasic()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Video.forEach(t=>t.dispatchBasic()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.Link.forEach(t=>t.dispatch()),this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.actions.Transition.forEach(t=>t.toggle()),this.actions.Animation.forEach(t=>t.play()),this.actions.SwitchCamera.forEach(t=>t.play()),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}dispatchOut(){this.actions.Transition.forEach(t=>{t.toggle()})}},VQe=class extends Sa{constructor(t,e){super(t),this.eventManager=e,this.breakpoints=[],this.resize=(i,r)=>{this.breakpoints.forEach(n=>{let s=aN.deviceToSize(n.data.size),a=n.dataEvent.orientation==="horizontal"?i:r,o;switch(n.data.operator){case"<":o=a<s[0];break;case">":o=a>s[0];break;case"<>":o=a>s[0]&&a<s[1];break}n.stage!==o&&(n.stage=o,n.stage?n.dispatchIn():n.dispatchOut())})},this.onResizeObserver=new ResizeObserver(i=>{for(let r of i){let{width:n,height:s}=r.contentRect;this.resize(n,s)}})}connect(){let{page:t,sharedAssets:e,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let r=n=>{var s;if(!(!n.visible||!((s=n.data)!=null&&s.events.length)))for(let{data:a,id:o}of n.data.events)a.disabled||a.type==="Resize"&&a.breakpoints.forEach(({data:l,id:c})=>{try{let h=new GQe(o,c,l,a,n,t,e,this.eventManager);this.breakpoints.push(h)}catch{}})};t.traverseEntity(n=>{var s;(n instanceof da||n instanceof ws)&&((s=n.frame)==null||s.traverse(a=>{r(a)})),r(n)})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(t=>{t.disconnect()}),this.breakpoints=[]}},HQe=class extends Sa{constructor(t,e){super(t),this.eventManager=e,this.userAPIs={},this.events=[],this.onSuccess=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchSuccess()})},this.onError=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchError()})},this.userAPIs=t.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity(t=>{var e;(e=t.data)==null||e.events.filter(i=>i.data.type==="API"&&!i.data.disabled).forEach(i=>{this.events.push(new jQe(i.id,i.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userAPIs).forEach(([t,e])=>{e.on("success",this.onSuccess),e.on("error",this.onError),e.autostart&&e.callUserAPI(this.eventContext.sharedAssets)})}disconnect(){Object.entries(this.userAPIs).forEach(([t,e])=>{e.off("success",this.onSuccess),e.off("error",this.onError)})}},jQe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.successActions=Gn(e,e.successActions,r,n,s,i),this.errorActions=Gn(e,e.errorActions,r,n,s,i)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(t){t.Audio.forEach(e=>e.dispatchConditional()),t.Particles.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch()),t.ClearLocalStorage.forEach(e=>e.dispatch()),t.UserAPI.forEach(e=>e.dispatch())}},WQe=class extends Sa{constructor(t,e){super(t),this.eventManager=e,this.userWebhooks={},this.events=[],this.onMessage=({userWebhookId:i})=>{this.events.forEach(r=>{r.data.userWebhookId===i&&r.dispatch()})},this.userWebhooks=t.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity(t=>{var e;(e=t.data)==null||e.events.filter(i=>i.data.type==="WEBHOOK"&&!i.data.disabled).forEach(i=>{this.events.push(new XQe(i.id,i.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userWebhooks).forEach(([t,e])=>{e.connect(),e.on("message",this.onMessage)})}disconnect(){Object.entries(this.userWebhooks).forEach(([t,e])=>{e.off("message",this.onMessage),e.disconnect()})}},XQe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.actions=Gn(e,e.actions,r,n,s,i)}dispatch(){let t=this.actions;t.Audio.forEach(e=>e.dispatchConditional()),t.Particles.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch()),t.ClearLocalStorage.forEach(e=>e.dispatch()),t.UserAPI.forEach(e=>e.dispatch())}};function YQe(){let t=document.createElement("textarea");return t.style.position="fixed",t.style.top="200px",t.style.left="400px",t.style.zIndex="-1",t.style.border="1px solid rgba(255,0,0,0.5)",t.style.width="10px",t.style.height="500px",t.style.color="white",t.style.opacity="0.5",t.style.background="transparent",t.style.display="none",t.style.margin="0px",t.style.padding="0px",t.style.boxSizing="content-box",t.style.pointerEvents="none",t}var qQe=new N(0,0,1),i$=new N,r$=new N,n$=new Bn,KQe=class{constructor(t,e,i,r,n){this.containerScene=t,this.raycaster=e,this.sharedAssets=i,this.requestRender=r,this.onExit=n,this.htmlInput=null,this.virtualInput=null,this.helper=new Kle,this.doubleClickHandler=new zQe,this.isDragging=!1,this.plane=new ro,this.caretInterval=0,this.planeIntersection=new N,this.projected=new ye,this._lastIndex=0,this._isFirstDragMove=!1,this.selectionOnDragStart=0,this.onTextMaterialChanged=()=>{var a;let s=(a=this.virtualInput)==null?void 0:a.data;if(this.virtualInput!==void 0&&s){let o=s.material,l=typeof o=="string"?this.sharedAssets.data.materials[o]:o,c=iXe(l,this.sharedAssets);this.helper.setCaretColor(c)}},this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)},this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval(()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()},600))},this.handleCaretUpdate=s=>{if(!this.htmlInput||!this.virtualInput)return;let a=this.helper,o=(s==null?void 0:s.key)==="ArrowLeft"||(s==null?void 0:s.key)==="ArrowRight",l=(s==null?void 0:s.key)==="ArrowUp"||(s==null?void 0:s.key)==="ArrowDown";this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(a.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:o,verticalKeyMove:l}),this.startAnimateTextCursor()):a.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()},this.containerScene.add(this.helper)}createInput(){return this.htmlInput=YQe(),this.htmlInput}connect(){}disconnect(){var t;this.stopAnimateTextCursor(),this.helper.hide(),(t=this.htmlInput)==null||t.remove(),this.doubleClickHandler.stop()}handleMouseDown(){var s,a;if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let t=this.doubleClickHandler.clickCount,{index:e,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,t>1?"inside":"previous")??{index:0,lineIndex:0,characterIndex:0};(a=(s=this.virtualInput)==null?void 0:s.wrappedText)!=null&&a.length&&this.virtualInput.wrappedText[i][Math.max(0,r-1)]===`
`&&(e--,r--),this._lastIndex=e,this._isFirstDragMove=!0;let n=this.checkClickedObject();if(t===1){if(n===null)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=e,this.isDragging=!0,this.setInputSelection(e)}else n===this.virtualInput&&(t===2?this.selectClosestWord(i,r):t>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(t){var e;if(this.virtualInput=t,this.updateTextInputStyles(),this.htmlInput)if(t){let i=(e=this.data)==null?void 0:e.geometry.text;this.htmlInput.value=typeof i=="string"?"":(i==null?void 0:i.textValue.toString())??""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:t}=this;if(t)return t.dataPatched}applyRangeToTextInput(){var n;if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let t=this.selectionOnDragStart,{index:e,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous")??{index:0};i!==void 0&&r!==void 0&&((n=this.virtualInput)==null?void 0:n.wrappedText[i][r-1])===`
`&&e--,this.htmlInput.setSelectionRange(Math.min(t,e),Math.max(t,e))}checkClickedObject(){if(this.virtualInput){let t=this.raycaster.intersectObject(this.virtualInput,!1);if(t.length>0){let e=t[0];if(e.object instanceof GG)return e.object}}return null}selectClosestWord(t,e){if(!this.virtualInput)return;let i=this.virtualInput.wrappedText,r=i[t],n=e+1,s=e;r[e]!==" "&&(n=this.findNextCharOccurence(r,e,"forward"," "),s=this.findNextCharOccurence(r,e,"backward"," "),s>0&&s++,n>=r.length-1&&t===i.length-1&&n++);let a=this.helper,o=a.getGlobalIndexFromLineAndCharIndexes(i,t,s),l=a.getGlobalIndexFromLineAndCharIndexes(i,t,n);this.setInputSelection(o,l)}findNextCharOccurence(t,e,i,r=" "){let n=Math.max(0,t.length-1),s=i==="forward"?n:0,a=i==="forward"?1:-1,o=Math.max(Math.min(e,n),0);for(;o!==s;)if(o+=a,t.charAt(o)===r)return o;return s}getPointOnPlane(){var e;let t=(e=this.virtualInput)==null?void 0:e.data;if(!(!this.virtualInput||!t)&&this.raycaster.ray.intersectsPlane(this.plane)){this.planeIntersection===null&&(this.planeIntersection=new N);let i=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(i){this.planeIntersection.copy(this.virtualInput.worldToLocal(i));let r=typeof t.geometry.width=="number"?t.geometry.width:1,n=typeof t.geometry.height=="number"?t.geometry.height:1;this.projected.set(i.x+r*.5,i.y-n*.5)}}}updatePlane(){var e;let t=(e=this.virtualInput)==null?void 0:e.data;this.virtualInput&&t&&(n$.getNormalMatrix(this.virtualInput.matrixWorld),i$.copy(qQe).applyMatrix3(n$).normalize(),this.virtualInput.localToWorld(r$.set(0,0,t.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint(i$,r$))}setInputSelection(t,e=t){var i;(i=this.htmlInput)==null||i.setSelectionRange(t,e),setTimeout(()=>{var r;(r=this.htmlInput)==null||r.focus()})}updateTextInputStyles(){var e;let t=(e=this.virtualInput)==null?void 0:e.data;this.virtualInput&&t&&this.htmlInput&&(this.htmlInput.style.fontSize=t.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=t.geometry.letterSpacing*t.geometry.fontSize+"px",this.htmlInput.style.lineHeight=t.geometry.fontSize*t.geometry.lineHeight+"px",this.htmlInput.style.width=t.geometry.width+"px",this.htmlInput.style.height=t.geometry.height+"px",this.htmlInput.style.textAlign=QQe(t.geometry.horizontalAlign))}};function QQe(t){return t===4?"justify":t===2?"right":t===3?"center":"left"}var che=(t,e)=>{if(typeof t=="string"){let i=e.data(t);if(i)return che(i.value,e)}return Ys.getDisplayedValue(t)};function s$(t,e){let i=t.text,r="";if(typeof i=="string"){let n=e.variables.data(r);n&&(r=che(n.value,e.variables))}else r=i.textValue.toString();return r}var $Qe=class extends Sa{constructor(t,e){super(t),this.eventManager=e,this._textInputs=[],this.sceneHelpers=new go,this.helper=new Kle,this._onMouseDownFocusIn=i=>{if($t.length>1)return;this.eventContext.updateRaycaster(i);let r=null;if(this.eventContext.raycaster){for(let n of this._textInputs)if(this.eventContext.raycaster.intersectObject(n,!0).length>0){r=n;break}}this.focusOnTextInput(r),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(i),this._onMouseDown(i)},this.onExit=()=>{let{virtualInput:i}=this.textInputManager;if(i===null)return;let r=this.textInputManager.htmlInput;this.helper.hide(),r==null||r.setSelectionRange(r.value.length,r.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:n}=this.eventContext;n.removeEventListener("pointerdown",this._onMouseDown,!1),n.removeEventListener("pointerup",this._onMouseUp,!1),n.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),n.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()},this._onMouseDown=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)},this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)},this._onMouseMove=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseMove()},this._onTextEdit=i=>{let{htmlInput:r,virtualInput:n,helper:s}=this.textInputManager;if(!r||!n)return;let a=r.value;n.textGeometry.setText(a).then(()=>{this.eventContext.requestRender()});let o=n.data;s.update();let l=o.geometry.text;if(typeof l=="string"){let c=l;this.eventContext.sharedAssets.updateVariable(c,{textValue:a})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()},this._onCaretUpdate=i=>{this.textInputManager.handleCaretUpdate(i)},this._onKeyPress=i=>{i.key==="Escape"&&this.onExit()},this.textInputManager=new KQe(this.sceneHelpers,t.raycaster,t.sharedAssets,t.requestRender,this.onExit)}connect(){let t=[];if(this.eventContext.scene.traverseEntity(r=>{r instanceof GG&&t.push(r)}),this._textInputs=t,t.length===0)return;let{domElement:e}=this.eventContext;e.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let i=this.textInputManager.createInput();document.body.appendChild(i),i.style.display="none",i.addEventListener("keyup",this._onCaretUpdate),i.addEventListener("keydown",this._onCaretUpdate),i.addEventListener("beforeinput",this._onCaretUpdate),i.addEventListener("paste",this._onCaretUpdate),i.addEventListener("cut",this._onCaretUpdate),i.addEventListener("select",this._onCaretUpdate),i.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let t=this.textInputManager.htmlInput,{domElement:e}=this.eventContext;e.removeEventListener("pointerdown",this._onMouseDownFocusIn),t==null||t.removeEventListener("keyup",this._onCaretUpdate),t==null||t.removeEventListener("keydown",this._onCaretUpdate),t==null||t.removeEventListener("beforeinput",this._onCaretUpdate),t==null||t.removeEventListener("paste",this._onCaretUpdate),t==null||t.removeEventListener("cut",this._onCaretUpdate),t==null||t.removeEventListener("select",this._onCaretUpdate),t==null||t.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach(i=>{let r=s$(i.data.geometry,this.eventContext.sharedAssets.data);i.textGeometry.setText(r)}),e.removeEventListener("pointerdown",this._onMouseDown,!1),e.removeEventListener("pointerup",this._onMouseUp,!1),e.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(t){this.textInputManager.focus(t),this.textInputManager.onTextMaterialChanged();let e=this.textInputManager.htmlInput;if(!e||t===null)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let i=s$(t.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);e.value=i,e.setSelectionRange(0,0),this.textInputManager.helper.show(t),e.style.display="block",e.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:r}=this.eventContext;r.removeEventListener("pointerdown",this._onMouseDownFocusIn),r.addEventListener("pointerdown",this._onMouseDown,!1),r.addEventListener("pointerup",this._onMouseUp,!1),r.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}},JQe=class extends Sa{constructor(t,e){super(t),this.eventManager=e,this.events=[],this.onVoice=({value:i,frequencies:r})=>{this.events.forEach(n=>{n.dispatch()})}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(t=>{var e;(e=t.data)==null||e.events.filter(i=>i.data.type==="AIAssistantListener"&&!i.data.disabled).forEach(i=>{this.events.push(new ZQe(i.id,i.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("voice",this.onVoice))}disconnect(){var t;(t=this.openAIRealtime)==null||t.off("voice",this.onVoice)}},ZQe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.actions=Gn(e,e.actions,r,n,s,i)}dispatch(){this.dispatchActions(this.actions)}dispatchActions(t){t.Audio.forEach(e=>e.dispatchConditional()),t.Particles.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch()),t.ClearLocalStorage.forEach(e=>e.dispatch()),t.UserAPI.forEach(e=>e.dispatch())}},e$e=class extends Sa{constructor(t,e){super(t),this.eventManager=e,this.events=[],this.onTriggerEvent=({description:i,direction:r})=>{let n=this.events.find(s=>s.data.description===i);n&&(r==="backward"?n.dispatchReverse():n.dispatch())}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(t=>{var e;(e=t.data)==null||e.events.filter(i=>i.data.type==="AIAssistantTrigger"&&!i.data.disabled).forEach(i=>{this.events.push(new t$e(i.id,i.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("trigger_event",this.onTriggerEvent))}disconnect(){var t;(t=this.openAIRealtime)==null||t.off("trigger_event",this.onTriggerEvent)}},t$e=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.actions=Gn(e,e.actions,r,n,s,i)}dispatch(){let t=this.actions;t.Audio.forEach(e=>e.dispatchConditional()),t.Particles.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch()),t.ClearLocalStorage.forEach(e=>e.dispatch()),t.UserAPI.forEach(e=>e.dispatch())}dispatchReverse(){let t=this.actions;t.Transition.forEach(e=>e.reverseFromCurrent()),t.Particles.forEach(e=>e.reverseFromCurrent()),t.Animation.forEach(e=>e.reverseFromCurrent()),t.SwitchCamera.forEach(e=>e.reverseFromCurrent()),t.Create.forEach(e=>e.dispatchStop())}},i$e=class{constructor(t,e,i,r,n){this.publish=t,this.controlsManager=e,this.animationControls=i,this.eventContext=r,this.sharedVariables=n,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=s=>{let a=window.parent!==window,o=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(s.touches.length>1||this.preventTouchScroll||a===!1&&o===!1)&&s.preventDefault()},this.onMouseWheelPreventScroll=s=>{this.preventScroll&&s.preventDefault()},this.onMouseMove=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:s.buttons>0}},this.onMouseDown=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!0}},this.onMouseUp=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!1}},this.getMousePosition=s=>{var c;let{domRect:a}=this.eventContext,{pageX:o,pageY:l}=((c=s.touches)==null?void 0:c.length)>0?s.touches[0]:s;return{x:o-(a.left+window.scrollX),y:l-(a.top+window.scrollY)}},this.stopRaycast=t.stopRaycast,this.preventScroll=t.preventScroll,this.preventTouchScroll=t.preventTouchScroll,this.hideCursor=t.hideCursor,this.requestRender=r.requestRender}activate(t=!1){var r;if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new PKe(this.eventContext),VariableChange:new oQe(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new HQe(this.eventContext,this),WEBHOOK:new WQe(this.eventContext,this),AIAssistantListener:new JQe(this.eventContext,this),AIAssistantTrigger:new e$e(this.eventContext,this),Conditional:new FKe(this.eventContext,this),Start:new sQe(this.eventContext,this),Basic:new RKe(this.eventContext,this,this.needsRaycast),MouseHover:new eQe(this.eventContext,this),Scroll:new rQe(this.eventContext,this),Follow:new XKe(this.eventContext,this),DragDrop:new GKe(this.eventContext,this),LookAt:new $Ke(this.eventContext),Resize:new VQe(this.eventContext,this),Textfields:new $Qe(this.eventContext,this)};let{page:e,domElement:i}=this.eventContext;this.hideCursor&&(i.style.cursor="none"),e.traverseEntity(n=>{n.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(n=>n.connect()),i.addEventListener("wheel",this.onMouseWheelPreventScroll),i.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++,t||((r=this.eventContext.sharedAssets.openAIRealtime)==null||r.connect())}deactivate(t=!1){var r,n;if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:e,domElement:i}=this.eventContext;i.style.cursor="",Object.values(this.handlers).forEach(s=>s.disconnect()),(r=this.controlsManager.gameControl)==null||r.disposeActions(),this.controlsManager.disconnectEvents(),e.traverseEntity(s=>{s.removeEventListener("requestRender",this.requestRender),s.destroyedInAction=!1}),i.removeEventListener("touchmove",this.onTouchMovePreventScroll),i.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode(),t||((n=this.eventContext.sharedAssets.openAIRealtime)==null||n.disconnect())}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(!0),this.activate(!0),this.controlsManager.deactivate(),this.controlsManager.activate(this),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(t){let e=this.isEnabled;e&&this.deactivate(),this.eventContext.useWindowEvents=t,e&&this.activate()}initializeActionsDependentStates(){let t=this.eventContext.sharedAssets;t.resetDynamicVariablePlayState();let e=i=>{if(i.data.type==="Conditional"&&(i.data.ifActions.forEach(e),i.data.elseActions.forEach(e)),i.data.type==="Conditional"||i.data.type==="SetVariable")for(let r of i.data.type==="Conditional"?i.data.condition:i.data.expression)"id"in r&&Array.isArray(r.id)&&(r.id[0]==="mouse"&&(this.needsMouse=!0),r.id[0]==="raycast"&&(this.needsRaycast=!0));i.data.type==="DynamicVariablePlay"&&i.data.variableId!==""&&(i.data.mode==="Play"||i.data.mode==="PlayPause"||i.data.mode==="Toggle")&&t.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length)for(let n of i.data.events)if(n.data.type==="VariableChange"&&(n.data.variableId==="mouseProperty"&&(this.needsMouse=!0),n.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),n.data.type==="Conditional")for(let s of["inActions","outActions"])n.data[s].forEach(e);else if(n.data.type==="DragDrop")for(let s of["drag","drop"])n.data.dragDropActions[s].forEach(e);else if(n.data.type==="GameControl")for(let s of["idle","move","jump","run"])n.data.gameActions[s].forEach(e);else if(n.data.type==="Resize")for(let s of n.data.breakpoints)s.data.actions.forEach(e);else n.data.type==="LookAt"||n.data.type==="API"||n.data.actions.forEach(e)})}},r$e=class{constructor(t,e,i,r,n){this._aspect=1,this.enableResponsive=!1,this._renderer=t,this._camera=e,this._frameSize=new ye().copy(i),this._editorSize=new ye().copy(r),this._aspect=e.aspect,this._fov=n??e.fov}set frameSize(t){this._frameSize.copy(t)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let t=this._frameSize.x,e=this._frameSize.y,i=this._editorSize.y;this._aspect=t/e,e<=i&&(this._camera.zoom*=i/e),this._renderer.setViewport(0,0,t,e)}updateCamera(t=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let e=this._frameSize.y,i=this._editorSize.y,r=this._fov;if(t&&e>i){let n=n$e(e,1080,2160,1,15)/100;r*=e/i,r*=1-n}this._camera.aspect=this._aspect,this._camera.fov=r,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(t){this._camera=t,this._aspect=t.aspect,this._fov=t.fov}revert(){let t=window.innerWidth,e=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,t,e),this._renderer.setSize(t,e)),this._camera&&(this._camera.aspect=t/e,this._camera.fov=this._fov,this._camera.setViewplaneSize(t,e,this.enableResponsive),this._camera.updateProjectionMatrix())}};function n$e(t,e,i,r,n){return(t-e)/(i-e)*(n-r)+r}var s$e=class{get sharedAssets(){return this.shared}constructor(t,e={},i=!0){this.shared=new DG(t.shared,e,!0,i),this.scene=new jG(t.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(t,e){this.scene.clearScene(),this.sharedAssets.reset(t.shared),this.scene.resetAfterClear(t.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let t of this.scene.children)t instanceof ws&&!t.uiScene&&t.personalCamera.updateState(t.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(t=>{t instanceof Fn&&t.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},a$e=class{constructor({x:t=10,y:e=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${t}px`,this.element.style.top=`${e}px`}dispose(){var t;(t=this.element.parentElement)==null||t.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let t=performance.now()-this._startTime;this.element.innerHTML=t.toFixed(3)+" ms"}};function o$e(t){let e;if(t.index)for(let i=0;i<t.index.array.length;i+=3)e=t.index.array[i],t.index.array[i]=t.index.array[i+2],t.index.array[i+2]=e}function Aw(t){return t instanceof IS?"SubdivObject":t.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function l$e(t,e){let i={};return t.traverseEntity(r=>{var l;if(!r.visible||!(r instanceof ja)||r.type!=="Mesh"||Array.isArray(r.material)||r.states&&Object.keys(r.states).length)return;let n=r.parent;for(;n;){if(n instanceof ja&&r.states&&Object.keys(r.states).length)return;n=n.parent}let s=r.material.uuid,a=e.shared.materials[s];if(a){if(!Es.isMergable(a))return}else{let c=(l=e.scene.objects.get(r.uuid))==null?void 0:l.data;if(c&&"material"in c&&typeof c.material!="string"){if(!Es.isMergable(c.material))return;s=Es.getHash(c.material)}}i[s]||(i[s]={});let o=i[s][Aw(r)];if(o){if(o.push(r),r.cloner)for(let c of r.cloner.children)o.push(c)}else if(i[s][Aw(r)]=[r],r.cloner)for(let c of r.cloner.children)i[s][Aw(r)].push(c)}),i}function c$e(t){let e=0;return Object.values(t).forEach(i=>{Object.values(i).forEach(r=>{let n=r.length;n>e&&(e=n)})}),e}function h$e(t,e){let i=l$e(e,t),r=c$e(i),n=new Array(r),s=0,a=new Array(r),o=0,l=new Array(r),c=0,h=new Array(r),u=0;for(let[d,f]of Object.entries(i))for(let p of Object.values(f)){if(o=0,c=0,p.forEach(g=>{g instanceof ja&&(a[o++]=g.geometry.clone(),l[c++]=g)}),c<2)continue;for(let g=0;g<c;g++)l[g].updateWorldMatrix(!0,!1),a[g].applyMatrix4(l[g].matrixWorld),l[g].matrixWorld.determinant()<0&&o$e(a[g]);let m=Zm(a.slice(0,o),!1);if(m){let g;switch(d){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),g=new vr(m,l[0].material);break}default:{g=new vr(m,l[0].material);break}}g.castShadow=l[0].castShadow,g.receiveShadow=l[0].receiveShadow,e.add(g);let v=y=>{u=0;for(let x of y)x.children&&v(x.children),x instanceof ja&&(Array.isArray(x.material)||i[x.material.uuid]&&i[x.material.uuid][Aw(x)]&&i[x.material.uuid][Aw(x)].length>1||(h[u++]=x));for(let x=0;x<u;x++)e.attach(h[x])};for(let y=0;y<c;y++){let x=l[y];v(x.children),n[s++]=x}}}for(let d=0;d<s;d++)n[d].removeFromParent()}var u$e=Ip(o2e(),1),d$e=new ye;function f$e(t){let e="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";t.endsWith(".spline")?console.warn(e+" The .spline files are only meant to be used by the Editor."):t.endsWith(".splinecode")||console.warn(e)}var p$e=class{constructor(t,{renderOnDemand:e,renderMode:i="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=r=>{var n,s,a,o,l,c,h,u,d,f,p,m,g;if(this.time=r,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,(n=this._perfs)==null||n.start(),!this._renderer){(s=this._perfs)==null||s.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){(a=this._perfs)==null||a.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&((o=this._eventManager.handlers)!=null&&o.Start.hasVideoAction||(l=this._eventManager.handlers)!=null&&l.Basic.hasVideoAction||(c=this._eventManager.handlers)!=null&&c.Conditional.hasVideoAction)&&(this._skipRender=!1),(h=this._animationControls)==null||h.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,(u=this._scene)==null||u.traverseVisibleEntity(v=>{v.type==="ParticleSystem"&&(v.update(this.dt),this._skipRender=!1)}),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),(d=this._eventManager)!=null&&d.isEnabled&&(((f=this._eventManager.handlers)==null?void 0:f.Follow).onAnimationFrameDamping(),((p=this._eventManager.handlers)==null?void 0:p.LookAt).onAnimationFrameDamping(),((m=this._eventManager.handlers)==null?void 0:m.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let v=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=v,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),(g=this._perfs)==null||g.end()},this._resize=r=>{var n,s,a,o,l,c,h,u,d,f;if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=d$e.set(this._viewportWidth,this._viewportHeight)),r){let p=this._viewportWidth,m=this._viewportHeight;this._renderer.setSize(p-1,m-1,!1),this._renderer.setSize(p,m,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=(n=this._scene)==null?void 0:n.activeCamera,(h=this._scene)==null||h.updateViewPlaneSize(((a=(s=this._frameView)==null?void 0:s.frameSize)==null?void 0:a.x)??this._viewportWidth,((l=(o=this._frameView)==null?void 0:o.frameSize)==null?void 0:l.y)??this._viewportHeight,((c=this._frameView)==null?void 0:c.enableResponsive)??!1),this._camera){let p=Object.values(((u=this._data)==null?void 0:u.frames)??{})[0].preset??"fullscreen";(d=this._frameView)==null||d.setCamera(this._camera),(f=this._frameView)==null||f.updateCamera(p!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=bS(this._resize,10),this._onScroll=r=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=t,this.renderMode=e?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new a$e({x:10,y:10})),lGe(t)}async load(t,e,i){f$e(t),this.disposed=!1;let r=await(await fetch(t,i)).arrayBuffer();await this.start(r,{variables:e})}async start(t,{interactive:e=!0,variables:i}={}){var l,c,h,u;if(this.disposed)return;let r=await kQe(t);this._data=r;let n=NQe(r);r.version&&(0,u$e.default)(r.version,"1.9.82")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([n.length&&BQe(),PK(r)&&dHe(),vWe(r)&&lHe(),ES.physicsEnabled(r.scene.objects)&&fGe(),EK(r)&&Yje(),sQ(r)&&CYe(),Wje(r)&&jje(),QK(r)&&pXe(),xQe(r)&&uGe()].filter(Boolean)),n.length&&await UQe(n),(l=this._eventManager)==null||l.deactivate(),(c=this._controls)==null||c.deactivate(),(h=this._scene)==null||h.dispose();let s=new s$e(r);if(s.resetPersonalCameraFromDocumentData(),this._scene=s.scene,this._sharedAssetsManager=s.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let d=performance.now();h$e(r,s.scene);let f=performance.now();console.log("Merged geometries in ",f-d," ms")}PK(r)&&this._scene.traverse(d=>{Zu(d)&&d.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{var d;this._requestRenderAutoMode(),(d=this._scene)==null||d.traverse(f=>{f instanceof Ol&&f.pendingMediaLoad&&f.update()})}),(u=this._scene)==null||u.traverse(d=>{d.type==="ParticleSystem"&&(d.wakeUp(),d.data.autoPlay?d.start():d.stop())});let a=Object.keys(r.shared.fonts).map(d=>this._sharedAssetsManager.getFont(d).loadingPromise);if(Promise.all(a).then(()=>{s.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),EK(r)&&PQe(r)&&await Promise.all(a),QK(r)){let d=[];this._scene.traverseEntity(f=>{(f instanceof da||f instanceof ws)&&f.uiCanvas&&d.push(f.uiCanvas)}),await Promise.all(d.map(f=>f.promise))}if(this._scene.rewriteEventsBeforeGoToPlayMode(),rV(this._scene.activePage,this._sharedAssetsManager),!this._renderer&&(this._renderer=new eXe({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=r.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),r.shared.images.SplineWatermark)){let d=this._sharedAssetsManager.getImage("SplineWatermark");await d.loadPromise;let f=d.getTexture(1001);this._renderer.pipeline.setWatermark(f)}sQ(r)&&this._scene.initializeSplatViewer(),r.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(r.scene.blueNoiseTextureData);let o=Object.values(r.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(o.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=o.size[0],this._viewportHeight=o.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new r$e(this._renderer,this._camera,new ye(this._viewportWidth,this._viewportHeight),new ye(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(o.allowResponsive??!1)&&o.preset==="fullscreen"),e){let d=new TKe(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,o);this._scene.updateMatrixWorld(!0),this._controls=new DQe(d),this._animationControls=new IQe(this._scene,this._requestRenderAutoMode),this._eventManager=new i$e(r.scene.publish,this._controls,this._animationControls,d,r.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then(()=>{this._resize(!0)}),i!==void 0&&this.setVariables(i),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{var d;(d=this._renderer)==null||d.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300),document.addEventListener("scroll",this._onScroll)}setVariables(t){if(this._data!==void 0){let e=Object.entries(t);for(let[i,r]of e)this.setVariable(i,r)}}setVariable(t,e){var r;let i=this._getVariableByName(t);if(i&&!("dynamicVariableType"in i.data)){let n=e;typeof i.data.value=="number"?n=typeof e=="number"?e:typeof e=="boolean"?e===!0?1:0:parseFloat(e):typeof i.data.value=="boolean"?n=typeof e=="number"?!!e:typeof e=="boolean"?e:e.toLocaleLowerCase()==="false"?!1:!!e:typeof i.data.value!="string"&&i.data.value.textValue!==void 0&&(n=e.toString());let s=typeof n=="string"?{textValue:n}:n;(r=this._sharedAssetsManager)==null||r.updateVariable(i.id,s),this.requestRender(),this._requestRenderAutoMode()}else i===void 0?console.warn(`No variable named ${t} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${t} cannot be updated from code.`)}getVariables(){let t={};return this._data&&this._data.shared.variables.forEach(e=>{t[e.data.name]===void 0&&(t[e.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(e.id)))}),t}getVariable(t){let e=this._getVariableByName(t);if(e){let i=this._sharedAssetsManager.getVariable(e.id);return this._getVariableValue(i)}}_getVariableValue(t){return typeof t!="string"&&Ys.isTextValue(t)?Ys.getDisplayedValue(t):t}_getVariableByName(t){if(this._data){if(this._variablesCache.has(t))return this._variablesCache.get(t);let e=this._data.shared.variables.find(i=>i.data.name===t);return e&&this._variablesCache.set(t,e),e}}findObjectById(t){var i;let e=(i=this._scene)==null?void 0:i.getObjectByProperty("uuid",t);return this._createProxyObject(e)}findObjectByName(t){var i;let e=(i=this._scene)==null?void 0:i.getObjectByName(t);return this._createProxyObject(e)}getAllObjects(){var e;let t=[];return(e=this._scene)==null||e.traverseEntity(i=>{if(i.uuid!==J1&&!this._scene.isInvisibleObjects(i)&&!(i instanceof ws)){let r=this._createProxyObject(i);r&&t.push(r)}}),t}getSplineEvents(){var t,e;return((e=(t=this._eventManager)==null?void 0:t.handlers)==null?void 0:e.Spline).splineEvents}emitEvent(t,e){var i;(i=this.findObjectById(e)||this.findObjectByName(e))==null||i.emitEvent(t)}emitEventReverse(t,e){var i;(i=this.findObjectById(e)||this.findObjectByName(e))==null||i.emitEventReverse(t)}addEventListener(t,e){this.canvas.addEventListener(t,e)}removeEventListener(t,e){this.canvas.removeEventListener(t,e)}setZoom(t){var e,i;((e=this._controls)==null?void 0:e.orbitControls)instanceof lhe&&((i=this._controls)==null||i.orbitControls.setZoom(t))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(t,e){this._viewportWidth=t,this._viewportHeight=e,this._viewportMode=2,this._resize()}setBackgroundColor(t){var a;let{r:e,g:i,b:r,a:n}={r:0,g:0,b:0,a:1},s=new Qs(e,i,r,n);try{s.setStyle(t)}catch{console.error("This is not a valid css color",t)}(a=this._scene)==null||a.activePage.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){var t,e,i,r,n,s,a;this.disposed=!0,(t=this._eventManager)==null||t.deactivate(),(e=this._scene)==null||e.dispose(),(i=this._sharedAssetsManager)==null||i.dispose(),this._proxyObjectCache.forEach(o=>{LX.unsubscribe(o)}),this._variablesCache.clear(),(r=this._renderer)==null||r.setAnimationLoop(null),(n=this._renderer)==null||n.dispose(),this._renderer=void 0,(s=this._sharedAssetsManager)==null||s.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),(a=this._controls)==null||a.deactivate(),this.dt=0,cGe(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){var t,e,i;this._isPaused||((t=this._renderer)==null||t.setAnimationLoop(null),this._isPaused=!0,(e=this._eventManager)==null||e.pause(),(i=this._controls)!=null&&i.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){var t,e,i;!this._isPaused||(this._isPaused=!1,(t=this._eventManager)==null||t.resume(),(e=this._controls)!=null&&e.orbitControls&&(this._controls.orbitControls.enabled=!0),(i=this._renderer)==null||i.setAnimationLoop(this.render))}setGlobalEvents(t){var e;(e=this._eventManager)==null||e.updateUseWindowEvents(t)}get data(){return this._data}_createProxyObject(t){var n;if(t==null)return;if(this._proxyObjectCache.has(t.uuid))return this._proxyObjectCache.get(t.uuid);let e;t.traverseAncestors(s=>{s instanceof ws&&(e=s.name)});let i={name:t.name,uuid:t.uuid,visible:t.visible,intensity:t.intensity,position:t.position,rotation:t.rotation,scale:t.scale,type:t.data.type,page:e,parentUuid:t.parent instanceof ws||t instanceof jG||(n=t.parent)==null?void 0:n.uuid,emitEvent(s){t.dispatchEvent({type:"userEvent",eventName:s})},emitEventReverse(s){t.dispatchEvent({type:"userEvent",eventName:s,reverse:!0})}},r=LX(i,(s,a)=>{var o;typeof t[s]!="object"&&((o=Object.getOwnPropertyDescriptor(t,s))!=null&&o.writable)&&(t[s]=a),this._requestRenderAutoMode(),t.updateMatrix()});return this._proxyObjectCache.set(t.uuid,r),r}setUIWasmUrl(t){Cle.skiaWasmUrl=t}},m$e="Expected a function",a$=NaN,g$e="[object Symbol]",v$e=/^\s+|\s+$/g,y$e=/^[-+]0x[0-9a-f]+$/i,x$e=/^0b[01]+$/i,b$e=/^0o[0-7]+$/i,w$e=parseInt,S$e=typeof kA=="object"&&kA&&kA.Object===Object&&kA,_$e=typeof self=="object"&&self&&self.Object===Object&&self,A$e=S$e||_$e||Function("return this")(),E$e=Object.prototype,M$e=E$e.toString,T$e=Math.max,C$e=Math.min,aB=function(){return A$e.Date.now()};function P$e(t,e,i){var r,n,s,a,o,l,c=0,h=!1,u=!1,d=!0;if(typeof t!="function")throw new TypeError(m$e);e=o$(e)||0,DU(i)&&(h=!!i.leading,u="maxWait"in i,s=u?T$e(o$(i.maxWait)||0,e):s,d="trailing"in i?!!i.trailing:d);function f(_){var M=r,E=n;return r=n=void 0,c=_,a=t.apply(E,M),a}function p(_){return c=_,o=setTimeout(v,e),h?f(_):a}function m(_){var M=_-l,E=_-c,T=e-M;return u?C$e(T,s-E):T}function g(_){var M=_-l,E=_-c;return l===void 0||M>=e||M<0||u&&E>=s}function v(){var _=aB();if(g(_))return y(_);o=setTimeout(v,m(_))}function y(_){return o=void 0,d&&r?f(_):(r=n=void 0,a)}function x(){o!==void 0&&clearTimeout(o),c=0,r=l=n=o=void 0}function S(){return o===void 0?a:y(aB())}function A(){var _=aB(),M=g(_);if(r=arguments,n=this,l=_,M){if(o===void 0)return p(l);if(u)return o=setTimeout(v,e),f(l)}return o===void 0&&(o=setTimeout(v,e)),a}return A.cancel=x,A.flush=S,A}function DU(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function D$e(t){return!!t&&typeof t=="object"}function R$e(t){return typeof t=="symbol"||D$e(t)&&M$e.call(t)==g$e}function o$(t){if(typeof t=="number")return t;if(R$e(t))return a$;if(DU(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=DU(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(v$e,"");var i=x$e.test(t);return i||b$e.test(t)?w$e(t.slice(2),i?2:8):y$e.test(t)?a$:+t}var I$e=P$e;const L$e=C1(I$e);function O$e(t){return e=>{t.forEach(i=>{typeof i=="function"?i(e):i!=null&&(i.current=e)})}}const B$e=[],F$e={width:"100%",height:"100%"},k$e=we.forwardRef(function({className:t,children:e,debounceTime:i=300,ignoreDimensions:r=B$e,parentSizeStyles:n,enableDebounceLeadingCall:s=!0,resizeObserverPolyfill:a,...o},l){const c=we.useRef(null),h=we.useRef(0),[u,d]=we.useState({width:0,height:0,top:0,left:0}),f=we.useMemo(()=>{const p=Array.isArray(r)?r:[r];return L$e(m=>{d(g=>Object.keys(g).filter(v=>g[v]!==m[v]).every(v=>p.includes(v))?g:m)},i,{leading:s})},[i,s,r]);return we.useEffect(()=>{const p=a||window.ResizeObserver,m=new p(g=>{g.forEach(v=>{const{left:y,top:x,width:S,height:A}=(v==null?void 0:v.contentRect)??{};h.current=window.requestAnimationFrame(()=>{f({width:S,height:A,top:x,left:y})})})});return c.current&&m.observe(c.current),()=>{window.cancelAnimationFrame(h.current),m.disconnect(),f.cancel()}},[f,a]),Y.jsx("div",{style:{...F$e,...n},ref:O$e([l,c]),className:t,...o,children:e({...u,ref:c.current,resize:f})})}),N$e=we.forwardRef(({scene:t,style:e,onSplineMouseDown:i,onSplineMouseUp:r,onSplineMouseHover:n,onSplineKeyDown:s,onSplineKeyUp:a,onSplineStart:o,onSplineLookAt:l,onSplineFollow:c,onSplineScroll:h,onLoad:u,renderOnDemand:d=!0,children:f,...p},m)=>{const g=we.useRef(null),[v,y]=we.useState(!0),[x,S]=we.useState();if(x)throw x;return we.useEffect(()=>{y(!0);let A;const _=[{name:"mouseDown",cb:i},{name:"mouseUp",cb:r},{name:"mouseHover",cb:n},{name:"keyDown",cb:s},{name:"keyUp",cb:a},{name:"start",cb:o},{name:"lookAt",cb:l},{name:"follow",cb:c},{name:"scroll",cb:h}];if(g.current){A=new p$e(g.current,{renderOnDemand:d});async function M(){await A.load(t);for(let E of _)E.cb&&A.addEventListener(E.name,E.cb);y(!1),u==null||u(A)}M().catch(E=>{S(E)})}return()=>{for(let M of _)M.cb&&A.removeEventListener(M.name,M.cb);A.dispose()}},[t]),Y.jsx(k$e,{ref:m,parentSizeStyles:{overflow:"hidden",...e},debounceTime:50,...p,children:()=>Y.jsxs(Y.Fragment,{children:[v&&f,Y.jsx("canvas",{ref:g,style:{display:v?"none":"block"}})]})})});function Iu(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hhe(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}/*!
 * GSAP 3.12.5
 * https://gsap.com
 *
 * @license Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Ho={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},b1={duration:.5,overwrite:!1,delay:0},sV,va,Br,Bl=1e8,Sr=1/Bl,RU=Math.PI*2,U$e=RU/4,z$e=0,uhe=Math.sqrt,G$e=Math.cos,V$e=Math.sin,Os=function(e){return typeof e=="string"},ln=function(e){return typeof e=="function"},xd=function(e){return typeof e=="number"},aV=function(e){return typeof e>"u"},Xh=function(e){return typeof e=="object"},vo=function(e){return e!==!1},oV=function(){return typeof window<"u"},TT=function(e){return ln(e)||Os(e)},dhe=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},ya=Array.isArray,IU=/(?:-?\.?\d|\.)+/gi,fhe=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,cy=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,oB=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,phe=/[+-]=-?[.\d]+/,mhe=/[^,'"\[\]\s]+/gi,H$e=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Vr,mh,LU,lV,qo={},EP={},ghe,vhe=function(e){return(EP=Kg(e,qo))&&So},cV=function(e,i){return console.warn("Invalid property",e,"set to",i,"Missing plugin? gsap.registerPlugin()")},OS=function(e,i){return!i&&console.warn(e)},yhe=function(e,i){return e&&(qo[e]=i)&&EP&&(EP[e]=i)||qo},BS=function(){return 0},j$e={suppressEvents:!0,isStart:!0,kill:!1},MC={suppressEvents:!0,kill:!1},W$e={suppressEvents:!0},hV={},sp=[],OU={},xhe,Oo={},lB={},l$=30,TC=[],uV="",dV=function(e){var i=e[0],r,n;if(Xh(i)||ln(i)||(e=[e]),!(r=(i._gsap||{}).harness)){for(n=TC.length;n--&&!TC[n].targetTest(i););r=TC[n]}for(n=e.length;n--;)e[n]&&(e[n]._gsap||(e[n]._gsap=new Hhe(e[n],r)))||e.splice(n,1);return e},Sg=function(e){return e._gsap||dV(Fl(e))[0]._gsap},bhe=function(e,i,r){return(r=e[i])&&ln(r)?e[i]():aV(r)&&e.getAttribute&&e.getAttribute(i)||r},yo=function(e,i){return(e=e.split(",")).forEach(i)||e},vn=function(e){return Math.round(e*1e5)/1e5||0},_s=function(e){return Math.round(e*1e7)/1e7||0},Uy=function(e,i){var r=i.charAt(0),n=parseFloat(i.substr(2));return e=parseFloat(e),r==="+"?e+n:r==="-"?e-n:r==="*"?e*n:e/n},X$e=function(e,i){for(var r=i.length,n=0;e.indexOf(i[n])<0&&++n<r;);return n<r},MP=function(){var e=sp.length,i=sp.slice(0),r,n;for(OU={},sp.length=0,r=0;r<e;r++)n=i[r],n&&n._lazy&&(n.render(n._lazy[0],n._lazy[1],!0)._lazy=0)},whe=function(e,i,r,n){sp.length&&!va&&MP(),e.render(i,r,va&&i<0&&(e._initted||e._startAt)),sp.length&&!va&&MP()},She=function(e){var i=parseFloat(e);return(i||i===0)&&(e+"").match(mhe).length<2?i:Os(e)?e.trim():e},_he=function(e){return e},Yl=function(e,i){for(var r in i)r in e||(e[r]=i[r]);return e},Y$e=function(e){return function(i,r){for(var n in r)n in i||n==="duration"&&e||n==="ease"||(i[n]=r[n])}},Kg=function(e,i){for(var r in i)e[r]=i[r];return e},c$=function t(e,i){for(var r in i)r!=="__proto__"&&r!=="constructor"&&r!=="prototype"&&(e[r]=Xh(i[r])?t(e[r]||(e[r]={}),i[r]):i[r]);return e},TP=function(e,i){var r={},n;for(n in e)n in i||(r[n]=e[n]);return r},Ew=function(e){var i=e.parent||Vr,r=e.keyframes?Y$e(ya(e.keyframes)):Yl;if(vo(e.inherit))for(;i;)r(e,i.vars.defaults),i=i.parent||i._dp;return e},q$e=function(e,i){for(var r=e.length,n=r===i.length;n&&r--&&e[r]===i[r];);return r<0},Ahe=function(e,i,r,n,s){var a=e[n],o;if(s)for(o=i[s];a&&a[s]>o;)a=a._prev;return a?(i._next=a._next,a._next=i):(i._next=e[r],e[r]=i),i._next?i._next._prev=i:e[n]=i,i._prev=a,i.parent=i._dp=e,i},JD=function(e,i,r,n){r===void 0&&(r="_first"),n===void 0&&(n="_last");var s=i._prev,a=i._next;s?s._next=a:e[r]===i&&(e[r]=a),a?a._prev=s:e[n]===i&&(e[n]=s),i._next=i._prev=i.parent=null},wp=function(e,i){e.parent&&(!i||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},_g=function(e,i){if(e&&(!i||i._end>e._dur||i._start<0))for(var r=e;r;)r._dirty=1,r=r.parent;return e},K$e=function(e){for(var i=e.parent;i&&i.parent;)i._dirty=1,i.totalDuration(),i=i.parent;return e},BU=function(e,i,r,n){return e._startAt&&(va?e._startAt.revert(MC):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(i,!0,n))},Q$e=function t(e){return!e||e._ts&&t(e.parent)},h$=function(e){return e._repeat?w1(e._tTime,e=e.duration()+e._rDelay)*e:0},w1=function(e,i){var r=Math.floor(e/=i);return e&&r===e?r-1:r},CP=function(e,i){return(e-i._start)*i._ts+(i._ts>=0?0:i._dirty?i.totalDuration():i._tDur)},ZD=function(e){return e._end=_s(e._start+(e._tDur/Math.abs(e._ts||e._rts||Sr)||0))},eR=function(e,i){var r=e._dp;return r&&r.smoothChildTiming&&e._ts&&(e._start=_s(r._time-(e._ts>0?i/e._ts:((e._dirty?e.totalDuration():e._tDur)-i)/-e._ts)),ZD(e),r._dirty||_g(r,e)),e},Ehe=function(e,i){var r;if((i._time||!i._dur&&i._initted||i._start<e._time&&(i._dur||!i.add))&&(r=CP(e.rawTime(),i),(!i._dur||z_(0,i.totalDuration(),r)-i._tTime>Sr)&&i.render(r,!0)),_g(e,i)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(r=e;r._dp;)r.rawTime()>=0&&r.totalTime(r._tTime),r=r._dp;e._zTime=-Sr}},_h=function(e,i,r,n){return i.parent&&wp(i),i._start=_s((xd(r)?r:r||e!==Vr?vl(e,r,i):e._time)+i._delay),i._end=_s(i._start+(i.totalDuration()/Math.abs(i.timeScale())||0)),Ahe(e,i,"_first","_last",e._sort?"_start":0),FU(i)||(e._recent=i),n||Ehe(e,i),e._ts<0&&eR(e,e._tTime),e},Mhe=function(e,i){return(qo.ScrollTrigger||cV("scrollTrigger",i))&&qo.ScrollTrigger.create(i,e)},The=function(e,i,r,n,s){if(pV(e,i,s),!e._initted)return 1;if(!r&&e._pt&&!va&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&xhe!==Bo.frame)return sp.push(e),e._lazy=[s,n],1},$$e=function t(e){var i=e.parent;return i&&i._ts&&i._initted&&!i._lock&&(i.rawTime()<0||t(i))},FU=function(e){var i=e.data;return i==="isFromStart"||i==="isStart"},J$e=function(e,i,r,n){var s=e.ratio,a=i<0||!i&&(!e._start&&$$e(e)&&!(!e._initted&&FU(e))||(e._ts<0||e._dp._ts<0)&&!FU(e))?0:1,o=e._rDelay,l=0,c,h,u;if(o&&e._repeat&&(l=z_(0,e._tDur,i),h=w1(l,o),e._yoyo&&h&1&&(a=1-a),h!==w1(e._tTime,o)&&(s=1-a,e.vars.repeatRefresh&&e._initted&&e.invalidate())),a!==s||va||n||e._zTime===Sr||!i&&e._zTime){if(!e._initted&&The(e,i,n,r,l))return;for(u=e._zTime,e._zTime=i||(r?Sr:0),r||(r=i&&!u),e.ratio=a,e._from&&(a=1-a),e._time=0,e._tTime=l,c=e._pt;c;)c.r(a,c.d),c=c._next;i<0&&BU(e,i,r,!0),e._onUpdate&&!r&&Uo(e,"onUpdate"),l&&e._repeat&&!r&&e.parent&&Uo(e,"onRepeat"),(i>=e._tDur||i<0)&&e.ratio===a&&(a&&wp(e,1),!r&&!va&&(Uo(e,a?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=i)},Z$e=function(e,i,r){var n;if(r>i)for(n=e._first;n&&n._start<=r;){if(n.data==="isPause"&&n._start>i)return n;n=n._next}else for(n=e._last;n&&n._start>=r;){if(n.data==="isPause"&&n._start<i)return n;n=n._prev}},S1=function(e,i,r,n){var s=e._repeat,a=_s(i)||0,o=e._tTime/e._tDur;return o&&!n&&(e._time*=a/e._dur),e._dur=a,e._tDur=s?s<0?1e10:_s(a*(s+1)+e._rDelay*s):a,o>0&&!n&&eR(e,e._tTime=e._tDur*o),e.parent&&ZD(e),r||_g(e.parent,e),e},u$=function(e){return e instanceof Na?_g(e):S1(e,e._dur)},eJe={_start:0,endTime:BS,totalDuration:BS},vl=function t(e,i,r){var n=e.labels,s=e._recent||eJe,a=e.duration()>=Bl?s.endTime(!1):e._dur,o,l,c;return Os(i)&&(isNaN(i)||i in n)?(l=i.charAt(0),c=i.substr(-1)==="%",o=i.indexOf("="),l==="<"||l===">"?(o>=0&&(i=i.replace(/=/,"")),(l==="<"?s._start:s.endTime(s._repeat>=0))+(parseFloat(i.substr(1))||0)*(c?(o<0?s:r).totalDuration()/100:1)):o<0?(i in n||(n[i]=a),n[i]):(l=parseFloat(i.charAt(o-1)+i.substr(o+1)),c&&r&&(l=l/100*(ya(r)?r[0]:r).totalDuration()),o>1?t(e,i.substr(0,o-1),r)+l:a+l)):i==null?a:+i},Mw=function(e,i,r){var n=xd(i[1]),s=(n?2:1)+(e<2?0:1),a=i[s],o,l;if(n&&(a.duration=i[1]),a.parent=r,e){for(o=a,l=r;l&&!("immediateRender"in o);)o=l.vars.defaults||{},l=vo(l.vars.inherit)&&l.parent;a.immediateRender=vo(o.immediateRender),e<2?a.runBackwards=1:a.startAt=i[s-1]}return new Rn(i[0],a,i[s+1])},Fp=function(e,i){return e||e===0?i(e):i},z_=function(e,i,r){return r<e?e:r>i?i:r},fa=function(e,i){return!Os(e)||!(i=H$e.exec(e))?"":i[1]},tJe=function(e,i,r){return Fp(r,function(n){return z_(e,i,n)})},kU=[].slice,Che=function(e,i){return e&&Xh(e)&&"length"in e&&(!i&&!e.length||e.length-1 in e&&Xh(e[0]))&&!e.nodeType&&e!==mh},iJe=function(e,i,r){return r===void 0&&(r=[]),e.forEach(function(n){var s;return Os(n)&&!i||Che(n,1)?(s=r).push.apply(s,Fl(n)):r.push(n)})||r},Fl=function(e,i,r){return Br&&!i&&Br.selector?Br.selector(e):Os(e)&&!r&&(LU||!_1())?kU.call((i||lV).querySelectorAll(e),0):ya(e)?iJe(e,r):Che(e)?kU.call(e,0):e?[e]:[]},NU=function(e){return e=Fl(e)[0]||OS("Invalid scope")||{},function(i){var r=e.current||e.nativeElement||e;return Fl(i,r.querySelectorAll?r:r===e?OS("Invalid scope")||lV.createElement("div"):e)}},Phe=function(e){return e.sort(function(){return .5-Math.random()})},Dhe=function(e){if(ln(e))return e;var i=Xh(e)?e:{each:e},r=Ag(i.ease),n=i.from||0,s=parseFloat(i.base)||0,a={},o=n>0&&n<1,l=isNaN(n)||o,c=i.axis,h=n,u=n;return Os(n)?h=u={center:.5,edges:.5,end:1}[n]||0:!o&&l&&(h=n[0],u=n[1]),function(d,f,p){var m=(p||i).length,g=a[m],v,y,x,S,A,_,M,E,T;if(!g){if(T=i.grid==="auto"?0:(i.grid||[1,Bl])[1],!T){for(M=-Bl;M<(M=p[T++].getBoundingClientRect().left)&&T<m;);T<m&&T--}for(g=a[m]=[],v=l?Math.min(T,m)*h-.5:n%T,y=T===Bl?0:l?m*u/T-.5:n/T|0,M=0,E=Bl,_=0;_<m;_++)x=_%T-v,S=y-(_/T|0),g[_]=A=c?Math.abs(c==="y"?S:x):uhe(x*x+S*S),A>M&&(M=A),A<E&&(E=A);n==="random"&&Phe(g),g.max=M-E,g.min=E,g.v=m=(parseFloat(i.amount)||parseFloat(i.each)*(T>m?m-1:c?c==="y"?m/T:T:Math.max(T,m/T))||0)*(n==="edges"?-1:1),g.b=m<0?s-m:s,g.u=fa(i.amount||i.each)||0,r=r&&m<0?zhe(r):r}return m=(g[d]-g.min)/g.max||0,_s(g.b+(r?r(m):m)*g.v)+g.u}},UU=function(e){var i=Math.pow(10,((e+"").split(".")[1]||"").length);return function(r){var n=_s(Math.round(parseFloat(r)/e)*e*i);return(n-n%1)/i+(xd(r)?0:fa(r))}},Rhe=function(e,i){var r=ya(e),n,s;return!r&&Xh(e)&&(n=r=e.radius||Bl,e.values?(e=Fl(e.values),(s=!xd(e[0]))&&(n*=n)):e=UU(e.increment)),Fp(i,r?ln(e)?function(a){return s=e(a),Math.abs(s-a)<=n?s:a}:function(a){for(var o=parseFloat(s?a.x:a),l=parseFloat(s?a.y:0),c=Bl,h=0,u=e.length,d,f;u--;)s?(d=e[u].x-o,f=e[u].y-l,d=d*d+f*f):d=Math.abs(e[u]-o),d<c&&(c=d,h=u);return h=!n||c<=n?e[h]:a,s||h===a||xd(a)?h:h+fa(a)}:UU(e))},Ihe=function(e,i,r,n){return Fp(ya(e)?!i:r===!0?!!(r=0):!n,function(){return ya(e)?e[~~(Math.random()*e.length)]:(r=r||1e-5)&&(n=r<1?Math.pow(10,(r+"").length-2):1)&&Math.floor(Math.round((e-r/2+Math.random()*(i-e+r*.99))/r)*r*n)/n})},rJe=function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return function(n){return i.reduce(function(s,a){return a(s)},n)}},nJe=function(e,i){return function(r){return e(parseFloat(r))+(i||fa(r))}},sJe=function(e,i,r){return Ohe(e,i,0,1,r)},Lhe=function(e,i,r){return Fp(r,function(n){return e[~~i(n)]})},aJe=function t(e,i,r){var n=i-e;return ya(e)?Lhe(e,t(0,e.length),i):Fp(r,function(s){return(n+(s-e)%n)%n+e})},oJe=function t(e,i,r){var n=i-e,s=n*2;return ya(e)?Lhe(e,t(0,e.length-1),i):Fp(r,function(a){return a=(s+(a-e)%s)%s||0,e+(a>n?s-a:a)})},FS=function(e){for(var i=0,r="",n,s,a,o;~(n=e.indexOf("random(",i));)a=e.indexOf(")",n),o=e.charAt(n+7)==="[",s=e.substr(n+7,a-n-7).match(o?mhe:IU),r+=e.substr(i,n-i)+Ihe(o?s:+s[0],o?0:+s[1],+s[2]||1e-5),i=a+1;return r+e.substr(i,e.length-i)},Ohe=function(e,i,r,n,s){var a=i-e,o=n-r;return Fp(s,function(l){return r+((l-e)/a*o||0)})},lJe=function t(e,i,r,n){var s=isNaN(e+i)?0:function(f){return(1-f)*e+f*i};if(!s){var a=Os(e),o={},l,c,h,u,d;if(r===!0&&(n=1)&&(r=null),a)e={p:e},i={p:i};else if(ya(e)&&!ya(i)){for(h=[],u=e.length,d=u-2,c=1;c<u;c++)h.push(t(e[c-1],e[c]));u--,s=function(p){p*=u;var m=Math.min(d,~~p);return h[m](p-m)},r=i}else n||(e=Kg(ya(e)?[]:{},e));if(!h){for(l in i)fV.call(o,e,l,"get",i[l]);s=function(p){return vV(p,o)||(a?e.p:e)}}}return Fp(r,s)},d$=function(e,i,r){var n=e.labels,s=Bl,a,o,l;for(a in n)o=n[a]-i,o<0==!!r&&o&&s>(o=Math.abs(o))&&(l=a,s=o);return l},Uo=function(e,i,r){var n=e.vars,s=n[i],a=Br,o=e._ctx,l,c,h;if(s)return l=n[i+"Params"],c=n.callbackScope||e,r&&sp.length&&MP(),o&&(Br=o),h=l?s.apply(c,l):s.call(c),Br=a,h},Hb=function(e){return wp(e),e.scrollTrigger&&e.scrollTrigger.kill(!!va),e.progress()<1&&Uo(e,"onInterrupt"),e},hy,Bhe=[],Fhe=function(e){if(e)if(e=!e.name&&e.default||e,oV()||e.headless){var i=e.name,r=ln(e),n=i&&!r&&e.init?function(){this._props=[]}:e,s={init:BS,render:vV,add:fV,kill:AJe,modifier:_Je,rawVars:0},a={targetTest:0,get:0,getSetter:gV,aliases:{},register:0};if(_1(),e!==n){if(Oo[i])return;Yl(n,Yl(TP(e,s),a)),Kg(n.prototype,Kg(s,TP(e,a))),Oo[n.prop=i]=n,e.targetTest&&(TC.push(n),hV[i]=1),i=(i==="css"?"CSS":i.charAt(0).toUpperCase()+i.substr(1))+"Plugin"}yhe(i,n),e.register&&e.register(So,n,xo)}else Bhe.push(e)},fr=255,jb={aqua:[0,fr,fr],lime:[0,fr,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,fr],navy:[0,0,128],white:[fr,fr,fr],olive:[128,128,0],yellow:[fr,fr,0],orange:[fr,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[fr,0,0],pink:[fr,192,203],cyan:[0,fr,fr],transparent:[fr,fr,fr,0]},cB=function(e,i,r){return e+=e<0?1:e>1?-1:0,(e*6<1?i+(r-i)*e*6:e<.5?r:e*3<2?i+(r-i)*(2/3-e)*6:i)*fr+.5|0},khe=function(e,i,r){var n=e?xd(e)?[e>>16,e>>8&fr,e&fr]:0:jb.black,s,a,o,l,c,h,u,d,f,p;if(!n){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),jb[e])n=jb[e];else if(e.charAt(0)==="#"){if(e.length<6&&(s=e.charAt(1),a=e.charAt(2),o=e.charAt(3),e="#"+s+s+a+a+o+o+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return n=parseInt(e.substr(1,6),16),[n>>16,n>>8&fr,n&fr,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),n=[e>>16,e>>8&fr,e&fr]}else if(e.substr(0,3)==="hsl"){if(n=p=e.match(IU),!i)l=+n[0]%360/360,c=+n[1]/100,h=+n[2]/100,a=h<=.5?h*(c+1):h+c-h*c,s=h*2-a,n.length>3&&(n[3]*=1),n[0]=cB(l+1/3,s,a),n[1]=cB(l,s,a),n[2]=cB(l-1/3,s,a);else if(~e.indexOf("="))return n=e.match(fhe),r&&n.length<4&&(n[3]=1),n}else n=e.match(IU)||jb.transparent;n=n.map(Number)}return i&&!p&&(s=n[0]/fr,a=n[1]/fr,o=n[2]/fr,u=Math.max(s,a,o),d=Math.min(s,a,o),h=(u+d)/2,u===d?l=c=0:(f=u-d,c=h>.5?f/(2-u-d):f/(u+d),l=u===s?(a-o)/f+(a<o?6:0):u===a?(o-s)/f+2:(s-a)/f+4,l*=60),n[0]=~~(l+.5),n[1]=~~(c*100+.5),n[2]=~~(h*100+.5)),r&&n.length<4&&(n[3]=1),n},Nhe=function(e){var i=[],r=[],n=-1;return e.split(ap).forEach(function(s){var a=s.match(cy)||[];i.push.apply(i,a),r.push(n+=a.length+1)}),i.c=r,i},f$=function(e,i,r){var n="",s=(e+n).match(ap),a=i?"hsla(":"rgba(",o=0,l,c,h,u;if(!s)return e;if(s=s.map(function(d){return(d=khe(d,i,1))&&a+(i?d[0]+","+d[1]+"%,"+d[2]+"%,"+d[3]:d.join(","))+")"}),r&&(h=Nhe(e),l=r.c,l.join(n)!==h.c.join(n)))for(c=e.replace(ap,"1").split(cy),u=c.length-1;o<u;o++)n+=c[o]+(~l.indexOf(o)?s.shift()||a+"0,0,0,0)":(h.length?h:s.length?s:r).shift());if(!c)for(c=e.split(ap),u=c.length-1;o<u;o++)n+=c[o]+s[o];return n+c[u]},ap=function(){var t="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in jb)t+="|"+e+"\\b";return new RegExp(t+")","gi")}(),cJe=/hsl[a]?\(/,Uhe=function(e){var i=e.join(" "),r;if(ap.lastIndex=0,ap.test(i))return r=cJe.test(i),e[1]=f$(e[1],r),e[0]=f$(e[0],r,Nhe(e[1])),!0},kS,Bo=function(){var t=Date.now,e=500,i=33,r=t(),n=r,s=1e3/240,a=s,o=[],l,c,h,u,d,f,p=function m(g){var v=t()-n,y=g===!0,x,S,A,_;if((v>e||v<0)&&(r+=v-i),n+=v,A=n-r,x=A-a,(x>0||y)&&(_=++u.frame,d=A-u.time*1e3,u.time=A=A/1e3,a+=x+(x>=s?4:s-x),S=1),y||(l=c(m)),S)for(f=0;f<o.length;f++)o[f](A,d,_,g)};return u={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(g){return d/(1e3/(g||60))},wake:function(){ghe&&(!LU&&oV()&&(mh=LU=window,lV=mh.document||{},qo.gsap=So,(mh.gsapVersions||(mh.gsapVersions=[])).push(So.version),vhe(EP||mh.GreenSockGlobals||!mh.gsap&&mh||{}),Bhe.forEach(Fhe)),h=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&u.sleep(),c=h||function(g){return setTimeout(g,a-u.time*1e3+1|0)},kS=1,p(2))},sleep:function(){(h?cancelAnimationFrame:clearTimeout)(l),kS=0,c=BS},lagSmoothing:function(g,v){e=g||1/0,i=Math.min(v||33,e)},fps:function(g){s=1e3/(g||240),a=u.time*1e3+s},add:function(g,v,y){var x=v?function(S,A,_,M){g(S,A,_,M),u.remove(x)}:g;return u.remove(g),o[y?"unshift":"push"](x),_1(),x},remove:function(g,v){~(v=o.indexOf(g))&&o.splice(v,1)&&f>=v&&f--},_listeners:o},u}(),_1=function(){return!kS&&Bo.wake()},Oi={},hJe=/^[\d.\-M][\d.\-,\s]/,uJe=/["']/g,dJe=function(e){for(var i={},r=e.substr(1,e.length-3).split(":"),n=r[0],s=1,a=r.length,o,l,c;s<a;s++)l=r[s],o=s!==a-1?l.lastIndexOf(","):l.length,c=l.substr(0,o),i[n]=isNaN(c)?c.replace(uJe,"").trim():+c,n=l.substr(o+1).trim();return i},fJe=function(e){var i=e.indexOf("(")+1,r=e.indexOf(")"),n=e.indexOf("(",i);return e.substring(i,~n&&n<r?e.indexOf(")",r+1):r)},pJe=function(e){var i=(e+"").split("("),r=Oi[i[0]];return r&&i.length>1&&r.config?r.config.apply(null,~e.indexOf("{")?[dJe(i[1])]:fJe(e).split(",").map(She)):Oi._CE&&hJe.test(e)?Oi._CE("",e):r},zhe=function(e){return function(i){return 1-e(1-i)}},Ghe=function t(e,i){for(var r=e._first,n;r;)r instanceof Na?t(r,i):r.vars.yoyoEase&&(!r._yoyo||!r._repeat)&&r._yoyo!==i&&(r.timeline?t(r.timeline,i):(n=r._ease,r._ease=r._yEase,r._yEase=n,r._yoyo=i)),r=r._next},Ag=function(e,i){return e&&(ln(e)?e:Oi[e]||pJe(e))||i},c0=function(e,i,r,n){r===void 0&&(r=function(l){return 1-i(1-l)}),n===void 0&&(n=function(l){return l<.5?i(l*2)/2:1-i((1-l)*2)/2});var s={easeIn:i,easeOut:r,easeInOut:n},a;return yo(e,function(o){Oi[o]=qo[o]=s,Oi[a=o.toLowerCase()]=r;for(var l in s)Oi[a+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=Oi[o+"."+l]=s[l]}),s},Vhe=function(e){return function(i){return i<.5?(1-e(1-i*2))/2:.5+e((i-.5)*2)/2}},hB=function t(e,i,r){var n=i>=1?i:1,s=(r||(e?.3:.45))/(i<1?i:1),a=s/RU*(Math.asin(1/n)||0),o=function(h){return h===1?1:n*Math.pow(2,-10*h)*V$e((h-a)*s)+1},l=e==="out"?o:e==="in"?function(c){return 1-o(1-c)}:Vhe(o);return s=RU/s,l.config=function(c,h){return t(e,c,h)},l},uB=function t(e,i){i===void 0&&(i=1.70158);var r=function(a){return a?--a*a*((i+1)*a+i)+1:0},n=e==="out"?r:e==="in"?function(s){return 1-r(1-s)}:Vhe(r);return n.config=function(s){return t(e,s)},n};yo("Linear,Quad,Cubic,Quart,Quint,Strong",function(t,e){var i=e<5?e+1:e;c0(t+",Power"+(i-1),e?function(r){return Math.pow(r,i)}:function(r){return r},function(r){return 1-Math.pow(1-r,i)},function(r){return r<.5?Math.pow(r*2,i)/2:1-Math.pow((1-r)*2,i)/2})});Oi.Linear.easeNone=Oi.none=Oi.Linear.easeIn;c0("Elastic",hB("in"),hB("out"),hB());(function(t,e){var i=1/e,r=2*i,n=2.5*i,s=function(o){return o<i?t*o*o:o<r?t*Math.pow(o-1.5/e,2)+.75:o<n?t*(o-=2.25/e)*o+.9375:t*Math.pow(o-2.625/e,2)+.984375};c0("Bounce",function(a){return 1-s(1-a)},s)})(7.5625,2.75);c0("Expo",function(t){return t?Math.pow(2,10*(t-1)):0});c0("Circ",function(t){return-(uhe(1-t*t)-1)});c0("Sine",function(t){return t===1?1:-G$e(t*U$e)+1});c0("Back",uB("in"),uB("out"),uB());Oi.SteppedEase=Oi.steps=qo.SteppedEase={config:function(e,i){e===void 0&&(e=1);var r=1/e,n=e+(i?0:1),s=i?1:0,a=1-Sr;return function(o){return((n*z_(0,a,o)|0)+s)*r}}};b1.ease=Oi["quad.out"];yo("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(t){return uV+=t+","+t+"Params,"});var Hhe=function(e,i){this.id=z$e++,e._gsap=this,this.target=e,this.harness=i,this.get=i?i.get:bhe,this.set=i?i.getSetter:gV},NS=function(){function t(i){this.vars=i,this._delay=+i.delay||0,(this._repeat=i.repeat===1/0?-2:i.repeat||0)&&(this._rDelay=i.repeatDelay||0,this._yoyo=!!i.yoyo||!!i.yoyoEase),this._ts=1,S1(this,+i.duration,1,1),this.data=i.data,Br&&(this._ctx=Br,Br.data.push(this)),kS||Bo.wake()}var e=t.prototype;return e.delay=function(r){return r||r===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+r-this._delay),this._delay=r,this):this._delay},e.duration=function(r){return arguments.length?this.totalDuration(this._repeat>0?r+(r+this._rDelay)*this._repeat:r):this.totalDuration()&&this._dur},e.totalDuration=function(r){return arguments.length?(this._dirty=0,S1(this,this._repeat<0?r:(r-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(r,n){if(_1(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(eR(this,r),!s._dp||s.parent||Ehe(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&r<this._tDur||this._ts<0&&r>0||!this._tDur&&!r)&&_h(this._dp,this,this._start-this._delay)}return(this._tTime!==r||!this._dur&&!n||this._initted&&Math.abs(this._zTime)===Sr||!r&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=r),whe(this,r,n)),this},e.time=function(r,n){return arguments.length?this.totalTime(Math.min(this.totalDuration(),r+h$(this))%(this._dur+this._rDelay)||(r?this._dur:0),n):this._time},e.totalProgress=function(r,n){return arguments.length?this.totalTime(this.totalDuration()*r,n):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(r,n){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-r:r)+h$(this),n):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(r,n){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(r-1)*s,n):this._repeat?w1(this._tTime,s)+1:1},e.timeScale=function(r,n){if(!arguments.length)return this._rts===-Sr?0:this._rts;if(this._rts===r)return this;var s=this.parent&&this._ts?CP(this.parent._time,this):this._tTime;return this._rts=+r||0,this._ts=this._ps||r===-Sr?0:this._rts,this.totalTime(z_(-Math.abs(this._delay),this._tDur,s),n!==!1),ZD(this),K$e(this)},e.paused=function(r){return arguments.length?(this._ps!==r&&(this._ps=r,r?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(_1(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Sr&&(this._tTime-=Sr)))),this):this._ps},e.startTime=function(r){if(arguments.length){this._start=r;var n=this.parent||this._dp;return n&&(n._sort||!this.parent)&&_h(n,this,r-this._delay),this}return this._start},e.endTime=function(r){return this._start+(vo(r)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(r){var n=this.parent||this._dp;return n?r&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?CP(n.rawTime(r),this):this._tTime:this._tTime},e.revert=function(r){r===void 0&&(r=W$e);var n=va;return va=r,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(r),this.totalTime(-.01,r.suppressEvents)),this.data!=="nested"&&r.kill!==!1&&this.kill(),va=n,this},e.globalTime=function(r){for(var n=this,s=arguments.length?r:n.rawTime();n;)s=n._start+s/(Math.abs(n._ts)||1),n=n._dp;return!this.parent&&this._sat?this._sat.globalTime(r):s},e.repeat=function(r){return arguments.length?(this._repeat=r===1/0?-2:r,u$(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(r){if(arguments.length){var n=this._time;return this._rDelay=r,u$(this),n?this.time(n):this}return this._rDelay},e.yoyo=function(r){return arguments.length?(this._yoyo=r,this):this._yoyo},e.seek=function(r,n){return this.totalTime(vl(this,r),vo(n))},e.restart=function(r,n){return this.play().totalTime(r?-this._delay:0,vo(n))},e.play=function(r,n){return r!=null&&this.seek(r,n),this.reversed(!1).paused(!1)},e.reverse=function(r,n){return r!=null&&this.seek(r||this.totalDuration(),n),this.reversed(!0).paused(!1)},e.pause=function(r,n){return r!=null&&this.seek(r,n),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(r){return arguments.length?(!!r!==this.reversed()&&this.timeScale(-this._rts||(r?-Sr:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-Sr,this},e.isActive=function(){var r=this.parent||this._dp,n=this._start,s;return!!(!r||this._ts&&this._initted&&r.isActive()&&(s=r.rawTime(!0))>=n&&s<this.endTime(!0)-Sr)},e.eventCallback=function(r,n,s){var a=this.vars;return arguments.length>1?(n?(a[r]=n,s&&(a[r+"Params"]=s),r==="onUpdate"&&(this._onUpdate=n)):delete a[r],this):a[r]},e.then=function(r){var n=this;return new Promise(function(s){var a=ln(r)?r:_he,o=function(){var c=n.then;n.then=null,ln(a)&&(a=a(n))&&(a.then||a===n)&&(n.then=c),s(a),n.then=c};n._initted&&n.totalProgress()===1&&n._ts>=0||!n._tTime&&n._ts<0?o():n._prom=o})},e.kill=function(){Hb(this)},t}();Yl(NS.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Sr,_prom:0,_ps:!1,_rts:1});var Na=function(t){hhe(e,t);function e(r,n){var s;return r===void 0&&(r={}),s=t.call(this,r)||this,s.labels={},s.smoothChildTiming=!!r.smoothChildTiming,s.autoRemoveChildren=!!r.autoRemoveChildren,s._sort=vo(r.sortChildren),Vr&&_h(r.parent||Vr,Iu(s),n),r.reversed&&s.reverse(),r.paused&&s.paused(!0),r.scrollTrigger&&Mhe(Iu(s),r.scrollTrigger),s}var i=e.prototype;return i.to=function(n,s,a){return Mw(0,arguments,this),this},i.from=function(n,s,a){return Mw(1,arguments,this),this},i.fromTo=function(n,s,a,o){return Mw(2,arguments,this),this},i.set=function(n,s,a){return s.duration=0,s.parent=this,Ew(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new Rn(n,s,vl(this,a),1),this},i.call=function(n,s,a){return _h(this,Rn.delayedCall(0,n,s),a)},i.staggerTo=function(n,s,a,o,l,c,h){return a.duration=s,a.stagger=a.stagger||o,a.onComplete=c,a.onCompleteParams=h,a.parent=this,new Rn(n,a,vl(this,l)),this},i.staggerFrom=function(n,s,a,o,l,c,h){return a.runBackwards=1,Ew(a).immediateRender=vo(a.immediateRender),this.staggerTo(n,s,a,o,l,c,h)},i.staggerFromTo=function(n,s,a,o,l,c,h,u){return o.startAt=a,Ew(o).immediateRender=vo(o.immediateRender),this.staggerTo(n,s,o,l,c,h,u)},i.render=function(n,s,a){var o=this._time,l=this._dirty?this.totalDuration():this._tDur,c=this._dur,h=n<=0?0:_s(n),u=this._zTime<0!=n<0&&(this._initted||!c),d,f,p,m,g,v,y,x,S,A,_,M;if(this!==Vr&&h>l&&n>=0&&(h=l),h!==this._tTime||a||u){if(o!==this._time&&c&&(h+=this._time-o,n+=this._time-o),d=h,S=this._start,x=this._ts,v=!x,u&&(c||(o=this._zTime),(n||!s)&&(this._zTime=n)),this._repeat){if(_=this._yoyo,g=c+this._rDelay,this._repeat<-1&&n<0)return this.totalTime(g*100+n,s,a);if(d=_s(h%g),h===l?(m=this._repeat,d=c):(m=~~(h/g),m&&m===h/g&&(d=c,m--),d>c&&(d=c)),A=w1(this._tTime,g),!o&&this._tTime&&A!==m&&this._tTime-A*g-this._dur<=0&&(A=m),_&&m&1&&(d=c-d,M=1),m!==A&&!this._lock){var E=_&&A&1,T=E===(_&&m&1);if(m<A&&(E=!E),o=E?0:h%c?c:h,this._lock=1,this.render(o||(M?0:_s(m*g)),s,!c)._lock=0,this._tTime=h,!s&&this.parent&&Uo(this,"onRepeat"),this.vars.repeatRefresh&&!M&&(this.invalidate()._lock=1),o&&o!==this._time||v!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(c=this._dur,l=this._tDur,T&&(this._lock=2,o=E?c:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!M&&this.invalidate()),this._lock=0,!this._ts&&!v)return this;Ghe(this,M)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(y=Z$e(this,_s(o),_s(d)),y&&(h-=d-(d=y._start))),this._tTime=h,this._time=d,this._act=!x,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=n,o=0),!o&&d&&!s&&!m&&(Uo(this,"onStart"),this._tTime!==h))return this;if(d>=o&&n>=0)for(f=this._first;f;){if(p=f._next,(f._act||d>=f._start)&&f._ts&&y!==f){if(f.parent!==this)return this.render(n,s,a);if(f.render(f._ts>0?(d-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(d-f._start)*f._ts,s,a),d!==this._time||!this._ts&&!v){y=0,p&&(h+=this._zTime=-Sr);break}}f=p}else{f=this._last;for(var C=n<0?n:d;f;){if(p=f._prev,(f._act||C<=f._end)&&f._ts&&y!==f){if(f.parent!==this)return this.render(n,s,a);if(f.render(f._ts>0?(C-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(C-f._start)*f._ts,s,a||va&&(f._initted||f._startAt)),d!==this._time||!this._ts&&!v){y=0,p&&(h+=this._zTime=C?-Sr:Sr);break}}f=p}}if(y&&!s&&(this.pause(),y.render(d>=o?0:-Sr)._zTime=d>=o?1:-1,this._ts))return this._start=S,ZD(this),this.render(n,s,a);this._onUpdate&&!s&&Uo(this,"onUpdate",!0),(h===l&&this._tTime>=this.totalDuration()||!h&&o)&&(S===this._start||Math.abs(x)!==Math.abs(this._ts))&&(this._lock||((n||!c)&&(h===l&&this._ts>0||!h&&this._ts<0)&&wp(this,1),!s&&!(n<0&&!o)&&(h||o||!l)&&(Uo(this,h===l&&n>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(h<l&&this.timeScale()>0)&&this._prom())))}return this},i.add=function(n,s){var a=this;if(xd(s)||(s=vl(this,s,n)),!(n instanceof NS)){if(ya(n))return n.forEach(function(o){return a.add(o,s)}),this;if(Os(n))return this.addLabel(n,s);if(ln(n))n=Rn.delayedCall(0,n);else return this}return this!==n?_h(this,n,s):this},i.getChildren=function(n,s,a,o){n===void 0&&(n=!0),s===void 0&&(s=!0),a===void 0&&(a=!0),o===void 0&&(o=-Bl);for(var l=[],c=this._first;c;)c._start>=o&&(c instanceof Rn?s&&l.push(c):(a&&l.push(c),n&&l.push.apply(l,c.getChildren(!0,s,a)))),c=c._next;return l},i.getById=function(n){for(var s=this.getChildren(1,1,1),a=s.length;a--;)if(s[a].vars.id===n)return s[a]},i.remove=function(n){return Os(n)?this.removeLabel(n):ln(n)?this.killTweensOf(n):(JD(this,n),n===this._recent&&(this._recent=this._last),_g(this))},i.totalTime=function(n,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=_s(Bo.time-(this._ts>0?n/this._ts:(this.totalDuration()-n)/-this._ts))),t.prototype.totalTime.call(this,n,s),this._forcing=0,this):this._tTime},i.addLabel=function(n,s){return this.labels[n]=vl(this,s),this},i.removeLabel=function(n){return delete this.labels[n],this},i.addPause=function(n,s,a){var o=Rn.delayedCall(0,s||BS,a);return o.data="isPause",this._hasPause=1,_h(this,o,vl(this,n))},i.removePause=function(n){var s=this._first;for(n=vl(this,n);s;)s._start===n&&s.data==="isPause"&&wp(s),s=s._next},i.killTweensOf=function(n,s,a){for(var o=this.getTweensOf(n,a),l=o.length;l--;)Gf!==o[l]&&o[l].kill(n,s);return this},i.getTweensOf=function(n,s){for(var a=[],o=Fl(n),l=this._first,c=xd(s),h;l;)l instanceof Rn?X$e(l._targets,o)&&(c?(!Gf||l._initted&&l._ts)&&l.globalTime(0)<=s&&l.globalTime(l.totalDuration())>s:!s||l.isActive())&&a.push(l):(h=l.getTweensOf(o,s)).length&&a.push.apply(a,h),l=l._next;return a},i.tweenTo=function(n,s){s=s||{};var a=this,o=vl(a,n),l=s,c=l.startAt,h=l.onStart,u=l.onStartParams,d=l.immediateRender,f,p=Rn.to(a,Yl({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:s.duration||Math.abs((o-(c&&"time"in c?c.time:a._time))/a.timeScale())||Sr,onStart:function(){if(a.pause(),!f){var g=s.duration||Math.abs((o-(c&&"time"in c?c.time:a._time))/a.timeScale());p._dur!==g&&S1(p,g,0,1).render(p._time,!0,!0),f=1}h&&h.apply(p,u||[])}},s));return d?p.render(0):p},i.tweenFromTo=function(n,s,a){return this.tweenTo(s,Yl({startAt:{time:vl(this,n)}},a))},i.recent=function(){return this._recent},i.nextLabel=function(n){return n===void 0&&(n=this._time),d$(this,vl(this,n))},i.previousLabel=function(n){return n===void 0&&(n=this._time),d$(this,vl(this,n),1)},i.currentLabel=function(n){return arguments.length?this.seek(n,!0):this.previousLabel(this._time+Sr)},i.shiftChildren=function(n,s,a){a===void 0&&(a=0);for(var o=this._first,l=this.labels,c;o;)o._start>=a&&(o._start+=n,o._end+=n),o=o._next;if(s)for(c in l)l[c]>=a&&(l[c]+=n);return _g(this)},i.invalidate=function(n){var s=this._first;for(this._lock=0;s;)s.invalidate(n),s=s._next;return t.prototype.invalidate.call(this,n)},i.clear=function(n){n===void 0&&(n=!0);for(var s=this._first,a;s;)a=s._next,this.remove(s),s=a;return this._dp&&(this._time=this._tTime=this._pTime=0),n&&(this.labels={}),_g(this)},i.totalDuration=function(n){var s=0,a=this,o=a._last,l=Bl,c,h,u;if(arguments.length)return a.timeScale((a._repeat<0?a.duration():a.totalDuration())/(a.reversed()?-n:n));if(a._dirty){for(u=a.parent;o;)c=o._prev,o._dirty&&o.totalDuration(),h=o._start,h>l&&a._sort&&o._ts&&!a._lock?(a._lock=1,_h(a,o,h-o._delay,1)._lock=0):l=h,h<0&&o._ts&&(s-=h,(!u&&!a._dp||u&&u.smoothChildTiming)&&(a._start+=h/a._ts,a._time-=h,a._tTime-=h),a.shiftChildren(-h,!1,-1/0),l=0),o._end>s&&o._ts&&(s=o._end),o=c;S1(a,a===Vr&&a._time>s?a._time:s,1,1),a._dirty=0}return a._tDur},e.updateRoot=function(n){if(Vr._ts&&(whe(Vr,CP(n,Vr)),xhe=Bo.frame),Bo.frame>=l$){l$+=Ho.autoSleep||120;var s=Vr._first;if((!s||!s._ts)&&Ho.autoSleep&&Bo._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||Bo.sleep()}}},e}(NS);Yl(Na.prototype,{_lock:0,_hasPause:0,_forcing:0});var mJe=function(e,i,r,n,s,a,o){var l=new xo(this._pt,e,i,0,1,Khe,null,s),c=0,h=0,u,d,f,p,m,g,v,y;for(l.b=r,l.e=n,r+="",n+="",(v=~n.indexOf("random("))&&(n=FS(n)),a&&(y=[r,n],a(y,e,i),r=y[0],n=y[1]),d=r.match(oB)||[];u=oB.exec(n);)p=u[0],m=n.substring(c,u.index),f?f=(f+1)%5:m.substr(-5)==="rgba("&&(f=1),p!==d[h++]&&(g=parseFloat(d[h-1])||0,l._pt={_next:l._pt,p:m||h===1?m:",",s:g,c:p.charAt(1)==="="?Uy(g,p)-g:parseFloat(p)-g,m:f&&f<4?Math.round:0},c=oB.lastIndex);return l.c=c<n.length?n.substring(c,n.length):"",l.fp=o,(phe.test(n)||v)&&(l.e=0),this._pt=l,l},fV=function(e,i,r,n,s,a,o,l,c,h){ln(n)&&(n=n(s||0,e,a));var u=e[i],d=r!=="get"?r:ln(u)?c?e[i.indexOf("set")||!ln(e["get"+i.substr(3)])?i:"get"+i.substr(3)](c):e[i]():u,f=ln(u)?c?bJe:Yhe:mV,p;if(Os(n)&&(~n.indexOf("random(")&&(n=FS(n)),n.charAt(1)==="="&&(p=Uy(d,n)+(fa(d)||0),(p||p===0)&&(n=p))),!h||d!==n||zU)return!isNaN(d*n)&&n!==""?(p=new xo(this._pt,e,i,+d||0,n-(d||0),typeof u=="boolean"?SJe:qhe,0,f),c&&(p.fp=c),o&&p.modifier(o,this,e),this._pt=p):(!u&&!(i in e)&&cV(i,n),mJe.call(this,e,i,d,n,f,l||Ho.stringFilter,c))},gJe=function(e,i,r,n,s){if(ln(e)&&(e=Tw(e,s,i,r,n)),!Xh(e)||e.style&&e.nodeType||ya(e)||dhe(e))return Os(e)?Tw(e,s,i,r,n):e;var a={},o;for(o in e)a[o]=Tw(e[o],s,i,r,n);return a},jhe=function(e,i,r,n,s,a){var o,l,c,h;if(Oo[e]&&(o=new Oo[e]).init(s,o.rawVars?i[e]:gJe(i[e],n,s,a,r),r,n,a)!==!1&&(r._pt=l=new xo(r._pt,s,e,0,1,o.render,o,0,o.priority),r!==hy))for(c=r._ptLookup[r._targets.indexOf(s)],h=o._props.length;h--;)c[o._props[h]]=l;return o},Gf,zU,pV=function t(e,i,r){var n=e.vars,s=n.ease,a=n.startAt,o=n.immediateRender,l=n.lazy,c=n.onUpdate,h=n.runBackwards,u=n.yoyoEase,d=n.keyframes,f=n.autoRevert,p=e._dur,m=e._startAt,g=e._targets,v=e.parent,y=v&&v.data==="nested"?v.vars.targets:g,x=e._overwrite==="auto"&&!sV,S=e.timeline,A,_,M,E,T,C,D,B,O,L,H,q,W;if(S&&(!d||!s)&&(s="none"),e._ease=Ag(s,b1.ease),e._yEase=u?zhe(Ag(u===!0?s:u,b1.ease)):0,u&&e._yoyo&&!e._repeat&&(u=e._yEase,e._yEase=e._ease,e._ease=u),e._from=!S&&!!n.runBackwards,!S||d&&!n.stagger){if(B=g[0]?Sg(g[0]).harness:0,q=B&&n[B.prop],A=TP(n,hV),m&&(m._zTime<0&&m.progress(1),i<0&&h&&o&&!f?m.render(-1,!0):m.revert(h&&p?MC:j$e),m._lazy=0),a){if(wp(e._startAt=Rn.set(g,Yl({data:"isStart",overwrite:!1,parent:v,immediateRender:!0,lazy:!m&&vo(l),startAt:null,delay:0,onUpdate:c&&function(){return Uo(e,"onUpdate")},stagger:0},a))),e._startAt._dp=0,e._startAt._sat=e,i<0&&(va||!o&&!f)&&e._startAt.revert(MC),o&&p&&i<=0&&r<=0){i&&(e._zTime=i);return}}else if(h&&p&&!m){if(i&&(o=!1),M=Yl({overwrite:!1,data:"isFromStart",lazy:o&&!m&&vo(l),immediateRender:o,stagger:0,parent:v},A),q&&(M[B.prop]=q),wp(e._startAt=Rn.set(g,M)),e._startAt._dp=0,e._startAt._sat=e,i<0&&(va?e._startAt.revert(MC):e._startAt.render(-1,!0)),e._zTime=i,!o)t(e._startAt,Sr,Sr);else if(!i)return}for(e._pt=e._ptCache=0,l=p&&vo(l)||l&&!p,_=0;_<g.length;_++){if(T=g[_],D=T._gsap||dV(g)[_]._gsap,e._ptLookup[_]=L={},OU[D.id]&&sp.length&&MP(),H=y===g?_:y.indexOf(T),B&&(O=new B).init(T,q||A,e,H,y)!==!1&&(e._pt=E=new xo(e._pt,T,O.name,0,1,O.render,O,0,O.priority),O._props.forEach(function(I){L[I]=E}),O.priority&&(C=1)),!B||q)for(M in A)Oo[M]&&(O=jhe(M,A,e,H,T,y))?O.priority&&(C=1):L[M]=E=fV.call(e,T,M,"get",A[M],H,y,0,n.stringFilter);e._op&&e._op[_]&&e.kill(T,e._op[_]),x&&e._pt&&(Gf=e,Vr.killTweensOf(T,L,e.globalTime(i)),W=!e.parent,Gf=0),e._pt&&l&&(OU[D.id]=1)}C&&Qhe(e),e._onInit&&e._onInit(e)}e._onUpdate=c,e._initted=(!e._op||e._pt)&&!W,d&&i<=0&&S.render(Bl,!0,!0)},vJe=function(e,i,r,n,s,a,o,l){var c=(e._pt&&e._ptCache||(e._ptCache={}))[i],h,u,d,f;if(!c)for(c=e._ptCache[i]=[],d=e._ptLookup,f=e._targets.length;f--;){if(h=d[f][i],h&&h.d&&h.d._pt)for(h=h.d._pt;h&&h.p!==i&&h.fp!==i;)h=h._next;if(!h)return zU=1,e.vars[i]="+=0",pV(e,o),zU=0,l?OS(i+" not eligible for reset"):1;c.push(h)}for(f=c.length;f--;)u=c[f],h=u._pt||u,h.s=(n||n===0)&&!s?n:h.s+(n||0)+a*h.c,h.c=r-h.s,u.e&&(u.e=vn(r)+fa(u.e)),u.b&&(u.b=h.s+fa(u.b))},yJe=function(e,i){var r=e[0]?Sg(e[0]).harness:0,n=r&&r.aliases,s,a,o,l;if(!n)return i;s=Kg({},i);for(a in n)if(a in s)for(l=n[a].split(","),o=l.length;o--;)s[l[o]]=s[a];return s},xJe=function(e,i,r,n){var s=i.ease||n||"power1.inOut",a,o;if(ya(i))o=r[e]||(r[e]=[]),i.forEach(function(l,c){return o.push({t:c/(i.length-1)*100,v:l,e:s})});else for(a in i)o=r[a]||(r[a]=[]),a==="ease"||o.push({t:parseFloat(e),v:i[a],e:s})},Tw=function(e,i,r,n,s){return ln(e)?e.call(i,r,n,s):Os(e)&&~e.indexOf("random(")?FS(e):e},Whe=uV+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Xhe={};yo(Whe+",id,stagger,delay,duration,paused,scrollTrigger",function(t){return Xhe[t]=1});var Rn=function(t){hhe(e,t);function e(r,n,s,a){var o;typeof n=="number"&&(s.duration=n,n=s,s=null),o=t.call(this,a?n:Ew(n))||this;var l=o.vars,c=l.duration,h=l.delay,u=l.immediateRender,d=l.stagger,f=l.overwrite,p=l.keyframes,m=l.defaults,g=l.scrollTrigger,v=l.yoyoEase,y=n.parent||Vr,x=(ya(r)||dhe(r)?xd(r[0]):"length"in n)?[r]:Fl(r),S,A,_,M,E,T,C,D;if(o._targets=x.length?dV(x):OS("GSAP target "+r+" not found. https://gsap.com",!Ho.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=f,p||d||TT(c)||TT(h)){if(n=o.vars,S=o.timeline=new Na({data:"nested",defaults:m||{},targets:y&&y.data==="nested"?y.vars.targets:x}),S.kill(),S.parent=S._dp=Iu(o),S._start=0,d||TT(c)||TT(h)){if(M=x.length,C=d&&Dhe(d),Xh(d))for(E in d)~Whe.indexOf(E)&&(D||(D={}),D[E]=d[E]);for(A=0;A<M;A++)_=TP(n,Xhe),_.stagger=0,v&&(_.yoyoEase=v),D&&Kg(_,D),T=x[A],_.duration=+Tw(c,Iu(o),A,T,x),_.delay=(+Tw(h,Iu(o),A,T,x)||0)-o._delay,!d&&M===1&&_.delay&&(o._delay=h=_.delay,o._start+=h,_.delay=0),S.to(T,_,C?C(A,T,x):0),S._ease=Oi.none;S.duration()?c=h=0:o.timeline=0}else if(p){Ew(Yl(S.vars.defaults,{ease:"none"})),S._ease=Ag(p.ease||n.ease||"none");var B=0,O,L,H;if(ya(p))p.forEach(function(q){return S.to(x,q,">")}),S.duration();else{_={};for(E in p)E==="ease"||E==="easeEach"||xJe(E,p[E],_,p.easeEach);for(E in _)for(O=_[E].sort(function(q,W){return q.t-W.t}),B=0,A=0;A<O.length;A++)L=O[A],H={ease:L.e,duration:(L.t-(A?O[A-1].t:0))/100*c},H[E]=L.v,S.to(x,H,B),B+=H.duration;S.duration()<c&&S.to({},{duration:c-S.duration()})}}c||o.duration(c=S.duration())}else o.timeline=0;return f===!0&&!sV&&(Gf=Iu(o),Vr.killTweensOf(x),Gf=0),_h(y,Iu(o),s),n.reversed&&o.reverse(),n.paused&&o.paused(!0),(u||!c&&!p&&o._start===_s(y._time)&&vo(u)&&Q$e(Iu(o))&&y.data!=="nested")&&(o._tTime=-Sr,o.render(Math.max(0,-h)||0)),g&&Mhe(Iu(o),g),o}var i=e.prototype;return i.render=function(n,s,a){var o=this._time,l=this._tDur,c=this._dur,h=n<0,u=n>l-Sr&&!h?l:n<Sr?0:n,d,f,p,m,g,v,y,x,S;if(!c)J$e(this,n,s,a);else if(u!==this._tTime||!n||a||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==h){if(d=u,x=this.timeline,this._repeat){if(m=c+this._rDelay,this._repeat<-1&&h)return this.totalTime(m*100+n,s,a);if(d=_s(u%m),u===l?(p=this._repeat,d=c):(p=~~(u/m),p&&p===_s(u/m)&&(d=c,p--),d>c&&(d=c)),v=this._yoyo&&p&1,v&&(S=this._yEase,d=c-d),g=w1(this._tTime,m),d===o&&!a&&this._initted&&p===g)return this._tTime=u,this;p!==g&&(x&&this._yEase&&Ghe(x,v),this.vars.repeatRefresh&&!v&&!this._lock&&this._time!==m&&this._initted&&(this._lock=a=1,this.render(_s(m*p),!0).invalidate()._lock=0))}if(!this._initted){if(The(this,h?n:d,a,s,u))return this._tTime=0,this;if(o!==this._time&&!(a&&this.vars.repeatRefresh&&p!==g))return this;if(c!==this._dur)return this.render(n,s,a)}if(this._tTime=u,this._time=d,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=y=(S||this._ease)(d/c),this._from&&(this.ratio=y=1-y),d&&!o&&!s&&!p&&(Uo(this,"onStart"),this._tTime!==u))return this;for(f=this._pt;f;)f.r(y,f.d),f=f._next;x&&x.render(n<0?n:x._dur*x._ease(d/this._dur),s,a)||this._startAt&&(this._zTime=n),this._onUpdate&&!s&&(h&&BU(this,n,s,a),Uo(this,"onUpdate")),this._repeat&&p!==g&&this.vars.onRepeat&&!s&&this.parent&&Uo(this,"onRepeat"),(u===this._tDur||!u)&&this._tTime===u&&(h&&!this._onUpdate&&BU(this,n,!0,!0),(n||!c)&&(u===this._tDur&&this._ts>0||!u&&this._ts<0)&&wp(this,1),!s&&!(h&&!o)&&(u||o||v)&&(Uo(this,u===l?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom()))}return this},i.targets=function(){return this._targets},i.invalidate=function(n){return(!n||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(n),t.prototype.invalidate.call(this,n)},i.resetTo=function(n,s,a,o,l){kS||Bo.wake(),this._ts||this.play();var c=Math.min(this._dur,(this._dp._time-this._start)*this._ts),h;return this._initted||pV(this,c),h=this._ease(c/this._dur),vJe(this,n,s,a,o,h,c,l)?this.resetTo(n,s,a,o,1):(eR(this,0),this.parent||Ahe(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},i.kill=function(n,s){if(s===void 0&&(s="all"),!n&&(!s||s==="all"))return this._lazy=this._pt=0,this.parent?Hb(this):this;if(this.timeline){var a=this.timeline.totalDuration();return this.timeline.killTweensOf(n,s,Gf&&Gf.vars.overwrite!==!0)._first||Hb(this),this.parent&&a!==this.timeline.totalDuration()&&S1(this,this._dur*this.timeline._tDur/a,0,1),this}var o=this._targets,l=n?Fl(n):o,c=this._ptLookup,h=this._pt,u,d,f,p,m,g,v;if((!s||s==="all")&&q$e(o,l))return s==="all"&&(this._pt=0),Hb(this);for(u=this._op=this._op||[],s!=="all"&&(Os(s)&&(m={},yo(s,function(y){return m[y]=1}),s=m),s=yJe(o,s)),v=o.length;v--;)if(~l.indexOf(o[v])){d=c[v],s==="all"?(u[v]=s,p=d,f={}):(f=u[v]=u[v]||{},p=s);for(m in p)g=d&&d[m],g&&((!("kill"in g.d)||g.d.kill(m)===!0)&&JD(this,g,"_pt"),delete d[m]),f!=="all"&&(f[m]=1)}return this._initted&&!this._pt&&h&&Hb(this),this},e.to=function(n,s){return new e(n,s,arguments[2])},e.from=function(n,s){return Mw(1,arguments)},e.delayedCall=function(n,s,a,o){return new e(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:n,onComplete:s,onReverseComplete:s,onCompleteParams:a,onReverseCompleteParams:a,callbackScope:o})},e.fromTo=function(n,s,a){return Mw(2,arguments)},e.set=function(n,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new e(n,s)},e.killTweensOf=function(n,s,a){return Vr.killTweensOf(n,s,a)},e}(NS);Yl(Rn.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});yo("staggerTo,staggerFrom,staggerFromTo",function(t){Rn[t]=function(){var e=new Na,i=kU.call(arguments,0);return i.splice(t==="staggerFromTo"?5:4,0,0),e[t].apply(e,i)}});var mV=function(e,i,r){return e[i]=r},Yhe=function(e,i,r){return e[i](r)},bJe=function(e,i,r,n){return e[i](n.fp,r)},wJe=function(e,i,r){return e.setAttribute(i,r)},gV=function(e,i){return ln(e[i])?Yhe:aV(e[i])&&e.setAttribute?wJe:mV},qhe=function(e,i){return i.set(i.t,i.p,Math.round((i.s+i.c*e)*1e6)/1e6,i)},SJe=function(e,i){return i.set(i.t,i.p,!!(i.s+i.c*e),i)},Khe=function(e,i){var r=i._pt,n="";if(!e&&i.b)n=i.b;else if(e===1&&i.e)n=i.e;else{for(;r;)n=r.p+(r.m?r.m(r.s+r.c*e):Math.round((r.s+r.c*e)*1e4)/1e4)+n,r=r._next;n+=i.c}i.set(i.t,i.p,n,i)},vV=function(e,i){for(var r=i._pt;r;)r.r(e,r.d),r=r._next},_Je=function(e,i,r,n){for(var s=this._pt,a;s;)a=s._next,s.p===n&&s.modifier(e,i,r),s=a},AJe=function(e){for(var i=this._pt,r,n;i;)n=i._next,i.p===e&&!i.op||i.op===e?JD(this,i,"_pt"):i.dep||(r=1),i=n;return!r},EJe=function(e,i,r,n){n.mSet(e,i,n.m.call(n.tween,r,n.mt),n)},Qhe=function(e){for(var i=e._pt,r,n,s,a;i;){for(r=i._next,n=s;n&&n.pr>i.pr;)n=n._next;(i._prev=n?n._prev:a)?i._prev._next=i:s=i,(i._next=n)?n._prev=i:a=i,i=r}e._pt=s},xo=function(){function t(i,r,n,s,a,o,l,c,h){this.t=r,this.s=s,this.c=a,this.p=n,this.r=o||qhe,this.d=l||this,this.set=c||mV,this.pr=h||0,this._next=i,i&&(i._prev=this)}var e=t.prototype;return e.modifier=function(r,n,s){this.mSet=this.mSet||this.set,this.set=EJe,this.m=r,this.mt=s,this.tween=n},t}();yo(uV+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(t){return hV[t]=1});qo.TweenMax=qo.TweenLite=Rn;qo.TimelineLite=qo.TimelineMax=Na;Vr=new Na({sortChildren:!1,defaults:b1,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Ho.stringFilter=Uhe;var Eg=[],CC={},MJe=[],p$=0,TJe=0,dB=function(e){return(CC[e]||MJe).map(function(i){return i()})},GU=function(){var e=Date.now(),i=[];e-p$>2&&(dB("matchMediaInit"),Eg.forEach(function(r){var n=r.queries,s=r.conditions,a,o,l,c;for(o in n)a=mh.matchMedia(n[o]).matches,a&&(l=1),a!==s[o]&&(s[o]=a,c=1);c&&(r.revert(),l&&i.push(r))}),dB("matchMediaRevert"),i.forEach(function(r){return r.onMatch(r,function(n){return r.add(null,n)})}),p$=e,dB("matchMedia"))},$he=function(){function t(i,r){this.selector=r&&NU(r),this.data=[],this._r=[],this.isReverted=!1,this.id=TJe++,i&&this.add(i)}var e=t.prototype;return e.add=function(r,n,s){ln(r)&&(s=n,n=r,r=ln);var a=this,o=function(){var c=Br,h=a.selector,u;return c&&c!==a&&c.data.push(a),s&&(a.selector=NU(s)),Br=a,u=n.apply(a,arguments),ln(u)&&a._r.push(u),Br=c,a.selector=h,a.isReverted=!1,u};return a.last=o,r===ln?o(a,function(l){return a.add(null,l)}):r?a[r]=o:o},e.ignore=function(r){var n=Br;Br=null,r(this),Br=n},e.getTweens=function(){var r=[];return this.data.forEach(function(n){return n instanceof t?r.push.apply(r,n.getTweens()):n instanceof Rn&&!(n.parent&&n.parent.data==="nested")&&r.push(n)}),r},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(r,n){var s=this;if(r?function(){for(var o=s.getTweens(),l=s.data.length,c;l--;)c=s.data[l],c.data==="isFlip"&&(c.revert(),c.getChildren(!0,!0,!1).forEach(function(h){return o.splice(o.indexOf(h),1)}));for(o.map(function(h){return{g:h._dur||h._delay||h._sat&&!h._sat.vars.immediateRender?h.globalTime(0):-1/0,t:h}}).sort(function(h,u){return u.g-h.g||-1/0}).forEach(function(h){return h.t.revert(r)}),l=s.data.length;l--;)c=s.data[l],c instanceof Na?c.data!=="nested"&&(c.scrollTrigger&&c.scrollTrigger.revert(),c.kill()):!(c instanceof Rn)&&c.revert&&c.revert(r);s._r.forEach(function(h){return h(r,s)}),s.isReverted=!0}():this.data.forEach(function(o){return o.kill&&o.kill()}),this.clear(),n)for(var a=Eg.length;a--;)Eg[a].id===this.id&&Eg.splice(a,1)},e.revert=function(r){this.kill(r||{})},t}(),CJe=function(){function t(i){this.contexts=[],this.scope=i,Br&&Br.data.push(this)}var e=t.prototype;return e.add=function(r,n,s){Xh(r)||(r={matches:r});var a=new $he(0,s||this.scope),o=a.conditions={},l,c,h;Br&&!a.selector&&(a.selector=Br.selector),this.contexts.push(a),n=a.add("onMatch",n),a.queries=r;for(c in r)c==="all"?h=1:(l=mh.matchMedia(r[c]),l&&(Eg.indexOf(a)<0&&Eg.push(a),(o[c]=l.matches)&&(h=1),l.addListener?l.addListener(GU):l.addEventListener("change",GU)));return h&&n(a,function(u){return a.add(null,u)}),this},e.revert=function(r){this.kill(r||{})},e.kill=function(r){this.contexts.forEach(function(n){return n.kill(r,!0)})},t}(),PP={registerPlugin:function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];i.forEach(function(n){return Fhe(n)})},timeline:function(e){return new Na(e)},getTweensOf:function(e,i){return Vr.getTweensOf(e,i)},getProperty:function(e,i,r,n){Os(e)&&(e=Fl(e)[0]);var s=Sg(e||{}).get,a=r?_he:She;return r==="native"&&(r=""),e&&(i?a((Oo[i]&&Oo[i].get||s)(e,i,r,n)):function(o,l,c){return a((Oo[o]&&Oo[o].get||s)(e,o,l,c))})},quickSetter:function(e,i,r){if(e=Fl(e),e.length>1){var n=e.map(function(h){return So.quickSetter(h,i,r)}),s=n.length;return function(h){for(var u=s;u--;)n[u](h)}}e=e[0]||{};var a=Oo[i],o=Sg(e),l=o.harness&&(o.harness.aliases||{})[i]||i,c=a?function(h){var u=new a;hy._pt=0,u.init(e,r?h+r:h,hy,0,[e]),u.render(1,u),hy._pt&&vV(1,hy)}:o.set(e,l);return a?c:function(h){return c(e,l,r?h+r:h,o,1)}},quickTo:function(e,i,r){var n,s=So.to(e,Kg((n={},n[i]="+=0.1",n.paused=!0,n),r||{})),a=function(l,c,h){return s.resetTo(i,l,c,h)};return a.tween=s,a},isTweening:function(e){return Vr.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Ag(e.ease,b1.ease)),c$(b1,e||{})},config:function(e){return c$(Ho,e||{})},registerEffect:function(e){var i=e.name,r=e.effect,n=e.plugins,s=e.defaults,a=e.extendTimeline;(n||"").split(",").forEach(function(o){return o&&!Oo[o]&&!qo[o]&&OS(i+" effect requires "+o+" plugin.")}),lB[i]=function(o,l,c){return r(Fl(o),Yl(l||{},s),c)},a&&(Na.prototype[i]=function(o,l,c){return this.add(lB[i](o,Xh(l)?l:(c=l)&&{},this),c)})},registerEase:function(e,i){Oi[e]=Ag(i)},parseEase:function(e,i){return arguments.length?Ag(e,i):Oi},getById:function(e){return Vr.getById(e)},exportRoot:function(e,i){e===void 0&&(e={});var r=new Na(e),n,s;for(r.smoothChildTiming=vo(e.smoothChildTiming),Vr.remove(r),r._dp=0,r._time=r._tTime=Vr._time,n=Vr._first;n;)s=n._next,(i||!(!n._dur&&n instanceof Rn&&n.vars.onComplete===n._targets[0]))&&_h(r,n,n._start-n._delay),n=s;return _h(Vr,r,0),r},context:function(e,i){return e?new $he(e,i):Br},matchMedia:function(e){return new CJe(e)},matchMediaRefresh:function(){return Eg.forEach(function(e){var i=e.conditions,r,n;for(n in i)i[n]&&(i[n]=!1,r=1);r&&e.revert()})||GU()},addEventListener:function(e,i){var r=CC[e]||(CC[e]=[]);~r.indexOf(i)||r.push(i)},removeEventListener:function(e,i){var r=CC[e],n=r&&r.indexOf(i);n>=0&&r.splice(n,1)},utils:{wrap:aJe,wrapYoyo:oJe,distribute:Dhe,random:Ihe,snap:Rhe,normalize:sJe,getUnit:fa,clamp:tJe,splitColor:khe,toArray:Fl,selector:NU,mapRange:Ohe,pipe:rJe,unitize:nJe,interpolate:lJe,shuffle:Phe},install:vhe,effects:lB,ticker:Bo,updateRoot:Na.updateRoot,plugins:Oo,globalTimeline:Vr,core:{PropTween:xo,globals:yhe,Tween:Rn,Timeline:Na,Animation:NS,getCache:Sg,_removeLinkedListItem:JD,reverting:function(){return va},context:function(e){return e&&Br&&(Br.data.push(e),e._ctx=Br),Br},suppressOverwrites:function(e){return sV=e}}};yo("to,from,fromTo,delayedCall,set,killTweensOf",function(t){return PP[t]=Rn[t]});Bo.add(Na.updateRoot);hy=PP.to({},{duration:0});var PJe=function(e,i){for(var r=e._pt;r&&r.p!==i&&r.op!==i&&r.fp!==i;)r=r._next;return r},DJe=function(e,i){var r=e._targets,n,s,a;for(n in i)for(s=r.length;s--;)a=e._ptLookup[s][n],a&&(a=a.d)&&(a._pt&&(a=PJe(a,n)),a&&a.modifier&&a.modifier(i[n],e,r[s],n))},fB=function(e,i){return{name:e,rawVars:1,init:function(n,s,a){a._onInit=function(o){var l,c;if(Os(s)&&(l={},yo(s,function(h){return l[h]=1}),s=l),i){l={};for(c in s)l[c]=i(s[c]);s=l}DJe(o,s)}}}},So=PP.registerPlugin({name:"attr",init:function(e,i,r,n,s){var a,o,l;this.tween=r;for(a in i)l=e.getAttribute(a)||"",o=this.add(e,"setAttribute",(l||0)+"",i[a],n,s,0,0,a),o.op=a,o.b=l,this._props.push(a)},render:function(e,i){for(var r=i._pt;r;)va?r.set(r.t,r.p,r.b,r):r.r(e,r.d),r=r._next}},{name:"endArray",init:function(e,i){for(var r=i.length;r--;)this.add(e,r,e[r]||0,i[r],0,0,0,0,0,1)}},fB("roundProps",UU),fB("modifiers"),fB("snap",Rhe))||PP;Rn.version=Na.version=So.version="3.12.5";ghe=1;oV()&&_1();Oi.Power0;Oi.Power1;Oi.Power2;Oi.Power3;Oi.Power4;Oi.Linear;Oi.Quad;Oi.Cubic;Oi.Quart;Oi.Quint;Oi.Strong;Oi.Elastic;Oi.Back;Oi.SteppedEase;Oi.Bounce;Oi.Sine;Oi.Expo;Oi.Circ;/*!
 * CSSPlugin 3.12.5
 * https://gsap.com
 *
 * Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var m$,Vf,zy,yV,ig,g$,xV,RJe=function(){return typeof window<"u"},bd={},Tm=180/Math.PI,Gy=Math.PI/180,Cv=Math.atan2,v$=1e8,bV=/([A-Z])/g,IJe=/(left|right|width|margin|padding|x)/i,LJe=/[\s,\(]\S/,Ch={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},VU=function(e,i){return i.set(i.t,i.p,Math.round((i.s+i.c*e)*1e4)/1e4+i.u,i)},OJe=function(e,i){return i.set(i.t,i.p,e===1?i.e:Math.round((i.s+i.c*e)*1e4)/1e4+i.u,i)},BJe=function(e,i){return i.set(i.t,i.p,e?Math.round((i.s+i.c*e)*1e4)/1e4+i.u:i.b,i)},FJe=function(e,i){var r=i.s+i.c*e;i.set(i.t,i.p,~~(r+(r<0?-.5:.5))+i.u,i)},Jhe=function(e,i){return i.set(i.t,i.p,e?i.e:i.b,i)},Zhe=function(e,i){return i.set(i.t,i.p,e!==1?i.b:i.e,i)},kJe=function(e,i,r){return e.style[i]=r},NJe=function(e,i,r){return e.style.setProperty(i,r)},UJe=function(e,i,r){return e._gsap[i]=r},zJe=function(e,i,r){return e._gsap.scaleX=e._gsap.scaleY=r},GJe=function(e,i,r,n,s){var a=e._gsap;a.scaleX=a.scaleY=r,a.renderTransform(s,a)},VJe=function(e,i,r,n,s){var a=e._gsap;a[i]=r,a.renderTransform(s,a)},Xr="transform",bo=Xr+"Origin",HJe=function t(e,i){var r=this,n=this.target,s=n.style,a=n._gsap;if(e in bd&&s){if(this.tfm=this.tfm||{},e!=="transform")e=Ch[e]||e,~e.indexOf(",")?e.split(",").forEach(function(o){return r.tfm[o]=Uu(n,o)}):this.tfm[e]=a.x?a[e]:Uu(n,e),e===bo&&(this.tfm.zOrigin=a.zOrigin);else return Ch.transform.split(",").forEach(function(o){return t.call(r,o,i)});if(this.props.indexOf(Xr)>=0)return;a.svg&&(this.svgo=n.getAttribute("data-svg-origin"),this.props.push(bo,i,"")),e=Xr}(s||i)&&this.props.push(e,i,s[e])},eue=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},jJe=function(){var e=this.props,i=this.target,r=i.style,n=i._gsap,s,a;for(s=0;s<e.length;s+=3)e[s+1]?i[e[s]]=e[s+2]:e[s+2]?r[e[s]]=e[s+2]:r.removeProperty(e[s].substr(0,2)==="--"?e[s]:e[s].replace(bV,"-$1").toLowerCase());if(this.tfm){for(a in this.tfm)n[a]=this.tfm[a];n.svg&&(n.renderTransform(),i.setAttribute("data-svg-origin",this.svgo||"")),s=xV(),(!s||!s.isStart)&&!r[Xr]&&(eue(r),n.zOrigin&&r[bo]&&(r[bo]+=" "+n.zOrigin+"px",n.zOrigin=0,n.renderTransform()),n.uncache=1)}},tue=function(e,i){var r={target:e,props:[],revert:jJe,save:HJe};return e._gsap||So.core.getCache(e),i&&i.split(",").forEach(function(n){return r.save(n)}),r},iue,HU=function(e,i){var r=Vf.createElementNS?Vf.createElementNS((i||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Vf.createElement(e);return r&&r.style?r:Vf.createElement(e)},kh=function t(e,i,r){var n=getComputedStyle(e);return n[i]||n.getPropertyValue(i.replace(bV,"-$1").toLowerCase())||n.getPropertyValue(i)||!r&&t(e,A1(i)||i,1)||""},y$="O,Moz,ms,Ms,Webkit".split(","),A1=function(e,i,r){var n=i||ig,s=n.style,a=5;if(e in s&&!r)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);a--&&!(y$[a]+e in s););return a<0?null:(a===3?"ms":a>=0?y$[a]:"")+e},jU=function(){RJe()&&window.document&&(m$=window,Vf=m$.document,zy=Vf.documentElement,ig=HU("div")||{style:{}},HU("div"),Xr=A1(Xr),bo=Xr+"Origin",ig.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",iue=!!A1("perspective"),xV=So.core.reverting,yV=1)},pB=function t(e){var i=HU("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=this.parentNode,n=this.nextSibling,s=this.style.cssText,a;if(zy.appendChild(i),i.appendChild(this),this.style.display="block",e)try{a=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=t}catch{}else this._gsapBBox&&(a=this._gsapBBox());return r&&(n?r.insertBefore(this,n):r.appendChild(this)),zy.removeChild(i),this.style.cssText=s,a},x$=function(e,i){for(var r=i.length;r--;)if(e.hasAttribute(i[r]))return e.getAttribute(i[r])},rue=function(e){var i;try{i=e.getBBox()}catch{i=pB.call(e,!0)}return i&&(i.width||i.height)||e.getBBox===pB||(i=pB.call(e,!0)),i&&!i.width&&!i.x&&!i.y?{x:+x$(e,["x","cx","x1"])||0,y:+x$(e,["y","cy","y1"])||0,width:0,height:0}:i},nue=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&rue(e))},Qg=function(e,i){if(i){var r=e.style,n;i in bd&&i!==bo&&(i=Xr),r.removeProperty?(n=i.substr(0,2),(n==="ms"||i.substr(0,6)==="webkit")&&(i="-"+i),r.removeProperty(n==="--"?i:i.replace(bV,"-$1").toLowerCase())):r.removeAttribute(i)}},Hf=function(e,i,r,n,s,a){var o=new xo(e._pt,i,r,0,1,a?Zhe:Jhe);return e._pt=o,o.b=n,o.e=s,e._props.push(r),o},b$={deg:1,rad:1,turn:1},WJe={grid:1,flex:1},Sp=function t(e,i,r,n){var s=parseFloat(r)||0,a=(r+"").trim().substr((s+"").length)||"px",o=ig.style,l=IJe.test(i),c=e.tagName.toLowerCase()==="svg",h=(c?"client":"offset")+(l?"Width":"Height"),u=100,d=n==="px",f=n==="%",p,m,g,v;if(n===a||!s||b$[n]||b$[a])return s;if(a!=="px"&&!d&&(s=t(e,i,r,"px")),v=e.getCTM&&nue(e),(f||a==="%")&&(bd[i]||~i.indexOf("adius")))return p=v?e.getBBox()[l?"width":"height"]:e[h],vn(f?s/p*u:s/100*p);if(o[l?"width":"height"]=u+(d?a:n),m=~i.indexOf("adius")||n==="em"&&e.appendChild&&!c?e:e.parentNode,v&&(m=(e.ownerSVGElement||{}).parentNode),(!m||m===Vf||!m.appendChild)&&(m=Vf.body),g=m._gsap,g&&f&&g.width&&l&&g.time===Bo.time&&!g.uncache)return vn(s/g.width*u);if(f&&(i==="height"||i==="width")){var y=e.style[i];e.style[i]=u+n,p=e[h],y?e.style[i]=y:Qg(e,i)}else(f||a==="%")&&!WJe[kh(m,"display")]&&(o.position=kh(e,"position")),m===e&&(o.position="static"),m.appendChild(ig),p=ig[h],m.removeChild(ig),o.position="absolute";return l&&f&&(g=Sg(m),g.time=Bo.time,g.width=m[h]),vn(d?p*s/u:p&&s?u/p*s:0)},Uu=function(e,i,r,n){var s;return yV||jU(),i in Ch&&i!=="transform"&&(i=Ch[i],~i.indexOf(",")&&(i=i.split(",")[0])),bd[i]&&i!=="transform"?(s=zS(e,n),s=i!=="transformOrigin"?s[i]:s.svg?s.origin:RP(kh(e,bo))+" "+s.zOrigin+"px"):(s=e.style[i],(!s||s==="auto"||n||~(s+"").indexOf("calc("))&&(s=DP[i]&&DP[i](e,i,r)||kh(e,i)||bhe(e,i)||(i==="opacity"?1:0))),r&&!~(s+"").trim().indexOf(" ")?Sp(e,i,s,r)+r:s},XJe=function(e,i,r,n){if(!r||r==="none"){var s=A1(i,e,1),a=s&&kh(e,s,1);a&&a!==r?(i=s,r=a):i==="borderColor"&&(r=kh(e,"borderTopColor"))}var o=new xo(this._pt,e.style,i,0,1,Khe),l=0,c=0,h,u,d,f,p,m,g,v,y,x,S,A;if(o.b=r,o.e=n,r+="",n+="",n==="auto"&&(m=e.style[i],e.style[i]=n,n=kh(e,i)||n,m?e.style[i]=m:Qg(e,i)),h=[r,n],Uhe(h),r=h[0],n=h[1],d=r.match(cy)||[],A=n.match(cy)||[],A.length){for(;u=cy.exec(n);)g=u[0],y=n.substring(l,u.index),p?p=(p+1)%5:(y.substr(-5)==="rgba("||y.substr(-5)==="hsla(")&&(p=1),g!==(m=d[c++]||"")&&(f=parseFloat(m)||0,S=m.substr((f+"").length),g.charAt(1)==="="&&(g=Uy(f,g)+S),v=parseFloat(g),x=g.substr((v+"").length),l=cy.lastIndex-x.length,x||(x=x||Ho.units[i]||S,l===n.length&&(n+=x,o.e+=x)),S!==x&&(f=Sp(e,i,m,x)||0),o._pt={_next:o._pt,p:y||c===1?y:",",s:f,c:v-f,m:p&&p<4||i==="zIndex"?Math.round:0});o.c=l<n.length?n.substring(l,n.length):""}else o.r=i==="display"&&n==="none"?Zhe:Jhe;return phe.test(n)&&(o.e=0),this._pt=o,o},w$={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},YJe=function(e){var i=e.split(" "),r=i[0],n=i[1]||"50%";return(r==="top"||r==="bottom"||n==="left"||n==="right")&&(e=r,r=n,n=e),i[0]=w$[r]||r,i[1]=w$[n]||n,i.join(" ")},qJe=function(e,i){if(i.tween&&i.tween._time===i.tween._dur){var r=i.t,n=r.style,s=i.u,a=r._gsap,o,l,c;if(s==="all"||s===!0)n.cssText="",l=1;else for(s=s.split(","),c=s.length;--c>-1;)o=s[c],bd[o]&&(l=1,o=o==="transformOrigin"?bo:Xr),Qg(r,o);l&&(Qg(r,Xr),a&&(a.svg&&r.removeAttribute("transform"),zS(r,1),a.uncache=1,eue(n)))}},DP={clearProps:function(e,i,r,n,s){if(s.data!=="isFromStart"){var a=e._pt=new xo(e._pt,i,r,0,0,qJe);return a.u=n,a.pr=-10,a.tween=s,e._props.push(r),1}}},US=[1,0,0,1,0,0],sue={},aue=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},S$=function(e){var i=kh(e,Xr);return aue(i)?US:i.substr(7).match(fhe).map(vn)},wV=function(e,i){var r=e._gsap||Sg(e),n=e.style,s=S$(e),a,o,l,c;return r.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,s=[l.a,l.b,l.c,l.d,l.e,l.f],s.join(",")==="1,0,0,1,0,0"?US:s):(s===US&&!e.offsetParent&&e!==zy&&!r.svg&&(l=n.display,n.display="block",a=e.parentNode,(!a||!e.offsetParent)&&(c=1,o=e.nextElementSibling,zy.appendChild(e)),s=S$(e),l?n.display=l:Qg(e,"display"),c&&(o?a.insertBefore(e,o):a?a.appendChild(e):zy.removeChild(e))),i&&s.length>6?[s[0],s[1],s[4],s[5],s[12],s[13]]:s)},WU=function(e,i,r,n,s,a){var o=e._gsap,l=s||wV(e,!0),c=o.xOrigin||0,h=o.yOrigin||0,u=o.xOffset||0,d=o.yOffset||0,f=l[0],p=l[1],m=l[2],g=l[3],v=l[4],y=l[5],x=i.split(" "),S=parseFloat(x[0])||0,A=parseFloat(x[1])||0,_,M,E,T;r?l!==US&&(M=f*g-p*m)&&(E=S*(g/M)+A*(-m/M)+(m*y-g*v)/M,T=S*(-p/M)+A*(f/M)-(f*y-p*v)/M,S=E,A=T):(_=rue(e),S=_.x+(~x[0].indexOf("%")?S/100*_.width:S),A=_.y+(~(x[1]||x[0]).indexOf("%")?A/100*_.height:A)),n||n!==!1&&o.smooth?(v=S-c,y=A-h,o.xOffset=u+(v*f+y*m)-v,o.yOffset=d+(v*p+y*g)-y):o.xOffset=o.yOffset=0,o.xOrigin=S,o.yOrigin=A,o.smooth=!!n,o.origin=i,o.originIsAbsolute=!!r,e.style[bo]="0px 0px",a&&(Hf(a,o,"xOrigin",c,S),Hf(a,o,"yOrigin",h,A),Hf(a,o,"xOffset",u,o.xOffset),Hf(a,o,"yOffset",d,o.yOffset)),e.setAttribute("data-svg-origin",S+" "+A)},zS=function(e,i){var r=e._gsap||new Hhe(e);if("x"in r&&!i&&!r.uncache)return r;var n=e.style,s=r.scaleX<0,a="px",o="deg",l=getComputedStyle(e),c=kh(e,bo)||"0",h,u,d,f,p,m,g,v,y,x,S,A,_,M,E,T,C,D,B,O,L,H,q,W,I,z,U,X,Q,re,ie,ce;return h=u=d=m=g=v=y=x=S=0,f=p=1,r.svg=!!(e.getCTM&&nue(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(n[Xr]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[Xr]!=="none"?l[Xr]:"")),n.scale=n.rotate=n.translate="none"),M=wV(e,r.svg),r.svg&&(r.uncache?(I=e.getBBox(),c=r.xOrigin-I.x+"px "+(r.yOrigin-I.y)+"px",W=""):W=!i&&e.getAttribute("data-svg-origin"),WU(e,W||c,!!W||r.originIsAbsolute,r.smooth!==!1,M)),A=r.xOrigin||0,_=r.yOrigin||0,M!==US&&(D=M[0],B=M[1],O=M[2],L=M[3],h=H=M[4],u=q=M[5],M.length===6?(f=Math.sqrt(D*D+B*B),p=Math.sqrt(L*L+O*O),m=D||B?Cv(B,D)*Tm:0,y=O||L?Cv(O,L)*Tm+m:0,y&&(p*=Math.abs(Math.cos(y*Gy))),r.svg&&(h-=A-(A*D+_*O),u-=_-(A*B+_*L))):(ce=M[6],re=M[7],U=M[8],X=M[9],Q=M[10],ie=M[11],h=M[12],u=M[13],d=M[14],E=Cv(ce,Q),g=E*Tm,E&&(T=Math.cos(-E),C=Math.sin(-E),W=H*T+U*C,I=q*T+X*C,z=ce*T+Q*C,U=H*-C+U*T,X=q*-C+X*T,Q=ce*-C+Q*T,ie=re*-C+ie*T,H=W,q=I,ce=z),E=Cv(-O,Q),v=E*Tm,E&&(T=Math.cos(-E),C=Math.sin(-E),W=D*T-U*C,I=B*T-X*C,z=O*T-Q*C,ie=L*C+ie*T,D=W,B=I,O=z),E=Cv(B,D),m=E*Tm,E&&(T=Math.cos(E),C=Math.sin(E),W=D*T+B*C,I=H*T+q*C,B=B*T-D*C,q=q*T-H*C,D=W,H=I),g&&Math.abs(g)+Math.abs(m)>359.9&&(g=m=0,v=180-v),f=vn(Math.sqrt(D*D+B*B+O*O)),p=vn(Math.sqrt(q*q+ce*ce)),E=Cv(H,q),y=Math.abs(E)>2e-4?E*Tm:0,S=ie?1/(ie<0?-ie:ie):0),r.svg&&(W=e.getAttribute("transform"),r.forceCSS=e.setAttribute("transform","")||!aue(kh(e,Xr)),W&&e.setAttribute("transform",W))),Math.abs(y)>90&&Math.abs(y)<270&&(s?(f*=-1,y+=m<=0?180:-180,m+=m<=0?180:-180):(p*=-1,y+=y<=0?180:-180)),i=i||r.uncache,r.x=h-((r.xPercent=h&&(!i&&r.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-h)?-50:0)))?e.offsetWidth*r.xPercent/100:0)+a,r.y=u-((r.yPercent=u&&(!i&&r.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-u)?-50:0)))?e.offsetHeight*r.yPercent/100:0)+a,r.z=d+a,r.scaleX=vn(f),r.scaleY=vn(p),r.rotation=vn(m)+o,r.rotationX=vn(g)+o,r.rotationY=vn(v)+o,r.skewX=y+o,r.skewY=x+o,r.transformPerspective=S+a,(r.zOrigin=parseFloat(c.split(" ")[2])||!i&&r.zOrigin||0)&&(n[bo]=RP(c)),r.xOffset=r.yOffset=0,r.force3D=Ho.force3D,r.renderTransform=r.svg?QJe:iue?oue:KJe,r.uncache=0,r},RP=function(e){return(e=e.split(" "))[0]+" "+e[1]},mB=function(e,i,r){var n=fa(i);return vn(parseFloat(i)+parseFloat(Sp(e,"x",r+"px",n)))+n},KJe=function(e,i){i.z="0px",i.rotationY=i.rotationX="0deg",i.force3D=0,oue(e,i)},pm="0deg",Ab="0px",mm=") ",oue=function(e,i){var r=i||this,n=r.xPercent,s=r.yPercent,a=r.x,o=r.y,l=r.z,c=r.rotation,h=r.rotationY,u=r.rotationX,d=r.skewX,f=r.skewY,p=r.scaleX,m=r.scaleY,g=r.transformPerspective,v=r.force3D,y=r.target,x=r.zOrigin,S="",A=v==="auto"&&e&&e!==1||v===!0;if(x&&(u!==pm||h!==pm)){var _=parseFloat(h)*Gy,M=Math.sin(_),E=Math.cos(_),T;_=parseFloat(u)*Gy,T=Math.cos(_),a=mB(y,a,M*T*-x),o=mB(y,o,-Math.sin(_)*-x),l=mB(y,l,E*T*-x+x)}g!==Ab&&(S+="perspective("+g+mm),(n||s)&&(S+="translate("+n+"%, "+s+"%) "),(A||a!==Ab||o!==Ab||l!==Ab)&&(S+=l!==Ab||A?"translate3d("+a+", "+o+", "+l+") ":"translate("+a+", "+o+mm),c!==pm&&(S+="rotate("+c+mm),h!==pm&&(S+="rotateY("+h+mm),u!==pm&&(S+="rotateX("+u+mm),(d!==pm||f!==pm)&&(S+="skew("+d+", "+f+mm),(p!==1||m!==1)&&(S+="scale("+p+", "+m+mm),y.style[Xr]=S||"translate(0, 0)"},QJe=function(e,i){var r=i||this,n=r.xPercent,s=r.yPercent,a=r.x,o=r.y,l=r.rotation,c=r.skewX,h=r.skewY,u=r.scaleX,d=r.scaleY,f=r.target,p=r.xOrigin,m=r.yOrigin,g=r.xOffset,v=r.yOffset,y=r.forceCSS,x=parseFloat(a),S=parseFloat(o),A,_,M,E,T;l=parseFloat(l),c=parseFloat(c),h=parseFloat(h),h&&(h=parseFloat(h),c+=h,l+=h),l||c?(l*=Gy,c*=Gy,A=Math.cos(l)*u,_=Math.sin(l)*u,M=Math.sin(l-c)*-d,E=Math.cos(l-c)*d,c&&(h*=Gy,T=Math.tan(c-h),T=Math.sqrt(1+T*T),M*=T,E*=T,h&&(T=Math.tan(h),T=Math.sqrt(1+T*T),A*=T,_*=T)),A=vn(A),_=vn(_),M=vn(M),E=vn(E)):(A=u,E=d,_=M=0),(x&&!~(a+"").indexOf("px")||S&&!~(o+"").indexOf("px"))&&(x=Sp(f,"x",a,"px"),S=Sp(f,"y",o,"px")),(p||m||g||v)&&(x=vn(x+p-(p*A+m*M)+g),S=vn(S+m-(p*_+m*E)+v)),(n||s)&&(T=f.getBBox(),x=vn(x+n/100*T.width),S=vn(S+s/100*T.height)),T="matrix("+A+","+_+","+M+","+E+","+x+","+S+")",f.setAttribute("transform",T),y&&(f.style[Xr]=T)},$Je=function(e,i,r,n,s){var a=360,o=Os(s),l=parseFloat(s)*(o&&~s.indexOf("rad")?Tm:1),c=l-n,h=n+c+"deg",u,d;return o&&(u=s.split("_")[1],u==="short"&&(c%=a,c!==c%(a/2)&&(c+=c<0?a:-a)),u==="cw"&&c<0?c=(c+a*v$)%a-~~(c/a)*a:u==="ccw"&&c>0&&(c=(c-a*v$)%a-~~(c/a)*a)),e._pt=d=new xo(e._pt,i,r,n,c,OJe),d.e=h,d.u="deg",e._props.push(r),d},_$=function(e,i){for(var r in i)e[r]=i[r];return e},JJe=function(e,i,r){var n=_$({},r._gsap),s="perspective,force3D,transformOrigin,svgOrigin",a=r.style,o,l,c,h,u,d,f,p;n.svg?(c=r.getAttribute("transform"),r.setAttribute("transform",""),a[Xr]=i,o=zS(r,1),Qg(r,Xr),r.setAttribute("transform",c)):(c=getComputedStyle(r)[Xr],a[Xr]=i,o=zS(r,1),a[Xr]=c);for(l in bd)c=n[l],h=o[l],c!==h&&s.indexOf(l)<0&&(f=fa(c),p=fa(h),u=f!==p?Sp(r,l,c,p):parseFloat(c),d=parseFloat(h),e._pt=new xo(e._pt,o,l,u,d-u,VU),e._pt.u=p||0,e._props.push(l));_$(o,n)};yo("padding,margin,Width,Radius",function(t,e){var i="Top",r="Right",n="Bottom",s="Left",a=(e<3?[i,r,n,s]:[i+s,i+r,n+r,n+s]).map(function(o){return e<2?t+o:"border"+o+t});DP[e>1?"border"+t:t]=function(o,l,c,h,u){var d,f;if(arguments.length<4)return d=a.map(function(p){return Uu(o,p,c)}),f=d.join(" "),f.split(d[0]).length===5?d[0]:f;d=(h+"").split(" "),f={},a.forEach(function(p,m){return f[p]=d[m]=d[m]||d[(m-1)/2|0]}),o.init(l,f,u)}});var lue={name:"css",register:jU,targetTest:function(e){return e.style&&e.nodeType},init:function(e,i,r,n,s){var a=this._props,o=e.style,l=r.vars.startAt,c,h,u,d,f,p,m,g,v,y,x,S,A,_,M,E;yV||jU(),this.styles=this.styles||tue(e),E=this.styles.props,this.tween=r;for(m in i)if(m!=="autoRound"&&(h=i[m],!(Oo[m]&&jhe(m,i,r,n,e,s)))){if(f=typeof h,p=DP[m],f==="function"&&(h=h.call(r,n,e,s),f=typeof h),f==="string"&&~h.indexOf("random(")&&(h=FS(h)),p)p(this,e,m,h,r)&&(M=1);else if(m.substr(0,2)==="--")c=(getComputedStyle(e).getPropertyValue(m)+"").trim(),h+="",ap.lastIndex=0,ap.test(c)||(g=fa(c),v=fa(h)),v?g!==v&&(c=Sp(e,m,c,v)+v):g&&(h+=g),this.add(o,"setProperty",c,h,n,s,0,0,m),a.push(m),E.push(m,0,o[m]);else if(f!=="undefined"){if(l&&m in l?(c=typeof l[m]=="function"?l[m].call(r,n,e,s):l[m],Os(c)&&~c.indexOf("random(")&&(c=FS(c)),fa(c+"")||c==="auto"||(c+=Ho.units[m]||fa(Uu(e,m))||""),(c+"").charAt(1)==="="&&(c=Uu(e,m))):c=Uu(e,m),d=parseFloat(c),y=f==="string"&&h.charAt(1)==="="&&h.substr(0,2),y&&(h=h.substr(2)),u=parseFloat(h),m in Ch&&(m==="autoAlpha"&&(d===1&&Uu(e,"visibility")==="hidden"&&u&&(d=0),E.push("visibility",0,o.visibility),Hf(this,o,"visibility",d?"inherit":"hidden",u?"inherit":"hidden",!u)),m!=="scale"&&m!=="transform"&&(m=Ch[m],~m.indexOf(",")&&(m=m.split(",")[0]))),x=m in bd,x){if(this.styles.save(m),S||(A=e._gsap,A.renderTransform&&!i.parseTransform||zS(e,i.parseTransform),_=i.smoothOrigin!==!1&&A.smooth,S=this._pt=new xo(this._pt,o,Xr,0,1,A.renderTransform,A,0,-1),S.dep=1),m==="scale")this._pt=new xo(this._pt,A,"scaleY",A.scaleY,(y?Uy(A.scaleY,y+u):u)-A.scaleY||0,VU),this._pt.u=0,a.push("scaleY",m),m+="X";else if(m==="transformOrigin"){E.push(bo,0,o[bo]),h=YJe(h),A.svg?WU(e,h,0,_,0,this):(v=parseFloat(h.split(" ")[2])||0,v!==A.zOrigin&&Hf(this,A,"zOrigin",A.zOrigin,v),Hf(this,o,m,RP(c),RP(h)));continue}else if(m==="svgOrigin"){WU(e,h,1,_,0,this);continue}else if(m in sue){$Je(this,A,m,d,y?Uy(d,y+h):h);continue}else if(m==="smoothOrigin"){Hf(this,A,"smooth",A.smooth,h);continue}else if(m==="force3D"){A[m]=h;continue}else if(m==="transform"){JJe(this,h,e);continue}}else m in o||(m=A1(m)||m);if(x||(u||u===0)&&(d||d===0)&&!LJe.test(h)&&m in o)g=(c+"").substr((d+"").length),u||(u=0),v=fa(h)||(m in Ho.units?Ho.units[m]:g),g!==v&&(d=Sp(e,m,c,v)),this._pt=new xo(this._pt,x?A:o,m,d,(y?Uy(d,y+u):u)-d,!x&&(v==="px"||m==="zIndex")&&i.autoRound!==!1?FJe:VU),this._pt.u=v||0,g!==v&&v!=="%"&&(this._pt.b=c,this._pt.r=BJe);else if(m in o)XJe.call(this,e,m,c,y?y+h:h);else if(m in e)this.add(e,m,c||e[m],y?y+h:h,n,s);else if(m!=="parseTransform"){cV(m,h);continue}x||(m in o?E.push(m,0,o[m]):E.push(m,1,c||e[m])),a.push(m)}}M&&Qhe(this)},render:function(e,i){if(i.tween._time||!xV())for(var r=i._pt;r;)r.r(e,r.d),r=r._next;else i.styles.revert()},get:Uu,aliases:Ch,getSetter:function(e,i,r){var n=Ch[i];return n&&n.indexOf(",")<0&&(i=n),i in bd&&i!==bo&&(e._gsap.x||Uu(e,"x"))?r&&g$===r?i==="scale"?zJe:UJe:(g$=r||{})&&(i==="scale"?GJe:VJe):e.style&&!aV(e.style[i])?kJe:~i.indexOf("-")?NJe:gV(e,i)},core:{_removeProperty:Qg,_getMatrix:wV}};So.utils.checkPrefix=A1;So.core.getStyleSaver=tue;(function(t,e,i,r){var n=yo(t+","+e+","+i,function(s){bd[s]=1});yo(e,function(s){Ho.units[s]="deg",sue[s]=1}),Ch[n[13]]=t+","+e,yo(r,function(s){var a=s.split(":");Ch[a[1]]=n[a[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");yo("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(t){Ho.units[t]="px"});So.registerPlugin(lue);var rx=So.registerPlugin(lue)||So;rx.core.Tween;/*!
 * @gsap/react 2.1.1
 * https://gsap.com
 *
 * Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/let A$=typeof window<"u"?we.useLayoutEffect:we.useEffect,E$=t=>t&&!Array.isArray(t)&&typeof t=="object",CT=[],ZJe={},cue=rx;const nx=(t,e=CT)=>{let i=ZJe;E$(t)?(i=t,t=null,e="dependencies"in i?i.dependencies:CT):E$(e)&&(i=e,e="dependencies"in i?i.dependencies:CT),t&&typeof t!="function"&&console.warn("First parameter must be a function or config object");const{scope:r,revertOnUpdate:n}=i,s=we.useRef(!1),a=we.useRef(cue.context(()=>{},r)),o=we.useRef(c=>a.current.add(null,c)),l=e&&e.length&&!n;return A$(()=>{if(t&&a.current.add(t,r),!l||!s.current)return()=>a.current.revert()},e),l&&A$(()=>(s.current=!0,()=>a.current.revert()),CT),{context:a.current,contextSafe:o.current}};nx.register=t=>{cue=t};nx.headless=!0;const eZe=t=>{const e=we.useRef(),{scene:i}=$o("https://vazxmixjsiawhamofees.supabase.co/storage/v1/object/public/models/target-stand/model.gltf");return nx(()=>{rx.to(e.current.position,{y:e.current.position.y+.5,duration:1.5,repeat:-1,yoyo:!0})}),Y.jsx("mesh",{...t,ref:e,rotation:[0,Math.PI/5,0],scale:1.1,children:Y.jsx("primitive",{object:i})})},tZe=t=>{const{nodes:e,materials:i}=$o("https://bbhoom.github.io/Portfolio3D/models/react.glb");return Y.jsx(rse,{floatIntensity:1,children:Y.jsx("group",{position:[8,8,0],scale:.2,...t,ispose:null,children:Y.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e["React-Logo_Material002_0"].geometry,material:i["Material.002"],rotation:[0,0,-Math.PI/2],scale:[.39,.39,.5]})})})};$o.preload("/Portfolio3D/models/react.glb");const iZe=({...t})=>{const{nodes:e}=$o("/Portfolio3D/models/cube.glb"),i=yD("textures/cube.png"),r=we.useRef(),[n,s]=we.useState(!1);return nx(()=>{rx.timeline({repeat:-1,repeatDelay:.5}).to(r.current.rotation,{y:n?"+=2":`+=${Math.PI*2}`,x:n?"+=2":`-=${Math.PI*2}`,duration:2.5,stagger:{each:.15}})}),Y.jsx(rse,{floatIntensity:2,children:Y.jsx("group",{position:[-20,40,0],rotation:[2.6,.8,-1.8],scale:.4,dispose:null,...t,children:Y.jsx("mesh",{ref:r,castShadow:!0,receiveShadow:!0,geometry:e.Cube.geometry,material:e.Cube.material,onPointerEnter:()=>s(!0),children:Y.jsx("meshMatcapMaterial",{matcap:i,toneMapped:!1})})})})};$o.preload("/Portfolio3D/models/cube.glb");const rZe=({position:t})=>{const e=we.useRef([]),i=we.useCallback(n=>{n&&!e.current.includes(n)&&e.current.push(n)},[]),r=yD("/Portfolio3D/textures/rings.png");return nx(()=>{e.current.length!==0&&(e.current.forEach(n=>{n.position.set(t[0],t[1],t[2])}),rx.timeline({repeat:-1,repeatDelay:.5}).to(e.current.map(n=>n.rotation),{y:`+=${Math.PI*2}`,x:`-=${Math.PI*2}`,duration:2.5,stagger:{each:.15}}))},{dependencies:t}),Y.jsx(ise,{children:Y.jsx("group",{scale:.2,children:Array.from({length:4},(n,s)=>Y.jsxs("mesh",{ref:i,children:[Y.jsx("torusGeometry",{args:[(s+1)*.5,.1]}),Y.jsx("meshMatcapMaterial",{matcap:r,toneMapped:!1})]},s))})})},XU=({name:t,isBeam:e=!1,containerClass:i})=>Y.jsxs("button",{className:`btn ${i}`,children:[e&&Y.jsxs("span",{className:"relative flex h-3 w-3",children:[Y.jsx("span",{className:"btn-ping"}),Y.jsx("span",{className:"btn-ping_dot"})]}),t]}),nZe=()=>{const[t,e]=we.useState(()=>localStorage.getItem("theme")!=="light"),[i,r]=we.useState(!0),n=FI({maxWidth:440}),s=FI({maxWidth:786}),a=FI({minWidth:768,maxWidth:1024}),o=ige(n,s,a);we.useEffect(()=>{const c=()=>{const u=localStorage.getItem("theme");e(u!=="light")};window.addEventListener("storage",c);const h=new MutationObserver(u=>{u.forEach(d=>{if(d.attributeName==="class"){const f=document.documentElement.classList.contains("dark");e(f)}})});return h.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>{window.removeEventListener("storage",c),h.disconnect()}},[]);const l=()=>{r(!1)};return Y.jsxs("section",{className:`min-h-screen w-full flex flex-col relative transition-colors duration-500 ${t?"bg-black":"bg-gradient-to-b from-[#faedcd] to-[#f9dcc4] text-black"}`,id:"home",children:[Y.jsxs("div",{className:"w-full mx-auto flex flex-col sm:mt-36 c-space mt-14 gap-3",children:[Y.jsxs("p",{className:`sm:text-3xl text-2xl font-medium text-center fornt-genralsans ${t?"text-white":"text-black"}`,children:["Hi,I am Bhoomika",Y.jsx("span",{className:"waving-hand",children:""})]}),Y.jsx("p",{className:`hero_tag text-center ${t?"text-gray-300":"text-neutral-700"}`,children:"Software Developer and Student"})]}),Y.jsxs("div",{className:"absolute w-full h-full bottom-[11%] flex justify-center items-center z-20",children:[i&&Y.jsxs("div",{className:"absolute top-3/4 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-30",children:[Y.jsx("div",{className:`w-16 h-16 border-4 border-t-4 ${t?"border-gray-800 border-t-blue-500":"border-gray-200 border-t-blue-600"} rounded-full animate-spin`}),Y.jsx("p",{className:`mt-4 font-medium text-center ${t?"text-gray-300":"text-gray-700"}`,children:"Loading 3D Model..."})]}),Y.jsx(N$e,{scene:"https://draft.spline.design/Ln0E2BXuZkkOuhxz/scene.splinecode",style:{transform:"scale(0.6)",marginTop:"282px"},onLoad:l})]}),Y.jsx("div",{className:"absolute w-full h-full top-0 flex justify-center items-center z-10",children:Y.jsxs(vD,{camera:{position:[0,2,10],fov:50},children:[Y.jsx("ambientLight",{intensity:1}),Y.jsx("directionalLight",{position:[0,5,5],intensity:1.5}),Y.jsxs("group",{children:[Y.jsx(eZe,{position:o.targetPosition}),Y.jsx(tZe,{position:o.reactLogoPosition}),Y.jsx(iZe,{position:o.cubePosition}),Y.jsx(rZe,{position:o.ringPosition})]}),Y.jsx(xD,{})]})}),Y.jsxs("div",{className:"absolute bottom-2 left-0 right-0 flex justify-center gap-4 flex-wrap z-10 px-8",children:[Y.jsx("a",{href:"#contact",children:Y.jsx(XU,{isBeam:!0,name:"Let's work together",className:"px-6 py-3 rounded-2xl font-semibold transition-all duration-300 shadow-lg transform hover:-translate-y-1 hover:shadow-xl"})}),Y.jsx("a",{href:"assets\\Bhoomika_Resume.pdf",download:!0,children:Y.jsx(XU,{isBeam:!0,name:"Download Resume",className:"px-6 py-3 rounded-2xl font-semibold transition-all duration-300 shadow-lg transform hover:-translate-y-1 hover:shadow-xl"})})]})]})},SV=()=>{const{progress:t}=X_e();return Y.jsxs(G_e,{as:"div",center:!0,style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[Y.jsx("span",{className:"canvas-loader"}),Y.jsx("p",{style:{fontSize:14,color:"#F1F1F1",fontWeight:800,marginTop:40},children:t!==0?`${t.toFixed(2)}%`:"Loading..."})]})},sZe=()=>{const t=$o("./planet/scene.gltf");return Y.jsx("primitive",{object:t.scene,scale:2.5,"position-y":0,"rotation-y":0})},aZe=()=>Y.jsx(vD,{shadows:!0,frameloop:"demand",dpr:[1,2],gl:{preserveDrawingBuffer:!0},camera:{fov:45,near:.1,far:200,position:[-4,3,6]},children:Y.jsxs(we.Suspense,{fallback:Y.jsx(SV,{}),children:[Y.jsx(xD,{autoRotate:!0,enableZoom:!0,maxPolarAngle:Math.PI/2,minPolarAngle:Math.PI/2}),Y.jsx(sZe,{}),Y.jsx(qCe,{all:!0})]})});class oZe{constructor(e,i,r,n,s,a,o){this.width=e.width,this.height=e.height,this.ctx=i,this.x=r,this.y=n,this.color=s,this.speed=this.getRandomValue(.1,.9)*a,this.size=0,this.sizeStep=Math.random()*.4,this.minSize=.5,this.maxSizeInteger=2,this.maxSize=this.getRandomValue(this.minSize,this.maxSizeInteger),this.delay=o,this.counter=0,this.counterStep=Math.random()*4+(this.width+this.height)*.01,this.isIdle=!1,this.isReverse=!1,this.isShimmer=!1}getRandomValue(e,i){return Math.random()*(i-e)+e}draw(){const e=this.maxSizeInteger*.5-this.size*.5;this.ctx.fillStyle=this.color,this.ctx.fillRect(this.x+e,this.y+e,this.size,this.size)}appear(){if(this.isIdle=!1,this.counter<=this.delay){this.counter+=this.counterStep;return}this.size>=this.maxSize&&(this.isShimmer=!0),this.isShimmer?this.shimmer():this.size+=this.sizeStep,this.draw()}disappear(){if(this.isShimmer=!1,this.counter=0,this.size<=0){this.isIdle=!0;return}else this.size-=.1;this.draw()}shimmer(){this.size>=this.maxSize?this.isReverse=!0:this.size<=this.minSize&&(this.isReverse=!1),this.isReverse?this.size-=this.speed:this.size+=this.speed}}function lZe(t,e){const s=parseInt(t,10);return s<=0||e?0:s>=100?100*.001:s*.001}const M$={default:{activeColor:null,gap:5,speed:35,colors:"#f8fafc,#f1f5f9,#cbd5e1",noFocus:!1},blue:{activeColor:"#e0f2fe",gap:10,speed:25,colors:"#e0f2fe,#7dd3fc,#0ea5e9",noFocus:!1},yellow:{activeColor:"#fef08a",gap:3,speed:20,colors:"#fef08a,#fde047,#eab308",noFocus:!1},pink:{activeColor:"#fecdd3",gap:6,speed:25,colors:"#fecdd3,#fda4af,#e11d48",noFocus:!0}};function cZe({variant:t="default",gap:e,speed:i,colors:r,noFocus:n,className:s="",children:a}){const o=we.useRef(null),l=we.useRef(null),c=we.useRef([]),h=we.useRef(null),u=we.useRef(performance.now()),d=we.useRef(window.matchMedia("(prefers-reduced-motion: reduce)").matches).current,f=M$[t]||M$.default,p=e??f.gap,m=i??f.speed,g=r??f.colors,v=n??f.noFocus,y=()=>{if(!o.current||!l.current)return;const T=o.current.getBoundingClientRect(),C=Math.floor(T.width),D=Math.floor(T.height),B=l.current.getContext("2d");l.current.width=C,l.current.height=D,l.current.style.width=`${C}px`,l.current.style.height=`${D}px`;const O=g.split(","),L=[];for(let H=0;H<C;H+=parseInt(p,10))for(let q=0;q<D;q+=parseInt(p,10)){const W=O[Math.floor(Math.random()*O.length)],I=H-C/2,z=q-D/2,U=Math.sqrt(I*I+z*z),X=d?0:U;L.push(new oZe(l.current,B,H,q,W,lZe(m,d),X))}c.current=L},x=T=>{var H;h.current=requestAnimationFrame(()=>x(T));const C=performance.now(),D=C-u.current,B=1e3/60;if(D<B)return;u.current=C-D%B;const O=(H=l.current)==null?void 0:H.getContext("2d");if(!O||!l.current)return;O.clearRect(0,0,l.current.width,l.current.height);let L=!0;for(let q=0;q<c.current.length;q++){const W=c.current[q];W[T](),W.isIdle||(L=!1)}L&&cancelAnimationFrame(h.current)},S=T=>{cancelAnimationFrame(h.current),h.current=requestAnimationFrame(()=>x(T))},A=()=>S("appear"),_=()=>S("disappear"),M=T=>{T.currentTarget.contains(T.relatedTarget)||S("appear")},E=T=>{T.currentTarget.contains(T.relatedTarget)||S("disappear")};return we.useEffect(()=>{y();const T=new ResizeObserver(()=>{y()});return o.current&&T.observe(o.current),()=>{T.disconnect(),cancelAnimationFrame(h.current)}},[p,m,g,v]),Y.jsxs("div",{ref:o,className:`pixel-card ${s}`,onMouseEnter:A,onMouseLeave:_,onFocus:v?void 0:M,onBlur:v?void 0:E,tabIndex:v?-1:0,children:[Y.jsx("canvas",{className:"piexl-canvas",ref:l}),a]})}const hZe=()=>{const[t,e]=we.useState(!1),[i,r]=we.useState(()=>localStorage.getItem("theme")!=="light");we.useEffect(()=>{const s=()=>{const l=document.documentElement.classList.contains("dark");r(l)};s();const a=new MutationObserver(l=>{l.forEach(c=>{c.attributeName==="class"&&s()})});a.observe(document.documentElement,{attributes:!0});const o=l=>{l.key==="theme"&&r(l.newValue!=="light")};return window.addEventListener("storage",o),()=>{a.disconnect(),window.removeEventListener("storage",o)}},[]);const n=()=>{navigator.clipboard.writeText("ksbhoomika43@gmail.com"),e(!0),setTimeout(()=>e(!1),2e3)};return Y.jsx("section",{className:`c-space my-20 transition-colors duration-500 ${i?"bg-black":"bg-gradient-to-b from-[#faedcd] to-[#f9dcc4]"}`,id:"about",children:Y.jsxs("div",{className:"grid xl:grid-cols-3 xl:grid-rows-6 md:grid-cols-2 grid-cols-1 gap-5 h-full px-2 sm:px-6",children:[Y.jsx("div",{className:"col-span-1 xl:row-span-3",children:Y.jsxs("div",{className:`grid-container ${i?"bg-black-200 border-black-300":"bg-gradient-to-b from-[#faedcd] to-[#f9dcc4]  bg-opacity-80 border-[#cbb9a9] shadow-md"}`,children:[Y.jsx("img",{src:"assets/grid11.png",alt:"grid-1",className:"w-full sm:h-[276px] h-fit object-contain"}),Y.jsxs("div",{children:[Y.jsx("p",{className:"grid-headtext",children:"Hi, I'm Bhoomika K S"}),Y.jsx("p",{className:"grid-subtext",children:"A B.Tech student in Computer Science and Design Engineering with a GPA of 9.2. I thrive on creating innovative solutions, from AI-powered tools to interactive games."})]})]})}),Y.jsx("div",{className:"col-span-1 xl:row-span-3",children:Y.jsxs("div",{className:`grid-container ${i?"bg-black-200 border-black-300":"bg-gradient-to-b from-[#faedcd] to-[#f9dcc4] bg-opacity-80 border-[#cbb9a9] shadow-md"}`,children:[Y.jsx("img",{src:"assets/grid2.png",alt:"grid-2",className:"w-full sm:h-[276px] h-fit object-contain"}),Y.jsxs("div",{children:[Y.jsx("p",{className:"grid-headtext",children:"Tech Stack"}),Y.jsxs("p",{className:"grid-subtext",children:["I am proficient in Python, C, Java, HTML/CSS, JavaScript, and SQL.",Y.jsx("br",{}),"My toolkit includes React, Bootstrap, Django, Pygame, Tkinter, and Three.js, alongside tools like GitHub and VS Code.",Y.jsx("br",{}),"This diverse stack empowers me to build efficient, user-friendly applications."]})]})]})}),Y.jsx("div",{className:"col-span-1 xl:row-span-4",children:Y.jsxs("div",{className:`grid-container ${i?"bg-black-200 border-black-300":"bg-gradient-to-b from-[#faedcd] to-[#f9dcc4]] bg-opacity-80 border-[#e0cebe] shadow-md"}`,children:[Y.jsx("div",{className:"rounded-3xl w-full sm:h-[326px] h-fit flex justify-center items-center",children:Y.jsx(aZe,{})}),Y.jsxs("div",{children:[Y.jsx("p",{className:"grid-headtext",children:"I'm very flexible with time zone communications & locations"}),Y.jsx("p",{className:"grid-subtext",children:"I'm based in Banglore, India and open to remote work worldwide."}),Y.jsx("a",{href:"#contact",children:Y.jsx(XU,{name:"Contact Me",isBeam:!0,containerClass:"w-full mt-10"})})]})]})}),Y.jsx("div",{className:"xl:col-span-2 xl:row-span-3",children:Y.jsx(cZe,{variant:"pink",className:i?"bg-black-200 border-black-300":"bg-gradient-to-b from-[#faedcd] to-[#f9dcc4] bg-opacity-80  shadow-md",children:Y.jsx("div",{className:"absolute inset-0 z-10",children:Y.jsxs("div",{className:"grid-container",children:[Y.jsx("img",{src:"assets/grid3.png",alt:"grid-3",className:"w-full sm:h-[266px] object-contain"}),Y.jsxs("div",{children:[Y.jsx("p",{className:"grid-headtext",children:"My Passion for Coding"}),Y.jsx("p",{className:"grid-subtext",children:"I am passionate about leveraging technology to solve real-world problems, whether through AI-powered healthcare tools, intuitive budget apps, or interactive games. My achievements include winning Blitz'24 for an AI healthcare chatbot and contributing to patents for an ambulance booking app and a skincare smart mirror. I enjoy combining development and design to create impactful solutions."})]})]})})})}),Y.jsx("div",{className:"xl:col-span-1 xl:row-span-2",children:Y.jsxs("div",{className:`grid-container ${i?"bg-black-200 border-black-300":"bg-gradient-to-b from-[#faedcd] to-[#f9dcc4] bg-opacity-80  shadow-md"}`,children:[Y.jsx("img",{src:"assets/grid4.png",alt:"grid-4",className:"w-full md:h-[126px] sm:h-[276px] h-fit object-cover sm:object-top"}),Y.jsxs("div",{className:"space-y-2",children:[Y.jsx("p",{className:`grid-subtext text-center ${!i&&"text-gray-600"}`,children:"My Email"}),Y.jsxs("div",{className:"copy-container cursor-pointer",onClick:n,children:[Y.jsx("img",{src:t?"assets/tick.svg":"assets/copy.svg",alt:"copy"}),Y.jsx("p",{className:`lg:text-2xl md:text-xl font-medium ${i?"text-gray_gradient text-white":"text-gray-800"}`,children:"ksbhoomika43@gmail.com"})]})]})]})})]})})},uZe=t=>{const e=we.useRef(),{nodes:i,materials:r}=$o("https://bbhoom.github.io/Portfolio3D/models/computer.glb"),n=YCe(t.texture?t.texture:"/textures/project/project1.mp4");return we.useEffect(()=>{n&&(n.flipY=!1)},[n]),nx(()=>{rx.from(e.current.rotation,{y:Math.PI/2,duration:1,ease:"power3.out"})},[n]),Y.jsx("group",{ref:e,...t,dispose:null,children:Y.jsxs("group",{name:"Scene",children:[Y.jsx("mesh",{name:"monitor-screen",castShadow:!0,receiveShadow:!0,geometry:i["monitor-screen"].geometry,material:i["monitor-screen"].material,position:[.127,1.831,.511],rotation:[1.571,-.005,.031],scale:[.661,.608,.401],children:Y.jsx("meshBasicMaterial",{map:n})}),Y.jsxs("group",{name:"RootNode",position:[0,1.093,0],rotation:[-Math.PI/2,0,-.033],scale:.045,children:[Y.jsx("group",{name:"Screen001",position:[5.658,1.643,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen002",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen003",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen004",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen005",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen006",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen007",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen008",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen009",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen010",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen011",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen012",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen013",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen014",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen015",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen016",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen017",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen018",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen019",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen020",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen021",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen022",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen023",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen024",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen025",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen026",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen027",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen028",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen029",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen030",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen031",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen032",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen033",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen034",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen035",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen036",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen037",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen038",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen039",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen040",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen041",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen042",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen043",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen044",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen045",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen046",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen047",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen048",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen049",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen050",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen051",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen052",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen053",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen054",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen055",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen056",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen057",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen058",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen059",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen060",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen061",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen062",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen063",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen064",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen065",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen066",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen067",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen068",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen069",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen070",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen071",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen072",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen073",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen074",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen075",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen076",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen077",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen078",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen079",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen080",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen081",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen082",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen083",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen084",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen085",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen086",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen087",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen088",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen089",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen090",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen091",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen092",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen093",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen094",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen095",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen096",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen097",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen098",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen099",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen100",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen101",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen102",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen103",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen104",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen105",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen106",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen107",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen108",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen109",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen110",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen111",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen112",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen113",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen114",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen115",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen116",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen117",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen118",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen119",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen120",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen121",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen122",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen123",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen124",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen125",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen126",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen127",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen128",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen129",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen130",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen131",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen132",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen133",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen134",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen135",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen136",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen137",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen138",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen139",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen140",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen141",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen142",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen143",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen144",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen145",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen146",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen147",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Screen148",position:[5.658,1.644,.812],rotation:[Math.PI/2,0,0],scale:[.923,.855,.855]}),Y.jsx("group",{name:"Tower-light-007",position:[16.089,-3.47,-14.495],rotation:[Math.PI/2,0,0],scale:.963}),Y.jsx("group",{name:"Tower-light-008",position:[15.155,-3.47,-14.495],rotation:[Math.PI/2,0,0],scale:.963})]}),Y.jsxs("group",{name:"Monitor-B-_computer_0",position:[.266,1.132,.051],rotation:[0,-.033,0],scale:[.042,.045,.045],children:[Y.jsx("mesh",{name:"Monitor-B-_computer_0_1",castShadow:!0,receiveShadow:!0,geometry:i["Monitor-B-_computer_0_1"].geometry,material:r.computer}),Y.jsx("mesh",{name:"Monitor-B-_computer_0_2",castShadow:!0,receiveShadow:!0,geometry:i["Monitor-B-_computer_0_2"].geometry,material:r.base__0}),Y.jsx("mesh",{name:"Monitor-B-_computer_0_3",castShadow:!0,receiveShadow:!0,geometry:i["Monitor-B-_computer_0_3"].geometry,material:r.Material_36}),Y.jsx("mesh",{name:"Monitor-B-_computer_0_4",castShadow:!0,receiveShadow:!0,geometry:i["Monitor-B-_computer_0_4"].geometry,material:r.Material_35}),Y.jsx("mesh",{name:"Monitor-B-_computer_0_5",castShadow:!0,receiveShadow:!0,geometry:i["Monitor-B-_computer_0_5"].geometry,material:r.Material_34}),Y.jsx("mesh",{name:"Monitor-B-_computer_0_6",castShadow:!0,receiveShadow:!0,geometry:i["Monitor-B-_computer_0_6"].geometry,material:r.keys}),Y.jsx("mesh",{name:"Monitor-B-_computer_0_7",castShadow:!0,receiveShadow:!0,geometry:i["Monitor-B-_computer_0_7"].geometry,material:r.keys2}),Y.jsx("mesh",{name:"Monitor-B-_computer_0_8",castShadow:!0,receiveShadow:!0,geometry:i["Monitor-B-_computer_0_8"].geometry,material:r.Material_37})]})]})})};$o.preload("/Portfolio3D/models/computer.glb");const gB=SF.length,dZe=()=>{const[t,e]=we.useState(0),i=SF[t],r=n=>{e(s=>n==="previous"?s===0?gB-1:s-1:s===gB-1?0:s+1)};return Y.jsxs("section",{className:"c-space my-20",id:"work",children:[Y.jsx("p",{className:"head-text",children:"My Projects"}),Y.jsxs("div",{className:"grid lg:grid-cols-2 grid-cols-1 mt-14 gap-5 w-full",children:[Y.jsxs("div",{className:"flex flex-col gap-5 relative sm:p-10 py-10 px-5 shadow-2xl shadow-black-200",children:[Y.jsx("div",{className:"absolute top-0 right-0",children:Y.jsx("img",{src:i.spotlight,alt:"spotlight",className:"w-full h-96 object-cover rounded-xl"})}),Y.jsx("div",{className:"p-3 backdrop-filter backdrop-blur-3xl w-fit rounded-lg",style:SF[0].logoStyle,children:Y.jsx("img",{src:i.logo,alt:"logo",className:"w-10 h-10 shadow-sm"})}),Y.jsxs("div",{className:"flex flex-col gap-5 text-gray-800 dark:text-white my-5",children:[Y.jsx("p",{className:"text-black-300 dark:text-white text-2xl font-semibold animatedText",children:i.title}),Y.jsx("p",{className:"animatedText",children:i.desc}),Y.jsx("p",{className:"animatedText",children:i.subdesc})]}),Y.jsxs("div",{className:"flex items-center justify-between flex-wrap-5",children:[Y.jsx("div",{className:"flex items-center gap-3",children:i.tags.map((n,s)=>Y.jsx("div",{className:"tech-logo",children:Y.jsx("img",{src:n.path,alt:n.name})},s))}),Y.jsxs("a",{className:"flex items-center gap-2 cursor-pointer text-white-100 dark:text-white-600",href:i.href,target:"_blank",rel:"noreffer",children:[Y.jsx("p",{children:"Check Live Site"}),Y.jsx("img",{src:"assets/arrow-up.png",alt:"uparrow",className:"w-3 h-3"})]})]}),Y.jsxs("div",{className:"flex justify-between items-center mt-7",children:[Y.jsx("button",{className:"arrow-btn",onClick:()=>r("previous"),children:Y.jsx("img",{src:"assets/left-arrow.png",alt:"left",className:"w-4 h-4"})}),Y.jsx("div",{className:"text-center text-black-300 dark:text-white text-sm",children:`Project ${t+1} of ${gB}`}),Y.jsx("button",{className:"arrow-btn",onClick:()=>r("next"),children:Y.jsx("img",{src:"assets/right-arrow.png",alt:"right",className:"w-4 h-4"})})]})]}),Y.jsx("div",{className:"border border-black-300 bg-black-200 rounded-lg h-96 md:h-full",children:Y.jsxs(vD,{children:[Y.jsx("ambientLight",{intensity:Math.PI}),Y.jsx("directionalLight",{position:[10,10,5]}),Y.jsx(ise,{children:Y.jsx(we.Suspense,{fallback:Y.jsx(SV,{}),children:Y.jsx("group",{scale:2,position:[0,-3,0],rotation:[0,-.1,0],children:Y.jsx(uZe,{texture:i.texture})})})}),Y.jsx(xD,{maxPolarAngle:Math.PI/2,enableZoom:!1})]})})]})]})},fZe=({type:t,text:e})=>Y.jsx("div",{className:"fixed bottom-5 right-5 flex justify-center items-center z-50",children:Y.jsxs("div",{className:`p-2 ${t==="danger"?"bg-red-800":"bg-blue-800"} items-center text-indigo-100 leading-none lg:rounded-full flex lg:inline-flex rounded-md p-5`,role:"alert",children:[Y.jsx("p",{className:`flex rounded-full ${t==="danger"?"bg-red-500":"bg-blue-500"} uppercase px-2 py-1 text-xs font-semibold mr-3`,children:t==="danger"?"Failed":"Success"}),Y.jsx("p",{className:"mr-2 text-left",children:e})]})}),pZe=t=>{const e=we.useRef(),i=we.useRef(),r=we.useRef(),n=we.useRef(),s=we.useRef(),a=we.useRef(),o=we.useRef({time:0});we.useEffect(()=>{if(t.RightArm&&(e.current=t.RightArm,e.current.initialRotation=new Cl(.4,1.4,-Math.PI/3),e.current.rotation.set(e.current.initialRotation.x,e.current.initialRotation.y,e.current.initialRotation.z)),t.LeftArm&&(i.current=t.LeftArm,i.current.initialRotation=new Cl(1.1,.2,-.2)),t.Head&&(r.current=t.Head,r.current.initialRotation=new Cl(.2,0,0)),t.RightLeg&&(n.current=t.RightLeg,n.current.initialRotation=new Cl(0,.2,0)),t.LeftLeg&&(s.current=t.LeftLeg,s.current.initialRotation=new Cl(0,-.3,0)),t.Hips&&(a.current=t.Hips,a.current.initialRotation=new Cl(0,.2,0)),e.current&&e.current.rotation.set(e.current.initialRotation.x,e.current.initialRotation.y,e.current.initialRotation.z),i.current&&i.current.rotation.set(i.current.initialRotation.x,i.current.initialRotation.y,i.current.initialRotation.z),r.current){const l=Math.sin(o.current.time*2)*.02;r.current.rotation.set(r.current.initialRotation.x+l,r.current.initialRotation.y,r.current.initialRotation.z)}a.current&&a.current.rotation.set(a.current.initialRotation.x,a.current.initialRotation.y,a.current.initialRotation.z),n.current&&n.current.rotation.set(n.current.initialRotation.x,n.current.initialRotation.y,n.current.initialRotation.z),s.current&&s.current.rotation.set(s.current.initialRotation.x,s.current.initialRotation.y,s.current.initialRotation.z)},[t]),gD((l,c)=>{if(o.current.time+=c,e.current){const h=Math.sin(o.current.time*3)*.4;e.current.rotation.set(e.current.initialRotation.x+h,e.current.initialRotation.y,e.current.initialRotation.z)}if(i.current){const h=Math.sin(o.current.time)*.02;i.current.rotation.set(i.current.initialRotation.x+h,i.current.initialRotation.y,i.current.initialRotation.z)}})},mZe=t=>{const{nodes:e,materials:i}=$o("models/Human/Developer.glb"),r=we.useRef();return pZe(e),Y.jsxs("group",{ref:r,...t,dispose:null,children:[Y.jsx("primitive",{object:e.Hips}),Y.jsx("skinnedMesh",{name:"EyeLeft",geometry:e.EyeLeft.geometry,material:i.Wolf3D_Eye,skeleton:e.EyeLeft.skeleton,morphTargetDictionary:e.EyeLeft.morphTargetDictionary,morphTargetInfluences:e.EyeLeft.morphTargetInfluences}),Y.jsx("skinnedMesh",{name:"EyeRight",geometry:e.EyeRight.geometry,material:i.Wolf3D_Eye,skeleton:e.EyeRight.skeleton,morphTargetDictionary:e.EyeRight.morphTargetDictionary,morphTargetInfluences:e.EyeRight.morphTargetInfluences}),Y.jsx("skinnedMesh",{name:"Wolf3D_Head",geometry:e.Wolf3D_Head.geometry,material:i.Wolf3D_Skin,skeleton:e.Wolf3D_Head.skeleton,morphTargetDictionary:e.Wolf3D_Head.morphTargetDictionary,morphTargetInfluences:e.Wolf3D_Head.morphTargetInfluences}),Y.jsx("skinnedMesh",{name:"Wolf3D_Teeth",geometry:e.Wolf3D_Teeth.geometry,material:i.Wolf3D_Teeth,skeleton:e.Wolf3D_Teeth.skeleton,morphTargetDictionary:e.Wolf3D_Teeth.morphTargetDictionary,morphTargetInfluences:e.Wolf3D_Teeth.morphTargetInfluences}),Y.jsx("skinnedMesh",{geometry:e.Wolf3D_Hair.geometry,material:i.Wolf3D_Hair,skeleton:e.Wolf3D_Hair.skeleton}),Y.jsx("skinnedMesh",{geometry:e.Wolf3D_Body.geometry,material:i.Wolf3D_Body,skeleton:e.Wolf3D_Body.skeleton}),Y.jsx("skinnedMesh",{geometry:e.Wolf3D_Outfit_Bottom.geometry,material:i.Wolf3D_Outfit_Bottom,skeleton:e.Wolf3D_Outfit_Bottom.skeleton}),Y.jsx("skinnedMesh",{geometry:e.Wolf3D_Outfit_Footwear.geometry,material:i.Wolf3D_Outfit_Footwear,skeleton:e.Wolf3D_Outfit_Footwear.skeleton}),Y.jsx("skinnedMesh",{geometry:e.Wolf3D_Outfit_Top.geometry,material:i.Wolf3D_Outfit_Top,skeleton:e.Wolf3D_Outfit_Top.skeleton})]})};$o.preload("models/Human/Developer.glb");const gZe=()=>{const[t,e]=we.useState({show:!1,text:"",type:"danger"});return{alert:t,showAlert:({text:n,type:s="danger"})=>e({show:!0,text:n,type:s}),hideAlert:()=>e({show:!1,text:"",type:"danger"})}},vZe=()=>{const t=we.useRef(),{alert:e,showAlert:i,hideAlert:r}=gZe(),[n,s]=we.useState(!1),[a,o]=we.useState({name:"",email:"",message:""}),[l,c]=we.useState(!0);we.useEffect(()=>{const f=()=>{const m=document.documentElement.classList.contains("dark");c(m)};f();const p=new MutationObserver(f);return p.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>p.disconnect()},[]);const h=({target:{name:f,value:p}})=>{o({...a,[f]:p})},u=()=>!a.name||!a.email||!a.message?(i({show:!0,text:"Please fill in all fields",type:"danger"}),setTimeout(()=>{r()},3e3),!1):!0,d=async f=>{if(f.preventDefault(),!u())return;s(!0);const p="https://script.google.com/macros/s/AKfycbxknH_qe6TvN82NPUjxFwXRJGu2bKE1kn_Ec2iJRZEWx8Yd3NIrmsJ0HYxW1DjntlgKeg/exec";try{document.getElementById("loading-message").style.display="block";const m=await fetch(p,{method:"POST",body:new FormData(t.current)});s(!1),i({show:!0,text:"Thank you for your message ",type:"success"}),setTimeout(()=>{r()},6e3),o({name:"",email:"",message:""}),setTimeout(()=>{document.getElementById("loading-message").style.display="none",r()},6e4)}catch(m){s(!1),console.error(m),i({show:!0,text:"I didn't receive your message ",type:"danger"}),setTimeout(()=>{document.getElementById("loading-message").style.display="none"},6e4)}};return Y.jsxs("section",{className:"c-space my-20",id:"contact",children:[Y.jsx("p",{className:"head-text",children:"Let's talk"}),Y.jsxs("div",{className:"grid lg:grid-cols-2 grid-cols-1 mt-10 gap-5 w-full",children:[Y.jsx("div",{className:"border border-black-300 bg-black-200 rounded-lg h-96 md:h-full",style:{backgroundImage:'url("assets/bg2.jpg")',backgroundSize:"cover",backgroundPosition:"center"},children:Y.jsxs(vD,{children:[Y.jsx("ambientLight",{intensity:4}),Y.jsx("spotLight",{position:[8,8,8],angle:.15,penumbra:1}),Y.jsx("directionalLight",{position:[8,8,8],intensity:.6}),Y.jsx(xD,{enableZoom:!1,maxPolarAngle:Math.PI/2,minPolarAngle:Math.PI/2}),Y.jsx(we.Suspense,{fallback:Y.jsx(SV,{}),children:Y.jsx(mZe,{"position-y":-3,scale:3})})]})}),Y.jsxs("div",{className:`flex flex-col gap-5 relative sm:p-10 py-5 px-5 rounded-lg ${l?"":"bg-gradient-to-b from-[#faedcd] to-[#f9dcc4] text-black"}`,children:[e.show&&Y.jsx(fZe,{...e}),Y.jsx("div",{className:`contact-form-wrapper ${l?"dark-mode":"light-mode"}`,children:Y.jsxs("form",{ref:t,className:"form",onSubmit:d,children:[Y.jsxs("div",{className:"title",children:["Get in Touch",Y.jsx("p",{children:Y.jsx("span",{children:"Whether you're looking to build a new website, improve your existing platform, or bring a unique project to life, I'm here to help."})})]}),Y.jsx("input",{className:"input",name:"name",placeholder:"Name",type:"text",onChange:h,value:a.name}),Y.jsx("input",{className:"input",name:"email",placeholder:"Email",type:"email",onChange:h,value:a.email}),Y.jsx("textarea",{className:"input",name:"message",placeholder:"Message",onChange:h,value:a.message,style:{height:"100px"}}),Y.jsx("div",{className:"login-with",children:Y.jsxs("ul",{className:"example-2",children:[Y.jsxs("li",{className:"icon-content",children:[Y.jsxs("a",{href:"https://linkedin.com/",target:"_blank","aria-label":"LinkedIn","data-social":"linkedin",children:[Y.jsx("div",{className:"filled"}),Y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",className:"bi bi-linkedin",viewBox:"0 0 16 16",children:Y.jsx("path",{d:"M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"})})]}),Y.jsx("div",{className:"tooltip",children:"LinkedIn"})]}),Y.jsxs("li",{className:"icon-content",children:[Y.jsxs("a",{href:"https://www.github.com/",target:"_blank","aria-label":"GitHub","data-social":"github",children:[Y.jsx("div",{className:"filled"}),Y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",className:"bi bi-github",viewBox:"0 0 16 16",children:Y.jsx("path",{d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8"})})]}),Y.jsx("div",{className:"tooltip",children:"GitHub"})]}),Y.jsxs("li",{className:"icon-content",children:[Y.jsxs("a",{href:"assets\\Bhoomika_Resume.pdf",download:!0,"aria-label":"Download Resume","data-social":"resume",children:[Y.jsx("div",{className:"filled"}),Y.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",className:"bi bi-file-earmark-arrow-down",viewBox:"0 0 16 16",children:[Y.jsx("path",{d:"M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293z"}),Y.jsx("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 1 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"})]})]}),Y.jsx("div",{className:"tooltip",children:"Resume"})]})]})}),Y.jsx("button",{type:"submit",className:"button-confirm",disabled:n,children:n?"Sending...":"Send Message "})]})}),Y.jsx("span",{id:"loading-message",className:`msg text-center block mt-4 ${l?"text-white":"text-black"}`,style:{display:"none"},children:"Please wait, it's loading..."}),Y.jsx("span",{id:"sent-message",className:`msg text-center block mt-4 ${l?"text-white":"text-black"}`,style:{display:"none"},children:"Message sent successfully!"})]})]})]})},hue=we.createContext({});function yZe(t){const e=we.useRef(null);return e.current===null&&(e.current=t()),e.current}const _V=typeof window<"u",xZe=_V?we.useLayoutEffect:we.useEffect,AV=we.createContext(null),uue=we.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function bZe(t=!0){const e=we.useContext(AV);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:r,register:n}=e,s=we.useId();we.useEffect(()=>{if(t)return n(s)},[t]);const a=we.useCallback(()=>t&&r&&r(s),[s,r,t]);return!i&&r?[!1,a]:[!0]}function EV(t,e){t.indexOf(e)===-1&&t.push(e)}function MV(t,e){const i=t.indexOf(e);i>-1&&t.splice(i,1)}const jo=t=>t;let YU=jo;const wZe={skipAnimations:!1,useManualTiming:!1};function TV(t){let e;return()=>(e===void 0&&(e=t()),e)}const E1=(t,e,i)=>{const r=e-t;return r===0?1:(i-t)/r};class CV{constructor(){this.subscriptions=[]}add(e){return EV(this.subscriptions,e),()=>MV(this.subscriptions,e)}notify(e,i,r){const n=this.subscriptions.length;if(n)if(n===1)this.subscriptions[0](e,i,r);else for(let s=0;s<n;s++){const a=this.subscriptions[s];a&&a(e,i,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const sd=t=>t*1e3,ad=t=>t/1e3;function due(t,e){return e?t*(1e3/e):0}const SZe=TV(()=>window.ScrollTimeline!==void 0);class _Ze{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,i){for(let r=0;r<this.animations.length;r++)this.animations[r][e]=i}attachTimeline(e,i){const r=this.animations.map(n=>{if(SZe()&&n.attachTimeline)return n.attachTimeline(e);if(typeof i=="function")return i(n)});return()=>{r.forEach((n,s)=>{n&&n(),this.animations[s].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let i=0;i<this.animations.length;i++)e=Math.max(e,this.animations[i].duration);return e}runAll(e){this.animations.forEach(i=>i[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class AZe extends _Ze{then(e,i){return Promise.all(this.animations).then(e).catch(i)}}function PV(t,e){return t?t[e]||t.default||t:void 0}const qU=2e4;function fue(t){let e=0;const i=50;let r=t.next(e);for(;!r.done&&e<qU;)e+=i,r=t.next(e);return e>=qU?1/0:e}function DV(t){return typeof t=="function"}function T$(t,e){t.timeline=e,t.onfinish=null}const RV=t=>Array.isArray(t)&&typeof t[0]=="number",EZe={linearEasing:void 0};function MZe(t,e){const i=TV(t);return()=>{var r;return(r=EZe[e])!==null&&r!==void 0?r:i()}}const IP=MZe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),pue=(t,e,i=10)=>{let r="";const n=Math.max(Math.round(e/i),2);for(let s=0;s<n;s++)r+=t(E1(0,n-1,s))+", ";return`linear(${r.substring(0,r.length-2)})`};function mue(t){return!!(typeof t=="function"&&IP()||!t||typeof t=="string"&&(t in KU||IP())||RV(t)||Array.isArray(t)&&t.every(mue))}const Wb=([t,e,i,r])=>`cubic-bezier(${t}, ${e}, ${i}, ${r})`,KU={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Wb([0,.65,.55,1]),circOut:Wb([.55,0,1,.45]),backIn:Wb([.31,.01,.66,-.59]),backOut:Wb([.33,1.53,.69,.99])};function gue(t,e){if(t)return typeof t=="function"&&IP()?pue(t,e):RV(t)?Wb(t):Array.isArray(t)?t.map(i=>gue(i,e)||KU.easeOut):KU[t]}const PT=["read","resolveKeyframes","update","preRender","render","postRender"],C$={value:null,addProjectionMetrics:null};function TZe(t,e){let i=new Set,r=new Set,n=!1,s=!1;const a=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1},l=0;function c(u){a.has(u)&&(h.schedule(u),t()),l++,u(o)}const h={schedule:(u,d=!1,f=!1)=>{const m=f&&n?i:r;return d&&a.add(u),m.has(u)||m.add(u),u},cancel:u=>{r.delete(u),a.delete(u)},process:u=>{if(o=u,n){s=!0;return}n=!0,[i,r]=[r,i],i.forEach(c),e&&C$.value&&C$.value.frameloop[e].push(l),l=0,i.clear(),n=!1,s&&(s=!1,h.process(u))}};return h}const CZe=40;function vue(t,e){let i=!1,r=!0;const n={delta:0,timestamp:0,isProcessing:!1},s=()=>i=!0,a=PT.reduce((v,y)=>(v[y]=TZe(s,e?y:void 0),v),{}),{read:o,resolveKeyframes:l,update:c,preRender:h,render:u,postRender:d}=a,f=()=>{const v=performance.now();i=!1,n.delta=r?1e3/60:Math.max(Math.min(v-n.timestamp,CZe),1),n.timestamp=v,n.isProcessing=!0,o.process(n),l.process(n),c.process(n),h.process(n),u.process(n),d.process(n),n.isProcessing=!1,i&&e&&(r=!1,t(f))},p=()=>{i=!0,r=!0,n.isProcessing||t(f)};return{schedule:PT.reduce((v,y)=>{const x=a[y];return v[y]=(S,A=!1,_=!1)=>(i||p(),x.schedule(S,A,_)),v},{}),cancel:v=>{for(let y=0;y<PT.length;y++)a[PT[y]].cancel(v)},state:n,steps:a}}const{schedule:Er,cancel:_p,state:Gs,steps:vB}=vue(typeof requestAnimationFrame<"u"?requestAnimationFrame:jo,!0),{schedule:IV,cancel:bnt}=vue(queueMicrotask,!1);let PC;function PZe(){PC=void 0}const Nh={now:()=>(PC===void 0&&Nh.set(Gs.isProcessing||wZe.useManualTiming?Gs.timestamp:performance.now()),PC),set:t=>{PC=t,queueMicrotask(PZe)}},gc={x:!1,y:!1};function yue(){return gc.x||gc.y}function DZe(t){return t==="x"||t==="y"?gc[t]?null:(gc[t]=!0,()=>{gc[t]=!1}):gc.x||gc.y?null:(gc.x=gc.y=!0,()=>{gc.x=gc.y=!1})}function RZe(t,e,i){var r;if(t instanceof EventTarget)return[t];if(typeof t=="string"){let n=document;const s=(r=void 0)!==null&&r!==void 0?r:n.querySelectorAll(t);return s?Array.from(s):[]}return Array.from(t)}function xue(t,e){const i=RZe(t),r=new AbortController,n={passive:!0,...e,signal:r.signal};return[i,n,()=>r.abort()]}function P$(t){return!(t.pointerType==="touch"||yue())}function IZe(t,e,i={}){const[r,n,s]=xue(t,i),a=o=>{if(!P$(o))return;const{target:l}=o,c=e(l,o);if(typeof c!="function"||!l)return;const h=u=>{P$(u)&&(c(u),l.removeEventListener("pointerleave",h))};l.addEventListener("pointerleave",h,n)};return r.forEach(o=>{o.addEventListener("pointerenter",a,n)}),s}const bue=(t,e)=>e?t===e?!0:bue(t,e.parentElement):!1,LV=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,LZe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function OZe(t){return LZe.has(t.tagName)||t.tabIndex!==-1}const Xb=new WeakSet;function D$(t){return e=>{e.key==="Enter"&&t(e)}}function yB(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const BZe=(t,e)=>{const i=t.currentTarget;if(!i)return;const r=D$(()=>{if(Xb.has(i))return;yB(i,"down");const n=D$(()=>{yB(i,"up")}),s=()=>yB(i,"cancel");i.addEventListener("keyup",n,e),i.addEventListener("blur",s,e)});i.addEventListener("keydown",r,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",r),e)};function R$(t){return LV(t)&&!yue()}function FZe(t,e,i={}){const[r,n,s]=xue(t,i),a=o=>{const l=o.currentTarget;if(!R$(o)||Xb.has(l))return;Xb.add(l);const c=e(l,o),h=(f,p)=>{window.removeEventListener("pointerup",u),window.removeEventListener("pointercancel",d),!(!R$(f)||!Xb.has(l))&&(Xb.delete(l),typeof c=="function"&&c(f,{success:p}))},u=f=>{h(f,l===window||l===document||i.useGlobalTarget||bue(l,f.target))},d=f=>{h(f,!1)};window.addEventListener("pointerup",u,n),window.addEventListener("pointercancel",d,n)};return r.forEach(o=>{(i.useGlobalTarget?window:o).addEventListener("pointerdown",a,n),o instanceof HTMLElement&&(o.addEventListener("focus",c=>BZe(c,n)),!OZe(o)&&o.tabIndex===null&&(o.tabIndex=0))}),s}const I$=30,kZe=t=>!isNaN(parseFloat(t));class NZe{constructor(e,i={}){this.version="12.6.1",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(r,n=!0)=>{const s=Nh.now();this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),n&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=Nh.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=kZe(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new CV);const r=this.events[e].add(i);return e==="change"?()=>{r(),Er.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e,i=!0){!i||!this.passiveEffect?this.updateAndNotify(e,i):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,i,r){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Nh.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>I$)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,I$);return due(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function GS(t,e){return new NZe(t,e)}const wue=we.createContext({strict:!1}),L$={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},M1={};for(const t in L$)M1[t]={isEnabled:e=>L$[t].some(i=>!!e[i])};function UZe(t){for(const e in t)M1[e]={...M1[e],...t[e]}}const zZe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function LP(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||zZe.has(t)}let Sue=t=>!LP(t);function GZe(t){t&&(Sue=e=>e.startsWith("on")?!LP(e):t(e))}try{GZe(require("@emotion/is-prop-valid").default)}catch{}function VZe(t,e,i){const r={};for(const n in t)n==="values"&&typeof t.values=="object"||(Sue(n)||i===!0&&LP(n)||!e&&!LP(n)||t.draggable&&n.startsWith("onDrag"))&&(r[n]=t[n]);return r}function HZe(t){if(typeof Proxy>"u")return t;const e=new Map,i=(...r)=>t(...r);return new Proxy(i,{get:(r,n)=>n==="create"?t:(e.has(n)||e.set(n,t(n)),e.get(n))})}const tR=we.createContext({});function iR(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function VS(t){return typeof t=="string"||Array.isArray(t)}const OV=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],BV=["initial",...OV];function rR(t){return iR(t.animate)||BV.some(e=>VS(t[e]))}function _ue(t){return!!(rR(t)||t.variants)}function jZe(t,e){if(rR(t)){const{initial:i,animate:r}=t;return{initial:i===!1||VS(i)?i:void 0,animate:VS(r)?r:void 0}}return t.inherit!==!1?e:{}}function WZe(t){const{initial:e,animate:i}=jZe(t,we.useContext(tR));return we.useMemo(()=>({initial:e,animate:i}),[O$(e),O$(i)])}function O$(t){return Array.isArray(t)?t.join(" "):t}const XZe=Symbol.for("motionComponentSymbol");function uy(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function YZe(t,e,i){return we.useCallback(r=>{r&&t.onMount&&t.onMount(r),e&&(r?e.mount(r):e.unmount()),i&&(typeof i=="function"?i(r):uy(i)&&(i.current=r))},[e])}const FV=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),qZe="framerAppearId",Aue="data-"+FV(qZe),Eue=we.createContext({});function KZe(t,e,i,r,n){var s,a;const{visualElement:o}=we.useContext(tR),l=we.useContext(wue),c=we.useContext(AV),h=we.useContext(uue).reducedMotion,u=we.useRef(null);r=r||l.renderer,!u.current&&r&&(u.current=r(t,{visualState:e,parent:o,props:i,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:h}));const d=u.current,f=we.useContext(Eue);d&&!d.projection&&n&&(d.type==="html"||d.type==="svg")&&QZe(u.current,i,n,f);const p=we.useRef(!1);we.useInsertionEffect(()=>{d&&p.current&&d.update(i,c)});const m=i[Aue],g=we.useRef(!!m&&!(!((s=window.MotionHandoffIsComplete)===null||s===void 0)&&s.call(window,m))&&((a=window.MotionHasOptimisedAnimation)===null||a===void 0?void 0:a.call(window,m)));return xZe(()=>{d&&(p.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),IV.render(d.render),g.current&&d.animationState&&d.animationState.animateChanges())}),we.useEffect(()=>{d&&(!g.current&&d.animationState&&d.animationState.animateChanges(),g.current&&(queueMicrotask(()=>{var v;(v=window.MotionHandoffMarkAsComplete)===null||v===void 0||v.call(window,m)}),g.current=!1))}),d}function QZe(t,e,i,r){const{layoutId:n,layout:s,drag:a,dragConstraints:o,layoutScroll:l,layoutRoot:c}=e;t.projection=new i(t.latestValues,e["data-framer-portal-id"]?void 0:Mue(t.parent)),t.projection.setOptions({layoutId:n,layout:s,alwaysMeasureLayout:!!a||o&&uy(o),visualElement:t,animationType:typeof s=="string"?s:"both",initialPromotionConfig:r,layoutScroll:l,layoutRoot:c})}function Mue(t){if(t)return t.options.allowProjection!==!1?t.projection:Mue(t.parent)}function $Ze({preloadedFeatures:t,createVisualElement:e,useRender:i,useVisualState:r,Component:n}){var s,a;t&&UZe(t);function o(c,h){let u;const d={...we.useContext(uue),...c,layoutId:JZe(c)},{isStatic:f}=d,p=WZe(c),m=r(c,f);if(!f&&_V){ZZe();const g=eet(d);u=g.MeasureLayout,p.visualElement=KZe(n,m,d,e,g.ProjectionNode)}return Y.jsxs(tR.Provider,{value:p,children:[u&&p.visualElement?Y.jsx(u,{visualElement:p.visualElement,...d}):null,i(n,c,YZe(m,p.visualElement,h),m,f,p.visualElement)]})}o.displayName=`motion.${typeof n=="string"?n:`create(${(a=(s=n.displayName)!==null&&s!==void 0?s:n.name)!==null&&a!==void 0?a:""})`}`;const l=we.forwardRef(o);return l[XZe]=n,l}function JZe({layoutId:t}){const e=we.useContext(hue).id;return e&&t!==void 0?e+"-"+t:t}function ZZe(t,e){we.useContext(wue).strict}function eet(t){const{drag:e,layout:i}=M1;if(!e&&!i)return{};const r={...e,...i};return{MeasureLayout:e!=null&&e.isEnabled(t)||i!=null&&i.isEnabled(t)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}const Tue=t=>e=>typeof e=="string"&&e.startsWith(t),kV=Tue("--"),tet=Tue("var(--"),NV=t=>tet(t)?iet.test(t.split("/*")[0].trim()):!1,iet=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,HS={};function ret(t){for(const e in t)HS[e]=t[e],kV(e)&&(HS[e].isCSSVariable=!0)}const sx=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],h0=new Set(sx);function Cue(t,{layout:e,layoutId:i}){return h0.has(t)||t.startsWith("origin")||(e||i!==void 0)&&(!!HS[t]||t==="opacity")}const ma=t=>!!(t&&t.getVelocity),Pue=(t,e)=>e&&typeof t=="number"?e.transform(t):t,wd=(t,e,i)=>i>e?e:i<t?t:i,ax={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},jS={...ax,transform:t=>wd(0,1,t)},DT={...ax,default:1},G_=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),ff=G_("deg"),Uh=G_("%"),ai=G_("px"),net=G_("vh"),set=G_("vw"),B$={...Uh,parse:t=>Uh.parse(t)/100,transform:t=>Uh.transform(t*100)},aet={borderWidth:ai,borderTopWidth:ai,borderRightWidth:ai,borderBottomWidth:ai,borderLeftWidth:ai,borderRadius:ai,radius:ai,borderTopLeftRadius:ai,borderTopRightRadius:ai,borderBottomRightRadius:ai,borderBottomLeftRadius:ai,width:ai,maxWidth:ai,height:ai,maxHeight:ai,top:ai,right:ai,bottom:ai,left:ai,padding:ai,paddingTop:ai,paddingRight:ai,paddingBottom:ai,paddingLeft:ai,margin:ai,marginTop:ai,marginRight:ai,marginBottom:ai,marginLeft:ai,backgroundPositionX:ai,backgroundPositionY:ai},oet={rotate:ff,rotateX:ff,rotateY:ff,rotateZ:ff,scale:DT,scaleX:DT,scaleY:DT,scaleZ:DT,skew:ff,skewX:ff,skewY:ff,distance:ai,translateX:ai,translateY:ai,translateZ:ai,x:ai,y:ai,z:ai,perspective:ai,transformPerspective:ai,opacity:jS,originX:B$,originY:B$,originZ:ai},F$={...ax,transform:Math.round},UV={...aet,...oet,zIndex:F$,size:ai,fillOpacity:jS,strokeOpacity:jS,numOctaves:F$},cet={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},het=sx.length;function uet(t,e,i){let r="",n=!0;for(let s=0;s<het;s++){const a=sx[s],o=t[a];if(o===void 0)continue;let l=!0;if(typeof o=="number"?l=o===(a.startsWith("scale")?1:0):l=parseFloat(o)===0,!l||i){const c=Pue(o,UV[a]);if(!l){n=!1;const h=cet[a]||a;r+=`${h}(${c}) `}i&&(e[a]=c)}}return r=r.trim(),i?r=i(e,n?"":r):n&&(r="none"),r}function zV(t,e,i){const{style:r,vars:n,transformOrigin:s}=t;let a=!1,o=!1;for(const l in e){const c=e[l];if(h0.has(l)){a=!0;continue}else if(kV(l)){n[l]=c;continue}else{const h=Pue(c,UV[l]);l.startsWith("origin")?(o=!0,s[l]=h):r[l]=h}}if(e.transform||(a||i?r.transform=uet(e,t.transform,i):r.transform&&(r.transform="none")),o){const{originX:l="50%",originY:c="50%",originZ:h=0}=s;r.transformOrigin=`${l} ${c} ${h}`}}const GV=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Due(t,e,i){for(const r in e)!ma(e[r])&&!Cue(r,i)&&(t[r]=e[r])}function det({transformTemplate:t},e){return we.useMemo(()=>{const i=GV();return zV(i,e,t),Object.assign({},i.vars,i.style)},[e])}function fet(t,e){const i=t.style||{},r={};return Due(r,i,t),Object.assign(r,det(t,e)),r}function pet(t,e){const i={},r=fet(t,e);return t.drag&&t.dragListener!==!1&&(i.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(i.tabIndex=0),i.style=r,i}const met=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function VV(t){return typeof t!="string"||t.includes("-")?!1:!!(met.indexOf(t)>-1||/[A-Z]/u.test(t))}const get={offset:"stroke-dashoffset",array:"stroke-dasharray"},vet={offset:"strokeDashoffset",array:"strokeDasharray"};function yet(t,e,i=1,r=0,n=!0){t.pathLength=1;const s=n?get:vet;t[s.offset]=ai.transform(-r);const a=ai.transform(e),o=ai.transform(i);t[s.array]=`${a} ${o}`}function k$(t,e,i){return typeof t=="string"?t:ai.transform(e+i*t)}function xet(t,e,i){const r=k$(e,t.x,t.width),n=k$(i,t.y,t.height);return`${r} ${n}`}function HV(t,{attrX:e,attrY:i,attrScale:r,originX:n,originY:s,pathLength:a,pathSpacing:o=1,pathOffset:l=0,...c},h,u){if(zV(t,c,u),h){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:d,style:f,dimensions:p}=t;d.transform&&(p&&(f.transform=d.transform),delete d.transform),p&&(n!==void 0||s!==void 0||f.transform)&&(f.transformOrigin=xet(p,n!==void 0?n:.5,s!==void 0?s:.5)),e!==void 0&&(d.x=e),i!==void 0&&(d.y=i),r!==void 0&&(d.scale=r),a!==void 0&&yet(d,a,o,l,!1)}const Rue=()=>({...GV(),attrs:{}}),jV=t=>typeof t=="string"&&t.toLowerCase()==="svg";function bet(t,e,i,r){const n=we.useMemo(()=>{const s=Rue();return HV(s,e,jV(r),t.transformTemplate),{...s.attrs,style:{...s.style}}},[e]);if(t.style){const s={};Due(s,t.style,t),n.style={...s,...n.style}}return n}function wet(t=!1){return(i,r,n,{latestValues:s},a)=>{const l=(VV(i)?bet:pet)(r,s,a,i),c=VZe(r,typeof i=="string",t),h=i!==we.Fragment?{...c,...l,ref:n}:{},{children:u}=r,d=we.useMemo(()=>ma(u)?u.get():u,[u]);return we.createElement(i,{...h,children:d})}}function N$(t){const e=[{},{}];return t==null||t.values.forEach((i,r)=>{e[0][r]=i.get(),e[1][r]=i.getVelocity()}),e}function WV(t,e,i,r){if(typeof e=="function"){const[n,s]=N$(r);e=e(i!==void 0?i:t.custom,n,s)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[n,s]=N$(r);e=e(i!==void 0?i:t.custom,n,s)}return e}const QU=t=>Array.isArray(t),_et=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),Aet=t=>QU(t)?t[t.length-1]||0:t;function DC(t){const e=ma(t)?t.get():t;return _et(e)?e.toValue():e}function Eet({scrapeMotionValuesFromProps:t,createRenderState:e,onUpdate:i},r,n,s){const a={latestValues:Met(r,n,s,t),renderState:e()};return i&&(a.onMount=o=>i({props:r,current:o,...a}),a.onUpdate=o=>i(o)),a}const Iue=t=>(e,i)=>{const r=we.useContext(tR),n=we.useContext(AV),s=()=>Eet(t,e,r,n);return i?s():yZe(s)};function Met(t,e,i,r){const n={},s=r(t,{});for(const d in s)n[d]=DC(s[d]);let{initial:a,animate:o}=t;const l=rR(t),c=_ue(t);e&&c&&!l&&t.inherit!==!1&&(a===void 0&&(a=e.initial),o===void 0&&(o=e.animate));let h=i?i.initial===!1:!1;h=h||a===!1;const u=h?o:a;if(u&&typeof u!="boolean"&&!iR(u)){const d=Array.isArray(u)?u:[u];for(let f=0;f<d.length;f++){const p=WV(t,d[f]);if(p){const{transitionEnd:m,transition:g,...v}=p;for(const y in v){let x=v[y];if(Array.isArray(x)){const S=h?x.length-1:0;x=x[S]}x!==null&&(n[y]=x)}for(const y in m)n[y]=m[y]}}}return n}function XV(t,e,i){var r;const{style:n}=t,s={};for(const a in n)(ma(n[a])||e.style&&ma(e.style[a])||Cue(a,t)||((r=i==null?void 0:i.getValue(a))===null||r===void 0?void 0:r.liveStyle)!==void 0)&&(s[a]=n[a]);return s}const Tet={useVisualState:Iue({scrapeMotionValuesFromProps:XV,createRenderState:GV})};function Lue(t,e){try{e.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}function Oue(t,{style:e,vars:i},r,n){Object.assign(t.style,e,n&&n.getProjectionStyles(r));for(const s in i)t.style.setProperty(s,i[s])}const Bue=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Fue(t,e,i,r){Oue(t,e,void 0,r);for(const n in e.attrs)t.setAttribute(Bue.has(n)?n:FV(n),e.attrs[n])}function kue(t,e,i){const r=XV(t,e,i);for(const n in t)if(ma(t[n])||ma(e[n])){const s=sx.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;r[s]=t[n]}return r}const U$=["x","y","width","height","cx","cy","r"],Cet={useVisualState:Iue({scrapeMotionValuesFromProps:kue,createRenderState:Rue,onUpdate:({props:t,prevProps:e,current:i,renderState:r,latestValues:n})=>{if(!i)return;let s=!!t.drag;if(!s){for(const o in n)if(h0.has(o)){s=!0;break}}if(!s)return;let a=!e;if(e)for(let o=0;o<U$.length;o++){const l=U$[o];t[l]!==e[l]&&(a=!0)}a&&Er.read(()=>{Lue(i,r),Er.render(()=>{HV(r,n,jV(i.tagName),t.transformTemplate),Fue(i,r)})})}})};function Pet(t,e){return function(r,{forwardMotionProps:n}={forwardMotionProps:!1}){const a={...VV(r)?Cet:Tet,preloadedFeatures:t,useRender:wet(n),createVisualElement:e,Component:r};return $Ze(a)}}function WS(t,e,i){const r=t.getProps();return WV(r,e,i!==void 0?i:r.custom,t)}const Nue=new Set(["width","height","top","left","right","bottom",...sx]);function Det(t,e,i){t.hasValue(e)?t.getValue(e).set(i):t.addValue(e,GS(i))}function Ret(t,e){const i=WS(t,e);let{transitionEnd:r={},transition:n={},...s}=i||{};s={...s,...r};for(const a in s){const o=Aet(s[a]);Det(t,a,o)}}function Iet(t){return!!(ma(t)&&t.add)}function $U(t,e){const i=t.getValue("willChange");if(Iet(i))return i.add(e)}function Uue(t){return t.props[Aue]}const zue=(t,e,i)=>(((1-3*i+3*e)*t+(3*i-6*e))*t+3*e)*t,Let=1e-7,Oet=12;function Bet(t,e,i,r,n){let s,a,o=0;do a=e+(i-e)/2,s=zue(a,r,n)-t,s>0?i=a:e=a;while(Math.abs(s)>Let&&++o<Oet);return a}function V_(t,e,i,r){if(t===e&&i===r)return jo;const n=s=>Bet(s,0,1,t,i);return s=>s===0||s===1?s:zue(n(s),e,r)}const Gue=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,Vue=t=>e=>1-t(1-e),Hue=V_(.33,1.53,.69,.99),YV=Vue(Hue),jue=Gue(YV),Wue=t=>(t*=2)<1?.5*YV(t):.5*(2-Math.pow(2,-10*(t-1))),qV=t=>1-Math.sin(Math.acos(t)),Xue=Vue(qV),Yue=Gue(qV),que=t=>/^0[^.\s]+$/u.test(t);function Fet(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||que(t):!0}const Cw=t=>Math.round(t*1e5)/1e5,KV=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function ket(t){return t==null}const Net=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,QV=(t,e)=>i=>!!(typeof i=="string"&&Net.test(i)&&i.startsWith(t)||e&&!ket(i)&&Object.prototype.hasOwnProperty.call(i,e)),Kue=(t,e,i)=>r=>{if(typeof r!="string")return r;const[n,s,a,o]=r.match(KV);return{[t]:parseFloat(n),[e]:parseFloat(s),[i]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},Uet=t=>wd(0,255,t),xB={...ax,transform:t=>Math.round(Uet(t))},rg={test:QV("rgb","red"),parse:Kue("red","green","blue"),transform:({red:t,green:e,blue:i,alpha:r=1})=>"rgba("+xB.transform(t)+", "+xB.transform(e)+", "+xB.transform(i)+", "+Cw(jS.transform(r))+")"};function zet(t){let e="",i="",r="",n="";return t.length>5?(e=t.substring(1,3),i=t.substring(3,5),r=t.substring(5,7),n=t.substring(7,9)):(e=t.substring(1,2),i=t.substring(2,3),r=t.substring(3,4),n=t.substring(4,5),e+=e,i+=i,r+=r,n+=n),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(r,16),alpha:n?parseInt(n,16)/255:1}}const JU={test:QV("#"),parse:zet,transform:rg.transform},dy={test:QV("hsl","hue"),parse:Kue("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:i,alpha:r=1})=>"hsla("+Math.round(t)+", "+Uh.transform(Cw(e))+", "+Uh.transform(Cw(i))+", "+Cw(jS.transform(r))+")"},ca={test:t=>rg.test(t)||JU.test(t)||dy.test(t),parse:t=>rg.test(t)?rg.parse(t):dy.test(t)?dy.parse(t):JU.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?rg.transform(t):dy.transform(t)},Get=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Vet(t){var e,i;return isNaN(t)&&typeof t=="string"&&(((e=t.match(KV))===null||e===void 0?void 0:e.length)||0)+(((i=t.match(Get))===null||i===void 0?void 0:i.length)||0)>0}const Que="number",$ue="color",Het="var",jet="var(",z$="${}",Wet=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function XS(t){const e=t.toString(),i=[],r={color:[],number:[],var:[]},n=[];let s=0;const o=e.replace(Wet,l=>(ca.test(l)?(r.color.push(s),n.push($ue),i.push(ca.parse(l))):l.startsWith(jet)?(r.var.push(s),n.push(Het),i.push(l)):(r.number.push(s),n.push(Que),i.push(parseFloat(l))),++s,z$)).split(z$);return{values:i,split:o,indexes:r,types:n}}function Jue(t){return XS(t).values}function Zue(t){const{split:e,types:i}=XS(t),r=e.length;return n=>{let s="";for(let a=0;a<r;a++)if(s+=e[a],n[a]!==void 0){const o=i[a];o===Que?s+=Cw(n[a]):o===$ue?s+=ca.transform(n[a]):s+=n[a]}return s}}const Xet=t=>typeof t=="number"?0:t;function Yet(t){const e=Jue(t);return Zue(t)(e.map(Xet))}const Ap={test:Vet,parse:Jue,createTransformer:Zue,getAnimatableNone:Yet},qet=new Set(["brightness","contrast","saturate","opacity"]);function Ket(t){const[e,i]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[r]=i.match(KV)||[];if(!r)return t;const n=i.replace(r,"");let s=qet.has(e)?1:0;return r!==i&&(s*=100),e+"("+s+n+")"}const Qet=/\b([a-z-]*)\(.*?\)/gu,ZU={...Ap,getAnimatableNone:t=>{const e=t.match(Qet);return e?e.map(Ket).join(" "):t}},$et={...UV,color:ca,backgroundColor:ca,outlineColor:ca,fill:ca,stroke:ca,borderColor:ca,borderTopColor:ca,borderRightColor:ca,borderBottomColor:ca,borderLeftColor:ca,filter:ZU,WebkitFilter:ZU},ede=t=>$et[t];function tde(t,e){let i=ede(t);return i!==ZU&&(i=Ap),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const Jet=new Set(["auto","none","0"]);function Zet(t,e,i){let r=0,n;for(;r<t.length&&!n;){const s=t[r];typeof s=="string"&&!Jet.has(s)&&XS(s).values.length&&(n=t[r]),r++}if(n&&i)for(const s of e)t[s]=tde(i,n)}const ng=t=>t*180/Math.PI,ez=t=>{const e=ng(Math.atan2(t[1],t[0]));return tz(e)},ett={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:ez,rotateZ:ez,skewX:t=>ng(Math.atan(t[1])),skewY:t=>ng(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},tz=t=>(t=t%360,t<0&&(t+=360),t),G$=ez,V$=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),H$=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),ttt={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:V$,scaleY:H$,scale:t=>(V$(t)+H$(t))/2,rotateX:t=>tz(ng(Math.atan2(t[6],t[5]))),rotateY:t=>tz(ng(Math.atan2(-t[2],t[0]))),rotateZ:G$,rotate:G$,skewX:t=>ng(Math.atan(t[4])),skewY:t=>ng(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function j$(t){return t.includes("scale")?1:0}function iz(t,e){if(!t||t==="none")return j$(e);const i=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,n;if(i)r=ttt,n=i;else{const o=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=ett,n=o}if(!n)return j$(e);const s=r[e],a=n[1].split(",").map(rtt);return typeof s=="function"?s(a):a[s]}const itt=(t,e)=>{const{transform:i="none"}=getComputedStyle(t);return iz(i,e)};function rtt(t){return parseFloat(t.trim())}const W$=t=>t===ax||t===ai,ntt=new Set(["x","y","z"]),stt=sx.filter(t=>!ntt.has(t));function att(t){const e=[];return stt.forEach(i=>{const r=t.getValue(i);r!==void 0&&(e.push([i,r.get()]),r.set(i.startsWith("scale")?1:0))}),e}const T1={width:({x:t},{paddingLeft:e="0",paddingRight:i="0"})=>t.max-t.min-parseFloat(e)-parseFloat(i),height:({y:t},{paddingTop:e="0",paddingBottom:i="0"})=>t.max-t.min-parseFloat(e)-parseFloat(i),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>iz(e,"x"),y:(t,{transform:e})=>iz(e,"y")};T1.translateX=T1.x;T1.translateY=T1.y;const Mg=new Set;let rz=!1,nz=!1;function ide(){if(nz){const t=Array.from(Mg).filter(r=>r.needsMeasurement),e=new Set(t.map(r=>r.element)),i=new Map;e.forEach(r=>{const n=att(r);n.length&&(i.set(r,n),r.render())}),t.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const n=i.get(r);n&&n.forEach(([s,a])=>{var o;(o=r.getValue(s))===null||o===void 0||o.set(a)})}),t.forEach(r=>r.measureEndState()),t.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}nz=!1,rz=!1,Mg.forEach(t=>t.complete()),Mg.clear()}function rde(){Mg.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(nz=!0)})}function ott(){rde(),ide()}class $V{constructor(e,i,r,n,s,a=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=r,this.motionValue=n,this.element=s,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Mg.add(this),rz||(rz=!0,Er.read(rde),Er.resolveKeyframes(ide))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:r,motionValue:n}=this;for(let s=0;s<e.length;s++)if(e[s]===null)if(s===0){const a=n==null?void 0:n.get(),o=e[e.length-1];if(a!==void 0)e[0]=a;else if(r&&i){const l=r.readValue(i,o);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=o),n&&a===void 0&&n.set(e[0])}else e[s]=e[s-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Mg.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Mg.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const nde=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t),ltt=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function ctt(t){const e=ltt.exec(t);if(!e)return[,];const[,i,r,n]=e;return[`--${i??r}`,n]}function sde(t,e,i=1){const[r,n]=ctt(t);if(!r)return;const s=window.getComputedStyle(e).getPropertyValue(r);if(s){const a=s.trim();return nde(a)?parseFloat(a):a}return NV(n)?sde(n,e,i+1):n}const ade=t=>e=>e.test(t),htt={test:t=>t==="auto",parse:t=>t},ode=[ax,ai,Uh,ff,set,net,htt],X$=t=>ode.find(ade(t));class lde extends $V{constructor(e,i,r,n,s){super(e,i,r,n,s,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:r}=this;if(!i||!i.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let c=e[l];if(typeof c=="string"&&(c=c.trim(),NV(c))){const h=sde(c,i.current);h!==void 0&&(e[l]=h),l===e.length-1&&(this.finalKeyframe=c)}}if(this.resolveNoneKeyframes(),!Nue.has(r)||e.length!==2)return;const[n,s]=e,a=X$(n),o=X$(s);if(a!==o)if(W$(a)&&W$(o))for(let l=0;l<e.length;l++){const c=e[l];typeof c=="string"&&(e[l]=parseFloat(c))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,r=[];for(let n=0;n<e.length;n++)Fet(e[n])&&r.push(n);r.length&&Zet(e,r,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=T1[r](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const n=i[i.length-1];n!==void 0&&e.getValue(r,n).jump(n,!1)}measureEndState(){var e;const{element:i,name:r,unresolvedKeyframes:n}=this;if(!i||!i.current)return;const s=i.getValue(r);s&&s.jump(this.measuredOrigin,!1);const a=n.length-1,o=n[a];n[a]=T1[r](i.measureViewportBox(),window.getComputedStyle(i.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([l,c])=>{i.getValue(l).set(c)}),this.resolveNoneKeyframes()}}const Y$=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Ap.test(t)||t==="0")&&!t.startsWith("url("));function utt(t){const e=t[0];if(t.length===1)return!0;for(let i=0;i<t.length;i++)if(t[i]!==e)return!0}function dtt(t,e,i,r){const n=t[0];if(n===null)return!1;if(e==="display"||e==="visibility")return!0;const s=t[t.length-1],a=Y$(n,e),o=Y$(s,e);return!a||!o?!1:utt(t)||(i==="spring"||DV(i))&&r}const ftt=t=>t!==null;function nR(t,{repeat:e,repeatType:i="loop"},r){const n=t.filter(ftt),s=e&&i!=="loop"&&e%2===1?0:n.length-1;return!s||r===void 0?n[s]:r}const ptt=40;class cde{constructor({autoplay:e=!0,delay:i=0,type:r="keyframes",repeat:n=0,repeatDelay:s=0,repeatType:a="loop",...o}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Nh.now(),this.options={autoplay:e,delay:i,type:r,repeat:n,repeatDelay:s,repeatType:a,...o},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>ptt?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&ott(),this._resolved}onKeyframesResolved(e,i){this.resolvedAt=Nh.now(),this.hasAttemptedResolve=!0;const{name:r,type:n,velocity:s,delay:a,onComplete:o,onUpdate:l,isGenerator:c}=this.options;if(!c&&!dtt(e,r,n,s))if(a)this.options.duration=0;else{l&&l(nR(e,this.options,i)),o&&o(),this.resolveFinishedPromise();return}const h=this.initPlayback(e,i);h!==!1&&(this._resolved={keyframes:e,finalKeyframe:i,...h},this.onPostResolved())}onPostResolved(){}then(e,i){return this.currentFinishedPromise.then(e,i)}flatten(){this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear")}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const Yr=(t,e,i)=>t+(e-t)*i;function bB(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function mtt({hue:t,saturation:e,lightness:i,alpha:r}){t/=360,e/=100,i/=100;let n=0,s=0,a=0;if(!e)n=s=a=i;else{const o=i<.5?i*(1+e):i+e-i*e,l=2*i-o;n=bB(l,o,t+1/3),s=bB(l,o,t),a=bB(l,o,t-1/3)}return{red:Math.round(n*255),green:Math.round(s*255),blue:Math.round(a*255),alpha:r}}function OP(t,e){return i=>i>0?e:t}const wB=(t,e,i)=>{const r=t*t,n=i*(e*e-r)+r;return n<0?0:Math.sqrt(n)},gtt=[JU,rg,dy],vtt=t=>gtt.find(e=>e.test(t));function q$(t){const e=vtt(t);if(!e)return!1;let i=e.parse(t);return e===dy&&(i=mtt(i)),i}const K$=(t,e)=>{const i=q$(t),r=q$(e);if(!i||!r)return OP(t,e);const n={...i};return s=>(n.red=wB(i.red,r.red,s),n.green=wB(i.green,r.green,s),n.blue=wB(i.blue,r.blue,s),n.alpha=Yr(i.alpha,r.alpha,s),rg.transform(n))},ytt=(t,e)=>i=>e(t(i)),H_=(...t)=>t.reduce(ytt),sz=new Set(["none","hidden"]);function xtt(t,e){return sz.has(t)?i=>i<=0?t:e:i=>i>=1?e:t}function btt(t,e){return i=>Yr(t,e,i)}function JV(t){return typeof t=="number"?btt:typeof t=="string"?NV(t)?OP:ca.test(t)?K$:_tt:Array.isArray(t)?hde:typeof t=="object"?ca.test(t)?K$:wtt:OP}function hde(t,e){const i=[...t],r=i.length,n=t.map((s,a)=>JV(s)(s,e[a]));return s=>{for(let a=0;a<r;a++)i[a]=n[a](s);return i}}function wtt(t,e){const i={...t,...e},r={};for(const n in i)t[n]!==void 0&&e[n]!==void 0&&(r[n]=JV(t[n])(t[n],e[n]));return n=>{for(const s in r)i[s]=r[s](n);return i}}function Stt(t,e){var i;const r=[],n={color:0,var:0,number:0};for(let s=0;s<e.values.length;s++){const a=e.types[s],o=t.indexes[a][n[a]],l=(i=t.values[o])!==null&&i!==void 0?i:0;r[s]=l,n[a]++}return r}const _tt=(t,e)=>{const i=Ap.createTransformer(e),r=XS(t),n=XS(e);return r.indexes.var.length===n.indexes.var.length&&r.indexes.color.length===n.indexes.color.length&&r.indexes.number.length>=n.indexes.number.length?sz.has(t)&&!n.values.length||sz.has(e)&&!r.values.length?xtt(t,e):H_(hde(Stt(r,n),n.values),i):OP(t,e)};function ude(t,e,i){return typeof t=="number"&&typeof e=="number"&&typeof i=="number"?Yr(t,e,i):JV(t)(t,e)}const Att=5;function dde(t,e,i){const r=Math.max(e-Att,0);return due(i-t(r),e-r)}const rn={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},SB=.001;function Ett({duration:t=rn.duration,bounce:e=rn.bounce,velocity:i=rn.velocity,mass:r=rn.mass}){let n,s,a=1-e;a=wd(rn.minDamping,rn.maxDamping,a),t=wd(rn.minDuration,rn.maxDuration,ad(t)),a<1?(n=c=>{const h=c*a,u=h*t,d=h-i,f=az(c,a),p=Math.exp(-u);return SB-d/f*p},s=c=>{const u=c*a*t,d=u*i+i,f=Math.pow(a,2)*Math.pow(c,2)*t,p=Math.exp(-u),m=az(Math.pow(c,2),a);return(-n(c)+SB>0?-1:1)*((d-f)*p)/m}):(n=c=>{const h=Math.exp(-c*t),u=(c-i)*t+1;return-SB+h*u},s=c=>{const h=Math.exp(-c*t),u=(i-c)*(t*t);return h*u});const o=5/t,l=Ttt(n,s,o);if(t=sd(t),isNaN(l))return{stiffness:rn.stiffness,damping:rn.damping,duration:t};{const c=Math.pow(l,2)*r;return{stiffness:c,damping:a*2*Math.sqrt(r*c),duration:t}}}const Mtt=12;function Ttt(t,e,i){let r=i;for(let n=1;n<Mtt;n++)r=r-t(r)/e(r);return r}function az(t,e){return t*Math.sqrt(1-e*e)}const Ctt=["duration","bounce"],Ptt=["stiffness","damping","mass"];function Q$(t,e){return e.some(i=>t[i]!==void 0)}function Dtt(t){let e={velocity:rn.velocity,stiffness:rn.stiffness,damping:rn.damping,mass:rn.mass,isResolvedFromDuration:!1,...t};if(!Q$(t,Ptt)&&Q$(t,Ctt))if(t.visualDuration){const i=t.visualDuration,r=2*Math.PI/(i*1.2),n=r*r,s=2*wd(.05,1,1-(t.bounce||0))*Math.sqrt(n);e={...e,mass:rn.mass,stiffness:n,damping:s}}else{const i=Ett(t);e={...e,...i,mass:rn.mass},e.isResolvedFromDuration=!0}return e}function fde(t=rn.visualDuration,e=rn.bounce){const i=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:r,restDelta:n}=i;const s=i.keyframes[0],a=i.keyframes[i.keyframes.length-1],o={done:!1,value:s},{stiffness:l,damping:c,mass:h,duration:u,velocity:d,isResolvedFromDuration:f}=Dtt({...i,velocity:-ad(i.velocity||0)}),p=d||0,m=c/(2*Math.sqrt(l*h)),g=a-s,v=ad(Math.sqrt(l/h)),y=Math.abs(g)<5;r||(r=y?rn.restSpeed.granular:rn.restSpeed.default),n||(n=y?rn.restDelta.granular:rn.restDelta.default);let x;if(m<1){const A=az(v,m);x=_=>{const M=Math.exp(-m*v*_);return a-M*((p+m*v*g)/A*Math.sin(A*_)+g*Math.cos(A*_))}}else if(m===1)x=A=>a-Math.exp(-v*A)*(g+(p+v*g)*A);else{const A=v*Math.sqrt(m*m-1);x=_=>{const M=Math.exp(-m*v*_),E=Math.min(A*_,300);return a-M*((p+m*v*g)*Math.sinh(E)+A*g*Math.cosh(E))/A}}const S={calculatedDuration:f&&u||null,next:A=>{const _=x(A);if(f)o.done=A>=u;else{let M=0;m<1&&(M=A===0?sd(p):dde(x,A,_));const E=Math.abs(M)<=r,T=Math.abs(a-_)<=n;o.done=E&&T}return o.value=o.done?a:_,o},toString:()=>{const A=Math.min(fue(S),qU),_=pue(M=>S.next(A*M).value,A,30);return A+"ms "+_}};return S}function $$({keyframes:t,velocity:e=0,power:i=.8,timeConstant:r=325,bounceDamping:n=10,bounceStiffness:s=500,modifyTarget:a,min:o,max:l,restDelta:c=.5,restSpeed:h}){const u=t[0],d={done:!1,value:u},f=E=>o!==void 0&&E<o||l!==void 0&&E>l,p=E=>o===void 0?l:l===void 0||Math.abs(o-E)<Math.abs(l-E)?o:l;let m=i*e;const g=u+m,v=a===void 0?g:a(g);v!==g&&(m=v-u);const y=E=>-m*Math.exp(-E/r),x=E=>v+y(E),S=E=>{const T=y(E),C=x(E);d.done=Math.abs(T)<=c,d.value=d.done?v:C};let A,_;const M=E=>{f(d.value)&&(A=E,_=fde({keyframes:[d.value,p(d.value)],velocity:dde(x,E,d.value),damping:n,stiffness:s,restDelta:c,restSpeed:h}))};return M(0),{calculatedDuration:null,next:E=>{let T=!1;return!_&&A===void 0&&(T=!0,S(E),M(E)),A!==void 0&&E>=A?_.next(E-A):(!T&&S(E),d)}}}const Rtt=V_(.42,0,1,1),Itt=V_(0,0,.58,1),pde=V_(.42,0,.58,1),Ltt=t=>Array.isArray(t)&&typeof t[0]!="number",J$={linear:jo,easeIn:Rtt,easeInOut:pde,easeOut:Itt,circIn:qV,circInOut:Yue,circOut:Xue,backIn:YV,backInOut:jue,backOut:Hue,anticipate:Wue},Z$=t=>{if(RV(t)){YU(t.length===4);const[e,i,r,n]=t;return V_(e,i,r,n)}else if(typeof t=="string")return YU(J$[t]!==void 0),J$[t];return t};function Ott(t,e,i){const r=[],n=i||ude,s=t.length-1;for(let a=0;a<s;a++){let o=n(t[a],t[a+1]);if(e){const l=Array.isArray(e)?e[a]||jo:e;o=H_(l,o)}r.push(o)}return r}function Btt(t,e,{clamp:i=!0,ease:r,mixer:n}={}){const s=t.length;if(YU(s===e.length),s===1)return()=>e[0];if(s===2&&e[0]===e[1])return()=>e[1];const a=t[0]===t[1];t[0]>t[s-1]&&(t=[...t].reverse(),e=[...e].reverse());const o=Ott(e,r,n),l=o.length,c=h=>{if(a&&h<t[0])return e[0];let u=0;if(l>1)for(;u<t.length-2&&!(h<t[u+1]);u++);const d=E1(t[u],t[u+1],h);return o[u](d)};return i?h=>c(wd(t[0],t[s-1],h)):c}function Ftt(t,e){const i=t[t.length-1];for(let r=1;r<=e;r++){const n=E1(0,e,r);t.push(Yr(i,1,n))}}function ktt(t){const e=[0];return Ftt(e,t.length-1),e}function Ntt(t,e){return t.map(i=>i*e)}function Utt(t,e){return t.map(()=>e||pde).splice(0,t.length-1)}function BP({duration:t=300,keyframes:e,times:i,ease:r="easeInOut"}){const n=Ltt(r)?r.map(Z$):Z$(r),s={done:!1,value:e[0]},a=Ntt(i&&i.length===e.length?i:ktt(e),t),o=Btt(a,e,{ease:Array.isArray(n)?n:Utt(e,n)});return{calculatedDuration:t,next:l=>(s.value=o(l),s.done=l>=t,s)}}const ztt=t=>{const e=({timestamp:i})=>t(i);return{start:()=>Er.update(e,!0),stop:()=>_p(e),now:()=>Gs.isProcessing?Gs.timestamp:Nh.now()}},Gtt={decay:$$,inertia:$$,tween:BP,keyframes:BP,spring:fde},Vtt=t=>t/100;class ZV extends cde{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:l}=this.options;l&&l()};const{name:i,motionValue:r,element:n,keyframes:s}=this.options,a=(n==null?void 0:n.KeyframeResolver)||$V,o=(l,c)=>this.onKeyframesResolved(l,c);this.resolver=new a(s,o,i,r,n),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:i="keyframes",repeat:r=0,repeatDelay:n=0,repeatType:s,velocity:a=0}=this.options,o=DV(i)?i:Gtt[i]||BP;let l,c;o!==BP&&typeof e[0]!="number"&&(l=H_(Vtt,ude(e[0],e[1])),e=[0,100]);const h=o({...this.options,keyframes:e});s==="mirror"&&(c=o({...this.options,keyframes:[...e].reverse(),velocity:-a})),h.calculatedDuration===null&&(h.calculatedDuration=fue(h));const{calculatedDuration:u}=h,d=u+n,f=d*(r+1)-n;return{generator:h,mirroredGenerator:c,mapPercentToKeyframes:l,calculatedDuration:u,resolvedDuration:d,totalDuration:f}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,i=!1){const{resolved:r}=this;if(!r){const{keyframes:E}=this.options;return{done:!0,value:E[E.length-1]}}const{finalKeyframe:n,generator:s,mirroredGenerator:a,mapPercentToKeyframes:o,keyframes:l,calculatedDuration:c,totalDuration:h,resolvedDuration:u}=r;if(this.startTime===null)return s.next(0);const{delay:d,repeat:f,repeatType:p,repeatDelay:m,onUpdate:g}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-h/this.speed,this.startTime)),i?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const v=this.currentTime-d*(this.speed>=0?1:-1),y=this.speed>=0?v<0:v>h;this.currentTime=Math.max(v,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=h);let x=this.currentTime,S=s;if(f){const E=Math.min(this.currentTime,h)/u;let T=Math.floor(E),C=E%1;!C&&E>=1&&(C=1),C===1&&T--,T=Math.min(T,f+1),!!(T%2)&&(p==="reverse"?(C=1-C,m&&(C-=m/u)):p==="mirror"&&(S=a)),x=wd(0,1,C)*u}const A=y?{done:!1,value:l[0]}:S.next(x);o&&(A.value=o(A.value));let{done:_}=A;!y&&c!==null&&(_=this.speed>=0?this.currentTime>=h:this.currentTime<=0);const M=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&_);return M&&n!==void 0&&(A.value=nR(l,this.options,n)),g&&g(A.value),M&&this.finish(),A}get duration(){const{resolved:e}=this;return e?ad(e.calculatedDuration):0}get time(){return ad(this.currentTime)}set time(e){e=sd(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=ad(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=ztt,onPlay:i,startTime:r}=this.options;this.driver||(this.driver=e(s=>this.tick(s))),i&&i();const n=this.driver.now();this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=n):this.startTime=r??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const Htt=new Set(["opacity","clipPath","filter","transform"]);function jtt(t,e,i,{delay:r=0,duration:n=300,repeat:s=0,repeatType:a="loop",ease:o="easeInOut",times:l}={}){const c={[e]:i};l&&(c.offset=l);const h=gue(o,n);return Array.isArray(h)&&(c.easing=h),t.animate(c,{delay:r,duration:n,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:s+1,direction:a==="reverse"?"alternate":"normal"})}const Wtt=TV(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),FP=10,Xtt=2e4;function Ytt(t){return DV(t.type)||t.type==="spring"||!mue(t.ease)}function qtt(t,e){const i=new ZV({...e,keyframes:t,repeat:0,delay:0,isGenerator:!0});let r={done:!1,value:t[0]};const n=[];let s=0;for(;!r.done&&s<Xtt;)r=i.sample(s),n.push(r.value),s+=FP;return{times:void 0,keyframes:n,duration:s-FP,ease:"linear"}}const mde={anticipate:Wue,backInOut:jue,circInOut:Yue};function Ktt(t){return t in mde}class eJ extends cde{constructor(e){super(e);const{name:i,motionValue:r,element:n,keyframes:s}=this.options;this.resolver=new lde(s,(a,o)=>this.onKeyframesResolved(a,o),i,r,n),this.resolver.scheduleResolve()}initPlayback(e,i){let{duration:r=300,times:n,ease:s,type:a,motionValue:o,name:l,startTime:c}=this.options;if(!o.owner||!o.owner.current)return!1;if(typeof s=="string"&&IP()&&Ktt(s)&&(s=mde[s]),Ytt(this.options)){const{onComplete:u,onUpdate:d,motionValue:f,element:p,...m}=this.options,g=qtt(e,m);e=g.keyframes,e.length===1&&(e[1]=e[0]),r=g.duration,n=g.times,s=g.ease,a="keyframes"}const h=jtt(o.owner.current,l,e,{...this.options,duration:r,times:n,ease:s});return h.startTime=c??this.calcStartTime(),this.pendingTimeline?(T$(h,this.pendingTimeline),this.pendingTimeline=void 0):h.onfinish=()=>{const{onComplete:u}=this.options;o.set(nR(e,this.options,i)),u&&u(),this.cancel(),this.resolveFinishedPromise()},{animation:h,duration:r,times:n,type:a,ease:s,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:i}=e;return ad(i)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:i}=e;return ad(i.currentTime||0)}set time(e){const{resolved:i}=this;if(!i)return;const{animation:r}=i;r.currentTime=sd(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:i}=e;return i.playbackRate}set speed(e){const{resolved:i}=this;if(!i)return;const{animation:r}=i;r.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:i}=e;return i.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:i}=e;return i.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:i}=this;if(!i)return jo;const{animation:r}=i;T$(r,e)}return jo}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:i,keyframes:r,duration:n,type:s,ease:a,times:o}=e;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:c,onUpdate:h,onComplete:u,element:d,...f}=this.options,p=new ZV({...f,keyframes:r,duration:n,type:s,ease:a,times:o,isGenerator:!0}),m=sd(this.time);c.setWithVelocity(p.sample(m-FP).value,p.sample(m).value,FP)}const{onStop:l}=this.options;l&&l(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:i,name:r,repeatDelay:n,repeatType:s,damping:a,type:o}=e;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:c}=i.owner.getProps();return Wtt()&&r&&Htt.has(r)&&(r!=="transform"||!c)&&!l&&!n&&s!=="mirror"&&a!==0&&o!=="inertia"}}const Qtt={type:"spring",stiffness:500,damping:25,restSpeed:10},$tt=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),Jtt={type:"keyframes",duration:.8},Ztt={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},eit=(t,{keyframes:e})=>e.length>2?Jtt:h0.has(t)?t.startsWith("scale")?$tt(e[1]):Qtt:Ztt;function tit({when:t,delay:e,delayChildren:i,staggerChildren:r,staggerDirection:n,repeat:s,repeatType:a,repeatDelay:o,from:l,elapsed:c,...h}){return!!Object.keys(h).length}const e6=(t,e,i,r={},n,s)=>a=>{const o=PV(r,t)||{},l=o.delay||r.delay||0;let{elapsed:c=0}=r;c=c-sd(l);let h={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),...o,delay:-c,onUpdate:d=>{e.set(d),o.onUpdate&&o.onUpdate(d)},onComplete:()=>{a(),o.onComplete&&o.onComplete()},name:t,motionValue:e,element:s?void 0:n};tit(o)||(h={...h,...eit(t,h)}),h.duration&&(h.duration=sd(h.duration)),h.repeatDelay&&(h.repeatDelay=sd(h.repeatDelay)),h.from!==void 0&&(h.keyframes[0]=h.from);let u=!1;if((h.type===!1||h.duration===0&&!h.repeatDelay)&&(h.duration=0,h.delay===0&&(u=!0)),h.allowFlatten=!o.type&&!o.ease,u&&!s&&e.get()!==void 0){const d=nR(h.keyframes,o);if(d!==void 0)return Er.update(()=>{h.onUpdate(d),h.onComplete()}),new AZe([])}return!s&&eJ.supports(h)?new eJ(h):new ZV(h)};function iit({protectedKeys:t,needsAnimating:e},i){const r=t.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,r}function gde(t,e,{delay:i=0,transitionOverride:r,type:n}={}){var s;let{transition:a=t.getDefaultTransition(),transitionEnd:o,...l}=e;r&&(a=r);const c=[],h=n&&t.animationState&&t.animationState.getState()[n];for(const u in l){const d=t.getValue(u,(s=t.latestValues[u])!==null&&s!==void 0?s:null),f=l[u];if(f===void 0||h&&iit(h,u))continue;const p={delay:i,...PV(a||{},u)};let m=!1;if(window.MotionHandoffAnimation){const v=Uue(t);if(v){const y=window.MotionHandoffAnimation(v,u,Er);y!==null&&(p.startTime=y,m=!0)}}$U(t,u),d.start(e6(u,d,f,t.shouldReduceMotion&&Nue.has(u)?{type:!1}:p,t,m));const g=d.animation;g&&c.push(g)}return o&&Promise.all(c).then(()=>{Er.update(()=>{o&&Ret(t,o)})}),c}function oz(t,e,i={}){var r;const n=WS(t,e,i.type==="exit"?(r=t.presenceContext)===null||r===void 0?void 0:r.custom:void 0);let{transition:s=t.getDefaultTransition()||{}}=n||{};i.transitionOverride&&(s=i.transitionOverride);const a=n?()=>Promise.all(gde(t,n,i)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(c=0)=>{const{delayChildren:h=0,staggerChildren:u,staggerDirection:d}=s;return rit(t,e,h+c,u,d,i)}:()=>Promise.resolve(),{when:l}=s;if(l){const[c,h]=l==="beforeChildren"?[a,o]:[o,a];return c().then(()=>h())}else return Promise.all([a(),o(i.delay)])}function rit(t,e,i=0,r=0,n=1,s){const a=[],o=(t.variantChildren.size-1)*r,l=n===1?(c=0)=>c*r:(c=0)=>o-c*r;return Array.from(t.variantChildren).sort(nit).forEach((c,h)=>{c.notify("AnimationStart",e),a.push(oz(c,e,{...s,delay:i+l(h)}).then(()=>c.notify("AnimationComplete",e)))}),Promise.all(a)}function nit(t,e){return t.sortNodePosition(e)}function sit(t,e,i={}){t.notify("AnimationStart",e);let r;if(Array.isArray(e)){const n=e.map(s=>oz(t,s,i));r=Promise.all(n)}else if(typeof e=="string")r=oz(t,e,i);else{const n=typeof e=="function"?WS(t,e,i.custom):e;r=Promise.all(gde(t,n,i))}return r.then(()=>{t.notify("AnimationComplete",e)})}function vde(t,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==t.length)return!1;for(let r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0}const ait=BV.length;function yde(t){if(!t)return;if(!t.isControllingVariants){const i=t.parent?yde(t.parent)||{}:{};return t.props.initial!==void 0&&(i.initial=t.props.initial),i}const e={};for(let i=0;i<ait;i++){const r=BV[i],n=t.props[r];(VS(n)||n===!1)&&(e[r]=n)}return e}const oit=[...OV].reverse(),lit=OV.length;function cit(t){return e=>Promise.all(e.map(({animation:i,options:r})=>sit(t,i,r)))}function hit(t){let e=cit(t),i=tJ(),r=!0;const n=l=>(c,h)=>{var u;const d=WS(t,h,l==="exit"?(u=t.presenceContext)===null||u===void 0?void 0:u.custom:void 0);if(d){const{transition:f,transitionEnd:p,...m}=d;c={...c,...m,...p}}return c};function s(l){e=l(t)}function a(l){const{props:c}=t,h=yde(t.parent)||{},u=[],d=new Set;let f={},p=1/0;for(let g=0;g<lit;g++){const v=oit[g],y=i[v],x=c[v]!==void 0?c[v]:h[v],S=VS(x),A=v===l?y.isActive:null;A===!1&&(p=g);let _=x===h[v]&&x!==c[v]&&S;if(_&&r&&t.manuallyAnimateOnMount&&(_=!1),y.protectedKeys={...f},!y.isActive&&A===null||!x&&!y.prevProp||iR(x)||typeof x=="boolean")continue;const M=uit(y.prevProp,x);let E=M||v===l&&y.isActive&&!_&&S||g>p&&S,T=!1;const C=Array.isArray(x)?x:[x];let D=C.reduce(n(v),{});A===!1&&(D={});const{prevResolvedValues:B={}}=y,O={...B,...D},L=W=>{E=!0,d.has(W)&&(T=!0,d.delete(W)),y.needsAnimating[W]=!0;const I=t.getValue(W);I&&(I.liveStyle=!1)};for(const W in O){const I=D[W],z=B[W];if(f.hasOwnProperty(W))continue;let U=!1;QU(I)&&QU(z)?U=!vde(I,z):U=I!==z,U?I!=null?L(W):d.add(W):I!==void 0&&d.has(W)?L(W):y.protectedKeys[W]=!0}y.prevProp=x,y.prevResolvedValues=D,y.isActive&&(f={...f,...D}),r&&t.blockInitialAnimation&&(E=!1),E&&(!(_&&M)||T)&&u.push(...C.map(W=>({animation:W,options:{type:v}})))}if(d.size){const g={};if(typeof c.initial!="boolean"){const v=WS(t,Array.isArray(c.initial)?c.initial[0]:c.initial);v&&v.transition&&(g.transition=v.transition)}d.forEach(v=>{const y=t.getBaseTarget(v),x=t.getValue(v);x&&(x.liveStyle=!0),g[v]=y??null}),u.push({animation:g})}let m=!!u.length;return r&&(c.initial===!1||c.initial===c.animate)&&!t.manuallyAnimateOnMount&&(m=!1),r=!1,m?e(u):Promise.resolve()}function o(l,c){var h;if(i[l].isActive===c)return Promise.resolve();(h=t.variantChildren)===null||h===void 0||h.forEach(d=>{var f;return(f=d.animationState)===null||f===void 0?void 0:f.setActive(l,c)}),i[l].isActive=c;const u=a(l);for(const d in i)i[d].protectedKeys={};return u}return{animateChanges:a,setActive:o,setAnimateFunction:s,getState:()=>i,reset:()=>{i=tJ(),r=!0}}}function uit(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!vde(e,t):!1}function gm(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function tJ(){return{animate:gm(!0),whileInView:gm(),whileHover:gm(),whileTap:gm(),whileDrag:gm(),whileFocus:gm(),exit:gm()}}class kp{constructor(e){this.isMounted=!1,this.node=e}update(){}}class dit extends kp{constructor(e){super(e),e.animationState||(e.animationState=hit(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();iR(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let fit=0;class pit extends kp{constructor(){super(...arguments),this.id=fit++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const n=this.node.animationState.setActive("exit",!e);i&&!e&&n.then(()=>{i(this.id)})}mount(){const{register:e,onExitComplete:i}=this.node.presenceContext||{};i&&i(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const mit={animation:{Feature:dit},exit:{Feature:pit}};function YS(t,e,i,r={passive:!0}){return t.addEventListener(e,i,r),()=>t.removeEventListener(e,i)}function j_(t){return{point:{x:t.pageX,y:t.pageY}}}const git=t=>e=>LV(e)&&t(e,j_(e));function Pw(t,e,i,r){return YS(t,e,git(i),r)}function xde({top:t,left:e,right:i,bottom:r}){return{x:{min:e,max:i},y:{min:t,max:r}}}function vit({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function yit(t,e){if(!e)return t;const i=e({x:t.left,y:t.top}),r=e({x:t.right,y:t.bottom});return{top:i.y,left:i.x,bottom:r.y,right:r.x}}const bde=1e-4,xit=1-bde,bit=1+bde,wde=.01,wit=0-wde,Sit=0+wde;function Ga(t){return t.max-t.min}function _it(t,e,i){return Math.abs(t-e)<=i}function iJ(t,e,i,r=.5){t.origin=r,t.originPoint=Yr(e.min,e.max,t.origin),t.scale=Ga(i)/Ga(e),t.translate=Yr(i.min,i.max,t.origin)-t.originPoint,(t.scale>=xit&&t.scale<=bit||isNaN(t.scale))&&(t.scale=1),(t.translate>=wit&&t.translate<=Sit||isNaN(t.translate))&&(t.translate=0)}function Dw(t,e,i,r){iJ(t.x,e.x,i.x,r?r.originX:void 0),iJ(t.y,e.y,i.y,r?r.originY:void 0)}function rJ(t,e,i){t.min=i.min+e.min,t.max=t.min+Ga(e)}function Ait(t,e,i){rJ(t.x,e.x,i.x),rJ(t.y,e.y,i.y)}function nJ(t,e,i){t.min=e.min-i.min,t.max=t.min+Ga(e)}function Rw(t,e,i){nJ(t.x,e.x,i.x),nJ(t.y,e.y,i.y)}const sJ=()=>({translate:0,scale:1,origin:0,originPoint:0}),fy=()=>({x:sJ(),y:sJ()}),aJ=()=>({min:0,max:0}),gn=()=>({x:aJ(),y:aJ()});function yl(t){return[t("x"),t("y")]}function _B(t){return t===void 0||t===1}function lz({scale:t,scaleX:e,scaleY:i}){return!_B(t)||!_B(e)||!_B(i)}function Cm(t){return lz(t)||Sde(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function Sde(t){return oJ(t.x)||oJ(t.y)}function oJ(t){return t&&t!=="0%"}function kP(t,e,i){const r=t-i,n=e*r;return i+n}function lJ(t,e,i,r,n){return n!==void 0&&(t=kP(t,n,r)),kP(t,i,r)+e}function cz(t,e=0,i=1,r,n){t.min=lJ(t.min,e,i,r,n),t.max=lJ(t.max,e,i,r,n)}function _de(t,{x:e,y:i}){cz(t.x,e.translate,e.scale,e.originPoint),cz(t.y,i.translate,i.scale,i.originPoint)}const cJ=.999999999999,hJ=1.0000000000001;function Eit(t,e,i,r=!1){const n=i.length;if(!n)return;e.x=e.y=1;let s,a;for(let o=0;o<n;o++){s=i[o],a=s.projectionDelta;const{visualElement:l}=s.options;l&&l.props.style&&l.props.style.display==="contents"||(r&&s.options.layoutScroll&&s.scroll&&s!==s.root&&my(t,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,_de(t,a)),r&&Cm(s.latestValues)&&my(t,s.latestValues))}e.x<hJ&&e.x>cJ&&(e.x=1),e.y<hJ&&e.y>cJ&&(e.y=1)}function py(t,e){t.min=t.min+e,t.max=t.max+e}function uJ(t,e,i,r,n=.5){const s=Yr(t.min,t.max,n);cz(t,e,i,s,r)}function my(t,e){uJ(t.x,e.x,e.scaleX,e.scale,e.originX),uJ(t.y,e.y,e.scaleY,e.scale,e.originY)}function Ade(t,e){return xde(yit(t.getBoundingClientRect(),e))}function Mit(t,e,i){const r=Ade(t,i),{scroll:n}=e;return n&&(py(r.x,n.offset.x),py(r.y,n.offset.y)),r}const Ede=({current:t})=>t?t.ownerDocument.defaultView:null,dJ=(t,e)=>Math.abs(t-e);function Tit(t,e){const i=dJ(t.x,e.x),r=dJ(t.y,e.y);return Math.sqrt(i**2+r**2)}class Mde{constructor(e,i,{transformPagePoint:r,contextWindow:n,dragSnapToOrigin:s=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const u=EB(this.lastMoveEventInfo,this.history),d=this.startEvent!==null,f=Tit(u.offset,{x:0,y:0})>=3;if(!d&&!f)return;const{point:p}=u,{timestamp:m}=Gs;this.history.push({...p,timestamp:m});const{onStart:g,onMove:v}=this.handlers;d||(g&&g(this.lastMoveEvent,u),this.startEvent=this.lastMoveEvent),v&&v(this.lastMoveEvent,u)},this.handlePointerMove=(u,d)=>{this.lastMoveEvent=u,this.lastMoveEventInfo=AB(d,this.transformPagePoint),Er.update(this.updatePoint,!0)},this.handlePointerUp=(u,d)=>{this.end();const{onEnd:f,onSessionEnd:p,resumeAnimation:m}=this.handlers;if(this.dragSnapToOrigin&&m&&m(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=EB(u.type==="pointercancel"?this.lastMoveEventInfo:AB(d,this.transformPagePoint),this.history);this.startEvent&&f&&f(u,g),p&&p(u,g)},!LV(e))return;this.dragSnapToOrigin=s,this.handlers=i,this.transformPagePoint=r,this.contextWindow=n||window;const a=j_(e),o=AB(a,this.transformPagePoint),{point:l}=o,{timestamp:c}=Gs;this.history=[{...l,timestamp:c}];const{onSessionStart:h}=i;h&&h(e,EB(o,this.history)),this.removeListeners=H_(Pw(this.contextWindow,"pointermove",this.handlePointerMove),Pw(this.contextWindow,"pointerup",this.handlePointerUp),Pw(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),_p(this.updatePoint)}}function AB(t,e){return e?{point:e(t.point)}:t}function fJ(t,e){return{x:t.x-e.x,y:t.y-e.y}}function EB({point:t},e){return{point:t,delta:fJ(t,Tde(e)),offset:fJ(t,Cit(e)),velocity:Pit(e,.1)}}function Cit(t){return t[0]}function Tde(t){return t[t.length-1]}function Pit(t,e){if(t.length<2)return{x:0,y:0};let i=t.length-1,r=null;const n=Tde(t);for(;i>=0&&(r=t[i],!(n.timestamp-r.timestamp>sd(e)));)i--;if(!r)return{x:0,y:0};const s=ad(n.timestamp-r.timestamp);if(s===0)return{x:0,y:0};const a={x:(n.x-r.x)/s,y:(n.y-r.y)/s};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function Dit(t,{min:e,max:i},r){return e!==void 0&&t<e?t=r?Yr(e,t,r.min):Math.max(t,e):i!==void 0&&t>i&&(t=r?Yr(i,t,r.max):Math.min(t,i)),t}function pJ(t,e,i){return{min:e!==void 0?t.min+e:void 0,max:i!==void 0?t.max+i-(t.max-t.min):void 0}}function Rit(t,{top:e,left:i,bottom:r,right:n}){return{x:pJ(t.x,i,n),y:pJ(t.y,e,r)}}function mJ(t,e){let i=e.min-t.min,r=e.max-t.max;return e.max-e.min<t.max-t.min&&([i,r]=[r,i]),{min:i,max:r}}function Iit(t,e){return{x:mJ(t.x,e.x),y:mJ(t.y,e.y)}}function Lit(t,e){let i=.5;const r=Ga(t),n=Ga(e);return n>r?i=E1(e.min,e.max-r,t.min):r>n&&(i=E1(t.min,t.max-n,e.min)),wd(0,1,i)}function Oit(t,e){const i={};return e.min!==void 0&&(i.min=e.min-t.min),e.max!==void 0&&(i.max=e.max-t.min),i}const hz=.35;function Bit(t=hz){return t===!1?t=0:t===!0&&(t=hz),{x:gJ(t,"left","right"),y:gJ(t,"top","bottom")}}function gJ(t,e,i){return{min:vJ(t,e),max:vJ(t,i)}}function vJ(t,e){return typeof t=="number"?t:t[e]||0}const Fit=new WeakMap;class kit{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=gn(),this.visualElement=e}start(e,{snapToCursor:i=!1}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const n=h=>{const{dragSnapToOrigin:u}=this.getProps();u?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(j_(h).point)},s=(h,u)=>{const{drag:d,dragPropagation:f,onDragStart:p}=this.getProps();if(d&&!f&&(this.openDragLock&&this.openDragLock(),this.openDragLock=DZe(d),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),yl(g=>{let v=this.getAxisMotionValue(g).get()||0;if(Uh.test(v)){const{projection:y}=this.visualElement;if(y&&y.layout){const x=y.layout.layoutBox[g];x&&(v=Ga(x)*(parseFloat(v)/100))}}this.originPoint[g]=v}),p&&Er.postRender(()=>p(h,u)),$U(this.visualElement,"transform");const{animationState:m}=this.visualElement;m&&m.setActive("whileDrag",!0)},a=(h,u)=>{const{dragPropagation:d,dragDirectionLock:f,onDirectionLock:p,onDrag:m}=this.getProps();if(!d&&!this.openDragLock)return;const{offset:g}=u;if(f&&this.currentDirection===null){this.currentDirection=Nit(g),this.currentDirection!==null&&p&&p(this.currentDirection);return}this.updateAxis("x",u.point,g),this.updateAxis("y",u.point,g),this.visualElement.render(),m&&m(h,u)},o=(h,u)=>this.stop(h,u),l=()=>yl(h=>{var u;return this.getAnimationState(h)==="paused"&&((u=this.getAxisMotionValue(h).animation)===null||u===void 0?void 0:u.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new Mde(e,{onSessionStart:n,onStart:s,onMove:a,onSessionEnd:o,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,contextWindow:Ede(this.visualElement)})}stop(e,i){const r=this.isDragging;if(this.cancel(),!r)return;const{velocity:n}=i;this.startAnimation(n);const{onDragEnd:s}=this.getProps();s&&Er.postRender(()=>s(e,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,r){const{drag:n}=this.getProps();if(!r||!RT(e,n,this.currentDirection))return;const s=this.getAxisMotionValue(e);let a=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(a=Dit(a,this.constraints[e],this.elastic[e])),s.set(a)}resolveConstraints(){var e;const{dragConstraints:i,dragElastic:r}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,s=this.constraints;i&&uy(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&n?this.constraints=Rit(n.layoutBox,i):this.constraints=!1,this.elastic=Bit(r),s!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&yl(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=Oit(n.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!uy(e))return!1;const r=e.current,{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const s=Mit(r,n.root,this.visualElement.getTransformPagePoint());let a=Iit(n.layout.layoutBox,s);if(i){const o=i(vit(a));this.hasMutatedConstraints=!!o,o&&(a=xde(o))}return a}startAnimation(e){const{drag:i,dragMomentum:r,dragElastic:n,dragTransition:s,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),l=this.constraints||{},c=yl(h=>{if(!RT(h,i,this.currentDirection))return;let u=l&&l[h]||{};a&&(u={min:0,max:0});const d=n?200:1e6,f=n?40:1e7,p={type:"inertia",velocity:r?e[h]:0,bounceStiffness:d,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...s,...u};return this.startAxisValueAnimation(h,p)});return Promise.all(c).then(o)}startAxisValueAnimation(e,i){const r=this.getAxisMotionValue(e);return $U(this.visualElement,e),r.start(e6(e,r,0,i,this.visualElement,!1))}stopAnimation(){yl(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){yl(e=>{var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(e){var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),n=r[i];return n||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){yl(i=>{const{drag:r}=this.getProps();if(!RT(i,r,this.currentDirection))return;const{projection:n}=this.visualElement,s=this.getAxisMotionValue(i);if(n&&n.layout){const{min:a,max:o}=n.layout.layoutBox[i];s.set(e[i]-Yr(a,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:r}=this.visualElement;if(!uy(i)||!r||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};yl(a=>{const o=this.getAxisMotionValue(a);if(o&&this.constraints!==!1){const l=o.get();n[a]=Lit({min:l,max:l},this.constraints[a])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),yl(a=>{if(!RT(a,e,null))return;const o=this.getAxisMotionValue(a),{min:l,max:c}=this.constraints[a];o.set(Yr(l,c,n[a]))})}addListeners(){if(!this.visualElement.current)return;Fit.set(this.visualElement,this);const e=this.visualElement.current,i=Pw(e,"pointerdown",l=>{const{drag:c,dragListener:h=!0}=this.getProps();c&&h&&this.start(l)}),r=()=>{const{dragConstraints:l}=this.getProps();uy(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,s=n.addEventListener("measure",r);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),Er.read(r);const a=YS(window,"resize",()=>this.scalePositionWithinConstraints()),o=n.addEventListener("didUpdate",({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(yl(h=>{const u=this.getAxisMotionValue(h);u&&(this.originPoint[h]+=l[h].translate,u.set(u.get()+l[h].translate))}),this.visualElement.render())});return()=>{a(),i(),s(),o&&o()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:r=!1,dragPropagation:n=!1,dragConstraints:s=!1,dragElastic:a=hz,dragMomentum:o=!0}=e;return{...e,drag:i,dragDirectionLock:r,dragPropagation:n,dragConstraints:s,dragElastic:a,dragMomentum:o}}}function RT(t,e,i){return(e===!0||e===t)&&(i===null||i===t)}function Nit(t,e=10){let i=null;return Math.abs(t.y)>e?i="y":Math.abs(t.x)>e&&(i="x"),i}class Uit extends kp{constructor(e){super(e),this.removeGroupControls=jo,this.removeListeners=jo,this.controls=new kit(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||jo}unmount(){this.removeGroupControls(),this.removeListeners()}}const yJ=t=>(e,i)=>{t&&Er.postRender(()=>t(e,i))};class zit extends kp{constructor(){super(...arguments),this.removePointerDownListener=jo}onPointerDown(e){this.session=new Mde(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Ede(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:r,onPanEnd:n}=this.node.getProps();return{onSessionStart:yJ(e),onStart:yJ(i),onMove:r,onEnd:(s,a)=>{delete this.session,n&&Er.postRender(()=>n(s,a))}}}mount(){this.removePointerDownListener=Pw(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const RC={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function xJ(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Eb={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(ai.test(t))t=parseFloat(t);else return t;const i=xJ(t,e.target.x),r=xJ(t,e.target.y);return`${i}% ${r}%`}},Git={correct:(t,{treeScale:e,projectionDelta:i})=>{const r=t,n=Ap.parse(t);if(n.length>5)return r;const s=Ap.createTransformer(t),a=typeof n[0]!="number"?1:0,o=i.x.scale*e.x,l=i.y.scale*e.y;n[0+a]/=o,n[1+a]/=l;const c=Yr(o,l,.5);return typeof n[2+a]=="number"&&(n[2+a]/=c),typeof n[3+a]=="number"&&(n[3+a]/=c),s(n)}};class Vit extends we.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:r,layoutId:n}=this.props,{projection:s}=e;ret(Hit),s&&(i.group&&i.group.add(s),r&&r.register&&n&&r.register(s),s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),RC.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:r,drag:n,isPresent:s}=this.props,a=r.projection;return a&&(a.isPresent=s,n||e.layoutDependency!==i||i===void 0||e.isPresent!==s?a.willUpdate():this.safeToRemove(),e.isPresent!==s&&(s?a.promote():a.relegate()||Er.postRender(()=>{const o=a.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),IV.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:r}=this.props,{projection:n}=e;n&&(n.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(n),r&&r.deregister&&r.deregister(n))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Cde(t){const[e,i]=bZe(),r=we.useContext(hue);return Y.jsx(Vit,{...t,layoutGroup:r,switchLayoutGroup:we.useContext(Eue),isPresent:e,safeToRemove:i})}const Hit={borderRadius:{...Eb,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Eb,borderTopRightRadius:Eb,borderBottomLeftRadius:Eb,borderBottomRightRadius:Eb,boxShadow:Git};function jit(t,e,i){const r=ma(t)?t:GS(t);return r.start(e6("",r,e,i)),r.animation}function Wit(t){return t instanceof SVGElement&&t.tagName!=="svg"}const Xit=(t,e)=>t.depth-e.depth;class Yit{constructor(){this.children=[],this.isDirty=!1}add(e){EV(this.children,e),this.isDirty=!0}remove(e){MV(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Xit),this.isDirty=!1,this.children.forEach(e)}}function qit(t,e){const i=Nh.now(),r=({timestamp:n})=>{const s=n-i;s>=e&&(_p(r),t(s-e))};return Er.read(r,!0),()=>_p(r)}const Pde=["TopLeft","TopRight","BottomLeft","BottomRight"],Kit=Pde.length,bJ=t=>typeof t=="string"?parseFloat(t):t,wJ=t=>typeof t=="number"||ai.test(t);function Qit(t,e,i,r,n,s){n?(t.opacity=Yr(0,i.opacity!==void 0?i.opacity:1,$it(r)),t.opacityExit=Yr(e.opacity!==void 0?e.opacity:1,0,Jit(r))):s&&(t.opacity=Yr(e.opacity!==void 0?e.opacity:1,i.opacity!==void 0?i.opacity:1,r));for(let a=0;a<Kit;a++){const o=`border${Pde[a]}Radius`;let l=SJ(e,o),c=SJ(i,o);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||wJ(l)===wJ(c)?(t[o]=Math.max(Yr(bJ(l),bJ(c),r),0),(Uh.test(c)||Uh.test(l))&&(t[o]+="%")):t[o]=c}(e.rotate||i.rotate)&&(t.rotate=Yr(e.rotate||0,i.rotate||0,r))}function SJ(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const $it=Dde(0,.5,Xue),Jit=Dde(.5,.95,jo);function Dde(t,e,i){return r=>r<t?0:r>e?1:i(E1(t,e,r))}function _J(t,e){t.min=e.min,t.max=e.max}function pl(t,e){_J(t.x,e.x),_J(t.y,e.y)}function AJ(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function EJ(t,e,i,r,n){return t-=e,t=kP(t,1/i,r),n!==void 0&&(t=kP(t,1/n,r)),t}function Zit(t,e=0,i=1,r=.5,n,s=t,a=t){if(Uh.test(e)&&(e=parseFloat(e),e=Yr(a.min,a.max,e/100)-a.min),typeof e!="number")return;let o=Yr(s.min,s.max,r);t===s&&(o-=e),t.min=EJ(t.min,e,i,o,n),t.max=EJ(t.max,e,i,o,n)}function MJ(t,e,[i,r,n],s,a){Zit(t,e[i],e[r],e[n],e.scale,s,a)}const ert=["x","scaleX","originX"],trt=["y","scaleY","originY"];function TJ(t,e,i,r){MJ(t.x,e,ert,i?i.x:void 0,r?r.x:void 0),MJ(t.y,e,trt,i?i.y:void 0,r?r.y:void 0)}function CJ(t){return t.translate===0&&t.scale===1}function Rde(t){return CJ(t.x)&&CJ(t.y)}function PJ(t,e){return t.min===e.min&&t.max===e.max}function irt(t,e){return PJ(t.x,e.x)&&PJ(t.y,e.y)}function DJ(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function Ide(t,e){return DJ(t.x,e.x)&&DJ(t.y,e.y)}function RJ(t){return Ga(t.x)/Ga(t.y)}function IJ(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class rrt{constructor(){this.members=[]}add(e){EV(this.members,e),e.scheduleRender()}remove(e){if(MV(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(n=>e===n);if(i===0)return!1;let r;for(let n=i;n>=0;n--){const s=this.members[n];if(s.isPresent!==!1){r=s;break}}return r?(this.promote(r),!0):!1}promote(e,i){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,i&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:n}=e.options;n===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:r}=e;i.onExitComplete&&i.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function nrt(t,e,i){let r="";const n=t.x.translate/e.x,s=t.y.translate/e.y,a=(i==null?void 0:i.z)||0;if((n||s||a)&&(r=`translate3d(${n}px, ${s}px, ${a}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:c,rotate:h,rotateX:u,rotateY:d,skewX:f,skewY:p}=i;c&&(r=`perspective(${c}px) ${r}`),h&&(r+=`rotate(${h}deg) `),u&&(r+=`rotateX(${u}deg) `),d&&(r+=`rotateY(${d}deg) `),f&&(r+=`skewX(${f}deg) `),p&&(r+=`skewY(${p}deg) `)}const o=t.x.scale*e.x,l=t.y.scale*e.y;return(o!==1||l!==1)&&(r+=`scale(${o}, ${l})`),r||"none"}const MB=["","X","Y","Z"],srt={visibility:"hidden"},LJ=1e3;let art=0;function TB(t,e,i,r){const{latestValues:n}=e;n[t]&&(i[t]=n[t],e.setStaticValue(t,0),r&&(r[t]=0))}function Lde(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const i=Uue(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:n,layoutId:s}=t.options;window.MotionCancelOptimisedAnimation(i,"transform",Er,!(n||s))}const{parent:r}=t;r&&!r.hasCheckedOptimisedAppear&&Lde(r)}function Ode({attachResizeListener:t,defaultParent:e,measureScroll:i,checkIsScrollRoot:r,resetTransform:n}){return class{constructor(a={},o=e==null?void 0:e()){this.id=art++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(crt),this.nodes.forEach(prt),this.nodes.forEach(mrt),this.nodes.forEach(hrt)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new Yit)}addEventListener(a,o){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new CV),this.eventHandlers.get(a).add(o)}notifyListeners(a,...o){const l=this.eventHandlers.get(a);l&&l.notify(...o)}hasListeners(a){return this.eventHandlers.has(a)}mount(a,o=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Wit(a),this.instance=a;const{layoutId:l,layout:c,visualElement:h}=this.options;if(h&&!h.current&&h.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),o&&(c||l)&&(this.isLayoutDirty=!0),t){let u;const d=()=>this.root.updateBlockedByResize=!1;t(a,()=>{this.root.updateBlockedByResize=!0,u&&u(),u=qit(d,250),RC.hasAnimatedSinceResize&&(RC.hasAnimatedSinceResize=!1,this.nodes.forEach(BJ))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&h&&(l||c)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:d,hasRelativeLayoutChanged:f,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||h.getDefaultTransition()||brt,{onLayoutAnimationStart:g,onLayoutAnimationComplete:v}=h.getProps(),y=!this.targetLayout||!Ide(this.targetLayout,p),x=!d&&f;if(this.options.layoutRoot||this.resumeFrom||x||d&&(y||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(u,x);const S={...PV(m,"layout"),onPlay:g,onComplete:v};(h.shouldReduceMotion||this.options.layoutRoot)&&(S.delay=0,S.type=!1),this.startAnimation(S)}else d||BJ(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,_p(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(grt),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Lde(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let h=0;h<this.path.length;h++){const u=this.path[h];u.shouldResetTransform=!0,u.updateScroll("snapshot"),u.options.layoutRoot&&u.willUpdate(!1)}const{layoutId:o,layout:l}=this.options;if(o===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(OJ);return}this.isUpdating||this.nodes.forEach(drt),this.isUpdating=!1,this.nodes.forEach(frt),this.nodes.forEach(ort),this.nodes.forEach(lrt),this.clearAllSnapshots();const o=Nh.now();Gs.delta=wd(0,1e3/60,o-Gs.timestamp),Gs.timestamp=o,Gs.isProcessing=!0,vB.update.process(Gs),vB.preRender.process(Gs),vB.render.process(Gs),Gs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,IV.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(urt),this.sharedNodes.forEach(vrt)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Er.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Er.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Ga(this.snapshot.measuredBox.x)&&!Ga(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=gn(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(o=!1),o){const l=r(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:l,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!n)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!Rde(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,h=c!==this.prevTransformTemplateValue;a&&(o||Cm(this.latestValues)||h)&&(n(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const o=this.measurePageBox();let l=this.removeElementScroll(o);return a&&(l=this.removeTransform(l)),wrt(l),{animationId:this.root.animationId,measuredBox:o,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var a;const{visualElement:o}=this.options;if(!o)return gn();const l=o.measureViewportBox();if(!(((a=this.scroll)===null||a===void 0?void 0:a.wasRoot)||this.path.some(Srt))){const{scroll:h}=this.root;h&&(py(l.x,h.offset.x),py(l.y,h.offset.y))}return l}removeElementScroll(a){var o;const l=gn();if(pl(l,a),!((o=this.scroll)===null||o===void 0)&&o.wasRoot)return l;for(let c=0;c<this.path.length;c++){const h=this.path[c],{scroll:u,options:d}=h;h!==this.root&&u&&d.layoutScroll&&(u.wasRoot&&pl(l,a),py(l.x,u.offset.x),py(l.y,u.offset.y))}return l}applyTransform(a,o=!1){const l=gn();pl(l,a);for(let c=0;c<this.path.length;c++){const h=this.path[c];!o&&h.options.layoutScroll&&h.scroll&&h!==h.root&&my(l,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),Cm(h.latestValues)&&my(l,h.latestValues)}return Cm(this.latestValues)&&my(l,this.latestValues),l}removeTransform(a){const o=gn();pl(o,a);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!Cm(c.latestValues))continue;lz(c.latestValues)&&c.updateSnapshot();const h=gn(),u=c.measurePageBox();pl(h,u),TJ(o,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,h)}return Cm(this.latestValues)&&TJ(o,this.latestValues),o}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Gs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var o;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(a||c&&this.isSharedProjectionDirty||this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:d}=this.options;if(!(!this.layout||!(u||d))){if(this.resolvedRelativeTargetAt=Gs.timestamp,!this.targetDelta&&!this.relativeTarget){const f=this.getClosestProjectingParent();f&&f.layout&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=gn(),this.relativeTargetOrigin=gn(),Rw(this.relativeTargetOrigin,this.layout.layoutBox,f.layout.layoutBox),pl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=gn(),this.targetWithTransforms=gn()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Ait(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):pl(this.target,this.layout.layoutBox),_de(this.target,this.targetDelta)):pl(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const f=this.getClosestProjectingParent();f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=gn(),this.relativeTargetOrigin=gn(),Rw(this.relativeTargetOrigin,this.target,f.target),pl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||lz(this.parent.latestValues)||Sde(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var a;const o=this.getLead(),l=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Gs.timestamp&&(c=!1),c)return;const{layout:h,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(h||u))return;pl(this.layoutCorrected,this.layout.layoutBox);const d=this.treeScale.x,f=this.treeScale.y;Eit(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=gn());const{target:p}=o;if(!p){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(AJ(this.prevProjectionDelta.x,this.projectionDelta.x),AJ(this.prevProjectionDelta.y,this.projectionDelta.y)),Dw(this.projectionDelta,this.layoutCorrected,p,this.latestValues),(this.treeScale.x!==d||this.treeScale.y!==f||!IJ(this.projectionDelta.x,this.prevProjectionDelta.x)||!IJ(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){var o;if((o=this.options.visualElement)===null||o===void 0||o.scheduleRender(),a){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=fy(),this.projectionDelta=fy(),this.projectionDeltaWithTransform=fy()}setAnimationOrigin(a,o=!1){const l=this.snapshot,c=l?l.latestValues:{},h={...this.latestValues},u=fy();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const d=gn(),f=l?l.source:void 0,p=this.layout?this.layout.source:void 0,m=f!==p,g=this.getStack(),v=!g||g.members.length<=1,y=!!(m&&!v&&this.options.crossfade===!0&&!this.path.some(xrt));this.animationProgress=0;let x;this.mixTargetDelta=S=>{const A=S/1e3;FJ(u.x,a.x,A),FJ(u.y,a.y,A),this.setTargetDelta(u),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Rw(d,this.layout.layoutBox,this.relativeParent.layout.layoutBox),yrt(this.relativeTarget,this.relativeTargetOrigin,d,A),x&&irt(this.relativeTarget,x)&&(this.isProjectionDirty=!1),x||(x=gn()),pl(x,this.relativeTarget)),m&&(this.animationValues=h,Qit(h,c,this.latestValues,A,y,v)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=A},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(_p(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Er.update(()=>{RC.hasAnimatedSinceResize=!0,this.currentAnimation=jit(0,LJ,{...a,onUpdate:o=>{this.mixTargetDelta(o),a.onUpdate&&a.onUpdate(o)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(LJ),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:o,target:l,layout:c,latestValues:h}=a;if(!(!o||!l||!c)){if(this!==a&&this.layout&&c&&Bde(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||gn();const u=Ga(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+u;const d=Ga(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+d}pl(o,l),my(o,h),Dw(this.projectionDeltaWithTransform,this.layoutCorrected,o,h)}}registerSharedNode(a,o){this.sharedNodes.has(a)||this.sharedNodes.set(a,new rrt),this.sharedNodes.get(a).add(o);const c=o.options.initialPromotionConfig;o.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(o):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var a;const{layoutId:o}=this.options;return o?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:o}=this.options;return o?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:o,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let o=!1;const{latestValues:l}=a;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(o=!0),!o)return;const c={};l.z&&TB("z",a,c,this.animationValues);for(let h=0;h<MB.length;h++)TB(`rotate${MB[h]}`,a,c,this.animationValues),TB(`skew${MB[h]}`,a,c,this.animationValues);a.render();for(const h in c)a.setStaticValue(h,c[h]),this.animationValues&&(this.animationValues[h]=c[h]);a.scheduleRender()}getProjectionStyles(a){var o,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return srt;const c={visibility:""},h=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,c.opacity="",c.pointerEvents=DC(a==null?void 0:a.pointerEvents)||"",c.transform=h?h(this.latestValues,""):"none",c;const u=this.getLead();if(!this.projectionDelta||!this.layout||!u.target){const m={};return this.options.layoutId&&(m.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,m.pointerEvents=DC(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!Cm(this.latestValues)&&(m.transform=h?h({},""):"none",this.hasProjected=!1),m}const d=u.animationValues||u.latestValues;this.applyTransformsToTarget(),c.transform=nrt(this.projectionDeltaWithTransform,this.treeScale,d),h&&(c.transform=h(d,c.transform));const{x:f,y:p}=this.projectionDelta;c.transformOrigin=`${f.origin*100}% ${p.origin*100}% 0`,u.animationValues?c.opacity=u===this?(l=(o=d.opacity)!==null&&o!==void 0?o:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:c.opacity=u===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const m in HS){if(d[m]===void 0)continue;const{correct:g,applyTo:v,isCSSVariable:y}=HS[m],x=c.transform==="none"?d[m]:g(d[m],u);if(v){const S=v.length;for(let A=0;A<S;A++)c[v[A]]=x}else y?this.options.visualElement.renderState.vars[m]=x:c[m]=x}return this.options.layoutId&&(c.pointerEvents=u===this?DC(a==null?void 0:a.pointerEvents)||"":"none"),c}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var o;return(o=a.currentAnimation)===null||o===void 0?void 0:o.stop()}),this.root.nodes.forEach(OJ),this.root.sharedNodes.clear()}}}function ort(t){t.updateLayout()}function lrt(t){var e;const i=((e=t.resumeFrom)===null||e===void 0?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&i&&t.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:n}=t.layout,{animationType:s}=t.options,a=i.source!==t.layout.source;s==="size"?yl(u=>{const d=a?i.measuredBox[u]:i.layoutBox[u],f=Ga(d);d.min=r[u].min,d.max=d.min+f}):Bde(s,i.layoutBox,r)&&yl(u=>{const d=a?i.measuredBox[u]:i.layoutBox[u],f=Ga(r[u]);d.max=d.min+f,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[u].max=t.relativeTarget[u].min+f)});const o=fy();Dw(o,r,i.layoutBox);const l=fy();a?Dw(l,t.applyTransform(n,!0),i.measuredBox):Dw(l,r,i.layoutBox);const c=!Rde(o);let h=!1;if(!t.resumeFrom){const u=t.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:d,layout:f}=u;if(d&&f){const p=gn();Rw(p,i.layoutBox,d.layoutBox);const m=gn();Rw(m,r,f.layoutBox),Ide(p,m)||(h=!0),u.options.layoutRoot&&(t.relativeTarget=m,t.relativeTargetOrigin=p,t.relativeParent=u)}}}t.notifyListeners("didUpdate",{layout:r,snapshot:i,delta:l,layoutDelta:o,hasLayoutChanged:c,hasRelativeLayoutChanged:h})}else if(t.isLead()){const{onExitComplete:r}=t.options;r&&r()}t.options.transition=void 0}function crt(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function hrt(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function urt(t){t.clearSnapshot()}function OJ(t){t.clearMeasurements()}function drt(t){t.isLayoutDirty=!1}function frt(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function BJ(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function prt(t){t.resolveTargetDelta()}function mrt(t){t.calcProjection()}function grt(t){t.resetSkewAndRotation()}function vrt(t){t.removeLeadSnapshot()}function FJ(t,e,i){t.translate=Yr(e.translate,0,i),t.scale=Yr(e.scale,1,i),t.origin=e.origin,t.originPoint=e.originPoint}function kJ(t,e,i,r){t.min=Yr(e.min,i.min,r),t.max=Yr(e.max,i.max,r)}function yrt(t,e,i,r){kJ(t.x,e.x,i.x,r),kJ(t.y,e.y,i.y,r)}function xrt(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const brt={duration:.45,ease:[.4,0,.1,1]},NJ=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),UJ=NJ("applewebkit/")&&!NJ("chrome/")?Math.round:jo;function zJ(t){t.min=UJ(t.min),t.max=UJ(t.max)}function wrt(t){zJ(t.x),zJ(t.y)}function Bde(t,e,i){return t==="position"||t==="preserve-aspect"&&!_it(RJ(e),RJ(i),.2)}function Srt(t){var e;return t!==t.root&&((e=t.scroll)===null||e===void 0?void 0:e.wasRoot)}const _rt=Ode({attachResizeListener:(t,e)=>YS(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),CB={current:void 0},Fde=Ode({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!CB.current){const t=new _rt({});t.mount(window),t.setOptions({layoutScroll:!0}),CB.current=t}return CB.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),Art={pan:{Feature:zit},drag:{Feature:Uit,ProjectionNode:Fde,MeasureLayout:Cde}};function GJ(t,e,i){const{props:r}=t;t.animationState&&r.whileHover&&t.animationState.setActive("whileHover",i==="Start");const n="onHover"+i,s=r[n];s&&Er.postRender(()=>s(e,j_(e)))}class Ert extends kp{mount(){const{current:e}=this.node;e&&(this.unmount=IZe(e,(i,r)=>(GJ(this.node,r,"Start"),n=>GJ(this.node,n,"End"))))}unmount(){}}class Mrt extends kp{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=H_(YS(this.node.current,"focus",()=>this.onFocus()),YS(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function VJ(t,e,i){const{props:r}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&r.whileTap&&t.animationState.setActive("whileTap",i==="Start");const n="onTap"+(i==="End"?"":i),s=r[n];s&&Er.postRender(()=>s(e,j_(e)))}class Trt extends kp{mount(){const{current:e}=this.node;e&&(this.unmount=FZe(e,(i,r)=>(VJ(this.node,r,"Start"),(n,{success:s})=>VJ(this.node,n,s?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const uz=new WeakMap,PB=new WeakMap,Crt=t=>{const e=uz.get(t.target);e&&e(t)},Prt=t=>{t.forEach(Crt)};function Drt({root:t,...e}){const i=t||document;PB.has(i)||PB.set(i,{});const r=PB.get(i),n=JSON.stringify(e);return r[n]||(r[n]=new IntersectionObserver(Prt,{root:t,...e})),r[n]}function Rrt(t,e,i){const r=Drt(e);return uz.set(t,i),r.observe(t),()=>{uz.delete(t),r.unobserve(t)}}const Irt={some:0,all:1};class Lrt extends kp{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:r,amount:n="some",once:s}=e,a={root:i?i.current:void 0,rootMargin:r,threshold:typeof n=="number"?n:Irt[n]},o=l=>{const{isIntersecting:c}=l;if(this.isInView===c||(this.isInView=c,s&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:h,onViewportLeave:u}=this.node.getProps(),d=c?h:u;d&&d(l)};return Rrt(this.node.current,a,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(Ort(e,i))&&this.startObserver()}unmount(){}}function Ort({viewport:t={}},{viewport:e={}}={}){return i=>t[i]!==e[i]}const Brt={inView:{Feature:Lrt},tap:{Feature:Trt},focus:{Feature:Mrt},hover:{Feature:Ert}},Frt={layout:{ProjectionNode:Fde,MeasureLayout:Cde}},dz={current:null},kde={current:!1};function krt(){if(kde.current=!0,!!_V)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>dz.current=t.matches;t.addListener(e),e()}else dz.current=!1}const Nrt=[...ode,ca,Ap],Urt=t=>Nrt.find(ade(t)),zrt=new WeakMap;function Grt(t,e,i){for(const r in e){const n=e[r],s=i[r];if(ma(n))t.addValue(r,n);else if(ma(s))t.addValue(r,GS(n,{owner:t}));else if(s!==n)if(t.hasValue(r)){const a=t.getValue(r);a.liveStyle===!0?a.jump(n):a.hasAnimated||a.set(n)}else{const a=t.getStaticValue(r);t.addValue(r,GS(a!==void 0?a:n,{owner:t}))}}for(const r in i)e[r]===void 0&&t.removeValue(r);return e}const HJ=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Vrt{scrapeMotionValuesFromProps(e,i,r){return{}}constructor({parent:e,props:i,presenceContext:r,reducedMotionConfig:n,blockInitialAnimation:s,visualState:a},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=$V,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=Nh.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,Er.render(this.render,!1,!0))};const{latestValues:l,renderState:c,onUpdate:h}=a;this.onUpdate=h,this.latestValues=l,this.baseTarget={...l},this.initialValues=i.initial?{...l}:{},this.renderState=c,this.parent=e,this.props=i,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=n,this.options=o,this.blockInitialAnimation=!!s,this.isControllingVariants=rR(i),this.isVariantNode=_ue(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...d}=this.scrapeMotionValuesFromProps(i,{},this);for(const f in d){const p=d[f];l[f]!==void 0&&ma(p)&&p.set(l[f],!1)}}mount(e){this.current=e,zrt.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,r)=>this.bindToMotionValue(r,i)),kde.current||krt(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:dz.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),_p(this.notifyUpdate),_p(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=h0.has(e);r&&this.onBindTransform&&this.onBindTransform();const n=i.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&Er.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0)}),s=i.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{n(),s(),a&&a(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in M1){const i=M1[e];if(!i)continue;const{isEnabled:r,Feature:n}=i;if(!this.features[e]&&n&&r(this.props)&&(this.features[e]=new n(this)),this.features[e]){const s=this.features[e];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):gn()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let r=0;r<HJ.length;r++){const n=HJ[r];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);const s="on"+n,a=e[s];a&&(this.propEventSubscriptions[n]=this.on(n,a))}this.prevMotionValues=Grt(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const r=this.values.get(e);i!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&i!==void 0&&(r=GS(i===null?void 0:i,{owner:this}),this.addValue(e,r)),r}readValue(e,i){var r;let n=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(r=this.getBaseTargetFromProps(this.props,e))!==null&&r!==void 0?r:this.readValueFromInstance(this.current,e,this.options);return n!=null&&(typeof n=="string"&&(nde(n)||que(n))?n=parseFloat(n):!Urt(n)&&Ap.test(i)&&(n=tde(e,i)),this.setBaseTarget(e,ma(n)?n.get():n)),ma(n)?n.get():n}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){var i;const{initial:r}=this.props;let n;if(typeof r=="string"||typeof r=="object"){const a=WV(this.props,r,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);a&&(n=a[e])}if(r&&n!==void 0)return n;const s=this.getBaseTargetFromProps(this.props,e);return s!==void 0&&!ma(s)?s:this.initialValues[e]!==void 0&&n===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new CV),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}}class Nde extends Vrt{constructor(){super(...arguments),this.KeyframeResolver=lde}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:r}){delete i[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;ma(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function Hrt(t){return window.getComputedStyle(t)}class jrt extends Nde{constructor(){super(...arguments),this.type="html",this.renderInstance=Oue}readValueFromInstance(e,i){if(h0.has(i))return itt(e,i);{const r=Hrt(e),n=(kV(i)?r.getPropertyValue(i):r[i])||0;return typeof n=="string"?n.trim():n}}measureInstanceViewportBox(e,{transformPagePoint:i}){return Ade(e,i)}build(e,i,r){zV(e,i,r.transformTemplate)}scrapeMotionValuesFromProps(e,i,r){return XV(e,i,r)}}class Wrt extends Nde{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=gn,this.updateDimensions=()=>{this.current&&!this.renderState.dimensions&&Lue(this.current,this.renderState)}}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(h0.has(i)){const r=ede(i);return r&&r.default||0}return i=Bue.has(i)?i:FV(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,r){return kue(e,i,r)}onBindTransform(){this.current&&!this.renderState.dimensions&&Er.postRender(this.updateDimensions)}build(e,i,r){HV(e,i,this.isSVGTag,r.transformTemplate)}renderInstance(e,i,r,n){Fue(e,i,r,n)}mount(e){this.isSVGTag=jV(e.tagName),super.mount(e)}}const Xrt=(t,e)=>VV(t)?new Wrt(e):new jrt(e,{allowProjection:t!==we.Fragment}),Yrt=Pet({...mit,...Brt,...Art,...Frt},Xrt),Yb=HZe(Yrt);var fz=new Map,IT=new WeakMap,jJ=0,qrt=void 0;function Krt(t){return t?(IT.has(t)||(jJ+=1,IT.set(t,jJ.toString())),IT.get(t)):"0"}function Qrt(t){return Object.keys(t).sort().filter(e=>t[e]!==void 0).map(e=>`${e}_${e==="root"?Krt(t.root):t[e]}`).toString()}function $rt(t){const e=Qrt(t);let i=fz.get(e);if(!i){const r=new Map;let n;const s=new IntersectionObserver(a=>{a.forEach(o=>{var l;const c=o.isIntersecting&&n.some(h=>o.intersectionRatio>=h);t.trackVisibility&&typeof o.isVisible>"u"&&(o.isVisible=c),(l=r.get(o.target))==null||l.forEach(h=>{h(c,o)})})},t);n=s.thresholds||(Array.isArray(t.threshold)?t.threshold:[t.threshold||0]),i={id:e,observer:s,elements:r},fz.set(e,i)}return i}function Jrt(t,e,i={},r=qrt){if(typeof window.IntersectionObserver>"u"&&r!==void 0){const l=t.getBoundingClientRect();return e(r,{isIntersecting:r,target:t,intersectionRatio:typeof i.threshold=="number"?i.threshold:0,time:0,boundingClientRect:l,intersectionRect:l,rootBounds:l}),()=>{}}const{id:n,observer:s,elements:a}=$rt(i),o=a.get(t)||[];return a.has(t)||a.set(t,o),o.push(e),s.observe(t),function(){o.splice(o.indexOf(e),1),o.length===0&&(a.delete(t),s.unobserve(t)),a.size===0&&(s.disconnect(),fz.delete(n))}}function Zrt({threshold:t,delay:e,trackVisibility:i,rootMargin:r,root:n,triggerOnce:s,skip:a,initialInView:o,fallbackInView:l,onChange:c}={}){var h;const[u,d]=we.useState(null),f=we.useRef(c),[p,m]=we.useState({inView:!!o,entry:void 0});f.current=c,we.useEffect(()=>{if(a||!u)return;let x;return x=Jrt(u,(S,A)=>{m({inView:S,entry:A}),f.current&&f.current(S,A),A.isIntersecting&&s&&x&&(x(),x=void 0)},{root:n,rootMargin:r,threshold:t,trackVisibility:i,delay:e},l),()=>{x&&x()}},[Array.isArray(t)?t.toString():t,u,n,r,s,a,i,l,e]);const g=(h=p.entry)==null?void 0:h.target,v=we.useRef(void 0);!u&&g&&!s&&!a&&v.current!==g&&(v.current=g,m({inView:!!o,entry:void 0}));const y=[d,p.inView,p.entry];return y.ref=y[0],y.inView=y[1],y.entry=y[2],y}const ent="Left",tnt="Right",int="Up",rnt="Down",gy={delta:10,preventScrollOnSwipe:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0,swipeDuration:1/0,touchEventOptions:{passive:!0}},pz={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},WJ="mousemove",XJ="mouseup",nnt="touchend",snt="touchmove",ant="touchstart";function ont(t,e,i,r){return t>e?i>0?tnt:ent:r>0?rnt:int}function YJ(t,e){if(e===0)return t;const i=Math.PI/180*e,r=t[0]*Math.cos(i)+t[1]*Math.sin(i),n=t[1]*Math.cos(i)-t[0]*Math.sin(i);return[r,n]}function lnt(t,e){const i=h=>{const u="touches"in h;u&&h.touches.length>1||t((d,f)=>{f.trackMouse&&!u&&(document.addEventListener(WJ,r),document.addEventListener(XJ,a));const{clientX:p,clientY:m}=u?h.touches[0]:h,g=YJ([p,m],f.rotationAngle);return f.onTouchStartOrOnMouseDown&&f.onTouchStartOrOnMouseDown({event:h}),Object.assign(Object.assign(Object.assign({},d),pz),{initial:g.slice(),xy:g,start:h.timeStamp||0})})},r=h=>{t((u,d)=>{const f="touches"in h;if(f&&h.touches.length>1)return u;if(h.timeStamp-u.start>d.swipeDuration)return u.swiping?Object.assign(Object.assign({},u),{swiping:!1}):u;const{clientX:p,clientY:m}=f?h.touches[0]:h,[g,v]=YJ([p,m],d.rotationAngle),y=g-u.xy[0],x=v-u.xy[1],S=Math.abs(y),A=Math.abs(x),_=(h.timeStamp||0)-u.start,M=Math.sqrt(S*S+A*A)/(_||1),E=[y/(_||1),x/(_||1)],T=ont(S,A,y,x),C=typeof d.delta=="number"?d.delta:d.delta[T.toLowerCase()]||gy.delta;if(S<C&&A<C&&!u.swiping)return u;const D={absX:S,absY:A,deltaX:y,deltaY:x,dir:T,event:h,first:u.first,initial:u.initial,velocity:M,vxvy:E};D.first&&d.onSwipeStart&&d.onSwipeStart(D),d.onSwiping&&d.onSwiping(D);let B=!1;return(d.onSwiping||d.onSwiped||d[`onSwiped${T}`])&&(B=!0),B&&d.preventScrollOnSwipe&&d.trackTouch&&h.cancelable&&h.preventDefault(),Object.assign(Object.assign({},u),{first:!1,eventData:D,swiping:!0})})},n=h=>{t((u,d)=>{let f;if(u.swiping&&u.eventData){if(h.timeStamp-u.start<d.swipeDuration){f=Object.assign(Object.assign({},u.eventData),{event:h}),d.onSwiped&&d.onSwiped(f);const p=d[`onSwiped${f.dir}`];p&&p(f)}}else d.onTap&&d.onTap({event:h});return d.onTouchEndOrOnMouseUp&&d.onTouchEndOrOnMouseUp({event:h}),Object.assign(Object.assign(Object.assign({},u),pz),{eventData:f})})},s=()=>{document.removeEventListener(WJ,r),document.removeEventListener(XJ,a)},a=h=>{s(),n(h)},o=(h,u)=>{let d=()=>{};if(h&&h.addEventListener){const f=Object.assign(Object.assign({},gy.touchEventOptions),u.touchEventOptions),p=[[ant,i,f],[snt,r,Object.assign(Object.assign({},f),u.preventScrollOnSwipe?{passive:!1}:{})],[nnt,n,f]];p.forEach(([m,g,v])=>h.addEventListener(m,g,v)),d=()=>p.forEach(([m,g])=>h.removeEventListener(m,g))}return d},c={ref:h=>{h!==null&&t((u,d)=>{if(u.el===h)return u;const f={};return u.el&&u.el!==h&&u.cleanUpTouch&&(u.cleanUpTouch(),f.cleanUpTouch=void 0),d.trackTouch&&h&&(f.cleanUpTouch=o(h,d)),Object.assign(Object.assign(Object.assign({},u),{el:h}),f)})}};return e.trackMouse&&(c.onMouseDown=i),[c,o]}function cnt(t,e,i,r){return!e.trackTouch||!t.el?(t.cleanUpTouch&&t.cleanUpTouch(),Object.assign(Object.assign({},t),{cleanUpTouch:void 0})):t.cleanUpTouch?e.preventScrollOnSwipe!==i.preventScrollOnSwipe||e.touchEventOptions.passive!==i.touchEventOptions.passive?(t.cleanUpTouch(),Object.assign(Object.assign({},t),{cleanUpTouch:r(t.el,e)})):t:Object.assign(Object.assign({},t),{cleanUpTouch:r(t.el,e)})}function hnt(t){const{trackMouse:e}=t,i=we.useRef(Object.assign({},pz)),r=we.useRef(Object.assign({},gy)),n=we.useRef(Object.assign({},r.current));n.current=Object.assign({},r.current),r.current=Object.assign(Object.assign({},gy),t);let s;for(s in gy)r.current[s]===void 0&&(r.current[s]=gy[s]);const[a,o]=we.useMemo(()=>lnt(l=>i.current=l(i.current,r.current),{trackMouse:e}),[e]);return i.current=cnt(i.current,r.current,n.current,o),a}const unt=()=>{const[t,e]=we.useState(()=>localStorage.getItem("theme")!=="light");we.useEffect(()=>{const l=()=>e(localStorage.getItem("theme")!=="light");window.addEventListener("storage",l);const c=new MutationObserver(h=>{h.forEach(u=>{if(u.attributeName==="class"){const d=document.documentElement.classList.contains("dark");e(d)}})});return c.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>{window.removeEventListener("storage",l),c.disconnect()}},[]);const[i,r]=Zrt({triggerOnce:!1,threshold:.1}),[n,s]=we.useState(0),a=l=>{const c=Ox.length-1;l==="LEFT"&&n<c&&s(n+1),l==="RIGHT"&&n>0&&s(n-1)},o=hnt({onSwipedLeft:()=>a("LEFT"),onSwipedRight:()=>a("RIGHT"),trackMouse:!0});return Y.jsx("section",{id:"achievements",ref:i,className:`py-20 px-4 transition-colors duration-500 relative overflow-hidden ${t?"bg-black text-[#FAFAFA] dark":"bg-[#f9dcc4] text-[#333333]"}`,children:Y.jsxs("div",{className:"max-w-7xl mx-auto relative z-10",children:[Y.jsxs(Yb.div,{initial:{opacity:0,y:20},animate:r?{opacity:1,y:0}:{opacity:0,y:20},transition:{duration:.7},className:"mb-16",children:[Y.jsx("h2",{className:`head-text ${t?"text-[#A8E6CF]":"text-[#FF8A80]"}`,children:"Achievements"}),Y.jsx("p",{className:`mt-4 max-w-xl ${t?"text-gray-300":"text-gray-600"}`,children:"Highlights of my journey as a software developer and student"})]}),Y.jsx("div",{className:"hidden sm:grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:Ox.map((l,c)=>Y.jsx(qJ,{index:c,achievement:l,darkTheme:t,inView:r},c))}),Y.jsxs("div",{className:"sm:hidden w-full overflow-hidden relative mt-8",children:[Y.jsx("div",{...o,children:Y.jsx("div",{className:"flex transition-transform duration-500 ease-in-out",style:{transform:`translateX(-${n*100}%)`,width:`${Ox.length*100}%`},children:Ox.map((l,c)=>Y.jsx("div",{className:"w-full px-4 flex-shrink-0",children:Y.jsx(qJ,{index:c,achievement:l,darkTheme:t,inView:!0})},c))})}),Y.jsx("div",{className:"flex justify-center mt-4 gap-2",children:Ox.map((l,c)=>Y.jsx("button",{onClick:()=>s(c),className:`w-3 h-3 rounded-full ${n===c?"bg-[#FF8A80]":"bg-gray-400"} transition-all`},c))})]})]})})},qJ=({achievement:t,index:e,darkTheme:i,inView:r})=>{const n=[-12,-4,4,12][e%4];return Y.jsxs(Yb.div,{initial:{opacity:0,y:50,rotateY:n},animate:r?{opacity:1,y:0,rotateY:n,z:20}:{opacity:0,y:50,rotateY:n},transition:{duration:.8,delay:e*.15,type:"spring",stiffness:80},whileHover:{scale:1.05,rotateY:0,z:50,transition:{duration:.3}},className:`relative group min-h-64 flex flex-col justify-between p-6 rounded-xl transform-gpu
                ${i?"bg-gray-900/50 backdrop-blur-sm border border-gray-800 hover:border-[#A8E6CF]":"bg-white/60 backdrop-blur-sm shadow-xl hover:shadow-[#FF8A80]/20 border border-gray-100"}
                transition-all duration-300`,style:{transformStyle:"preserve-3d",transform:`perspective(1000px) rotateY(${n}deg)`},children:[Y.jsx("div",{className:`absolute inset-0 -z-10 rounded-xl opacity-0 group-hover:opacity-70 transition-opacity duration-300 blur-xl scale-110 ${i?"bg-[#A8E6CF]/20":"bg-[#FF8A80]/15"}`}),Y.jsx("div",{className:"absolute -top-5 -right-5 z-10",children:Y.jsx(Yb.div,{animate:{y:[0,-10,0],rotate:[0,5,0],scale:[1,1.1,1]},transition:{repeat:1/0,repeatType:"reverse",duration:3+e,ease:"easeInOut"},className:"text-4xl",style:{textShadow:i?"0 0 15px rgba(168, 230, 207, 0.5)":"0 0 15px rgba(255, 138, 128, 0.5)"},children:t.icon})}),Y.jsxs("div",{children:[Y.jsx("h3",{className:`text-xl font-bold mb-2 ${i?"text-[#A8E6CF]":"text-[#f79d65]"}`,children:t.title}),Y.jsx(Yb.p,{className:`text-3xl font-extrabold ${i?"text-white":"text-gray-800"}`,animate:{scale:[1,1.03,1],opacity:[1,.9,1]},transition:{repeat:1/0,duration:3,delay:e*.5},children:t.value})]}),Y.jsx("p",{className:`mt-2 text-sm ${i?"text-gray-400":"text-gray-600"}`,children:t.description}),t.details&&Y.jsx(Yb.div,{className:`mt-3 text-sm space-y-1 transition-opacity duration-300 opacity-0 group-hover:opacity-100 ${i?"text-gray-300":"text-gray-700"}`,animate:{y:0},children:Object.entries(t.details).map(([s,a])=>Y.jsxs("p",{children:[Y.jsxs("strong",{children:[s[0].toUpperCase()+s.slice(1),":"]})," ",Array.isArray(a)?a.join(", "):a]},s))}),Y.jsx("div",{className:`absolute bottom-0 left-0 right-0 h-1 rounded-b-xl transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left ${i?"bg-[#A8E6CF]":"bg-[#FF8A80]"}`})]})},dnt=()=>{const[t,e]=we.useState(!0);return we.useEffect(()=>{const i=()=>{const n=document.documentElement.classList.contains("dark");e(n)};i();const r=new MutationObserver(i);return r.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>r.disconnect()},[]),Y.jsxs("section",{className:`c-space pt-7 pb-3 border-t flex justify-between items-center flex-wrap gap-2 ${t?"border-cream-500":"border-black-500"}`,children:[Y.jsxs("div",{className:"text-white-600 flex gap-2",children:[Y.jsx("p",{children:"Developed By"}),Y.jsx("p",{children:"Bhoomika K S"})]}),Y.jsxs("div",{className:" flex gap-1",children:[Y.jsx("div",{className:"social-icon",children:Y.jsx("a",{href:"https://www.github.com/",children:Y.jsx("img",{src:"assets/github.svg",alt:"github",className:"w-6 h-6"})})}),Y.jsx("div",{className:"social-icon",children:Y.jsx("a",{href:"https://linkedin.com/",children:Y.jsx("img",{src:"assets/linkedin.svg",alt:"linkdn",className:"w-6 h-6"})})}),Y.jsx("div",{className:"social-icon",children:Y.jsx("a",{href:"mailto:ksbhoomika43@gmail.com",children:Y.jsx("img",{src:"assets/email.svg",alt:"github",className:"w-6 h-6"})})})]}),Y.jsx("p",{className:"text-white-600",children:" 2024 All Rights Reserved."})]})},fnt=()=>Y.jsxs("main",{className:"main-w-7xl mx-auto",children:[Y.jsx(rge,{}),Y.jsx(nZe,{}),Y.jsx(hZe,{}),Y.jsx(dZe,{}),Y.jsx(unt,{}),Y.jsx(vZe,{}),Y.jsx(dnt,{})]});c4(document.getElementById("root")).render(Y.jsx(we.StrictMode,{children:Y.jsx(fnt,{})}));export{kA as c,C1 as g};
